{"version":3,"sources":["node_modules/@ant-design/icons-svg/es/asn/PlusCircleOutlined.js","node_modules/@ant-design/icons/es/icons/PlusCircleOutlined.js","node_modules/@ant-design/icons/es/icons/FolderOpenOutlined.js","node_modules/@ant-design/icons-svg/es/asn/MoreOutlined.js","node_modules/@ant-design/icons/es/icons/MoreOutlined.js","src/pages/PhotoEditor/components/ExportModal.tsx","src/pages/PhotoEditor/utils/brushHelpers.ts","src/pages/PhotoEditor/utils/effectsHelpers.ts","src/pages/PhotoEditor/components/LayerMaskModal.tsx","src/pages/PhotoEditor/components/SavedProjectsList.tsx","src/pages/PhotoEditor/components/ProjectModal.tsx","src/pages/PhotoEditor/utils/storage.ts","src/pages/PhotoEditor/hooks/useProjects.ts","src/pages/PhotoEditor/components/Toolbar.tsx","src/pages/PhotoEditor/hooks/useKeyboardShortcuts.ts","src/pages/PhotoEditor/components/CanvasArea.tsx","src/pages/PhotoEditor/components/LayersPanel.tsx","src/pages/PhotoEditor/components/AdjustmentPanel.tsx","src/pages/PhotoEditor/components/BrushPanel.tsx","node_modules/@ant-design/icons-svg/es/asn/BoldOutlined.js","node_modules/@ant-design/icons/es/icons/BoldOutlined.js","node_modules/@ant-design/icons-svg/es/asn/UnderlineOutlined.js","node_modules/@ant-design/icons/es/icons/UnderlineOutlined.js","src/pages/PhotoEditor/components/TextStylePanel.tsx","src/pages/PhotoEditor/components/AlignControls.tsx","src/pages/PhotoEditor/components/PropertiesPanel.tsx","src/pages/PhotoEditor/components/UploadArea.tsx","src/pages/PhotoEditor/hooks/useImageUpload.ts","/home/thanhnd/Downloads/code/ultimate-tool-web/src/pages/PhotoEditor/styles.less?asmodule","src/pages/PhotoEditor/index.tsx","src/pages/PhotoEditor/hooks/useHistory.ts","src/pages/PhotoEditor/context.tsx"],"sourcesContent":["// This icon file is generated automatically.\nvar PlusCircleOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z\" } }, { \"tag\": \"path\", \"attrs\": { \"d\": \"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z\" } }] }, \"name\": \"plus-circle\", \"theme\": \"outlined\" };\nexport default PlusCircleOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport PlusCircleOutlinedSvg from \"@ant-design/icons-svg/es/asn/PlusCircleOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar PlusCircleOutlined = function PlusCircleOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: PlusCircleOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(PlusCircleOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'PlusCircleOutlined';\n}\nexport default RefIcon;","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport FolderOpenOutlinedSvg from \"@ant-design/icons-svg/es/asn/FolderOpenOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar FolderOpenOutlined = function FolderOpenOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: FolderOpenOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(FolderOpenOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'FolderOpenOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar MoreOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z\" } }] }, \"name\": \"more\", \"theme\": \"outlined\" };\nexport default MoreOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport MoreOutlinedSvg from \"@ant-design/icons-svg/es/asn/MoreOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar MoreOutlined = function MoreOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: MoreOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(MoreOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'MoreOutlined';\n}\nexport default RefIcon;","import React, { useState } from 'react';\nimport { Modal, Form, Select, InputNumber, Button, message, Checkbox } from 'antd';\nimport { Canvas } from 'fabric';\n\ninterface ExportModalProps {\n  visible: boolean;\n  onCancel: () => void;\n  canvas: Canvas | null;\n}\n\nconst ExportModal: React.FC<ExportModalProps> = ({ visible, onCancel, canvas }) => {\n  const [format, setFormat] = useState<'png' | 'jpeg' | 'json' | 'svg'>('png');\n  const [quality, setQuality] = useState<number>(1);\n  const [multiplier, setMultiplier] = useState<number>(1);\n  const [trimWhitespace, setTrimWhitespace] = useState<boolean>(true);\n\n  const handleExport = () => {\n    if (!canvas) return;\n\n    if (format === 'json') {\n      const json = canvas.toJSON();\n      const blob = new Blob([JSON.stringify(json)], { type: 'application/json' });\n      downloadBlob(blob, 'project.json');\n    } else if (format === 'svg') {\n      const svg = canvas.toSVG();\n      const blob = new Blob([svg], { type: 'image/svg+xml' });\n      downloadBlob(blob, 'image.svg');\n    } else {\n      let options: any = {\n        format,\n        quality,\n        multiplier,\n      };\n\n      let savedBackgroundColor: any = null;\n      let savedBackgroundImage: any = null;\n\n      if (trimWhitespace) {\n        const objects = canvas.getObjects();\n        if (objects.length > 0) {\n          let minX = Infinity;\n          let minY = Infinity;\n          let maxX = -Infinity;\n          let maxY = -Infinity;\n\n          objects.forEach((obj) => {\n            const bound = obj.getBoundingRect();\n            if (bound.left < minX) minX = bound.left;\n            if (bound.top < minY) minY = bound.top;\n            if (bound.left + bound.width > maxX) maxX = bound.left + bound.width;\n            if (bound.top + bound.height > maxY) maxY = bound.top + bound.height;\n          });\n\n          options = {\n            ...options,\n            left: minX,\n            top: minY,\n            width: maxX - minX,\n            height: maxY - minY,\n          };\n\n          // Save and remove background\n          savedBackgroundColor = canvas.backgroundColor;\n          savedBackgroundImage = canvas.backgroundImage;\n          canvas.backgroundColor = null as any;\n          canvas.backgroundImage = null as any;\n        }\n      }\n\n      const dataURL = canvas.toDataURL(options);\n\n      // Restore background\n      if (trimWhitespace) {\n        canvas.backgroundColor = savedBackgroundColor;\n        canvas.backgroundImage = savedBackgroundImage;\n      }\n\n      const link = document.createElement('a');\n      link.download = `image.${format}`;\n      link.href = dataURL;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    }\n    message.success('Export successful');\n    onCancel();\n  };\n\n  const downloadBlob = (blob: Blob, fileName: string) => {\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = fileName;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  return (\n    <Modal\n      title=\"Export Image\"\n      open={visible}\n      onCancel={onCancel}\n      footer={[\n        <Button key=\"cancel\" onClick={onCancel}>\n          Cancel\n        </Button>,\n        <Button key=\"export\" type=\"primary\" onClick={handleExport}>\n          Export\n        </Button>,\n      ]}\n    >\n      <Form layout=\"vertical\">\n        <Form.Item label=\"Format\">\n          <Select value={format} onChange={(v) => setFormat(v)}>\n            <Select.Option value=\"png\">PNG</Select.Option>\n            <Select.Option value=\"jpeg\">JPEG</Select.Option>\n            <Select.Option value=\"svg\">SVG</Select.Option>\n            <Select.Option value=\"json\">JSON (Project)</Select.Option>\n          </Select>\n        </Form.Item>\n        {format !== 'json' && format !== 'svg' && (\n          <>\n            <Form.Item label=\"Quality (0.1 - 1)\">\n              <InputNumber\n                min={0.1}\n                max={1}\n                step={0.1}\n                value={quality}\n                onChange={(v) => setQuality(v || 1)}\n                style={{ width: '100%' }}\n              />\n            </Form.Item>\n            <Form.Item label=\"Multiplier (Scale)\">\n              <InputNumber\n                min={0.1}\n                max={5}\n                step={0.1}\n                value={multiplier}\n                onChange={(v) => setMultiplier(v || 1)}\n                style={{ width: '100%' }}\n              />\n            </Form.Item>\n            <Form.Item>\n              <Checkbox\n                checked={trimWhitespace}\n                onChange={(e) => setTrimWhitespace(e.target.checked)}\n              >\n                Trim Whitespace (Export content only)\n              </Checkbox>\n            </Form.Item>\n          </>\n        )}\n      </Form>\n    </Modal>\n  );\n};\n\nexport default ExportModal;\n","export type BrushSettings = {\n  color: string;\n  lineWidth: number;\n  opacity: number;\n  flow: number;\n  type: 'hard' | 'soft';\n};\n\nexport const drawBrushStroke = (\n  ctx: CanvasRenderingContext2D,\n  points: { x: number; y: number }[],\n  settings: BrushSettings,\n) => {\n  if (points.length === 0) return;\n\n  ctx.save();\n  ctx.globalAlpha = settings.opacity * settings.flow;\n\n  if (settings.type === 'soft') {\n    ctx.shadowColor = settings.color;\n    ctx.shadowBlur = settings.lineWidth * 0.5;\n    ctx.lineWidth = settings.lineWidth * 0.5;\n  } else {\n    ctx.shadowBlur = 0;\n    ctx.lineWidth = settings.lineWidth;\n  }\n\n  ctx.strokeStyle = settings.color;\n  ctx.fillStyle = settings.color;\n  ctx.lineCap = 'round';\n  ctx.lineJoin = 'round';\n\n  ctx.beginPath();\n  if (points.length === 1) {\n    ctx.arc(points[0].x, points[0].y, ctx.lineWidth / 2, 0, Math.PI * 2);\n    ctx.fill();\n  } else {\n    ctx.moveTo(points[0].x, points[0].y);\n    for (let i = 1; i < points.length; i++) {\n      ctx.lineTo(points[i].x, points[i].y);\n    }\n    ctx.stroke();\n  }\n  ctx.restore();\n};\n\nexport const drawBrushCursor = (\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  zoom: number = 1,\n) => {\n  ctx.save();\n  ctx.strokeStyle = color;\n  ctx.lineWidth = 2 / zoom;\n  ctx.beginPath();\n  ctx.arc(x, y, size / 2, 0, Math.PI * 2);\n  ctx.stroke();\n  ctx.restore();\n};\n\nexport const getCanvasCoords = (\n  e: MouseEvent | React.MouseEvent,\n  canvasRef: React.RefObject<HTMLCanvasElement>,\n  zoom: number = 1,\n  offset: { x: number; y: number } = { x: 0, y: 0 },\n) => {\n  if (!canvasRef.current) return null;\n  const rect = canvasRef.current.getBoundingClientRect();\n  const x = (e.clientX - rect.left - offset.x) / zoom;\n  const y = (e.clientY - rect.top - offset.y) / zoom;\n  return { x, y };\n};\n\nexport const samplePixelColor = (\n  canvas: HTMLCanvasElement,\n  x: number,\n  y: number,\n): string | null => {\n  const ctx = canvas.getContext('2d');\n  if (!ctx) return null;\n\n  const imageData = ctx.getImageData(x, y, 1, 1);\n  const [r, g, b] = imageData.data;\n  return `#${[r, g, b].map((v) => v.toString(16).padStart(2, '0')).join('')}`;\n};\n","export const calculateColorRemovalAlphaMap = (\n  data: Uint8ClampedArray,\n  targetColor: string,\n  tolerance: number,\n  invert: boolean = false,\n  feather: number = 0,\n): Uint8Array => {\n  const hex = targetColor.replace('#', '');\n  const targetR = parseInt(hex.substring(0, 2), 16);\n  const targetG = parseInt(hex.substring(2, 4), 16);\n  const targetB = parseInt(hex.substring(4, 6), 16);\n\n  const alphaMap = new Uint8Array(data.length / 4);\n  const maxDistance = Math.sqrt(255 * 255 * 3);\n  const threshold = tolerance / 100;\n  const featherRange = feather / 100;\n\n  for (let i = 0; i < data.length; i += 4) {\n    const r = data[i];\n    const g = data[i + 1];\n    const b = data[i + 2];\n\n    const distance = Math.sqrt(\n      Math.pow(r - targetR, 2) + Math.pow(g - targetG, 2) + Math.pow(b - targetB, 2),\n    );\n\n    const normalizedDistance = distance / maxDistance;\n\n    let baseAlpha;\n\n    if (feather === 0) {\n      baseAlpha = normalizedDistance <= threshold ? 0 : 1;\n    } else {\n      const distanceFromThreshold = normalizedDistance - threshold;\n\n      if (distanceFromThreshold < -featherRange) {\n        baseAlpha = 0;\n      } else if (distanceFromThreshold > featherRange) {\n        baseAlpha = 1;\n      } else {\n        baseAlpha = (distanceFromThreshold + featherRange) / (featherRange * 2);\n      }\n    }\n\n    if (invert) {\n      baseAlpha = 1 - baseAlpha;\n    }\n\n    alphaMap[i / 4] = Math.round(baseAlpha * 255);\n  }\n  return alphaMap;\n};\n\nimport { Canvas, FabricObject, FabricImage } from 'fabric';\n\nexport const applyMaskToFabricObject = (\n  canvas: Canvas,\n  object: FabricObject,\n  maskCanvas: HTMLCanvasElement,\n) => {\n  if (!(object instanceof FabricImage)) return;\n\n  const imgElement = object.getElement() as HTMLImageElement | HTMLCanvasElement;\n  const width = imgElement.width;\n  const height = imgElement.height;\n\n  const tempCanvas = document.createElement('canvas');\n  tempCanvas.width = width;\n  tempCanvas.height = height;\n  const ctx = tempCanvas.getContext('2d')!;\n\n  // Draw original image\n  ctx.drawImage(imgElement, 0, 0, width, height);\n\n  const imageData = ctx.getImageData(0, 0, width, height);\n  const data = imageData.data;\n\n  const maskCtx = maskCanvas.getContext('2d')!;\n\n  const tempMaskCanvas = document.createElement('canvas');\n  tempMaskCanvas.width = width;\n  tempMaskCanvas.height = height;\n  const tempMaskCtx = tempMaskCanvas.getContext('2d')!;\n  tempMaskCtx.drawImage(maskCanvas, 0, 0, width, height);\n  const maskData = tempMaskCtx.getImageData(0, 0, width, height).data;\n\n  for (let i = 0; i < data.length; i += 4) {\n    const maskVal = maskData[i]; // Red channel\n    data[i + 3] = maskVal;\n  }\n\n  ctx.putImageData(imageData, 0, 0);\n\n  // Create new FabricImage\n  const newImg = new FabricImage(tempCanvas);\n\n  // Copy properties\n  newImg.set({\n    left: object.left,\n    top: object.top,\n    scaleX: object.scaleX,\n    scaleY: object.scaleY,\n    angle: object.angle,\n    skewX: object.skewX,\n    skewY: object.skewY,\n    flipX: object.flipX,\n    flipY: object.flipY,\n    originX: object.originX,\n    originY: object.originY,\n    opacity: object.opacity,\n  });\n\n  // Replace in canvas\n  const index = canvas.getObjects().indexOf(object);\n  canvas.remove(object);\n  canvas.add(newImg);\n  canvas.moveObjectTo(newImg, index);\n  canvas.setActiveObject(newImg);\n  canvas.requestRenderAll();\n};\n\nexport const applyMaskToCanvas = (\n  canvasRef: React.RefObject<HTMLCanvasElement>,\n  maskCanvas: HTMLCanvasElement,\n  history: { push: (img: string, label: string, isSetBase: boolean) => void },\n  label: string = 'Apply Mask',\n) => {\n  if (!canvasRef.current) return;\n\n  const canvas = canvasRef.current;\n  const ctx = canvas.getContext('2d')!;\n  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n  const data = imageData.data;\n\n  const maskCtx = maskCanvas.getContext('2d')!;\n  const maskData = maskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\n\n  for (let i = 0; i < data.length; i += 4) {\n    const maskAlpha = maskData.data[i];\n    data[i + 3] = maskAlpha;\n  }\n\n  ctx.putImageData(imageData, 0, 0);\n  // history.push(canvas.toDataURL(), label, false); // History handling might differ\n};\n","import React, { useEffect, useState, useRef } from 'react';\nimport {\n  Modal,\n  Slider,\n  Radio,\n  Space,\n  Button,\n  Select,\n  InputNumber,\n  Tooltip,\n  ColorPicker,\n} from 'antd';\nimport { UndoOutlined, RedoOutlined, QuestionCircleOutlined } from '@ant-design/icons';\nimport {\n  BrushSettings,\n  drawBrushStroke,\n  drawBrushCursor,\n  getCanvasCoords,\n} from '../utils/brushHelpers';\nimport { calculateColorRemovalAlphaMap } from '../utils/effectsHelpers';\n\nconst { Option } = Select;\n\ntype ColorRemovalModalProps = {\n  open: boolean;\n  onCancel: () => void;\n  onApply: (maskCanvas: HTMLCanvasElement) => void;\n  selectedColor: string | null;\n  sourceCanvas: HTMLCanvasElement | null;\n};\n\nconst ColorRemovalModal: React.FC<ColorRemovalModalProps> = ({\n  open,\n  onCancel,\n  onApply,\n  selectedColor,\n  sourceCanvas,\n}) => {\n  const [tolerance, setTolerance] = useState(30);\n  const [previewMode, setPreviewMode] = useState<'normal' | 'mask'>('normal');\n  const [invert, setInvert] = useState(false);\n  const [feather, setFeather] = useState(0);\n  const [activeColor, setActiveColor] = useState(selectedColor || '#000000');\n  const [isAltPressed, setIsAltPressed] = useState(false);\n\n  useEffect(() => {\n    if (selectedColor) setActiveColor(selectedColor);\n  }, [selectedColor]);\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Alt') setIsAltPressed(true);\n    };\n    const handleKeyUp = (e: KeyboardEvent) => {\n      if (e.key === 'Alt') setIsAltPressed(false);\n    };\n    window.addEventListener('keydown', handleKeyDown);\n    window.addEventListener('keyup', handleKeyUp);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n      window.removeEventListener('keyup', handleKeyUp);\n    };\n  }, []);\n\n  const [brushMode, setBrushMode] = useState<'remove' | 'keep'>('remove');\n  const [brushSize, setBrushSize] = useState(20);\n  const [brushOpacity, setBrushOpacity] = useState(1);\n  const [brushType, setBrushType] = useState<'hard' | 'soft'>('hard');\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [cursorPos, setCursorPos] = useState<{ x: number; y: number } | null>(null);\n  const [previewColor, setPreviewColor] = useState<string | null>(null);\n  const [displayParams, setDisplayParams] = useState({ scale: 1, x: 0, y: 0 });\n\n  const containerRef = useRef<HTMLDivElement>(null);\n  const previewCanvasRef = useRef<HTMLCanvasElement>(null);\n  const maskCanvasRef = useRef<HTMLCanvasElement>(null);\n  const overlayCanvasRef = useRef<HTMLCanvasElement>(null);\n  const drawPoints = useRef<{ x: number; y: number }[]>([]);\n  const lastDrawPoint = useRef<{ x: number; y: number } | null>(null);\n\n  const [history, setHistory] = useState<ImageData[]>([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n\n  useEffect(() => {\n    if (\n      open &&\n      sourceCanvas &&\n      previewCanvasRef.current &&\n      maskCanvasRef.current &&\n      overlayCanvasRef.current &&\n      containerRef.current\n    ) {\n      const w = sourceCanvas.width;\n      const h = sourceCanvas.height;\n      const container = containerRef.current;\n      const { clientWidth: cw, clientHeight: ch } = container;\n\n      // Calculate scale to fit image in container\n      const scale = Math.min(cw / w, ch / h);\n      const displayW = w * scale;\n      const displayH = h * scale;\n      const displayX = (cw - displayW) / 2;\n      const displayY = (ch - displayH) / 2;\n\n      setDisplayParams({ scale, x: displayX, y: displayY });\n\n      previewCanvasRef.current.width = w;\n      previewCanvasRef.current.height = h;\n      maskCanvasRef.current.width = w;\n      maskCanvasRef.current.height = h;\n\n      // Overlay canvas matches container size (screen pixels)\n      overlayCanvasRef.current.width = cw;\n      overlayCanvasRef.current.height = ch;\n\n      const ctx = previewCanvasRef.current.getContext('2d')!;\n      ctx.drawImage(sourceCanvas, 0, 0);\n\n      const maskCtx = maskCanvasRef.current.getContext('2d')!;\n      maskCtx.fillStyle = 'white';\n      maskCtx.fillRect(0, 0, w, h);\n\n      saveHistory();\n    }\n  }, [open, sourceCanvas]);\n\n  const saveHistory = () => {\n    if (!maskCanvasRef.current) return;\n    const ctx = maskCanvasRef.current.getContext('2d')!;\n    const data = ctx.getImageData(0, 0, maskCanvasRef.current.width, maskCanvasRef.current.height);\n    const newHistory = history.slice(0, historyIndex + 1);\n    newHistory.push(data);\n    setHistory(newHistory);\n    setHistoryIndex(newHistory.length - 1);\n  };\n\n  const undo = () => {\n    if (historyIndex > 0) {\n      const newIndex = historyIndex - 1;\n      const data = history[newIndex];\n      const ctx = maskCanvasRef.current!.getContext('2d')!;\n      ctx.putImageData(data, 0, 0);\n      setHistoryIndex(newIndex);\n      updatePreview();\n    }\n  };\n\n  const redo = () => {\n    if (historyIndex < history.length - 1) {\n      const newIndex = historyIndex + 1;\n      const data = history[newIndex];\n      const ctx = maskCanvasRef.current!.getContext('2d')!;\n      ctx.putImageData(data, 0, 0);\n      setHistoryIndex(newIndex);\n      updatePreview();\n    }\n  };\n\n  const updatePreview = () => {\n    if (!sourceCanvas || !previewCanvasRef.current || !maskCanvasRef.current) return;\n\n    const w = sourceCanvas.width;\n    const h = sourceCanvas.height;\n    const ctx = previewCanvasRef.current.getContext('2d')!;\n    const maskCtx = maskCanvasRef.current.getContext('2d')!;\n\n    // 1. Draw original image\n    ctx.clearRect(0, 0, w, h);\n    ctx.drawImage(sourceCanvas, 0, 0);\n\n    // 2. Calculate auto-mask from color\n    const imageData = ctx.getImageData(0, 0, w, h);\n    const alphaMap = calculateColorRemovalAlphaMap(\n      imageData.data,\n      activeColor,\n      tolerance,\n      invert,\n      feather,\n    );\n\n    // 3. Combine with manual mask\n    const manualMaskData = maskCtx.getImageData(0, 0, w, h);\n    const finalImageData = ctx.createImageData(w, h);\n\n    for (let i = 0; i < w * h; i++) {\n      const r = imageData.data[i * 4];\n      const g = imageData.data[i * 4 + 1];\n      const b = imageData.data[i * 4 + 2];\n      const a = imageData.data[i * 4 + 3];\n\n      const autoAlpha = alphaMap[i];\n      const manualAlpha = manualMaskData.data[i * 4]; // Red channel of white mask\n\n      // Combine alphas (multiply)\n      const finalAlpha = a * (autoAlpha / 255) * (manualAlpha / 255);\n\n      finalImageData.data[i * 4] = r;\n      finalImageData.data[i * 4 + 1] = g;\n      finalImageData.data[i * 4 + 2] = b;\n      finalImageData.data[i * 4 + 3] = finalAlpha;\n    }\n\n    if (previewMode === 'mask') {\n      // Draw mask only (black and white)\n      for (let i = 0; i < w * h; i++) {\n        const alpha = finalImageData.data[i * 4 + 3];\n        finalImageData.data[i * 4] = alpha;\n        finalImageData.data[i * 4 + 1] = alpha;\n        finalImageData.data[i * 4 + 2] = alpha;\n        finalImageData.data[i * 4 + 3] = 255;\n      }\n    }\n\n    ctx.putImageData(finalImageData, 0, 0);\n  };\n\n  useEffect(() => {\n    updatePreview();\n  }, [tolerance, invert, feather, activeColor, previewMode, historyIndex]);\n\n  const pickColor = (e: React.MouseEvent) => {\n    if (!sourceCanvas || !overlayCanvasRef.current) return;\n    const coords = getCanvasCoords(e, overlayCanvasRef, displayParams.scale, {\n      x: displayParams.x,\n      y: displayParams.y,\n    });\n    if (coords) {\n      const ctx = sourceCanvas.getContext('2d');\n      if (!ctx) return;\n      const x = Math.max(0, Math.min(coords.x, sourceCanvas.width - 1));\n      const y = Math.max(0, Math.min(coords.y, sourceCanvas.height - 1));\n      const pixel = ctx.getImageData(x, y, 1, 1).data;\n      const hex =\n        '#' + [pixel[0], pixel[1], pixel[2]].map((x) => x.toString(16).padStart(2, '0')).join('');\n      setActiveColor(hex);\n    }\n  };\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    if (isAltPressed) {\n      pickColor(e);\n      return;\n    }\n    setIsDrawing(true);\n    const coords = getCanvasCoords(e, overlayCanvasRef, displayParams.scale, {\n      x: displayParams.x,\n      y: displayParams.y,\n    });\n    if (coords) {\n      drawPoints.current = [coords];\n      lastDrawPoint.current = coords;\n      draw([coords]);\n    }\n  };\n\n  const handleMouseMove = (e: React.MouseEvent) => {\n    const coords = getCanvasCoords(e, overlayCanvasRef, displayParams.scale, {\n      x: displayParams.x,\n      y: displayParams.y,\n    });\n    setCursorPos(coords);\n\n    // when alt is pressed, sample color under cursor and show preview\n    if (isAltPressed && coords && sourceCanvas) {\n      try {\n        const ctx = sourceCanvas.getContext('2d');\n        if (ctx) {\n          const x = Math.max(0, Math.min(coords.x, sourceCanvas.width - 1));\n          const y = Math.max(0, Math.min(coords.y, sourceCanvas.height - 1));\n          const pixel = ctx.getImageData(x, y, 1, 1).data;\n          const hex =\n            '#' +\n            [pixel[0], pixel[1], pixel[2]].map((v) => v.toString(16).padStart(2, '0')).join('');\n          setPreviewColor(hex);\n        }\n      } catch (err) {\n        setPreviewColor(null);\n      }\n    } else {\n      setPreviewColor(null);\n    }\n\n    if (isAltPressed) return;\n\n    if (isDrawing && coords && lastDrawPoint.current) {\n      drawPoints.current.push(coords);\n      draw([lastDrawPoint.current, coords]);\n      lastDrawPoint.current = coords;\n    }\n  };\n\n  const handleMouseUp = () => {\n    if (isDrawing) {\n      setIsDrawing(false);\n      drawPoints.current = [];\n      lastDrawPoint.current = null;\n      saveHistory();\n      updatePreview();\n    }\n  };\n\n  const draw = (points: { x: number; y: number }[]) => {\n    if (!maskCanvasRef.current) return;\n    const ctx = maskCanvasRef.current.getContext('2d')!;\n\n    const settings: BrushSettings = {\n      color: brushMode === 'remove' ? '#000000' : '#ffffff',\n      lineWidth: brushSize,\n      opacity: brushOpacity,\n      flow: 1,\n      type: brushType,\n    };\n\n    drawBrushStroke(ctx, points, settings);\n\n    // Update preview immediately for better feedback\n    updatePreview();\n  };\n\n  // Draw cursor\n  useEffect(() => {\n    if (!overlayCanvasRef.current || !cursorPos) return;\n    const ctx = overlayCanvasRef.current.getContext('2d')!;\n    ctx.clearRect(0, 0, overlayCanvasRef.current.width, overlayCanvasRef.current.height);\n\n    const screenX = cursorPos.x * displayParams.scale + displayParams.x;\n    const screenY = cursorPos.y * displayParams.scale + displayParams.y;\n    const screenSize = brushSize * displayParams.scale;\n\n    // draw brush cursor\n    drawBrushCursor(ctx, screenX, screenY, screenSize, '#fff');\n    drawBrushCursor(ctx, screenX, screenY, screenSize, '#000'); // Double outline for visibility\n\n    // draw live color preview when alt is pressed\n    if (isAltPressed && previewColor) {\n      const previewRadius = 9;\n      const offset = 12; // offset so preview doesn't sit under cursor\n      const px = Math.min(\n        overlayCanvasRef.current.width - previewRadius - 4,\n        Math.max(previewRadius + 4, screenX + offset),\n      );\n      const py = Math.min(\n        overlayCanvasRef.current.height - previewRadius - 4,\n        Math.max(previewRadius + 4, screenY + offset),\n      );\n\n      // outer border\n      ctx.beginPath();\n      ctx.arc(px, py, previewRadius + 2, 0, Math.PI * 2);\n      ctx.fillStyle = '#00000088';\n      ctx.fill();\n\n      // color circle\n      ctx.beginPath();\n      ctx.arc(px, py, previewRadius, 0, Math.PI * 2);\n      ctx.fillStyle = previewColor;\n      ctx.fill();\n\n      // hex label\n      ctx.font = '12px sans-serif';\n      ctx.fillStyle = '#fff';\n      ctx.textAlign = 'center';\n      ctx.fillText(previewColor.toUpperCase(), px, py + previewRadius + 14);\n    }\n  }, [cursorPos, brushSize, displayParams, isAltPressed, previewColor]);\n\n  const handleApply = () => {\n    if (previewCanvasRef.current) {\n      onApply(previewCanvasRef.current);\n    }\n  };\n\n  return (\n    <Modal\n      title=\"Mask\"\n      open={open}\n      onCancel={onCancel}\n      onOk={handleApply}\n      width={1000}\n      style={{ top: 20 }}\n      maskClosable={false}\n    >\n      <div style={{ display: 'flex', gap: 16 }}>\n        <div style={{ width: 300 }}>\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\n            <div>\n              <span>Target Color:</span>\n              <ColorPicker\n                value={activeColor}\n                onChange={(c) => setActiveColor(c.toHexString())}\n                showText\n              />\n              <div style={{ fontSize: 12, color: '#999', marginTop: 4 }}>\n                Hold Alt + Click on image to pick color\n              </div>\n            </div>\n            <div>\n              <span>Tolerance: {tolerance}%</span>\n              <Slider value={tolerance} onChange={setTolerance} />\n            </div>\n            <div>\n              <span>Feather: {feather}%</span>\n              <Slider value={feather} onChange={setFeather} />\n            </div>\n            <div>\n              <Space>\n                <span>Invert:</span>\n                <Button onClick={() => setInvert(!invert)} type={invert ? 'primary' : 'default'}>\n                  {invert ? 'Yes' : 'No'}\n                </Button>\n              </Space>\n            </div>\n            <div>\n              <span>Preview Mode:</span>\n              <Radio.Group value={previewMode} onChange={(e) => setPreviewMode(e.target.value)}>\n                <Radio.Button value=\"normal\">Normal</Radio.Button>\n                <Radio.Button value=\"mask\">Mask</Radio.Button>\n              </Radio.Group>\n            </div>\n\n            <div style={{ borderTop: '1px solid #eee', paddingTop: 16, marginTop: 16 }}>\n              <h4>Manual Adjustments</h4>\n              <Space>\n                <Button\n                  type={brushMode === 'remove' ? 'primary' : 'default'}\n                  onClick={() => setBrushMode('remove')}\n                >\n                  Remove\n                </Button>\n                <Button\n                  type={brushMode === 'keep' ? 'primary' : 'default'}\n                  onClick={() => setBrushMode('keep')}\n                >\n                  Keep\n                </Button>\n              </Space>\n              <div>\n                <span>Size: {brushSize}</span>\n                <Slider min={1} max={100} value={brushSize} onChange={setBrushSize} />\n              </div>\n              <div>\n                <span>Opacity: {brushOpacity}</span>\n                <Slider\n                  min={0}\n                  max={1}\n                  step={0.1}\n                  value={brushOpacity}\n                  onChange={setBrushOpacity}\n                />\n              </div>\n              <div>\n                <span>Hardness:</span>\n                <Radio.Group value={brushType} onChange={(e) => setBrushType(e.target.value)}>\n                  <Radio.Button value=\"hard\">Hard</Radio.Button>\n                  <Radio.Button value=\"soft\">Soft</Radio.Button>\n                </Radio.Group>\n              </div>\n            </div>\n\n            <Space>\n              <Button icon={<UndoOutlined />} onClick={undo} disabled={historyIndex <= 0} />\n              <Button\n                icon={<RedoOutlined />}\n                onClick={redo}\n                disabled={historyIndex >= history.length - 1}\n              />\n            </Space>\n          </Space>\n        </div>\n\n        <div\n          ref={containerRef}\n          style={{\n            flex: 1,\n            position: 'relative',\n            border: '1px solid #ccc',\n            height: 500,\n            overflow: 'hidden',\n            background:\n              'url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==)',\n          }}\n        >\n          <canvas\n            ref={previewCanvasRef}\n            style={{\n              position: 'absolute',\n              top: displayParams.y,\n              left: displayParams.x,\n              width: displayParams.scale * (sourceCanvas?.width || 0),\n              height: displayParams.scale * (sourceCanvas?.height || 0),\n            }}\n          />\n          <canvas\n            ref={overlayCanvasRef}\n            style={{\n              position: 'absolute',\n              top: 0,\n              left: 0,\n              width: '100%',\n              height: '100%',\n              cursor: isAltPressed ? 'crosshair' : 'none',\n            }}\n            onMouseDown={handleMouseDown}\n            onMouseMove={handleMouseMove}\n            onMouseUp={handleMouseUp}\n            onMouseLeave={handleMouseUp}\n          />\n          {/* Hidden mask canvas */}\n          <canvas ref={maskCanvasRef} style={{ display: 'none' }} />\n        </div>\n      </div>\n    </Modal>\n  );\n};\n\nexport default ColorRemovalModal;\n","import React from 'react';\nimport { List, Card, Button, Popconfirm, Image, Typography } from 'antd';\nimport { DeleteOutlined, FolderOpenOutlined } from '@ant-design/icons';\nimport { SavedProject } from '../types';\n\ninterface SavedProjectsListProps {\n  projects: SavedProject[];\n  onLoad: (project: SavedProject) => void;\n  onDelete: (id: string) => void;\n}\n\nconst SavedProjectsList: React.FC<SavedProjectsListProps> = ({ projects, onLoad, onDelete }) => {\n  if (projects.length === 0) {\n    return (\n      <div style={{ textAlign: 'center', padding: '20px' }}>\n        <Typography.Text type=\"secondary\">No saved projects found.</Typography.Text>\n      </div>\n    );\n  }\n\n  return (\n    <List\n      grid={{ gutter: 16, column: 3 }}\n      dataSource={projects}\n      renderItem={(item) => (\n        <List.Item>\n          <Card\n            hoverable\n            cover={\n              <div\n                style={{\n                  height: 150,\n                  overflow: 'hidden',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  background: '#f0f0f0',\n                }}\n              >\n                <Image\n                  src={item.thumbnail}\n                  preview={false}\n                  style={{ maxHeight: '100%', maxWidth: '100%', objectFit: 'contain' }}\n                />\n              </div>\n            }\n            onClick={() => onLoad(item)}\n            actions={[\n              <Popconfirm\n                title=\"Delete project?\"\n                onConfirm={() => {\n                  onDelete(item.id);\n                }}\n                okText=\"Yes\"\n                cancelText=\"No\"\n              >\n                <Button\n                  type=\"text\"\n                  danger\n                  icon={<DeleteOutlined />}\n                  onClick={(e) => e.stopPropagation()}\n                >\n                  Delete\n                </Button>\n              </Popconfirm>,\n            ]}\n          >\n            <Card.Meta title={item.name} description={new Date(item.updatedAt).toLocaleString()} />\n          </Card>\n        </List.Item>\n      )}\n    />\n  );\n};\n\nexport default SavedProjectsList;\n","import React from 'react';\nimport { Modal } from 'antd';\nimport { SavedProject } from '../types';\nimport SavedProjectsList from './SavedProjectsList';\n\ninterface ProjectModalProps {\n  visible: boolean;\n  onCancel: () => void;\n  projects: SavedProject[];\n  onLoad: (project: SavedProject) => void;\n  onDelete: (id: string) => void;\n}\n\nconst ProjectModal: React.FC<ProjectModalProps> = ({\n  visible,\n  onCancel,\n  projects,\n  onLoad,\n  onDelete,\n}) => {\n  return (\n    <Modal title=\"Saved Projects\" open={visible} onCancel={onCancel} footer={null} width={800}>\n      <SavedProjectsList projects={projects} onLoad={onLoad} onDelete={onDelete} />\n    </Modal>\n  );\n};\n\nexport default ProjectModal;\n","import { SavedProject } from '../types';\n\nconst DB_NAME = 'PhotoEditorDB';\nconst DB_VERSION = 1;\nconst STORE_PROJECTS = 'projects';\n\nexport const initDB = (): Promise<IDBDatabase> => {\n  return new Promise((resolve, reject) => {\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\n\n    request.onerror = () => {\n      reject('Error opening database');\n    };\n\n    request.onsuccess = (event) => {\n      resolve((event.target as IDBOpenDBRequest).result);\n    };\n\n    request.onupgradeneeded = (event) => {\n      const db = (event.target as IDBOpenDBRequest).result;\n      if (!db.objectStoreNames.contains(STORE_PROJECTS)) {\n        db.createObjectStore(STORE_PROJECTS, { keyPath: 'id' });\n      }\n    };\n  });\n};\n\nexport const saveProjectToDB = async (project: SavedProject): Promise<void> => {\n  const db = await initDB();\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction([STORE_PROJECTS], 'readwrite');\n    const store = transaction.objectStore(STORE_PROJECTS);\n    const request = store.put(project);\n\n    request.onsuccess = () => resolve();\n    request.onerror = () => reject('Error saving project');\n  });\n};\n\nexport const getAllProjectsFromDB = async (): Promise<SavedProject[]> => {\n  const db = await initDB();\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction([STORE_PROJECTS], 'readonly');\n    const store = transaction.objectStore(STORE_PROJECTS);\n    const request = store.getAll();\n\n    request.onsuccess = () => {\n      const projects = request.result as SavedProject[];\n      // Sort by updatedAt desc\n      projects.sort((a, b) => b.updatedAt - a.updatedAt);\n      resolve(projects);\n    };\n    request.onerror = () => reject('Error fetching projects');\n  });\n};\n\nexport const deleteProjectFromDB = async (id: string): Promise<void> => {\n  const db = await initDB();\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction([STORE_PROJECTS], 'readwrite');\n    const store = transaction.objectStore(STORE_PROJECTS);\n    const request = store.delete(id);\n\n    request.onsuccess = () => resolve();\n    request.onerror = () => reject('Error deleting project');\n  });\n};\n","import { useState, useEffect, useCallback } from 'react';\nimport { message } from 'antd';\nimport { SavedProject } from '../types';\nimport { getAllProjectsFromDB, saveProjectToDB, deleteProjectFromDB } from '../utils/storage';\n\nexport const useProjects = () => {\n  const [savedProjects, setSavedProjects] = useState<SavedProject[]>([]);\n  const [currentProject, setCurrentProject] = useState<SavedProject | null>(null);\n\n  const loadProjects = useCallback(() => {\n    getAllProjectsFromDB()\n      .then(setSavedProjects)\n      .catch((err) => console.error('Failed to load projects from DB', err));\n  }, []);\n\n  useEffect(() => {\n    loadProjects();\n  }, [loadProjects]);\n\n  const saveProject = useCallback(\n    async (preview: string, json: any) => {\n      if (!preview) return;\n\n      const newProject: SavedProject = {\n        id: currentProject?.id || Date.now().toString(),\n        name: currentProject?.name || `Project ${new Date().toLocaleString()}`,\n        thumbnail: preview,\n        json: json,\n        createdAt: currentProject?.createdAt || Date.now(),\n        updatedAt: Date.now(),\n      };\n\n      try {\n        await saveProjectToDB(newProject);\n\n        // Update local state\n        setSavedProjects((prev) => {\n          const exists = prev.some((p) => p.id === newProject.id);\n          const updated = exists\n            ? prev.map((p) => (p.id === newProject.id ? newProject : p))\n            : [newProject, ...prev];\n\n          // Sort by updatedAt desc\n          return updated.sort((a, b) => b.updatedAt - a.updatedAt);\n        });\n\n        setCurrentProject(newProject);\n        message.success('Project saved successfully!');\n      } catch (err) {\n        console.error(err);\n        message.error('Failed to save project');\n      }\n    },\n    [currentProject],\n  );\n\n  const deleteProject = useCallback(async (id: string) => {\n    try {\n      await deleteProjectFromDB(id);\n      setSavedProjects((prev) => prev.filter((p) => p.id !== id));\n      // If the deleted project is currently loaded, clear it so editor doesn't reference it\n      setCurrentProject((cur) => (cur && cur.id === id ? null : cur));\n      message.success('Project deleted');\n    } catch (err) {\n      console.error(err);\n      message.error('Failed to delete project');\n    }\n  }, []);\n\n  const loadProjectIntoEditor = useCallback((project: SavedProject) => {\n    setCurrentProject(project);\n  }, []);\n\n  const clearCurrentProject = useCallback(() => {\n    setCurrentProject(null);\n  }, []);\n\n  return {\n    savedProjects,\n    currentProject,\n    loadProjects,\n    saveProject,\n    deleteProject,\n    loadProjectIntoEditor,\n    clearCurrentProject,\n    setCurrentProject,\n  };\n};\n","import React, { useEffect, useState } from 'react';\nimport { Button, Tooltip, Space, Divider, Dropdown, Menu } from 'antd';\nimport {\n  DragOutlined,\n  BorderOutlined,\n  PlusCircleOutlined,\n  FontSizeOutlined,\n  FileImageOutlined,\n  DeleteOutlined,\n  UndoOutlined,\n  RedoOutlined,\n  HighlightOutlined,\n  ExportOutlined,\n  ScissorOutlined,\n  BgColorsOutlined,\n  CopyOutlined,\n  SnippetsOutlined,\n  SaveOutlined,\n  FolderOpenOutlined,\n  MoreOutlined,\n  UploadOutlined,\n} from '@ant-design/icons';\nimport { Rect, Circle, IText, FabricImage, ActiveSelection } from 'fabric';\nimport { usePhotoEditor } from '../context';\nimport ExportModal from './ExportModal';\nimport LayerMaskModal from './LayerMaskModal';\nimport ProjectModal from './ProjectModal';\nimport { useProjects } from '../hooks/useProjects';\nimport { applyMaskToFabricObject } from '../utils/effectsHelpers';\n\nconst Toolbar: React.FC = () => {\n  const { canvas, setActiveTool, activeTool, history, selectedObject, clipboard, setClipboard } =\n    usePhotoEditor();\n  const [exportModalVisible, setExportModalVisible] = useState(false);\n  const [maskModalVisible, setMaskModalVisible] = useState(false);\n  const [projectModalVisible, setProjectModalVisible] = useState(false);\n\n  const {\n    savedProjects,\n    saveProject,\n    deleteProject,\n    loadProjects,\n    loadProjectIntoEditor,\n    clearCurrentProject,\n  } = useProjects();\n\n  const handleSaveProject = () => {\n    if (!canvas) return;\n    const json = canvas.toJSON();\n    const preview = canvas.toDataURL({ format: 'png', multiplier: 0.5 });\n    saveProject(preview, json);\n  };\n\n  const handleLoadProject = (project: any) => {\n    if (!canvas) return;\n    canvas.loadFromJSON(project.json).then(() => {\n      canvas.renderAll();\n      // mark the project as current so saving will overwrite\n      loadProjectIntoEditor(project);\n      setProjectModalVisible(false);\n      history.saveState();\n    });\n  };\n\n  const newProject = () => {\n    if (!canvas) return;\n    // clear canvas and reset state\n    canvas.discardActiveObject();\n    canvas.clear();\n    // ensure any background or options are reset if needed (left minimal)\n    history.saveState();\n    clearCurrentProject();\n  };\n\n  const copy = async () => {\n    if (!canvas) return;\n    const activeObject = canvas.getActiveObject();\n    if (activeObject) {\n      const cloned = await activeObject.clone();\n      setClipboard(cloned);\n    }\n  };\n\n  const paste = async () => {\n    if (!canvas || !clipboard) return;\n    const clonedObj = await clipboard.clone();\n    canvas.discardActiveObject();\n\n    clonedObj.set({\n      left: (clonedObj.left || 0) + 10,\n      top: (clonedObj.top || 0) + 10,\n      evented: true,\n    });\n\n    if (clonedObj instanceof ActiveSelection) {\n      // active selection needs a reference to the canvas.\n      clonedObj.canvas = canvas;\n      clonedObj.forEachObject((obj) => {\n        canvas.add(obj);\n      });\n      clonedObj.setCoords();\n    } else {\n      canvas.add(clonedObj);\n    }\n\n    canvas.setActiveObject(clonedObj);\n    canvas.requestRenderAll();\n    history.saveState();\n  };\n\n  const handleImportProjectFile = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!canvas) return;\n    const file = e.target.files && e.target.files[0];\n    if (!file) return;\n\n    const reader = new FileReader();\n    reader.onload = (ev) => {\n      try {\n        const text = ev.target?.result as string;\n        const json = JSON.parse(text);\n        canvas.loadFromJSON(json, () => {\n          canvas.renderAll();\n          history.saveState();\n        });\n      } catch (err) {\n        // eslint-disable-next-line no-console\n        console.error('Failed to import project JSON', err);\n        // message could be used but importing antd here would duplicate import; use alert as fallback\n        // If you prefer antd message, we can import it at top.\n        alert('Failed to import project file. Make sure it is a valid project JSON.');\n      }\n    };\n    reader.readAsText(file);\n    // reset input so same file can be re-imported if needed\n    e.currentTarget.value = '';\n  };\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Ignore if typing in an input or textarea\n      if (\n        (e.target as HTMLElement).tagName === 'INPUT' ||\n        (e.target as HTMLElement).tagName === 'TEXTAREA'\n      ) {\n        return;\n      }\n\n      // Ignore if editing text on canvas\n      if (\n        canvas?.getActiveObject() instanceof IText &&\n        (canvas.getActiveObject() as IText).isEditing\n      ) {\n        return;\n      }\n\n      if (e.key === 'v' || e.key === 'V') setActiveTool('select');\n      if (e.key === 'b' || e.key === 'B') setActiveTool('brush');\n      if (e.key === 'm' || e.key === 'M') {\n        if (selectedObject instanceof FabricImage) setMaskModalVisible(true);\n      }\n      if (e.key === 'r' || e.key === 'R') addRectangle();\n      if (e.key === 't' || e.key === 'T') setActiveTool('text');\n\n      if (e.key === 'Delete' || e.key === 'Backspace') deleteSelected();\n\n      if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\n        e.preventDefault();\n        if (e.shiftKey) {\n          history.redo();\n        } else {\n          history.undo();\n        }\n      }\n      if ((e.ctrlKey || e.metaKey) && e.key === 'y') {\n        e.preventDefault();\n        history.redo();\n      }\n\n      if ((e.ctrlKey || e.metaKey) && e.key === 'c') {\n        e.preventDefault();\n        copy();\n      }\n\n      if ((e.ctrlKey || e.metaKey) && e.key === 'v') {\n        e.preventDefault();\n        paste();\n      }\n\n      if ((e.ctrlKey || e.metaKey) && e.key === 's') {\n        e.preventDefault();\n        handleSaveProject();\n      }\n\n      if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'S') {\n        e.preventDefault();\n        setExportModalVisible(true);\n      }\n\n      if ((e.ctrlKey || e.metaKey) && e.key === 'n') {\n        e.preventDefault();\n        newProject();\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [canvas, selectedObject, history, activeTool, clipboard]);\n\n  const addRectangle = () => {\n    if (!canvas) return;\n    const rect = new Rect({\n      left: 100,\n      top: 100,\n      fill: '#ff0000',\n      width: 100,\n      height: 100,\n    });\n    canvas.add(rect);\n    canvas.setActiveObject(rect);\n    history.saveState();\n  };\n\n  const addCircle = () => {\n    if (!canvas) return;\n    const circle = new Circle({\n      left: 100,\n      top: 100,\n      fill: '#00ff00',\n      radius: 50,\n    });\n    canvas.add(circle);\n    canvas.setActiveObject(circle);\n    history.saveState();\n  };\n\n  const addText = () => {\n    if (!canvas) return;\n    const text = new IText('Text', {\n      left: 100,\n      top: 100,\n      fontSize: 24,\n    });\n    canvas.add(text);\n    canvas.setActiveObject(text);\n    setActiveTool('text');\n    history.saveState();\n  };\n\n  const handleImageUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!canvas || !e.target.files || !e.target.files[0]) return;\n    const file = e.target.files[0];\n    const reader = new FileReader();\n    reader.onload = (f) => {\n      const data = f.target?.result as string;\n      FabricImage.fromURL(data).then((img) => {\n        img.scaleToWidth(200);\n        canvas.add(img);\n        canvas.centerObject(img);\n        canvas.setActiveObject(img);\n        history.saveState();\n      });\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const deleteSelected = () => {\n    if (!canvas) return;\n    const activeObjects = canvas.getActiveObjects();\n    if (activeObjects.length) {\n      canvas.discardActiveObject();\n      activeObjects.forEach((obj) => {\n        canvas.remove(obj);\n      });\n      history.saveState();\n    }\n  };\n\n  const handleApplyMask = (maskCanvas: HTMLCanvasElement) => {\n    if (!canvas || !selectedObject) return;\n    applyMaskToFabricObject(canvas, selectedObject, maskCanvas);\n    history.saveState();\n    setMaskModalVisible(false);\n  };\n\n  const getSelectedImageCanvas = (): HTMLCanvasElement | null => {\n    if (!selectedObject || !(selectedObject instanceof FabricImage)) return null;\n    const imgElement = selectedObject.getElement() as HTMLImageElement | HTMLCanvasElement;\n    const tempCanvas = document.createElement('canvas');\n    tempCanvas.width = imgElement.width;\n    tempCanvas.height = imgElement.height;\n    const ctx = tempCanvas.getContext('2d');\n    if (ctx) {\n      ctx.drawImage(imgElement, 0, 0);\n    }\n    return tempCanvas;\n  };\n\n  const isImageSelected = selectedObject instanceof FabricImage;\n\n  return (\n    <Space direction=\"vertical\" style={{ padding: '8px' }}>\n      <Tooltip title=\"Select (V)\">\n        <Button\n          type={activeTool === 'select' ? 'primary' : 'default'}\n          icon={<DragOutlined />}\n          onClick={() => setActiveTool('select')}\n        />\n      </Tooltip>\n      <Tooltip title=\"Brush (B)\">\n        <Button\n          type={activeTool === 'brush' ? 'primary' : 'default'}\n          icon={<HighlightOutlined />}\n          onClick={() => setActiveTool('brush')}\n        />\n      </Tooltip>\n      <Tooltip title=\"Rectangle (R)\">\n        <Button icon={<BorderOutlined />} onClick={addRectangle} />\n      </Tooltip>\n      <Tooltip title=\"Circle (C)\">\n        <Button icon={<PlusCircleOutlined />} onClick={addCircle} />\n      </Tooltip>\n      <Tooltip title=\"Text (T)\">\n        <Button\n          type={activeTool === 'text' ? 'primary' : 'default'}\n          icon={<FontSizeOutlined />}\n          onClick={() => setActiveTool('text')}\n        />\n      </Tooltip>\n\n      <input type=\"file\" id=\"image-upload\" hidden accept=\"image/*\" onChange={handleImageUpload} />\n      <input\n        type=\"file\"\n        id=\"project-import\"\n        hidden\n        accept=\"application/json, .json\"\n        onChange={handleImportProjectFile}\n      />\n\n      <Divider style={{ margin: '8px 0' }} />\n\n      <Tooltip title=\"Mask (M)\">\n        <Button\n          icon={<ScissorOutlined />}\n          onClick={() => setMaskModalVisible(true)}\n          disabled={!isImageSelected}\n        />\n      </Tooltip>\n\n      <Divider style={{ margin: '8px 0' }} />\n\n      <Tooltip title=\"Undo (Ctrl+Z)\">\n        <Button icon={<UndoOutlined />} onClick={history.undo} disabled={!history.canUndo} />\n      </Tooltip>\n      <Tooltip title=\"Redo (Ctrl+Y)\">\n        <Button icon={<RedoOutlined />} onClick={history.redo} disabled={!history.canRedo} />\n      </Tooltip>\n\n      <Divider style={{ margin: '8px 0' }} />\n\n      <Dropdown\n        overlay={\n          <Menu>\n            <Menu.Item\n              key=\"upload\"\n              icon={<FileImageOutlined />}\n              onClick={() => document.getElementById('image-upload')?.click()}\n            >\n              Upload Image\n            </Menu.Item>\n            <Menu.Item key=\"copy\" icon={<CopyOutlined />} onClick={copy} disabled={!selectedObject}>\n              Copy (Ctrl + C)\n            </Menu.Item>\n            <Menu.Item\n              key=\"paste\"\n              icon={<SnippetsOutlined />}\n              onClick={paste}\n              disabled={!clipboard}\n            >\n              Paste (Ctrl + V)\n            </Menu.Item>\n            <Menu.Divider />\n            <Menu.Item key=\"new\" icon={<FileImageOutlined />} onClick={newProject}>\n              New Project (Ctrl + N)\n            </Menu.Item>\n            <Menu.Item key=\"save\" icon={<SaveOutlined />} onClick={handleSaveProject}>\n              Save Project (Ctrl + S)\n            </Menu.Item>\n            <Menu.Item\n              key=\"open\"\n              icon={<FolderOpenOutlined />}\n              onClick={() => setProjectModalVisible(true)}\n            >\n              Open Projects\n            </Menu.Item>\n            <Menu.Item\n              key=\"import\"\n              icon={<UploadOutlined />}\n              onClick={() => document.getElementById('project-import')?.click()}\n            >\n              Import Project (JSON)\n            </Menu.Item>\n            <Menu.Item\n              key=\"export\"\n              icon={<ExportOutlined />}\n              onClick={() => setExportModalVisible(true)}\n            >\n              Export (Ctrl + Shift + S)\n            </Menu.Item>\n          </Menu>\n        }\n        trigger={['click']}\n      >\n        <Tooltip title=\"More\">\n          <Button icon={<MoreOutlined />}></Button>\n        </Tooltip>\n      </Dropdown>\n\n      <ExportModal\n        visible={exportModalVisible}\n        onCancel={() => setExportModalVisible(false)}\n        canvas={canvas}\n      />\n\n      {maskModalVisible && isImageSelected && (\n        <LayerMaskModal\n          open={maskModalVisible}\n          onCancel={() => setMaskModalVisible(false)}\n          onApply={handleApplyMask}\n          sourceCanvas={getSelectedImageCanvas()}\n          selectedColor={null}\n        />\n      )}\n\n      <ProjectModal\n        visible={projectModalVisible}\n        onCancel={() => setProjectModalVisible(false)}\n        projects={savedProjects}\n        onLoad={handleLoadProject}\n        onDelete={deleteProject}\n      />\n    </Space>\n  );\n};\n\nexport default Toolbar;\n","import { useEffect, useRef } from 'react';\nimport { Canvas, FabricObject } from 'fabric';\n\nexport const useKeyboardShortcuts = (canvas: Canvas | null) => {\n  const clipboard = useRef<FabricObject | null>(null);\n\n  useEffect(() => {\n    if (!canvas) return;\n\n    const handleKeyDown = async (e: KeyboardEvent) => {\n      // Copy\n      if ((e.ctrlKey || e.metaKey) && e.key === 'c') {\n        const activeObject = canvas.getActiveObject();\n        if (activeObject) {\n          const cloned = await activeObject.clone();\n          clipboard.current = cloned;\n        }\n      }\n\n      // Paste\n      if ((e.ctrlKey || e.metaKey) && e.key === 'v') {\n        if (clipboard.current) {\n          const clonedObj = await clipboard.current.clone();\n          canvas.discardActiveObject();\n\n          clonedObj.set({\n            left: (clonedObj.left || 0) + 10,\n            top: (clonedObj.top || 0) + 10,\n            evented: true,\n          });\n\n          if (clonedObj.type === 'activeSelection') {\n            // active selection needs a reference to the canvas.\n            clonedObj.canvas = canvas;\n            (clonedObj as any).forEachObject((obj: any) => {\n              canvas.add(obj);\n            });\n            clonedObj.setCoords();\n          } else {\n            canvas.add(clonedObj);\n          }\n\n          clipboard.current = clonedObj; // Update clipboard to allow multiple pastes with offset\n          canvas.setActiveObject(clonedObj);\n          canvas.requestRenderAll();\n        }\n      }\n\n      // Brush Size\n      if (canvas.isDrawingMode && canvas.freeDrawingBrush) {\n        if (e.key === '[') {\n          canvas.freeDrawingBrush.width = Math.max(1, canvas.freeDrawingBrush.width - 5);\n        } else if (e.key === ']') {\n          canvas.freeDrawingBrush.width += 5;\n        }\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [canvas]);\n};\n","import React, { useEffect, useRef } from 'react';\nimport { Canvas, Image, PencilBrush, IText, Point } from 'fabric';\nimport { usePhotoEditor } from '../context';\nimport { useKeyboardShortcuts } from '../hooks/useKeyboardShortcuts';\n\nconst CanvasArea: React.FC = () => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const {\n    canvas,\n    setCanvas,\n    selectedObject,\n    setSelectedObject,\n    history,\n    imageUrl,\n    initialProject,\n    activeTool,\n    addOnFile,\n    setAddOnFile,\n    setActiveTool,\n    brushSize,\n    setBrushSize,\n    brushColor,\n    setBrushColor,\n  } = usePhotoEditor();\n\n  const isEditingRef = useRef(false);\n\n  useKeyboardShortcuts(canvas);\n\n  const altPressedRef = useRef(false);\n  const previewDivRef = useRef<HTMLDivElement | null>(null);\n  const brushOverlayRef = useRef<HTMLDivElement | null>(null);\n  const isResizingBrushRef = useRef(false);\n  const resizeStartXRef = useRef(0);\n  const resizeStartSizeRef = useRef(0);\n  const brushSizeRef = useRef(brushSize);\n\n  useEffect(() => {\n    brushSizeRef.current = brushSize;\n  }, [brushSize]);\n\n  useEffect(() => {\n    if (!canvas || !addOnFile) return;\n\n    const reader = new FileReader();\n    reader.onload = (f) => {\n      const data = f.target?.result as string;\n      Image.fromURL(data).then((img) => {\n        img.scaleToWidth(200);\n        canvas.add(img);\n        canvas.centerObject(img);\n        canvas.setActiveObject(img);\n        history.saveState();\n        if (setAddOnFile) setAddOnFile(null);\n      });\n    };\n    reader.readAsDataURL(addOnFile);\n  }, [addOnFile, canvas]);\n\n  // Sync brush settings\n  useEffect(() => {\n    if (canvas && canvas.freeDrawingBrush && activeTool === 'brush') {\n      canvas.freeDrawingBrush.width = brushSize;\n      canvas.freeDrawingBrush.color = brushColor;\n    }\n  }, [canvas, activeTool, brushSize, brushColor]);\n\n  // Alt+hover preview, Alt+click to pick color, Alt+RightClick drag to resize\n  useEffect(() => {\n    if (!canvas || !containerRef.current) return;\n\n    const container = containerRef.current;\n    const lower = (canvas.lowerCanvasEl as HTMLCanvasElement) || null;\n\n    // Create color preview div\n    const preview = document.createElement('div');\n    preview.style.position = 'absolute';\n    preview.style.pointerEvents = 'none';\n    preview.style.width = '28px';\n    preview.style.height = '28px';\n    preview.style.borderRadius = '50%';\n    preview.style.boxShadow = '0 0 4px rgba(0,0,0,0.5)';\n    preview.style.border = '2px solid #fff';\n    preview.style.transform = 'translate(-50%, -50%)';\n    preview.style.display = 'none';\n    preview.style.zIndex = '1000';\n    container.appendChild(preview);\n    previewDivRef.current = preview;\n\n    // Create brush size overlay\n    const overlay = document.createElement('div');\n    overlay.style.position = 'absolute';\n    overlay.style.pointerEvents = 'none';\n    overlay.style.border = '1px solid rgba(0,0,0,0.5)';\n    overlay.style.borderRadius = '50%';\n    overlay.style.transform = 'translate(-50%, -50%)';\n    overlay.style.display = 'none';\n    overlay.style.zIndex = '999';\n    container.appendChild(overlay);\n    brushOverlayRef.current = overlay;\n\n    const updateCursorAndOverlay = (x: number, y: number, size: number) => {\n      if (!brushOverlayRef.current) return;\n\n      // Only show overlay if size is significantly larger than cursor or if we are resizing\n      // Standard cursor is small. Let's say if size > 10 we show overlay.\n      const showOverlay = activeTool === 'brush' && (size > 10 || isResizingBrushRef.current);\n\n      if (showOverlay) {\n        brushOverlayRef.current.style.width = `${size}px`;\n        brushOverlayRef.current.style.height = `${size}px`;\n        brushOverlayRef.current.style.left = `${x}px`;\n        brushOverlayRef.current.style.top = `${y}px`;\n        brushOverlayRef.current.style.display = 'block';\n\n        // Hide default cursor when overlay is shown\n        if (canvas.defaultCursor !== 'none') {\n          canvas.defaultCursor = 'none';\n          canvas.hoverCursor = 'none';\n          canvas.requestRenderAll();\n        }\n      } else {\n        brushOverlayRef.current.style.display = 'none';\n        if (canvas.defaultCursor === 'none') {\n          canvas.defaultCursor = 'default';\n          canvas.hoverCursor = 'move';\n          canvas.requestRenderAll();\n        }\n      }\n    };\n\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Alt') {\n        altPressedRef.current = true;\n        if (activeTool === 'brush') {\n          canvas.isDrawingMode = false;\n        }\n      }\n    };\n\n    const onKeyUp = (e: KeyboardEvent) => {\n      if (e.key === 'Alt') {\n        altPressedRef.current = false;\n        if (activeTool === 'brush' && !isResizingBrushRef.current) {\n          canvas.isDrawingMode = true;\n        }\n        if (previewDivRef.current) previewDivRef.current.style.display = 'none';\n      }\n    };\n\n    const onContextMenu = (e: MouseEvent) => {\n      if (e.altKey) {\n        e.preventDefault();\n      }\n    };\n\n    const onMouseDown = (e: MouseEvent) => {\n      if (activeTool !== 'brush') return;\n\n      // Alt + Right Click -> Resize\n      if (e.altKey && e.button === 2) {\n        e.preventDefault();\n        isResizingBrushRef.current = true;\n        resizeStartXRef.current = e.clientX;\n        resizeStartSizeRef.current = brushSizeRef.current;\n        canvas.isDrawingMode = false;\n        return;\n      }\n\n      // Alt + Left Click -> Color Pick\n      if (e.altKey && e.button === 0) {\n        try {\n          const rect = container.getBoundingClientRect();\n          const x = e.clientX - rect.left;\n          const y = e.clientY - rect.top;\n\n          if (!lower) return;\n          const ctx = lower.getContext('2d');\n          if (!ctx) return;\n\n          const pixel = ctx.getImageData(x, y, 1, 1).data;\n          const hex =\n            '#' +\n            [pixel[0], pixel[1], pixel[2]].map((v) => v.toString(16).padStart(2, '0')).join('');\n\n          setBrushColor(hex);\n        } catch (err) {\n          // ignore\n        }\n      }\n    };\n\n    const onMouseMove = (e: MouseEvent) => {\n      if (activeTool !== 'brush') {\n        if (brushOverlayRef.current) brushOverlayRef.current.style.display = 'none';\n        return;\n      }\n\n      const rect = container.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const y = e.clientY - rect.top;\n\n      // Handle Resizing\n      if (isResizingBrushRef.current) {\n        const delta = e.clientX - resizeStartXRef.current;\n        // Drag right -> increase, Drag left -> decrease\n        // Sensitivity: 1px drag = 1px size change? Or maybe slower/faster?\n        const newSize = Math.max(1, resizeStartSizeRef.current + delta);\n        setBrushSize(newSize);\n        updateCursorAndOverlay(x, y, newSize);\n        return;\n      }\n\n      // Handle Overlay (Normal movement)\n      updateCursorAndOverlay(x, y, brushSizeRef.current);\n\n      // Handle Color Pick Preview\n      if (altPressedRef.current) {\n        try {\n          if (!lower) return;\n          const ctx = lower.getContext('2d');\n          if (!ctx) return;\n\n          // Check bounds\n          if (x < 0 || y < 0 || x >= lower.width || y >= lower.height) {\n            if (previewDivRef.current) previewDivRef.current.style.display = 'none';\n            return;\n          }\n\n          const pixel = ctx.getImageData(x, y, 1, 1).data;\n          const hex =\n            '#' +\n            [pixel[0], pixel[1], pixel[2]].map((v) => v.toString(16).padStart(2, '0')).join('');\n\n          if (previewDivRef.current) {\n            previewDivRef.current.style.background = hex;\n            previewDivRef.current.style.display = 'block';\n            previewDivRef.current.style.left = x + 24 + 'px';\n            previewDivRef.current.style.top = y + 24 + 'px';\n          }\n        } catch (err) {\n          if (previewDivRef.current) previewDivRef.current.style.display = 'none';\n        }\n      } else {\n        if (previewDivRef.current) previewDivRef.current.style.display = 'none';\n      }\n    };\n\n    const onMouseUp = (e: MouseEvent) => {\n      if (isResizingBrushRef.current) {\n        isResizingBrushRef.current = false;\n        if (activeTool === 'brush' && !altPressedRef.current) {\n          canvas.isDrawingMode = true;\n        }\n      }\n    };\n\n    window.addEventListener('keydown', onKeyDown);\n    window.addEventListener('keyup', onKeyUp);\n    container.addEventListener('contextmenu', onContextMenu);\n    container.addEventListener('mousedown', onMouseDown);\n    window.addEventListener('mousemove', onMouseMove);\n    window.addEventListener('mouseup', onMouseUp);\n\n    return () => {\n      window.removeEventListener('keydown', onKeyDown);\n      window.removeEventListener('keyup', onKeyUp);\n      container.removeEventListener('contextmenu', onContextMenu);\n      container.removeEventListener('mousedown', onMouseDown);\n      window.removeEventListener('mousemove', onMouseMove);\n      window.removeEventListener('mouseup', onMouseUp);\n\n      if (previewDivRef.current) {\n        try {\n          container.removeChild(previewDivRef.current);\n        } catch (e) {}\n        previewDivRef.current = null;\n      }\n      if (brushOverlayRef.current) {\n        try {\n          container.removeChild(brushOverlayRef.current);\n        } catch (e) {}\n        brushOverlayRef.current = null;\n      }\n\n      // Restore cursor\n      if (canvas) {\n        canvas.defaultCursor = 'default';\n        canvas.hoverCursor = 'move';\n      }\n    };\n  }, [canvas, activeTool, setBrushSize, setBrushColor]); // Removed brushSize from dependency to avoid re-bind\n\n  useEffect(() => {\n    if (!canvasRef.current || !containerRef.current) return;\n\n    const fabricCanvas = new Canvas(canvasRef.current, {\n      width: containerRef.current.clientWidth,\n      height: containerRef.current.clientHeight,\n      backgroundColor: '#ffffff',\n      preserveObjectStacking: true, // Important for layers\n      selection: true,\n    });\n\n    setCanvas(fabricCanvas);\n\n    if (initialProject) {\n      fabricCanvas.loadFromJSON(initialProject.json).then(() => {\n        fabricCanvas.renderAll();\n        history.saveState();\n      });\n    } else if (imageUrl) {\n      Image.fromURL(imageUrl).then((img) => {\n        const containerWidth = containerRef.current!.clientWidth;\n        const containerHeight = containerRef.current!.clientHeight;\n\n        if (img.width! > containerWidth || img.height! > containerHeight) {\n          img.scaleToWidth(containerWidth * 0.8);\n        }\n\n        fabricCanvas.add(img);\n        fabricCanvas.centerObject(img);\n        fabricCanvas.setActiveObject(img);\n        history.saveState();\n      });\n    }\n\n    const updateSelection = () => {\n      const activeObjects = fabricCanvas.getActiveObjects();\n      if (activeObjects.length === 1) {\n        setSelectedObject(activeObjects[0]);\n      } else {\n        setSelectedObject(null);\n      }\n    };\n\n    fabricCanvas.on('selection:created', updateSelection);\n    fabricCanvas.on('selection:updated', updateSelection);\n    fabricCanvas.on('selection:cleared', () => setSelectedObject(null));\n\n    // When entering/exiting text editing, keep the active tool in 'text'\n    const onTextEnter = () => {\n      isEditingRef.current = true;\n      setActiveTool && setActiveTool('text');\n    };\n    const onTextExit = () => setActiveTool && setActiveTool('select');\n\n    fabricCanvas.on('text:editing:entered', onTextEnter);\n    fabricCanvas.on('text:editing:exited', onTextExit);\n\n    const saveHistory = () => {\n      history.saveState();\n    };\n\n    fabricCanvas.on('object:modified', saveHistory);\n    fabricCanvas.on('object:added', saveHistory);\n    fabricCanvas.on('object:removed', saveHistory);\n\n    // Ctrl + mouse wheel to zoom (centered at pointer)\n    const onWheel = (ev: WheelEvent) => {\n      // only when ctrlKey is pressed\n      if (!ev.ctrlKey) return;\n      ev.preventDefault();\n\n      try {\n        const currentZoom = fabricCanvas.getZoom() || 1;\n        // wheel up -> zoom in, wheel down -> zoom out\n        const delta = ev.deltaY;\n        // Use an exponential zoom factor for smoother control\n        const zoomFactor = delta < 0 ? 1.12 : 0.88;\n        let newZoom = currentZoom * zoomFactor;\n        newZoom = Math.max(0.1, Math.min(5, newZoom));\n\n        // Get pointer in canvas coordinates\n        // fabricCanvas.getPointer works with native events too\n        const pointer = (fabricCanvas as any).getPointer(ev) as { x: number; y: number };\n        if (pointer && typeof pointer.x === 'number' && typeof pointer.y === 'number') {\n          fabricCanvas.zoomToPoint(new Point(pointer.x, pointer.y), newZoom);\n        } else {\n          // fallback: compute from client coords\n          const rect = fabricCanvas.lowerCanvasEl.getBoundingClientRect();\n          const x = ev.clientX - rect.left;\n          const y = ev.clientY - rect.top;\n          fabricCanvas.zoomToPoint(new Point(x, y), newZoom);\n        }\n\n        fabricCanvas.requestRenderAll();\n      } catch (e) {\n        // ignore\n      }\n    };\n\n    // attach to container so we can prevent browser zoom\n    containerRef.current.addEventListener('wheel', onWheel, { passive: false });\n\n    const handleResize = () => {\n      if (containerRef.current) {\n        fabricCanvas.setDimensions({\n          width: containerRef.current.clientWidth,\n          height: containerRef.current.clientHeight,\n        });\n      }\n    };\n\n    window.addEventListener('resize', handleResize);\n\n    return () => {\n      fabricCanvas.dispose();\n      window.removeEventListener('resize', handleResize);\n      if (containerRef.current) {\n        try {\n          containerRef.current.removeEventListener('wheel', onWheel as EventListener);\n        } catch (e) {}\n      }\n    };\n  }, []);\n\n  // If selected object is a text object and is being edited, ensure the active tool is 'text'\n  useEffect(() => {\n    if (!selectedObject) return;\n    try {\n      const editing = !!(selectedObject as any).isEditing;\n      isEditingRef.current = editing;\n      if (editing) {\n        setActiveTool && setActiveTool('text');\n      }\n    } catch (e) {\n      // ignore\n    }\n  }, [selectedObject, setActiveTool]);\n\n  useEffect(() => {\n    if (!canvas) return;\n    if (activeTool === 'brush') {\n      canvas.isDrawingMode = true;\n      if (!canvas.freeDrawingBrush) {\n        canvas.freeDrawingBrush = new PencilBrush(canvas);\n      }\n      canvas.freeDrawingBrush.width = brushSize;\n      canvas.freeDrawingBrush.color = brushColor;\n    } else {\n      canvas.isDrawingMode = false;\n    }\n  }, [activeTool, canvas]); // brushSize and brushColor are handled by the sync effect\n\n  // Place text on first mouse click when activeTool === 'text'\n  useEffect(() => {\n    if (!canvas) return;\n    if (activeTool !== 'text') return;\n\n    const handleMouseDown = (opt: any) => {\n      try {\n        // If a text object is currently being edited, do not create a new text object\n        if (isEditingRef.current) return;\n\n        const pointer = canvas.getViewportPoint(opt.e);\n        const txt = new IText('Text', {\n          left: pointer.x,\n          top: pointer.y,\n          fontSize: 24,\n        });\n        canvas.add(txt);\n        canvas.setActiveObject(txt);\n        setSelectedObject && setSelectedObject(txt);\n        txt.enterEditing && txt.enterEditing();\n        txt.selectAll && txt.selectAll();\n        canvas.requestRenderAll();\n        history.saveState();\n        // switch back to select so subsequent clicks don't add more text\n        setActiveTool && setActiveTool('select');\n      } catch (err) {\n        // ignore\n      }\n    };\n\n    canvas.on('mouse:down', handleMouseDown);\n    return () => {\n      canvas.off('mouse:down', handleMouseDown);\n    };\n  }, [canvas, activeTool, history, setSelectedObject, setActiveTool]);\n\n  return (\n    <div ref={containerRef} style={{ width: '100%', height: '100%' }}>\n      <canvas ref={canvasRef} />\n    </div>\n  );\n};\n\nexport default CanvasArea;\n","import React, { useEffect, useState, useRef } from 'react';\nimport { List, Button, Typography, Space, InputNumber, Select } from 'antd';\nimport {\n  EyeOutlined,\n  EyeInvisibleOutlined,\n  LockOutlined,\n  UnlockOutlined,\n  DeleteOutlined,\n  HolderOutlined,\n  GroupOutlined,\n  UngroupOutlined,\n} from '@ant-design/icons';\nimport { usePhotoEditor } from '../context';\nimport { FabricObject, ActiveSelection, Group } from 'fabric';\nimport {\n  DndContext,\n  closestCenter,\n  KeyboardSensor,\n  PointerSensor,\n  useSensor,\n  useSensors,\n  DragEndEvent,\n} from '@dnd-kit/core';\nimport {\n  SortableContext,\n  sortableKeyboardCoordinates,\n  verticalListSortingStrategy,\n  useSortable,\n} from '@dnd-kit/sortable';\nimport { CSS } from '@dnd-kit/utilities';\n\nconst { Title } = Typography;\nconst { Option } = Select;\n\ninterface SortableItemProps {\n  id: string;\n  children: React.ReactNode;\n  isSelected: boolean;\n  onClick: (e: React.MouseEvent) => void;\n}\n\nconst SortableItem: React.FC<SortableItemProps> = ({ id, children, isSelected, onClick }) => {\n  const { attributes, listeners, setNodeRef, setActivatorNodeRef, transform, transition } =\n    useSortable({ id });\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    backgroundColor: isSelected ? '#e6f7ff' : 'transparent',\n    marginBottom: 4,\n    border: '1px solid #f0f0f0',\n    borderRadius: 4,\n    padding: '4px 8px',\n    display: 'flex',\n    alignItems: 'center',\n  };\n\n  return (\n    <div ref={setNodeRef} style={style}>\n      <div\n        ref={setActivatorNodeRef}\n        {...attributes}\n        {...listeners}\n        style={{\n          cursor: 'grab',\n          marginRight: 8,\n          display: 'flex',\n          alignItems: 'center',\n          color: '#999',\n        }}\n        onMouseDown={(e) => e.stopPropagation()}\n      >\n        <HolderOutlined />\n      </div>\n      <div onClick={(e) => onClick(e)} style={{ flex: 1, cursor: 'pointer' }}>\n        {children}\n      </div>\n    </div>\n  );\n};\n\nconst LayersPanel: React.FC = () => {\n  const { canvas, selectedObject, setSelectedObject, history } = usePhotoEditor();\n  const [objects, setObjects] = useState<FabricObject[]>([]);\n  const [activeUids, setActiveUids] = useState<string[]>([]);\n  const draggingOpacity = useRef(false);\n  const opacityStartX = useRef<number | null>(null);\n  const opacityStartValue = useRef<number>(100);\n  const lastClickedIndex = useRef<number | null>(null);\n\n  const sensors = useSensors(\n    useSensor(PointerSensor),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n    }),\n  );\n\n  const updateObjects = () => {\n    if (!canvas) return;\n    const objs = canvas.getObjects();\n    objs.forEach((obj: any) => {\n      if (!obj.uid) obj.uid = Math.random().toString(36).substr(2, 9);\n    });\n    // Reverse to show top layers first\n    setObjects([...objs].reverse());\n  };\n\n  const handleGroup = () => {\n    if (!canvas) return;\n    const activeObject = canvas.getActiveObject();\n    if (!activeObject) return;\n\n    if (activeObject.type === 'activeSelection') {\n      (activeObject as any).toGroup();\n      canvas.requestRenderAll();\n      updateObjects();\n      // Update selection to the new group\n      const newGroup = canvas.getActiveObject() || null;\n      setSelectedObject(newGroup);\n    }\n  };\n\n  const handleUngroup = () => {\n    if (!canvas) return;\n    const activeObject = canvas.getActiveObject();\n    if (!activeObject) return;\n\n    if (activeObject.type === 'group') {\n      (activeObject as any).toActiveSelection();\n      canvas.requestRenderAll();\n      updateObjects();\n      // Update selection\n      const newSelection = canvas.getActiveObject() || null;\n      setSelectedObject(newSelection);\n    }\n  };\n\n  useEffect(() => {\n    if (!canvas) return;\n\n    let timeout: NodeJS.Timeout;\n    const debouncedUpdate = () => {\n      clearTimeout(timeout);\n      timeout = setTimeout(updateObjects, 100);\n    };\n\n    canvas.on('object:added', debouncedUpdate);\n    canvas.on('object:removed', debouncedUpdate);\n    canvas.on('object:modified', debouncedUpdate);\n    // update selection highlights when selection changes (supports multi-select)\n    const updateSelection = () => {\n      const active = canvas.getActiveObjects() || [];\n      const uids = active.map((o: any) => o.uid).filter(Boolean);\n      setActiveUids(uids);\n    };\n    canvas.on('selection:created', updateSelection);\n    canvas.on('selection:updated', updateSelection);\n    canvas.on('selection:cleared', () => setActiveUids([]));\n\n    updateObjects();\n\n    return () => {\n      canvas.off('object:added', debouncedUpdate);\n      canvas.off('object:removed', debouncedUpdate);\n      canvas.off('object:modified', debouncedUpdate);\n      canvas.off('selection:created', updateSelection);\n      canvas.off('selection:updated', updateSelection);\n      canvas.off('selection:cleared', () => setActiveUids([]));\n      clearTimeout(timeout);\n    };\n  }, [canvas]);\n\n  const handleDragEnd = (event: DragEndEvent) => {\n    const { active, over } = event;\n\n    if (over && active.id !== over.id) {\n      const oldIndex = objects.findIndex((obj: any) => obj.uid === active.id);\n      const newIndex = objects.findIndex((obj: any) => obj.uid === over.id);\n\n      if (oldIndex !== -1 && newIndex !== -1) {\n        const fabricNewIndex = objects.length - 1 - newIndex;\n        const obj = objects[oldIndex];\n\n        canvas?.moveObjectTo(obj, fabricNewIndex);\n        canvas?.requestRenderAll();\n        history.saveState();\n        updateObjects();\n      }\n    }\n  };\n\n  const toggleVisibility = (obj: FabricObject, e: React.MouseEvent) => {\n    e.stopPropagation();\n    obj.visible = !obj.visible;\n    if (!obj.visible) {\n      canvas?.discardActiveObject();\n    }\n    canvas?.requestRenderAll();\n    history.saveState();\n    setObjects([...(canvas?.getObjects() || [])].reverse());\n  };\n\n  const toggleLock = (obj: FabricObject, e: React.MouseEvent) => {\n    e.stopPropagation();\n    obj.lockMovementX = !obj.lockMovementX;\n    obj.lockMovementY = !obj.lockMovementY;\n    obj.lockRotation = !obj.lockRotation;\n    obj.lockScalingX = !obj.lockScalingX;\n    obj.lockScalingY = !obj.lockScalingY;\n    obj.selectable = !obj.lockMovementX;\n\n    if (!obj.selectable) {\n      canvas?.discardActiveObject();\n    }\n\n    canvas?.requestRenderAll();\n    history.saveState();\n    setObjects([...(canvas?.getObjects() || [])].reverse());\n  };\n\n  const selectObject = (obj: FabricObject, e?: React.MouseEvent) => {\n    if (!canvas || !obj.visible || !obj.selectable) return;\n\n    const idx = objects.findIndex((o: any) => o === obj);\n    // Ctrl/Cmd -> toggle selection\n    const isCtrl = e && (e.ctrlKey || e.metaKey);\n    const isShift = e && e.shiftKey;\n\n    if (isCtrl) {\n      const active = canvas.getActiveObjects() || [];\n      const already = active.includes(obj as any);\n      let newActive = [] as any[];\n      if (already) {\n        newActive = active.filter((a: any) => a !== obj);\n      } else {\n        newActive = [...active, obj];\n      }\n\n      if (newActive.length === 0) {\n        canvas.discardActiveObject();\n        setSelectedObject(null);\n      } else if (newActive.length === 1) {\n        canvas.setActiveObject(newActive[0]);\n        setSelectedObject(newActive[0]);\n      } else {\n        const sel = new ActiveSelection(newActive, { canvas });\n        canvas.setActiveObject(sel);\n        setSelectedObject(newActive[newActive.length - 1]);\n      }\n      canvas.requestRenderAll();\n      lastClickedIndex.current = idx;\n      return;\n    }\n\n    if (isShift && lastClickedIndex.current !== null) {\n      const start = Math.min(lastClickedIndex.current, idx);\n      const end = Math.max(lastClickedIndex.current, idx);\n      const range = objects.slice(start, end + 1).map((o: any) => o) as any[];\n      if (range.length === 1) {\n        canvas.setActiveObject(range[0]);\n        setSelectedObject(range[0]);\n      } else {\n        const sel = new ActiveSelection(range, { canvas });\n        canvas.setActiveObject(sel);\n        setSelectedObject(range[range.length - 1]);\n      }\n      canvas.requestRenderAll();\n      return;\n    }\n\n    // Default: single select\n    canvas.setActiveObject(obj);\n    setSelectedObject(obj);\n    canvas.requestRenderAll();\n    lastClickedIndex.current = idx;\n  };\n\n  const deleteObject = (obj: FabricObject, e: React.MouseEvent) => {\n    e.stopPropagation();\n    canvas?.remove(obj);\n    canvas?.requestRenderAll();\n    history.saveState();\n  };\n\n  const handleOpacityChange = (value: number) => {\n    if (!canvas || !selectedObject) return;\n    selectedObject.set('opacity', value);\n    canvas.requestRenderAll();\n    // history.saveState(); // Maybe debounce this or save onAfterChange\n  };\n\n  const handleOpacityNumberChange = (v: number | undefined | null) => {\n    if (!canvas || !selectedObject) return;\n    const value = Number(v || 0);\n    selectedObject.set('opacity', Math.max(0, Math.min(100, value)) / 100);\n    canvas.requestRenderAll();\n  };\n\n  const handleOpacityLabelMouseDown = (e: React.MouseEvent) => {\n    if (e.button !== 0) return;\n    e.preventDefault();\n    draggingOpacity.current = true;\n    opacityStartX.current = e.clientX;\n    // store percentage (0-100)\n    opacityStartValue.current = Math.round(((selectedObject?.opacity ?? 1) as number) * 100);\n    const prevUserSelect = document.body.style.userSelect;\n    document.body.style.userSelect = 'none';\n\n    const onMouseMove = (ev: MouseEvent) => {\n      if (!draggingOpacity.current || opacityStartX.current === null) return;\n      const delta = ev.clientX - opacityStartX.current;\n      const sensitivity = 0.2; // pixels -> percent\n      let newVal = Math.max(0, Math.min(100, opacityStartValue.current + delta * sensitivity));\n      const obj = canvas?.getActiveObject() as FabricObject | undefined;\n      if (obj && canvas) {\n        obj.set('opacity', newVal / 100);\n        canvas.requestRenderAll();\n      }\n    };\n\n    const onMouseUp = () => {\n      draggingOpacity.current = false;\n      opacityStartX.current = null;\n      document.body.style.userSelect = prevUserSelect;\n      window.removeEventListener('mousemove', onMouseMove);\n      window.removeEventListener('mouseup', onMouseUp);\n      history.saveState();\n    };\n\n    window.addEventListener('mousemove', onMouseMove);\n    window.addEventListener('mouseup', onMouseUp);\n  };\n\n  const handleOpacityAfterChange = () => {\n    history.saveState();\n  };\n\n  const handleBlendModeChange = (value: string) => {\n    if (!canvas || !selectedObject) return;\n    selectedObject.set('globalCompositeOperation', value);\n    canvas.requestRenderAll();\n    history.saveState();\n  };\n\n  return (\n    <div style={{ padding: 10 }}>\n      <Title level={5}>Layers</Title>\n      <div style={{ marginBottom: 8 }}>\n        <Space>\n          <Button\n            icon={<GroupOutlined />}\n            onClick={handleGroup}\n            disabled={!selectedObject}\n            title=\"Group Layers\"\n          />\n          <Button\n            icon={<UngroupOutlined />}\n            onClick={handleUngroup}\n            disabled={!selectedObject || selectedObject.type !== 'group'}\n            title=\"Ungroup Layers\"\n          />\n        </Space>\n      </div>\n\n      {selectedObject && (\n        <div style={{ marginBottom: 16, padding: 8, background: '#fafafa', borderRadius: 4 }}>\n          <div style={{ marginBottom: 8 }}>\n            <div\n              style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 8,\n                fontSize: 12,\n                cursor: 'ew-resize',\n                userSelect: 'none',\n              }}\n              onMouseDown={handleOpacityLabelMouseDown}\n            >\n              <div style={{ marginRight: 8 }}>Opacity:</div>\n              <InputNumber\n                size=\"small\"\n                min={0}\n                max={100}\n                step={1}\n                value={Math.round((selectedObject.opacity ?? 1) * 100)}\n                onChange={(v) => handleOpacityNumberChange(v)}\n                onBlur={() => handleOpacityAfterChange()}\n                style={{ flex: 1 }}\n              />\n            </div>\n          </div>\n          <div>\n            <div\n              style={{ display: 'flex', alignItems: 'center', gap: 8, fontSize: 12, width: '100%' }}\n            >\n              <div style={{ marginRight: 8 }}>Blend Mode:</div>\n              <Select\n                size=\"small\"\n                style={{ flex: 1 }}\n                value={selectedObject.globalCompositeOperation || 'source-over'}\n                onChange={handleBlendModeChange}\n              >\n                <Option value=\"source-over\">Normal</Option>\n                <Option value=\"multiply\">Multiply</Option>\n                <Option value=\"screen\">Screen</Option>\n                <Option value=\"overlay\">Overlay</Option>\n                <Option value=\"darken\">Darken</Option>\n                <Option value=\"lighten\">Lighten</Option>\n                <Option value=\"color-dodge\">Color Dodge</Option>\n                <Option value=\"color-burn\">Color Burn</Option>\n                <Option value=\"hard-light\">Hard Light</Option>\n                <Option value=\"soft-light\">Soft Light</Option>\n                <Option value=\"difference\">Difference</Option>\n                <Option value=\"exclusion\">Exclusion</Option>\n                <Option value=\"hue\">Hue</Option>\n                <Option value=\"saturation\">Saturation</Option>\n                <Option value=\"color\">Color</Option>\n                <Option value=\"luminosity\">Luminosity</Option>\n              </Select>\n            </div>\n          </div>\n        </div>\n      )}\n\n      <DndContext sensors={sensors} collisionDetection={closestCenter} onDragEnd={handleDragEnd}>\n        <SortableContext\n          items={objects.map((obj: any) => obj.uid)}\n          strategy={verticalListSortingStrategy}\n        >\n          <div\n            style={{\n              // maxHeight: 300, // Removed to allow scrolling\n              overflowY: 'auto',\n              border: '1px solid #d9d9d9',\n              borderRadius: 4,\n              padding: 4,\n            }}\n          >\n            {objects.map((item: any, index) => {\n              const isSelected = activeUids.includes(item.uid);\n              const type = item.type || 'Object';\n              const name = item.name || `${type} ${objects.length - index}`;\n\n              return (\n                <SortableItem\n                  key={item.uid}\n                  id={item.uid}\n                  isSelected={isSelected}\n                  onClick={(e) => selectObject(item, e)}\n                >\n                  <div\n                    style={{\n                      display: 'flex',\n                      alignItems: 'center',\n                      width: '100%',\n                      justifyContent: 'space-between',\n                    }}\n                  >\n                    <span\n                      style={{\n                        overflow: 'hidden',\n                        textOverflow: 'ellipsis',\n                        whiteSpace: 'nowrap',\n                        maxWidth: 120,\n                      }}\n                    >\n                      {name}\n                    </span>\n                    <Space size={4}>\n                      <Button\n                        type=\"text\"\n                        size=\"small\"\n                        icon={item.visible ? <EyeOutlined /> : <EyeInvisibleOutlined />}\n                        onClick={(e) => toggleVisibility(item, e)}\n                        onMouseDown={(e) => e.stopPropagation()}\n                      />\n                      <Button\n                        type=\"text\"\n                        size=\"small\"\n                        icon={item.lockMovementX ? <LockOutlined /> : <UnlockOutlined />}\n                        onClick={(e) => toggleLock(item, e)}\n                        onMouseDown={(e) => e.stopPropagation()}\n                      />\n                      <Button\n                        type=\"text\"\n                        size=\"small\"\n                        danger\n                        icon={<DeleteOutlined />}\n                        onClick={(e) => deleteObject(item, e)}\n                        onMouseDown={(e) => e.stopPropagation()}\n                      />\n                    </Space>\n                  </div>\n                </SortableItem>\n              );\n            })}\n          </div>\n        </SortableContext>\n      </DndContext>\n    </div>\n  );\n};\n\nexport default LayersPanel;\n","import React, { useEffect, useRef, useState } from 'react';\nimport { Slider, Typography, Space, Collapse } from 'antd';\nimport { usePhotoEditor } from '../context';\nimport { filters, FabricImage } from 'fabric';\n\nconst { Panel } = Collapse;\n\nconst FILTER_LIST = [\n  { name: 'Grayscale', filter: filters.Grayscale, index: 9 },\n  { name: 'Invert', filter: filters.Invert, index: 10 },\n  { name: 'Sepia', filter: filters.Sepia, index: 11 },\n  { name: 'Black&White', filter: filters.BlackWhite, index: 12 },\n  { name: 'Brownie', filter: filters.Brownie, index: 13 },\n  { name: 'Vintage', filter: filters.Vintage, index: 14 },\n  { name: 'Kodachrome', filter: filters.Kodachrome, index: 15 },\n  { name: 'Technicolor', filter: filters.Technicolor, index: 16 },\n  { name: 'Polaroid', filter: filters.Polaroid, index: 17 },\n];\n\nconst FilterPreview: React.FC<{\n  name: string;\n  filterClass: any;\n  originalImage: HTMLImageElement | null;\n  isActive: boolean;\n  onClick: () => void;\n}> = ({ name, filterClass, originalImage, isActive, onClick }) => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n\n  useEffect(() => {\n    if (!originalImage || !canvasRef.current) return;\n\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    const size = 60;\n    canvas.width = size;\n    canvas.height = size;\n\n    // Create a temporary fabric image\n    const fImg = new FabricImage(originalImage);\n\n    const scale = size / Math.max(fImg.width || 1, fImg.height || 1);\n    fImg.scale(scale);\n\n    const filter = new filterClass();\n    fImg.filters = [filter];\n    fImg.applyFilters();\n\n    const element = fImg.getElement();\n\n    ctx.clearRect(0, 0, size, size);\n\n    const dw = (fImg.width || 0) * (fImg.scaleX || 1);\n    const dh = (fImg.height || 0) * (fImg.scaleY || 1);\n    const dx = (size - dw) / 2;\n    const dy = (size - dh) / 2;\n\n    ctx.drawImage(element, dx, dy, dw, dh);\n  }, [originalImage, filterClass]);\n\n  return (\n    <div\n      onClick={onClick}\n      style={{\n        cursor: 'pointer',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        gap: 4,\n      }}\n    >\n      <div\n        style={{\n          width: 64,\n          height: 64,\n          border: isActive ? '2px solid #1890ff' : '1px solid #f0f0f0',\n          borderRadius: 4,\n          overflow: 'hidden',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          background: '#f5f5f5',\n        }}\n      >\n        <canvas ref={canvasRef} />\n      </div>\n      <Typography.Text style={{ fontSize: 10, textAlign: 'center', lineHeight: 1.2 }}>\n        {name}\n      </Typography.Text>\n    </div>\n  );\n};\n\nconst AdjustmentPanel: React.FC = () => {\n  const { canvas, selectedObject, history } = usePhotoEditor();\n  const [originalImage, setOriginalImage] = useState<HTMLImageElement | null>(null);\n\n  useEffect(() => {\n    if (selectedObject && selectedObject.isType('image')) {\n      const img = selectedObject as FabricImage;\n      const src = img.getSrc();\n      const image = new Image();\n      image.crossOrigin = 'anonymous';\n      image.src = src;\n      image.onload = () => {\n        setOriginalImage(image);\n      };\n    } else {\n      setOriginalImage(null);\n    }\n  }, [selectedObject]);\n\n  const applyFilter = (index: number, filter: any) => {\n    if (!selectedObject || !selectedObject.isType('image')) return;\n    const img = selectedObject as any;\n    img.filters[index] = filter;\n    img.applyFilters();\n    canvas?.requestRenderAll();\n  };\n\n  const handleBrightness = (value: number) => {\n    const filter = new filters.Brightness({ brightness: value });\n    applyFilter(0, filter);\n  };\n\n  const handleContrast = (value: number) => {\n    const filter = new filters.Contrast({ contrast: value });\n    applyFilter(1, filter);\n  };\n\n  const handleSaturation = (value: number) => {\n    const filter = new filters.Saturation({ saturation: value });\n    applyFilter(2, filter);\n  };\n\n  const handleNoise = (value: number) => {\n    const filter = new filters.Noise({ noise: value });\n    applyFilter(3, filter);\n  };\n\n  const handlePixelate = (value: number) => {\n    const filter = value > 1 ? new filters.Pixelate({ blocksize: value }) : false;\n    applyFilter(4, filter);\n  };\n\n  const handleBlur = (value: number) => {\n    const filter = new filters.Blur({ blur: value });\n    applyFilter(5, filter);\n  };\n\n  const handleGamma = (value: number) => {\n    const filter = new filters.Gamma({ gamma: [value, value, value] });\n    applyFilter(6, filter);\n  };\n\n  const handleVibrance = (value: number) => {\n    const filter = new filters.Vibrance({ vibrance: value });\n    applyFilter(7, filter);\n  };\n\n  const handleHueRotation = (value: number) => {\n    const filter = new filters.HueRotation({ rotation: value });\n    applyFilter(8, filter);\n  };\n\n  const handleToggleFilter = (index: number, FilterClass: any, checked: boolean) => {\n    const filter = checked ? new FilterClass() : false;\n    applyFilter(index, filter);\n    history.saveState();\n  };\n\n  if (!selectedObject || !selectedObject.isType('image')) {\n    return <div style={{ padding: 10 }}>Select an image to adjust</div>;\n  }\n\n  return (\n    <div style={{ padding: 10, height: '100%', overflowY: 'auto' }}>\n      <Typography.Title level={5}>Adjustments</Typography.Title>\n      <Collapse defaultActiveKey={['1', '2', '3']} ghost>\n        <Panel header=\"Basic\" key=\"1\">\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\n            <div>\n              <Typography.Text>Brightness</Typography.Text>\n              <Slider\n                min={-1}\n                max={1}\n                step={0.01}\n                defaultValue={0}\n                onChange={handleBrightness}\n                onAfterChange={() => history.saveState()}\n              />\n            </div>\n            <div>\n              <Typography.Text>Contrast</Typography.Text>\n              <Slider\n                min={-1}\n                max={1}\n                step={0.01}\n                defaultValue={0}\n                onChange={handleContrast}\n                onAfterChange={() => history.saveState()}\n              />\n            </div>\n            <div>\n              <Typography.Text>Saturation</Typography.Text>\n              <Slider\n                min={-1}\n                max={1}\n                step={0.01}\n                defaultValue={0}\n                onChange={handleSaturation}\n                onAfterChange={() => history.saveState()}\n              />\n            </div>\n            <div>\n              <Typography.Text>Vibrance</Typography.Text>\n              <Slider\n                min={-1}\n                max={1}\n                step={0.01}\n                defaultValue={0}\n                onChange={handleVibrance}\n                onAfterChange={() => history.saveState()}\n              />\n            </div>\n            <div>\n              <Typography.Text>Gamma</Typography.Text>\n              <Slider\n                min={0.1}\n                max={2.2}\n                step={0.1}\n                defaultValue={1}\n                onChange={handleGamma}\n                onAfterChange={() => history.saveState()}\n              />\n            </div>\n            <div>\n              <Typography.Text>Hue Rotation</Typography.Text>\n              <Slider\n                min={-1}\n                max={1}\n                step={0.01}\n                defaultValue={0}\n                onChange={handleHueRotation}\n                onAfterChange={() => history.saveState()}\n              />\n            </div>\n          </Space>\n        </Panel>\n\n        <Panel header=\"Effects\" key=\"2\">\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\n            <div>\n              <Typography.Text>Blur</Typography.Text>\n              <Slider\n                min={0}\n                max={1}\n                step={0.01}\n                defaultValue={0}\n                onChange={handleBlur}\n                onAfterChange={() => history.saveState()}\n              />\n            </div>\n            <div>\n              <Typography.Text>Noise</Typography.Text>\n              <Slider\n                min={0}\n                max={1000}\n                defaultValue={0}\n                onChange={handleNoise}\n                onAfterChange={() => history.saveState()}\n              />\n            </div>\n            <div>\n              <Typography.Text>Pixelate</Typography.Text>\n              <Slider\n                min={1}\n                max={20}\n                defaultValue={1}\n                onChange={handlePixelate}\n                onAfterChange={() => history.saveState()}\n              />\n            </div>\n          </Space>\n        </Panel>\n\n        <Panel header=\"Filters\" key=\"3\">\n          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 12 }}>\n            {FILTER_LIST.map((item) => {\n              const isActive = !!(selectedObject as any)?.filters?.[item.index];\n              return (\n                <FilterPreview\n                  key={item.name}\n                  name={item.name}\n                  filterClass={item.filter}\n                  originalImage={originalImage}\n                  isActive={isActive}\n                  onClick={() => handleToggleFilter(item.index, item.filter, !isActive)}\n                />\n              );\n            })}\n          </div>\n        </Panel>\n      </Collapse>\n    </div>\n  );\n};\n\nexport default AdjustmentPanel;\n","import React, { useEffect, useState, useRef } from 'react';\nimport { ColorPicker, Slider, Typography, Space, Select, InputNumber } from 'antd';\nimport { usePhotoEditor } from '../context';\nimport { PencilBrush, CircleBrush, SprayBrush, Shadow } from 'fabric';\n\nconst BrushPanel: React.FC = () => {\n  const {\n    canvas,\n    brushSize,\n    setBrushSize,\n    brushColor,\n    setBrushColor,\n    brushOpacity,\n    setBrushOpacity,\n  } = usePhotoEditor();\n  const [shadowWidth, setShadowWidth] = useState<number>(0);\n  const [brushType, setBrushType] = useState<string>('Pencil');\n\n  const draggingWidth = useRef(false);\n  const widthStartX = useRef<number | null>(null);\n  const widthStartValue = useRef<number>(brushSize);\n\n  const draggingShadow = useRef(false);\n  const shadowStartX = useRef<number | null>(null);\n  const shadowStartValue = useRef<number>(shadowWidth);\n\n  const draggingOpacity = useRef(false);\n  const opacityStartX = useRef<number | null>(null);\n  const opacityStartValue = useRef<number>(brushOpacity);\n\n  const handleWidthLabelMouseDown = (e: React.MouseEvent) => {\n    if (e.button !== 0) return;\n    e.preventDefault();\n    draggingWidth.current = true;\n    widthStartX.current = e.clientX;\n    widthStartValue.current = brushSize;\n    const prevUserSelect = document.body.style.userSelect;\n    document.body.style.userSelect = 'none';\n\n    const onMouseMove = (ev: MouseEvent) => {\n      if (!draggingWidth.current || widthStartX.current === null) return;\n      const delta = ev.clientX - widthStartX.current;\n      const sensitivity = 0.2; // pixels -> width\n      const newVal = Math.max(1, Math.min(2000, widthStartValue.current + delta * sensitivity));\n      setBrushSize(Number(newVal.toFixed(0)));\n    };\n\n    const onMouseUp = () => {\n      draggingWidth.current = false;\n      widthStartX.current = null;\n      document.body.style.userSelect = prevUserSelect;\n      window.removeEventListener('mousemove', onMouseMove);\n      window.removeEventListener('mouseup', onMouseUp);\n    };\n\n    window.addEventListener('mousemove', onMouseMove);\n    window.addEventListener('mouseup', onMouseUp);\n  };\n\n  const handleShadowLabelMouseDown = (e: React.MouseEvent) => {\n    if (e.button !== 0) return;\n    e.preventDefault();\n    draggingShadow.current = true;\n    shadowStartX.current = e.clientX;\n    shadowStartValue.current = shadowWidth;\n    const prevUserSelect = document.body.style.userSelect;\n    document.body.style.userSelect = 'none';\n\n    const onMouseMove = (ev: MouseEvent) => {\n      if (!draggingShadow.current || shadowStartX.current === null) return;\n      const delta = ev.clientX - shadowStartX.current;\n      const sensitivity = 0.2;\n      const newVal = Math.max(0, Math.min(200, shadowStartValue.current + delta * sensitivity));\n      setShadowWidth(Number(newVal.toFixed(0)));\n    };\n\n    const onMouseUp = () => {\n      draggingShadow.current = false;\n      shadowStartX.current = null;\n      document.body.style.userSelect = prevUserSelect;\n      window.removeEventListener('mousemove', onMouseMove);\n      window.removeEventListener('mouseup', onMouseUp);\n    };\n\n    window.addEventListener('mousemove', onMouseMove);\n    window.addEventListener('mouseup', onMouseUp);\n  };\n\n  const handleOpacityLabelMouseDown = (e: React.MouseEvent) => {\n    if (e.button !== 0) return;\n    e.preventDefault();\n    draggingOpacity.current = true;\n    opacityStartX.current = e.clientX;\n    opacityStartValue.current = brushOpacity;\n    const prevUserSelect = document.body.style.userSelect;\n    document.body.style.userSelect = 'none';\n\n    const onMouseMove = (ev: MouseEvent) => {\n      if (!draggingOpacity.current || opacityStartX.current === null) return;\n      const delta = ev.clientX - opacityStartX.current;\n      const sensitivity = 0.002; // pixels -> opacity\n      const newVal = Math.max(0, Math.min(1, opacityStartValue.current + delta * sensitivity));\n      setBrushOpacity(Number(newVal.toFixed(2)));\n    };\n\n    const onMouseUp = () => {\n      draggingOpacity.current = false;\n      opacityStartX.current = null;\n      document.body.style.userSelect = prevUserSelect;\n      window.removeEventListener('mousemove', onMouseMove);\n      window.removeEventListener('mouseup', onMouseUp);\n    };\n\n    window.addEventListener('mousemove', onMouseMove);\n    window.addEventListener('mouseup', onMouseUp);\n  };\n\n  useEffect(() => {\n    if (!canvas) return;\n\n    // Ensure brush exists\n    if (!canvas.freeDrawingBrush) {\n      canvas.freeDrawingBrush = new PencilBrush(canvas);\n    }\n\n    const brush = canvas.freeDrawingBrush;\n    // Apply opacity to color\n    // Fabric brush color is a string. We need to parse it or use rgba.\n    // Assuming brushColor is hex.\n    // Simple hex to rgba conversion\n    const hex = brushColor.replace('#', '');\n    const r = parseInt(hex.substring(0, 2), 16);\n    const g = parseInt(hex.substring(2, 4), 16);\n    const b = parseInt(hex.substring(4, 6), 16);\n    brush.color = `rgba(${r},${g},${b},${brushOpacity})`;\n    brush.width = brushSize;\n\n    if (shadowWidth > 0) {\n      brush.shadow = new Shadow({ blur: shadowWidth, color: brush.color });\n    } else {\n      brush.shadow = null;\n    }\n  }, [canvas, brushColor, brushSize, shadowWidth, brushOpacity]);\n\n  const handleBrushChange = (type: string) => {\n    if (!canvas) return;\n    setBrushType(type);\n    let brush;\n    switch (type) {\n      case 'Circle':\n        brush = new CircleBrush(canvas);\n        break;\n      case 'Spray':\n        brush = new SprayBrush(canvas);\n        break;\n      case 'Pencil':\n      default:\n        brush = new PencilBrush(canvas);\n        break;\n    }\n    const hex = brushColor.replace('#', '');\n    const r = parseInt(hex.substring(0, 2), 16);\n    const g = parseInt(hex.substring(2, 4), 16);\n    const b = parseInt(hex.substring(4, 6), 16);\n    brush.color = `rgba(${r},${g},${b},${brushOpacity})`;\n    brush.width = brushSize;\n    if (shadowWidth > 0) {\n      brush.shadow = new Shadow({ blur: shadowWidth, color: brush.color });\n    }\n    canvas.freeDrawingBrush = brush;\n  };\n\n  return (\n    <div style={{ padding: 10 }}>\n      <Typography.Title level={5}>Brush Settings</Typography.Title>\n      <Space direction=\"vertical\" style={{ width: '100%' }}>\n        <div>\n          <Typography.Text>Type</Typography.Text>\n          <Select value={brushType} style={{ width: '100%' }} onChange={handleBrushChange}>\n            <Select.Option value=\"Pencil\">Pencil</Select.Option>\n            <Select.Option value=\"Circle\">Circle</Select.Option>\n            <Select.Option value=\"Spray\">Spray</Select.Option>\n          </Select>\n        </div>\n        <div>\n          <Typography.Text>Color</Typography.Text>\n          <br />\n          <ColorPicker\n            value={brushColor}\n            onChange={(c) => setBrushColor(c.toHexString())}\n            showText\n          />\n        </div>\n        <div>\n          <Typography.Text\n            onMouseDown={handleWidthLabelMouseDown}\n            style={{ cursor: 'ew-resize', userSelect: 'none' }}\n          >\n            Width\n          </Typography.Text>\n          <br />\n          <InputNumber\n            min={1}\n            max={2000}\n            value={brushSize}\n            onChange={(v) => setBrushSize(Number(v || 1))}\n            style={{ width: '100%' }}\n          />\n        </div>\n        <div>\n          <Typography.Text\n            onMouseDown={handleOpacityLabelMouseDown}\n            style={{ cursor: 'ew-resize', userSelect: 'none' }}\n          >\n            Opacity\n          </Typography.Text>\n          <br />\n          <InputNumber\n            min={0}\n            max={1}\n            step={0.01}\n            value={brushOpacity}\n            onChange={(v) => setBrushOpacity(Number(v || 1))}\n            style={{ width: '100%' }}\n          />\n        </div>\n        <div>\n          <Typography.Text\n            onMouseDown={handleShadowLabelMouseDown}\n            style={{ cursor: 'ew-resize', userSelect: 'none' }}\n          >\n            Shadow Blur\n          </Typography.Text>\n          <br />\n          <InputNumber\n            min={0}\n            max={500}\n            value={shadowWidth}\n            onChange={(v) => setShadowWidth(Number(v || 0))}\n            style={{ width: '100%' }}\n          />\n        </div>\n      </Space>\n    </div>\n  );\n};\n\nexport default BrushPanel;\n","// This icon file is generated automatically.\nvar BoldOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M697.8 481.4c33.6-35 54.2-82.3 54.2-134.3v-10.2C752 229.3 663.9 142 555.3 142H259.4c-15.1 0-27.4 12.3-27.4 27.4v679.1c0 16.3 13.2 29.5 29.5 29.5h318.7c117 0 211.8-94.2 211.8-210.5v-11c0-73-37.4-137.3-94.2-175.1zM328 238h224.7c57.1 0 103.3 44.4 103.3 99.3v9.5c0 54.8-46.3 99.3-103.3 99.3H328V238zm366.6 429.4c0 62.9-51.7 113.9-115.5 113.9H328V542.7h251.1c63.8 0 115.5 51 115.5 113.9v10.8z\" } }] }, \"name\": \"bold\", \"theme\": \"outlined\" };\nexport default BoldOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport BoldOutlinedSvg from \"@ant-design/icons-svg/es/asn/BoldOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar BoldOutlined = function BoldOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: BoldOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(BoldOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'BoldOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar UnderlineOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M824 804H200c-4.4 0-8 3.4-8 7.6v60.8c0 4.2 3.6 7.6 8 7.6h624c4.4 0 8-3.4 8-7.6v-60.8c0-4.2-3.6-7.6-8-7.6zm-312-76c69.4 0 134.6-27.1 183.8-76.2C745 602.7 772 537.4 772 468V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 97-79 176-176 176s-176-79-176-176V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 69.4 27.1 134.6 76.2 183.8C377.3 701 442.6 728 512 728z\" } }] }, \"name\": \"underline\", \"theme\": \"outlined\" };\nexport default UnderlineOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport UnderlineOutlinedSvg from \"@ant-design/icons-svg/es/asn/UnderlineOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar UnderlineOutlined = function UnderlineOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: UnderlineOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(UnderlineOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'UnderlineOutlined';\n}\nexport default RefIcon;","import React, { useEffect, useState } from 'react';\nimport { Select, InputNumber, Button, Space, Divider, ColorPicker } from 'antd';\nimport {\n  BoldOutlined,\n  ItalicOutlined,\n  UnderlineOutlined,\n  AlignLeftOutlined,\n  AlignCenterOutlined,\n  AlignRightOutlined,\n} from '@ant-design/icons';\nimport { usePhotoEditor } from '../context';\nimport { IText } from 'fabric';\n\nconst fonts = ['Arial', 'Helvetica', 'Times New Roman', 'Georgia', 'Courier New', 'Verdana'];\n\nconst TextStylePanel: React.FC = () => {\n  const { canvas, selectedObject, history, setActiveTool } = usePhotoEditor();\n  const [fontFamily, setFontFamily] = useState<string>('Arial');\n  const [fontSize, setFontSize] = useState<number>(24);\n  const [bold, setBold] = useState<boolean>(false);\n  const [italic, setItalic] = useState<boolean>(false);\n  const [underline, setUnderline] = useState<boolean>(false);\n  const [align, setAlign] = useState<'left' | 'center' | 'right'>('left');\n  const [color, setColor] = useState<string>('#000000');\n\n  useEffect(() => {\n    if (selectedObject && (selectedObject as any).isType === 'i-text') {\n      const txt = selectedObject as IText;\n      setFontFamily((txt.fontFamily as string) || 'Arial');\n      setFontSize((txt.fontSize as number) || 24);\n      setBold(txt.fontWeight === 'bold' || txt.fontWeight === 700);\n      setItalic(txt.fontStyle === 'italic');\n      setUnderline((txt.underline as boolean) || false);\n      setAlign((txt.textAlign as any) || 'left');\n      setColor((txt.fill as string) || '#000000');\n    }\n  }, [selectedObject]);\n\n  const apply = (patch: Record<string, any>, save = true) => {\n    if (!selectedObject) return;\n    selectedObject.set(patch);\n    selectedObject.setCoords && selectedObject.setCoords();\n    canvas && canvas.requestRenderAll();\n    if (save && history) history.saveState();\n  };\n\n  const getFirstLayerRect = () => {\n    if (!canvas) return null;\n    const objs = canvas.getObjects();\n    if (!objs || objs.length === 0) return null;\n    const first = objs[0];\n    try {\n      return first.getBoundingRect();\n    } catch (e) {\n      return null;\n    }\n  };\n\n  const alignHorizontalToFirst = (mode: 'left' | 'center' | 'right') => {\n    if (!canvas || !selectedObject) return;\n    const target = getFirstLayerRect();\n    if (!target) return;\n    const objRect = selectedObject.getBoundingRect();\n\n    let left = selectedObject.left || 0;\n    if (mode === 'left') {\n      left = target.left;\n    } else if (mode === 'center') {\n      left = target.left + (target.width - objRect.width) / 2;\n    } else if (mode === 'right') {\n      left = target.left + target.width - objRect.width;\n    }\n\n    apply({ left }, true);\n  };\n\n  const alignVerticalToFirst = (mode: 'top' | 'middle' | 'bottom') => {\n    if (!canvas || !selectedObject) return;\n    const target = getFirstLayerRect();\n    if (!target) return;\n    const objRect = selectedObject.getBoundingRect();\n\n    let top = selectedObject.top || 0;\n    if (mode === 'top') {\n      top = target.top;\n    } else if (mode === 'middle') {\n      top = target.top + (target.height - objRect.height) / 2;\n    } else if (mode === 'bottom') {\n      top = target.top + target.height - objRect.height;\n    }\n\n    apply({ top }, true);\n  };\n\n  return (\n    <div style={{ padding: 12 }}>\n      <div style={{ marginBottom: 8 }}>\n        <strong>Font</strong>\n      </div>\n\n      <Space direction=\"vertical\" style={{ width: '100%' }}>\n        <Select\n          value={fontFamily}\n          onChange={(v) => {\n            setFontFamily(v);\n            apply({ fontFamily: v });\n          }}\n        >\n          {fonts.map((f) => (\n            <Select.Option key={f} value={f}>\n              {f}\n            </Select.Option>\n          ))}\n        </Select>\n\n        <InputNumber\n          min={8}\n          max={200}\n          value={fontSize}\n          onChange={(v) => {\n            setFontSize(v || 24);\n            apply({ fontSize: v || 24 });\n          }}\n          style={{ width: '100%' }}\n        />\n\n        <div>\n          <Space>\n            <Button\n              icon={<BoldOutlined />}\n              type={bold ? 'primary' : 'default'}\n              onClick={() => {\n                const newVal = !bold;\n                setBold(newVal);\n                apply({ fontWeight: newVal ? 'bold' : 'normal' });\n              }}\n            />\n            <Button\n              icon={<ItalicOutlined />}\n              type={italic ? 'primary' : 'default'}\n              onClick={() => {\n                const newVal = !italic;\n                setItalic(newVal);\n                apply({ fontStyle: newVal ? 'italic' : 'normal' });\n              }}\n            />\n            <Button\n              icon={<UnderlineOutlined />}\n              type={underline ? 'primary' : 'default'}\n              onClick={() => {\n                const newVal = !underline;\n                setUnderline(newVal);\n                apply({ underline: newVal });\n              }}\n            />\n          </Space>\n        </div>\n\n        <Divider />\n\n        <div>\n          <strong>Horizontal Align (textAlign)</strong>\n          <div style={{ marginTop: 8 }}>\n            <Space>\n              <Button\n                icon={<AlignLeftOutlined />}\n                type={align === 'left' ? 'primary' : 'default'}\n                onClick={() => {\n                  setAlign('left');\n                  apply({ textAlign: 'left' });\n                }}\n              />\n              <Button\n                icon={<AlignCenterOutlined />}\n                type={align === 'center' ? 'primary' : 'default'}\n                onClick={() => {\n                  setAlign('center');\n                  apply({ textAlign: 'center' });\n                }}\n              />\n              <Button\n                icon={<AlignRightOutlined />}\n                type={align === 'right' ? 'primary' : 'default'}\n                onClick={() => {\n                  setAlign('right');\n                  apply({ textAlign: 'right' });\n                }}\n              />\n            </Space>\n          </div>\n        </div>\n\n        <Divider />\n\n        <div>\n          <strong>Color</strong>\n          <div style={{ marginTop: 8 }}>\n            <ColorPicker\n              value={color}\n              onChange={(c) => {\n                const hex = c.toHexString();\n                setColor(hex);\n                apply({ fill: hex });\n                // if user is currently editing the text, ensure text tool stays active\n                try {\n                  if ((selectedObject as any)?.isEditing) {\n                    setActiveTool && setActiveTool('text');\n                  }\n                } catch (e) {\n                  // ignore\n                }\n              }}\n              showText\n            />\n          </div>\n        </div>\n      </Space>\n    </div>\n  );\n};\n\nexport default TextStylePanel;\n","import React from 'react';\nimport { Button, Space } from 'antd';\nimport { usePhotoEditor } from '../context';\n\nconst AlignControls: React.FC = () => {\n  const { canvas, selectedObject, history } = usePhotoEditor();\n\n  const getFirstLayerRect = () => {\n    if (!canvas) return null;\n    const objs = canvas.getObjects();\n    if (!objs || objs.length === 0) return null;\n    const first = objs[0];\n    try {\n      return first.getBoundingRect();\n    } catch (e) {\n      return null;\n    }\n  };\n\n  const apply = (patch: Record<string, any>) => {\n    if (!selectedObject) return;\n    selectedObject.set(patch);\n    selectedObject.setCoords && selectedObject.setCoords();\n    canvas && canvas.requestRenderAll();\n    if (history) history.saveState();\n  };\n\n  const alignHorizontalToFirst = (mode: 'left' | 'center' | 'right') => {\n    if (!canvas || !selectedObject) return;\n    const target = getFirstLayerRect();\n    if (!target) return;\n    const objRect = selectedObject.getBoundingRect();\n\n    let left = selectedObject.left || 0;\n    if (mode === 'left') {\n      left = target.left;\n    } else if (mode === 'center') {\n      left = target.left + (target.width - objRect.width) / 2;\n    } else if (mode === 'right') {\n      left = target.left + target.width - objRect.width;\n    }\n\n    apply({ left });\n  };\n\n  const alignVerticalToFirst = (mode: 'top' | 'middle' | 'bottom') => {\n    if (!canvas || !selectedObject) return;\n    const target = getFirstLayerRect();\n    if (!target) return;\n    const objRect = selectedObject.getBoundingRect();\n\n    let top = selectedObject.top || 0;\n    if (mode === 'top') {\n      top = target.top;\n    } else if (mode === 'middle') {\n      top = target.top + (target.height - objRect.height) / 2;\n    } else if (mode === 'bottom') {\n      top = target.top + target.height - objRect.height;\n    }\n\n    apply({ top });\n  };\n\n  return (\n    <div style={{ padding: 12 }}>\n      <div style={{ marginBottom: 6 }}>\n        <strong>Align to First Layer</strong>\n      </div>\n      <div style={{ marginBottom: 8 }}>\n        <Space>\n          <Button onClick={() => alignHorizontalToFirst('left')}>H: Left</Button>\n          <Button onClick={() => alignHorizontalToFirst('center')}>H: Center</Button>\n          <Button onClick={() => alignHorizontalToFirst('right')}>H: Right</Button>\n        </Space>\n      </div>\n      <div>\n        <Space>\n          <Button onClick={() => alignVerticalToFirst('top')}>V: Top</Button>\n          <Button onClick={() => alignVerticalToFirst('middle')}>V: Middle</Button>\n          <Button onClick={() => alignVerticalToFirst('bottom')}>V: Bottom</Button>\n        </Space>\n      </div>\n    </div>\n  );\n};\n\nexport default AlignControls;\n","import React from 'react';\nimport { usePhotoEditor } from '../context';\nimport AdjustmentPanel from './AdjustmentPanel';\nimport BrushPanel from './BrushPanel';\nimport TextStylePanel from './TextStylePanel';\nimport AlignControls from './AlignControls';\n\nconst PropertiesPanel: React.FC = () => {\n  const { activeTool, selectedObject } = usePhotoEditor();\n\n  if (activeTool === 'brush') return <BrushPanel />;\n\n  if (activeTool === 'text') return <TextStylePanel />;\n\n  // if a text object is selected, show text panel too\n  if (selectedObject && (selectedObject as any).isType === 'i-text')\n    return (\n      <>\n        <TextStylePanel />\n        <AlignControls />\n      </>\n    );\n\n  if (selectedObject)\n    return (\n      <>\n        <AdjustmentPanel />\n        <AlignControls />\n      </>\n    );\n\n  return <AdjustmentPanel />;\n};\n\nexport default PropertiesPanel;\n","import React from 'react';\nimport { Upload } from 'antd';\nimport { InboxOutlined } from '@ant-design/icons';\n\ninterface UploadAreaProps {\n  onUpload: (file: File) => boolean | void;\n}\n\nconst UploadArea: React.FC<UploadAreaProps> = ({ onUpload }) => {\n  return (\n    <Upload.Dragger\n      beforeUpload={onUpload}\n      showUploadList={false}\n      accept=\".png,.jpg,.jpeg\"\n      height={200}\n    >\n      <p className=\"ant-upload-drag-icon\">\n        <InboxOutlined />\n      </p>\n      <p className=\"ant-upload-text\">Click or drag file to this area to upload</p>\n      <p className=\"ant-upload-hint\">\n        Support for a single upload. You can also paste an image from clipboard.\n      </p>\n    </Upload.Dragger>\n  );\n};\n\nexport default UploadArea;\n","import { useState, useEffect, useRef, useCallback } from 'react';\nimport { message } from 'antd';\nimport { SavedProject } from '../types';\n\nexport const useImageUpload = () => {\n  const [preview, setPreview] = useState<string | null>(null);\n  const [initialProject, setInitialProject] = useState<SavedProject | null>(null);\n  const [addOnFile, setAddOnFile] = useState<File | null>(null);\n  const [dragging, setDragging] = useState(false);\n  const dragCounter = useRef(0);\n\n  const handleUpload = useCallback(\n    (file: File) => {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        if (preview) {\n          setAddOnFile(file);\n        } else {\n          setPreview(e.target?.result as string);\n          setInitialProject(null);\n        }\n      };\n      reader.readAsDataURL(file);\n      setDragging(false);\n      dragCounter.current = 0;\n      return false;\n    },\n    [preview],\n  );\n\n  const loadProject = useCallback((project: SavedProject) => {\n    setInitialProject(project);\n    setPreview(project.thumbnail);\n  }, []);\n\n  const handleClear = useCallback(() => {\n    setPreview(null);\n    setAddOnFile(null);\n    setInitialProject(null);\n    message.info('Image cleared.');\n  }, []);\n\n  // --- Clipboard paste support ---\n  useEffect(() => {\n    const handlePaste = (e: ClipboardEvent) => {\n      const items = e.clipboardData?.items;\n      if (!items) return;\n\n      const imageItem = Array.from(items).find((item) => item.type.includes('image'));\n      if (imageItem) {\n        const blob = imageItem.getAsFile();\n        if (blob) {\n          handleUpload(blob);\n          message.success('Image pasted from clipboard!');\n          e.preventDefault();\n        }\n      }\n    };\n\n    window.addEventListener('paste', handlePaste);\n    return () => window.removeEventListener('paste', handlePaste);\n  }, [handleUpload]);\n\n  return {\n    preview,\n    setPreview, // Exposed if needed\n    addOnFile,\n    setAddOnFile,\n    dragging,\n    setDragging,\n    dragCounter,\n    handleUpload,\n    handleClear,\n    loadProject,\n    initialProject,\n  };\n};\n","\nimport \"/home/thanhnd/Downloads/code/ultimate-tool-web/src/pages/PhotoEditor/styles.less?modules\";\nexport default {\"propertiesSider\": `propertiesSider-YRVduwgD`,\"panelHeader\": `panelHeader-hIGLou-U`,\"toolButton\": `toolButton-n4oL9CVE`,\"active\": `active-U2nrVjVN`,\"layerItem\": `layerItem-T1HNTXOA`,\"toolbarSider\": `toolbarSider-ECMIrGgY`,\"panelContent\": `panelContent-S7N1Mu8e`,\"editorContainer\": `editorContainer-SPg3koCD`,\"canvasContent\": `canvasContent-Lj9buPhs`}\n","import React from 'react';\nimport { PageContainer } from '@ant-design/pro-components';\nimport { Card, Layout, Tag, Divider } from 'antd';\nimport DragDropWrapper from '@/components/DragDropWrapper';\nimport DragOverlay from '@/components/DragOverlay';\nimport { PhotoEditorProvider } from './context';\nimport Toolbar from './components/Toolbar';\nimport CanvasArea from './components/CanvasArea';\nimport LayersPanel from './components/LayersPanel';\nimport PropertiesPanel from './components/PropertiesPanel';\nimport UploadArea from './components/UploadArea';\nimport SavedProjectsList from './components/SavedProjectsList';\nimport { useImageUpload } from './hooks/useImageUpload';\nimport { useProjects } from './hooks/useProjects';\nimport styles from './styles.less';\n\nconst { Sider, Content } = Layout;\n\nconst PhotoEditor: React.FC = () => {\n  const {\n    preview,\n    dragging,\n    setDragging,\n    dragCounter,\n    handleUpload,\n    addOnFile,\n    setAddOnFile,\n    loadProject,\n    initialProject,\n  } = useImageUpload();\n\n  const { savedProjects, deleteProject } = useProjects();\n\n  return (\n    <PageContainer\n      title={\n        <span>\n          Photo Editor <Tag color=\"cyan\">Beta</Tag>\n        </span>\n      }\n    >\n      <DragDropWrapper\n        setDragging={setDragging}\n        dragCounter={dragCounter}\n        handleUpload={handleUpload}\n      >\n        <Card className={styles.editorContainer} bodyStyle={{ padding: 0, height: '100%' }}>\n          {dragging && <DragOverlay />}\n\n          {!preview ? (\n            <div\n              style={{\n                display: 'flex',\n                flexDirection: 'column',\n                justifyContent: 'center',\n                alignItems: 'center',\n                height: '100%',\n                padding: '20px',\n                overflowY: 'auto',\n              }}\n            >\n              <UploadArea onUpload={handleUpload} />\n              {savedProjects.length > 0 && (\n                <div style={{ width: '100%', maxWidth: '800px', marginTop: '40px' }}>\n                  <Divider>Or Open Saved Project</Divider>\n                  <SavedProjectsList\n                    projects={savedProjects}\n                    onLoad={loadProject}\n                    onDelete={deleteProject}\n                  />\n                </div>\n              )}\n            </div>\n          ) : (\n            <PhotoEditorProvider\n              imageUrl={preview}\n              initialProject={initialProject}\n              addOnFile={addOnFile}\n              setAddOnFile={setAddOnFile}\n            >\n              <Layout style={{ height: '100%' }}>\n                <Sider theme=\"light\" width={60} className={styles.toolbarSider}>\n                  <Toolbar />\n                </Sider>\n                <Content className={styles.canvasContent}>\n                  <CanvasArea />\n                </Content>\n                <Sider theme=\"light\" width={300} className={styles.propertiesSider}>\n                  <PropertiesPanel />\n                  <LayersPanel />\n                </Sider>\n              </Layout>\n            </PhotoEditorProvider>\n          )}\n        </Card>\n      </DragDropWrapper>\n    </PageContainer>\n  );\n};\n\nexport default PhotoEditor;\n","import { useState, useCallback, useEffect } from 'react';\nimport { Canvas } from 'fabric';\n\nexport const useHistory = (canvas: Canvas | null) => {\n  const [history, setHistory] = useState<string[]>([]);\n  const [historyIndex, setHistoryIndex] = useState<number>(-1);\n  const [isHistoryProcessing, setIsHistoryProcessing] = useState<boolean>(false);\n\n  const saveState = useCallback(() => {\n    if (!canvas || isHistoryProcessing) return;\n\n    const json = JSON.stringify(canvas.toJSON());\n\n    // Avoid saving duplicate states\n    if (history.length > 0 && historyIndex >= 0 && history[historyIndex] === json) {\n      return;\n    }\n\n    // If we are in the middle of the history, discard the future\n    const newHistory = history.slice(0, historyIndex + 1);\n    newHistory.push(json);\n\n    // Limit history size if needed (e.g., 50)\n    if (newHistory.length > 50) {\n      newHistory.shift();\n    }\n\n    setHistory(newHistory);\n    setHistoryIndex(newHistory.length - 1);\n  }, [canvas, history, historyIndex, isHistoryProcessing]);\n\n  useEffect(() => {\n    if (!canvas) return;\n\n    const handleSave = () => {\n      saveState();\n    };\n\n    canvas.on('object:modified', handleSave);\n    canvas.on('object:added', handleSave);\n    canvas.on('object:removed', handleSave);\n    canvas.on('path:created', handleSave);\n\n    return () => {\n      canvas.off('object:modified', handleSave);\n      canvas.off('object:added', handleSave);\n      canvas.off('object:removed', handleSave);\n      canvas.off('path:created', handleSave);\n    };\n  }, [canvas, saveState]);\n\n  const undo = useCallback(() => {\n    if (!canvas || historyIndex <= 0 || isHistoryProcessing) return;\n\n    setIsHistoryProcessing(true);\n    const newIndex = historyIndex - 1;\n    const json = history[newIndex];\n\n    canvas.loadFromJSON(JSON.parse(json)).then(() => {\n      canvas.renderAll();\n      setHistoryIndex(newIndex);\n      setIsHistoryProcessing(false);\n    });\n  }, [canvas, history, historyIndex, isHistoryProcessing]);\n\n  const redo = useCallback(() => {\n    if (!canvas || historyIndex >= history.length - 1 || isHistoryProcessing) return;\n\n    setIsHistoryProcessing(true);\n    const newIndex = historyIndex + 1;\n    const json = history[newIndex];\n\n    canvas.loadFromJSON(JSON.parse(json)).then(() => {\n      canvas.renderAll();\n      setHistoryIndex(newIndex);\n      setIsHistoryProcessing(false);\n    });\n  }, [canvas, history, historyIndex, isHistoryProcessing]);\n\n  return {\n    saveState,\n    undo,\n    redo,\n    canUndo: historyIndex > 0,\n    canRedo: historyIndex < history.length - 1,\n  };\n};\n","import React, { createContext, useContext, useState } from 'react';\nimport { Canvas, FabricObject } from 'fabric';\nimport { useHistory } from './hooks/useHistory';\n\ninterface PhotoEditorContextType {\n  canvas: Canvas | null;\n  setCanvas: (canvas: Canvas) => void;\n  activeTool: string;\n  setActiveTool: (tool: string) => void;\n  selectedObject: FabricObject | null;\n  setSelectedObject: (object: FabricObject | null) => void;\n  history: {\n    saveState: () => void;\n    undo: () => void;\n    redo: () => void;\n    canUndo: boolean;\n    canRedo: boolean;\n  };\n  clipboard: FabricObject | null;\n  setClipboard: (object: FabricObject | null) => void;\n  imageUrl?: string | null;\n  initialProject?: any;\n  addOnFile?: File | null;\n  setAddOnFile?: (file: File | null) => void;\n  brushSize: number;\n  setBrushSize: (size: number) => void;\n  brushColor: string;\n  setBrushColor: (color: string) => void;\n  brushOpacity: number;\n  setBrushOpacity: (opacity: number) => void;\n}\n\nconst PhotoEditorContext = createContext<PhotoEditorContextType | undefined>(undefined);\n\nexport const PhotoEditorProvider: React.FC<{\n  children: React.ReactNode;\n  imageUrl?: string | null;\n  initialProject?: any;\n  addOnFile?: File | null;\n  setAddOnFile?: (file: File | null) => void;\n}> = ({ children, imageUrl, initialProject, addOnFile, setAddOnFile }) => {\n  const [canvas, setCanvas] = useState<Canvas | null>(null);\n  const [activeTool, setActiveTool] = useState<string>('select');\n  const [selectedObject, setSelectedObject] = useState<FabricObject | null>(null);\n  const [clipboard, setClipboard] = useState<FabricObject | null>(null);\n  const [brushSize, setBrushSize] = useState<number>(5);\n  const [brushColor, setBrushColor] = useState<string>('#000000');\n  const [brushOpacity, setBrushOpacity] = useState<number>(1);\n\n  const history = useHistory(canvas);\n\n  return (\n    <PhotoEditorContext.Provider\n      value={{\n        canvas,\n        setCanvas,\n        activeTool,\n        setActiveTool,\n        selectedObject,\n        setSelectedObject,\n        history,\n        clipboard,\n        setClipboard,\n        imageUrl,\n        initialProject,\n        addOnFile,\n        setAddOnFile,\n        brushSize,\n        setBrushSize,\n        brushColor,\n        setBrushColor,\n        brushOpacity,\n        setBrushOpacity,\n      }}\n    >\n      {children}\n    </PhotoEditorContext.Provider>\n  );\n};\nexport const usePhotoEditor = () => {\n  const context = useContext(PhotoEditorContext);\n  if (!context) {\n    throw new Error('usePhotoEditor must be used within a PhotoEditorProvider');\n  }\n  return context;\n};\n"],"names":[],"mappings":"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"}