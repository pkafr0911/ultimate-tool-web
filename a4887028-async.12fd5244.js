(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]||[]).push([["a4887028"],{"64e5c822":function(e,t,a){a.d(t,"__esModule",{value:!0}),a.e(t,{default:function(){return eF;}});var l=a("777fffbe"),i=a("852bbaa9"),o=a("1a7c85b4"),n=a("d322be42"),r=i._(n),s=a("28c7d19c"),d=a("b2a1469e"),c=l._(d),u=a("e9bcd22d"),f=l._(u),h=a("ea21718c"),m=l._(h),p=a("81826b90"),g=l._(p),w=a("059a9d9c"),x=l._(w),y=a("d70e0f0a"),b=l._(y),j=a("1c8d1214"),v=l._(j),k=a("6effc0fd"),_=l._(k),C=a("d2d0b3b6"),T=l._(C),S={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M881 442.4H519.7v148.5h206.4c-8.9 48-35.9 88.6-76.6 115.8-34.4 23-78.3 36.6-129.9 36.6-99.9 0-184.4-67.5-214.6-158.2-7.6-23-12-47.6-12-72.9s4.4-49.9 12-72.9c30.3-90.6 114.8-158.1 214.7-158.1 56.3 0 106.8 19.4 146.6 57.4l110-110.1c-66.5-62-153.2-100-256.6-100-149.9 0-279.6 86-342.7 211.4-26 51.8-40.8 110.4-40.8 172.4S151 632.8 177 684.6C240.1 810 369.8 896 519.7 896c103.6 0 190.4-34.4 253.8-93 72.5-66.8 114.4-165.2 114.4-282.1 0-27.2-2.4-53.3-6.9-78.5z"}}]},name:"google",theme:"outlined"},L=a("85c4e0d9"),z=l._(L),E=r.forwardRef(function(e,t){return r.createElement(z.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:S}));}),I=a("4639ad3b"),A=l._(I),$=a("b2ef07e9"),U=l._($);let D={...a("2f0ebcbc").env,...window.env},N={reCaptchaKey:D.REACT_APP_SITE_KEY||"6LdcMO4qAAAAAImNBNufpkw6wQTCeu-pfYZAKWap",googleClientId:D.REACT_APP_GOOGLE_CLIENT_ID||"413586944281-dcb5psdo92s8ch6ee66a4uoaf82s3gja.apps.googleusercontent.com"}.googleClientId,P=()=>{let[e,t]=(0,r.useState)(null),[a,l]=(0,r.useState)(null),[i,o]=(0,r.useState)(null),[n,s]=(0,r.useState)(0);(0,r.useEffect)(()=>{let e=document.createElement("script");return e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.onload=()=>{window.google&&N&&t(window.google.accounts.oauth2.initTokenClient({client_id:N,scope:"openid profile email https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/drive.metadata.readonly",callback:e=>{if(console.log("Google Auth Response:",e),e.access_token){l(e.access_token);let t=Number(e.expires_in);s(Date.now()+1e3*t),d(e.access_token);}else console.error("No access token in response",e);}}));},document.body.appendChild(e),()=>{document.body.removeChild(e);};},[]);let d=async e=>{try{console.log("Fetching user info with token:",e.substring(0,10)+"...");let t=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${e}`}});if(t.ok){let e=await t.json();console.log("User Info:",e),o({name:e.name,email:e.email,picture:e.picture});}else{console.error("Failed to fetch user info:",t.status,t.statusText);let e=await t.text();console.error("Error details:",e);}}catch(e){console.error("Failed to fetch user info",e);}},c=(0,r.useCallback)(()=>{e&&e.requestAccessToken();},[e]),u=(0,r.useCallback)(()=>{window.google&&a?window.google.accounts.oauth2.revoke(a,()=>{l(null),o(null);}):(l(null),o(null));},[a]);return{user:i,isSignedIn:!!a,accessToken:a,signIn:c,signOut:u};};var M=a("c9d8dc0b"),R=l._(M);let O="https://www.googleapis.com/drive/v3",F=(e="",t=20,a="",l="folder,name")=>{let i=new URLSearchParams({pageSize:t.toString(),fields:"nextPageToken, files(id, name, mimeType, size, thumbnailLink, iconLink, createdTime, modifiedTime, parents, owners, capabilities, webViewLink, trashed)",orderBy:l,q:e||"trashed = false"});return a&&i.append("pageToken",a),i.toString();},B=async(e,t)=>{let a=await fetch(`${O}/files?${t}`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok){let e=await a.text();throw console.error("Drive API List Error:",a.status,e),Error(`Drive API Error: ${a.status} ${a.statusText} - ${e}`);}return a.json();},G=async(e,t)=>{let a=await fetch(`${O}/files/${t}?fields=id,name,mimeType,size,createdTime,modifiedTime,parents,owners,capabilities,webViewLink,thumbnailLink,iconLink`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok)throw Error("Failed to fetch file metadata");return a.json();},H=async(e,t)=>{let a=await fetch(`${O}/files/${t}?alt=media`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok)throw Error("Download failed");return a.blob();},V=async(e,t,a)=>{let l={name:t.name,mimeType:t.type,parents:a?[a]:[]},i=await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=resumable",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(l)});if(!i.ok)throw Error("Failed to start upload session");let o=i.headers.get("Location");if(!o)throw Error("No upload location returned");return o;},K=async(e,t,a,l)=>{let i=a+t.size-1,o=await fetch(e,{method:"PUT",headers:{"Content-Range":`bytes ${a}-${i}/${l}`},body:t});if(308!==o.status&&!o.ok)throw Error("Chunk upload failed");return o;},W=e=>{let t=(0,r.useCallback)(async(t="root",a,l)=>{if(!e)throw Error("Not authenticated");return B(e,F(`'${t}' in parents and trashed = false`,20,a,l));},[e]);return{list:t,getMetadata:(0,r.useCallback)(async t=>{if(!e)throw Error("Not authenticated");return G(e,t);},[e]),download:(0,r.useCallback)(async(t,a)=>{if(!e)throw Error("Not authenticated");try{let l=await H(e,t),i=window.URL.createObjectURL(l),o=document.createElement("a");o.href=i,o.download=a,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(i),document.body.removeChild(o);}catch(e){R.default.error("Download failed"),console.error(e);}},[e]),upload:(0,r.useCallback)(async(t,a="root",l)=>{if(!e)throw Error("Not authenticated");try{let i=await V(e,t,a),o=0,n=t.size;for(;o<n;){let e=t.slice(o,o+262144);await K(i,e,o,n),o+=e.size,l&&l(Math.round(o/n*100));}R.default.success("Upload complete");}catch(e){R.default.error("Upload failed"),console.error(e);}},[e])};};var q=a("9e9bfd47"),Y=l._(q),J=a("d4a32650"),Q=l._(J),Z=a("ee1a90c6"),X=l._(Z),ee=a("1aa82c2f"),et=l._(ee),ea=r.forwardRef(function(e,t){return r.createElement(z.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:et.default}));}),el=a("36ede29e"),ei=l._(el),eo={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M531.3 574.4l.3-1.4c5.8-23.9 13.1-53.7 7.4-80.7-3.8-21.3-19.5-29.6-32.9-30.2-15.8-.7-29.9 8.3-33.4 21.4-6.6 24-.7 56.8 10.1 98.6-13.6 32.4-35.3 79.5-51.2 107.5-29.6 15.3-69.3 38.9-75.2 68.7-1.2 5.5.2 12.5 3.5 18.8 3.7 7 9.6 12.4 16.5 15 3 1.1 6.6 2 10.8 2 17.6 0 46.1-14.2 84.1-79.4 5.8-1.9 11.8-3.9 17.6-5.9 27.2-9.2 55.4-18.8 80.9-23.1 28.2 15.1 60.3 24.8 82.1 24.8 21.6 0 30.1-12.8 33.3-20.5 5.6-13.5 2.9-30.5-6.2-39.6-13.2-13-45.3-16.4-95.3-10.2-24.6-15-40.7-35.4-52.4-65.8zM421.6 726.3c-13.9 20.2-24.4 30.3-30.1 34.7 6.7-12.3 19.8-25.3 30.1-34.7zm87.6-235.5c5.2 8.9 4.5 35.8.5 49.4-4.9-19.9-5.6-48.1-2.7-51.4.8.1 1.5.7 2.2 2zm-1.6 120.5c10.7 18.5 24.2 34.4 39.1 46.2-21.6 4.9-41.3 13-58.9 20.2-4.2 1.7-8.3 3.4-12.3 5 13.3-24.1 24.4-51.4 32.1-71.4zm155.6 65.5c.1.2.2.5-.4.9h-.2l-.2.3c-.8.5-9 5.3-44.3-8.6 40.6-1.9 45 7.3 45.1 7.4zm191.4-388.2L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file-pdf",theme:"outlined"},en=r.forwardRef(function(e,t){return r.createElement(z.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:eo}));}),er=a("f6c9c5f6"),es=l._(er),ed=a("0c6a5e53"),ec=l._(ed);let{Text:eu}=_.default,ef=e=>"application/vnd.google-apps.folder"===e?(0,o.jsx)(ea,{style:{color:"#faad14"}}):e.includes("image")?(0,o.jsx)(ei.default,{style:{color:"#52c41a"}}):e.includes("pdf")?(0,o.jsx)(en,{style:{color:"#f5222d"}}):(0,o.jsx)(X.default,{}),eh=({files:e,loading:t,onFolderClick:a,onPreview:l,onDetail:i,onLoadMore:n,hasMore:r})=>{let s=[{title:"Name",dataIndex:"name",key:"name",render:(e,t)=>(0,o.jsxs)(m.default,{style:{cursor:"pointer"},onClick:()=>{"application/vnd.google-apps.folder"===t.mimeType?a(t):l(t);},children:[ef(t.mimeType),(0,o.jsx)(eu,{children:e})]})},{title:"Size",dataIndex:"size",key:"size",width:120,render:e=>e?(parseInt(e)/1024/1024).toFixed(2)+" MB":"-"},{title:"Modified",dataIndex:"modifiedTime",key:"modifiedTime",width:200,render:e=>new Date(e).toLocaleString()},{title:"Actions",key:"actions",width:150,render:(e,t)=>(0,o.jsxs)(m.default,{children:[(0,o.jsx)(Q.default,{title:"Preview",children:(0,o.jsx)(c.default,{type:"text",icon:(0,o.jsx)(es.default,{}),onClick:()=>l(t)})}),(0,o.jsx)(Q.default,{title:"Details",children:(0,o.jsx)(c.default,{type:"text",icon:(0,o.jsx)(ec.default,{}),onClick:()=>i(t)})})]})}];return(0,o.jsx)(Y.default,{dataSource:e,columns:s,rowKey:"id",loading:t,pagination:!1,footer:()=>r?(0,o.jsx)("div",{style:{textAlign:"center"},children:(0,o.jsx)(c.default,{onClick:n,loading:t,children:"Load More"})}):null});};var em=a("5495e753"),ep=l._(em),eg=a("6b280fda"),ew=l._(eg),ex=a("1ffd224b"),ey=l._(ex),eb=a("07d5c3d6"),ej=l._(eb),ev=a("a856926c"),ek=l._(ev);let e_=({file:e,visible:t,onClose:a,accessToken:l})=>{var i;let{download:n}=W(l);return e?(0,o.jsx)(ep.default,{title:"File Details",placement:"right",onClose:a,open:t,width:400,children:(0,o.jsxs)(m.default,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,o.jsx)("div",{style:{textAlign:"center"},children:e.thumbnailLink?(0,o.jsx)(ey.default,{src:e.thumbnailLink,alt:e.name,style:{maxHeight:200}}):(0,o.jsx)("div",{style:{height:100,background:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center"},children:"No Preview"})}),(0,o.jsxs)(ew.default,{column:1,bordered:!0,children:[(0,o.jsx)(ew.default.Item,{label:"Name",children:e.name}),(0,o.jsx)(ew.default.Item,{label:"Type",children:e.mimeType}),(0,o.jsx)(ew.default.Item,{label:"Size",children:e.size?(parseInt(e.size)/1024/1024).toFixed(2)+" MB":"-"}),(0,o.jsx)(ew.default.Item,{label:"Created",children:new Date(e.createdTime||"").toLocaleString()}),(0,o.jsx)(ew.default.Item,{label:"Modified",children:new Date(e.modifiedTime||"").toLocaleString()}),(0,o.jsx)(ew.default.Item,{label:"Owner",children:null===(i=e.owners)||void 0===i?void 0:i.map(e=>e.displayName).join(", ")})]}),(0,o.jsxs)(m.default,{direction:"vertical",style:{width:"100%"},children:[(0,o.jsx)(c.default,{block:!0,icon:(0,o.jsx)(ej.default,{}),onClick:()=>n(e.id,e.name),children:"Download"}),(0,o.jsx)(c.default,{block:!0,icon:(0,o.jsx)(ek.default,{}),href:e.webViewLink,target:"_blank",children:"Open in Drive"})]})]})}):null;};var eC=a("dfa4ac87"),eT=l._(eC),eS=a("6caefff4"),eL=l._(eS),ez=a("ad84e91c"),eE=l._(ez);let eI=({file:e,visible:t,onClose:a,accessToken:l})=>{let[i,n]=(0,r.useState)(null),[s,d]=(0,r.useState)(!1),[u,f]=(0,r.useState)(null);(0,r.useEffect)(()=>{t&&e&&l?h():(n(null),f(null));},[t,e,l]);let h=async()=>{if(e&&l){d(!0),f(null);try{if(e.mimeType.startsWith("image/")){let t=await H(l,e.id),a=URL.createObjectURL(t);n(a);}else if("application/pdf"===e.mimeType){let t=await H(l,e.id),a=URL.createObjectURL(t);n(a);}else f("Preview not supported for this file type.");}catch(e){f("Failed to load preview.");}finally{d(!1);}}};return(0,o.jsx)(eT.default,{title:null==e?void 0:e.name,open:t,onCancel:a,footer:null,width:800,centered:!0,destroyOnClose:!0,children:(0,o.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:300},children:s?(0,o.jsx)(eL.default,{size:"large"}):u?(0,o.jsx)(eE.default,{status:"info",title:"Preview Unavailable",subTitle:u,extra:(0,o.jsx)(c.default,{type:"primary",href:null==e?void 0:e.webViewLink,target:"_blank",children:"Open in Google Drive"})}):(null==e?void 0:e.mimeType.startsWith("image/"))?(0,o.jsx)("img",{src:i||"",alt:e.name,style:{maxWidth:"100%",maxHeight:"80vh"}}):(null==e?void 0:e.mimeType)==="application/pdf"?(0,o.jsx)("iframe",{src:i||"",style:{width:"100%",height:"80vh",border:"none"}}):null})});};var eA=a("34f06567"),e$=l._(eA),eU=a("cb3849a3"),eD=l._(eU),eN=a("e21451ef"),eP=l._(eN);let{Dragger:eM}=e$.default,{Text:eR}=_.default,eO=({visible:e,onClose:t,parentId:a,accessToken:l,onComplete:i})=>{let{upload:n}=W(l),[s,d]=(0,r.useState)(!1),[u,f]=(0,r.useState)(0),[h,m]=(0,r.useState)(""),p=async e=>{d(!0),m(e.name),f(0);try{await n(e,a,e=>f(e)),R.default.success(`${e.name} uploaded successfully`),i();}catch(t){R.default.error(`Failed to upload ${e.name}`);}finally{d(!1),m(""),f(0);}return!1;};return(0,o.jsxs)(eT.default,{title:"Upload Files",open:e,onCancel:s?void 0:t,footer:[(0,o.jsx)(c.default,{onClick:t,disabled:s,children:"Close"},"close")],children:[(0,o.jsxs)(eM,{beforeUpload:p,showUploadList:!1,disabled:s,multiple:!1,children:[(0,o.jsx)("p",{className:"ant-upload-drag-icon",children:(0,o.jsx)(eP.default,{})}),(0,o.jsx)("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),(0,o.jsx)("p",{className:"ant-upload-hint",children:"Support for a single or bulk upload. Strictly prohibit from uploading company data or other band files"})]}),s&&(0,o.jsxs)("div",{style:{marginTop:16},children:[(0,o.jsxs)(eR,{children:["Uploading ",h,"..."]}),(0,o.jsx)(eD.default,{percent:u,status:"active"})]})]});},eF=()=>{let{user:e,isSignedIn:t,accessToken:a,signIn:l,signOut:i}=P(),{list:n}=W(a),[d,u]=(0,r.useState)("root"),[h,p]=(0,r.useState)([{id:"root",name:"My Drive"}]),[w,y]=(0,r.useState)([]),[j,k]=(0,r.useState)(!1),[C,T]=(0,r.useState)(void 0),[S,L]=(0,r.useState)(null),[z,I]=(0,r.useState)(null),[$,D]=(0,r.useState)(!1),N=async(e,a)=>{if(t){k(!0);try{let t=await n(e,a);y(a?[...w,...t.files]:t.files),T(t.nextPageToken);}catch(e){console.error(e);}finally{k(!1);}}};(0,r.useEffect)(()=>{t?N(d):y([]);},[t,d]);let M=e=>{let t=h.slice(0,e+1);p(t),u(t[t.length-1].id);},R=(0,o.jsx)(v.default,{items:[{key:"logout",icon:(0,o.jsx)(A.default,{}),label:"Sign Out",onClick:i}]});return(0,o.jsxs)(s.PageContainer,{header:{title:"Google Drive Manager",extra:[t?(0,o.jsxs)(m.default,{children:[(0,o.jsx)(c.default,{icon:(0,o.jsx)(U.default,{}),onClick:()=>D(!0),children:"Upload"}),(0,o.jsx)(b.default,{overlay:R,children:(0,o.jsxs)(m.default,{style:{cursor:"pointer"},children:[(0,o.jsx)(x.default,{src:null==e?void 0:e.picture,icon:(0,o.jsx)(E,{})}),(0,o.jsx)(_.default.Text,{children:null==e?void 0:e.name})]})})]},"actions"):(0,o.jsx)(c.default,{type:"primary",icon:(0,o.jsx)(E,{}),onClick:l,children:"Sign in with Google"},"login")]},children:[(0,o.jsx)(f.default,{children:t?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(g.default,{style:{marginBottom:16},children:h.map((e,t)=>(0,o.jsx)(g.default.Item,{onClick:()=>M(t),href:"#",children:e.name},e.id))}),(0,o.jsx)(eh,{files:w,loading:j,onFolderClick:e=>{u(e.id),p([...h,{id:e.id,name:e.name}]);},onPreview:e=>I(e),onDetail:e=>L(e),onLoadMore:()=>N(d,C),hasMore:!!C})]}):(0,o.jsxs)("div",{style:{textAlign:"center",padding:"50px"},children:[(0,o.jsx)(E,{style:{fontSize:48,color:"#1890ff",marginBottom:16}}),(0,o.jsx)(_.default.Title,{level:4,children:"Please sign in to access your Google Drive"})]})}),(0,o.jsx)(e_,{file:S,visible:!!S,onClose:()=>L(null),accessToken:a}),(0,o.jsx)(eI,{file:z,visible:!!z,onClose:()=>I(null),accessToken:a}),(0,o.jsx)(eO,{visible:$,onClose:()=>D(!1),parentId:d,accessToken:a,onComplete:()=>N(d)})]});};}}]);
//# sourceMappingURL=a4887028-async.12fd5244.js.map