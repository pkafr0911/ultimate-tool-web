(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]||[]).push([["2ed777c5"],{"0426e8b0":function(e,t,r){r.d(t,"__esModule",{value:!0}),r.e(t,{default:function(){return e8;}});var n=r("777fffbe"),l=r("852bbaa9"),a=r("95bd365d"),i=r("a4f51854"),s=n._(i),o=r("d6f53458"),d=n._(o),u=r("434db6d0"),c=r("4f4539af"),h=n._(c),f=r("1d2482ba"),g=n._(f),x=r("2ac36d38"),m=n._(x),p=r("314fd1a3"),v=l._(p),w={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"}}]},name:"info-circle",theme:"outlined"},j=r("8fb0e3f9"),y=n._(j),C=v.forwardRef(function(e,t){return v.createElement(y.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:w}));}),b=r("d4f20bc1"),S=n._(b),k=v.forwardRef(function(e,t){return v.createElement(y.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:S.default}));}),R=r("5f92d263"),M=n._(R),L=r("0ec3d373"),E=n._(L),I=r("bb4b9fac"),B=n._(I),D=r("a9a67fa4"),_=n._(D),z=r("5a83e636"),P=n._(z),U=r("339facb1"),T=n._(U),G=r("05c9ca64"),H=n._(G),$=r("2206dff1"),A=n._($),N=r("cb204712"),V=n._(N),F=r("522a0302"),O=n._(F),W=r("e0fc3175"),X=n._(W),K=r("0ed998a9"),Y=n._(K),q=r("f9cbb0db"),J=n._(q),Z=r("90c13dc1"),Q=n._(Z),ee=r("4f331305"),et=n._(ee),er=r("d62d811b"),en=n._(er),el=r("5e015b19"),ea=n._(el),ei=r("a408d8c9"),es=n._(ei);function eo(e,t){let r=document.createElement("canvas");return r.width=e,r.height=t,r;}function ed(e,t,r){let n=e.width,l=e.height,a=e.data,i=new Uint8ClampedArray(a.length),s=Math.floor(r/2);for(let e=0;e<l;e++)for(let o=0;o<n;o++){let d=0,u=0,c=0,h=0;for(let i=0;i<r;i++)for(let f=0;f<r;f++){let g=o+f-s,x=e+i-s;if(g<0||g>=n||x<0||x>=l)continue;let m=(x*n+g)*4,p=t[i*r+f];d+=a[m]*p,u+=a[m+1]*p,c+=a[m+2]*p,h+=a[m+3]*p;}let f=(e*n+o)*4;i[f]=Math.min(255,Math.max(0,d)),i[f+1]=Math.min(255,Math.max(0,u)),i[f+2]=Math.min(255,Math.max(0,c)),i[f+3]=Math.min(255,Math.max(0,h||a[f+3]));}return e.data.set(i),e;}let eu={sharpen:[0,-1,0,-1,5,-1,0,-1,0],blur3:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],gaussian5:[1/273,4/273,7/273,4/273,1/273,4/273,16/273,26/273,16/273,4/273,7/273,26/273,41/273,26/273,7/273,4/273,16/273,26/273,16/273,4/273,1/273,4/273,7/273,4/273,1/273],generateBoxBlurKernel(e){let t=0|e,r=t*t;return Array(r).fill(1/r);},generateGaussianKernel(e){let t=0|e,r=t/2,n=2*r*r,l=[],a=0;for(let e=-t;e<=t;e++)for(let r=-t;r<=t;r++){let t=Math.exp(-(r*r+e*e)/n);l.push(t),a+=t;}return l.map(e=>e/a);}};function ec(e,t="image/png",r=.92){return new Promise(n=>e.toBlob(e=>n(e),t,r));}let eh=(e,t=0,r=255)=>Math.min(r,Math.max(t,e)),ef=e=>Math.min(1,Math.max(0,e)),eg=(e,t,r)=>{let n=Math.max(e/=255,t/=255,r/=255),l=Math.min(e,t,r),a=0,i=0,s=(n+l)/2;if(n!==l){let o=n-l;switch(i=s>.5?o/(2-n-l):o/(n+l),n){case e:a=(t-r)/o+(t<r?6:0);break;case t:a=(r-e)/o+2;break;case r:a=(e-t)/o+4;}a/=6;}return[a,i,s];},ex=(e,t,r)=>{let n,l,a;if(0===t)n=l=a=r;else{let i=(e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6)?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e,s=r<.5?r*(1+t):r+t-r*t,o=2*r-s;n=i(o,s,e+1/3),l=i(o,s,e),a=i(o,s,e-1/3);}return[Math.round(255*n),Math.round(255*l),Math.round(255*a)];},em=(e,{highlights:t=0,shadows:r=0,whites:n=0,blacks:l=0,vibrance:a=0,saturation:i=0,clarity:s=0,dehaze:o=0})=>{let d=e.data,u=0!==s?new Uint8ClampedArray(d):null;for(let e=0;e<d.length;e+=4){let c=d[e],h=d[e+1],f=d[e+2],g=.299*c+.587*h+.114*f;if(g>192&&0!==t){let e=(g-192)/63;c=eh(c+t*e),h=eh(h+t*e),f=eh(f+t*e);}if(g<64&&0!==r){let e=1-g/64;c=eh(c+r*e),h=eh(h+r*e),f=eh(f+r*e);}if(c=eh(c+n-l),h=eh(h+n-l),f=eh(f+n-l),0!==o&&(c=eh(c*(1+o/100)),h=eh(h*(1-o/200)),f=eh(f*(1-o/200))),0!==a||0!==i){let e=[c,h,f];ev(e,0,{vibrance:a,saturation:i}),[c,h,f]=e;}if(0!==s&&u){let t=s/100*(g-(.299*u[e]+.587*u[e+1]+.114*u[e+2]));c=eh(c+t),h=eh(h+t),f=eh(f+t);}d[e]=c,d[e+1]=h,d[e+2]=f;}return e;},ep=(e,t,r)=>{let[n,l,a]=eg(e[t],e[t+1],e[t+2]);a=ef(a*(1+r/100));let[i,s,o]=ex(n,l=ef(l*(1-Math.abs(r)/300)),a);e[t]=i,e[t+1]=s,e[t+2]=o;},ev=(e,t,{vibrance:r=0,saturation:n=0})=>{let[l,a,i]=eg(e[t],e[t+1],e[t+2]);0!==n&&(a=ef(a*(1+n/100))),0!==r&&(a=ef(a+r/100*(1-a)*(1-a)));let[s,o,d]=ex(l,a,i);e[t]=s,e[t+1]=o,e[t+2]=d;},ew=[{name:"red",range:[345,15]},{name:"orange",range:[15,45]},{name:"yellow",range:[45,75]},{name:"green",range:[75,165]},{name:"aqua",range:[165,195]},{name:"blue",range:[195,255]},{name:"purple",range:[255,285]},{name:"magenta",range:[285,345]}],ej=(e,t)=>{let r=e.data;for(let e=0;e<r.length;e+=4){let[n,l,a]=[r[e],r[e+1],r[e+2]],[i,s,o]=eg(n,l,a),d=(360*i+360)%360,u=ew.find(({range:e})=>{let[t,r]=e;return t<=r?d>=t&&d<=r:d>=t||d<=r;});if(!u){[r[e],r[e+1],r[e+2]]=ex(i,s,o);continue;}let c=t[u.name];if(!c){[r[e],r[e+1],r[e+2]]=ex(i,s,o);continue;}let[h,f]=u.range,g=f;h>g&&(g+=360);let x=d;if(x<h&&(x+=360),"number"==typeof c.h&&0!==c.h){let e=x+c.h;e<h&&(e=h),e>g&&(e=g),i=(d=(e%360+360)%360)/360;}"number"==typeof c.s&&0!==c.s&&(s=ef(s*(1+(1>=Math.abs(c.s)?100*c.s:c.s)/100))),"number"==typeof c.l&&0!==c.l&&(o=ef(o*(1+(1>=Math.abs(c.l)?100*c.l:c.l)/100))),[r[e],r[e+1],r[e+2]]=ex(i,s,o);}return e;},ey=(e,t,r,n)=>{if(!t.current)return;let l=t.current,a=eo(l.width,l.height);a.getContext("2d").drawImage(l,0,0);let i=eo(l.height,l.width),s=i.getContext("2d");s.translate(i.width/2,i.height/2),s.rotate(e*Math.PI/180),s.drawImage(a,-a.width/2,-a.height/2),t.current.width=i.width,t.current.height=i.height,r.current.width=i.width,r.current.height=i.height;let o=t.current.getContext("2d");o.clearRect(0,0,i.width,i.height),o.drawImage(i,0,0),n.push(t.current.toDataURL(),`Rotate ${e}`);},eC=async(e=!1,t,r)=>{if(!t.current)return;let n=await ec(t.current,e?"image/jpeg":"image/png",.92);r&&r(n);let l=URL.createObjectURL(n),a=document.createElement("a");a.href=l,a.download=e?"edited.jpg":"edited.png",a.click(),URL.revokeObjectURL(l),Y.default.success("Exported image");},eb=async e=>{if(e.current)try{let t=await ec(e.current,"image/png");await navigator.clipboard.write([new ClipboardItem({"image/png":t})]),Y.default.success("Image copied to clipboard");}catch(e){console.warn("clipboard failed",e),Y.default.error("Copy failed (browser may not support)");}},eS=(e,t)=>{if(!e.current)return;let r=e.current.getContext("2d"),n=eo(e.current.width,e.current.height);n.getContext("2d").drawImage(e.current,0,0),r.save(),r.clearRect(0,0,e.current.width,e.current.height),r.scale(-1,1),r.drawImage(n,-e.current.width,0),r.restore(),t.push(e.current.toDataURL(),"Flip horizontal");},ek=(e,t)=>{if(!e.current)return;let r=e.current.getContext("2d"),n=eo(e.current.width,e.current.height);n.getContext("2d").drawImage(e.current,0,0),r.save(),r.clearRect(0,0,e.current.width,e.current.height),r.scale(1,-1),r.drawImage(n,0,-e.current.height),r.restore(),t.push(e.current.toDataURL(),"Flip vertical");},eR=(e,t,r,n,l)=>{if(!e.current||!r)return;let a=eo(Math.max(1,Math.round(r.w)),Math.max(1,Math.round(r.h)));a.getContext("2d").drawImage(e.current,r.x,r.y,r.w,r.h,0,0,r.w,r.h),e.current.width=a.width,e.current.height=a.height,t.current.width=a.width,t.current.height=a.height;let i=e.current.getContext("2d");i.clearRect(0,0,a.width,a.height),i.drawImage(a,0,0),n(null),l.push(e.current.toDataURL(),"Cropped");},eM=(e,t,r)=>{let n=t.current;if(!n)return null;let l=n.getBoundingClientRect(),a=Math.floor((e.clientX-l.left)/r),i=Math.floor((e.clientY-l.top)/r);if(a<0||i<0||a>=n.width||i>=n.height)return null;let s=n.getContext("2d",{willReadFrequently:!0});if(!s)return null;let o=s.getImageData(a,i,1,1).data;return`#${[o[0],o[1],o[2]].map(e=>e.toString(16).padStart(2,"0")).join("")}`;},eL={blur:0,gaussian:0,sharpen:0,texture:0,clarity:0,bgThreshold:255,bgThresholdBlack:0,brightness:0,contrast:0,highlights:0,shadows:0,whites:0,blacks:0,vibrance:0,saturation:0,dehaze:0,hslAdjustments:{}},eE=null,eI=(e,t,{blur:r=0,gaussian:n=0,sharpen:l=0,bgThreshold:a=255,bgThresholdBlack:i=0,brightness:s=0,contrast:o=0,texture:d=0,clarity:u=0,highlights:c=0,shadows:h=0,whites:f=0,blacks:g=0,vibrance:x=0,saturation:m=0,dehaze:p=0,hslAdjustments:v={}},w)=>{if(!e.current||!t)return;let j=e.current.getContext("2d"),y=t.getContext("2d");if(eE||(eE=y.getImageData(0,0,t.width,t.height)),!eE)return;let C=function(e){let t=new ImageData(e.width,e.height);return t.data.set(new Uint8ClampedArray(e.data)),t;}(eE);if(0===r&&0===n&&0===l&&0===d&&0===u&&255===a&&0===i&&0===s&&0===o&&0===c&&0===h&&0===f&&0===g&&0===x&&0===m&&0===p&&0===Object.keys(v).length){j.putImageData(C,0,0);return;}if(r>0){let e=r%2==0?r+1:r;ed(C,eu.generateBoxBlurKernel(e),e);}if(n>0&&ed(C,eu.generateGaussianKernel(n),2*n+1),l>0&&ed(C,eu.sharpen.map(e=>5===e?1+4*l:-1===e?-l:e),3),0!==d&&ed(C,[0,-1,0,-1,5+.05*d,-1,0,-1,0],3),0!==u&&ed(C,[0,-1,0,-1,5+.08*u,-1,0,-1,0],3),a<255&&function(e,t=255){let r=e.data;for(let e=0;e<r.length;e+=4)r[e]>t&&r[e+1]>t&&r[e+2]>t&&(r[e+3]=0);}(C,a),i>0&&function(e,t=0){let r=e.data;for(let e=0;e<r.length;e+=4)r[e]<t&&r[e+1]<t&&r[e+2]<t&&(r[e+3]=0);}(C,i),(0!==s||0!==o)&&function(e,t=0,r=0){let n=e.data,l=r/100+1,a=128*(1-l);for(let e=0;e<n.length;e+=4)n[e]=Math.min(255,Math.max(0,n[e]*l+a+t)),n[e+1]=Math.min(255,Math.max(0,n[e+1]*l+a+t)),n[e+2]=Math.min(255,Math.max(0,n[e+2]*l+a+t));}(C,s,o),0!==c||0!==h||0!==f||0!==g||0!==x||0!==m||0!==p){let e=C.data;for(let t=0;t<e.length;t+=4)p&&ep(e,t,p),(x||m)&&ev(e,t,{vibrance:x,saturation:m});em(C,{highlights:c,shadows:h,whites:f,blacks:g,vibrance:x,saturation:m,clarity:u,dehaze:p});}Object.keys(v).length>0&&ej(C,v),j.putImageData(C,0,0);let b=Object.entries({blur:r,gaussian:n,sharpen:l,texture:d,clarity:u,bgThreshold:a,bgThresholdBlack:i,brightness:s,contrast:o,highlights:c,shadows:h,whites:f,blacks:g,vibrance:x,saturation:m,dehaze:p,hslAdjustments:v}).filter(([e,t])=>eL[e]!==t);if(b.length>0){let t=b.map(([e,t])=>`${e}=${JSON.stringify(t)}`).join(", ");w.push(e.current.toDataURL(),`${t}`),eL={blur:r,gaussian:n,sharpen:l,texture:d,clarity:u,bgThreshold:a,bgThresholdBlack:i,brightness:s,contrast:o,highlights:c,shadows:h,whites:f,blacks:g,vibrance:x,saturation:m,dehaze:p,hslAdjustments:v};}},eB=({canvasRef:e,overlayRef:t,containerRef:r,offset:n,zoom:l,tool:i,currentCursor:s,hoverColor:o,onMouseDown:d,onMouseMove:u,onMouseUp:c})=>(0,a.jsxs)("div",{ref:r,onMouseDown:d,onMouseMove:u,onMouseUp:c,style:{width:"100%",height:"100vh",overflow:"hidden",border:"1px solid #eee",position:"relative",background:"#fafafa",cursor:s},children:[(0,a.jsx)("canvas",{ref:e,style:{transform:`translate(${n.x}px, ${n.y}px) scale(${l})`,transformOrigin:"top left",display:"block"}}),(0,a.jsx)("canvas",{ref:t,style:{position:"absolute",left:0,top:0,pointerEvents:"none",transform:`translate(${n.x}px, ${n.y}px) scale(${l})`,transformOrigin:"top left"}}),o&&"color"===i&&(0,a.jsxs)("div",{style:{position:"fixed",left:o.x+12,top:o.y+12,background:"#fff",padding:"4px 8px",borderRadius:4,boxShadow:"0 0 6px rgba(0,0,0,0.2)",fontSize:12,zIndex:999999,pointerEvents:"none",display:"flex",alignItems:"center",gap:6},children:[(0,a.jsx)("span",{style:{display:"inline-block",width:12,height:12,background:o.color,border:"1px solid #ccc"}}),o.color]})]});var eD=r("649689e8"),e_=n._(eD),ez=r("00798b85"),eP=n._(ez),eU=r("d90c6c6d"),eT=n._(eU),eG=r("13afdc7a"),eH=n._(eG),e$=r("a41070f7"),eA=n._(e$),eN=v.forwardRef(function(e,t){return v.createElement(y.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:eA.default}));}),eV=r("a12e4141"),eF=n._(eV),eO=r("65094f81"),eW=n._(eO),eX={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M567.1 512l318.5-319.3c5-5 1.5-13.7-5.6-13.7h-90.5c-2.1 0-4.2.8-5.6 2.3l-273.3 274-90.2-90.5c12.5-22.1 19.7-47.6 19.7-74.8 0-83.9-68.1-152-152-152s-152 68.1-152 152 68.1 152 152 152c27.7 0 53.6-7.4 75.9-20.3l90 90.3-90.1 90.3A151.04 151.04 0 00288 582c-83.9 0-152 68.1-152 152s68.1 152 152 152 152-68.1 152-152c0-27.2-7.2-52.7-19.7-74.8l90.2-90.5 273.3 274c1.5 1.5 3.5 2.3 5.6 2.3H880c7.1 0 10.7-8.6 5.6-13.7L567.1 512zM288 370c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80zm0 444c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}}]},name:"scissor",theme:"outlined"},eK=v.forwardRef(function(e,t){return v.createElement(y.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:eX}));}),eY={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},eq=v.forwardRef(function(e,t){return v.createElement(y.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:eY}));}),eJ=r("5b30eb7f"),eZ=n._(eJ);let eQ=({label:e,value:t,min:r,max:n,gradient:l,onChange:i,onChangeComplete:s})=>(0,a.jsxs)("div",{className:"hsl-slider-container",children:[(0,a.jsx)("span",{className:"hsl-label",children:e}),(0,a.jsx)(e_.default,{min:r,max:n,value:t,onChange:i,onChangeComplete:s,className:"hsl-slider",trackStyle:{background:l},railStyle:{background:l},handleStyle:{opacity:1}}),(0,a.jsx)(_.default,{min:r,max:n,value:t,onChange:e=>i(Number(e)),onBlur:()=>null==s?void 0:s(),className:"hsl-number",size:"small"})]}),{Panel:e0}=eP.default,e1=({canvasRef:e,baseCanvas:t,history:r,drawColor:n,setDrawColor:l,drawLineWidth:i,setDrawLineWidth:s,brushType:o,setBrushType:d,brushOpacity:u,setBrushOpacity:c,brushFlow:f,setBrushFlow:g,setTool:x,brightness:m,setBrightness:p,contrast:w,setContrast:j,blur:y,setBlur:C,gaussian:b,setGaussian:S,sharpen:k,setSharpen:R,bgThreshold:M,setBgThreshold:L,bgThresholdBlack:I,setBgThresholdBlack:B,setShowPerspectiveModal:D,dpiMeasured:_,setDpiMeasured:z,exportImage:U,onExport:T,overlayRef:G,texture:H,setTexture:$,clarity:A,setClarity:N,highlights:F,setHighlights:O,shadows:W,setShadows:X,whites:K,setWhites:q,blacks:J,setBlacks:Z,vibrance:Q,setVibrance:ee,saturation:et,setSaturation:er,dehaze:en,setDehaze:el,hslAdjustments:ea,setHslAdjustments:ei})=>{let[es,eo]=(0,v.useState)("red"),ed=[{name:"red",color:"#ff4d4d"},{name:"orange",color:"#ffa500"},{name:"yellow",color:"#ffd700"},{name:"green",color:"#00c853"},{name:"aqua",color:"#00e5ff"},{name:"blue",color:"#2979ff"},{name:"purple",color:"#9c27b0"},{name:"magenta",color:"#ff00aa"}],eu=(e,t)=>{var r,n,l;let a=(null===(r=ed.find(t=>t.name===e))||void 0===r?void 0:r.color)||"#ffffff",i=ed.findIndex(t=>t.name===e);if(-1===i)return"#555";let s=ed[i].color,o=(null===(n=ed[i-1])||void 0===n?void 0:n.color)||s,d=(null===(l=ed[i+1])||void 0===l?void 0:l.color)||s;switch(t){case"h":return`linear-gradient(90deg, ${o}, ${s}, ${d})`;case"s":return`linear-gradient(90deg, gray, ${a})`;case"l":return`linear-gradient(90deg, black, ${a}, white)`;default:return"#555";}},ec=()=>eI(e,t,{blur:y,gaussian:b,sharpen:k,texture:H,clarity:A,bgThreshold:M,bgThresholdBlack:I,brightness:m,contrast:w,highlights:F,shadows:W,whites:K,blacks:J,vibrance:Q,saturation:et,dehaze:en,hslAdjustments:ea},r);return(0,a.jsx)("div",{style:{width:260},children:(0,a.jsxs)(eP.default,{defaultActiveKey:["basic","lights","effects"],ghost:!0,expandIconPosition:"end",children:[(0,a.jsx)(e0,{header:"\u{1F6E0} Basic",children:(0,a.jsxs)(P.default,{wrap:!0,children:[(0,a.jsx)(V.default,{title:"Undo (Ctrl+Z)",children:(0,a.jsx)(E.default,{icon:(0,a.jsx)(eT.default,{}),onClick:r.undo})}),(0,a.jsx)(V.default,{title:"Redo (Ctrl+Shift+Z)",children:(0,a.jsx)(E.default,{icon:(0,a.jsx)(eH.default,{}),onClick:r.redo})}),(0,a.jsx)(V.default,{title:"Rotate left",children:(0,a.jsx)(E.default,{icon:(0,a.jsx)(eN,{}),onClick:()=>ey(-90,e,G,r)})}),(0,a.jsx)(V.default,{title:"Rotate right",children:(0,a.jsx)(E.default,{icon:(0,a.jsx)(eF.default,{}),onClick:()=>ey(90,e,G,r)})}),(0,a.jsx)(V.default,{title:"Flip horizontal",children:(0,a.jsx)(E.default,{icon:(0,a.jsx)(eW.default,{}),onClick:()=>eS(e,r)})}),(0,a.jsx)(V.default,{title:"Flip vertical",children:(0,a.jsx)(E.default,{icon:(0,a.jsx)(eW.default,{rotate:90}),onClick:()=>ek(e,r)})}),(0,a.jsx)(V.default,{title:"Brush",children:(0,a.jsx)(E.default,{icon:(0,a.jsx)(eZ.default,{}),onClick:()=>x("draw")})})]})},"basic"),(0,a.jsxs)(e0,{header:"\u{1F506} Light",children:[(0,a.jsx)("div",{children:"Brightness"}),(0,a.jsx)(e_.default,{min:-150,max:150,value:m,onChange:p,onChangeComplete:ec}),(0,a.jsx)("div",{children:"Contrast"}),(0,a.jsx)(e_.default,{min:-100,max:100,value:w,onChange:j,onChangeComplete:ec})]},"lights"),(0,a.jsxs)(e0,{header:"\u{1F3A8} Color",children:[(0,a.jsx)("div",{style:{marginBottom:8},children:"Vibrance"}),(0,a.jsx)(e_.default,{min:-100,max:100,value:Q,onChange:ee,onChangeComplete:ec}),(0,a.jsx)("div",{style:{marginBottom:8},children:"Saturation"}),(0,a.jsx)(e_.default,{min:-100,max:100,value:et,onChange:er,onChangeComplete:ec}),(0,a.jsx)("div",{style:{marginBottom:8},children:"Dehaze"}),(0,a.jsx)(e_.default,{min:-100,max:100,value:en,onChange:el,onChangeComplete:ec}),(0,a.jsx)("div",{style:{marginTop:10},children:"HSL Mixer"}),(0,a.jsx)("div",{style:{display:"flex",gap:8,marginBottom:10},children:ed.map(({name:e,color:t})=>(0,a.jsx)(V.default,{title:e.toUpperCase(),children:(0,a.jsx)("div",{onClick:()=>eo(e),style:{width:20,height:20,borderRadius:"50%",background:t,border:es===e?"2px solid white":"1px solid #555",boxShadow:es===e?"0 0 6px rgba(255,255,255,0.8)":"",cursor:"pointer"}},e)}))}),["Hue","Saturation","Luminance"].map(e=>{var t;let r=e[0].toLowerCase();return(0,a.jsx)(eQ,{label:e,value:(null===(t=ea[es])||void 0===t?void 0:t[r])??0,min:"Hue"===e?-180:-100,max:"Hue"===e?180:100,onChange:e=>ei(es,{[r]:e}),onChangeComplete:ec,gradient:eu(es,r)},e);}),(0,a.jsx)(E.default,{size:"small",onClick:()=>ei(es,{h:0,s:0,l:0}),children:"Reset"})]},"color"),(0,a.jsxs)(e0,{header:"\u2728 Effects",children:[(0,a.jsx)("div",{children:"Texture"}),(0,a.jsx)(e_.default,{min:-100,max:100,value:H,onChange:$,onChangeComplete:ec}),(0,a.jsx)("div",{children:"Clarity"}),(0,a.jsx)(e_.default,{min:-100,max:100,value:A,onChange:N,onChangeComplete:ec}),(0,a.jsx)("div",{children:"Highlights"}),(0,a.jsx)(e_.default,{min:-100,max:100,value:F,onChange:O,onChangeComplete:ec}),(0,a.jsx)("div",{children:"Shadows"}),(0,a.jsx)(e_.default,{min:-100,max:100,value:W,onChange:X,onChangeComplete:ec}),(0,a.jsx)("div",{children:"Whites"}),(0,a.jsx)(e_.default,{min:-100,max:100,value:K,onChange:q,onChangeComplete:ec}),(0,a.jsx)("div",{children:"Blacks"}),(0,a.jsx)(e_.default,{min:-100,max:100,value:J,onChange:Z,onChangeComplete:ec})]},"effects"),(0,a.jsxs)(e0,{header:"\u{1F3AD} Filters",children:[(0,a.jsx)("div",{children:"Box Blur"}),(0,a.jsx)(e_.default,{min:0,max:25,value:y,onChange:C,onChangeComplete:ec}),(0,a.jsx)("div",{children:"Gaussian"}),(0,a.jsx)(e_.default,{min:0,max:20,value:b,onChange:S,onChangeComplete:ec}),(0,a.jsx)("div",{children:"Sharpen"}),(0,a.jsx)(e_.default,{min:0,max:5,value:k,onChange:R,onChangeComplete:ec}),(0,a.jsx)("div",{children:"Remove White"}),(0,a.jsx)(e_.default,{min:0,max:255,value:M,onChange:L,onChangeComplete:ec}),(0,a.jsx)("div",{children:"Remove Black"}),(0,a.jsx)(e_.default,{min:0,max:255,value:I,onChange:B,onChangeComplete:ec})]},"filters"),(0,a.jsxs)(e0,{header:"\u{1F4D0} Crop & Ruler",children:[(0,a.jsxs)(P.default,{children:[(0,a.jsx)(E.default,{icon:(0,a.jsx)(eK,{}),onClick:()=>x("crop"),children:"Crop"}),(0,a.jsx)(E.default,{onClick:()=>{D(!0),x("perspective");},children:"Perspective"})]}),(0,a.jsx)("div",{style:{marginTop:10},children:"Ruler"}),(0,a.jsxs)(P.default,{children:[(0,a.jsx)(E.default,{onClick:()=>x("ruler"),children:"\u{1F4CF} Ruler"}),(0,a.jsx)(E.default,{onClick:()=>{null==z||z(null),Y.default.info("Ruler cleared");},children:"Clear"})]}),_&&(0,a.jsxs)("div",{children:["Estimated DPI: ",_]})]},"crop"),(0,a.jsx)(e0,{header:"\u{1F4E4} Export",children:(0,a.jsxs)(P.default,{children:[(0,a.jsx)(E.default,{icon:(0,a.jsx)(eq,{}),onClick:()=>U(!1,e,T),children:"PNG"}),(0,a.jsx)(E.default,{onClick:()=>U(!0,e,T),children:"JPG"}),(0,a.jsx)(E.default,{icon:(0,a.jsx)(h.default,{}),onClick:()=>eb(e),children:"Copy"})]})},"export")]})});},{Option:e2}=et.default,e5=({imageUrl:e,onExport:t})=>{let r=(0,v.useRef)(null),{canvasRef:n,overlayRef:l,baseCanvas:i}=function(e,t){let r=(0,v.useRef)(null),n=(0,v.useRef)(null),[l,a]=(0,v.useState)(null);(0,v.useEffect)(()=>{(async()=>{try{let n=await new Promise((t,r)=>{let n=new Image;n.crossOrigin="anonymous",n.onload=()=>{let e=eo(n.naturalWidth,n.naturalHeight);e.getContext("2d").drawImage(n,0,0),t(e);},n.onerror=r,n.src=e;});a(n);let l=eo(n.width,n.height);if(l.getContext("2d").drawImage(n,0,0),r.current){r.current.width=l.width,r.current.height=l.height;let e=r.current.getContext("2d");e.clearRect(0,0,l.width,l.height),e.drawImage(l,0,0);}t&&t(i(l));}catch(e){console.error("Failed to load image",e),Y.default.error("Failed to load image");}})();},[e]),(0,v.useEffect)(()=>{s();},[l]);let i=e=>e.toDataURL("image/png"),s=()=>{if(!r.current||!l)return;r.current.width=l.width,r.current.height=l.height,n.current.width=l.width,n.current.height=l.height;let e=r.current.getContext("2d");e.clearRect(0,0,r.current.width,r.current.height),e.drawImage(l,0,0);};return{canvasRef:r,overlayRef:n,baseCanvas:l,syncCanvasSize:s};}(e,e=>s.push(e,"Initial load")),s=function(e,t){let[r,n]=(0,v.useState)([]),[l,a]=(0,v.useState)(-1),i=r[l],s=n=>{let l=r[n];if(!l)return;let i=new Image;i.onload=()=>{let r=e.current.getContext("2d");e.current.width=i.naturalWidth,e.current.height=i.naturalHeight,t.current.width=i.naturalWidth,t.current.height=i.naturalHeight,r.clearRect(0,0,e.current.width,e.current.height),r.drawImage(i,0,0),a(n);},i.src=l.url;};return{history:r,index:l,current:i,push:(e,t="")=>{let i=r.slice(0,l+1);i.push({url:e,label:t}),n(i),a(i.length-1);},undo:()=>{l<=0||s(l-1);},redo:()=>{l>=r.length-1||s(l+1);},applyHistory:s};}(n,l),[o,d]=(0,v.useState)(1),[u,c]=(0,v.useState)({x:0,y:0}),[h,f]=(0,v.useState)(!1),g=(0,v.useRef)(null),[x,m]=(0,v.useState)("pan"),[p,w]=(0,v.useState)(0),[j,y]=(0,v.useState)(0),[C,b]=(0,v.useState)(0),[S,k]=(0,v.useState)(0),[R,M]=(0,v.useState)(0),[L,I]=(0,v.useState)(0),[B,D]=(0,v.useState)(0),[z,U]=(0,v.useState)(0),[T,G]=(0,v.useState)(0),[H,$]=(0,v.useState)(null),A=(0,v.useRef)(null),[N,F]=(0,v.useState)(!1),O=(0,v.useRef)(null),[W,X]=(0,v.useState)(null),[K,q]=(0,v.useState)(!1),[J,Z]=(0,v.useState)(!1),[ee,er]=(0,v.useState)(null),[el,ei]=(0,v.useState)(null),[ed]=(0,v.useState)(!1),eu=(0,v.useRef)(null),[ec,eh]=(0,v.useState)(null),[ef,eg]=(0,v.useState)("#ff0000"),[ex,em]=(0,v.useState)(2),[ep,ev]=(0,v.useState)("hard"),[ew,ej]=(0,v.useState)(1),[eb,eS]=(0,v.useState)(1),[ek,eL]=(0,v.useState)(!1),eE=(0,v.useRef)([]),eI=(0,v.useRef)(!1),eD=(0,v.useRef)(null),e_=(0,v.useRef)(ex),ez=(0,v.useRef)(!1),eP=(0,v.useRef)(null),eU=(0,v.useRef)(ew),eT=(0,v.useRef)(!1),eG=(0,v.useRef)(null),eH=(0,v.useRef)(eb),[e$,eA]=(0,v.useState)(0),[eN,eV]=(0,v.useState)(0),[eF,eO]=(0,v.useState)(0),[eW,eX]=(0,v.useState)(0),[eK,eY]=(0,v.useState)(0),[eq,eJ]=(0,v.useState)(255),[eZ,eQ]=(0,v.useState)(0),[e0,e5]=(0,v.useState)({});(0,v.useEffect)(()=>{let e=r.current;if(!e)return;let t=e=>e.preventDefault();return e.addEventListener("contextmenu",t),()=>e.removeEventListener("contextmenu",t);},[]),(0,v.useEffect)(()=>{let e=r.current,t=n.current;if(!e||!t)return;let l=e=>{if(!e.ctrlKey)return;e.preventDefault();let r=t.getBoundingClientRect(),n=e.clientX-r.left,l=e.clientY-r.top;d(t=>{let r=Math.min(Math.max(t*(e.deltaY<0?1.1:.9),.1),12),a=r/t;return c(e=>({x:n-(n-e.x)*a,y:l-(l-e.y)*a})),r;});};return e.addEventListener("wheel",l,{passive:!1}),()=>e.removeEventListener("wheel",l);},[]);let e4=()=>{if(!l.current||!n.current)return;let e=l.current.getContext("2d");if(e.clearRect(0,0,l.current.width,l.current.height),H&&(e.save(),e.strokeStyle="#00aaff",e.lineWidth=2,e.setLineDash([6,4]),e.strokeRect(H.x,H.y,H.w,H.h),e.restore()),eu.current&&(e.save(),e.strokeStyle="#ffcc00",e.lineWidth=2,e.beginPath(),e.moveTo(eu.current.x1,eu.current.y1),e.lineTo(eu.current.x2,eu.current.y2),e.stroke(),e.restore()),O.current){e.save(),e.fillStyle="rgba(0,255,0,0.8)";for(let t=0;t<8;t+=2){let r=O.current[t],n=O.current[t+1];isNaN(r)||isNaN(n)||e.fillRect(r-4,n-4,8,8);}e.restore();}if(ee&&"color"===x){let t=n.current.getBoundingClientRect(),r=(ee.x-t.left)/o,l=(ee.y-t.top)/o;e.save(),e.strokeStyle=ee.color,e.lineWidth=2/o,e.beginPath(),e.arc(r,l,8/o,0,2*Math.PI),e.stroke(),e.restore();}if(ee&&"draw"===x){let t=n.current.getBoundingClientRect(),r=(ee.x-t.left)/o,l=(ee.y-t.top)/o;e.save(),e.strokeStyle=ef,e.lineWidth=2/o,e.beginPath(),e.arc(r,l,ex/2,0,2*Math.PI),e.stroke(),e.restore();}};(0,v.useEffect)(()=>{let e=n.current;if(!e)return;let t=e=>{if("color"===x){let t=eM(e,n,o);er(t?{x:e.clientX,y:e.clientY,color:t}:null),e4();}else"draw"===x&&(er(ef?{x:e.clientX,y:e.clientY,color:ef}:null),e4());},r=e=>{if("color"===x){let t=eM(e,n,o);t&&(ei(t),eg(t),navigator.clipboard.writeText(t).catch(()=>{}),Y.default.success(`Picked color ${t}`));}},l=()=>{"color"===x&&er(null);};return e.addEventListener("mousemove",t),e.addEventListener("click",r),e.addEventListener("mouseleave",l),()=>{e.removeEventListener("mousemove",t),e.removeEventListener("click",r),e.removeEventListener("mouseleave",l);};},[x,o,u]),(0,v.useEffect)(()=>{let e=e=>{e.ctrlKey&&"z"===e.key&&s.undo(),e.ctrlKey&&e.shiftKey&&"Z"===e.key&&s.redo(),"c"===e.key&&m("crop"),"h"===e.key&&m("pan"),"r"===e.key&&ey(90,n,l,s.history),"p"===e.key&&m("color"),"b"===e.key&&m("draw");};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e);},[s.index,s.history]),(0,v.useEffect)(()=>{let e=e=>{"Space"===e.code?(e.preventDefault(),q(e=>(e||(X(e=>null===e?x:e),m("pan")),!0))):"AltLeft"===e.code&&"draw"===x&&(e.preventDefault(),Z(e=>(e||(X(e=>null===e?x:e),m("color")),!0)));},t=e=>{"Space"===e.code?(q(!1),X(e=>(e&&m(e),null))):"AltLeft"===e.code&&"draw"===W&&(Z(!1),X(e=>(e&&m(e),null)));};return window.addEventListener("keydown",e,{passive:!1}),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t);};},[x]);let e3=async()=>{if(!n.current||!O.current)return;let e=n.current,t=e.width,r=e.height,a=function(e,t,r,n){let l=eo(r,n),a=l.getContext("2d");function i(t,l){let[i,s,o,d,u,c]=t,[h,f,g,x,m,p]=l;1e-6>Math.abs(h*(x-p)+g*(p-f)+m*(f-x))||(a.save(),a.beginPath(),a.moveTo(h,f),a.lineTo(g,x),a.lineTo(m,p),a.closePath(),a.clip(),a.drawImage(e,0,0,r,n),a.restore());}e.getContext("2d").getImageData(0,0,e.width,e.height);let[s,o,d,u,c,h,f,g]=t;return i([s,o,d,u,c,h],[0,0,r,0,0,n]),i([c,h,f,g,s,o],[r,n,0,n,r,0]),l;}(e,O.current,t,r);n.current.width=a.width,n.current.height=a.height,l.current.width=a.width,l.current.height=a.height,n.current.getContext("2d").clearRect(0,0,a.width,a.height),n.current.getContext("2d").drawImage(a,0,0),s.push(n.current.toDataURL(),"Perspective corrected"),F(!1);},e8=(0,v.useMemo)(()=>{if(("pan"===x||"select"===x)&&h)return"grabbing";switch(x){case"pan":return"grab";case"crop":case"ruler":case"perspective":return"crosshair";case"color":return"copy";case"draw":return"pointer";default:return"default";}},[x,h]);return(0,a.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,a.jsx)(e1,{canvasRef:n,overlayRef:l,baseCanvas:i,history:s,drawColor:ef,setDrawColor:eg,drawLineWidth:ex,setDrawLineWidth:em,brushType:ep,setBrushType:ev,brushOpacity:ew,setBrushOpacity:ej,brushFlow:eb,setBrushFlow:eS,setTool:m,brightness:p,setBrightness:w,contrast:j,setContrast:y,highlights:C,setHighlights:b,shadows:S,setShadows:k,whites:R,setWhites:M,blacks:L,setBlacks:I,vibrance:B,setVibrance:D,saturation:z,setSaturation:U,dehaze:T,setDehaze:G,blur:e$,setBlur:eA,gaussian:eN,setGaussian:eV,sharpen:eF,setSharpen:eO,texture:eW,setTexture:eX,clarity:eK,setClarity:eY,bgThreshold:eq,setBgThreshold:eJ,bgThresholdBlack:eZ,setBgThresholdBlack:eQ,hslAdjustments:e0,setHslAdjustments:(e,t)=>{e5(r=>({...r,[e]:{...r[e]||{},...t}}));},setShowPerspectiveModal:F,dpiMeasured:ec,setDpiMeasured:eh,exportImage:eC,onExport:t}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsxs)(P.default,{children:[(0,a.jsx)(et.default,{style:{width:150},placeholder:"History",value:s.index,onChange:e=>s.applyHistory(e),optionLabelProp:"label",children:s.history.map((e,t)=>(0,a.jsx)(et.default.Option,{value:t,label:e.label||`Step ${t+1}`,children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("img",{src:e.url,alt:"",style:{width:40,height:30,objectFit:"contain",border:"1px solid #ddd"}}),(0,a.jsx)("span",{children:e.label||`Step ${t+1}`})]})},t))}),(0,a.jsx)(V.default,{title:"Zoom In",children:(0,a.jsx)(E.default,{icon:(0,a.jsx)(ea.default,{}),onClick:()=>d(e=>Math.min(1.2*e,8))})}),(0,a.jsx)(V.default,{title:"Zoom Out",children:(0,a.jsx)(E.default,{icon:(0,a.jsx)(es.default,{}),onClick:()=>d(e=>Math.max(e/1.2,.1))})}),(0,a.jsxs)(et.default,{value:x,onChange:e=>m(e),style:{width:140},children:[(0,a.jsx)(e2,{value:"pan",children:"Pan"}),(0,a.jsx)(e2,{value:"color",children:"Color Picker"}),(0,a.jsx)(e2,{value:"crop",children:"Crop"}),(0,a.jsx)(e2,{value:"ruler",children:"Ruler"}),(0,a.jsx)(e2,{value:"perspective",children:"Perspective"}),(0,a.jsx)(e2,{value:"draw",children:"Brush"})]}),(0,a.jsxs)(P.default,{style:{width:"100%"},wrap:!0,children:[(0,a.jsxs)(et.default,{value:ep,onChange:e=>ev(e),style:{width:80},children:[(0,a.jsx)(e2,{value:"hard",children:"Hard"}),(0,a.jsx)(e2,{value:"soft",children:"Soft"})]}),(0,a.jsx)(en.default,{value:ef,onChange:e=>eg(e.toHexString())}),(0,a.jsx)(_.default,{style:{width:100},min:1,max:500,value:ex,onChange:e=>em(e||1),addonAfter:"px"}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("span",{onMouseDown:e=>{if(0!==e.button)return;e.preventDefault(),ez.current=!0,eP.current=e.clientX,eU.current=ew;let t=document.body.style.userSelect;document.body.style.userSelect="none";let r=e=>{if(!ez.current||null===eP.current)return;let t=e.clientX-eP.current,r=eU.current+.005*t;ej(Number((r=Math.max(0,Math.min(1,r))).toFixed(2)));},n=()=>{ez.current=!1,eP.current=null,eU.current=ew,document.body.style.userSelect=t,window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",n);};window.addEventListener("mousemove",r),window.addEventListener("mouseup",n);},style:{cursor:"ew-resize",userSelect:"none"},title:"Drag left/right to change opacity",children:"Opacity:"}),(0,a.jsx)(_.default,{min:0,max:1,step:.01,style:{width:60},value:ew,onChange:e=>ej(e||0)})]}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("span",{onMouseDown:e=>{if(0!==e.button)return;e.preventDefault(),eT.current=!0,eG.current=e.clientX,eH.current=eb;let t=document.body.style.userSelect;document.body.style.userSelect="none";let r=e=>{if(!eT.current||null===eG.current)return;let t=e.clientX-eG.current,r=eH.current+.005*t;eS(Number((r=Math.max(0,Math.min(1,r))).toFixed(2)));},n=()=>{eT.current=!1,eG.current=null,eH.current=eb,document.body.style.userSelect=t,window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",n);};window.addEventListener("mousemove",r),window.addEventListener("mouseup",n);},style:{cursor:"ew-resize",userSelect:"none"},title:"Drag left/right to change flow",children:"Flow:"}),(0,a.jsx)(_.default,{min:0,max:1,step:.01,style:{width:60},value:eb,onChange:e=>eS(e||0)})]})]})]})}),(0,a.jsx)(eB,{canvasRef:n,overlayRef:l,containerRef:r,offset:u,zoom:o,tool:x,currentCursor:e8,hoverColor:ee,onMouseDown:e=>{let t=n.current.getBoundingClientRect(),r=(e.clientX-t.left)/o,l=(e.clientY-t.top)/o;if("color"===x&&e.altKey&&2===e.button&&m("draw"),("draw"===x||"color"===x)&&e.altKey&&2===e.button){e.preventDefault(),eI.current=!0,eD.current=e.clientX,e_.current=ex;return;}if("pan"===x||"select"===x)f(!0),g.current={x:e.clientX-u.x,y:e.clientY-u.y};else if("crop"===x)A.current={x:r,y:l},$({x:r,y:l,w:1,h:1});else if("ruler"===x){if(eu.current){eu.current.x2=r,eu.current.y2=l;let e=r-eu.current.x1,t=l-eu.current.y1,a=Math.sqrt(e*e+t*t),i=Math.round(a/(n.current.width/(window.devicePixelRatio||1))*96);eh(i),Y.default.info(`Distance: ${Math.round(a)} px, estimated DPI: ${i}`),eu.current=null;}else eu.current={x1:r,y1:l,x2:r,y2:l};}else if("perspective"===x){O.current||(O.current=[r,l,r,l,r,l,r,l]);let e=O.current;for(let t=0;t<8;t+=2)if(isNaN(e[t])||isNaN(e[t+1])||0===e[t]&&0===e[t+1]){e[t]=r,e[t+1]=l;break;}}else"draw"===x&&(eL(!0),eE.current=[{x:r,y:l}]);},onMouseMove:e=>{if(eI.current&&null!==eD.current){let t=e.clientX-eD.current;em(Math.max(1,Math.round(10*Math.min(500,e_.current+t/5))/10));return;}if(("pan"===x||"select"===x)&&h&&g.current)c({x:e.clientX-g.current.x,y:e.clientY-g.current.y});else if("crop"===x&&A.current){let t=n.current.getBoundingClientRect(),r={x:(e.clientX-t.left)/o,y:(e.clientY-t.top)/o};$({x:Math.min(A.current.x,r.x),y:Math.min(A.current.y,r.y),w:Math.abs(r.x-A.current.x),h:Math.abs(r.y-A.current.y)}),e4();}else if("draw"===x&&ek&&n.current){let t=n.current.getBoundingClientRect(),r=(e.clientX-t.left)/o,l=(e.clientY-t.top)/o;eE.current.push({x:r,y:l});let a=n.current.getContext("2d");a.save(),a.globalAlpha=ew*eb,"soft"===ep?(a.shadowColor=ef,a.shadowBlur=.5*ex,a.lineWidth=.5*ex):(a.shadowBlur=0,a.lineWidth=ex),a.strokeStyle=ef,a.lineCap="round",a.lineJoin="round",a.beginPath();let i=eE.current;a.moveTo(i[i.length-2].x,i[i.length-2].y),a.lineTo(i[i.length-1].x,i[i.length-1].y),a.stroke(),a.restore(),e4();}else e4();},onMouseUp:()=>{if(eI.current){eI.current=!1,eD.current=null,e_.current=ex;return;}f(!1),g.current=null,"crop"===x&&H&&eR(n,l,H,$,s),"draw"===x&&ek&&(eL(!1),s.push(n.current.toDataURL(),"Draw"));}})]}),(0,a.jsx)(Q.default,{title:"Perspective correction",open:N,onOk:()=>e3(),onCancel:()=>F(!1),okText:"Apply",children:(0,a.jsx)("p",{children:"Click four points on the image (clockwise) to define the corners, then Apply."})})]});},{Title:e4}=O.default,{TabPane:e3}=H.default,e8=()=>{let[e,t]=(0,v.useState)(null),[r,n]=(0,v.useState)(null),[l,i]=(0,v.useState)(null),[o,c]=(0,v.useState)(!1),[f,x]=(0,v.useState)(!1),m=(0,v.useRef)(0),[p,w]=(0,v.useState)(1),[j,y]=(0,v.useState)(1),[b,S]=(0,v.useState)(1),[R,L]=(0,v.useState)(8),[I,D]=(0,v.useState)(2),[z,U]=(0,v.useState)(1);(0,v.useEffect)(()=>{let e=e=>{var t;let r=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!r)return;let n=Array.from(r).find(e=>e.type.includes("image"));if(n){let t=n.getAsFile();t&&(G(t),Y.default.success("Image pasted from clipboard!"),e.preventDefault());}};return window.addEventListener("paste",e),()=>window.removeEventListener("paste",e);},[]);let G=e=>{t(e);let r=new FileReader;return r.onload=e=>{var t;return n(null===(t=e.target)||void 0===t?void 0:t.result);},r.readAsDataURL(e),c(!1),m.current=0,!1;},$=(e,t)=>{let r=new Blob([e],{type:"image/svg+xml"}),n=document.createElement("a");n.href=URL.createObjectURL(r),n.download=t,n.click();},N=l?btoa(unescape(encodeURIComponent(l))):"",F=l?`data:image/svg+xml;base64,${N}`:"";return(0,a.jsx)(s.default,{setDragging:c,dragCounter:m,handleUpload:G,children:(0,a.jsx)(B.default,{title:(0,a.jsxs)(a.Fragment,{children:["\u{1F5BC}\uFE0F PNG / JPEG Viewer ",(0,a.jsx)(A.default,{color:"cyan",children:"Beta"})]}),variant:"borderless",children:(0,a.jsxs)(P.default,{direction:"vertical",style:{width:"100%"},size:"large",children:[!o&&(0,a.jsx)(X.default,{beforeUpload:G,showUploadList:!1,accept:".png,.jpg,.jpeg",children:(0,a.jsx)(E.default,{icon:(0,a.jsx)(M.default,{}),children:"Upload Image (PNG/JPG)"})}),o&&(0,a.jsx)(d.default,{}),r&&(0,a.jsxs)("div",{children:[(0,a.jsx)(e4,{level:5,children:"Preview & Editor:"}),(0,a.jsx)(e5,{imageUrl:r,onExport:e=>{console.log("exported blob",e);}})]}),f&&(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(255, 255, 255, 0.7)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:(0,a.jsx)(T.default,{indicator:(0,a.jsx)(k,{style:{fontSize:48,color:"#1890ff"},spin:!0}),tip:"Converting image to SVG...",size:"large"})}),(0,a.jsx)(B.default,{size:"small",title:"Tracing Options (Adjust before converting)",children:(0,a.jsxs)(P.default,{wrap:!0,size:"large",children:[(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(V.default,{title:"Scale factor for the SVG output. Higher = larger SVG.",children:(0,a.jsxs)("label",{children:["Scale ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:.1,step:.1,value:p,onChange:e=>w(e||1)})]}),(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(V.default,{title:"Error threshold for line detection. Lower = more precise lines.",children:(0,a.jsxs)("label",{children:["ltres ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:0,value:j,onChange:e=>y(e||1)})]}),(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(V.default,{title:"Error threshold for curve detection. Lower = more precise curves.",children:(0,a.jsxs)("label",{children:["qtres ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:0,value:b,onChange:e=>S(e||1)})]}),(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(V.default,{title:"Minimum path length to keep. Higher = simpler SVG with fewer tiny paths.",children:(0,a.jsxs)("label",{children:["Pathomit ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:0,value:R,onChange:e=>L(e||0)})]}),(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(V.default,{title:"Pixel sampling interval for colors. 1 = every pixel, higher = faster but less accurate colors.",children:(0,a.jsxs)("label",{children:["ColorSampling ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:1,value:I,onChange:e=>D(e||1)})]}),(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(V.default,{title:"Stroke width in the output SVG.",children:(0,a.jsxs)("label",{children:["StrokeWidth ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:0,value:z,onChange:e=>U(e||1)})]})]})}),(0,a.jsxs)(P.default,{children:[(0,a.jsx)(E.default,{type:"primary",onClick:()=>{if(!r){Y.default.error("Please upload an image first.");return;}x(!0);try{J.default.imageToSVG(r,e=>{i(e),x(!1),Y.default.success("Image converted to SVG successfully!");},{scale:p,ltres:j,qtres:b,pathomit:R,colorsampling:I,strokewidth:z});}catch(e){console.error(e),x(!1),Y.default.error("Error converting image to SVG.");}},disabled:!e,children:"Convert to SVG"}),(0,a.jsx)(E.default,{onClick:()=>{t(null),n(null),i(null),Y.default.info("Image and SVG cleared.");},danger:!0,disabled:!e&&!l,children:"Clear Image"})]}),l&&(0,a.jsxs)(H.default,{defaultActiveKey:"svg",type:"card",style:{marginTop:16},children:[(0,a.jsxs)(e3,{tab:"SVG",children:[(0,a.jsxs)(P.default,{style:{marginBottom:8},children:[(0,a.jsx)(E.default,{onClick:()=>$(l,"image.svg"),icon:(0,a.jsx)(g.default,{}),children:"Download"}),(0,a.jsx)(E.default,{onClick:()=>(0,u.handleCopy)(l,"SVG copied!"),icon:(0,a.jsx)(h.default,{}),children:"Copy"})]}),(0,a.jsx)("div",{style:{border:"1px solid #eee",borderRadius:6,padding:12,overflow:"auto"},children:(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:l}})})]},"svg"),(0,a.jsxs)(e3,{tab:"Base64",children:[(0,a.jsxs)(P.default,{style:{marginBottom:8},children:[(0,a.jsx)(E.default,{onClick:()=>(0,u.handleCopy)(N,"Base64 copied!"),icon:(0,a.jsx)(h.default,{}),children:"Copy Base64"}),(0,a.jsx)(E.default,{onClick:()=>$(N,"image-base64.txt"),icon:(0,a.jsx)(g.default,{}),children:"Download Base64"})]}),(0,a.jsx)("pre",{style:{background:"#f7f7f7",padding:12,borderRadius:6,whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:300,overflow:"auto"},children:N})]},"base64"),(0,a.jsxs)(e3,{tab:"Data URI",children:[(0,a.jsxs)(P.default,{style:{marginBottom:8},children:[(0,a.jsx)(E.default,{onClick:()=>(0,u.handleCopy)(F,"Data URI copied!"),icon:(0,a.jsx)(h.default,{}),children:"Copy Data URI"}),(0,a.jsx)(E.default,{onClick:()=>$(F,"image-datauri.txt"),icon:(0,a.jsx)(g.default,{}),children:"Download Data URI"})]}),(0,a.jsx)("pre",{style:{background:"#f7f7f7",padding:12,borderRadius:6,whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:300,overflow:"auto"},children:F})]},"datauri")]})]})})});};}}]);
//# sourceMappingURL=2ed777c5-async.12711ad4.js.map