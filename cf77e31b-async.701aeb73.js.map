{"version":3,"sources":["node_modules/@ant-design/icons-svg/es/asn/InboxOutlined.js","node_modules/@ant-design/icons/es/icons/InboxOutlined.js","node_modules/antd/es/popconfirm/style/index.js","node_modules/antd/es/popconfirm/PurePanel.js","node_modules/antd/es/popconfirm/index.js","src/pages/PicsEditor/utils/ImageEditorEngine.tsx","src/pages/PicsEditor/utils/transformHelpers.ts","src/pages/PicsEditor/utils/layerHelpers.ts","src/pages/PicsEditor/utils/brushHelpers.ts","src/pages/PicsEditor/utils/overlayHelpers.ts","src/pages/PicsEditor/utils/perspectiveHelpers.ts","src/pages/PicsEditor/utils/upscaleHelpers.ts","src/pages/PicsEditor/utils/effectsHelpers.ts","src/pages/PicsEditor/components/ImageEditor/ImageCanvas.tsx","src/pages/PicsEditor/components/ImageEditor/ColorRemovalModal.tsx","src/pages/PicsEditor/components/ImageEditor/LayerMaskModal.tsx","src/pages/PicsEditor/components/ImageEditor/CustomSlider.tsx","src/pages/PicsEditor/components/ImageEditor/LayerEffectModal.tsx","node_modules/@ant-design/icons/es/icons/RotateLeftOutlined.js","node_modules/@ant-design/icons-svg/es/asn/ScissorOutlined.js","node_modules/@ant-design/icons/es/icons/ScissorOutlined.js","node_modules/@ant-design/icons-svg/es/asn/BorderInnerOutlined.js","node_modules/@ant-design/icons/es/icons/BorderInnerOutlined.js","node_modules/@ant-design/icons-svg/es/asn/SignatureOutlined.js","node_modules/@ant-design/icons/es/icons/SignatureOutlined.js","node_modules/@ant-design/icons-svg/es/asn/SaveOutlined.js","node_modules/@ant-design/icons/es/icons/SaveOutlined.js","src/pages/PicsEditor/components/ImageEditor/RGBHistogram.tsx","src/pages/PicsEditor/components/ImageEditor/UpscaleModal.tsx","node_modules/@ant-design/icons-svg/es/asn/InfoCircleOutlined.js","node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js","node_modules/@ant-design/icons/es/icons/LoadingOutlined.js","src/pages/PicsEditor/components/ImageEditor/ExportModal.tsx","src/pages/PicsEditor/components/ImageEditor/SideEditorToolbar.tsx","node_modules/@ant-design/icons/es/icons/ZoomOutOutlined.js","node_modules/@ant-design/icons-svg/es/asn/MergeCellsOutlined.js","node_modules/@ant-design/icons/es/icons/MergeCellsOutlined.js","node_modules/@ant-design/icons/es/icons/UpOutlined.js","node_modules/@ant-design/icons/es/icons/DownOutlined.js","node_modules/@ant-design/icons-svg/es/asn/ItalicOutlined.js","node_modules/@ant-design/icons/es/icons/ItalicOutlined.js","node_modules/@ant-design/icons-svg/es/asn/AlignLeftOutlined.js","node_modules/@ant-design/icons/es/icons/AlignLeftOutlined.js","node_modules/@ant-design/icons-svg/es/asn/AlignCenterOutlined.js","node_modules/@ant-design/icons/es/icons/AlignCenterOutlined.js","node_modules/@ant-design/icons-svg/es/asn/AlignRightOutlined.js","node_modules/@ant-design/icons/es/icons/AlignRightOutlined.js","src/pages/PicsEditor/components/ImageEditor/TopEditorToolbar.tsx","src/pages/PicsEditor/components/ImageEditor/hooks/useViewer.ts","src/pages/PicsEditor/components/ImageEditor/hooks/useTools.ts","src/pages/PicsEditor/components/ImageEditor/hooks/useAdjustments.ts","src/pages/PicsEditor/components/ImageEditor/hooks/useLayers.ts","src/pages/PicsEditor/components/ImageEditor/hooks/useCrop.ts","src/pages/PicsEditor/components/ImageEditor/hooks/usePerspective.ts","src/pages/PicsEditor/components/ImageEditor/hooks/useDrawing.ts","src/pages/PicsEditor/components/ImageEditor/hooks/useTextTool.ts","src/pages/PicsEditor/components/ImageEditor/hooks/useEditorState.ts","src/pages/PicsEditor/components/ImageEditor/tourSteps.tsx","src/pages/PicsEditor/components/ImageEditor/index.tsx","src/pages/PicsEditor/hooks/useCanvas.tsx","src/pages/PicsEditor/hooks/useHistory.tsx","src/pages/PicsEditor/components/SettingsModal.tsx","src/pages/PicsEditor/utils/storage.ts","src/pages/PicsEditor/index.tsx"],"sourcesContent":["// This icon file is generated automatically.\nvar InboxOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"0 0 1024 1024\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z\" } }] }, \"name\": \"inbox\", \"theme\": \"outlined\" };\nexport default InboxOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport InboxOutlinedSvg from \"@ant-design/icons-svg/es/asn/InboxOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar InboxOutlined = function InboxOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: InboxOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(InboxOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'InboxOutlined';\n}\nexport default RefIcon;","import { genStyleHooks } from '../../theme/internal';\n// =============================== Base ===============================\nconst genBaseStyle = token => {\n  const {\n    componentCls,\n    iconCls,\n    antCls,\n    zIndexPopup,\n    colorText,\n    colorWarning,\n    marginXXS,\n    marginXS,\n    fontSize,\n    fontWeightStrong,\n    colorTextHeading\n  } = token;\n  return {\n    [componentCls]: {\n      zIndex: zIndexPopup,\n      [`&${antCls}-popover`]: {\n        fontSize\n      },\n      [`${componentCls}-message`]: {\n        marginBottom: marginXS,\n        display: 'flex',\n        flexWrap: 'nowrap',\n        alignItems: 'start',\n        [`> ${componentCls}-message-icon ${iconCls}`]: {\n          color: colorWarning,\n          fontSize,\n          lineHeight: 1,\n          marginInlineEnd: marginXS\n        },\n        [`${componentCls}-title`]: {\n          fontWeight: fontWeightStrong,\n          color: colorTextHeading,\n          '&:only-child': {\n            fontWeight: 'normal'\n          }\n        },\n        [`${componentCls}-description`]: {\n          marginTop: marginXXS,\n          color: colorText\n        }\n      },\n      [`${componentCls}-buttons`]: {\n        textAlign: 'end',\n        whiteSpace: 'nowrap',\n        button: {\n          marginInlineStart: marginXS\n        }\n      }\n    }\n  };\n};\n// ============================== Export ==============================\nexport const prepareComponentToken = token => {\n  const {\n    zIndexPopupBase\n  } = token;\n  return {\n    zIndexPopup: zIndexPopupBase + 60\n  };\n};\nexport default genStyleHooks('Popconfirm', token => genBaseStyle(token), prepareComponentToken, {\n  resetStyle: false\n});","\"use client\";\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport * as React from 'react';\nimport ExclamationCircleFilled from \"@ant-design/icons/es/icons/ExclamationCircleFilled\";\nimport classNames from 'classnames';\nimport ActionButton from '../_util/ActionButton';\nimport { getRenderPropValue } from '../_util/getRenderPropValue';\nimport Button from '../button';\nimport { convertLegacyProps } from '../button/buttonHelpers';\nimport { ConfigContext } from '../config-provider';\nimport { useLocale } from '../locale';\nimport defaultLocale from '../locale/en_US';\nimport PopoverPurePanel from '../popover/PurePanel';\nimport useStyle from './style';\nexport const Overlay = props => {\n  const {\n    prefixCls,\n    okButtonProps,\n    cancelButtonProps,\n    title,\n    description,\n    cancelText,\n    okText,\n    okType = 'primary',\n    icon = /*#__PURE__*/React.createElement(ExclamationCircleFilled, null),\n    showCancel = true,\n    close,\n    onConfirm,\n    onCancel,\n    onPopupClick\n  } = props;\n  const {\n    getPrefixCls\n  } = React.useContext(ConfigContext);\n  const [contextLocale] = useLocale('Popconfirm', defaultLocale.Popconfirm);\n  const titleNode = getRenderPropValue(title);\n  const descriptionNode = getRenderPropValue(description);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: `${prefixCls}-inner-content`,\n    onClick: onPopupClick\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: `${prefixCls}-message`\n  }, icon && /*#__PURE__*/React.createElement(\"span\", {\n    className: `${prefixCls}-message-icon`\n  }, icon), /*#__PURE__*/React.createElement(\"div\", {\n    className: `${prefixCls}-message-text`\n  }, titleNode && /*#__PURE__*/React.createElement(\"div\", {\n    className: `${prefixCls}-title`\n  }, titleNode), descriptionNode && /*#__PURE__*/React.createElement(\"div\", {\n    className: `${prefixCls}-description`\n  }, descriptionNode))), /*#__PURE__*/React.createElement(\"div\", {\n    className: `${prefixCls}-buttons`\n  }, showCancel && (/*#__PURE__*/React.createElement(Button, Object.assign({\n    onClick: onCancel,\n    size: \"small\"\n  }, cancelButtonProps), cancelText || (contextLocale === null || contextLocale === void 0 ? void 0 : contextLocale.cancelText))), /*#__PURE__*/React.createElement(ActionButton, {\n    buttonProps: Object.assign(Object.assign({\n      size: 'small'\n    }, convertLegacyProps(okType)), okButtonProps),\n    actionFn: onConfirm,\n    close: close,\n    prefixCls: getPrefixCls('btn'),\n    quitOnNullishReturnValue: true,\n    emitEvent: true\n  }, okText || (contextLocale === null || contextLocale === void 0 ? void 0 : contextLocale.okText))));\n};\nconst PurePanel = props => {\n  const {\n      prefixCls: customizePrefixCls,\n      placement,\n      className,\n      style\n    } = props,\n    restProps = __rest(props, [\"prefixCls\", \"placement\", \"className\", \"style\"]);\n  const {\n    getPrefixCls\n  } = React.useContext(ConfigContext);\n  const prefixCls = getPrefixCls('popconfirm', customizePrefixCls);\n  const [wrapCSSVar] = useStyle(prefixCls);\n  return wrapCSSVar(/*#__PURE__*/React.createElement(PopoverPurePanel, {\n    placement: placement,\n    className: classNames(prefixCls, className),\n    style: style,\n    content: /*#__PURE__*/React.createElement(Overlay, Object.assign({\n      prefixCls: prefixCls\n    }, restProps))\n  }));\n};\nexport default PurePanel;","\"use client\";\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport * as React from 'react';\nimport ExclamationCircleFilled from \"@ant-design/icons/es/icons/ExclamationCircleFilled\";\nimport classNames from 'classnames';\nimport useMergedState from \"rc-util/es/hooks/useMergedState\";\nimport omit from \"rc-util/es/omit\";\nimport { useComponentConfig } from '../config-provider/context';\nimport Popover from '../popover';\nimport PurePanel, { Overlay } from './PurePanel';\nimport useStyle from './style';\nconst InternalPopconfirm = /*#__PURE__*/React.forwardRef((props, ref) => {\n  var _a, _b;\n  const {\n      prefixCls: customizePrefixCls,\n      placement = 'top',\n      trigger = 'click',\n      okType = 'primary',\n      icon = /*#__PURE__*/React.createElement(ExclamationCircleFilled, null),\n      children,\n      overlayClassName,\n      onOpenChange,\n      onVisibleChange,\n      overlayStyle,\n      styles,\n      classNames: popconfirmClassNames\n    } = props,\n    restProps = __rest(props, [\"prefixCls\", \"placement\", \"trigger\", \"okType\", \"icon\", \"children\", \"overlayClassName\", \"onOpenChange\", \"onVisibleChange\", \"overlayStyle\", \"styles\", \"classNames\"]);\n  const {\n    getPrefixCls,\n    className: contextClassName,\n    style: contextStyle,\n    classNames: contextClassNames,\n    styles: contextStyles\n  } = useComponentConfig('popconfirm');\n  const [open, setOpen] = useMergedState(false, {\n    value: (_a = props.open) !== null && _a !== void 0 ? _a : props.visible,\n    defaultValue: (_b = props.defaultOpen) !== null && _b !== void 0 ? _b : props.defaultVisible\n  });\n  const settingOpen = (value, e) => {\n    setOpen(value, true);\n    onVisibleChange === null || onVisibleChange === void 0 ? void 0 : onVisibleChange(value);\n    onOpenChange === null || onOpenChange === void 0 ? void 0 : onOpenChange(value, e);\n  };\n  const close = e => {\n    settingOpen(false, e);\n  };\n  const onConfirm = e => {\n    var _a;\n    return (_a = props.onConfirm) === null || _a === void 0 ? void 0 : _a.call(this, e);\n  };\n  const onCancel = e => {\n    var _a;\n    settingOpen(false, e);\n    (_a = props.onCancel) === null || _a === void 0 ? void 0 : _a.call(this, e);\n  };\n  const onInternalOpenChange = (value, e) => {\n    const {\n      disabled = false\n    } = props;\n    if (disabled) {\n      return;\n    }\n    settingOpen(value, e);\n  };\n  const prefixCls = getPrefixCls('popconfirm', customizePrefixCls);\n  const rootClassNames = classNames(prefixCls, contextClassName, overlayClassName, contextClassNames.root, popconfirmClassNames === null || popconfirmClassNames === void 0 ? void 0 : popconfirmClassNames.root);\n  const bodyClassNames = classNames(contextClassNames.body, popconfirmClassNames === null || popconfirmClassNames === void 0 ? void 0 : popconfirmClassNames.body);\n  const [wrapCSSVar] = useStyle(prefixCls);\n  return wrapCSSVar(/*#__PURE__*/React.createElement(Popover, Object.assign({}, omit(restProps, ['title']), {\n    trigger: trigger,\n    placement: placement,\n    onOpenChange: onInternalOpenChange,\n    open: open,\n    ref: ref,\n    classNames: {\n      root: rootClassNames,\n      body: bodyClassNames\n    },\n    styles: {\n      root: Object.assign(Object.assign(Object.assign(Object.assign({}, contextStyles.root), contextStyle), overlayStyle), styles === null || styles === void 0 ? void 0 : styles.root),\n      body: Object.assign(Object.assign({}, contextStyles.body), styles === null || styles === void 0 ? void 0 : styles.body)\n    },\n    content: /*#__PURE__*/React.createElement(Overlay, Object.assign({\n      okType: okType,\n      icon: icon\n    }, props, {\n      prefixCls: prefixCls,\n      close: close,\n      onConfirm: onConfirm,\n      onCancel: onCancel\n    })),\n    \"data-popover-inject\": true\n  }), children));\n});\nconst Popconfirm = InternalPopconfirm;\n// We don't care debug panel\n/* istanbul ignore next */\nPopconfirm._InternalPanelDoNotUseOrYouWillBeFired = PurePanel;\nif (process.env.NODE_ENV !== 'production') {\n  Popconfirm.displayName = 'Popconfirm';\n}\nexport default Popconfirm;","export type ImageDataLike = ImageData;\r\n\r\n//#region Canvas Utilities\r\n\r\n/**\r\n * Creates a new HTMLCanvasElement with the specified dimensions.\r\n * @param w Width of the canvas\r\n * @param h Height of the canvas\r\n * @returns The created canvas element\r\n */\r\nexport function createCanvas(w: number, h: number) {\r\n  const c = document.createElement('canvas');\r\n  c.width = w;\r\n  c.height = h;\r\n  return c;\r\n}\r\n\r\n/**\r\n * Loads an image from a URL and draws it onto a new canvas.\r\n * Handles cross-origin loading.\r\n * @param url The URL of the image to load\r\n * @returns Promise resolving to the canvas element containing the image\r\n */\r\nexport function drawImageToCanvasFromUrl(url: string): Promise<HTMLCanvasElement> {\r\n  return new Promise((res, rej) => {\r\n    const img = new Image();\r\n    img.crossOrigin = 'anonymous';\r\n    img.onload = () => {\r\n      const c = createCanvas(img.naturalWidth, img.naturalHeight);\r\n      const ctx = c.getContext('2d')!;\r\n      ctx.drawImage(img, 0, 0);\r\n      res(c);\r\n    };\r\n    img.onerror = rej;\r\n    img.src = url;\r\n  });\r\n}\r\n\r\n/**\r\n * Creates a deep copy of ImageData.\r\n * @param src The source ImageData\r\n * @returns A new ImageData object with copied data\r\n */\r\nexport function cloneImageData(src: ImageDataLike): ImageData {\r\n  const out = new ImageData(src.width, src.height);\r\n  out.data.set(new Uint8ClampedArray(src.data));\r\n  return out;\r\n}\r\n\r\n/**\r\n * Exports a canvas to a Blob object.\r\n * @param canvas The canvas to export\r\n * @param type The MIME type (default: image/png)\r\n * @param quality The image quality (0-1) for lossy formats\r\n * @returns Promise resolving to the Blob\r\n */\r\nexport function exportCanvasToBlob(\r\n  canvas: HTMLCanvasElement,\r\n  type = 'image/png',\r\n  quality = 0.92,\r\n): Promise<Blob> {\r\n  return new Promise((res) => canvas.toBlob((b) => res(b as Blob), type, quality));\r\n}\r\n\r\n//#endregion\r\n\r\n//#region Image Processing Core\r\n\r\n/**\r\n * Applies a convolution kernel to the image data.\r\n * Used for blurring, sharpening, edge detection, etc.\r\n * @param data The image data to process\r\n * @param kernel The convolution kernel (flat array)\r\n * @param kernelSize The width/height of the kernel (must be odd)\r\n * @returns The processed image data\r\n */\r\nexport function applyConvolution(data: ImageData, kernel: number[], kernelSize: number) {\r\n  const w = data.width;\r\n  const h = data.height;\r\n  const src = data.data;\r\n  const out = new Uint8ClampedArray(src.length);\r\n  const half = Math.floor(kernelSize / 2);\r\n\r\n  for (let y = 0; y < h; y++) {\r\n    for (let x = 0; x < w; x++) {\r\n      let r = 0,\r\n        g = 0,\r\n        b = 0,\r\n        a = 0;\r\n      for (let ky = 0; ky < kernelSize; ky++) {\r\n        for (let kx = 0; kx < kernelSize; kx++) {\r\n          const px = x + kx - half;\r\n          const py = y + ky - half;\r\n          if (px < 0 || px >= w || py < 0 || py >= h) continue;\r\n          const idx = (py * w + px) * 4;\r\n          const kval = kernel[ky * kernelSize + kx];\r\n          r += src[idx] * kval;\r\n          g += src[idx + 1] * kval;\r\n          b += src[idx + 2] * kval;\r\n          a += src[idx + 3] * kval;\r\n        }\r\n      }\r\n      const idx = (y * w + x) * 4;\r\n      out[idx] = Math.min(255, Math.max(0, r));\r\n      out[idx + 1] = Math.min(255, Math.max(0, g));\r\n      out[idx + 2] = Math.min(255, Math.max(0, b));\r\n      out[idx + 3] = Math.min(255, Math.max(0, a || src[idx + 3]));\r\n    }\r\n  }\r\n\r\n  data.data.set(out);\r\n  return data;\r\n}\r\n\r\n/**\r\n * Collection of common convolution kernels and generators.\r\n */\r\nexport const Kernels = {\r\n  sharpen: [0, -1, 0, -1, 5, -1, 0, -1, 0],\r\n  blur3: [1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9],\r\n  gaussian5: [\r\n    1 / 273,\r\n    4 / 273,\r\n    7 / 273,\r\n    4 / 273,\r\n    1 / 273,\r\n    4 / 273,\r\n    16 / 273,\r\n    26 / 273,\r\n    16 / 273,\r\n    4 / 273,\r\n    7 / 273,\r\n    26 / 273,\r\n    41 / 273,\r\n    26 / 273,\r\n    7 / 273,\r\n    4 / 273,\r\n    16 / 273,\r\n    26 / 273,\r\n    16 / 273,\r\n    4 / 273,\r\n    1 / 273,\r\n    4 / 273,\r\n    7 / 273,\r\n    4 / 273,\r\n    1 / 273,\r\n  ],\r\n  // -------- New dynamic blur kernel generators --------\r\n  generateBoxBlurKernel(size: number) {\r\n    const s = size | 0;\r\n    const count = s * s;\r\n    return Array(count).fill(1 / count);\r\n  },\r\n\r\n  generateGaussianKernel(radius: number) {\r\n    const r = radius | 0;\r\n    const size = r * 2 + 1;\r\n    const sigma = r / 2;\r\n    const twoSigmaSq = 2 * sigma * sigma;\r\n\r\n    let kernel: number[] = [];\r\n    let sum = 0;\r\n\r\n    for (let y = -r; y <= r; y++) {\r\n      for (let x = -r; x <= r; x++) {\r\n        const v = Math.exp(-(x * x + y * y) / twoSigmaSq);\r\n        kernel.push(v);\r\n        sum += v;\r\n      }\r\n    }\r\n\r\n    // normalize Gaussian kernel\r\n    return kernel.map((v) => v / sum);\r\n  },\r\n};\r\n\r\n//#endregion\r\n\r\n//#region Color & Tone Adjustments\r\n\r\n/**\r\n * Adjusts brightness and contrast of the image.\r\n * @param data Image data to modify\r\n * @param brightness Brightness offset (-255 to 255)\r\n * @param contrast Contrast percentage (-100 to 100)\r\n * @returns Modified image data\r\n */\r\nexport function applyBrightnessContrast(data: ImageData, brightness = 0, contrast = 0) {\r\n  // brightness in [-255,255], contrast in [-100,100]\r\n  const d = data.data;\r\n  const c = contrast / 100 + 1;\r\n  const intercept = 128 * (1 - c);\r\n  for (let i = 0; i < d.length; i += 4) {\r\n    d[i] = Math.min(255, Math.max(0, d[i] * c + intercept + brightness));\r\n    d[i + 1] = Math.min(255, Math.max(0, d[i + 1] * c + intercept + brightness));\r\n    d[i + 2] = Math.min(255, Math.max(0, d[i + 2] * c + intercept + brightness));\r\n  }\r\n  return data;\r\n}\r\n\r\n/**\r\n * Sets alpha to 0 for pixels brighter than the threshold (white removal).\r\n * @param data Image data to modify\r\n * @param threshold Threshold value (0-255)\r\n * @returns Modified image data\r\n */\r\nexport function applyThresholdAlpha(data: ImageData, threshold = 0) {\r\n  threshold = 255 - threshold;\r\n  // If pixel is near-white (all channels > threshold), set alpha = 0\r\n  const d = data.data;\r\n  for (let i = 0; i < d.length; i += 4) {\r\n    if (d[i] > threshold && d[i + 1] > threshold && d[i + 2] > threshold) {\r\n      d[i + 3] = 0;\r\n    }\r\n  }\r\n  return data;\r\n}\r\n\r\n/**\r\n * Sets alpha to 0 for pixels darker than the threshold (black removal).\r\n * @param data Image data to modify\r\n * @param threshold Threshold value (0-255)\r\n * @returns Modified image data\r\n */\r\nexport function applyThresholdAlphaBlack(data: ImageData, threshold = 0) {\r\n  // If pixel is near-black (all RGB channels < threshold), set alpha = 0\r\n  const d = data.data;\r\n  for (let i = 0; i < d.length; i += 4) {\r\n    if (d[i] < threshold && d[i + 1] < threshold && d[i + 2] < threshold) {\r\n      d[i + 3] = 0;\r\n    }\r\n  }\r\n  return data;\r\n}\r\n\r\n/**\r\n * Applies comprehensive tone adjustments including highlights, shadows, and clarity.\r\n * @param data Image data to modify\r\n * @param params Adjustment parameters\r\n * @returns Modified image data\r\n */\r\nexport const applyToneAdjustments = (\r\n  data: ImageData,\r\n  {\r\n    highlights = 0,\r\n    shadows = 0,\r\n    whites = 0,\r\n    blacks = 0,\r\n    vibrance = 0,\r\n    saturation = 0,\r\n    clarity = 0, // local contrast\r\n    dehaze = 0, // remove fog\r\n  }: {\r\n    highlights?: number;\r\n    shadows?: number;\r\n    whites?: number;\r\n    blacks?: number;\r\n    vibrance?: number;\r\n    saturation?: number;\r\n    clarity?: number;\r\n    dehaze?: number;\r\n  },\r\n) => {\r\n  const d = data.data;\r\n\r\n  // If clarity is applied, create a shallow copy for local contrast reference\r\n  const originalData = clarity !== 0 ? new Uint8ClampedArray(d) : null;\r\n\r\n  for (let i = 0; i < d.length; i += 4) {\r\n    let r = d[i];\r\n    let g = d[i + 1];\r\n    let b = d[i + 2];\r\n\r\n    /** ------------------------ 1️⃣ HIGHLIGHTS / SHADOWS ------------------------ **/\r\n    const luma = 0.299 * r + 0.587 * g + 0.114 * b;\r\n    if (luma > 192 && highlights !== 0) {\r\n      const hFactor = (luma - 192) / (255 - 192);\r\n      r = clamp(r + highlights * hFactor);\r\n      g = clamp(g + highlights * hFactor);\r\n      b = clamp(b + highlights * hFactor);\r\n    }\r\n    if (luma < 64 && shadows !== 0) {\r\n      const sFactor = 1 - luma / 64;\r\n      r = clamp(r + shadows * sFactor);\r\n      g = clamp(g + shadows * sFactor);\r\n      b = clamp(b + shadows * sFactor);\r\n    }\r\n\r\n    /** ------------------------ 2️⃣ WHITES / BLACKS ------------------------ **/\r\n    r = clamp(r + whites - blacks);\r\n    g = clamp(g + whites - blacks);\r\n    b = clamp(b + whites - blacks);\r\n\r\n    /** ------------------------ 3️⃣ DEHAZE ------------------------ **/\r\n    if (dehaze !== 0) {\r\n      const factor = 1 + dehaze / 100;\r\n      r = clamp(r * factor);\r\n      g = clamp(g * (1 - dehaze / 200)); // reduce green & blue to reduce 'fog'\r\n      b = clamp(b * (1 - dehaze / 200));\r\n    }\r\n\r\n    /** ------------------------ 4️⃣ VIBRANCE / SATURATION (HSL) ------------------------ **/\r\n    if (vibrance !== 0 || saturation !== 0) {\r\n      const tmp = [r, g, b];\r\n      applyVibranceSaturation(tmp as any, 0, { vibrance, saturation });\r\n      [r, g, b] = tmp;\r\n    }\r\n\r\n    /** ------------------------ 5️⃣ CLARITY (Local contrast) ------------------------ **/\r\n    if (clarity !== 0 && originalData) {\r\n      // baseline luma before enhancements\r\n      const baseLuma =\r\n        0.299 * originalData[i] + 0.587 * originalData[i + 1] + 0.114 * originalData[i + 2];\r\n\r\n      // Clarity: enhance mid-range contrast only\r\n      const contrastFactor = clarity / 100;\r\n      const lumaDiff = (luma - baseLuma) * contrastFactor;\r\n\r\n      r = clamp(r + lumaDiff);\r\n      g = clamp(g + lumaDiff);\r\n      b = clamp(b + lumaDiff);\r\n    }\r\n\r\n    /** ------------------------ WRITE BACK ------------------------ **/\r\n    d[i] = r;\r\n    d[i + 1] = g;\r\n    d[i + 2] = b;\r\n    // alpha unchanged\r\n  }\r\n\r\n  return data;\r\n};\r\n\r\n/**\r\n * Applies dehaze effect to a single pixel.\r\n * @param p Pixel data array\r\n * @param i Index of the red channel\r\n * @param dehaze Dehaze strength\r\n */\r\nexport const applyDehaze = (p: Uint8ClampedArray | number[], i: number, dehaze: number) => {\r\n  // Lightroom-style dehaze: increases contrast and clarity, removes atmospheric haze\r\n  // Positive values: remove haze (increase contrast, saturation)\r\n  // Negative values: add haze (decrease contrast, saturation)\r\n\r\n  let r = p[i];\r\n  let g = p[i + 1];\r\n  let b = p[i + 2];\r\n\r\n  // Convert to HSL for saturation control\r\n  let [h, s, l] = rgbToHsl(r, g, b);\r\n\r\n  // Apply contrast enhancement/reduction around midtones\r\n  // Positive dehaze increases contrast, negative reduces it\r\n  const contrastFactor = 1 + (dehaze / 100) * 1.5;\r\n  const pivot = 128;\r\n\r\n  r = clamp(pivot + (r - pivot) * contrastFactor);\r\n  g = clamp(pivot + (g - pivot) * contrastFactor);\r\n  b = clamp(pivot + (b - pivot) * contrastFactor);\r\n\r\n  // Update HSL after contrast adjustment\r\n  [h, s, l] = rgbToHsl(r, g, b);\r\n\r\n  // Adjust saturation based on dehaze value\r\n  // Positive: increase saturation (remove haze)\r\n  // Negative: decrease saturation (add haze)\r\n  const satFactor = 1 + (dehaze / 100) * 0.6;\r\n  s = clamp01(s * satFactor);\r\n\r\n  // Adjust luminance slightly to maintain brightness\r\n  // Positive dehaze: slight brightness boost\r\n  // Negative dehaze: slight darkening\r\n  const lumFactor = 1 + (dehaze / 100) * 0.15;\r\n  l = clamp01(l * lumFactor);\r\n\r\n  // Convert back to RGB\r\n  [r, g, b] = hslToRgb(h, s, l);\r\n\r\n  p[i] = r;\r\n  p[i + 1] = g;\r\n  p[i + 2] = b;\r\n};\r\n\r\n/**\r\n * Applies vibrance and saturation to a single pixel.\r\n * @param p Pixel data array\r\n * @param i Index of the red channel\r\n * @param params Vibrance and saturation values\r\n */\r\nexport const applyVibranceSaturation = (\r\n  p: Uint8ClampedArray | number[],\r\n  i: number,\r\n  { vibrance = 0, saturation = 0 }: { vibrance?: number; saturation?: number },\r\n) => {\r\n  let [h, s, l] = rgbToHsl(p[i], p[i + 1], p[i + 2]);\r\n\r\n  // --- 1️⃣ Saturation (multiplicative, more natural) ---\r\n  // Example: saturation = 20 → s *= 1.2 ; saturation = -10 → s *= 0.9\r\n  if (saturation !== 0) {\r\n    s = clamp01(s * (1 + saturation / 100));\r\n  }\r\n\r\n  // --- 2️⃣ Vibrance (only boosts low-saturated areas) ---\r\n  if (vibrance !== 0) {\r\n    const factor = vibrance / 100;\r\n    s = clamp01(s + (1 - s) * factor * (1 - s)); // nonlinear → strong effect only if s < 0.5\r\n  }\r\n\r\n  const [r, g, b] = hslToRgb(h, s, l);\r\n  p[i] = r;\r\n  p[i + 1] = g;\r\n  p[i + 2] = b;\r\n};\r\n\r\n//#endregion\r\n\r\n//#region Basic Transforms\r\n\r\n/**\r\n * Flips the canvas horizontally.\r\n * @param canvas The canvas to flip\r\n */\r\nexport function flipHorizontal(canvas: HTMLCanvasElement) {\r\n  const ctx = canvas.getContext('2d')!;\r\n  ctx.save();\r\n  ctx.translate(canvas.width, 0);\r\n  ctx.scale(-1, 1);\r\n  const img = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n  ctx.putImageData(img, 0, 0);\r\n  ctx.restore();\r\n}\r\n\r\n/**\r\n * Flips the canvas vertically.\r\n * @param canvas The canvas to flip\r\n */\r\nexport function flipVertical(canvas: HTMLCanvasElement) {\r\n  const ctx = canvas.getContext('2d')!;\r\n  ctx.save();\r\n  ctx.translate(0, canvas.height);\r\n  ctx.scale(1, -1);\r\n  const img = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n  ctx.putImageData(img, 0, 0);\r\n  ctx.restore();\r\n}\r\n\r\n/**\r\n * Rotates the canvas by the specified degrees.\r\n * Resizes the canvas to fit the rotated image.\r\n * @param canvas The canvas to rotate\r\n * @param degrees Degrees to rotate\r\n */\r\nexport function rotateCanvas(canvas: HTMLCanvasElement, degrees: number) {\r\n  const radians = (degrees * Math.PI) / 180;\r\n  const w = canvas.width;\r\n  const h = canvas.height;\r\n  const c2 = createCanvas(h, w); // Swap dims if 90/270\r\n  const ctx2 = c2.getContext('2d')!;\r\n  ctx2.translate(c2.width / 2, c2.height / 2);\r\n  ctx2.rotate(radians);\r\n  ctx2.drawImage(canvas, -w / 2, -h / 2);\r\n  // resize original\r\n  canvas.width = c2.width;\r\n  canvas.height = c2.height;\r\n  const ctx = canvas.getContext('2d')!;\r\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n  ctx.drawImage(c2, 0, 0);\r\n}\r\n\r\n//#endregion\r\n\r\n//#region Perspective Transform\r\n\r\n/**\r\n * Computes the homography matrix for perspective transformation.\r\n * @param src Source points (4 points)\r\n * @param dst Destination points (4 points)\r\n * @returns 3x3 Homography matrix\r\n */\r\nexport function computeHomography(src: [number, number][], dst: [number, number][]): number[][] {\r\n  if (src.length !== 4 || dst.length !== 4) {\r\n    throw new Error('computeHomography requires exactly 4 points for src and dst');\r\n  }\r\n\r\n  const A: number[][] = [];\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    const [x, y] = src[i];\r\n    const [u, v] = dst[i];\r\n\r\n    A.push([-x, -y, -1, 0, 0, 0, x * u, y * u, u]);\r\n    A.push([0, 0, 0, -x, -y, -1, x * v, y * v, v]);\r\n  }\r\n\r\n  // Solve Ah = 0 using Gaussian elimination for 8x8\r\n  const M: number[][] = [];\r\n  const b: number[] = [];\r\n  for (let i = 0; i < 8; i++) {\r\n    M.push(A[i].slice(0, 8));\r\n    b.push(-A[i][8]);\r\n  }\r\n\r\n  const h8 = solveLinearSystem(M, b); // returns 8 elements\r\n  const h = [...h8, 1]; // last element = 1\r\n\r\n  return [\r\n    [h[0], h[1], h[2]],\r\n    [h[3], h[4], h[5]],\r\n    [h[6], h[7], h[8]],\r\n  ];\r\n}\r\n\r\n// Simple Gaussian elimination solver for 8x8\r\nfunction solveLinearSystem(A: number[][], b: number[]): number[] {\r\n  const n = b.length;\r\n  const M = A.map((row, i) => [...row, b[i]]); // augmented matrix\r\n\r\n  for (let i = 0; i < n; i++) {\r\n    // find pivot\r\n    let maxRow = i;\r\n    for (let k = i + 1; k < n; k++) {\r\n      if (Math.abs(M[k][i]) > Math.abs(M[maxRow][i])) maxRow = k;\r\n    }\r\n    [M[i], M[maxRow]] = [M[maxRow], M[i]];\r\n\r\n    // eliminate column\r\n    for (let k = i + 1; k < n; k++) {\r\n      const factor = M[k][i] / M[i][i];\r\n      for (let j = i; j <= n; j++) M[k][j] -= factor * M[i][j];\r\n    }\r\n  }\r\n\r\n  // back substitution\r\n  const x = new Array(n).fill(0);\r\n  for (let i = n - 1; i >= 0; i--) {\r\n    let sum = M[i][n];\r\n    for (let j = i + 1; j < n; j++) sum -= M[i][j] * x[j];\r\n    x[i] = sum / M[i][i];\r\n  }\r\n  return x;\r\n}\r\n\r\n// Map a destination point (x, y) back to source coordinates using inverse of H\r\nfunction applyHomographyInverse(H: number[][], x: number, y: number): [number, number] {\r\n  const [[h00, h01, h02], [h10, h11, h12], [h20, h21, h22]] = H;\r\n\r\n  const det =\r\n    h00 * (h11 * h22 - h12 * h21) - h01 * (h10 * h22 - h12 * h20) + h02 * (h10 * h21 - h11 * h20);\r\n  if (Math.abs(det) < 1e-10) return [0, 0];\r\n\r\n  const inv = [\r\n    [(h11 * h22 - h12 * h21) / det, (h02 * h21 - h01 * h22) / det, (h01 * h12 - h02 * h11) / det],\r\n    [(h12 * h20 - h10 * h22) / det, (h00 * h22 - h02 * h20) / det, (h02 * h10 - h00 * h12) / det],\r\n    [(h10 * h21 - h11 * h20) / det, (h01 * h20 - h00 * h21) / det, (h00 * h11 - h01 * h10) / det],\r\n  ];\r\n\r\n  const sx = inv[0][0] * x + inv[0][1] * y + inv[0][2];\r\n  const sy = inv[1][0] * x + inv[1][1] * y + inv[1][2];\r\n  const w = inv[2][0] * x + inv[2][1] * y + inv[2][2];\r\n\r\n  return [sx / w, sy / w];\r\n}\r\n\r\n/**\r\n * Applies a perspective transform to the canvas.\r\n * @param srcCanvas Source canvas\r\n * @param srcQuad Source quadrilateral points [x1,y1, x2,y2, x3,y3, x4,y4]\r\n * @param destW Destination width\r\n * @param destH Destination height\r\n * @returns New canvas with transformed image\r\n */\r\nexport function perspectiveTransform(\r\n  srcCanvas: HTMLCanvasElement,\r\n  srcQuad: [number, number, number, number, number, number, number, number],\r\n  destW: number,\r\n  destH: number,\r\n): HTMLCanvasElement {\r\n  const dest = createCanvas(destW, destH);\r\n  const dctx = dest.getContext('2d')!;\r\n  const src = srcCanvas.getContext('2d')!.getImageData(0, 0, srcCanvas.width, srcCanvas.height);\r\n  const destData = dctx.createImageData(destW, destH);\r\n\r\n  const srcPts: [number, number][] = [\r\n    [srcQuad[0], srcQuad[1]],\r\n    [srcQuad[2], srcQuad[3]],\r\n    [srcQuad[4], srcQuad[5]],\r\n    [srcQuad[6], srcQuad[7]],\r\n  ];\r\n  const dstPts: [number, number][] = [\r\n    [0, 0],\r\n    [destW, 0],\r\n    [destW, destH],\r\n    [0, destH],\r\n  ];\r\n\r\n  const H = computeHomography(srcPts, dstPts);\r\n\r\n  for (let y = 0; y < destH; y++) {\r\n    for (let x = 0; x < destW; x++) {\r\n      const [sx, sy] = applyHomographyInverse(H, x, y);\r\n      if (sx >= 0 && sx < srcCanvas.width && sy >= 0 && sy < srcCanvas.height) {\r\n        const ix = Math.floor(sx);\r\n        const iy = Math.floor(sy);\r\n        const srcIndex = (iy * srcCanvas.width + ix) * 4;\r\n        const dstIndex = (y * destW + x) * 4;\r\n        destData.data[dstIndex] = src.data[srcIndex];\r\n        destData.data[dstIndex + 1] = src.data[srcIndex + 1];\r\n        destData.data[dstIndex + 2] = src.data[srcIndex + 2];\r\n        destData.data[dstIndex + 3] = src.data[srcIndex + 3];\r\n      }\r\n    }\r\n  }\r\n\r\n  dctx.putImageData(destData, 0, 0);\r\n  return dest;\r\n}\r\n\r\n//#endregion\r\n\r\n//#region HSL Adjustments\r\n\r\nconst clamp = (value: number, min = 0, max = 255) => {\r\n  return Math.min(max, Math.max(min, value));\r\n};\r\n\r\n// For 0..1 ranges\r\nconst clamp01 = (value: number) => {\r\n  return Math.min(1, Math.max(0, value));\r\n};\r\n\r\nconst rgbToHsl = (r: number, g: number, b: number): [number, number, number] => {\r\n  r /= 255;\r\n  g /= 255;\r\n  b /= 255;\r\n\r\n  const max = Math.max(r, g, b);\r\n  const min = Math.min(r, g, b);\r\n  let h = 0,\r\n    s = 0,\r\n    l = (max + min) / 2;\r\n\r\n  if (max !== min) {\r\n    const d = max - min;\r\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n\r\n    switch (max) {\r\n      case r:\r\n        h = (g - b) / d + (g < b ? 6 : 0);\r\n        break;\r\n      case g:\r\n        h = (b - r) / d + 2;\r\n        break;\r\n      case b:\r\n        h = (r - g) / d + 4;\r\n        break;\r\n    }\r\n    h /= 6;\r\n  }\r\n\r\n  return [h, s, l];\r\n};\r\n\r\nconst hslToRgb = (h: number, s: number, l: number): [number, number, number] => {\r\n  let r: number, g: number, b: number;\r\n\r\n  if (s === 0) {\r\n    r = g = b = l; // achromatic\r\n  } else {\r\n    const hue2rgb = (p: number, q: number, t: number) => {\r\n      if (t < 0) t += 1;\r\n      if (t > 1) t -= 1;\r\n      if (t < 1 / 6) return p + (q - p) * 6 * t;\r\n      if (t < 1 / 2) return q;\r\n      if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\r\n      return p;\r\n    };\r\n\r\n    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n    const p = 2 * l - q;\r\n\r\n    r = hue2rgb(p, q, h + 1 / 3);\r\n    g = hue2rgb(p, q, h);\r\n    b = hue2rgb(p, q, h - 1 / 3);\r\n  }\r\n\r\n  return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];\r\n};\r\n\r\nexport const colorRanges = [\r\n  { name: 'red', range: [345, 15] },\r\n  { name: 'orange', range: [15, 45] },\r\n  { name: 'yellow', range: [45, 75] },\r\n  { name: 'green', range: [75, 165] },\r\n  { name: 'aqua', range: [165, 195] },\r\n  { name: 'blue', range: [195, 255] },\r\n  { name: 'purple', range: [255, 285] },\r\n  { name: 'magenta', range: [285, 345] },\r\n];\r\n\r\n/**\r\n * Applies HSL adjustments to specific color ranges.\r\n * @param data Image data to modify\r\n * @param adjustments Map of color names to HSL adjustments\r\n * @returns Modified image data\r\n */\r\nexport const applyHslAdjustments = (\r\n  data: ImageData,\r\n  adjustments: Record<string, { h?: number; s?: number; l?: number }>, // h: degrees, s/l: percent or fractional\r\n) => {\r\n  const d = data.data;\r\n\r\n  for (let i = 0; i < d.length; i += 4) {\r\n    // Loop through each pixel (step 4: R,G,B,A)\r\n    let [r, g, b] = [d[i], d[i + 1], d[i + 2]]; // Extract RGB\r\n    let [h, s, l] = rgbToHsl(r, g, b); // Convert to HSL (h: 0–1)\r\n    let deg = (h * 360 + 360) % 360; // Convert hue to 0–360° safely\r\n\r\n    // find color range (handles wrap ranges like [345,15])\r\n    const entry = colorRanges.find(({ range }) => {\r\n      const [start, end] = range;\r\n      if (start <= end) {\r\n        return deg >= start && deg <= end;\r\n      } else {\r\n        // wrapped range (e.g. 345 -> 15)\r\n        return deg >= start || deg <= end;\r\n      }\r\n    });\r\n\r\n    if (!entry) {\r\n      // no matching range — write back unchanged\r\n      [d[i], d[i + 1], d[i + 2]] = hslToRgb(h, s, l);\r\n      continue;\r\n    }\r\n\r\n    const adj = adjustments[entry.name];\r\n    if (!adj) {\r\n      [d[i], d[i + 1], d[i + 2]] = hslToRgb(h, s, l);\r\n      continue;\r\n    }\r\n\r\n    const [startRaw, endRaw] = entry.range;\r\n    // Normalize start/end so start <= end (for clamping). If wrapped, push end +360.\r\n    let start = startRaw;\r\n    let end = endRaw;\r\n    if (start > end) end += 360; // e.g., 345..15 => 345..375\r\n\r\n    // Normalize deg into the same space as start..end\r\n    let degNorm = deg;\r\n    if (degNorm < start) degNorm += 360;\r\n\r\n    // ----- HUE: apply degree shift but clamp within the color's range -----\r\n    if (typeof adj.h === 'number' && adj.h !== 0) {\r\n      let newDeg = degNorm + adj.h; // tentative\r\n      // clamp to the range boundaries so it cannot jump outside the color band\r\n      if (newDeg < start) newDeg = start;\r\n      if (newDeg > end) newDeg = end;\r\n      // bring back to 0..360\r\n      deg = ((newDeg % 360) + 360) % 360; // Normalize back to 0–360°\r\n      h = deg / 360; // Convert back to 0–1 for HSL\r\n    }\r\n\r\n    // ----- SATURATION: flexible input handling -----\r\n    if (typeof adj.s === 'number' && adj.s !== 0) {\r\n      // interpret 0.2 as +20% for backward compatibility\r\n      const satPercent = Math.abs(adj.s) <= 1 ? adj.s * 100 : adj.s; // Allow 0.2 or 20 → both = +20%\r\n      s = clamp01(s * (1 + satPercent / 100)); // Apply proportionally\r\n    }\r\n\r\n    // ----- LUMINANCE: same handling as saturation -----\r\n    if (typeof adj.l === 'number' && adj.l !== 0) {\r\n      const lumPercent = Math.abs(adj.l) <= 1 ? adj.l * 100 : adj.l; // e.g. 0.1 → +10%\r\n      l = clamp01(l * (1 + lumPercent / 100)); // Apply multiplicatively\r\n    }\r\n\r\n    // Write final adjusted color back to RGBA buffer\r\n    [d[i], d[i + 1], d[i + 2]] = hslToRgb(h, s, l);\r\n  }\r\n\r\n  return data;\r\n};\r\n\r\n//#endregion\r\n","import { message } from 'antd';\r\nimport { createCanvas } from './ImageEditorEngine';\r\n\r\n// #region Rotate / Transform Helpers\r\n// rotate\r\nexport const rotate = (deg: number, canvasRef, overlayRef, history) => {\r\n  if (!canvasRef.current) return;\r\n  // create temp canvas and rotate\r\n  const src = canvasRef.current;\r\n  const tmp = createCanvas(src.width, src.height);\r\n  const tctx = tmp.getContext('2d')!;\r\n  tctx.drawImage(src, 0, 0);\r\n  const dest = createCanvas(src.height, src.width);\r\n  const dctx = dest.getContext('2d')!;\r\n  dctx.translate(dest.width / 2, dest.height / 2);\r\n  dctx.rotate((deg * Math.PI) / 180);\r\n  dctx.drawImage(tmp, -tmp.width / 2, -tmp.height / 2);\r\n  // replace\r\n  canvasRef.current.width = dest.width;\r\n  canvasRef.current.height = dest.height;\r\n  overlayRef.current!.width = dest.width;\r\n  overlayRef.current!.height = dest.height;\r\n  const wctx = canvasRef.current.getContext('2d')!;\r\n  wctx.clearRect(0, 0, dest.width, dest.height);\r\n  wctx.drawImage(dest, 0, 0);\r\n  history.push(canvasRef.current.toDataURL(), `Rotate ${deg}`);\r\n};\r\n\r\n// flip\r\nexport const flipH = (canvasRef, history) => {\r\n  if (!canvasRef.current) return;\r\n  const ctx = canvasRef.current.getContext('2d')!;\r\n  const tmp = createCanvas(canvasRef.current.width, canvasRef.current.height);\r\n  tmp.getContext('2d')!.drawImage(canvasRef.current, 0, 0);\r\n  ctx.save();\r\n  ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n  ctx.scale(-1, 1);\r\n  ctx.drawImage(tmp, -canvasRef.current.width, 0);\r\n  ctx.restore();\r\n  history.push(canvasRef.current.toDataURL(), 'Flip horizontal');\r\n};\r\n\r\nexport const flipV = (canvasRef, history) => {\r\n  if (!canvasRef.current) return;\r\n  const ctx = canvasRef.current.getContext('2d')!;\r\n  const tmp = createCanvas(canvasRef.current.width, canvasRef.current.height);\r\n  tmp.getContext('2d')!.drawImage(canvasRef.current, 0, 0);\r\n  ctx.save();\r\n  ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n  ctx.scale(1, -1);\r\n  ctx.drawImage(tmp, 0, -canvasRef.current.height);\r\n  ctx.restore();\r\n  history.push(canvasRef.current.toDataURL(), 'Flip vertical');\r\n};\r\n\r\n// #region Crop\r\n// Crop: apply cropRect to canvas\r\nexport const applyCrop = (canvasRef, overlayRef, cropRect, setCropRect, history) => {\r\n  if (!canvasRef.current || !cropRect) return;\r\n  const c = createCanvas(Math.max(1, Math.round(cropRect.w)), Math.max(1, Math.round(cropRect.h)));\r\n  const ctx = c.getContext('2d')!;\r\n  ctx.drawImage(\r\n    canvasRef.current,\r\n    cropRect.x,\r\n    cropRect.y,\r\n    cropRect.w,\r\n    cropRect.h,\r\n    0,\r\n    0,\r\n    cropRect.w,\r\n    cropRect.h,\r\n  );\r\n  // replace current canvas\r\n  canvasRef.current.width = c.width;\r\n  canvasRef.current.height = c.height;\r\n  overlayRef.current!.width = c.width;\r\n  overlayRef.current!.height = c.height;\r\n  const wctx = canvasRef.current.getContext('2d')!;\r\n  wctx.clearRect(0, 0, c.width, c.height);\r\n  wctx.drawImage(c, 0, 0);\r\n  setCropRect(null);\r\n  history.push(canvasRef.current.toDataURL(), 'Cropped');\r\n};\r\n// #endregion\r\n\r\n// #region Export / Clipboard\r\n// exportImage\r\nexport const exportImage = async (asJpeg = false, canvasRef, onExport) => {\r\n  if (!canvasRef.current) return;\r\n  const blob = await new Promise<Blob | null>((res) =>\r\n    canvasRef.current!.toBlob((b) => res(b), asJpeg ? 'image/jpeg' : 'image/png', 0.92),\r\n  );\r\n  if (!blob) return;\r\n  if (onExport) onExport(blob);\r\n  // auto download\r\n  const url = URL.createObjectURL(blob);\r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = asJpeg ? 'edited.jpg' : 'edited.png';\r\n  a.click();\r\n  URL.revokeObjectURL(url);\r\n  message.success('Exported image');\r\n};\r\n\r\n// copy to clipboard (image)\r\nexport const copyToClipboard = async (canvasRef) => {\r\n  if (!canvasRef.current) return;\r\n  try {\r\n    const blob = await new Promise<Blob | null>((res) =>\r\n      canvasRef.current!.toBlob((b) => res(b), 'image/png'),\r\n    );\r\n    if (!blob) return;\r\n    // @ts-ignore navigator.clipboard\r\n    await (navigator.clipboard as any).write([new ClipboardItem({ 'image/png': blob })]);\r\n    message.success('Image copied to clipboard');\r\n  } catch (err) {\r\n    console.warn('clipboard failed', err);\r\n    message.error('Copy failed (browser may not support)');\r\n  }\r\n};\r\n// #endregion\r\n\r\n// #region Color Picker\r\n/** --- COLOR PICKER --- */\r\nexport const samplePixel = (e: MouseEvent, canvasRef, zoom) => {\r\n  const canvas = canvasRef.current;\r\n  if (!canvas) return null;\r\n\r\n  const rect = canvas.getBoundingClientRect();\r\n  const x = Math.floor((e.clientX - rect.left) / zoom);\r\n  const y = Math.floor((e.clientY - rect.top) / zoom);\r\n  if (x < 0 || y < 0 || x >= canvas.width || y >= canvas.height) return null;\r\n\r\n  const ctx = canvas.getContext('2d', { willReadFrequently: true });\r\n  if (!ctx) return null;\r\n  const p = ctx.getImageData(x, y, 1, 1).data;\r\n  return `#${[p[0], p[1], p[2]].map((v) => v.toString(16).padStart(2, '0')).join('')}`;\r\n};\r\n// #endregion\r\n","import { message } from 'antd';\r\nimport { createCanvas } from './ImageEditorEngine';\r\nimport { Tool } from '../components/ImageEditor';\r\n\r\nexport const addOverlayImage = (\r\n  file: File,\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  setLayers: React.Dispatch<any>,\r\n  setActiveLayerId: (id: string | null) => void,\r\n  setOverlaySelected: (v: boolean) => void,\r\n  drawOverlay: () => void,\r\n  setTool: React.Dispatch<React.SetStateAction<Tool>>,\r\n) => {\r\n  const img = new Image();\r\n  img.onload = () => {\r\n    const cw = canvasRef.current?.width || img.naturalWidth;\r\n    const ch = canvasRef.current?.height || img.naturalHeight;\r\n    let w = img.naturalWidth;\r\n    let h = img.naturalHeight;\r\n    const scale = Math.min(1, Math.min(cw / (w * 1.2), ch / (h * 1.2)));\r\n    w = Math.round(w * scale);\r\n    h = Math.round(h * scale);\r\n    const x = Math.round((cw - w) / 2);\r\n    const y = Math.round((ch - h) / 2);\r\n    const id = `${Date.now()}_${Math.round(Math.random() * 10000)}`;\r\n    const newLayer = {\r\n      id,\r\n      type: 'image' as const,\r\n      img,\r\n      rect: { x, y, w, h },\r\n      opacity: 1,\r\n      blend: 'source-over' as const,\r\n    } as any;\r\n    setLayers((prev: any) => [...prev, newLayer]);\r\n    setActiveLayerId(id);\r\n    setOverlaySelected(true);\r\n    drawOverlay();\r\n\r\n    message.success('Overlay image added');\r\n  };\r\n  img.onerror = () => message.error('Failed to load overlay image');\r\n  img.src = URL.createObjectURL(file);\r\n  setTool('layer');\r\n};\r\n\r\n/**\r\n * Apply mask to a layer by creating a temporary canvas with the mask applied\r\n */\r\nconst applyMaskToLayer = (\r\n  layer: any,\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  w: number,\r\n  h: number,\r\n) => {\r\n  if (!layer.mask) {\r\n    // No mask, draw normally\r\n    if (layer.type === 'image' && layer.img) {\r\n      ctx.drawImage(layer.img, x, y, w, h);\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Create temporary canvas for masked content\r\n  const tempCanvas = createCanvas(w, h);\r\n  const tempCtx = tempCanvas.getContext('2d')!;\r\n\r\n  // Draw the layer content\r\n  if (layer.type === 'image' && layer.img) {\r\n    tempCtx.drawImage(layer.img, 0, 0, w, h);\r\n  }\r\n\r\n  // Apply mask using destination-in composite mode\r\n  tempCtx.globalCompositeOperation = 'destination-in';\r\n  tempCtx.drawImage(layer.mask, 0, 0, w, h);\r\n\r\n  // Draw the masked result to main canvas\r\n  ctx.drawImage(tempCanvas, x, y);\r\n};\r\n\r\nexport const exportWithOverlay = async (\r\n  asJpeg: boolean,\r\n  canvasRefArg: React.RefObject<HTMLCanvasElement>,\r\n  layers: any[],\r\n  callback?: (blob: Blob) => void,\r\n) => {\r\n  if (!canvasRefArg.current) return;\r\n  const base = canvasRefArg.current;\r\n  const tmp = createCanvas(base.width, base.height);\r\n  const tctx = tmp.getContext('2d')!;\r\n  tctx.clearRect(0, 0, tmp.width, tmp.height);\r\n  tctx.drawImage(base, 0, 0);\r\n  for (const L of layers) {\r\n    try {\r\n      tctx.save();\r\n      tctx.globalAlpha = L.opacity;\r\n      tctx.globalCompositeOperation = L.blend || 'source-over';\r\n\r\n      // Apply rotation if layer is rotated\r\n      if (L.rotation && L.rotation !== 0) {\r\n        const centerX = L.rect.x + L.rect.w / 2;\r\n        const centerY = L.rect.y + L.rect.h / 2;\r\n        tctx.translate(centerX, centerY);\r\n        tctx.rotate((L.rotation * Math.PI) / 180);\r\n        tctx.translate(-centerX, -centerY);\r\n      }\r\n\r\n      if (L.type === 'image' && L.img) {\r\n        // Apply mask if present\r\n        applyMaskToLayer(L, tctx, L.rect.x, L.rect.y, L.rect.w, L.rect.h);\r\n      } else if (L.type === 'text') {\r\n        // Render text layer\r\n        const fontStyle = L.fontItalic ? 'italic' : 'normal';\r\n        const fontWeight = L.fontWeight || 'normal';\r\n        const fontSize = L.fontSize || 16;\r\n        tctx.font = `${fontStyle} ${fontWeight} ${fontSize}px ${L.font || 'Arial'}`;\r\n        tctx.fillStyle = L.textColor || '#000000';\r\n        tctx.textAlign = L.textAlign || 'left';\r\n        tctx.textBaseline = 'top';\r\n\r\n        // Draw text\r\n        const lines = (L.text || '').split('\\n');\r\n        const lineHeight = fontSize * 1.2;\r\n        let currentY = L.rect.y;\r\n        for (const line of lines) {\r\n          let xPos = L.rect.x;\r\n          if (L.textAlign === 'center') xPos += L.rect.w / 2;\r\n          else if (L.textAlign === 'right') xPos += L.rect.w;\r\n\r\n          tctx.fillText(line, xPos, currentY);\r\n\r\n          // Draw decoration\r\n          if (L.textDecoration === 'underline') {\r\n            const metrics = tctx.measureText(line);\r\n            tctx.strokeStyle = L.textColor || '#000000';\r\n            tctx.lineWidth = 1;\r\n            tctx.beginPath();\r\n            tctx.moveTo(xPos, currentY + fontSize);\r\n            tctx.lineTo(xPos + metrics.width, currentY + fontSize);\r\n            tctx.stroke();\r\n          } else if (L.textDecoration === 'line-through') {\r\n            const metrics = tctx.measureText(line);\r\n            tctx.strokeStyle = L.textColor || '#000000';\r\n            tctx.lineWidth = 1;\r\n            tctx.beginPath();\r\n            tctx.moveTo(xPos, currentY + fontSize / 2);\r\n            tctx.lineTo(xPos + metrics.width, currentY + fontSize / 2);\r\n            tctx.stroke();\r\n          }\r\n          currentY += lineHeight;\r\n        }\r\n      }\r\n\r\n      tctx.restore();\r\n    } catch (err) {\r\n      // ignore\r\n    }\r\n  }\r\n  tctx.globalAlpha = 1;\r\n  tctx.globalCompositeOperation = 'source-over';\r\n  const blob = await new Promise<Blob | null>((res) =>\r\n    tmp.toBlob((b) => res(b), asJpeg ? 'image/jpeg' : 'image/png', 0.92),\r\n  );\r\n  if (blob) {\r\n    if (callback) callback(blob);\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = asJpeg ? 'edited.jpg' : 'edited.png';\r\n    a.click();\r\n    URL.revokeObjectURL(url);\r\n    message.success('Exported image (with overlays)');\r\n  }\r\n};\r\n\r\nexport const mergeLayerIntoBase = (\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  layers: any[],\r\n  setLayers: React.Dispatch<any>,\r\n  history: { push: (s: string, label: string) => void },\r\n  id?: string,\r\n) => {\r\n  if (!canvasRef.current) return;\r\n  const toMerge = id ? layers.filter((l) => l.id === id && !l.locked) : layers.slice();\r\n  if (toMerge.length === 0) return;\r\n\r\n  const ctx = canvasRef.current.getContext('2d')!;\r\n  for (const L of toMerge) {\r\n    try {\r\n      ctx.save();\r\n      ctx.globalAlpha = L.opacity;\r\n      ctx.globalCompositeOperation = L.blend || 'source-over';\r\n\r\n      // Apply rotation if layer is rotated\r\n      if (L.rotation && L.rotation !== 0) {\r\n        const centerX = L.rect.x + L.rect.w / 2;\r\n        const centerY = L.rect.y + L.rect.h / 2;\r\n        ctx.translate(centerX, centerY);\r\n        ctx.rotate((L.rotation * Math.PI) / 180);\r\n        ctx.translate(-centerX, -centerY);\r\n      }\r\n\r\n      if (L.type === 'image' && L.img) {\r\n        // Apply mask if present\r\n        applyMaskToLayer(L, ctx, L.rect.x, L.rect.y, L.rect.w, L.rect.h);\r\n      } else if (L.type === 'text') {\r\n        // Render text layer\r\n        const fontStyle = L.fontItalic ? 'italic' : 'normal';\r\n        const fontWeight = L.fontWeight || 'normal';\r\n        const fontSize = L.fontSize || 16;\r\n        ctx.font = `${fontStyle} ${fontWeight} ${fontSize}px ${L.font || 'Arial'}`;\r\n        ctx.fillStyle = L.textColor || '#000000';\r\n        ctx.textAlign = L.textAlign || 'left';\r\n        ctx.textBaseline = 'top';\r\n\r\n        const lines = (L.text || '').split('\\n');\r\n        const lineHeight = fontSize * 1.2;\r\n        let currentY = L.rect.y;\r\n        for (const line of lines) {\r\n          let xPos = L.rect.x;\r\n          if (L.textAlign === 'center') xPos += L.rect.w / 2;\r\n          else if (L.textAlign === 'right') xPos += L.rect.w;\r\n\r\n          ctx.fillText(line, xPos, currentY);\r\n\r\n          // Draw decoration\r\n          if (L.textDecoration === 'underline') {\r\n            const metrics = ctx.measureText(line);\r\n            ctx.strokeStyle = L.textColor || '#000000';\r\n            ctx.lineWidth = 1;\r\n            ctx.beginPath();\r\n            ctx.moveTo(xPos, currentY + fontSize);\r\n            ctx.lineTo(xPos + metrics.width, currentY + fontSize);\r\n            ctx.stroke();\r\n          } else if (L.textDecoration === 'line-through') {\r\n            const metrics = ctx.measureText(line);\r\n            ctx.strokeStyle = L.textColor || '#000000';\r\n            ctx.lineWidth = 1;\r\n            ctx.beginPath();\r\n            ctx.moveTo(xPos, currentY + fontSize / 2);\r\n            ctx.lineTo(xPos + metrics.width, currentY + fontSize / 2);\r\n            ctx.stroke();\r\n          }\r\n          currentY += lineHeight;\r\n        }\r\n      }\r\n      ctx.restore();\r\n    } catch (err) {\r\n      // ignore\r\n    }\r\n  }\r\n  setLayers((prev) => prev.filter((l: any) => !toMerge.find((m: any) => m.id === l.id)));\r\n  history.push(canvasRef.current.toDataURL(), id ? 'Merge layer' : 'Merge layers');\r\n  message.success('Layer(s) merged into base');\r\n};\r\n\r\nexport const setLayerOpacity = (setLayers: React.Dispatch<any>, id: string, opacity: number) =>\r\n  setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, opacity } : L)));\r\n\r\nexport const setLayerBlend = (\r\n  setLayers: React.Dispatch<any>,\r\n  id: string,\r\n  blend: GlobalCompositeOperation,\r\n) => setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, blend } : L)));\r\n\r\nexport const moveLayerUp = (setLayers: React.Dispatch<any>, id: string) =>\r\n  setLayers((prev: any) => {\r\n    const idx = prev.findIndex((p: any) => p.id === id);\r\n    if (idx === -1 || idx === prev.length - 1) return prev;\r\n    const copy = prev.slice();\r\n    const tmp = copy[idx + 1];\r\n    copy[idx + 1] = copy[idx];\r\n    copy[idx] = tmp;\r\n    return copy;\r\n  });\r\n\r\nexport const moveLayerDown = (setLayers: React.Dispatch<any>, id: string) =>\r\n  setLayers((prev: any) => {\r\n    const idx = prev.findIndex((p: any) => p.id === id);\r\n    if (idx <= 0) return prev;\r\n    const copy = prev.slice();\r\n    const tmp = copy[idx - 1];\r\n    copy[idx - 1] = copy[idx];\r\n    copy[idx] = tmp;\r\n    return copy;\r\n  });\r\n\r\nexport const deleteLayer = (\r\n  setLayers: React.Dispatch<any>,\r\n  id: string,\r\n  setActiveLayerId?: (id: string | null) => void,\r\n) =>\r\n  setLayers((prev: any) => {\r\n    const copy = prev.filter((p: any) => p.id !== id || p.locked);\r\n    if (setActiveLayerId) setActiveLayerId(copy.length ? copy[copy.length - 1].id : null);\r\n    return copy;\r\n  });\r\n\r\nexport const selectLayer = (setActiveLayerId: (id: string | null) => void, id: string) => {\r\n  setActiveLayerId(id);\r\n};\r\n\r\n// Text layer helpers\r\nexport const addTextLayer = (\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  setLayers: React.Dispatch<any>,\r\n  setActiveLayerId: (id: string | null) => void,\r\n  setOverlaySelected: (v: boolean) => void,\r\n  drawOverlay: () => void,\r\n  textProps: {\r\n    text: string;\r\n    font: string;\r\n    fontSize: number;\r\n    fontWeight: any;\r\n    fontItalic: boolean;\r\n    textDecoration: 'none' | 'underline' | 'line-through';\r\n    textColor: string;\r\n    textAlign: 'left' | 'center' | 'right';\r\n  },\r\n  pos?: { x: number; y: number },\r\n) => {\r\n  if (!textProps.text.trim()) {\r\n    message.warning('Please enter text first');\r\n    return;\r\n  }\r\n\r\n  const cw = canvasRef.current?.width || 400;\r\n  const ch = canvasRef.current?.height || 300;\r\n  const x = pos ? Math.round(pos.x) : Math.round(cw / 4);\r\n  const y = pos ? Math.round(pos.y) : Math.round(ch / 4);\r\n  const id = `text_${Date.now()}_${Math.round(Math.random() * 10000)}`;\r\n\r\n  const newLayer = {\r\n    id,\r\n    type: 'text' as const,\r\n    rect: { x, y, w: Math.min(300, cw / 2), h: textProps.fontSize + 20 },\r\n    opacity: 1,\r\n    blend: 'source-over' as const,\r\n    text: textProps.text,\r\n    font: textProps.font,\r\n    fontSize: textProps.fontSize,\r\n    fontWeight: textProps.fontWeight,\r\n    fontItalic: textProps.fontItalic,\r\n    textDecoration: textProps.textDecoration,\r\n    textColor: textProps.textColor,\r\n    textAlign: textProps.textAlign,\r\n  } as any;\r\n\r\n  setLayers((prev: any) => [...prev, newLayer]);\r\n  setActiveLayerId(id);\r\n  setOverlaySelected(true);\r\n  drawOverlay();\r\n  message.success('Text layer added');\r\n};\r\n\r\nexport const setLayerText = (setLayers: React.Dispatch<any>, id: string, text: string) =>\r\n  setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, text } : L)));\r\n\r\nexport const setLayerFont = (setLayers: React.Dispatch<any>, id: string, font: string) =>\r\n  setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, font } : L)));\r\n\r\nexport const setLayerFontSize = (setLayers: React.Dispatch<any>, id: string, fontSize: number) =>\r\n  setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, fontSize } : L)));\r\n\r\nexport const setLayerFontWeight = (setLayers: React.Dispatch<any>, id: string, fontWeight: any) =>\r\n  setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, fontWeight } : L)));\r\n\r\nexport const setLayerFontItalic = (\r\n  setLayers: React.Dispatch<any>,\r\n  id: string,\r\n  fontItalic: boolean,\r\n) => setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, fontItalic } : L)));\r\n\r\nexport const setLayerTextDecoration = (\r\n  setLayers: React.Dispatch<any>,\r\n  id: string,\r\n  textDecoration: 'none' | 'underline' | 'line-through',\r\n) => setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, textDecoration } : L)));\r\n\r\nexport const setLayerTextColor = (setLayers: React.Dispatch<any>, id: string, textColor: string) =>\r\n  setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, textColor } : L)));\r\n\r\nexport const setLayerTextAlign = (\r\n  setLayers: React.Dispatch<any>,\r\n  id: string,\r\n  textAlign: 'left' | 'center' | 'right',\r\n) => setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, textAlign } : L)));\r\n","// Reusable brush utilities for drawing operations\r\n\r\n//#region Types\r\nexport type BrushSettings = {\r\n  color: string;\r\n  lineWidth: number;\r\n  opacity: number;\r\n  flow: number;\r\n  type: 'hard' | 'soft';\r\n};\r\n//#endregion\r\n\r\n//#region Drawing Functions\r\n/**\r\n * Draw a stroke on canvas with brush settings.\r\n * Handles both hard and soft brushes using shadowBlur for softness.\r\n *\r\n * @param ctx - The canvas 2D context to draw on\r\n * @param points - Array of points {x, y} representing the stroke path\r\n * @param settings - Brush configuration (color, size, opacity, etc.)\r\n */\r\nexport const drawBrushStroke = (\r\n  ctx: CanvasRenderingContext2D,\r\n  points: { x: number; y: number }[],\r\n  settings: BrushSettings,\r\n) => {\r\n  if (points.length < 2) return;\r\n\r\n  ctx.save();\r\n  // Combine opacity and flow for the stroke alpha\r\n  ctx.globalAlpha = settings.opacity * settings.flow;\r\n\r\n  // For soft brushes, use shadow blur to create the soft edge effect\r\n  if (settings.type === 'soft') {\r\n    ctx.shadowColor = settings.color;\r\n    ctx.shadowBlur = settings.lineWidth * 0.5;\r\n    // Reduce actual line width when using shadow to avoid a hard core\r\n    ctx.lineWidth = settings.lineWidth * 0.5;\r\n  } else {\r\n    ctx.shadowBlur = 0;\r\n    ctx.lineWidth = settings.lineWidth;\r\n  }\r\n\r\n  ctx.strokeStyle = settings.color;\r\n  ctx.lineCap = 'round';\r\n  ctx.lineJoin = 'round';\r\n\r\n  ctx.beginPath();\r\n  ctx.moveTo(points[0].x, points[0].y);\r\n  for (let i = 1; i < points.length; i++) {\r\n    ctx.lineTo(points[i].x, points[i].y);\r\n  }\r\n  ctx.stroke();\r\n  ctx.restore();\r\n};\r\n\r\n/**\r\n * Draw brush cursor overlay (circle outline).\r\n *\r\n * @param ctx - The overlay canvas context\r\n * @param x - Center X coordinate\r\n * @param y - Center Y coordinate\r\n * @param size - Diameter of the brush\r\n * @param color - Color of the cursor outline\r\n * @param zoom - Current zoom level (to keep line width constant on screen)\r\n */\r\nexport const drawBrushCursor = (\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  size: number,\r\n  color: string,\r\n  zoom: number = 1,\r\n) => {\r\n  ctx.save();\r\n  ctx.strokeStyle = color;\r\n  // Keep the cursor outline thin regardless of zoom\r\n  ctx.lineWidth = 2 / zoom;\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, size / 2, 0, Math.PI * 2);\r\n  ctx.stroke();\r\n  ctx.restore();\r\n};\r\n//#endregion\r\n\r\n//#region Coordinate Helpers\r\n/**\r\n * Convert mouse event client coordinates to canvas-relative coordinates.\r\n * Accounts for zoom and pan offset.\r\n *\r\n * @param e - Mouse event\r\n * @param canvasRef - Reference to the canvas element\r\n * @param zoom - Current zoom level\r\n * @param offset - Current pan offset {x, y}\r\n * @returns {x, y} in canvas coordinates or null if canvas not found\r\n */\r\nexport const getCanvasCoords = (\r\n  e: MouseEvent | React.MouseEvent,\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  zoom: number = 1,\r\n  offset: { x: number; y: number } = { x: 0, y: 0 },\r\n): { x: number; y: number } | null => {\r\n  if (!canvasRef.current) return null;\r\n  const rect = canvasRef.current.getBoundingClientRect();\r\n  return {\r\n    x: (e.clientX - rect.left) / zoom - offset.x,\r\n    y: (e.clientY - rect.top) / zoom - offset.y,\r\n  };\r\n};\r\n//#endregion\r\n\r\n//#region Color Helpers\r\n/**\r\n * Sample pixel color from canvas at specific coordinates.\r\n *\r\n * @param canvas - The source canvas\r\n * @param x - X coordinate\r\n * @param y - Y coordinate\r\n * @returns Hex color string (e.g. \"#ff0000\") or null\r\n */\r\nexport const samplePixelColor = (\r\n  canvas: HTMLCanvasElement,\r\n  x: number,\r\n  y: number,\r\n): string | null => {\r\n  const ctx = canvas.getContext('2d');\r\n  if (!ctx) return null;\r\n\r\n  const imageData = ctx.getImageData(x, y, 1, 1);\r\n  const [r, g, b] = imageData.data;\r\n  return `#${[r, g, b].map((v) => v.toString(16).padStart(2, '0')).join('')}`;\r\n};\r\n//#endregion\r\n","import { drawBrushCursor } from './brushHelpers';\r\n\r\nexport const drawOverlayHelper = (\r\n  overlayRef: React.RefObject<HTMLCanvasElement>,\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  params: {\r\n    zoom: number;\r\n    cropRect: { x: number; y: number; w: number; h: number } | null;\r\n    rulerPoints: { x1: number; y1: number; x2: number; y2: number } | null;\r\n    perspectivePoints: number[] | null;\r\n    hoverColor: { x: number; y: number; color: string } | null;\r\n    tool: any;\r\n    drawColor: string;\r\n    drawLineWidth: number;\r\n    layers: any[];\r\n    overlaySelected: boolean;\r\n    activeLayerId?: string | null;\r\n  },\r\n) => {\r\n  if (!overlayRef.current || !canvasRef.current) return;\r\n  const {\r\n    zoom,\r\n    cropRect,\r\n    rulerPoints,\r\n    perspectivePoints,\r\n    hoverColor,\r\n    tool,\r\n    drawColor,\r\n    drawLineWidth,\r\n    layers,\r\n    overlaySelected,\r\n    activeLayerId,\r\n  } = params;\r\n\r\n  const ctx = overlayRef.current.getContext('2d')!;\r\n  ctx.clearRect(0, 0, overlayRef.current.width, overlayRef.current.height);\r\n\r\n  // Crop rectangle\r\n  if (cropRect) {\r\n    ctx.save();\r\n    ctx.strokeStyle = '#00aaff';\r\n    ctx.lineWidth = 2;\r\n    ctx.setLineDash([6, 4]);\r\n    ctx.strokeRect(cropRect.x, cropRect.y, cropRect.w, cropRect.h);\r\n    ctx.restore();\r\n  }\r\n\r\n  // Ruler\r\n  if (rulerPoints) {\r\n    ctx.save();\r\n    ctx.strokeStyle = '#ffcc00';\r\n    ctx.lineWidth = 2;\r\n    ctx.beginPath();\r\n    ctx.moveTo(rulerPoints.x1, rulerPoints.y1);\r\n    ctx.lineTo(rulerPoints.x2, rulerPoints.y2);\r\n    ctx.stroke();\r\n    ctx.restore();\r\n  }\r\n\r\n  // Perspective points\r\n  if (perspectivePoints) {\r\n    const p = perspectivePoints;\r\n    ctx.save();\r\n    const validPoints: { x: number; y: number }[] = [];\r\n    for (let i = 0; i < 8; i += 2) {\r\n      const px = p[i];\r\n      const py = p[i + 1];\r\n      if (!isNaN(px) && !isNaN(py)) validPoints.push({ x: px, y: py });\r\n    }\r\n\r\n    if (validPoints.length >= 2) {\r\n      ctx.strokeStyle = 'rgba(0,255,0,0.9)';\r\n      ctx.lineWidth = 2;\r\n      ctx.setLineDash([4, 4]);\r\n      ctx.beginPath();\r\n      ctx.moveTo(validPoints[0].x, validPoints[0].y);\r\n      for (let i = 1; i < validPoints.length; i++) ctx.lineTo(validPoints[i].x, validPoints[i].y);\r\n      if (validPoints.length === 4) ctx.closePath();\r\n      ctx.stroke();\r\n    }\r\n\r\n    ctx.fillStyle = 'rgba(0,255,0,0.9)';\r\n    for (let i = 0; i < 8; i += 2) {\r\n      const x = p[i];\r\n      const y = p[i + 1];\r\n      if (!isNaN(x) && !isNaN(y)) ctx.fillRect(x - 5, y - 5, 10, 10);\r\n    }\r\n    ctx.restore();\r\n  }\r\n\r\n  // Color hover\r\n  if (hoverColor && (tool === 'color' || tool === 'removeColor')) {\r\n    const rect = canvasRef.current.getBoundingClientRect();\r\n    const canvasX = (hoverColor.x - rect.left) / zoom;\r\n    const canvasY = (hoverColor.y - rect.top) / zoom;\r\n    drawBrushCursor(ctx, canvasX, canvasY, 16 / zoom, hoverColor.color, zoom);\r\n  }\r\n\r\n  // draw layers\r\n  for (const L of layers) {\r\n    try {\r\n      ctx.save();\r\n      ctx.globalAlpha = L.opacity;\r\n      ctx.globalCompositeOperation = L.blend || 'source-over';\r\n\r\n      // Apply rotation if specified\r\n      if (L.rotation && L.rotation !== 0) {\r\n        const centerX = L.rect.x + L.rect.w / 2;\r\n        const centerY = L.rect.y + L.rect.h / 2;\r\n        ctx.translate(centerX, centerY);\r\n        ctx.rotate((L.rotation * Math.PI) / 180);\r\n        ctx.translate(-centerX, -centerY);\r\n      }\r\n\r\n      if (L.type === 'image' && L.img) {\r\n        if (L.mask) {\r\n          // Apply mask for preview\r\n          const tempCanvas = document.createElement('canvas');\r\n          tempCanvas.width = L.rect.w;\r\n          tempCanvas.height = L.rect.h;\r\n          const tempCtx = tempCanvas.getContext('2d')!;\r\n          tempCtx.drawImage(L.img, 0, 0, L.rect.w, L.rect.h);\r\n          tempCtx.globalCompositeOperation = 'destination-in';\r\n          tempCtx.drawImage(L.mask, 0, 0, L.rect.w, L.rect.h);\r\n          ctx.drawImage(tempCanvas, L.rect.x, L.rect.y);\r\n        } else {\r\n          ctx.drawImage(L.img, L.rect.x, L.rect.y, L.rect.w, L.rect.h);\r\n        }\r\n      } else if (L.type === 'text') {\r\n        // Render text layer in overlay\r\n        const fontStyle = L.fontItalic ? 'italic' : 'normal';\r\n        const fontWeight = L.fontWeight || 'normal';\r\n        const fontSize = L.fontSize || 16;\r\n        ctx.font = `${fontStyle} ${fontWeight} ${fontSize}px ${L.font || 'Arial'}`;\r\n        ctx.fillStyle = L.textColor || '#000000';\r\n        ctx.textAlign = L.textAlign || 'left';\r\n        ctx.textBaseline = 'top';\r\n\r\n        const lines = (L.text || '').split('\\n');\r\n        const lineHeight = fontSize * 1.2;\r\n        let currentY = L.rect.y;\r\n        for (const line of lines) {\r\n          let xPos = L.rect.x;\r\n          if (L.textAlign === 'center') xPos += L.rect.w / 2;\r\n          else if (L.textAlign === 'right') xPos += L.rect.w;\r\n\r\n          ctx.fillText(line, xPos, currentY);\r\n\r\n          // Draw decoration\r\n          if (L.textDecoration === 'underline') {\r\n            const metrics = ctx.measureText(line);\r\n            ctx.strokeStyle = L.textColor || '#000000';\r\n            ctx.lineWidth = 1;\r\n            ctx.beginPath();\r\n            ctx.moveTo(xPos, currentY + fontSize);\r\n            ctx.lineTo(xPos + metrics.width, currentY + fontSize);\r\n            ctx.stroke();\r\n          } else if (L.textDecoration === 'line-through') {\r\n            const metrics = ctx.measureText(line);\r\n            ctx.strokeStyle = L.textColor || '#000000';\r\n            ctx.lineWidth = 1;\r\n            ctx.beginPath();\r\n            ctx.moveTo(xPos, currentY + fontSize / 2);\r\n            ctx.lineTo(xPos + metrics.width, currentY + fontSize / 2);\r\n            ctx.stroke();\r\n          }\r\n          currentY += lineHeight;\r\n        }\r\n      }\r\n      ctx.restore();\r\n    } catch (err) {\r\n      // ignore draw errors per layer\r\n    }\r\n  }\r\n\r\n  // draw selection for active layer on top\r\n  if (overlaySelected && activeLayerId) {\r\n    const L = layers.find((x: any) => x.id === activeLayerId);\r\n    if (L) {\r\n      const r = L.rect;\r\n      ctx.save();\r\n      ctx.globalAlpha = 1;\r\n      ctx.globalCompositeOperation = 'source-over';\r\n\r\n      // Apply rotation to selection outline if layer is rotated\r\n      if (L.rotation && L.rotation !== 0) {\r\n        const centerX = r.x + r.w / 2;\r\n        const centerY = r.y + r.h / 2;\r\n        ctx.translate(centerX, centerY);\r\n        ctx.rotate((L.rotation * Math.PI) / 180);\r\n        ctx.translate(-centerX, -centerY);\r\n      }\r\n\r\n      ctx.strokeStyle = 'rgba(255,165,0,0.95)';\r\n      ctx.lineWidth = 2;\r\n      ctx.setLineDash([6, 3]);\r\n      ctx.strokeRect(r.x, r.y, r.w, r.h);\r\n      ctx.setLineDash([]);\r\n      ctx.fillStyle = 'rgba(255,165,0,0.95)';\r\n      const size = Math.max(6 / Math.max(1, zoom), 6);\r\n      const half = size / 2;\r\n\r\n      // Draw corner handles\r\n      const corners = [\r\n        [r.x, r.y],\r\n        [r.x + r.w, r.y],\r\n        [r.x, r.y + r.h],\r\n        [r.x + r.w, r.y + r.h],\r\n      ];\r\n      corners.forEach(([cx, cy]) => ctx.fillRect(cx - half, cy - half, size, size));\r\n\r\n      // Draw midpoint handles (new feature)\r\n      ctx.fillStyle = 'rgba(0,180,255,0.95)'; // Different color for midpoints\r\n      const midpoints = [\r\n        [r.x + r.w / 2, r.y], // top\r\n        [r.x + r.w / 2, r.y + r.h], // bottom\r\n        [r.x, r.y + r.h / 2], // left\r\n        [r.x + r.w, r.y + r.h / 2], // right\r\n      ];\r\n      midpoints.forEach(([mx, my]) => {\r\n        ctx.fillRect(mx - half, my - half, size, size);\r\n      });\r\n\r\n      ctx.restore();\r\n    }\r\n  }\r\n\r\n  // draw brush hover\r\n  if (hoverColor && tool === 'draw') {\r\n    const rect = canvasRef.current.getBoundingClientRect();\r\n    const canvasX = (hoverColor.x - rect.left) / zoom;\r\n    const canvasY = (hoverColor.y - rect.top) / zoom;\r\n    drawBrushCursor(ctx, canvasX, canvasY, drawLineWidth, drawColor, zoom);\r\n  }\r\n};\r\n\r\n// Text editor overlay creation helper\r\ntype CreateTextEditorParams = {\r\n  canvasX: number;\r\n  canvasY: number;\r\n  canvasRect: DOMRect;\r\n  containerRef: React.RefObject<HTMLDivElement>;\r\n  inlineEditorRef: React.MutableRefObject<HTMLTextAreaElement | null>;\r\n  zoom: number;\r\n  initial?: string;\r\n  layerId?: string;\r\n  layer?: any;\r\n  textColor?: string;\r\n  textFont?: string;\r\n  textFontSize?: number;\r\n  textWeight?: any;\r\n  textItalic?: boolean;\r\n  onCommit: (value: string) => void;\r\n  onCancel?: () => void;\r\n};\r\n\r\nexport const createTextEditorOverlay = (params: CreateTextEditorParams) => {\r\n  const {\r\n    canvasX,\r\n    canvasY,\r\n    canvasRect,\r\n    containerRef,\r\n    inlineEditorRef,\r\n    zoom,\r\n    initial = '',\r\n    layerId,\r\n    layer,\r\n    textColor = '#000',\r\n    textFont = 'Arial',\r\n    textFontSize = 16,\r\n    textWeight = 'normal',\r\n    textItalic = false,\r\n    onCommit,\r\n    onCancel,\r\n  } = params;\r\n\r\n  // remove any existing editor\r\n  if (inlineEditorRef.current) {\r\n    inlineEditorRef.current.remove();\r\n    inlineEditorRef.current = null;\r\n  }\r\n\r\n  const cont = containerRef.current;\r\n  const contRect = cont ? cont.getBoundingClientRect() : { left: 0, top: 0 };\r\n  const clientLeft = canvasRect.left + canvasX * zoom;\r\n  const clientTop = canvasRect.top + canvasY * zoom;\r\n  const left = clientLeft - contRect.left;\r\n  const top = clientTop - contRect.top;\r\n\r\n  const ta = document.createElement('textarea');\r\n  ta.value = initial;\r\n  ta.style.position = 'absolute';\r\n  ta.style.left = `${left}px`;\r\n  ta.style.top = `${top}px`;\r\n  ta.style.zIndex = '10000';\r\n  ta.style.minWidth = '60px';\r\n  ta.style.minHeight = '24px';\r\n  ta.style.background = 'transparent';\r\n  ta.style.border = '1px dashed rgba(0,0,0,0.4)';\r\n  ta.style.color = (layer && layer.textColor) || textColor || '#000';\r\n  ta.style.fontFamily = (layer && layer.font) || textFont || 'Arial';\r\n  const fontSizeValue = (layer && layer.fontSize) || textFontSize || 16;\r\n  ta.style.fontSize = `${fontSizeValue * zoom}px`;\r\n  ta.style.fontWeight = String((layer && layer.fontWeight) || textWeight || 'normal');\r\n  ta.style.fontStyle = (layer && layer.fontItalic) || textItalic ? 'italic' : 'normal';\r\n  ta.style.resize = 'both';\r\n  ta.style.outline = 'none';\r\n  ta.style.padding = '4px';\r\n  ta.placeholder = 'Type text and press Enter';\r\n\r\n  let commited = false;\r\n  const doCommit = () => {\r\n    if (commited) return;\r\n    commited = Boolean(ta.value) && !Boolean(initial);\r\n    onCommit(ta.value || '');\r\n    ta.remove();\r\n    inlineEditorRef.current = null;\r\n  };\r\n\r\n  const doCancel = () => {\r\n    ta.remove();\r\n    inlineEditorRef.current = null;\r\n    if (onCancel) onCancel();\r\n  };\r\n\r\n  ta.addEventListener('keydown', (ev) => {\r\n    if (ev.shiftKey && ev.key === 'Enter') return;\r\n    if (ev.key === 'Enter' && !ev.shiftKey) {\r\n      ev.preventDefault();\r\n      doCommit();\r\n    } else if (ev.key === 'Escape') {\r\n      ev.preventDefault();\r\n      doCancel();\r\n    }\r\n  });\r\n\r\n  ta.addEventListener('blur', () => {\r\n    doCommit();\r\n  });\r\n\r\n  const appendToContainer = () => {\r\n    try {\r\n      if (cont) cont.appendChild(ta);\r\n      else throw new Error('no container');\r\n    } catch (err) {\r\n      console.warn('[DEBUG] append to container failed, will fallback to body', err);\r\n      appendToBody();\r\n      return;\r\n    }\r\n    inlineEditorRef.current = ta;\r\n    ta.focus();\r\n    ta.selectionStart = ta.selectionEnd = ta.value.length;\r\n    // quick sanity check: if element seems invisible, fallback\r\n    requestAnimationFrame(() => {\r\n      try {\r\n        const r = ta.getBoundingClientRect();\r\n        if (r.width === 0 && r.height === 0) {\r\n          console.warn('[DEBUG] appended editor has zero size; falling back to body');\r\n          ta.remove();\r\n          appendToBody();\r\n        }\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n    });\r\n  };\r\n\r\n  const appendToBody = () => {\r\n    const fixedLeft = clientLeft;\r\n    const fixedTop = clientTop;\r\n    ta.style.position = 'fixed';\r\n    ta.style.left = `${fixedLeft}px`;\r\n    ta.style.top = `${fixedTop}px`;\r\n    ta.style.zIndex = '200000';\r\n    document.body.appendChild(ta);\r\n    inlineEditorRef.current = ta;\r\n    ta.focus();\r\n    ta.selectionStart = ta.selectionEnd = ta.value.length;\r\n    console.log('[DEBUG] appended editor to document.body at', { fixedLeft, fixedTop });\r\n  };\r\n\r\n  // Try append to container first; fallback to body when necessary\r\n  if (cont) appendToContainer();\r\n  else appendToBody();\r\n};\r\n","import { message } from 'antd';\r\nimport { perspectiveTransform, createCanvas } from './ImageEditorEngine';\r\n\r\nexport const perspectiveApplyHelper = async (\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  overlayRef: React.RefObject<HTMLCanvasElement>,\r\n  perspectivePointsRef: React.MutableRefObject<number[] | null>,\r\n  history: { push: (img: string, label: string) => void },\r\n  setShowPerspectiveModal: (v: boolean) => void,\r\n  drawOverlay: () => void,\r\n) => {\r\n  if (!canvasRef.current || !perspectivePointsRef.current) {\r\n    message.warning('No perspective points defined.');\r\n    return;\r\n  }\r\n\r\n  const p = perspectivePointsRef.current;\r\n  const srcPoints: [number, number][] = [];\r\n  for (let i = 0; i < 8; i += 2) {\r\n    const x = p[i];\r\n    const y = p[i + 1];\r\n    if (!isNaN(x) && !isNaN(y)) srcPoints.push([x, y]);\r\n  }\r\n\r\n  if (srcPoints.length !== 4) {\r\n    message.error('Please select 4 corner points before applying perspective correction.');\r\n    return;\r\n  }\r\n\r\n  const orderPointsClockwise = (pts: [number, number][]) => {\r\n    const cx = pts.reduce((s, r) => s + r[0], 0) / pts.length;\r\n    const cy = pts.reduce((s, r) => s + r[1], 0) / pts.length;\r\n\r\n    const sorted = pts\r\n      .map((pt) => ({ pt, angle: Math.atan2(pt[1] - cy, pt[0] - cx) }))\r\n      .sort((a, b) => a.angle - b.angle)\r\n      .map((o) => o.pt as [number, number]);\r\n\r\n    let area = 0;\r\n    for (let i = 0; i < sorted.length; i++) {\r\n      const [x1, y1] = sorted[i];\r\n      const [x2, y2] = sorted[(i + 1) % sorted.length];\r\n      area += x1 * y2 - x2 * y1;\r\n    }\r\n    if (area > 0) sorted.reverse();\r\n\r\n    let tlIndex = 0;\r\n    for (let i = 1; i < sorted.length; i++) {\r\n      if (\r\n        sorted[i][1] < sorted[tlIndex][1] ||\r\n        (sorted[i][1] === sorted[tlIndex][1] && sorted[i][0] < sorted[tlIndex][0])\r\n      ) {\r\n        tlIndex = i;\r\n      }\r\n    }\r\n    return Array.from(\r\n      { length: sorted.length },\r\n      (_, i) => sorted[(tlIndex + i) % sorted.length],\r\n    ) as any;\r\n  };\r\n\r\n  try {\r\n    const ordered = orderPointsClockwise(srcPoints);\r\n    const srcFlat: [number, number, number, number, number, number, number, number] = [\r\n      Math.round(ordered[0][0]),\r\n      Math.round(ordered[0][1]),\r\n      Math.round(ordered[1][0]),\r\n      Math.round(ordered[1][1]),\r\n      Math.round(ordered[2][0]),\r\n      Math.round(ordered[2][1]),\r\n      Math.round(ordered[3][0]),\r\n      Math.round(ordered[3][1]),\r\n    ];\r\n\r\n    const destCanvas = perspectiveTransform(\r\n      canvasRef.current!,\r\n      srcFlat,\r\n      canvasRef.current!.width,\r\n      canvasRef.current!.height,\r\n    );\r\n\r\n    canvasRef.current.width = destCanvas.width;\r\n    canvasRef.current.height = destCanvas.height;\r\n    overlayRef.current!.width = destCanvas.width;\r\n    overlayRef.current!.height = destCanvas.height;\r\n\r\n    const ctx = canvasRef.current.getContext('2d')!;\r\n    ctx.clearRect(0, 0, destCanvas.width, destCanvas.height);\r\n    ctx.drawImage(destCanvas, 0, 0);\r\n\r\n    history.push(canvasRef.current.toDataURL(), 'Perspective corrected');\r\n\r\n    perspectivePointsRef.current = null;\r\n    setShowPerspectiveModal(false);\r\n    drawOverlay();\r\n    message.success('Perspective correction applied.');\r\n  } catch (err) {\r\n    console.error('Perspective transform failed', err);\r\n    message.error('Failed to apply perspective correction.');\r\n  }\r\n};\r\n","import { message } from 'antd';\r\nimport { applyConvolution, Kernels, createCanvas } from './ImageEditorEngine';\r\n\r\nexport type UpscaleQualityOptions = {\r\n  sharpen?: number; // 0-100\r\n  edgeEnhancement?: number; // 0-100\r\n  denoise?: number; // 0-100\r\n};\r\n\r\n/**\r\n * Upscale a canvas progressively and optionally apply quality enhancements.\r\n * - `scale` can be a number >= 1 (e.g. 2, 3, 4 or 1.5)\r\n * - `preset` controls imageSmoothingQuality ('low' | 'medium' | 'high')\r\n * - `qualityOptions` controls post-upscale enhancements (sharpen, edge, denoise)\r\n */\r\nexport const upscaleCanvas = async (\r\n  srcCanvas: HTMLCanvasElement,\r\n  scale: number,\r\n  preset?: 'low' | 'medium' | 'high',\r\n  qualityOptions?: UpscaleQualityOptions,\r\n) => {\r\n  if (!srcCanvas || scale <= 1) return srcCanvas;\r\n\r\n  // progressive upscaling in steps (max 2x per step) to reduce artifacts\r\n  let tmp: HTMLCanvasElement = srcCanvas;\r\n  const targetScale = scale;\r\n  let currentScale = 1;\r\n\r\n  while (currentScale < targetScale) {\r\n    const step = Math.min(2, targetScale / currentScale);\r\n    const nextW = Math.max(1, Math.round(tmp.width * step));\r\n    const nextH = Math.max(1, Math.round(tmp.height * step));\r\n    const dest = createCanvas(nextW, nextH);\r\n    const dctx = dest.getContext('2d')!;\r\n    dctx.imageSmoothingEnabled = true;\r\n    // @ts-ignore - lib.dom types allow 'low'|'medium'|'high' but be defensive\r\n    dctx.imageSmoothingQuality = preset;\r\n    dctx.clearRect(0, 0, nextW, nextH);\r\n    dctx.drawImage(tmp, 0, 0, tmp.width, tmp.height, 0, 0, nextW, nextH);\r\n    tmp = dest;\r\n    currentScale *= step;\r\n    // yield to event loop to keep UI responsive for large upscales\r\n    // eslint-disable-next-line no-await-in-loop\r\n    await new Promise((r) => setTimeout(r, 0));\r\n  }\r\n\r\n  // Apply quality enhancements if specified\r\n  if (\r\n    qualityOptions &&\r\n    (qualityOptions.sharpen || qualityOptions.edgeEnhancement || qualityOptions.denoise)\r\n  ) {\r\n    const ctx = tmp.getContext('2d')!;\r\n    const imageData = ctx.getImageData(0, 0, tmp.width, tmp.height);\r\n\r\n    // Apply denoise first (blur to reduce noise)\r\n    if (qualityOptions.denoise && qualityOptions.denoise > 0) {\r\n      const denoiseStrength = qualityOptions.denoise / 100;\r\n      const blurKernel = Kernels.gaussian5;\r\n      const iterations = Math.ceil(denoiseStrength * 2);\r\n      for (let i = 0; i < iterations; i++) {\r\n        applyConvolution(imageData, blurKernel, 5);\r\n      }\r\n    }\r\n\r\n    // Apply edge enhancement (unsharp mask variation)\r\n    if (qualityOptions.edgeEnhancement && qualityOptions.edgeEnhancement > 0) {\r\n      const edgeStrength = qualityOptions.edgeEnhancement / 100;\r\n      const edgeKernel = [\r\n        0,\r\n        -1 * edgeStrength,\r\n        0,\r\n        -1 * edgeStrength,\r\n        1 + 4 * edgeStrength,\r\n        -1 * edgeStrength,\r\n        0,\r\n        -1 * edgeStrength,\r\n        0,\r\n      ];\r\n      applyConvolution(imageData, edgeKernel, 3);\r\n    }\r\n\r\n    // Apply sharpening\r\n    if (qualityOptions.sharpen && qualityOptions.sharpen > 0) {\r\n      const sharpenStrength = qualityOptions.sharpen / 100;\r\n      const iterations = Math.ceil(sharpenStrength * 3);\r\n      for (let i = 0; i < iterations; i++) {\r\n        applyConvolution(imageData, Kernels.sharpen, 3);\r\n      }\r\n    }\r\n\r\n    ctx.putImageData(imageData, 0, 0);\r\n  }\r\n\r\n  return tmp;\r\n};\r\n\r\n/**\r\n * High-level helper: upscale the visible canvas, replace working canvas and baseCanvas,\r\n * update base overlay layer, and enable upscaledMode.\r\n * This encapsulates the safe Image.onload swap used by the editor.\r\n */\r\nexport const applyUpscale = async (\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  overlayRef: React.RefObject<HTMLCanvasElement>,\r\n  history: any,\r\n  setBaseCanvas: (c: HTMLCanvasElement) => void,\r\n  setLayers: React.Dispatch<any>,\r\n  drawOverlay: () => void,\r\n  factor: number,\r\n  preset?: 'low' | 'medium' | 'high',\r\n  qualityOptions?: UpscaleQualityOptions,\r\n) => {\r\n  if (!canvasRef.current) return;\r\n  try {\r\n    const newCanvas = await upscaleCanvas(canvasRef.current, factor, preset, qualityOptions);\r\n    if (!newCanvas) return;\r\n\r\n    const dataUrl = newCanvas.toDataURL();\r\n    const img = new Image();\r\n    // temporarily hide overlay while swapping to avoid covering canvas with an unloaded image\r\n    const prevDisplay = overlayRef.current ? overlayRef.current.style.display : '';\r\n    if (overlayRef.current) overlayRef.current.style.display = 'none';\r\n\r\n    img.onload = () => {\r\n      try {\r\n        const c2 = document.createElement('canvas');\r\n        c2.width = img.naturalWidth;\r\n        c2.height = img.naturalHeight;\r\n        const c2ctx = c2.getContext('2d')!;\r\n        c2ctx.drawImage(img, 0, 0);\r\n        try {\r\n          setBaseCanvas(c2);\r\n        } catch (_e) {}\r\n\r\n        // replace working canvas\r\n        canvasRef.current!.width = c2.width;\r\n        canvasRef.current!.height = c2.height;\r\n        if (overlayRef.current) {\r\n          overlayRef.current.width = c2.width;\r\n          overlayRef.current.height = c2.height;\r\n        }\r\n        const ctx = canvasRef.current!.getContext('2d')!;\r\n        ctx.clearRect(0, 0, c2.width, c2.height);\r\n        ctx.drawImage(img, 0, 0);\r\n\r\n        // push history after successful draw\r\n        history.push(canvasRef.current!.toDataURL(), `Upscaled ${factor}x`);\r\n\r\n        // set base overlay opacity to 1 and enable syncing mode, and update base overlay image src\r\n        setLayers((prev) => {\r\n          if (!prev[0]) return prev;\r\n          const copy = prev.slice();\r\n          const base = { ...(copy[0] as any) } as any;\r\n          // base.opacity = 1;\r\n          if (base.img) base.img.src = dataUrl;\r\n          base.rect = { x: 0, y: 0, w: c2.width, h: c2.height };\r\n          copy[0] = base;\r\n          return copy;\r\n        });\r\n\r\n        // restore overlay display and redraw\r\n        if (overlayRef.current) overlayRef.current.style.display = prevDisplay || '';\r\n        drawOverlay();\r\n        message.success(`Upscaled ${factor}x`);\r\n      } catch (err) {\r\n        console.error('Failed to finalize upscale draw', err);\r\n        if (overlayRef.current) overlayRef.current.style.display = prevDisplay || '';\r\n        message.error('Upscale failed to render');\r\n      }\r\n    };\r\n    img.onerror = (e) => {\r\n      if (overlayRef.current) overlayRef.current.style.display = prevDisplay || '';\r\n      console.error('Upscaled image failed to load', e);\r\n      message.error('Upscaled image failed to load');\r\n    };\r\n    img.src = dataUrl;\r\n  } catch (err) {\r\n    console.error('Upscale failed', err);\r\n    message.error('Upscale failed');\r\n  }\r\n};\r\n","import {\r\n  applyBrightnessContrast,\r\n  applyConvolution,\r\n  applyDehaze,\r\n  applyHslAdjustments,\r\n  applyThresholdAlpha,\r\n  applyThresholdAlphaBlack,\r\n  applyToneAdjustments,\r\n  applyVibranceSaturation,\r\n  cloneImageData,\r\n  Kernels,\r\n} from './ImageEditorEngine';\r\n\r\n//#region State Management\r\n\r\n/**\r\n * Store previous effects to detect changes for history optimization.\r\n * Tracks values of all adjustable parameters.\r\n */\r\nlet previousEffects = {\r\n  // Convolution / blur effects\r\n  blur: 0,\r\n  gaussian: 0,\r\n  sharpen: 0,\r\n  texture: 0,\r\n  clarity: 0,\r\n\r\n  // Threshold\r\n  bgThreshold: 0,\r\n  bgThresholdBlack: 0,\r\n\r\n  // Brightness / contrast\r\n  brightness: 0,\r\n  contrast: 0,\r\n\r\n  // Tone adjustments\r\n  highlights: 0,\r\n  shadows: 0,\r\n  whites: 0,\r\n  blacks: 0,\r\n  vibrance: 0,\r\n  saturation: 0,\r\n  dehaze: 0,\r\n\r\n  // HSL adjustments (per-color)\r\n  hslAdjustments: {} as Record<string, { h?: number; s?: number; l?: number }>,\r\n};\r\n\r\n/**\r\n * Cache the base image data once to avoid repeated canvas reads.\r\n * This improves performance when reapplying effects from the original state.\r\n */\r\nlet cachedBaseImageData: ImageData | null = null;\r\n\r\n//#endregion\r\n\r\n//#region Main Effects Pipeline\r\n\r\n/**\r\n * Applies a comprehensive set of image effects to the canvas.\r\n * Handles convolution, threshold, tone adjustments, and HSL.\r\n * Updates history only if parameters have changed.\r\n *\r\n * @param canvasRef - Reference to the target canvas\r\n * @param baseCanvas - The original source canvas (for reading base data)\r\n * @param params - Object containing all effect parameters\r\n * @param history - History management object\r\n * @param setHistogramData - Callback to update histogram UI\r\n */\r\nexport const applyEffects = (\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  baseCanvas: HTMLCanvasElement | null | undefined,\r\n  {\r\n    blur = 0,\r\n    gaussian = 0,\r\n    sharpen = 0,\r\n    bgThreshold = 0,\r\n    bgThresholdBlack = 0,\r\n    brightness = 0,\r\n    contrast = 0,\r\n    texture = 0,\r\n    clarity = 0,\r\n    highlights = 0,\r\n    shadows = 0,\r\n    whites = 0,\r\n    blacks = 0,\r\n    vibrance = 0,\r\n    saturation = 0,\r\n    dehaze = 0,\r\n    hslAdjustments = {} as Record<string, { h?: number; s?: number; l?: number }>,\r\n  },\r\n  history: { push: (img: string, label: string, isSetBase: boolean) => void },\r\n  setHistogramData,\r\n) => {\r\n  if (!canvasRef.current || !baseCanvas) return;\r\n\r\n  const ctx = canvasRef.current.getContext('2d')!;\r\n  const baseCtx = baseCanvas.getContext('2d')!;\r\n\r\n  const BaseImageData = baseCtx.getImageData(0, 0, baseCanvas.width, baseCanvas.height);\r\n\r\n  // cache original image data once\r\n  if (!cachedBaseImageData) cachedBaseImageData = BaseImageData;\r\n  if (!cachedBaseImageData) return;\r\n\r\n  let cloned = cloneImageData(BaseImageData);\r\n\r\n  // Early exit if no effects\r\n  if (\r\n    blur === 0 &&\r\n    gaussian === 0 &&\r\n    sharpen === 0 &&\r\n    texture === 0 &&\r\n    clarity === 0 &&\r\n    bgThreshold === 0 &&\r\n    bgThresholdBlack === 0 &&\r\n    brightness === 0 &&\r\n    contrast === 0 &&\r\n    highlights === 0 &&\r\n    shadows === 0 &&\r\n    whites === 0 &&\r\n    blacks === 0 &&\r\n    vibrance === 0 &&\r\n    saturation === 0 &&\r\n    dehaze === 0 &&\r\n    Object.keys(hslAdjustments).length === 0\r\n  ) {\r\n    ctx.putImageData(cloned, 0, 0);\r\n\r\n    if (canvasRef.current) {\r\n      const extracted = extractRGBHistogram(canvasRef.current);\r\n      setHistogramData(extracted);\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Apply convolution effects\r\n  if (blur > 0) {\r\n    const size = blur % 2 === 0 ? blur + 1 : blur;\r\n    applyConvolution(cloned, Kernels.generateBoxBlurKernel(size), size);\r\n  }\r\n  if (gaussian > 0) {\r\n    const r = gaussian;\r\n    applyConvolution(cloned, Kernels.generateGaussianKernel(r), r * 2 + 1);\r\n  }\r\n  if (sharpen > 0) {\r\n    const kernel = Kernels.sharpen.map((v) =>\r\n      v === 5 ? 1 + sharpen * 4 : v === -1 ? -sharpen : v,\r\n    );\r\n    applyConvolution(cloned, kernel, 3);\r\n  }\r\n  if (texture !== 0) {\r\n    // Texture: -100 = extreme blur, 0 = no effect, +100 = extreme sharpening\r\n    // At 0, no effect should be visible\r\n    const strength = texture / 100; // -1 to +1\r\n    const center = 1 + strength * 8; // -7 to 9\r\n    const edge = -strength * 2; // 2 to -2\r\n    const detailKernel = [0, edge, 0, edge, center, edge, 0, edge, 0];\r\n    applyConvolution(cloned, detailKernel, 3);\r\n  }\r\n  if (clarity !== 0) {\r\n    // Clarity: -100 = soft/blurry, 0 = no effect, +100 = clear/sharp\r\n    const strength = clarity / 100; // -1 to +1\r\n    const center = 1 + strength * 10; // -9 to 11\r\n    const edge = -strength * 2.5; // 2.5 to -2.5\r\n    const midtoneKernel = [0, edge, 0, edge, center, edge, 0, edge, 0];\r\n    applyConvolution(cloned, midtoneKernel, 3);\r\n  }\r\n\r\n  // Threshold effects\r\n  if (bgThreshold > 0) applyThresholdAlpha(cloned, bgThreshold);\r\n  if (bgThresholdBlack > 0) applyThresholdAlphaBlack(cloned, bgThresholdBlack);\r\n\r\n  // Brightness/Contrast\r\n  if (brightness !== 0 || contrast !== 0) applyBrightnessContrast(cloned, brightness, contrast);\r\n\r\n  // Tone adjustments (highlights, shadows, whites, blacks, vibrance, saturation, dehaze)\r\n  if (\r\n    highlights !== 0 ||\r\n    shadows !== 0 ||\r\n    whites !== 0 ||\r\n    blacks !== 0 ||\r\n    vibrance !== 0 ||\r\n    saturation !== 0 ||\r\n    dehaze !== 0\r\n  ) {\r\n    const d = cloned.data;\r\n    for (let i = 0; i < d.length; i += 4) {\r\n      if (dehaze) applyDehaze(d, i, dehaze);\r\n      if (vibrance || saturation) applyVibranceSaturation(d, i, { vibrance, saturation });\r\n    }\r\n    applyToneAdjustments(cloned, {\r\n      highlights,\r\n      shadows,\r\n      whites,\r\n      blacks,\r\n      vibrance,\r\n      saturation,\r\n      clarity,\r\n      dehaze,\r\n    });\r\n  }\r\n\r\n  // HSL / Color mixer\r\n  if (Object.keys(hslAdjustments).length > 0) applyHslAdjustments(cloned, hslAdjustments);\r\n\r\n  // Draw final image\r\n  ctx.putImageData(cloned, 0, 0);\r\n\r\n  // Detect changes for history\r\n  const changedEffects = Object.entries({\r\n    blur,\r\n    gaussian,\r\n    sharpen,\r\n    texture,\r\n    clarity,\r\n    bgThreshold,\r\n    bgThresholdBlack,\r\n    brightness,\r\n    contrast,\r\n    highlights,\r\n    shadows,\r\n    whites,\r\n    blacks,\r\n    vibrance,\r\n    saturation,\r\n    dehaze,\r\n    hslAdjustments,\r\n  }).filter(([key, value]) => previousEffects[key] !== value);\r\n\r\n  if (changedEffects.length > 0) {\r\n    const historyLabel = changedEffects\r\n      .map(([key, value]) => `${key}=${JSON.stringify(value)}`)\r\n      .join(', ');\r\n    history.push(canvasRef.current.toDataURL(), `${historyLabel}`, false);\r\n    previousEffects = {\r\n      blur,\r\n      gaussian,\r\n      sharpen,\r\n      texture,\r\n      clarity,\r\n      bgThreshold,\r\n      bgThresholdBlack,\r\n      brightness,\r\n      contrast,\r\n      highlights,\r\n      shadows,\r\n      whites,\r\n      blacks,\r\n      vibrance,\r\n      saturation,\r\n      dehaze,\r\n      hslAdjustments,\r\n    };\r\n  }\r\n\r\n  if (canvasRef.current) {\r\n    const extracted = extractRGBHistogram(canvasRef.current);\r\n    setHistogramData(extracted);\r\n  }\r\n};\r\n\r\n//#endregion\r\n\r\n//#region Reset & History\r\n\r\n/**\r\n * Resets the canvas to the original base image and clears effect history state.\r\n *\r\n * @param canvasRef - Reference to the target canvas\r\n * @param baseCanvas - The original source canvas\r\n * @param history - History management object\r\n */\r\nexport const resetEffectsToBase = (\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  baseCanvas: HTMLCanvasElement | null | undefined,\r\n  history: { push: (img: string, label: string) => void },\r\n) => {\r\n  if (!canvasRef.current || !baseCanvas || !cachedBaseImageData) return;\r\n\r\n  const ctx = canvasRef.current.getContext('2d')!;\r\n  ctx.putImageData(cachedBaseImageData, 0, 0);\r\n\r\n  // Reset previous effects so history won't re-detect old ones\r\n  previousEffects = {\r\n    blur: 0,\r\n    gaussian: 0,\r\n    sharpen: 0,\r\n    texture: 0,\r\n    clarity: 0,\r\n    bgThreshold: 0,\r\n    bgThresholdBlack: 0,\r\n    brightness: 0,\r\n    contrast: 0,\r\n    highlights: 0,\r\n    shadows: 0,\r\n    whites: 0,\r\n    blacks: 0,\r\n    vibrance: 0,\r\n    saturation: 0,\r\n    dehaze: 0,\r\n    hslAdjustments: {},\r\n  };\r\n\r\n  // Add to history\r\n  history.push(canvasRef.current.toDataURL(), 'Reset to base image');\r\n};\r\n\r\n//#endregion\r\n\r\n//#region Analysis Tools\r\n\r\n/**\r\n * Calculates the RGB histogram data for the current canvas content.\r\n *\r\n * @param canvas - The canvas to analyze\r\n * @returns Object containing red, green, and blue frequency arrays (0-255)\r\n */\r\nexport const extractRGBHistogram = (canvas: HTMLCanvasElement | null) => {\r\n  if (!canvas)\r\n    return { red: Array(256).fill(0), green: Array(256).fill(0), blue: Array(256).fill(0) };\r\n\r\n  const ctx = canvas.getContext('2d');\r\n  if (!ctx) return { red: Array(256).fill(0), green: Array(256).fill(0), blue: Array(256).fill(0) };\r\n\r\n  const { width, height } = canvas;\r\n  const { data } = ctx.getImageData(0, 0, width, height);\r\n\r\n  const red = Array(256).fill(0);\r\n  const green = Array(256).fill(0);\r\n  const blue = Array(256).fill(0);\r\n\r\n  for (let i = 0; i < data.length; i += 4) {\r\n    red[data[i]]++; // count R value\r\n    green[data[i + 1]]++; // count G value\r\n    blue[data[i + 2]]++; // count B value\r\n  }\r\n\r\n  return { red, green, blue };\r\n};\r\n\r\n//#endregion\r\n\r\n//#region Simple Filters\r\n\r\n/**\r\n * Inverts the RGB colors of the canvas image.\r\n *\r\n * @param canvasRef - Reference to the target canvas\r\n * @param history - History management object\r\n */\r\nexport const applyInvertColors = (\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  history: { push: (img: string, label: string, isSetBase: boolean) => void },\r\n) => {\r\n  if (!canvasRef.current) return;\r\n\r\n  const canvas = canvasRef.current;\r\n  const ctx = canvas.getContext('2d')!;\r\n  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n  const data = imageData.data;\r\n\r\n  // Invert each RGB channel (keep alpha unchanged)\r\n  for (let i = 0; i < data.length; i += 4) {\r\n    data[i] = 255 - data[i]; // Red\r\n    data[i + 1] = 255 - data[i + 1]; // Green\r\n    data[i + 2] = 255 - data[i + 2]; // Blue\r\n    // data[i + 3] stays the same (Alpha)\r\n  }\r\n\r\n  ctx.putImageData(imageData, 0, 0);\r\n  history.push(canvas.toDataURL(), 'Invert colors', false);\r\n};\r\n\r\n//#endregion\r\n\r\n//#region Color Removal\r\n\r\n/**\r\n * Calculates an alpha map for removing a specific color with tolerance and feathering.\r\n *\r\n * @param data - Image data array\r\n * @param targetColor - Hex color string to remove\r\n * @param tolerance - Tolerance percentage (0-100)\r\n * @param invert - Whether to invert the selection (keep color instead of remove)\r\n * @param feather - Feathering percentage (0-100)\r\n * @returns Uint8Array of alpha values\r\n */\r\nexport const calculateColorRemovalAlphaMap = (\r\n  data: Uint8ClampedArray,\r\n  targetColor: string,\r\n  tolerance: number,\r\n  invert: boolean = false,\r\n  feather: number = 0,\r\n): Uint8Array => {\r\n  // Parse target color\r\n  const hex = targetColor.replace('#', '');\r\n  const targetR = parseInt(hex.substring(0, 2), 16);\r\n  const targetG = parseInt(hex.substring(2, 4), 16);\r\n  const targetB = parseInt(hex.substring(4, 6), 16);\r\n\r\n  const alphaMap = new Uint8Array(data.length / 4);\r\n  const maxDistance = Math.sqrt(255 * 255 * 3);\r\n  const threshold = tolerance / 100;\r\n  const featherRange = feather / 100;\r\n\r\n  for (let i = 0; i < data.length; i += 4) {\r\n    const r = data[i];\r\n    const g = data[i + 1];\r\n    const b = data[i + 2];\r\n\r\n    // Calculate color distance\r\n    const distance = Math.sqrt(\r\n      Math.pow(r - targetR, 2) + Math.pow(g - targetG, 2) + Math.pow(b - targetB, 2),\r\n    );\r\n\r\n    const normalizedDistance = distance / maxDistance;\r\n\r\n    // Calculate base alpha (0 = remove, 1 = keep)\r\n    let baseAlpha;\r\n\r\n    if (feather === 0) {\r\n      // No feathering - hard edge\r\n      baseAlpha = normalizedDistance <= threshold ? 0 : 1;\r\n    } else {\r\n      const distanceFromThreshold = normalizedDistance - threshold;\r\n\r\n      if (distanceFromThreshold < -featherRange) {\r\n        // Far inside selection - fully removed\r\n        baseAlpha = 0;\r\n      } else if (distanceFromThreshold > featherRange) {\r\n        // Far outside selection - fully kept\r\n        baseAlpha = 1;\r\n      } else {\r\n        // In feather zone - smooth gradient from 0 to 1\r\n        baseAlpha = (distanceFromThreshold + featherRange) / (featherRange * 2);\r\n      }\r\n    }\r\n\r\n    // Apply invert\r\n    if (invert) {\r\n      baseAlpha = 1 - baseAlpha;\r\n    }\r\n\r\n    alphaMap[i / 4] = Math.round(baseAlpha * 255);\r\n  }\r\n  return alphaMap;\r\n};\r\n\r\n/**\r\n * Removes a specific color from the canvas image based on tolerance and feathering.\r\n *\r\n * @param canvasRef - Reference to the target canvas\r\n * @param targetColor - Hex color string to remove\r\n * @param tolerance - Tolerance percentage\r\n * @param history - History management object\r\n * @param invert - Whether to invert the selection\r\n * @param feather - Feathering percentage\r\n */\r\nexport const applyColorRemoval = (\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  targetColor: string,\r\n  tolerance: number,\r\n  history: { push: (img: string, label: string, isSetBase: boolean) => void },\r\n  invert: boolean = false,\r\n  feather: number = 0,\r\n) => {\r\n  if (!canvasRef.current) return;\r\n\r\n  const canvas = canvasRef.current;\r\n  const ctx = canvas.getContext('2d')!;\r\n  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n  const data = imageData.data;\r\n\r\n  const alphaMap = calculateColorRemovalAlphaMap(data, targetColor, tolerance, invert, feather);\r\n\r\n  // Second pass: apply alpha values\r\n  for (let i = 0; i < data.length; i += 4) {\r\n    data[i + 3] = alphaMap[i / 4];\r\n  }\r\n\r\n  ctx.putImageData(imageData, 0, 0);\r\n  const label = invert\r\n    ? `Keep color ${targetColor} (tolerance: ${tolerance}%, feather: ${feather}%)`\r\n    : `Remove color ${targetColor} (tolerance: ${tolerance}%, feather: ${feather}%)`;\r\n  history.push(canvas.toDataURL(), label, false);\r\n};\r\n\r\n//#endregion\r\n\r\n//#region Masking\r\n\r\n/**\r\n * Applies a grayscale mask to the alpha channel of the canvas image.\r\n * Uses the mask's red channel as the alpha value.\r\n *\r\n * @param canvasRef - Reference to the target canvas\r\n * @param maskCanvas - The mask canvas (grayscale)\r\n * @param history - History management object\r\n * @param label - History label\r\n */\r\nexport const applyMaskToCanvas = (\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  maskCanvas: HTMLCanvasElement,\r\n  history: { push: (img: string, label: string, isSetBase: boolean) => void },\r\n  label: string = 'Apply Mask',\r\n) => {\r\n  if (!canvasRef.current) return;\r\n\r\n  const canvas = canvasRef.current;\r\n  const ctx = canvas.getContext('2d')!;\r\n  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n  const data = imageData.data;\r\n\r\n  const maskCtx = maskCanvas.getContext('2d')!;\r\n  const maskData = maskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n\r\n  for (let i = 0; i < data.length; i += 4) {\r\n    // Mask is stored in RGB channels (grayscale)\r\n    // We use Red channel as alpha value\r\n    const maskAlpha = maskData.data[i];\r\n    data[i + 3] = maskAlpha;\r\n  }\r\n\r\n  ctx.putImageData(imageData, 0, 0);\r\n  history.push(canvas.toDataURL(), label, false);\r\n};\r\n\r\n//#endregion\r\n","// src/components/ImageCanvas.tsx\r\nimport React from 'react';\r\n\r\ntype HoverColor = {\r\n  x: number;\r\n  y: number;\r\n  color: string;\r\n};\r\n\r\ntype ImageCanvasProps = {\r\n  canvasRef: React.RefObject<HTMLCanvasElement>;\r\n  overlayRef: React.RefObject<HTMLCanvasElement>;\r\n  containerRef: React.RefObject<HTMLDivElement>;\r\n  offset: { x: number; y: number };\r\n  zoom: number;\r\n  tool: string;\r\n  currentCursor: string;\r\n  hoverColor: HoverColor | null;\r\n  resolution?: string | null;\r\n  onMouseDown: (e: React.MouseEvent) => void;\r\n  onMouseMove: (e: React.MouseEvent) => void;\r\n  onMouseUp: () => void;\r\n};\r\n\r\nconst ImageCanvas: React.FC<ImageCanvasProps> = ({\r\n  canvasRef,\r\n  overlayRef,\r\n  containerRef,\r\n  offset,\r\n  zoom,\r\n  tool,\r\n  currentCursor,\r\n  hoverColor,\r\n  resolution,\r\n  onMouseDown,\r\n  onMouseMove,\r\n  onMouseUp,\r\n}) => {\r\n  return (\r\n    <div\r\n      ref={containerRef}\r\n      onMouseDown={onMouseDown}\r\n      onMouseMove={onMouseMove}\r\n      onMouseUp={onMouseUp}\r\n      style={{\r\n        width: '100%',\r\n        height: '100vh',\r\n        overflow: 'hidden',\r\n        border: '1px solid #eee',\r\n        position: 'relative',\r\n        background: '#fafafa',\r\n        cursor: currentCursor,\r\n      }}\r\n    >\r\n      {resolution && (\r\n        <div\r\n          style={{\r\n            position: 'absolute',\r\n            right: 12,\r\n            top: 12,\r\n            background: 'rgba(0,0,0,0.6)',\r\n            color: '#fff',\r\n            padding: '4px 8px',\r\n            borderRadius: 4,\r\n            fontSize: 12,\r\n            zIndex: 99999,\r\n            pointerEvents: 'none',\r\n          }}\r\n        >\r\n          {resolution}\r\n        </div>\r\n      )}\r\n      <div\r\n        style={{\r\n          position: 'absolute',\r\n          top: 0,\r\n          left: 0,\r\n          width: '100%',\r\n          height: '100%',\r\n          overflow: 'hidden',\r\n        }}\r\n      >\r\n        <canvas\r\n          ref={canvasRef}\r\n          style={{\r\n            transform: `translate(${offset.x}px, ${offset.y}px) scale(${zoom})`,\r\n            transformOrigin: 'top left',\r\n            display: 'block',\r\n          }}\r\n        />\r\n        <canvas\r\n          ref={overlayRef}\r\n          style={{\r\n            position: 'absolute',\r\n            left: 0,\r\n            top: 0,\r\n            pointerEvents: 'none',\r\n            transform: `translate(${offset.x}px, ${offset.y}px) scale(${zoom})`,\r\n            transformOrigin: 'top left',\r\n          }}\r\n        />\r\n      </div>\r\n      {/* Drag & drop support: dropped images become overlay images (onAddImage) */}\r\n      {hoverColor && tool === 'color' && (\r\n        <div\r\n          style={{\r\n            position: 'fixed', // use fixed to position relative to viewport\r\n            left: hoverColor.x + 12,\r\n            top: hoverColor.y + 12,\r\n            background: '#fff',\r\n            padding: '4px 8px',\r\n            borderRadius: 4,\r\n            boxShadow: '0 0 6px rgba(0,0,0,0.2)',\r\n            fontSize: 12,\r\n            zIndex: 999999,\r\n            pointerEvents: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            gap: 6,\r\n          }}\r\n        >\r\n          <span\r\n            style={{\r\n              display: 'inline-block',\r\n              width: 12,\r\n              height: 12,\r\n              background: hoverColor.color,\r\n              border: '1px solid #ccc',\r\n            }}\r\n          />\r\n          {hoverColor.color}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ImageCanvas;\r\n","import React, { useEffect, useState, useRef } from 'react';\r\nimport {\r\n  Modal,\r\n  Slider,\r\n  Radio,\r\n  Space,\r\n  Button,\r\n  Select,\r\n  InputNumber,\r\n  Tooltip,\r\n  Tour,\r\n  ColorPicker,\r\n  type TourProps,\r\n} from 'antd';\r\nimport { UndoOutlined, RedoOutlined, QuestionCircleOutlined } from '@ant-design/icons';\r\nimport {\r\n  BrushSettings,\r\n  drawBrushStroke,\r\n  drawBrushCursor,\r\n  getCanvasCoords,\r\n} from '../../utils/brushHelpers';\r\nimport { calculateColorRemovalAlphaMap } from '../../utils/helpers';\r\n\r\nconst { Option } = Select;\r\n\r\ntype ColorRemovalModalProps = {\r\n  open: boolean;\r\n  onCancel: () => void;\r\n  onApply: (maskCanvas: HTMLCanvasElement) => void;\r\n  selectedColor: string | null;\r\n  canvasRef: React.RefObject<HTMLCanvasElement>;\r\n};\r\n\r\nconst ColorRemovalModal: React.FC<ColorRemovalModalProps> = ({\r\n  open,\r\n  onCancel,\r\n  onApply,\r\n  selectedColor,\r\n  canvasRef,\r\n}) => {\r\n  const [tolerance, setTolerance] = useState(30);\r\n  const [previewMode, setPreviewMode] = useState<'normal' | 'mask'>('normal');\r\n  const [invert, setInvert] = useState(false);\r\n  const [feather, setFeather] = useState(0);\r\n  const [activeColor, setActiveColor] = useState(selectedColor || '#000000');\r\n\r\n  useEffect(() => {\r\n    if (selectedColor) setActiveColor(selectedColor);\r\n  }, [selectedColor]);\r\n\r\n  // Brush state\r\n  const [brushMode, setBrushMode] = useState<'remove' | 'keep'>('remove');\r\n  const [brushSize, setBrushSize] = useState(20);\r\n  const [brushOpacity, setBrushOpacity] = useState(1);\r\n  const [brushType, setBrushType] = useState<'hard' | 'soft'>('hard');\r\n  const [isDrawing, setIsDrawing] = useState(false);\r\n  const [cursorPos, setCursorPos] = useState<{ x: number; y: number } | null>(null);\r\n\r\n  const previewCanvasRef = useRef<HTMLCanvasElement>(null);\r\n  const maskCanvasRef = useRef<HTMLCanvasElement>(null);\r\n  const overlayCanvasRef = useRef<HTMLCanvasElement>(null);\r\n  const drawPoints = useRef<{ x: number; y: number }[]>([]);\r\n\r\n  // Brush resize with mouse\r\n  const resizingBrush = useRef(false);\r\n  const resizeStartX = useRef<number | null>(null);\r\n  const initialBrushSize = useRef(brushSize);\r\n\r\n  // History state\r\n  const [history, setHistory] = useState<ImageData[]>([]);\r\n  const [historyIndex, setHistoryIndex] = useState(-1);\r\n\r\n  // Tour state\r\n  const [openTour, setOpenTour] = useState(false);\r\n  const controlsRef = useRef(null);\r\n  const brushRef = useRef(null);\r\n  const historyRef = useRef(null);\r\n  const tourCanvasRef = useRef(null);\r\n\r\n  const tourSteps: TourProps['steps'] = [\r\n    {\r\n      title: 'Color Removal Settings',\r\n      description: 'Adjust Tolerance and Feather to automatically remove the selected color.',\r\n      target: () => controlsRef.current,\r\n    },\r\n    {\r\n      title: 'History',\r\n      description: 'Undo or Redo your changes.',\r\n      target: () => historyRef.current,\r\n    },\r\n    {\r\n      title: 'Manual Adjustments',\r\n      description:\r\n        'Use the brush to manually remove or keep areas. Note: Changing auto-settings resets manual edits.',\r\n      target: () => brushRef.current,\r\n    },\r\n    {\r\n      title: 'Canvas',\r\n      description: 'Draw on the canvas to refine the mask. Use Alt + Drag to resize brush.',\r\n      target: () => tourCanvasRef.current,\r\n    },\r\n  ];\r\n\r\n  // #region 🖱️ Disable Right-Click Context Menu\r\n  useEffect(() => {\r\n    const canvas = previewCanvasRef.current;\r\n    if (!canvas) return;\r\n    const handleContextMenu = (e: MouseEvent) => e.preventDefault();\r\n    canvas.addEventListener('contextmenu', handleContextMenu);\r\n    return () => canvas.removeEventListener('contextmenu', handleContextMenu);\r\n  }, []);\r\n  //#endregion\r\n\r\n  // Initialize mask when params change\r\n  useEffect(() => {\r\n    if (!open || !canvasRef.current || !activeColor || !maskCanvasRef.current) return;\r\n\r\n    const sourceCanvas = canvasRef.current;\r\n    const maskCanvas = maskCanvasRef.current;\r\n\r\n    // Ensure mask canvas size matches source\r\n    if (maskCanvas.width !== sourceCanvas.width || maskCanvas.height !== sourceCanvas.height) {\r\n      maskCanvas.width = sourceCanvas.width;\r\n      maskCanvas.height = sourceCanvas.height;\r\n    }\r\n\r\n    const sourceCtx = sourceCanvas.getContext('2d')!;\r\n    const imageData = sourceCtx.getImageData(0, 0, sourceCanvas.width, sourceCanvas.height);\r\n\r\n    const alphaMap = calculateColorRemovalAlphaMap(\r\n      imageData.data,\r\n      activeColor,\r\n      tolerance,\r\n      invert,\r\n      feather,\r\n    );\r\n\r\n    const maskCtx = maskCanvas.getContext('2d')!;\r\n    const maskData = maskCtx.createImageData(maskCanvas.width, maskCanvas.height);\r\n\r\n    for (let i = 0; i < alphaMap.length; i++) {\r\n      const alpha = alphaMap[i];\r\n      // Store alpha in all channels for visualization/usage\r\n      maskData.data[i * 4] = alpha; // R\r\n      maskData.data[i * 4 + 1] = alpha; // G\r\n      maskData.data[i * 4 + 2] = alpha; // B\r\n      maskData.data[i * 4 + 3] = 255; // A (fully opaque mask pixel)\r\n    }\r\n\r\n    maskCtx.putImageData(maskData, 0, 0);\r\n\r\n    // Initialize history\r\n    const initialData = maskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n    setHistory([initialData]);\r\n    setHistoryIndex(0);\r\n\r\n    updatePreview();\r\n  }, [open, tolerance, invert, feather, activeColor, canvasRef]);\r\n\r\n  const updatePreview = () => {\r\n    if (!canvasRef.current || !previewCanvasRef.current || !maskCanvasRef.current) return;\r\n\r\n    const sourceCanvas = canvasRef.current;\r\n    const previewCanvas = previewCanvasRef.current;\r\n    const maskCanvas = maskCanvasRef.current;\r\n\r\n    if (\r\n      previewCanvas.width !== sourceCanvas.width ||\r\n      previewCanvas.height !== sourceCanvas.height\r\n    ) {\r\n      previewCanvas.width = sourceCanvas.width;\r\n      previewCanvas.height = sourceCanvas.height;\r\n    }\r\n\r\n    const ctx = previewCanvas.getContext('2d')!;\r\n\r\n    if (previewMode === 'mask') {\r\n      ctx.drawImage(maskCanvas, 0, 0);\r\n    } else {\r\n      const sourceCtx = sourceCanvas.getContext('2d')!;\r\n      const maskCtx = maskCanvas.getContext('2d')!;\r\n\r\n      const sourceData = sourceCtx.getImageData(0, 0, sourceCanvas.width, sourceCanvas.height);\r\n      const maskData = maskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n      const previewData = ctx.createImageData(sourceCanvas.width, sourceCanvas.height);\r\n\r\n      for (let i = 0; i < sourceData.data.length; i += 4) {\r\n        previewData.data[i] = sourceData.data[i];\r\n        previewData.data[i + 1] = sourceData.data[i + 1];\r\n        previewData.data[i + 2] = sourceData.data[i + 2];\r\n        // Use mask R channel as alpha (since we stored it in RGB)\r\n        previewData.data[i + 3] = maskData.data[i];\r\n      }\r\n\r\n      ctx.putImageData(previewData, 0, 0);\r\n    }\r\n\r\n    updateOverlay();\r\n  };\r\n\r\n  const updateOverlay = () => {\r\n    if (!overlayCanvasRef.current || !canvasRef.current) return;\r\n\r\n    const overlayCanvas = overlayCanvasRef.current;\r\n    if (\r\n      overlayCanvas.width !== canvasRef.current.width ||\r\n      overlayCanvas.height !== canvasRef.current.height\r\n    ) {\r\n      overlayCanvas.width = canvasRef.current.width;\r\n      overlayCanvas.height = canvasRef.current.height;\r\n    }\r\n\r\n    const ctx = overlayCanvas.getContext('2d')!;\r\n    ctx.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);\r\n\r\n    if (cursorPos) {\r\n      const color = brushMode === 'remove' ? '#000000' : '#ffffff';\r\n      drawBrushCursor(ctx, cursorPos.x, cursorPos.y, brushSize, color, 1);\r\n    }\r\n  };\r\n\r\n  // Mouse handlers\r\n  const handleMouseDown = (e: React.MouseEvent<HTMLCanvasElement>) => {\r\n    if (!maskCanvasRef.current) return;\r\n\r\n    const coords = getCanvasCoords(e, previewCanvasRef, 1);\r\n    if (!coords) return;\r\n\r\n    // Check for brush resize (Alt + Click)\r\n    if (e.altKey) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      resizingBrush.current = true;\r\n      resizeStartX.current = e.clientX;\r\n      initialBrushSize.current = brushSize;\r\n\r\n      const onWindowMouseMove = (ev: MouseEvent) => {\r\n        if (!resizingBrush.current || resizeStartX.current === null) return;\r\n        const delta = ev.clientX - resizeStartX.current;\r\n        const newSize = Math.max(1, Math.min(500, initialBrushSize.current + delta * 0.5));\r\n        setBrushSize(Math.round(newSize));\r\n      };\r\n\r\n      const onWindowMouseUp = () => {\r\n        resizingBrush.current = false;\r\n        resizeStartX.current = null;\r\n        window.removeEventListener('mousemove', onWindowMouseMove);\r\n        window.removeEventListener('mouseup', onWindowMouseUp);\r\n      };\r\n\r\n      window.addEventListener('mousemove', onWindowMouseMove);\r\n      window.addEventListener('mouseup', onWindowMouseUp);\r\n      return;\r\n    }\r\n\r\n    setIsDrawing(true);\r\n    drawPoints.current = [coords];\r\n\r\n    // Draw initial point\r\n    const maskCtx = maskCanvasRef.current.getContext('2d')!;\r\n    // In our mask: White (255) = Keep, Black (0) = Remove\r\n    // Brush 'remove' should paint Black (0), 'keep' should paint White (255)\r\n    const brushColor = brushMode === 'remove' ? '#000000' : '#ffffff';\r\n\r\n    const settings: BrushSettings = {\r\n      color: brushColor,\r\n      lineWidth: brushSize,\r\n      opacity: brushOpacity,\r\n      flow: 1,\r\n      type: brushType,\r\n    };\r\n\r\n    drawBrushStroke(maskCtx, [coords, coords], settings);\r\n    updatePreview();\r\n  };\r\n\r\n  const handleMouseMove = (e: React.MouseEvent<HTMLCanvasElement>) => {\r\n    if (!maskCanvasRef.current) return;\r\n\r\n    const coords = getCanvasCoords(e, previewCanvasRef, 1);\r\n    if (!coords) return;\r\n\r\n    setCursorPos(coords);\r\n\r\n    if (!isDrawing) {\r\n      updateOverlay();\r\n      return;\r\n    }\r\n\r\n    drawPoints.current.push(coords);\r\n\r\n    const maskCtx = maskCanvasRef.current.getContext('2d')!;\r\n    const brushColor = brushMode === 'remove' ? '#000000' : '#ffffff';\r\n\r\n    const settings: BrushSettings = {\r\n      color: brushColor,\r\n      lineWidth: brushSize,\r\n      opacity: brushOpacity,\r\n      flow: 1,\r\n      type: brushType,\r\n    };\r\n\r\n    const points = drawPoints.current;\r\n    if (points.length >= 2) {\r\n      drawBrushStroke(maskCtx, points.slice(-2), settings);\r\n      updatePreview();\r\n    }\r\n  };\r\n\r\n  const handleMouseUp = () => {\r\n    if (isDrawing) {\r\n      saveHistory();\r\n    }\r\n    setIsDrawing(false);\r\n    drawPoints.current = [];\r\n  };\r\n\r\n  const handleMouseLeave = () => {\r\n    if (resizingBrush.current) return;\r\n    setCursorPos(null);\r\n    setIsDrawing(false);\r\n    updateOverlay();\r\n  };\r\n\r\n  // Keyboard handlers for brush mode toggle\r\n  useEffect(() => {\r\n    if (!open) return;\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      // Undo / Redo\r\n      if ((e.ctrlKey || e.metaKey) && (e.key === 'z' || e.key === 'Z')) {\r\n        e.preventDefault();\r\n        if (e.shiftKey) {\r\n          redo();\r\n        } else {\r\n          undo();\r\n        }\r\n        return;\r\n      }\r\n      if ((e.ctrlKey || e.metaKey) && (e.key === 'y' || e.key === 'Y')) {\r\n        e.preventDefault();\r\n        redo();\r\n        return;\r\n      }\r\n\r\n      // Brush Size\r\n      if (e.key === '[') {\r\n        setBrushSize((prev) => Math.max(1, prev - 5));\r\n        return;\r\n      }\r\n      if (e.key === ']') {\r\n        setBrushSize((prev) => Math.min(500, prev + 5));\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'x' || e.key === 'X') {\r\n        setBrushMode((prev) => (prev === 'remove' ? 'keep' : 'remove'));\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [open, historyIndex, history]);\r\n\r\n  const handleApply = () => {\r\n    if (maskCanvasRef.current) {\r\n      onApply(maskCanvasRef.current);\r\n    }\r\n  };\r\n\r\n  // History helpers\r\n  const saveHistory = () => {\r\n    if (!maskCanvasRef.current) return;\r\n    const ctx = maskCanvasRef.current.getContext('2d')!;\r\n    const imageData = ctx.getImageData(\r\n      0,\r\n      0,\r\n      maskCanvasRef.current.width,\r\n      maskCanvasRef.current.height,\r\n    );\r\n\r\n    setHistory((prev) => {\r\n      const newHistory = prev.slice(0, historyIndex + 1);\r\n      if (newHistory.length >= 20) newHistory.shift(); // Limit history size\r\n      return [...newHistory, imageData];\r\n    });\r\n    setHistoryIndex((prev) => Math.min(prev + 1, 19));\r\n  };\r\n\r\n  const undo = () => {\r\n    if (historyIndex <= 0 || !maskCanvasRef.current) return;\r\n    const newIndex = historyIndex - 1;\r\n    const imageData = history[newIndex];\r\n    const ctx = maskCanvasRef.current.getContext('2d')!;\r\n    ctx.putImageData(imageData, 0, 0);\r\n    setHistoryIndex(newIndex);\r\n    updatePreview();\r\n  };\r\n\r\n  const redo = () => {\r\n    if (historyIndex >= history.length - 1 || !maskCanvasRef.current) return;\r\n    const newIndex = historyIndex + 1;\r\n    const imageData = history[newIndex];\r\n    const ctx = maskCanvasRef.current.getContext('2d')!;\r\n    ctx.putImageData(imageData, 0, 0);\r\n    setHistoryIndex(newIndex);\r\n    updatePreview();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <Space>\r\n          Remove Color\r\n          <Button\r\n            type=\"text\"\r\n            icon={<QuestionCircleOutlined />}\r\n            size=\"small\"\r\n            onClick={() => setOpenTour(true)}\r\n          />\r\n        </Space>\r\n      }\r\n      open={open}\r\n      onCancel={onCancel}\r\n      onOk={handleApply}\r\n      width={Math.min(\r\n        canvasRef.current?.width ? canvasRef.current.width + 100 : 900,\r\n        window.innerWidth * 0.95,\r\n      )}\r\n      okText=\"Apply\"\r\n      cancelText=\"Cancel\"\r\n      style={{ top: 20 }}\r\n      maskClosable={false}\r\n    >\r\n      <Space direction=\"vertical\" style={{ width: '100%' }} size=\"large\">\r\n        <div style={{ display: 'flex', gap: 24, flexWrap: 'wrap' }}>\r\n          <div style={{ flex: 1, minWidth: 300 }} ref={controlsRef}>\r\n            <div style={{ marginBottom: 16 }}>\r\n              <div style={{ marginBottom: 8 }}>\r\n                <strong>Selected Color:</strong>{' '}\r\n                <ColorPicker\r\n                  value={activeColor}\r\n                  onChange={(c) => setActiveColor(c.toHexString())}\r\n                  showText\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div style={{ marginBottom: 16 }}>\r\n              <div style={{ marginBottom: 8 }}>\r\n                <strong>Tolerance:</strong> {tolerance}%\r\n              </div>\r\n              <Slider\r\n                min={0}\r\n                max={100}\r\n                value={tolerance}\r\n                onChange={setTolerance}\r\n                tooltip={{ formatter: (value) => `${value}%` }}\r\n              />\r\n            </div>\r\n\r\n            <div style={{ marginBottom: 16 }}>\r\n              <div style={{ marginBottom: 8 }}>\r\n                <strong>Feather:</strong> {feather}%\r\n              </div>\r\n              <Slider\r\n                min={0}\r\n                max={50}\r\n                value={feather}\r\n                onChange={setFeather}\r\n                tooltip={{ formatter: (value) => `${value}%` }}\r\n              />\r\n            </div>\r\n\r\n            <Space size=\"large\">\r\n              <div>\r\n                <div style={{ marginBottom: 8 }}>\r\n                  <strong>Invert:</strong>\r\n                </div>\r\n                <Radio.Group value={invert} onChange={(e) => setInvert(e.target.value)}>\r\n                  <Radio.Button value={false}>Normal</Radio.Button>\r\n                  <Radio.Button value={true}>Inverted</Radio.Button>\r\n                </Radio.Group>\r\n              </div>\r\n\r\n              <div>\r\n                <div style={{ marginBottom: 8 }}>\r\n                  <strong>Preview:</strong>\r\n                </div>\r\n                <Radio.Group\r\n                  value={previewMode}\r\n                  onChange={(e) => {\r\n                    setPreviewMode(e.target.value);\r\n                    // Need to trigger update manually since state change is async but we want immediate feedback\r\n                    setTimeout(updatePreview, 0);\r\n                  }}\r\n                >\r\n                  <Radio.Button value=\"normal\">Normal</Radio.Button>\r\n                  <Radio.Button value=\"mask\">Mask</Radio.Button>\r\n                </Radio.Group>\r\n              </div>\r\n\r\n              <div>\r\n                <div style={{ marginBottom: 8 }}>\r\n                  <strong>History:</strong>\r\n                </div>\r\n                <Space ref={historyRef}>\r\n                  <Tooltip title=\"Undo\">\r\n                    <Button icon={<UndoOutlined />} onClick={undo} disabled={historyIndex <= 0} />\r\n                  </Tooltip>\r\n                  <Tooltip title=\"Redo\">\r\n                    <Button\r\n                      icon={<RedoOutlined />}\r\n                      onClick={redo}\r\n                      disabled={historyIndex >= history.length - 1}\r\n                    />\r\n                  </Tooltip>\r\n                </Space>\r\n              </div>\r\n            </Space>\r\n          </div>\r\n\r\n          <div\r\n            style={{ flex: 1, minWidth: 300, borderLeft: '1px solid #eee', paddingLeft: 24 }}\r\n            ref={brushRef}\r\n          >\r\n            <div style={{ marginBottom: 16, fontWeight: 'bold' }}>Manual Adjustments (Brush)</div>\r\n\r\n            <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n              <Space wrap>\r\n                <Radio.Group\r\n                  value={brushMode}\r\n                  onChange={(e) => setBrushMode(e.target.value)}\r\n                  buttonStyle=\"solid\"\r\n                >\r\n                  <Radio.Button value=\"remove\">Remove (Black)</Radio.Button>\r\n                  <Radio.Button value=\"keep\">Keep (White)</Radio.Button>\r\n                </Radio.Group>\r\n                <span style={{ fontSize: 12, color: '#666' }}>Press 'X' to toggle</span>\r\n              </Space>\r\n\r\n              <Space wrap align=\"center\">\r\n                <span>Type:</span>\r\n                <Select\r\n                  value={brushType}\r\n                  onChange={(v) => setBrushType(v as 'hard' | 'soft')}\r\n                  style={{ width: 80 }}\r\n                >\r\n                  <Option value=\"hard\">Hard</Option>\r\n                  <Option value=\"soft\">Soft</Option>\r\n                </Select>\r\n\r\n                <span>Size:</span>\r\n                <InputNumber\r\n                  min={1}\r\n                  max={500}\r\n                  value={brushSize}\r\n                  onChange={(v) => setBrushSize(v || 1)}\r\n                  style={{ width: 70 }}\r\n                />\r\n\r\n                <span>Opacity:</span>\r\n                <Slider\r\n                  min={0}\r\n                  max={1}\r\n                  step={0.01}\r\n                  value={brushOpacity}\r\n                  onChange={setBrushOpacity}\r\n                  style={{ width: 80 }}\r\n                />\r\n              </Space>\r\n\r\n              <div style={{ fontSize: 12, color: '#666' }}>\r\n                Note: Changing Tolerance/Feather will reset manual brush edits.\r\n              </div>\r\n            </Space>\r\n          </div>\r\n        </div>\r\n\r\n        <div\r\n          ref={tourCanvasRef}\r\n          style={{\r\n            maxHeight: '60vh',\r\n            overflow: 'auto',\r\n            border: '1px solid #d9d9d9',\r\n            borderRadius: 4,\r\n            padding: 8,\r\n            position: 'relative',\r\n            backgroundImage:\r\n              previewMode === 'normal'\r\n                ? `linear-gradient(45deg, #ccc 25%, transparent 25%),\r\n                   linear-gradient(-45deg, #ccc 25%, transparent 25%),\r\n                   linear-gradient(45deg, transparent 75%, #ccc 75%),\r\n                   linear-gradient(-45deg, transparent 75%, #ccc 75%)`\r\n                : 'none',\r\n            backgroundSize: previewMode === 'normal' ? '20px 20px' : 'auto',\r\n            backgroundPosition:\r\n              previewMode === 'normal' ? '0 0, 0 10px, 10px -10px, -10px 0px' : 'auto',\r\n            backgroundColor: previewMode === 'mask' ? '#808080' : '#fff',\r\n          }}\r\n        >\r\n          <div style={{ position: 'relative', display: 'inline-block' }}>\r\n            {/* Hidden mask canvas */}\r\n            <canvas ref={maskCanvasRef} style={{ display: 'none' }} />\r\n\r\n            <canvas\r\n              ref={previewCanvasRef}\r\n              style={{\r\n                maxWidth: '100%',\r\n                height: 'auto',\r\n                display: 'block',\r\n                imageRendering: 'pixelated',\r\n                cursor: 'none', // Hide default cursor\r\n              }}\r\n              onMouseDown={handleMouseDown}\r\n              onMouseMove={handleMouseMove}\r\n              onMouseUp={handleMouseUp}\r\n              onMouseLeave={handleMouseLeave}\r\n            />\r\n\r\n            {/* Overlay canvas for cursor */}\r\n            <canvas\r\n              ref={overlayCanvasRef}\r\n              style={{\r\n                position: 'absolute',\r\n                top: 0,\r\n                left: 0,\r\n                width: '100%',\r\n                height: '100%',\r\n                pointerEvents: 'none',\r\n                imageRendering: 'pixelated',\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <Tour open={openTour} onClose={() => setOpenTour(false)} steps={tourSteps} />\r\n      </Space>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ColorRemovalModal;\r\n","import React, { useEffect, useState, useRef } from 'react';\r\nimport {\r\n  Modal,\r\n  Slider,\r\n  Radio,\r\n  Space,\r\n  Button,\r\n  Select,\r\n  InputNumber,\r\n  ColorPicker,\r\n  Tooltip,\r\n  Tour,\r\n  type TourProps,\r\n} from 'antd';\r\nimport {\r\n  BgColorsOutlined,\r\n  HighlightOutlined,\r\n  UndoOutlined,\r\n  RedoOutlined,\r\n  QuestionCircleOutlined,\r\n} from '@ant-design/icons';\r\nimport {\r\n  BrushSettings,\r\n  drawBrushStroke,\r\n  drawBrushCursor,\r\n  getCanvasCoords,\r\n  samplePixelColor,\r\n} from '../../utils/brushHelpers';\r\nimport ColorRemovalModal from './ColorRemovalModal';\r\n\r\nconst { Option } = Select;\r\n\r\ntype LayerMaskModalProps = {\r\n  open: boolean;\r\n  onCancel: () => void;\r\n  onApply: (maskCanvas: HTMLCanvasElement) => void;\r\n  sourceCanvas: HTMLCanvasElement | null;\r\n  existingMask?: HTMLCanvasElement | null;\r\n};\r\n\r\nconst LayerMaskModal: React.FC<LayerMaskModalProps> = ({\r\n  open,\r\n  onCancel,\r\n  onApply,\r\n  sourceCanvas,\r\n  existingMask,\r\n}) => {\r\n  // Canvas refs\r\n  const maskCanvasRef = useRef<HTMLCanvasElement>(null);\r\n  const previewCanvasRef = useRef<HTMLCanvasElement>(null);\r\n  const overlayCanvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n  // History state\r\n  const [history, setHistory] = useState<ImageData[]>([]);\r\n  const [historyIndex, setHistoryIndex] = useState(-1);\r\n\r\n  // Brush mode: 'remove' (paint black/0 alpha) or 'keep' (paint white/255 alpha)\r\n  const [brushMode, setBrushMode] = useState<'remove' | 'keep'>('remove');\r\n\r\n  // Brush settings\r\n  const [brushSize, setBrushSize] = useState(20);\r\n  const [brushOpacity, setBrushOpacity] = useState(1);\r\n  const [brushType, setBrushType] = useState<'hard' | 'soft'>('hard');\r\n\r\n  // Preview mode\r\n  const [previewMode, setPreviewMode] = useState<'normal' | 'mask'>('normal');\r\n\r\n  // Drawing state\r\n  const [isDrawing, setIsDrawing] = useState(false);\r\n  const drawPoints = useRef<{ x: number; y: number }[]>([]);\r\n\r\n  // Cursor position\r\n  const [cursorPos, setCursorPos] = useState<{ x: number; y: number } | null>(null);\r\n\r\n  // Color removal tool state\r\n  const [showColorRemovalModal, setShowColorRemovalModal] = useState(false);\r\n  const [selectedColor, setSelectedColor] = useState<string | null>(null);\r\n  const tempMaskCanvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n  // Brush resize with mouse\r\n  const resizingBrush = useRef(false);\r\n  const resizeStartX = useRef<number | null>(null);\r\n  const initialBrushSize = useRef(brushSize);\r\n\r\n  // Ctrl key state for color picker mode\r\n  const [isCtrlDown, setIsCtrlDown] = useState(false);\r\n\r\n  // Tour state\r\n  const [openTour, setOpenTour] = useState(false);\r\n  const toolSelectRef = useRef(null);\r\n  const previewModeRef = useRef(null);\r\n  const historyRef = useRef(null);\r\n  const brushControlsRef = useRef(null);\r\n  const colorControlsRef = useRef(null);\r\n  const tourCanvasRef = useRef(null);\r\n\r\n  const tourSteps: TourProps['steps'] = [\r\n    {\r\n      title: 'Tool Selection',\r\n      description:\r\n        'Choose between the Brush Tool for manual masking or Color Removal for auto-masking.',\r\n      target: () => toolSelectRef.current,\r\n    },\r\n    {\r\n      title: 'Preview Mode',\r\n      description: 'Switch between Normal view (result) and Mask view (black & white mask).',\r\n      target: () => previewModeRef.current,\r\n    },\r\n    {\r\n      title: 'History',\r\n      description: 'Undo or Redo your changes.',\r\n      target: () => historyRef.current,\r\n    },\r\n    {\r\n      title: 'Tool Controls',\r\n      description: 'Adjust settings for the Brush (Size, Opacity, Type).',\r\n      target: () => brushControlsRef.current,\r\n    },\r\n    {\r\n      title: 'Canvas',\r\n      description: 'Draw on the canvas to mask areas. Use Alt + Drag to resize brush.',\r\n      target: () => tourCanvasRef.current,\r\n    },\r\n  ];\r\n\r\n  // #region 🖱️ Disable Right-Click Context Menu\r\n  useEffect(() => {\r\n    const canvas = previewCanvasRef.current;\r\n    if (!canvas) return;\r\n    const handleContextMenu = (e: MouseEvent) => e.preventDefault();\r\n    canvas.addEventListener('contextmenu', handleContextMenu);\r\n    return () => canvas.removeEventListener('contextmenu', handleContextMenu);\r\n  }, []);\r\n  //#endregion\r\n\r\n  // History helpers\r\n  const saveHistory = () => {\r\n    if (!maskCanvasRef.current) return;\r\n    const ctx = maskCanvasRef.current.getContext('2d')!;\r\n    const imageData = ctx.getImageData(\r\n      0,\r\n      0,\r\n      maskCanvasRef.current.width,\r\n      maskCanvasRef.current.height,\r\n    );\r\n\r\n    setHistory((prev) => {\r\n      const newHistory = prev.slice(0, historyIndex + 1);\r\n      if (newHistory.length >= 20) newHistory.shift(); // Limit history size\r\n      return [...newHistory, imageData];\r\n    });\r\n    setHistoryIndex((prev) => Math.min(prev + 1, 19));\r\n  };\r\n\r\n  const undo = () => {\r\n    if (historyIndex <= 0 || !maskCanvasRef.current) return;\r\n    const newIndex = historyIndex - 1;\r\n    const imageData = history[newIndex];\r\n    const ctx = maskCanvasRef.current.getContext('2d')!;\r\n    ctx.putImageData(imageData, 0, 0);\r\n    setHistoryIndex(newIndex);\r\n    updatePreview();\r\n  };\r\n\r\n  const redo = () => {\r\n    if (historyIndex >= history.length - 1 || !maskCanvasRef.current) return;\r\n    const newIndex = historyIndex + 1;\r\n    const imageData = history[newIndex];\r\n    const ctx = maskCanvasRef.current.getContext('2d')!;\r\n    ctx.putImageData(imageData, 0, 0);\r\n    setHistoryIndex(newIndex);\r\n    updatePreview();\r\n  };\r\n\r\n  // Initialize mask when modal opens\r\n  useEffect(() => {\r\n    if (!open || !sourceCanvas || !maskCanvasRef.current) return;\r\n\r\n    const maskCanvas = maskCanvasRef.current;\r\n    maskCanvas.width = sourceCanvas.width;\r\n    maskCanvas.height = sourceCanvas.height;\r\n\r\n    const ctx = maskCanvas.getContext('2d')!;\r\n\r\n    if (existingMask) {\r\n      // Load existing mask\r\n      ctx.drawImage(existingMask, 0, 0);\r\n    } else {\r\n      // Initialize with white (keep everything)\r\n      ctx.fillStyle = '#ffffff';\r\n      ctx.fillRect(0, 0, maskCanvas.width, maskCanvas.height);\r\n    }\r\n\r\n    // Initialize history\r\n    const initialData = ctx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n    setHistory([initialData]);\r\n    setHistoryIndex(0);\r\n\r\n    updatePreview();\r\n  }, [open, sourceCanvas, existingMask]);\r\n\r\n  // Update preview when mask or mode changes\r\n  const updatePreview = () => {\r\n    if (!maskCanvasRef.current || !previewCanvasRef.current || !sourceCanvas) return;\r\n\r\n    const maskCanvas = maskCanvasRef.current;\r\n    const previewCanvas = previewCanvasRef.current;\r\n    previewCanvas.width = sourceCanvas.width;\r\n    previewCanvas.height = sourceCanvas.height;\r\n\r\n    const ctx = previewCanvas.getContext('2d')!;\r\n\r\n    if (previewMode === 'mask') {\r\n      // Show black and white mask\r\n      ctx.drawImage(maskCanvas, 0, 0);\r\n    } else {\r\n      // Show normal preview with alpha applied\r\n      const sourceCtx = sourceCanvas.getContext('2d')!;\r\n      const maskCtx = maskCanvas.getContext('2d')!;\r\n\r\n      const sourceData = sourceCtx.getImageData(0, 0, sourceCanvas.width, sourceCanvas.height);\r\n      const maskData = maskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n      const previewData = ctx.createImageData(sourceCanvas.width, sourceCanvas.height);\r\n\r\n      for (let i = 0; i < sourceData.data.length; i += 4) {\r\n        previewData.data[i] = sourceData.data[i]; // R\r\n        previewData.data[i + 1] = sourceData.data[i + 1]; // G\r\n        previewData.data[i + 2] = sourceData.data[i + 2]; // B\r\n        // Use mask grayscale value as alpha\r\n        previewData.data[i + 3] = maskData.data[i];\r\n      }\r\n\r\n      ctx.putImageData(previewData, 0, 0);\r\n    }\r\n\r\n    updateOverlay();\r\n  };\r\n\r\n  // Update overlay (cursor)\r\n  const updateOverlay = () => {\r\n    if (!overlayCanvasRef.current || !maskCanvasRef.current) return;\r\n\r\n    const overlayCanvas = overlayCanvasRef.current;\r\n    const ctx = overlayCanvas.getContext('2d')!;\r\n    ctx.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);\r\n\r\n    if (cursorPos) {\r\n      if (isCtrlDown) {\r\n        // Show color picker cursor (small circle)\r\n        ctx.save();\r\n        ctx.strokeStyle = '#00aaff';\r\n        ctx.lineWidth = 2;\r\n        ctx.beginPath();\r\n        ctx.arc(cursorPos.x, cursorPos.y, 8, 0, Math.PI * 2);\r\n        ctx.stroke();\r\n        ctx.restore();\r\n      } else {\r\n        // Show brush cursor\r\n        const color = brushMode === 'remove' ? '#000000' : '#ffffff';\r\n        drawBrushCursor(ctx, cursorPos.x, cursorPos.y, brushSize, color, 1);\r\n      }\r\n    }\r\n  };\r\n\r\n  // Handle color removal result\r\n  const handleColorRemovalApply = (resultMaskCanvas: HTMLCanvasElement) => {\r\n    if (!maskCanvasRef.current) return;\r\n\r\n    const maskCanvas = maskCanvasRef.current;\r\n    const ctx = maskCanvas.getContext('2d')!;\r\n    const maskData = ctx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n    const resultCtx = resultMaskCanvas.getContext('2d')!;\r\n    const resultData = resultCtx.getImageData(\r\n      0,\r\n      0,\r\n      resultMaskCanvas.width,\r\n      resultMaskCanvas.height,\r\n    );\r\n\r\n    // Combine with existing mask (multiply operation)\r\n    for (let i = 0; i < maskData.data.length; i += 4) {\r\n      const existingAlpha = maskData.data[i];\r\n      const newAlpha = resultData.data[i];\r\n      const combinedAlpha = Math.round((existingAlpha / 255) * (newAlpha / 255) * 255);\r\n\r\n      maskData.data[i] = combinedAlpha; // R\r\n      maskData.data[i + 1] = combinedAlpha; // G\r\n      maskData.data[i + 2] = combinedAlpha; // B\r\n      maskData.data[i + 3] = 255; // A\r\n    }\r\n\r\n    ctx.putImageData(maskData, 0, 0);\r\n    updatePreview();\r\n    setShowColorRemovalModal(false);\r\n    saveHistory();\r\n  };\r\n\r\n  // Mouse handlers\r\n  const handleMouseDown = (e: React.MouseEvent<HTMLCanvasElement>) => {\r\n    if (!maskCanvasRef.current) return;\r\n\r\n    const coords = getCanvasCoords(e, previewCanvasRef, 1);\r\n    if (!coords) return;\r\n\r\n    // Check for brush resize (Alt + Click)\r\n    if (e.altKey) {\r\n      e.preventDefault();\r\n      resizingBrush.current = true;\r\n      resizeStartX.current = e.clientX;\r\n      initialBrushSize.current = brushSize;\r\n\r\n      const onWindowMouseMove = (ev: MouseEvent) => {\r\n        if (!resizingBrush.current || resizeStartX.current === null) return;\r\n        const delta = ev.clientX - resizeStartX.current;\r\n        const newSize = Math.max(1, Math.min(500, initialBrushSize.current + delta * 0.5));\r\n        setBrushSize(Math.round(newSize));\r\n      };\r\n\r\n      const onWindowMouseUp = () => {\r\n        resizingBrush.current = false;\r\n        resizeStartX.current = null;\r\n        window.removeEventListener('mousemove', onWindowMouseMove);\r\n        window.removeEventListener('mouseup', onWindowMouseUp);\r\n      };\r\n\r\n      window.addEventListener('mousemove', onWindowMouseMove);\r\n      window.addEventListener('mouseup', onWindowMouseUp);\r\n      return;\r\n    }\r\n\r\n    // Check for color picker (Ctrl/Cmd + Click)\r\n    if (e.ctrlKey || e.metaKey) {\r\n      const color = samplePixelColor(sourceCanvas!, coords.x, coords.y);\r\n      if (color) {\r\n        setSelectedColor(color);\r\n        setShowColorRemovalModal(true);\r\n      }\r\n      return;\r\n    }\r\n\r\n    setIsDrawing(true);\r\n    drawPoints.current = [coords];\r\n\r\n    // Draw initial point\r\n    const maskCtx = maskCanvasRef.current.getContext('2d')!;\r\n    const brushColor = brushMode === 'remove' ? '#000000' : '#ffffff';\r\n\r\n    const settings: BrushSettings = {\r\n      color: brushColor,\r\n      lineWidth: brushSize,\r\n      opacity: brushOpacity,\r\n      flow: 1,\r\n      type: brushType,\r\n    };\r\n\r\n    drawBrushStroke(maskCtx, [coords, coords], settings);\r\n    updatePreview();\r\n  };\r\n\r\n  const handleMouseMove = (e: React.MouseEvent<HTMLCanvasElement>) => {\r\n    if (!maskCanvasRef.current) return;\r\n\r\n    const coords = getCanvasCoords(e, previewCanvasRef, 1);\r\n    if (!coords) return;\r\n\r\n    setCursorPos(coords);\r\n\r\n    if (!isDrawing) {\r\n      updateOverlay();\r\n      return;\r\n    }\r\n\r\n    drawPoints.current.push(coords);\r\n\r\n    const maskCtx = maskCanvasRef.current.getContext('2d')!;\r\n    const brushColor = brushMode === 'remove' ? '#000000' : '#ffffff';\r\n\r\n    const settings: BrushSettings = {\r\n      color: brushColor,\r\n      lineWidth: brushSize,\r\n      opacity: brushOpacity,\r\n      flow: 1,\r\n      type: brushType,\r\n    };\r\n\r\n    const points = drawPoints.current;\r\n    if (points.length >= 2) {\r\n      drawBrushStroke(maskCtx, points.slice(-2), settings);\r\n      updatePreview();\r\n    }\r\n  };\r\n\r\n  const handleMouseUp = () => {\r\n    if (isDrawing) {\r\n      saveHistory();\r\n    }\r\n    setIsDrawing(false);\r\n    drawPoints.current = [];\r\n  };\r\n\r\n  const handleMouseLeave = () => {\r\n    if (resizingBrush.current) return;\r\n    setCursorPos(null);\r\n    setIsDrawing(false);\r\n    updateOverlay();\r\n  };\r\n\r\n  // Keyboard handlers\r\n  useEffect(() => {\r\n    if (!open) return;\r\n\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      // Undo / Redo\r\n      if ((e.ctrlKey || e.metaKey) && (e.key === 'z' || e.key === 'Z')) {\r\n        e.preventDefault();\r\n        if (e.shiftKey) {\r\n          redo();\r\n        } else {\r\n          undo();\r\n        }\r\n        return;\r\n      }\r\n      if ((e.ctrlKey || e.metaKey) && (e.key === 'y' || e.key === 'Y')) {\r\n        e.preventDefault();\r\n        redo();\r\n        return;\r\n      }\r\n\r\n      // Brush Size\r\n      if (e.key === '[') {\r\n        setBrushSize((prev) => Math.max(1, prev - 5));\r\n        return;\r\n      }\r\n      if (e.key === ']') {\r\n        setBrushSize((prev) => Math.min(500, prev + 5));\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'x' || e.key === 'X') {\r\n        setBrushMode((prev) => (prev === 'remove' ? 'keep' : 'remove'));\r\n      }\r\n      if (e.ctrlKey || e.metaKey) {\r\n        setIsCtrlDown(true);\r\n      }\r\n    };\r\n\r\n    const handleKeyUp = (e: KeyboardEvent) => {\r\n      if (!e.ctrlKey && !e.metaKey) {\r\n        setIsCtrlDown(false);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    window.addEventListener('keyup', handleKeyUp);\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyDown);\r\n      window.removeEventListener('keyup', handleKeyUp);\r\n    };\r\n  }, [open, historyIndex, history]); // Added history dependencies for undo/redo closure\r\n\r\n  // Update overlay when cursor or brush settings change\r\n  useEffect(() => {\r\n    updateOverlay();\r\n  }, [cursorPos, brushSize, brushMode, isCtrlDown]);\r\n\r\n  const handleApply = () => {\r\n    if (maskCanvasRef.current) {\r\n      onApply(maskCanvasRef.current);\r\n    }\r\n  };\r\n\r\n  const handleClearMask = () => {\r\n    if (!maskCanvasRef.current) return;\r\n    const ctx = maskCanvasRef.current.getContext('2d')!;\r\n    ctx.fillStyle = '#ffffff';\r\n    ctx.fillRect(0, 0, maskCanvasRef.current.width, maskCanvasRef.current.height);\r\n    updatePreview();\r\n    saveHistory();\r\n  };\r\n\r\n  const handleInvertMask = () => {\r\n    if (!maskCanvasRef.current) return;\r\n    const ctx = maskCanvasRef.current.getContext('2d')!;\r\n    const imageData = ctx.getImageData(\r\n      0,\r\n      0,\r\n      maskCanvasRef.current.width,\r\n      maskCanvasRef.current.height,\r\n    );\r\n    const data = imageData.data;\r\n\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      data[i] = 255 - data[i];\r\n      data[i + 1] = 255 - data[i + 1];\r\n      data[i + 2] = 255 - data[i + 2];\r\n    }\r\n\r\n    ctx.putImageData(imageData, 0, 0);\r\n    updatePreview();\r\n    saveHistory();\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Modal\r\n        title={\r\n          <Space>\r\n            Layer Mask Editor\r\n            <Button\r\n              type=\"text\"\r\n              icon={<QuestionCircleOutlined />}\r\n              size=\"small\"\r\n              onClick={() => setOpenTour(true)}\r\n            />\r\n          </Space>\r\n        }\r\n        open={open}\r\n        onCancel={onCancel}\r\n        onOk={handleApply}\r\n        width={Math.min(\r\n          sourceCanvas?.width ? sourceCanvas.width + 400 : 900,\r\n          window.innerWidth * 0.95,\r\n        )}\r\n        style={{ top: 20 }}\r\n        okText=\"Apply Mask\"\r\n        cancelText=\"Cancel\"\r\n        maskClosable={false}\r\n      >\r\n        <Space direction=\"vertical\" style={{ width: '100%' }} size=\"middle\">\r\n          {/* Tool Selection */}\r\n          <Space wrap ref={toolSelectRef}>\r\n            <Button icon={<BgColorsOutlined />} onClick={() => setShowColorRemovalModal(true)}>\r\n              Color Removal\r\n            </Button>\r\n\r\n            <Radio.Group\r\n              value={previewMode}\r\n              onChange={(e) => {\r\n                setPreviewMode(e.target.value);\r\n                updatePreview();\r\n              }}\r\n            >\r\n              <Radio.Button value=\"normal\">Normal</Radio.Button>\r\n              <Radio.Button value=\"mask\">Mask View</Radio.Button>\r\n            </Radio.Group>\r\n\r\n            <Button onClick={handleClearMask}>Clear Mask</Button>\r\n            <Button onClick={handleInvertMask}>Invert Mask</Button>\r\n            <Tooltip title=\"Undo\">\r\n              <Button icon={<UndoOutlined />} onClick={undo} disabled={historyIndex <= 0} />\r\n            </Tooltip>\r\n            <Tooltip title=\"Redo\">\r\n              <Button\r\n                icon={<RedoOutlined />}\r\n                onClick={redo}\r\n                disabled={historyIndex >= history.length - 1}\r\n              />\r\n            </Tooltip>\r\n          </Space>\r\n\r\n          {/* Brush Tool Controls */}\r\n          <Space direction=\"vertical\" style={{ width: '100%' }} ref={brushControlsRef}>\r\n            <Space wrap>\r\n              <Radio.Group\r\n                value={brushMode}\r\n                onChange={(e) => setBrushMode(e.target.value)}\r\n                buttonStyle=\"solid\"\r\n              >\r\n                <Radio.Button value=\"remove\">Remove (Black)</Radio.Button>\r\n                <Radio.Button value=\"keep\">Keep (White)</Radio.Button>\r\n              </Radio.Group>\r\n              <span style={{ fontSize: 12, color: '#666' }}>Press 'X' to toggle</span>\r\n            </Space>\r\n\r\n            <Space wrap align=\"center\">\r\n              <span>Brush Type:</span>\r\n              <Select\r\n                value={brushType}\r\n                onChange={(v) => setBrushType(v as 'hard' | 'soft')}\r\n                style={{ width: 100 }}\r\n              >\r\n                <Option value=\"hard\">Hard</Option>\r\n                <Option value=\"soft\">Soft</Option>\r\n              </Select>\r\n\r\n              <span>Size:</span>\r\n              <InputNumber\r\n                min={1}\r\n                max={500}\r\n                value={brushSize}\r\n                onChange={(v) => setBrushSize(v || 1)}\r\n                style={{ width: 80 }}\r\n              />\r\n              <Tooltip title=\"Alt + Drag to resize\">\r\n                <span style={{ fontSize: 12, color: '#666' }}>Alt+Drag</span>\r\n              </Tooltip>\r\n\r\n              <span>Opacity:</span>\r\n              <Slider\r\n                min={0}\r\n                max={1}\r\n                step={0.01}\r\n                value={brushOpacity}\r\n                onChange={setBrushOpacity}\r\n                style={{ width: 100 }}\r\n              />\r\n              <span>{Math.round(brushOpacity * 100)}%</span>\r\n            </Space>\r\n          </Space>\r\n\r\n          {/* Canvas Container */}\r\n          <div\r\n            ref={tourCanvasRef}\r\n            style={{\r\n              maxHeight: '60vh',\r\n              overflow: 'auto',\r\n              border: '1px solid #d9d9d9',\r\n              borderRadius: 4,\r\n              padding: 8,\r\n              position: 'relative',\r\n              backgroundImage:\r\n                previewMode === 'normal'\r\n                  ? `linear-gradient(45deg, #ccc 25%, transparent 25%),\r\n                   linear-gradient(-45deg, #ccc 25%, transparent 25%),\r\n                   linear-gradient(45deg, transparent 75%, #ccc 75%),\r\n                   linear-gradient(-45deg, transparent 75%, #ccc 75%)`\r\n                  : 'none',\r\n              backgroundSize: previewMode === 'normal' ? '20px 20px' : 'auto',\r\n              backgroundPosition:\r\n                previewMode === 'normal' ? '0 0, 0 10px, 10px -10px, -10px 0px' : 'auto',\r\n              backgroundColor: previewMode === 'mask' ? '#808080' : '#fff',\r\n            }}\r\n          >\r\n            <div style={{ position: 'relative', display: 'inline-block' }}>\r\n              {/* Hidden mask canvas */}\r\n              <canvas ref={maskCanvasRef} style={{ display: 'none' }} />\r\n\r\n              {/* Preview canvas */}\r\n              <canvas\r\n                ref={previewCanvasRef}\r\n                style={{\r\n                  maxWidth: '100%',\r\n                  height: 'auto',\r\n                  display: 'block',\r\n                  imageRendering: 'pixelated',\r\n                }}\r\n                onMouseDown={handleMouseDown}\r\n                onMouseMove={handleMouseMove}\r\n                onMouseUp={handleMouseUp}\r\n                onMouseLeave={handleMouseLeave}\r\n              />\r\n\r\n              {/* Overlay canvas for cursor */}\r\n              <canvas\r\n                ref={overlayCanvasRef}\r\n                width={sourceCanvas?.width || 0}\r\n                height={sourceCanvas?.height || 0}\r\n                style={{\r\n                  position: 'absolute',\r\n                  top: 0,\r\n                  left: 0,\r\n                  width: '100%',\r\n                  height: '100%',\r\n                  pointerEvents: 'none',\r\n                  imageRendering: 'pixelated',\r\n                }}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Instructions */}\r\n          <div style={{ fontSize: 12, color: '#666', marginTop: 8 }}>\r\n            <strong>Instructions:</strong>\r\n            <ul style={{ margin: '4px 0', paddingLeft: 20 }}>\r\n              <li>Paint to remove or keep areas (toggle with 'X' key)</li>\r\n              <li>Black areas = removed, White areas = kept</li>\r\n              <li>Alt + Drag to resize brush</li>\r\n              <li>Ctrl/Cmd + Click to pick color and open Color Removal tool</li>\r\n              <li>Use Color Removal button to open advanced color removal options</li>\r\n            </ul>\r\n          </div>\r\n          <Tour open={openTour} onClose={() => setOpenTour(false)} steps={tourSteps} />\r\n        </Space>\r\n      </Modal>\r\n\r\n      {/* Color Removal Modal */}\r\n      {sourceCanvas && (\r\n        <ColorRemovalModal\r\n          open={showColorRemovalModal}\r\n          onCancel={() => {\r\n            setShowColorRemovalModal(false);\r\n            setSelectedColor(null);\r\n          }}\r\n          onApply={handleColorRemovalApply}\r\n          selectedColor={selectedColor}\r\n          canvasRef={{ current: sourceCanvas }}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default LayerMaskModal;\r\n","import { InputNumber, Slider, Space } from 'antd';\r\n\r\ntype CustomSliderProps = {\r\n  label: string;\r\n  value: number;\r\n  min: number;\r\n  max: number;\r\n  onChange: (v: number) => void;\r\n  onChangeComplete?: () => void;\r\n  gradient?: string; // 👈 dynamic CSS gradient for track\r\n};\r\n\r\nexport const CustomSlider = ({\r\n  label,\r\n  value,\r\n  min,\r\n  max,\r\n  gradient,\r\n  onChange,\r\n  onChangeComplete,\r\n}: CustomSliderProps) => (\r\n  <div className=\"custom-slider-container\">\r\n    <div style={{ width: '100%' }}>\r\n      <span className=\"custom-label\">{label}</span>\r\n      <InputNumber\r\n        min={min}\r\n        max={max}\r\n        value={value}\r\n        onChange={(v) => onChange(Number(v))}\r\n        onBlur={() => onChangeComplete?.()}\r\n        className=\"custom-number\"\r\n        size=\"small\"\r\n      />\r\n    </div>\r\n\r\n    <Slider\r\n      min={min}\r\n      max={max}\r\n      value={value}\r\n      onChange={onChange}\r\n      onChangeComplete={onChangeComplete}\r\n      className=\"custom-slider\"\r\n      style={{ '--custom-slider-gradient': gradient } as React.CSSProperties}\r\n      handleStyle={{ opacity: 1 }}\r\n    />\r\n  </div>\r\n);\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { Modal, Space, Collapse, Button, Row, Col, Tour, type TourProps } from 'antd';\r\nimport { QuestionCircleOutlined } from '@ant-design/icons';\r\nimport { applyEffects } from '../../utils/helpers';\r\nimport { CustomSlider } from './CustomSlider';\r\n\r\nconst { Panel } = Collapse;\r\n\r\ntype LayerEffectModalProps = {\r\n  open: boolean;\r\n  onCancel: () => void;\r\n  onApply: (newImage: HTMLImageElement) => void;\r\n  layer: any; // Using any for now to match existing types loosely\r\n};\r\n\r\nconst LayerEffectModal: React.FC<LayerEffectModalProps> = ({ open, onCancel, onApply, layer }) => {\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const baseCanvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n  // Effects State\r\n  const [brightness, setBrightness] = useState(0);\r\n  const [contrast, setContrast] = useState(0);\r\n  const [blur, setBlur] = useState(0);\r\n  const [gaussian, setGaussian] = useState(0);\r\n  const [sharpen, setSharpen] = useState(0);\r\n  const [texture, setTexture] = useState(0);\r\n  const [clarity, setClarity] = useState(0);\r\n  const [highlights, setHighlights] = useState(0);\r\n  const [shadows, setShadows] = useState(0);\r\n  const [whites, setWhites] = useState(0);\r\n  const [blacks, setBlacks] = useState(0);\r\n  const [vibrance, setVibrance] = useState(0);\r\n  const [saturation, setSaturation] = useState(0);\r\n  const [dehaze, setDehaze] = useState(0);\r\n  const [bgThreshold, setBgThreshold] = useState(0);\r\n  const [bgThresholdBlack, setBgThresholdBlack] = useState(0);\r\n\r\n  // Tour state\r\n  const [openTour, setOpenTour] = useState(false);\r\n  const controlsRef = useRef(null);\r\n  const previewRef = useRef(null);\r\n\r\n  const tourSteps: TourProps['steps'] = [\r\n    {\r\n      title: 'Effect Controls',\r\n      description: 'Adjust various image properties like Brightness, Contrast, Blur, etc.',\r\n      target: () => controlsRef.current,\r\n    },\r\n    {\r\n      title: 'Preview',\r\n      description: 'See the changes in real-time.',\r\n      target: () => previewRef.current,\r\n    },\r\n  ];\r\n\r\n  // Initialize canvases\r\n  useEffect(() => {\r\n    if (!open || !layer?.img || !canvasRef.current || !baseCanvasRef.current) return;\r\n\r\n    const canvas = canvasRef.current;\r\n    const baseCanvas = baseCanvasRef.current;\r\n    const img = layer.img;\r\n\r\n    canvas.width = img.width;\r\n    canvas.height = img.height;\r\n    baseCanvas.width = img.width;\r\n    baseCanvas.height = img.height;\r\n\r\n    const ctx = canvas.getContext('2d')!;\r\n    const baseCtx = baseCanvas.getContext('2d')!;\r\n\r\n    ctx.drawImage(img, 0, 0);\r\n    baseCtx.drawImage(img, 0, 0);\r\n\r\n    // Reset all states\r\n    setBrightness(0);\r\n    setContrast(0);\r\n    setBlur(0);\r\n    setGaussian(0);\r\n    setSharpen(0);\r\n    setTexture(0);\r\n    setClarity(0);\r\n    setHighlights(0);\r\n    setShadows(0);\r\n    setWhites(0);\r\n    setBlacks(0);\r\n    setVibrance(0);\r\n    setSaturation(0);\r\n    setDehaze(0);\r\n    setBgThreshold(0);\r\n    setBgThresholdBlack(0);\r\n  }, [open, layer]);\r\n\r\n  // Apply effects when state changes\r\n  useEffect(() => {\r\n    if (!open || !canvasRef.current || !baseCanvasRef.current) return;\r\n\r\n    // Debounce slightly to avoid too many updates?\r\n    // applyEffects is synchronous but might be heavy.\r\n    // For now, run directly.\r\n\r\n    const dummyHistory = {\r\n      push: () => {}, // No-op\r\n    } as any;\r\n\r\n    applyEffects(\r\n      canvasRef,\r\n      baseCanvasRef.current,\r\n      {\r\n        blur,\r\n        gaussian,\r\n        sharpen,\r\n        texture,\r\n        clarity,\r\n        bgThreshold,\r\n        bgThresholdBlack,\r\n        brightness,\r\n        contrast,\r\n        highlights,\r\n        shadows,\r\n        whites,\r\n        blacks,\r\n        vibrance,\r\n        saturation,\r\n        dehaze,\r\n        hslAdjustments: {}, // Not implementing HSL for now to save space/complexity\r\n      },\r\n      dummyHistory,\r\n      () => {}, // dummy setHistogramData\r\n    );\r\n  }, [\r\n    open,\r\n    blur,\r\n    gaussian,\r\n    sharpen,\r\n    texture,\r\n    clarity,\r\n    bgThreshold,\r\n    bgThresholdBlack,\r\n    brightness,\r\n    contrast,\r\n    highlights,\r\n    shadows,\r\n    whites,\r\n    blacks,\r\n    vibrance,\r\n    saturation,\r\n    dehaze,\r\n  ]);\r\n\r\n  const handleApply = () => {\r\n    if (!canvasRef.current) return;\r\n    const newImg = new Image();\r\n    newImg.src = canvasRef.current.toDataURL();\r\n    newImg.onload = () => {\r\n      onApply(newImg);\r\n    };\r\n  };\r\n\r\n  const SliderRow = ({ label, value, onChange, min = -100, max = 100 }: any) => (\r\n    <div style={{ marginBottom: 8 }}>\r\n      <CustomSlider label={label} value={value} min={min} max={max} onChange={onChange} />\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <Space>\r\n          Layer Effects\r\n          <Button\r\n            type=\"text\"\r\n            icon={<QuestionCircleOutlined />}\r\n            size=\"small\"\r\n            onClick={() => setOpenTour(true)}\r\n          />\r\n        </Space>\r\n      }\r\n      open={open}\r\n      onCancel={onCancel}\r\n      onOk={handleApply}\r\n      width={900}\r\n      okText=\"Apply Effects\"\r\n      style={{ top: 20 }}\r\n      maskClosable={false}\r\n    >\r\n      <div style={{ display: 'flex', gap: 24, height: '60vh' }}>\r\n        {/* Controls */}\r\n        <div ref={controlsRef} style={{ width: 300, overflowY: 'auto', paddingRight: 8 }}>\r\n          <Collapse defaultActiveKey={['1', '2']} ghost size=\"small\">\r\n            <Panel header=\"Light & Color\" key=\"1\">\r\n              <SliderRow label=\"Brightness\" value={brightness} onChange={setBrightness} />\r\n              <SliderRow label=\"Contrast\" value={contrast} onChange={setContrast} />\r\n              <SliderRow label=\"Highlights\" value={highlights} onChange={setHighlights} />\r\n              <SliderRow label=\"Shadows\" value={shadows} onChange={setShadows} />\r\n              <SliderRow label=\"Whites\" value={whites} onChange={setWhites} />\r\n              <SliderRow label=\"Blacks\" value={blacks} onChange={setBlacks} />\r\n              <SliderRow label=\"Vibrance\" value={vibrance} onChange={setVibrance} />\r\n              <SliderRow label=\"Saturation\" value={saturation} onChange={setSaturation} />\r\n            </Panel>\r\n\r\n            <Panel header=\"Detail & Effects\" key=\"2\">\r\n              <SliderRow label=\"Texture\" value={texture} onChange={setTexture} />\r\n              <SliderRow label=\"Clarity\" value={clarity} onChange={setClarity} />\r\n              <SliderRow label=\"Dehaze\" value={dehaze} onChange={setDehaze} />\r\n              <SliderRow label=\"Sharpen\" value={sharpen} onChange={setSharpen} min={0} max={5} />\r\n              <SliderRow label=\"Blur\" value={blur} onChange={setBlur} min={0} max={25} />\r\n              <SliderRow\r\n                label=\"Gaussian\"\r\n                value={gaussian}\r\n                onChange={setGaussian}\r\n                min={0}\r\n                max={20}\r\n              />\r\n            </Panel>\r\n\r\n            <Panel header=\"Remove Background\" key=\"3\">\r\n              <SliderRow\r\n                label=\"Remove White\"\r\n                value={bgThreshold}\r\n                onChange={setBgThreshold}\r\n                min={0}\r\n                max={255}\r\n              />\r\n              <SliderRow\r\n                label=\"Remove Black\"\r\n                value={bgThresholdBlack}\r\n                onChange={setBgThresholdBlack}\r\n                min={0}\r\n                max={255}\r\n              />\r\n            </Panel>\r\n          </Collapse>\r\n        </div>\r\n\r\n        {/* Preview */}\r\n        <div\r\n          ref={previewRef}\r\n          style={{\r\n            flex: 1,\r\n            background: '#f0f0f0',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            border: '1px solid #ddd',\r\n            borderRadius: 4,\r\n            overflow: 'hidden',\r\n            backgroundImage: `linear-gradient(45deg, #ccc 25%, transparent 25%),\r\n            linear-gradient(-45deg, #ccc 25%, transparent 25%),\r\n            linear-gradient(45deg, transparent 75%, #ccc 75%),\r\n            linear-gradient(-45deg, transparent 75%, #ccc 75%)`,\r\n            backgroundSize: '20px 20px',\r\n            backgroundPosition: '0 0, 0 10px, 10px -10px, -10px 0px',\r\n          }}\r\n        >\r\n          <canvas\r\n            ref={canvasRef}\r\n            style={{\r\n              maxWidth: '100%',\r\n              maxHeight: '100%',\r\n              objectFit: 'contain',\r\n            }}\r\n          />\r\n          {/* Hidden base canvas for reference */}\r\n          <canvas ref={baseCanvasRef} style={{ display: 'none' }} />\r\n        </div>\r\n      </div>\r\n\r\n      <Tour open={openTour} onClose={() => setOpenTour(false)} steps={tourSteps} />\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default LayerEffectModal;\r\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport RotateLeftOutlinedSvg from \"@ant-design/icons-svg/es/asn/RotateLeftOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar RotateLeftOutlined = function RotateLeftOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: RotateLeftOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(RotateLeftOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'RotateLeftOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar ScissorOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M567.1 512l318.5-319.3c5-5 1.5-13.7-5.6-13.7h-90.5c-2.1 0-4.2.8-5.6 2.3l-273.3 274-90.2-90.5c12.5-22.1 19.7-47.6 19.7-74.8 0-83.9-68.1-152-152-152s-152 68.1-152 152 68.1 152 152 152c27.7 0 53.6-7.4 75.9-20.3l90 90.3-90.1 90.3A151.04 151.04 0 00288 582c-83.9 0-152 68.1-152 152s68.1 152 152 152 152-68.1 152-152c0-27.2-7.2-52.7-19.7-74.8l90.2-90.5 273.3 274c1.5 1.5 3.5 2.3 5.6 2.3H880c7.1 0 10.7-8.6 5.6-13.7L567.1 512zM288 370c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80zm0 444c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z\" } }] }, \"name\": \"scissor\", \"theme\": \"outlined\" };\nexport default ScissorOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport ScissorOutlinedSvg from \"@ant-design/icons-svg/es/asn/ScissorOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar ScissorOutlined = function ScissorOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: ScissorOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(ScissorOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'ScissorOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar BorderInnerOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M872 476H548V144h-72v332H152c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h324v332h72V548h324c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-166h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 498h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-664h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 498h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM650 216h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm56 592h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-332 0h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-56-592h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-166 0h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm56 592h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-56-426h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm56 260h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"border-inner\", \"theme\": \"outlined\" };\nexport default BorderInnerOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport BorderInnerOutlinedSvg from \"@ant-design/icons-svg/es/asn/BorderInnerOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar BorderInnerOutlined = function BorderInnerOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: BorderInnerOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(BorderInnerOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'BorderInnerOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar SignatureOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"fill-rule\": \"evenodd\", \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M145.71 752c2 0 4-.2 5.98-.5L319.9 722c1.99-.4 3.88-1.3 5.28-2.8l423.91-423.87a9.93 9.93 0 000-14.06L582.88 114.9C581 113 578.5 112 575.82 112s-5.18 1-7.08 2.9L144.82 538.76c-1.5 1.5-2.4 3.29-2.8 5.28l-29.5 168.17a33.59 33.59 0 009.37 29.81c6.58 6.48 14.95 9.97 23.82 9.97m51.75-85.43l15.65-88.92 362.7-362.67 73.28 73.27-362.7 362.67zm401.37-98.64c27.69-14.81 57.29-20.85 85.54-15.52 32.37 6.1 59.72 26.53 78.96 59.4 29.97 51.22 21.64 102.34-18.48 144.26-17.58 18.36-41.07 35.01-70 50.3l-.3.15.86.26a147.88 147.88 0 0041.54 6.2l1.17.01c61.07 0 100.98-22.1 125.28-67.87a36 36 0 0163.6 33.76C869.7 849.1 804.9 885 718.12 885c-47.69 0-91.94-15.03-128.19-41.36l-1.05-.78-1.36.47c-46.18 16-98.74 29.95-155.37 41.94l-2.24.47a1931.1 1931.1 0 01-139.16 23.96 36 36 0 11-9.5-71.38 1860.1 1860.1 0 00133.84-23.04c42.8-9 83-19.13 119.35-30.34l.24-.08-.44-.69c-16.46-26.45-25.86-55.43-26.14-83.24v-1.3c0-49.9 39.55-104.32 90.73-131.7M671 623.17c-10.74-2.03-24.1.7-38.22 8.26-29.55 15.8-52.7 47.64-52.7 68.2 0 18.2 8.9 40.14 24.71 59.73l.24.3 1.22-.52c39.17-16.58 68.49-34.27 85.93-52.18l.64-.67c18.74-19.57 21.39-35.84 8.36-58.1-9.06-15.47-19.03-22.92-30.18-25.02\" } }] }, \"name\": \"signature\", \"theme\": \"outlined\" };\nexport default SignatureOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport SignatureOutlinedSvg from \"@ant-design/icons-svg/es/asn/SignatureOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar SignatureOutlined = function SignatureOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: SignatureOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(SignatureOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'SignatureOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar SaveOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z\" } }] }, \"name\": \"save\", \"theme\": \"outlined\" };\nexport default SaveOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport SaveOutlinedSvg from \"@ant-design/icons-svg/es/asn/SaveOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar SaveOutlined = function SaveOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: SaveOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(SaveOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'SaveOutlined';\n}\nexport default RefIcon;","import React, { RefObject, useMemo } from 'react';\r\nimport Highcharts from 'highcharts';\r\nimport HighchartsReact from 'highcharts-react-official';\r\n\r\ntype RGBHistogramProps = {\r\n  canvasRef: RefObject<HTMLCanvasElement>;\r\n  redData: number[];\r\n  greenData: number[];\r\n  blueData: number[];\r\n};\r\n\r\nconst RGBHistogram: React.FC<RGBHistogramProps> = ({ canvasRef, redData, greenData, blueData }) => {\r\n  const options = useMemo(() => {\r\n    return {\r\n      chart: {\r\n        backgroundColor: '#2b2b2b',\r\n        height: 120,\r\n        spacing: [5, 5, 5, 5],\r\n      },\r\n      title: { text: '' },\r\n      xAxis: {\r\n        title: { text: '', style: { color: '#fff' } },\r\n\r\n        labels: { style: { color: '#fff', fontSize: '5px' } },\r\n        gridLineColor: 'rgba(255,255,255,0.1)',\r\n      },\r\n      yAxis: {\r\n        title: { text: '', style: { color: '#fff' } },\r\n        labels: { style: { color: '#fff', fontSize: '5px' } },\r\n        gridLineColor: 'rgba(255,255,255,0.1)',\r\n      },\r\n      legend: { enabled: false },\r\n      plotOptions: {\r\n        histogram: { binWidth: 4 },\r\n        series: { animation: false, marker: { enabled: false } },\r\n      },\r\n      series: [\r\n        {\r\n          name: 'Red',\r\n          data: redData,\r\n          color: '#ff4444',\r\n          zIndex: 3,\r\n          lineWidth: 1,\r\n          marker: {\r\n            radius: 1,\r\n          },\r\n        },\r\n        {\r\n          name: 'Green',\r\n          data: greenData,\r\n          color: '#44ff44',\r\n          zIndex: 2,\r\n          lineWidth: 1,\r\n          marker: {\r\n            radius: 1,\r\n          },\r\n        },\r\n        {\r\n          name: 'Blue',\r\n          data: blueData,\r\n          color: '#4444ff',\r\n          zIndex: 1,\r\n          lineWidth: 1,\r\n          marker: {\r\n            radius: 1,\r\n          },\r\n        },\r\n      ],\r\n      credits: { enabled: false },\r\n      tooltip: { enabled: false },\r\n    };\r\n  }, [redData, greenData, blueData]);\r\n\r\n  return <HighchartsReact highcharts={Highcharts} options={options} />;\r\n};\r\n\r\nexport default RGBHistogram;\r\n","import React from 'react';\r\nimport { Modal, InputNumber, Radio, Slider } from 'antd';\r\n\r\ntype Props = {\r\n  open: boolean;\r\n  onCancel: () => void;\r\n  onOk: () => void;\r\n  upscaleFactor: number;\r\n  setUpscaleFactor: (v: number) => void;\r\n  presetLocal: 'low' | 'medium' | 'high';\r\n  setPresetLocal: (v: 'low' | 'medium' | 'high') => void;\r\n  sharpenAmount: number;\r\n  setSharpenAmount: (v: number) => void;\r\n  edgeEnhancement: number;\r\n  setEdgeEnhancement: (v: number) => void;\r\n  denoiseAmount: number;\r\n  setDenoiseAmount: (v: number) => void;\r\n};\r\n\r\nconst UpscaleModal: React.FC<Props> = ({\r\n  open,\r\n  onCancel,\r\n  onOk,\r\n  upscaleFactor,\r\n  setUpscaleFactor,\r\n  presetLocal,\r\n  setPresetLocal,\r\n  sharpenAmount,\r\n  setSharpenAmount,\r\n  edgeEnhancement,\r\n  setEdgeEnhancement,\r\n  denoiseAmount,\r\n  setDenoiseAmount,\r\n}) => {\r\n  return (\r\n    <Modal\r\n      title=\"Custom Upscale\"\r\n      open={open}\r\n      onCancel={onCancel}\r\n      onOk={onOk}\r\n      okText=\"Upscale\"\r\n      width={500}\r\n      maskClosable={false}\r\n    >\r\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>\r\n        <div style={{ display: 'flex', gap: 12, alignItems: 'center' }}>\r\n          <div style={{ minWidth: 120 }}>\r\n            <div>Multiplier</div>\r\n            <InputNumber\r\n              min={1}\r\n              max={8}\r\n              step={0.1}\r\n              value={upscaleFactor}\r\n              onChange={(v) => setUpscaleFactor(Number(v || 1))}\r\n            />\r\n          </div>\r\n          <div style={{ flex: 1 }}>\r\n            <div>Smoothing Quality</div>\r\n            <div style={{ marginTop: 8 }}>\r\n              <Radio.Group\r\n                value={presetLocal}\r\n                onChange={(e) => setPresetLocal(e.target.value)}\r\n                options={[\r\n                  { label: 'Low', value: 'low' },\r\n                  { label: 'Medium', value: 'medium' },\r\n                  { label: 'High', value: 'high' },\r\n                ]}\r\n                optionType=\"button\"\r\n                buttonStyle=\"solid\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div style={{ borderTop: '1px solid #f0f0f0', paddingTop: 12 }}>\r\n          <div style={{ marginBottom: 8, fontWeight: 500 }}>Quality Enhancements</div>\r\n\r\n          <div style={{ marginBottom: 12 }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>\r\n              <span>Sharpen</span>\r\n              <span>{sharpenAmount}%</span>\r\n            </div>\r\n            <Slider\r\n              min={0}\r\n              max={100}\r\n              value={sharpenAmount}\r\n              onChange={setSharpenAmount}\r\n              tooltip={{ formatter: (v) => `${v}%` }}\r\n            />\r\n          </div>\r\n\r\n          <div style={{ marginBottom: 12 }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>\r\n              <span>Edge Enhancement</span>\r\n              <span>{edgeEnhancement}%</span>\r\n            </div>\r\n            <Slider\r\n              min={0}\r\n              max={100}\r\n              value={edgeEnhancement}\r\n              onChange={setEdgeEnhancement}\r\n              tooltip={{ formatter: (v) => `${v}%` }}\r\n            />\r\n          </div>\r\n\r\n          <div style={{ marginBottom: 12 }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>\r\n              <span>Denoise</span>\r\n              <span>{denoiseAmount}%</span>\r\n            </div>\r\n            <Slider\r\n              min={0}\r\n              max={100}\r\n              value={denoiseAmount}\r\n              onChange={setDenoiseAmount}\r\n              tooltip={{ formatter: (v) => `${v}%` }}\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default UpscaleModal;\r\n","// This icon file is generated automatically.\nvar InfoCircleOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z\" } }, { \"tag\": \"path\", \"attrs\": { \"d\": \"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"info-circle\", \"theme\": \"outlined\" };\nexport default InfoCircleOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport InfoCircleOutlinedSvg from \"@ant-design/icons-svg/es/asn/InfoCircleOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar InfoCircleOutlined = function InfoCircleOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: InfoCircleOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(InfoCircleOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'InfoCircleOutlined';\n}\nexport default RefIcon;","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport LoadingOutlinedSvg from \"@ant-design/icons-svg/es/asn/LoadingOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar LoadingOutlined = function LoadingOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: LoadingOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(LoadingOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'LoadingOutlined';\n}\nexport default RefIcon;","import React, { useState } from 'react';\r\nimport {\r\n  Modal,\r\n  Checkbox,\r\n  Radio,\r\n  Space,\r\n  Tooltip,\r\n  InputNumber,\r\n  Button,\r\n  Tabs,\r\n  Spin,\r\n  Divider,\r\n} from 'antd';\r\nimport {\r\n  InfoCircleOutlined,\r\n  DownloadOutlined,\r\n  LoadingOutlined,\r\n  CopyOutlined,\r\n} from '@ant-design/icons';\r\nimport { handleCopy } from '@/helpers';\r\n\r\ntype Props = {\r\n  open: boolean;\r\n  onCancel: () => void;\r\n  onExportImage: (format: 'png' | 'jpg', includeOverlays: boolean) => void;\r\n  onExportSvg: () => void;\r\n  canvasRef: React.RefObject<HTMLCanvasElement>;\r\n  processing: boolean;\r\n  svgContent: string | null;\r\n  scale: number;\r\n  setScale: (v: number) => void;\r\n  ltres: number;\r\n  setLtres: (v: number) => void;\r\n  qtres: number;\r\n  setQtres: (v: number) => void;\r\n  pathomit: number;\r\n  setPathomit: (v: number) => void;\r\n  colorsampling: number;\r\n  setColorsampling: (v: number) => void;\r\n  strokewidth: number;\r\n  setStrokewidth: (v: number) => void;\r\n  onDownload: (content: string, filename: string) => void;\r\n  getSvgModalWidth: () => number;\r\n  getSvgModalHeight: () => number | undefined;\r\n};\r\n\r\nconst ExportModal: React.FC<Props> = ({\r\n  open,\r\n  onCancel,\r\n  onExportImage,\r\n  onExportSvg,\r\n  canvasRef,\r\n  processing,\r\n  svgContent,\r\n  scale,\r\n  setScale,\r\n  ltres,\r\n  setLtres,\r\n  qtres,\r\n  setQtres,\r\n  pathomit,\r\n  setPathomit,\r\n  colorsampling,\r\n  setColorsampling,\r\n  strokewidth,\r\n  setStrokewidth,\r\n  onDownload,\r\n  getSvgModalWidth,\r\n  getSvgModalHeight,\r\n}) => {\r\n  const [exportType, setExportType] = useState<'image' | 'svg'>('image');\r\n  const [imageFormat, setImageFormat] = useState<'png' | 'jpg'>('png');\r\n  const [includeOverlays, setIncludeOverlays] = useState(true);\r\n\r\n  const svgBase64 = svgContent ? btoa(unescape(encodeURIComponent(svgContent))) : '';\r\n  const svgDataURI = svgContent ? `data:image/svg+xml;base64,${svgBase64}` : '';\r\n\r\n  const handleExport = () => {\r\n    if (exportType === 'image') {\r\n      onExportImage(imageFormat, includeOverlays);\r\n      onCancel();\r\n    } else {\r\n      onExportSvg();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Export Options\"\r\n      open={open}\r\n      onCancel={onCancel}\r\n      onOk={handleExport}\r\n      okText={exportType === 'image' ? 'Export' : 'Convert to SVG'}\r\n      okButtonProps={{ loading: processing && exportType === 'svg' }}\r\n      width={exportType === 'svg' && svgContent ? getSvgModalWidth() : 500}\r\n      style={exportType === 'svg' && svgContent ? { height: getSvgModalHeight() } : undefined}\r\n    >\r\n      <Space direction=\"vertical\" style={{ width: '100%' }} size=\"large\">\r\n        {/* Export Type Selection */}\r\n        <div>\r\n          <div style={{ marginBottom: 12, fontWeight: 500 }}>Export Format</div>\r\n          <Radio.Group\r\n            value={exportType}\r\n            onChange={(e) => setExportType(e.target.value)}\r\n            buttonStyle=\"solid\"\r\n          >\r\n            <Radio.Button value=\"image\">Image (PNG/JPG)</Radio.Button>\r\n            <Radio.Button value=\"svg\">SVG</Radio.Button>\r\n          </Radio.Group>\r\n        </div>\r\n\r\n        <Divider style={{ margin: '8px 0' }} />\r\n\r\n        {/* Image Export Options */}\r\n        {exportType === 'image' && (\r\n          <div>\r\n            <div style={{ marginBottom: 12, fontWeight: 500 }}>Image Options</div>\r\n            <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n              <Radio.Group\r\n                value={imageFormat}\r\n                onChange={(e) => setImageFormat(e.target.value)}\r\n                buttonStyle=\"solid\"\r\n              >\r\n                <Radio.Button value=\"png\">PNG</Radio.Button>\r\n                <Radio.Button value=\"jpg\">JPG</Radio.Button>\r\n              </Radio.Group>\r\n\r\n              <Checkbox\r\n                checked={includeOverlays}\r\n                onChange={(e) => setIncludeOverlays(e.target.checked)}\r\n              >\r\n                Include overlay layers\r\n              </Checkbox>\r\n              <div style={{ fontSize: 12, color: '#666', marginLeft: 24, marginTop: -8 }}>\r\n                {includeOverlays\r\n                  ? 'Export will include all visible layers and text overlays'\r\n                  : 'Export will only include the base image without layers'}\r\n              </div>\r\n            </Space>\r\n          </div>\r\n        )}\r\n\r\n        {/* SVG Export Options */}\r\n        {exportType === 'svg' && (\r\n          <div>\r\n            <div style={{ marginBottom: 12, fontWeight: 500 }}>SVG Tracing Options</div>\r\n            <Space wrap size=\"small\">\r\n              <Tooltip title=\"Scale factor for the SVG output. Higher = larger SVG.\">\r\n                <Space size={4}>\r\n                  <label>Scale</label>\r\n                  <InfoCircleOutlined style={{ fontSize: 12, color: '#999' }} />\r\n                  <InputNumber\r\n                    size=\"small\"\r\n                    min={0.1}\r\n                    step={0.1}\r\n                    value={scale}\r\n                    onChange={(val) => setScale(val || 1)}\r\n                    style={{ width: 70 }}\r\n                  />\r\n                </Space>\r\n              </Tooltip>\r\n              <Tooltip title=\"Error threshold for line detection. Lower = more precise lines.\">\r\n                <Space size={4}>\r\n                  <label>ltres</label>\r\n                  <InfoCircleOutlined style={{ fontSize: 12, color: '#999' }} />\r\n                  <InputNumber\r\n                    size=\"small\"\r\n                    min={0}\r\n                    value={ltres}\r\n                    onChange={(val) => setLtres(val || 1)}\r\n                    style={{ width: 70 }}\r\n                  />\r\n                </Space>\r\n              </Tooltip>\r\n              <Tooltip title=\"Error threshold for curve detection. Lower = more precise curves.\">\r\n                <Space size={4}>\r\n                  <label>qtres</label>\r\n                  <InfoCircleOutlined style={{ fontSize: 12, color: '#999' }} />\r\n                  <InputNumber\r\n                    size=\"small\"\r\n                    min={0}\r\n                    value={qtres}\r\n                    onChange={(val) => setQtres(val || 1)}\r\n                    style={{ width: 70 }}\r\n                  />\r\n                </Space>\r\n              </Tooltip>\r\n              <Tooltip title=\"Minimum path length to keep. Higher = simpler SVG with fewer tiny paths.\">\r\n                <Space size={4}>\r\n                  <label>Pathomit</label>\r\n                  <InfoCircleOutlined style={{ fontSize: 12, color: '#999' }} />\r\n                  <InputNumber\r\n                    size=\"small\"\r\n                    min={0}\r\n                    value={pathomit}\r\n                    onChange={(val) => setPathomit(val || 0)}\r\n                    style={{ width: 70 }}\r\n                  />\r\n                </Space>\r\n              </Tooltip>\r\n              <Tooltip title=\"Pixel sampling interval for colors. 1 = every pixel, higher = faster but less accurate colors.\">\r\n                <Space size={4}>\r\n                  <label>ColorSampling</label>\r\n                  <InfoCircleOutlined style={{ fontSize: 12, color: '#999' }} />\r\n                  <InputNumber\r\n                    size=\"small\"\r\n                    min={1}\r\n                    value={colorsampling}\r\n                    onChange={(val) => setColorsampling(val || 1)}\r\n                    style={{ width: 70 }}\r\n                  />\r\n                </Space>\r\n              </Tooltip>\r\n              <Tooltip title=\"Stroke width in the output SVG.\">\r\n                <Space size={4}>\r\n                  <label>StrokeWidth</label>\r\n                  <InfoCircleOutlined style={{ fontSize: 12, color: '#999' }} />\r\n                  <InputNumber\r\n                    size=\"small\"\r\n                    min={0}\r\n                    value={strokewidth}\r\n                    onChange={(val) => setStrokewidth(val || 1)}\r\n                    style={{ width: 70 }}\r\n                  />\r\n                </Space>\r\n              </Tooltip>\r\n            </Space>\r\n\r\n            {/* SVG Results */}\r\n            {svgContent && (\r\n              <>\r\n                <Divider style={{ margin: '16px 0' }} />\r\n                <div style={{ marginBottom: 12, fontWeight: 500 }}>SVG Results</div>\r\n                <Tabs defaultActiveKey=\"svg\" type=\"card\" size=\"small\">\r\n                  <Tabs.TabPane tab=\"Preview\" key=\"svg\">\r\n                    <Space style={{ marginBottom: 8 }}>\r\n                      <Button\r\n                        size=\"small\"\r\n                        onClick={() => onDownload(svgContent, 'image.svg')}\r\n                        icon={<DownloadOutlined />}\r\n                      >\r\n                        Download\r\n                      </Button>\r\n                      <Button\r\n                        size=\"small\"\r\n                        onClick={() => handleCopy(svgContent, 'SVG copied!')}\r\n                        icon={<CopyOutlined />}\r\n                      >\r\n                        Copy\r\n                      </Button>\r\n                    </Space>\r\n                    <div\r\n                      style={{\r\n                        border: '1px solid #eee',\r\n                        borderRadius: 6,\r\n                        padding: 12,\r\n                        overflow: 'auto',\r\n                        maxHeight: canvasRef.current ? canvasRef.current.height : 400,\r\n                      }}\r\n                    >\r\n                      <div dangerouslySetInnerHTML={{ __html: svgContent }} />\r\n                    </div>\r\n                  </Tabs.TabPane>\r\n\r\n                  <Tabs.TabPane tab=\"Base64\" key=\"base64\">\r\n                    <Space style={{ marginBottom: 8 }}>\r\n                      <Button\r\n                        size=\"small\"\r\n                        onClick={() => handleCopy(svgBase64, 'Base64 copied!')}\r\n                        icon={<CopyOutlined />}\r\n                      >\r\n                        Copy\r\n                      </Button>\r\n                      <Button\r\n                        size=\"small\"\r\n                        onClick={() => onDownload(svgBase64, 'image-base64.txt')}\r\n                        icon={<DownloadOutlined />}\r\n                      >\r\n                        Download\r\n                      </Button>\r\n                    </Space>\r\n                    <pre\r\n                      style={{\r\n                        background: '#f7f7f7',\r\n                        padding: 12,\r\n                        borderRadius: 6,\r\n                        whiteSpace: 'pre-wrap',\r\n                        wordBreak: 'break-word',\r\n                        maxHeight: 300,\r\n                        overflow: 'auto',\r\n                        fontSize: 12,\r\n                      }}\r\n                    >\r\n                      {svgBase64}\r\n                    </pre>\r\n                  </Tabs.TabPane>\r\n\r\n                  <Tabs.TabPane tab=\"Data URI\" key=\"datauri\">\r\n                    <Space style={{ marginBottom: 8 }}>\r\n                      <Button\r\n                        size=\"small\"\r\n                        onClick={() => handleCopy(svgDataURI, 'Data URI copied!')}\r\n                        icon={<CopyOutlined />}\r\n                      >\r\n                        Copy\r\n                      </Button>\r\n                      <Button\r\n                        size=\"small\"\r\n                        onClick={() => onDownload(svgDataURI, 'image-datauri.txt')}\r\n                        icon={<DownloadOutlined />}\r\n                      >\r\n                        Download\r\n                      </Button>\r\n                    </Space>\r\n                    <pre\r\n                      style={{\r\n                        background: '#f7f7f7',\r\n                        padding: 12,\r\n                        borderRadius: 6,\r\n                        whiteSpace: 'pre-wrap',\r\n                        wordBreak: 'break-word',\r\n                        maxHeight: 300,\r\n                        overflow: 'auto',\r\n                        fontSize: 12,\r\n                      }}\r\n                    >\r\n                      {svgDataURI}\r\n                    </pre>\r\n                  </Tabs.TabPane>\r\n                </Tabs>\r\n              </>\r\n            )}\r\n\r\n            {processing && (\r\n              <div style={{ textAlign: 'center', padding: 24 }}>\r\n                <Spin\r\n                  indicator={<LoadingOutlined style={{ fontSize: 32 }} spin />}\r\n                  tip=\"Converting to SVG...\"\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </Space>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ExportModal;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Button, Space, Tooltip, message, Collapse } from 'antd';\r\nimport {\r\n  UndoOutlined,\r\n  RedoOutlined,\r\n  RotateLeftOutlined,\r\n  RotateRightOutlined,\r\n  SwapOutlined,\r\n  ScissorOutlined,\r\n  ExportOutlined,\r\n  CopyOutlined,\r\n  EditOutlined,\r\n  DragOutlined,\r\n  FontColorsOutlined,\r\n  BorderInnerOutlined,\r\n  SignatureOutlined,\r\n  RetweetOutlined,\r\n  BgColorsOutlined,\r\n  SaveOutlined,\r\n  DownloadOutlined,\r\n} from '@ant-design/icons';\r\nimport ImageTracer from 'imagetracerjs';\r\nimport {\r\n  applyEffects,\r\n  copyToClipboard,\r\n  extractRGBHistogram,\r\n  flipH,\r\n  flipV,\r\n  rotate,\r\n  applyInvertColors,\r\n} from '../../utils/helpers';\r\nimport { CustomSlider } from './CustomSlider';\r\nimport { HistoryController } from '../../hooks/useHistory';\r\nimport RGBHistogram from './RGBHistogram';\r\nimport UpscaleModal from './UpscaleModal';\r\nimport ExportModal from './ExportModal';\r\nimport { Tool } from './types';\r\n\r\nconst { Panel } = Collapse;\r\n\r\ntype Props = {\r\n  canvasRef: React.RefObject<HTMLCanvasElement>;\r\n  baseCanvas?: HTMLCanvasElement | null;\r\n  history: HistoryController;\r\n  setTool: (value: React.SetStateAction<Tool>) => void;\r\n  brightness: number;\r\n  setBrightness: (v: number) => void;\r\n  contrast: number;\r\n  setContrast: (v: number) => void;\r\n  blur: number;\r\n  setBlur: (v: number) => void;\r\n  gaussian: number;\r\n  setGaussian: (v: number) => void;\r\n  sharpen: number;\r\n  setSharpen: (v: number) => void;\r\n  bgThreshold: number;\r\n  setBgThreshold: (v: number) => void;\r\n  bgThresholdBlack: number;\r\n  setBgThresholdBlack: (v: number) => void;\r\n  setShowPerspectiveModal: (show: boolean) => void;\r\n  dpiMeasured?: number | null;\r\n  setDpiMeasured?: (v: number | null) => void;\r\n  exportImage: (\r\n    jpg: boolean,\r\n    canvasRef: React.RefObject<HTMLCanvasElement>,\r\n    callback?: (blob: Blob) => void,\r\n    includeOverlays?: boolean,\r\n  ) => void;\r\n  onExport?: (blob: Blob) => void;\r\n  overlayRef: React.RefObject<HTMLCanvasElement>;\r\n  texture: number;\r\n  setTexture: (v: number) => void;\r\n  clarity: number;\r\n  setClarity: (v: number) => void;\r\n  highlights: number;\r\n  setHighlights: (v: number) => void;\r\n  shadows: number;\r\n  setShadows: (v: number) => void;\r\n  whites: number;\r\n  setWhites: (v: number) => void;\r\n  blacks: number;\r\n  setBlacks: (v: number) => void;\r\n  vibrance: number;\r\n  setVibrance: (v: number) => void;\r\n  saturation: number;\r\n  setSaturation: (v: number) => void;\r\n  dehaze: number;\r\n  setDehaze: (v: number) => void;\r\n  hslAdjustments: Record<string, { h?: number; s?: number; l?: number }>;\r\n  setHslAdjustments: (name: string, values: Partial<{ h: number; s: number; l: number }>) => void;\r\n  upscaleImage?: (\r\n    factor: number,\r\n    preset?: 'low' | 'medium' | 'high',\r\n    qualityOptions?: { sharpen?: number; edgeEnhancement?: number; denoise?: number },\r\n  ) => void;\r\n  onColorRemovalToolClick?: () => void;\r\n  showExportModal: boolean;\r\n  setShowExportModal: (v: boolean) => void;\r\n  onSave?: () => void;\r\n};\r\n\r\nconst SideEditorToolbar: React.FC<Props> = ({\r\n  canvasRef,\r\n  baseCanvas,\r\n  history,\r\n\r\n  setTool,\r\n  brightness,\r\n  setBrightness,\r\n  contrast,\r\n  setContrast,\r\n  blur,\r\n  setBlur,\r\n  gaussian,\r\n  setGaussian,\r\n  sharpen,\r\n  setSharpen,\r\n  bgThreshold,\r\n  setBgThreshold,\r\n  bgThresholdBlack,\r\n  setBgThresholdBlack,\r\n  setShowPerspectiveModal,\r\n  dpiMeasured,\r\n  setDpiMeasured,\r\n  exportImage,\r\n  onExport,\r\n  overlayRef,\r\n  texture,\r\n  setTexture,\r\n  clarity,\r\n  setClarity,\r\n  highlights,\r\n  setHighlights,\r\n  shadows,\r\n  setShadows,\r\n  whites,\r\n  setWhites,\r\n  blacks,\r\n  setBlacks,\r\n  vibrance,\r\n  setVibrance,\r\n  saturation,\r\n  setSaturation,\r\n  dehaze,\r\n  setDehaze,\r\n  hslAdjustments,\r\n  setHslAdjustments,\r\n  upscaleImage,\r\n  onColorRemovalToolClick,\r\n  showExportModal,\r\n  setShowExportModal,\r\n  onSave,\r\n}) => {\r\n  const [activeColor, setActiveColor] = useState('red');\r\n  const [showUpscaleModal, setShowUpscaleModal] = useState(false);\r\n  const [upscaleFactor, setUpscaleFactor] = useState<number>(2);\r\n  const [presetLocal, setPresetLocal] = useState<'low' | 'medium' | 'high'>('medium');\r\n  const [sharpenAmount, setSharpenAmount] = useState<number>(0);\r\n  const [edgeEnhancement, setEdgeEnhancement] = useState<number>(0);\r\n  const [denoiseAmount, setDenoiseAmount] = useState<number>(0);\r\n\r\n  // SVG conversion states\r\n  const [svgContent, setSvgContent] = useState<string | null>(null);\r\n  const [processing, setProcessing] = useState(false);\r\n  const [scale, setScale] = useState(1);\r\n  const [ltres, setLtres] = useState(1);\r\n  const [qtres, setQtres] = useState(1);\r\n  const [pathomit, setPathomit] = useState(8);\r\n  const [colorsampling, setColorsampling] = useState(2);\r\n  const [strokewidth, setStrokewidth] = useState(1);\r\n  const [histogramData, setHistogramData] = useState<{\r\n    red: number[];\r\n    green: number[];\r\n    blue: number[];\r\n  }>({\r\n    red: [],\r\n    green: [],\r\n    blue: [],\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (canvasRef.current) {\r\n      const extracted = extractRGBHistogram(canvasRef.current);\r\n      setHistogramData(extracted);\r\n    }\r\n  }, [canvasRef.current]);\r\n\r\n  const colorSwatches = [\r\n    { name: 'red', color: '#ff4d4d' },\r\n    { name: 'orange', color: '#ffa500' },\r\n    { name: 'yellow', color: '#ffd700' },\r\n    { name: 'green', color: '#00c853' },\r\n    { name: 'aqua', color: '#00e5ff' },\r\n    { name: 'blue', color: '#2979ff' },\r\n    { name: 'purple', color: '#9c27b0' },\r\n    { name: 'magenta', color: '#ff00aa' },\r\n  ];\r\n\r\n  const getSliderGradient = (activeColor: string, type: 'h' | 's' | 'l') => {\r\n    const base = colorSwatches.find((c) => c.name === activeColor)?.color || '#ffffff';\r\n\r\n    const index = colorSwatches.findIndex((c) => c.name === activeColor);\r\n\r\n    // If not found, default to grayscale\r\n    if (index === -1) return '#555';\r\n\r\n    const current = colorSwatches[index].color;\r\n    const left = colorSwatches[index - 1]?.color || current; // If first, use itself\r\n    const right = colorSwatches[index + 1]?.color || current; // If last, use itself\r\n\r\n    switch (type) {\r\n      case 'h':\r\n        return `linear-gradient(90deg, ${left}, ${current}, ${right})`;\r\n      case 's':\r\n        return `linear-gradient(90deg, gray, ${base})`;\r\n      case 'l':\r\n        return `linear-gradient(90deg, black, ${base}, white)`;\r\n      default:\r\n        return '#555';\r\n    }\r\n  };\r\n\r\n  const toneSliders = [\r\n    { key: 'texture', label: 'Texture', value: texture, setter: setTexture },\r\n    { key: 'clarity', label: 'Clarity', value: clarity, setter: setClarity },\r\n    { key: 'highlights', label: 'Highlights', value: highlights, setter: setHighlights },\r\n    { key: 'shadows', label: 'Shadows', value: shadows, setter: setShadows },\r\n    { key: 'whites', label: 'Whites', value: whites, setter: setWhites },\r\n    { key: 'blacks', label: 'Blacks', value: blacks, setter: setBlacks },\r\n  ];\r\n\r\n  const effectSliders = [\r\n    { key: 'blur', label: 'Box Blur', min: 0, max: 25, value: blur, setter: setBlur },\r\n    { key: 'gaussian', label: 'Gaussian', min: 0, max: 20, value: gaussian, setter: setGaussian },\r\n    { key: 'sharpen', label: 'Sharpen', min: 0, max: 5, value: sharpen, setter: setSharpen },\r\n    {\r\n      key: 'bgThreshold',\r\n      label: 'Remove White',\r\n      min: 0,\r\n      max: 255,\r\n      value: bgThreshold,\r\n      setter: setBgThreshold,\r\n    },\r\n    {\r\n      key: 'bgThresholdBlack',\r\n      label: 'Remove Black',\r\n      min: 0,\r\n      max: 255,\r\n      value: bgThresholdBlack,\r\n      setter: setBgThresholdBlack,\r\n    },\r\n  ];\r\n\r\n  const apply = () =>\r\n    applyEffects(\r\n      canvasRef,\r\n      baseCanvas,\r\n      {\r\n        blur,\r\n        gaussian,\r\n        sharpen,\r\n        texture,\r\n        clarity,\r\n        bgThreshold,\r\n        bgThresholdBlack,\r\n        brightness,\r\n        contrast,\r\n        highlights,\r\n        shadows,\r\n        whites,\r\n        blacks,\r\n        vibrance,\r\n        saturation,\r\n        dehaze,\r\n        hslAdjustments,\r\n      },\r\n      history,\r\n      setHistogramData,\r\n    );\r\n\r\n  const handleCustomUpscale = () => {\r\n    setTool('upscale');\r\n    const qualityOptions = {\r\n      sharpen: sharpenAmount,\r\n      edgeEnhancement: edgeEnhancement,\r\n      denoise: denoiseAmount,\r\n    };\r\n    upscaleImage?.(upscaleFactor, presetLocal, qualityOptions);\r\n    setShowUpscaleModal(false);\r\n  };\r\n\r\n  const handleExportClick = () => {\r\n    setShowExportModal(true);\r\n  };\r\n\r\n  const handleExportImage = (format: 'png' | 'jpg', includeOverlays: boolean) => {\r\n    exportImage(format === 'jpg', canvasRef, onExport, includeOverlays);\r\n  };\r\n\r\n  const handleConvertToSvg = () => {\r\n    if (!canvasRef.current) {\r\n      message.error('No image to convert');\r\n      return;\r\n    }\r\n\r\n    setProcessing(true);\r\n    const dataUrl = canvasRef.current.toDataURL();\r\n\r\n    try {\r\n      ImageTracer.imageToSVG(\r\n        dataUrl,\r\n        (svgString) => {\r\n          setSvgContent(svgString);\r\n          setProcessing(false);\r\n          message.success('Image converted to SVG successfully!');\r\n        },\r\n        { scale, ltres, qtres, pathomit, colorsampling, strokewidth },\r\n      );\r\n    } catch (err: any) {\r\n      console.error(err);\r\n      setProcessing(false);\r\n      message.error('Error converting image to SVG.');\r\n    }\r\n  };\r\n\r\n  const getSvgModalWidth = () => {\r\n    if (!canvasRef.current) return 700;\r\n    const canvasWidth = canvasRef.current.width;\r\n    const minWidth = 500;\r\n    const maxWidth = window.innerWidth * 0.9;\r\n    return Math.min(Math.max(canvasWidth + 100, minWidth), maxWidth);\r\n  };\r\n\r\n  const getSvgModalHeight = () => {\r\n    if (!canvasRef.current) return undefined;\r\n    const canvasHeight = canvasRef.current.height;\r\n    const maxHeight = window.innerHeight * 0.85;\r\n    return Math.min(canvasHeight + 300, maxHeight);\r\n  };\r\n\r\n  const handleDownloadSvg = (content: string, filename: string) => {\r\n    const blob = new Blob([content], { type: 'image/svg+xml' });\r\n    const link = document.createElement('a');\r\n    link.href = URL.createObjectURL(blob);\r\n    link.download = filename;\r\n    link.click();\r\n  };\r\n\r\n  return (\r\n    <div style={{ width: 260 }}>\r\n      <Collapse\r\n        defaultActiveKey={['histogram', 'basic', 'lights', 'effects']}\r\n        ghost\r\n        expandIconPosition=\"end\"\r\n      >\r\n        <Panel header=\"Histogram\" key=\"histogram\">\r\n          <RGBHistogram\r\n            canvasRef={canvasRef}\r\n            redData={histogramData.red}\r\n            greenData={histogramData.green}\r\n            blueData={histogramData.blue}\r\n          />\r\n        </Panel>\r\n\r\n        {/* 🔧 Basic Tools */}\r\n        <Panel header=\"🛠 Basic\" key=\"basic\">\r\n          <Space wrap>\r\n            <Tooltip title=\"Undo (Ctrl+Z)\">\r\n              <Button icon={<UndoOutlined />} onClick={history.undo} />\r\n            </Tooltip>\r\n            <Tooltip title=\"Redo (Ctrl+Shift+Z)\">\r\n              <Button icon={<RedoOutlined />} onClick={history.redo} />\r\n            </Tooltip>\r\n            <Tooltip title=\"Rotate left\">\r\n              <Button\r\n                icon={<RotateLeftOutlined />}\r\n                onClick={() => rotate(-90, canvasRef, overlayRef, history)}\r\n              />\r\n            </Tooltip>\r\n            <Tooltip title=\"Rotate right (R)\">\r\n              <Button\r\n                icon={<RotateRightOutlined />}\r\n                onClick={() => rotate(90, canvasRef, overlayRef, history)}\r\n              />\r\n            </Tooltip>\r\n            <Tooltip title=\"Flip horizontal\">\r\n              <Button icon={<SwapOutlined />} onClick={() => flipH(canvasRef, history)} />\r\n            </Tooltip>\r\n            <Tooltip title=\"Flip vertical\">\r\n              <Button\r\n                icon={<SwapOutlined rotate={90} />}\r\n                onClick={() => flipV(canvasRef, history)}\r\n              />\r\n            </Tooltip>\r\n\r\n            <Tooltip title=\"Crop (C)\">\r\n              <Button icon={<ScissorOutlined />} onClick={() => setTool('crop')} />\r\n            </Tooltip>\r\n            <Tooltip title=\"Perspective\">\r\n              <Button\r\n                icon={<BorderInnerOutlined />}\r\n                onClick={() => {\r\n                  setShowPerspectiveModal(true);\r\n                  setTool('perspective');\r\n                }}\r\n              />\r\n            </Tooltip>\r\n            <Tooltip title=\"Brush (B)\">\r\n              <Button icon={<SignatureOutlined />} onClick={() => setTool('draw')} />\r\n            </Tooltip>\r\n            <Tooltip title=\"Text (T)\">\r\n              <Button icon={<FontColorsOutlined />} onClick={() => setTool('text')} />\r\n            </Tooltip>\r\n            <Tooltip title=\"Layer (V)\">\r\n              <Button icon={<DragOutlined />} onClick={() => setTool('layer')} />\r\n            </Tooltip>\r\n            <Tooltip title=\"Invert Colors (Ctrl+I)\">\r\n              <Button\r\n                icon={<RetweetOutlined />}\r\n                onClick={() => applyInvertColors(canvasRef, history)}\r\n              />\r\n            </Tooltip>\r\n            <Tooltip title=\"Remove color\">\r\n              <Button icon={<BgColorsOutlined />} onClick={onColorRemovalToolClick} />\r\n            </Tooltip>\r\n          </Space>\r\n        </Panel>\r\n\r\n        {/* 🔆 Light */}\r\n        <Panel header=\"🔆 Light\" key=\"lights\">\r\n          <CustomSlider\r\n            key={'brightness'}\r\n            label={'Brightness'}\r\n            value={brightness}\r\n            min={-150}\r\n            max={150}\r\n            onChange={setBrightness}\r\n            onChangeComplete={apply}\r\n          />\r\n          <CustomSlider\r\n            key={'contrast'}\r\n            label={'Contrast'}\r\n            value={contrast}\r\n            min={-100}\r\n            max={100}\r\n            onChange={setContrast}\r\n            onChangeComplete={apply}\r\n          />\r\n        </Panel>\r\n\r\n        {/* 🎨 Color & HSL */}\r\n        <Panel header=\"🎨 Color\" key=\"color\">\r\n          <CustomSlider\r\n            key={'vibrance'}\r\n            label={'Vibrance'}\r\n            value={vibrance}\r\n            min={-100}\r\n            max={100}\r\n            onChange={setVibrance}\r\n            onChangeComplete={apply}\r\n          />\r\n\r\n          <CustomSlider\r\n            key={'saturation'}\r\n            label={'Saturation'}\r\n            value={saturation}\r\n            min={-100}\r\n            max={100}\r\n            onChange={setSaturation}\r\n            onChangeComplete={apply}\r\n          />\r\n\r\n          <CustomSlider\r\n            key={'dehaze'}\r\n            label={'Dehaze'}\r\n            value={dehaze}\r\n            min={-100}\r\n            max={100}\r\n            onChange={setDehaze}\r\n            onChangeComplete={apply}\r\n          />\r\n\r\n          {/* HSL Picker */}\r\n          <div style={{ marginTop: 10 }}>HSL Mixer</div>\r\n          <div style={{ display: 'flex', gap: 8, marginBottom: 10 }}>\r\n            {colorSwatches.map(({ name, color }) => (\r\n              <Tooltip title={name.toUpperCase()}>\r\n                <div\r\n                  key={name}\r\n                  onClick={() => setActiveColor(name)}\r\n                  style={{\r\n                    width: 20,\r\n                    height: 20,\r\n                    borderRadius: '50%',\r\n                    background: color,\r\n                    border: activeColor === name ? '2px solid white' : '1px solid #555',\r\n                    boxShadow: activeColor === name ? '0 0 6px rgba(255,255,255,0.8)' : '',\r\n                    cursor: 'pointer',\r\n                  }}\r\n                />\r\n              </Tooltip>\r\n            ))}\r\n          </div>\r\n          {/* <div>{activeColor.toUpperCase()}</div> */}\r\n\r\n          {['Hue', 'Saturation', 'Luminance'].map((label) => {\r\n            const key = label[0].toLowerCase(); // h/s/l\r\n            return (\r\n              <CustomSlider\r\n                key={label}\r\n                label={label}\r\n                value={hslAdjustments[activeColor]?.[key] ?? 0}\r\n                min={label === 'Hue' ? -180 : -100}\r\n                max={label === 'Hue' ? 180 : 100}\r\n                onChange={(v) => setHslAdjustments(activeColor, { [key]: v })}\r\n                onChangeComplete={apply}\r\n                gradient={getSliderGradient(activeColor, key as 'h' | 's' | 'l')}\r\n              />\r\n            );\r\n          })}\r\n\r\n          <Button size=\"small\" onClick={() => setHslAdjustments(activeColor, { h: 0, s: 0, l: 0 })}>\r\n            Reset\r\n          </Button>\r\n        </Panel>\r\n\r\n        {/* ✨ Effects */}\r\n        <Panel header=\"✨ Effects\" key=\"effects\">\r\n          {toneSliders.map(({ key, label, value, setter }) => (\r\n            <CustomSlider\r\n              key={key}\r\n              label={label}\r\n              value={value}\r\n              min={-100}\r\n              max={100}\r\n              onChange={setter}\r\n              onChangeComplete={apply}\r\n            />\r\n          ))}\r\n        </Panel>\r\n\r\n        {/* 🎭 Filters */}\r\n        <Panel header=\"🎭 Filters\" key=\"filters\">\r\n          {effectSliders.map(({ key, label, min, max, value, setter }) => (\r\n            <CustomSlider\r\n              key={key}\r\n              label={label}\r\n              value={value}\r\n              min={min}\r\n              max={max}\r\n              onChange={setter}\r\n              onChangeComplete={apply}\r\n            />\r\n          ))}\r\n        </Panel>\r\n\r\n        {/* 📐 Crop / Ruler */}\r\n        <Panel header=\"📐 Crop & Ruler\" key=\"crop\">\r\n          <Space>\r\n            <Button icon={<ScissorOutlined />} onClick={() => setTool('crop')}>\r\n              Crop\r\n            </Button>\r\n            <Button\r\n              onClick={() => {\r\n                setShowPerspectiveModal(true);\r\n                setTool('perspective');\r\n              }}\r\n            >\r\n              Perspective\r\n            </Button>\r\n          </Space>\r\n\r\n          <div style={{ marginTop: 10 }}>Ruler</div>\r\n          <Space>\r\n            <Button onClick={() => setTool('ruler')}>📏 Ruler</Button>\r\n            <Button\r\n              onClick={() => {\r\n                setDpiMeasured?.(null);\r\n                message.info('Ruler cleared');\r\n              }}\r\n            >\r\n              Clear\r\n            </Button>\r\n          </Space>\r\n          {dpiMeasured && <div>Estimated DPI: {dpiMeasured}</div>}\r\n        </Panel>\r\n\r\n        {/* Custom Upscale Modal launcher */}\r\n        <Panel header=\"🔼 Upscale Options\" key=\"upscaleOptions\">\r\n          <Button\r\n            onClick={() => {\r\n              setShowUpscaleModal(true);\r\n            }}\r\n          >\r\n            Custom Upscale...\r\n          </Button>\r\n        </Panel>\r\n\r\n        {/* 📤 Export */}\r\n        <Panel header=\"📤 Export\" key=\"export\">\r\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n            <Button\r\n              type=\"primary\"\r\n              icon={<SaveOutlined />}\r\n              onClick={onSave}\r\n              block\r\n              style={{ marginBottom: 8 }}\r\n            >\r\n              Save Project (Ctrl+S)\r\n            </Button>\r\n            <Button icon={<ExportOutlined />} onClick={handleExportClick} type=\"primary\" block>\r\n              Export Image / SVG\r\n            </Button>\r\n            <Button icon={<CopyOutlined />} onClick={() => copyToClipboard(canvasRef)} block>\r\n              Copy to Clipboard\r\n            </Button>\r\n          </Space>\r\n        </Panel>\r\n      </Collapse>\r\n\r\n      <UpscaleModal\r\n        open={showUpscaleModal}\r\n        onCancel={() => setShowUpscaleModal(false)}\r\n        onOk={handleCustomUpscale}\r\n        upscaleFactor={upscaleFactor}\r\n        setUpscaleFactor={setUpscaleFactor}\r\n        presetLocal={presetLocal}\r\n        setPresetLocal={setPresetLocal}\r\n        sharpenAmount={sharpenAmount}\r\n        setSharpenAmount={setSharpenAmount}\r\n        edgeEnhancement={edgeEnhancement}\r\n        setEdgeEnhancement={setEdgeEnhancement}\r\n        denoiseAmount={denoiseAmount}\r\n        setDenoiseAmount={setDenoiseAmount}\r\n      />\r\n\r\n      <ExportModal\r\n        open={showExportModal}\r\n        onCancel={() => {\r\n          setShowExportModal(false);\r\n          setSvgContent(null);\r\n        }}\r\n        onExportImage={handleExportImage}\r\n        onExportSvg={handleConvertToSvg}\r\n        canvasRef={canvasRef}\r\n        processing={processing}\r\n        svgContent={svgContent}\r\n        scale={scale}\r\n        setScale={setScale}\r\n        ltres={ltres}\r\n        setLtres={setLtres}\r\n        qtres={qtres}\r\n        setQtres={setQtres}\r\n        pathomit={pathomit}\r\n        setPathomit={setPathomit}\r\n        colorsampling={colorsampling}\r\n        setColorsampling={setColorsampling}\r\n        strokewidth={strokewidth}\r\n        setStrokewidth={setStrokewidth}\r\n        onDownload={handleDownloadSvg}\r\n        getSvgModalWidth={getSvgModalWidth}\r\n        getSvgModalHeight={getSvgModalHeight}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SideEditorToolbar;\r\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport ZoomOutOutlinedSvg from \"@ant-design/icons-svg/es/asn/ZoomOutOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar ZoomOutOutlined = function ZoomOutOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: ZoomOutOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(ZoomOutOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'ZoomOutOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar MergeCellsOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"defs\", \"attrs\": {}, \"children\": [{ \"tag\": \"style\", \"attrs\": {} }] }, { \"tag\": \"path\", \"attrs\": { \"d\": \"M482.2 508.4L331.3 389c-3-2.4-7.3-.2-7.3 3.6V478H184V184h204v128c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V144c0-15.5-12.5-28-28-28H144c-15.5 0-28 12.5-28 28v736c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v128H184V546h140v85.4c0 3.8 4.4 6 7.3 3.6l150.9-119.4a4.5 4.5 0 000-7.2zM880 116H596c-15.5 0-28 12.5-28 28v168c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V184h204v294H700v-85.4c0-3.8-4.3-6-7.3-3.6l-151 119.4a4.52 4.52 0 000 7.1l151 119.5c2.9 2.3 7.3.2 7.3-3.6V546h140v294H636V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v168c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V144c0-15.5-12.5-28-28-28z\" } }] }, \"name\": \"merge-cells\", \"theme\": \"outlined\" };\nexport default MergeCellsOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport MergeCellsOutlinedSvg from \"@ant-design/icons-svg/es/asn/MergeCellsOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar MergeCellsOutlined = function MergeCellsOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: MergeCellsOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(MergeCellsOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'MergeCellsOutlined';\n}\nexport default RefIcon;","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport UpOutlinedSvg from \"@ant-design/icons-svg/es/asn/UpOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar UpOutlined = function UpOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: UpOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(UpOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'UpOutlined';\n}\nexport default RefIcon;","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport DownOutlinedSvg from \"@ant-design/icons-svg/es/asn/DownOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar DownOutlined = function DownOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: DownOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(DownOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'DownOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar ItalicOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M798 160H366c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h181.2l-156 544H229c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h432c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8H474.4l156-544H798c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"italic\", \"theme\": \"outlined\" };\nexport default ItalicOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport ItalicOutlinedSvg from \"@ant-design/icons-svg/es/asn/ItalicOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar ItalicOutlined = function ItalicOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: ItalicOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(ItalicOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'ItalicOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar AlignLeftOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M120 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm0 424h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm784 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"align-left\", \"theme\": \"outlined\" };\nexport default AlignLeftOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport AlignLeftOutlinedSvg from \"@ant-design/icons-svg/es/asn/AlignLeftOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar AlignLeftOutlined = function AlignLeftOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: AlignLeftOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(AlignLeftOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'AlignLeftOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar AlignCenterOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M264 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H264c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm496 424c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H264c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496zm144 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"align-center\", \"theme\": \"outlined\" };\nexport default AlignCenterOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport AlignCenterOutlinedSvg from \"@ant-design/icons-svg/es/asn/AlignCenterOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar AlignCenterOutlined = function AlignCenterOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: AlignCenterOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(AlignCenterOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'AlignCenterOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar AlignRightOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M904 158H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 424H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 212H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"align-right\", \"theme\": \"outlined\" };\nexport default AlignRightOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport AlignRightOutlinedSvg from \"@ant-design/icons-svg/es/asn/AlignRightOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar AlignRightOutlined = function AlignRightOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: AlignRightOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(AlignRightOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'AlignRightOutlined';\n}\nexport default RefIcon;","import React, { useRef } from 'react';\r\nimport { Button, Space, Tooltip, Select, InputNumber, ColorPicker } from 'antd';\r\nimport {\r\n  ZoomInOutlined,\r\n  ZoomOutOutlined,\r\n  MergeCellsOutlined,\r\n  UpOutlined,\r\n  DownOutlined,\r\n  DeleteOutlined,\r\n  ItalicOutlined,\r\n  AlignLeftOutlined,\r\n  AlignCenterOutlined,\r\n  AlignRightOutlined,\r\n  FontColorsOutlined,\r\n  HighlightOutlined,\r\n} from '@ant-design/icons';\r\nimport { HistoryController } from '../../hooks/useHistory';\r\nimport { Tool } from './types';\r\n\r\nconst { Option } = Select;\r\n\r\ntype TopEditorToolbarProps = {\r\n  history: HistoryController;\r\n  setZoom: React.Dispatch<React.SetStateAction<number>>;\r\n  tool: Tool;\r\n  setTool: (v: Tool) => void;\r\n  brushType: 'hard' | 'soft';\r\n  setBrushType: (v: 'hard' | 'soft') => void;\r\n  drawColor: string;\r\n  setDrawColor: (v: string) => void;\r\n  drawLineWidth: number;\r\n  setDrawLineWidth: (v: number) => void;\r\n  brushOpacity: number;\r\n  setBrushOpacity: (v: number) => void;\r\n  brushFlow: number;\r\n  setBrushFlow: (v: number) => void;\r\n  // layer controls (optional)\r\n  layers?: Array<{\r\n    id: string;\r\n    type?: 'image' | 'text';\r\n    img?: HTMLImageElement;\r\n    rect?: { x: number; y: number; w: number; h: number };\r\n    opacity: number;\r\n    blend?: GlobalCompositeOperation;\r\n    text?: string;\r\n    font?: string;\r\n    fontSize?: number;\r\n    fontWeight?: any;\r\n    fontItalic?: boolean;\r\n    textDecoration?: 'none' | 'underline' | 'line-through';\r\n    textColor?: string;\r\n    textAlign?: 'left' | 'center' | 'right';\r\n  }>;\r\n  activeLayerId?: string | null;\r\n  setLayerOpacity?: (id: string, v: number) => void;\r\n  setLayerBlend?: (id: string, v: GlobalCompositeOperation) => void;\r\n  // full layer actions\r\n  moveLayerUp?: (id: string) => void;\r\n  moveLayerDown?: (id: string) => void;\r\n  deleteLayer?: (id: string) => void;\r\n  selectLayer?: (id: string) => void;\r\n  mergeLayer?: (id?: string) => void;\r\n  // text tool controls\r\n  textContent?: string;\r\n  setTextContent?: (v: string) => void;\r\n  textFont?: string;\r\n  setTextFont?: (v: string) => void;\r\n  textFontSize?: number;\r\n  setTextFontSize?: (v: number) => void;\r\n  textColor?: string;\r\n  setTextColor?: (v: string) => void;\r\n  textWeight?: 'normal' | 'bold' | 'lighter' | string;\r\n  setTextWeight?: (v: any) => void;\r\n  textItalic?: boolean;\r\n  setTextItalic?: (v: boolean) => void;\r\n  textDecoration?: 'none' | 'underline' | 'line-through';\r\n  setTextDecoration?: (v: 'none' | 'underline' | 'line-through') => void;\r\n  textAlign?: 'left' | 'center' | 'right';\r\n  setTextAlign?: (v: 'left' | 'center' | 'right') => void;\r\n  onAddTextLayer?: () => void;\r\n  isAddingText?: boolean;\r\n  setIsAddingText?: (v: boolean) => void;\r\n  // mask tool controls\r\n  onOpenMaskTool?: (layerId: string) => void;\r\n  onOpenLayerEffects?: (layerId: string) => void;\r\n};\r\n\r\nconst TopEditorToolbar: React.FC<TopEditorToolbarProps> = ({\r\n  history,\r\n  setZoom,\r\n  tool,\r\n  setTool,\r\n  brushType,\r\n  setBrushType,\r\n  drawColor,\r\n  setDrawColor,\r\n  drawLineWidth,\r\n  setDrawLineWidth,\r\n  brushOpacity,\r\n  setBrushOpacity,\r\n  brushFlow,\r\n  setBrushFlow,\r\n  layers,\r\n  activeLayerId,\r\n  setLayerOpacity,\r\n  setLayerBlend,\r\n  moveLayerUp,\r\n  moveLayerDown,\r\n  deleteLayer,\r\n  selectLayer,\r\n  mergeLayer,\r\n  textContent,\r\n  setTextContent,\r\n  textFont,\r\n  setTextFont,\r\n  textFontSize,\r\n  setTextFontSize,\r\n  textColor,\r\n  setTextColor,\r\n  textWeight,\r\n  setTextWeight,\r\n  textItalic,\r\n  setTextItalic,\r\n  textDecoration,\r\n  setTextDecoration,\r\n  textAlign,\r\n  setTextAlign,\r\n  onAddTextLayer,\r\n  isAddingText,\r\n  setIsAddingText,\r\n  onOpenMaskTool,\r\n  onOpenLayerEffects,\r\n}) => {\r\n  // Drag-to-adjust opacity refs\r\n  const draggingOpacity = useRef(false);\r\n  const opacityDragStartX = useRef<number | null>(null);\r\n  const opacityStartValue = useRef<number>(brushOpacity);\r\n  // Drag-to-adjust flow refs\r\n  const draggingFlow = useRef(false);\r\n  const flowDragStartX = useRef<number | null>(null);\r\n  const flowStartValue = useRef<number>(brushFlow);\r\n\r\n  const handleOpacityLabelMouseDown = (e: React.MouseEvent) => {\r\n    if (e.button !== 0) return;\r\n    e.preventDefault();\r\n\r\n    draggingOpacity.current = true;\r\n    opacityDragStartX.current = e.clientX;\r\n\r\n    const prevUserSelect = document.body.style.userSelect;\r\n    document.body.style.userSelect = 'none';\r\n\r\n    // === TRANSFORMERS ===\r\n    const getStartValue = () => {\r\n      if (tool === 'draw') return brushOpacity;\r\n      if (tool === 'layer' && layers) {\r\n        const active = layers.find((l) => l.id === activeLayerId);\r\n        return active?.opacity ?? brushOpacity;\r\n      }\r\n      return brushOpacity;\r\n    };\r\n\r\n    const applyValue = (value: number) => {\r\n      const val = Number(value.toFixed(2));\r\n      if (tool === 'draw') {\r\n        setBrushOpacity(val);\r\n        return;\r\n      }\r\n\r\n      if (tool === 'layer' && layers) {\r\n        const active = layers.find((l) => l.id === activeLayerId);\r\n        if (active && setLayerOpacity) setLayerOpacity(active.id, val);\r\n      }\r\n    };\r\n\r\n    opacityStartValue.current = getStartValue();\r\n\r\n    const onMouseMove = (ev: MouseEvent) => {\r\n      if (!draggingOpacity.current || opacityDragStartX.current === null) return;\r\n      const delta = ev.clientX - opacityDragStartX.current;\r\n      const sensitivity = 0.005;\r\n      const newVal = Math.min(1, Math.max(0, opacityStartValue.current + delta * sensitivity));\r\n      applyValue(newVal);\r\n    };\r\n\r\n    const onMouseUp = () => {\r\n      draggingOpacity.current = false;\r\n      opacityDragStartX.current = null;\r\n      document.body.style.userSelect = prevUserSelect;\r\n      window.removeEventListener('mousemove', onMouseMove);\r\n      window.removeEventListener('mouseup', onMouseUp);\r\n    };\r\n\r\n    window.addEventListener('mousemove', onMouseMove);\r\n    window.addEventListener('mouseup', onMouseUp);\r\n  };\r\n\r\n  const handleFlowLabelMouseDown = (e: React.MouseEvent) => {\r\n    if (e.button !== 0) return; // only left button\r\n    e.preventDefault();\r\n    draggingFlow.current = true;\r\n    flowDragStartX.current = e.clientX;\r\n    flowStartValue.current = brushFlow;\r\n\r\n    // prevent text selection while dragging\r\n    const prevUserSelect = document.body.style.userSelect;\r\n    document.body.style.userSelect = 'none';\r\n\r\n    const onMouseMove = (ev: MouseEvent) => {\r\n      if (!draggingFlow.current || flowDragStartX.current === null) return;\r\n      const delta = ev.clientX - flowDragStartX.current;\r\n      // sensitivity: 0.005 per pixel = 0.05 change per 10px\r\n      const sensitivity = 0.005;\r\n      let newVal = flowStartValue.current + delta * sensitivity;\r\n      newVal = Math.max(0, Math.min(1, newVal));\r\n      setBrushFlow(Number(newVal.toFixed(2)));\r\n    };\r\n\r\n    const onMouseUp = () => {\r\n      draggingFlow.current = false;\r\n      flowDragStartX.current = null;\r\n      flowStartValue.current = brushFlow;\r\n      document.body.style.userSelect = prevUserSelect;\r\n      window.removeEventListener('mousemove', onMouseMove);\r\n      window.removeEventListener('mouseup', onMouseUp);\r\n    };\r\n\r\n    window.addEventListener('mousemove', onMouseMove);\r\n    window.addEventListener('mouseup', onMouseUp);\r\n  };\r\n  return (\r\n    <div style={{ marginBottom: 8 }}>\r\n      <Space>\r\n        {/* History selector */}\r\n        <Select\r\n          style={{ width: 150 }}\r\n          placeholder=\"History\"\r\n          value={history.index}\r\n          onChange={(idx) => history.applyHistory(idx)}\r\n          optionLabelProp=\"label\"\r\n        >\r\n          {history.history.map((item, idx) => (\r\n            <Select.Option key={idx} value={idx} label={item.label || `Step ${idx + 1}`}>\r\n              <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                <img\r\n                  src={item.url}\r\n                  alt=\"\"\r\n                  style={{\r\n                    width: 40,\r\n                    height: 30,\r\n                    objectFit: 'contain',\r\n                    border: '1px solid #ddd',\r\n                  }}\r\n                />\r\n                <span>{item.label || `Step ${idx + 1}`}</span>\r\n              </div>\r\n            </Select.Option>\r\n          ))}\r\n        </Select>\r\n\r\n        {/* Zoom controls */}\r\n        <Tooltip title=\"Zoom In\">\r\n          <Button icon={<ZoomInOutlined />} onClick={() => setZoom((z) => Math.min(z * 1.2, 8))} />\r\n        </Tooltip>\r\n        <Tooltip title=\"Zoom Out\">\r\n          <Button\r\n            icon={<ZoomOutOutlined />}\r\n            onClick={() => setZoom((z) => Math.max(z / 1.2, 0.1))}\r\n          />\r\n        </Tooltip>\r\n\r\n        {/* Tool selector */}\r\n        <Select value={tool} onChange={(v) => setTool(v as Tool)} style={{ width: 140 }}>\r\n          <Option value=\"pan\">Pan</Option>\r\n          <Option value=\"move\">Move</Option>\r\n          <Option value=\"color\">Color Picker</Option>\r\n          <Option value=\"crop\">Crop</Option>\r\n          <Option value=\"ruler\">Ruler</Option>\r\n          <Option value=\"perspective\">Perspective</Option>\r\n          <Option value=\"draw\">Brush</Option>\r\n          <Option value=\"text\">Text</Option>\r\n        </Select>\r\n\r\n        <Space style={{ width: '100%' }} wrap>\r\n          {tool === 'color' ? (\r\n            <ColorPicker value={drawColor} onChange={(c) => setDrawColor(c.toHexString())} />\r\n          ) : null}\r\n          {tool === 'draw' ? (\r\n            <>\r\n              {/* Brush Type */}\r\n              <Select\r\n                value={brushType}\r\n                onChange={(v) => setBrushType(v as 'hard' | 'soft')}\r\n                style={{ width: 80 }}\r\n              >\r\n                <Option value=\"hard\">Hard</Option>\r\n                <Option value=\"soft\">Soft</Option>\r\n              </Select>\r\n\r\n              {/* Color Picker */}\r\n              <ColorPicker value={drawColor} onChange={(c) => setDrawColor(c.toHexString())} />\r\n\r\n              {/* Brush Size */}\r\n              <InputNumber\r\n                style={{ width: 100 }}\r\n                min={1}\r\n                max={500}\r\n                value={drawLineWidth}\r\n                onChange={(v) => setDrawLineWidth(v || 1)}\r\n                addonAfter=\"px\"\r\n              />\r\n\r\n              {/* Opacity */}\r\n              <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                <span\r\n                  onMouseDown={handleOpacityLabelMouseDown}\r\n                  style={{ cursor: 'ew-resize', userSelect: 'none' }}\r\n                  title=\"Drag left/right to change opacity\"\r\n                >\r\n                  Opacity:\r\n                </span>\r\n                <InputNumber\r\n                  min={0}\r\n                  max={1}\r\n                  step={0.01}\r\n                  style={{ width: 60 }}\r\n                  value={brushOpacity}\r\n                  onChange={(v) => setBrushOpacity(v || 0)}\r\n                />\r\n              </div>\r\n\r\n              {/* Flow */}\r\n              <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                <span\r\n                  onMouseDown={handleFlowLabelMouseDown}\r\n                  style={{ cursor: 'ew-resize', userSelect: 'none' }}\r\n                  title=\"Drag left/right to change flow\"\r\n                >\r\n                  Flow:\r\n                </span>\r\n                <InputNumber\r\n                  min={0}\r\n                  max={1}\r\n                  step={0.01}\r\n                  style={{ width: 60 }}\r\n                  value={brushFlow}\r\n                  onChange={(v) => setBrushFlow(v || 0)}\r\n                />\r\n              </div>\r\n            </>\r\n          ) : null}\r\n\r\n          {tool === 'text' ? (\r\n            <>\r\n              {/* Text tool controls */}\r\n              {/* Text placement and editing handled on-canvas; toolbar shows controls only */}\r\n\r\n              <Select\r\n                value={textFont || 'Arial'}\r\n                onChange={(v) => setTextFont && setTextFont(v)}\r\n                style={{ width: 100 }}\r\n              >\r\n                <Option value=\"Arial\">Arial</Option>\r\n                <Option value=\"Helvetica\">Helvetica</Option>\r\n                <Option value=\"Times New Roman\">Times New Roman</Option>\r\n                <Option value=\"Courier New\">Courier New</Option>\r\n                <Option value=\"Georgia\">Georgia</Option>\r\n                <Option value=\"Verdana\">Verdana</Option>\r\n              </Select>\r\n\r\n              <InputNumber\r\n                min={8}\r\n                max={200}\r\n                value={textFontSize || 32}\r\n                onChange={(v) => setTextFontSize && setTextFontSize(v || 32)}\r\n                addonAfter=\"px\"\r\n                style={{ width: 90 }}\r\n              />\r\n\r\n              <ColorPicker\r\n                value={textColor || '#000000'}\r\n                onChange={(c) => setTextColor && setTextColor(c.toHexString())}\r\n              />\r\n\r\n              <Select\r\n                value={textWeight || 'normal'}\r\n                onChange={(v) => setTextWeight && setTextWeight(v)}\r\n                style={{ width: 80 }}\r\n              >\r\n                <Option value=\"lighter\">Lighter</Option>\r\n                <Option value=\"normal\">Normal</Option>\r\n                <Option value=\"bold\">Bold</Option>\r\n                <Option value=\"900\">900</Option>\r\n              </Select>\r\n\r\n              <Tooltip title=\"Italic\">\r\n                <Button\r\n                  size=\"small\"\r\n                  icon={<ItalicOutlined />}\r\n                  type={textItalic ? 'primary' : 'default'}\r\n                  onClick={() => setTextItalic && setTextItalic(!textItalic)}\r\n                />\r\n              </Tooltip>\r\n\r\n              <Select\r\n                value={textDecoration || 'none'}\r\n                onChange={(v) => setTextDecoration && setTextDecoration(v as any)}\r\n                style={{ width: 100 }}\r\n              >\r\n                <Option value=\"none\">No decoration</Option>\r\n                <Option value=\"underline\">Underline</Option>\r\n                <Option value=\"line-through\">Strike</Option>\r\n              </Select>\r\n\r\n              <Tooltip title=\"Align\">\r\n                <Space size=\"small\">\r\n                  <Button\r\n                    size=\"small\"\r\n                    icon={<AlignLeftOutlined />}\r\n                    type={textAlign === 'left' ? 'primary' : 'default'}\r\n                    onClick={() => setTextAlign && setTextAlign('left')}\r\n                  />\r\n                  <Button\r\n                    size=\"small\"\r\n                    icon={<AlignCenterOutlined />}\r\n                    type={textAlign === 'center' ? 'primary' : 'default'}\r\n                    onClick={() => setTextAlign && setTextAlign('center')}\r\n                  />\r\n                  <Button\r\n                    size=\"small\"\r\n                    icon={<AlignRightOutlined />}\r\n                    type={textAlign === 'right' ? 'primary' : 'default'}\r\n                    onClick={() => setTextAlign && setTextAlign('right')}\r\n                  />\r\n                </Space>\r\n              </Tooltip>\r\n\r\n              {/* add button removed — placement via canvas click */}\r\n            </>\r\n          ) : null}\r\n\r\n          {tool === 'layer' ? (\r\n            <>\r\n              {/* Layer controls (select + actions + opacity/blend for active) */}\r\n              {layers && layers.length > 0 && (\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\r\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                    <span style={{ fontSize: 12, fontWeight: 600 }}>Layers</span>\r\n                    <Select\r\n                      value={activeLayerId || undefined}\r\n                      placeholder=\"Select layer\"\r\n                      onChange={(v) => selectLayer && selectLayer(v as string)}\r\n                      style={{ width: 180 }}\r\n                      showSearch\r\n                    >\r\n                      {layers\r\n                        .slice()\r\n                        .reverse()\r\n                        .map((L) => (\r\n                          <Option key={L.id} value={L.id} label={`Layer ${L.id}`}>\r\n                            <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                              {L.img && (\r\n                                <img\r\n                                  src={L.img?.src}\r\n                                  alt=\"\"\r\n                                  style={{ width: 40, height: 28, objectFit: 'cover' }}\r\n                                />\r\n                              )}\r\n                              {L.text && <FontColorsOutlined />}\r\n                              <span style={{ fontSize: 12 }}>{L.id}</span>\r\n                            </div>\r\n                          </Option>\r\n                        ))}\r\n                    </Select>\r\n                  </div>\r\n\r\n                  <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\r\n                    <Button\r\n                      size=\"small\"\r\n                      icon={<MergeCellsOutlined />}\r\n                      onClick={() => mergeLayer && mergeLayer()}\r\n                    >\r\n                      Merge All\r\n                    </Button>\r\n                  </div>\r\n\r\n                  {/* per-active-layer actions */}\r\n                  {activeLayerId &&\r\n                    (() => {\r\n                      const active = layers.find((l) => l.id === activeLayerId);\r\n                      if (!active) return null;\r\n                      return (\r\n                        <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\r\n                          <Button\r\n                            size=\"small\"\r\n                            icon={<MergeCellsOutlined />}\r\n                            onClick={() => mergeLayer && mergeLayer(active.id)}\r\n                          >\r\n                            Merge\r\n                          </Button>\r\n                          <Button\r\n                            size=\"small\"\r\n                            icon={<HighlightOutlined />}\r\n                            onClick={() => onOpenMaskTool && onOpenMaskTool(active.id)}\r\n                          >\r\n                            Mask\r\n                          </Button>\r\n                          <Button\r\n                            size=\"small\"\r\n                            icon={<FontColorsOutlined />}\r\n                            onClick={() => onOpenLayerEffects && onOpenLayerEffects(active.id)}\r\n                          >\r\n                            Effects\r\n                          </Button>\r\n                          <Button\r\n                            size=\"small\"\r\n                            icon={<UpOutlined />}\r\n                            onClick={() => moveLayerUp && moveLayerUp(active.id)}\r\n                          />\r\n                          <Button\r\n                            size=\"small\"\r\n                            icon={<DownOutlined />}\r\n                            onClick={() => moveLayerDown && moveLayerDown(active.id)}\r\n                          />\r\n                          <Button\r\n                            size=\"small\"\r\n                            danger\r\n                            icon={<DeleteOutlined />}\r\n                            onClick={() => deleteLayer && deleteLayer(active.id)}\r\n                          />\r\n\r\n                          {/* opacity & blend controls */}\r\n                          <div\r\n                            style={{ display: 'flex', alignItems: 'center', gap: 8, marginLeft: 8 }}\r\n                          >\r\n                            <span\r\n                              onMouseDown={handleOpacityLabelMouseDown}\r\n                              style={{ cursor: 'ew-resize', userSelect: 'none' }}\r\n                              title=\"Drag left/right to change opacity\"\r\n                            >\r\n                              Opacity:\r\n                            </span>\r\n                            <InputNumber\r\n                              min={0}\r\n                              max={1}\r\n                              step={0.01}\r\n                              style={{ width: 80 }}\r\n                              value={Number(active.opacity.toFixed(2))}\r\n                              onChange={(v) =>\r\n                                setLayerOpacity && setLayerOpacity(active.id, Number(v || 0))\r\n                              }\r\n                            />\r\n                          </div>\r\n\r\n                          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                            <span style={{ userSelect: 'none' }}>Blend:</span>\r\n                            <Select\r\n                              value={active.blend || 'source-over'}\r\n                              onChange={(v) =>\r\n                                setLayerBlend &&\r\n                                setLayerBlend(active.id, v as GlobalCompositeOperation)\r\n                              }\r\n                              style={{ width: 140 }}\r\n                            >\r\n                              <Option value=\"source-over\">Normal</Option>\r\n                              <Option value=\"multiply\">Multiply</Option>\r\n                              <Option value=\"screen\">Screen</Option>\r\n                              <Option value=\"overlay\">Overlay</Option>\r\n                              <Option value=\"lighter\">Lighten</Option>\r\n                              <Option value=\"darken\">Darken</Option>\r\n                            </Select>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })()}\r\n                </div>\r\n              )}\r\n            </>\r\n          ) : null}\r\n        </Space>\r\n      </Space>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TopEditorToolbar;\r\n","import { useState, useRef, useEffect } from 'react';\r\nimport { Tool } from '../types';\r\n\r\nexport const useViewer = (\r\n  containerRef: React.RefObject<HTMLDivElement>,\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  tool: Tool,\r\n) => {\r\n  const [zoom, setZoom] = useState(1);\r\n  const [offset, setOffset] = useState({ x: 0, y: 0 });\r\n  const [isPanning, setIsPanning] = useState(false);\r\n  const panStart = useRef<{ x: number; y: number } | null>(null);\r\n\r\n  // Ctrl + Wheel Zoom Handler\r\n  useEffect(() => {\r\n    const container = containerRef.current;\r\n    const canvas = canvasRef.current;\r\n    if (!container || !canvas) return;\r\n\r\n    const handleWheel = (e: WheelEvent) => {\r\n      if (!e.ctrlKey && tool !== 'pan') return;\r\n      e.preventDefault();\r\n\r\n      const rect = canvas.getBoundingClientRect();\r\n      const mouseX = e.clientX - rect.left;\r\n      const mouseY = e.clientY - rect.top;\r\n\r\n      setZoom((prev) => {\r\n        const zoomFactor = e.deltaY < 0 ? 1.1 : 0.9;\r\n        const newZoom = Math.min(Math.max(prev * zoomFactor, 0.1), 12);\r\n\r\n        const scaleChange = newZoom / prev;\r\n        setOffset((prevOffset) => ({\r\n          x: mouseX - (mouseX - prevOffset.x) * scaleChange,\r\n          y: mouseY - (mouseY - prevOffset.y) * scaleChange,\r\n        }));\r\n\r\n        return newZoom;\r\n      });\r\n    };\r\n\r\n    container.addEventListener('wheel', handleWheel, { passive: false });\r\n    return () => container.removeEventListener('wheel', handleWheel);\r\n  }, [containerRef, canvasRef, tool]);\r\n\r\n  return {\r\n    zoom,\r\n    setZoom,\r\n    offset,\r\n    setOffset,\r\n    isPanning,\r\n    setIsPanning,\r\n    panStart,\r\n  };\r\n};\r\n","import { useState } from 'react';\r\nimport { Tool } from '../types';\r\n\r\nexport const useTools = () => {\r\n  const [tool, setTool] = useState<Tool>('pan');\r\n  const [toolBefore, setToolBefore] = useState<Tool | null>(null);\r\n  const [isSpaceDown, setIsSpaceDown] = useState(false);\r\n  const [isAltDown, setIsAltDown] = useState(false);\r\n  const [isShiftDown, setIsShiftDown] = useState(false);\r\n\r\n  return {\r\n    tool,\r\n    setTool,\r\n    toolBefore,\r\n    setToolBefore,\r\n    isSpaceDown,\r\n    setIsSpaceDown,\r\n    isAltDown,\r\n    setIsAltDown,\r\n    isShiftDown,\r\n    setIsShiftDown,\r\n  };\r\n};\r\n","import { useState } from 'react';\r\n\r\nexport const useAdjustments = () => {\r\n  const [brightness, setBrightness] = useState(0);\r\n  const [contrast, setContrast] = useState(0);\r\n\r\n  const [highlights, setHighlights] = useState(0);\r\n  const [shadows, setShadows] = useState(0);\r\n  const [whites, setWhites] = useState(0);\r\n  const [blacks, setBlacks] = useState(0);\r\n\r\n  const [vibrance, setVibrance] = useState(0);\r\n  const [saturation, setSaturation] = useState(0);\r\n\r\n  const [dehaze, setDehaze] = useState(0);\r\n\r\n  const [blur, setBlur] = useState(0);\r\n  const [gaussian, setGaussian] = useState(0);\r\n  const [sharpen, setSharpen] = useState(0);\r\n  const [texture, setTexture] = useState(0);\r\n  const [clarity, setClarity] = useState(0);\r\n\r\n  const [bgThreshold, setBgThreshold] = useState(0);\r\n  const [bgThresholdBlack, setBgThresholdBlack] = useState(0);\r\n\r\n  const [hslAdjustments, setHslAdjustmentsState] = useState<\r\n    Record<string, { h?: number; s?: number; l?: number }>\r\n  >({});\r\n\r\n  const setHslAdjustments = (\r\n    name: string,\r\n    values: Partial<{ h: number; s: number; l: number }>,\r\n  ) => {\r\n    setHslAdjustmentsState((prev) => ({\r\n      ...prev,\r\n      [name]: { ...(prev[name] || {}), ...values },\r\n    }));\r\n  };\r\n\r\n  return {\r\n    brightness,\r\n    setBrightness,\r\n    contrast,\r\n    setContrast,\r\n    highlights,\r\n    setHighlights,\r\n    shadows,\r\n    setShadows,\r\n    whites,\r\n    setWhites,\r\n    blacks,\r\n    setBlacks,\r\n    vibrance,\r\n    setVibrance,\r\n    saturation,\r\n    setSaturation,\r\n    dehaze,\r\n    setDehaze,\r\n    blur,\r\n    setBlur,\r\n    gaussian,\r\n    setGaussian,\r\n    sharpen,\r\n    setSharpen,\r\n    texture,\r\n    setTexture,\r\n    clarity,\r\n    setClarity,\r\n    bgThreshold,\r\n    setBgThreshold,\r\n    bgThresholdBlack,\r\n    setBgThresholdBlack,\r\n    hslAdjustments,\r\n    setHslAdjustmentsState,\r\n    setHslAdjustments,\r\n  };\r\n};\r\n","import { useState, useRef } from 'react';\r\nimport { Layer } from '../../../types';\r\n\r\nexport const useLayers = () => {\r\n  const [layers, setLayers] = useState<Layer[]>([]);\r\n  const [activeLayerId, setActiveLayerId] = useState<string | null>(null);\r\n  const [overlaySelected, setOverlaySelected] = useState(false);\r\n\r\n  const overlayDrag = useRef<null | {\r\n    layerId: string;\r\n    startX: number;\r\n    startY: number;\r\n    origX: number;\r\n    origY: number;\r\n  }>(null);\r\n\r\n  const overlayResize = useRef<null | {\r\n    layerId: string;\r\n    handle: 'tl' | 'tr' | 'bl' | 'br' | 't' | 'b' | 'l' | 'r' | 'move';\r\n    startX: number;\r\n    startY: number;\r\n    orig: { x: number; y: number; w: number; h: number };\r\n  }>(null);\r\n\r\n  const overlayRotate = useRef<null | {\r\n    layerId: string;\r\n    startX: number;\r\n    startY: number;\r\n    centerX: number;\r\n    centerY: number;\r\n    startAngle: number;\r\n    originalRotation: number;\r\n  }>(null);\r\n\r\n  return {\r\n    layers,\r\n    setLayers,\r\n    activeLayerId,\r\n    setActiveLayerId,\r\n    overlaySelected,\r\n    setOverlaySelected,\r\n    overlayDrag,\r\n    overlayResize,\r\n    overlayRotate,\r\n  };\r\n};\r\n","import { useState, useRef } from 'react';\r\n\r\nexport const useCrop = () => {\r\n  const [cropRect, setCropRect] = useState<{ x: number; y: number; w: number; h: number } | null>(\r\n    null,\r\n  );\r\n  const cropStart = useRef<{ x: number; y: number } | null>(null);\r\n  const [showCropModal, setShowCropModal] = useState(false);\r\n\r\n  return {\r\n    cropRect,\r\n    setCropRect,\r\n    cropStart,\r\n    showCropModal,\r\n    setShowCropModal,\r\n  };\r\n};\r\n","import { useState, useRef } from 'react';\r\n\r\nexport const usePerspective = () => {\r\n  const [showPerspectiveModal, setShowPerspectiveModal] = useState(false);\r\n\r\n  // initialize to NaN pairs so we can detect \"empty\" slots\r\n  const perspectivePoints = useRef<\r\n    [number, number, number, number, number, number, number, number] | null\r\n  >(null);\r\n\r\n  // helper: ensure we have an array of 8 numbers (NaNs if empty)\r\n  const ensurePerspectiveInit = () => {\r\n    if (!perspectivePoints.current) {\r\n      perspectivePoints.current = [NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN];\r\n    }\r\n  };\r\n\r\n  // helper: find index of a \"near\" point (within tolerance), else -1\r\n  const findNearPointIndex = (x: number, y: number, tol = 12) => {\r\n    if (!perspectivePoints.current) return -1;\r\n    const p = perspectivePoints.current;\r\n    for (let i = 0; i < 8; i += 2) {\r\n      const px = p[i];\r\n      const py = p[i + 1];\r\n      if (!isNaN(px) && !isNaN(py)) {\r\n        const dx = px - x;\r\n        const dy = py - y;\r\n        if (Math.sqrt(dx * dx + dy * dy) <= tol) return i;\r\n      }\r\n    }\r\n    return -1;\r\n  };\r\n\r\n  return {\r\n    showPerspectiveModal,\r\n    setShowPerspectiveModal,\r\n    perspectivePoints,\r\n    ensurePerspectiveInit,\r\n    findNearPointIndex,\r\n  };\r\n};\r\n","import { useState, useRef } from 'react';\r\n\r\nexport const useDrawing = () => {\r\n  const [drawColor, setDrawColor] = useState('#ff0000');\r\n  const [drawLineWidth, setDrawLineWidth] = useState(2);\r\n  const [brushType, setBrushType] = useState<'hard' | 'soft'>('hard');\r\n  const [brushOpacity, setBrushOpacity] = useState(1); // 0 - 1\r\n  const [brushFlow, setBrushFlow] = useState(1); // 0 - 1\r\n  const [isDrawing, setIsDrawing] = useState(false);\r\n  const drawPoints = useRef<{ x: number; y: number }[]>([]);\r\n  const resizingBrush = useRef(false);\r\n  const resizeStartX = useRef<number | null>(null);\r\n  const initialLineWidth = useRef(drawLineWidth);\r\n\r\n  return {\r\n    drawColor,\r\n    setDrawColor,\r\n    drawLineWidth,\r\n    setDrawLineWidth,\r\n    brushType,\r\n    setBrushType,\r\n    brushOpacity,\r\n    setBrushOpacity,\r\n    brushFlow,\r\n    setBrushFlow,\r\n    isDrawing,\r\n    setIsDrawing,\r\n    drawPoints,\r\n    resizingBrush,\r\n    resizeStartX,\r\n    initialLineWidth,\r\n  };\r\n};\r\n","import { useState, useRef } from 'react';\r\nimport { Layer } from '../../../types';\r\n\r\nexport const useTextTool = () => {\r\n  const [textContent, setTextContent] = useState('');\r\n  const [textFont, setTextFont] = useState('Arial');\r\n  const [textFontSize, setTextFontSize] = useState(32);\r\n  const [textColor, setTextColor] = useState('#000000');\r\n  const [textWeight, setTextWeight] = useState<Layer['fontWeight']>('normal');\r\n  const [textItalic, setTextItalic] = useState(false);\r\n  const [textDecoration, setTextDecoration] = useState<'none' | 'underline' | 'line-through'>(\r\n    'none',\r\n  );\r\n  const [textAlign, setTextAlign] = useState<'left' | 'center' | 'right'>('left');\r\n  const [isAddingText, setIsAddingText] = useState(false); // track if user clicked to place text\r\n  const inlineEditorRef = useRef<HTMLTextAreaElement | null>(null);\r\n\r\n  return {\r\n    textContent,\r\n    setTextContent,\r\n    textFont,\r\n    setTextFont,\r\n    textFontSize,\r\n    setTextFontSize,\r\n    textColor,\r\n    setTextColor,\r\n    textWeight,\r\n    setTextWeight,\r\n    textItalic,\r\n    setTextItalic,\r\n    textDecoration,\r\n    setTextDecoration,\r\n    textAlign,\r\n    setTextAlign,\r\n    isAddingText,\r\n    setIsAddingText,\r\n    inlineEditorRef,\r\n  };\r\n};\r\n","import { useState, useRef } from 'react';\r\n\r\nexport const useEditorState = () => {\r\n  const [hoverColor, setHoverColor] = useState<{ x: number; y: number; color: string } | null>(\r\n    null,\r\n  );\r\n  const [pickedColor, setPickedColor] = useState<string | null>(null);\r\n\r\n  const [showColorRemovalModal, setShowColorRemovalModal] = useState(false);\r\n  const [selectedColorForRemoval, setSelectedColorForRemoval] = useState<string | null>(null);\r\n\r\n  const [showLayerMaskModal, setShowLayerMaskModal] = useState(false);\r\n  const [maskEditingLayerId, setMaskEditingLayerId] = useState<string | null>(null);\r\n\r\n  const [showLayerEffectModal, setShowLayerEffectModal] = useState(false);\r\n  const [effectEditingLayerId, setEffectEditingLayerId] = useState<string | null>(null);\r\n\r\n  const rulerPoints = useRef<{ x1: number; y1: number; x2: number; y2: number } | null>(null);\r\n  const [dpiMeasured, setDpiMeasured] = useState<number | null>(null);\r\n\r\n  const [showExportModal, setShowExportModal] = useState(false);\r\n\r\n  const [openTour, setOpenTour] = useState(false);\r\n  const toolbarRef = useRef<HTMLDivElement>(null);\r\n  const sidebarRef = useRef<HTMLDivElement>(null);\r\n  const canvasContainerRef = useRef<HTMLDivElement>(null);\r\n\r\n  return {\r\n    hoverColor,\r\n    setHoverColor,\r\n    pickedColor,\r\n    setPickedColor,\r\n    showColorRemovalModal,\r\n    setShowColorRemovalModal,\r\n    selectedColorForRemoval,\r\n    setSelectedColorForRemoval,\r\n    showLayerMaskModal,\r\n    setShowLayerMaskModal,\r\n    maskEditingLayerId,\r\n    setMaskEditingLayerId,\r\n    showLayerEffectModal,\r\n    setShowLayerEffectModal,\r\n    effectEditingLayerId,\r\n    setEffectEditingLayerId,\r\n    rulerPoints,\r\n    dpiMeasured,\r\n    setDpiMeasured,\r\n    showExportModal,\r\n    setShowExportModal,\r\n    openTour,\r\n    setOpenTour,\r\n    toolbarRef,\r\n    sidebarRef,\r\n    canvasContainerRef,\r\n  };\r\n};\r\n","import React from 'react';\r\nimport { TourProps } from 'antd';\r\n\r\nexport const getTourSteps = (\r\n  sidebarRef: React.RefObject<HTMLDivElement>,\r\n  canvasContainerRef: React.RefObject<HTMLDivElement>,\r\n  toolbarRef: React.RefObject<HTMLDivElement>,\r\n): TourProps['steps'] => [\r\n  {\r\n    title: '🎨 Welcome to Pics Editor',\r\n    description:\r\n      'This is a powerful image editing tool with many features. Let me show you around!',\r\n    target: null,\r\n  },\r\n  {\r\n    title: '🛠️ Side Panel',\r\n    description:\r\n      'Access all editing tools here: adjustments, effects, color grading, and export options. Apply changes to see them on the canvas.',\r\n    target: () => sidebarRef.current!,\r\n  },\r\n  {\r\n    title: '🖼️ Canvas Area',\r\n    description:\r\n      'Your main workspace. Use Space + drag to pan, scroll to zoom, or Alt + scroll for fine zoom control. The resolution is shown in the top right.',\r\n    target: () => canvasContainerRef.current!,\r\n  },\r\n  {\r\n    title: '⌨️ Top Toolbar',\r\n    description:\r\n      'Quick access to undo/redo, zoom controls, and tool-specific options. Draw settings, layer management, and text formatting appear when those tools are active.',\r\n    target: () => toolbarRef.current!,\r\n  },\r\n  {\r\n    title: '🎭 Hand Tool (Hold \"Space\" or press \"H\")',\r\n    description:\r\n      'Navigate around your canvas. Hold Space key anywhere to temporarily activate pan mode, making it easy to move around large images.',\r\n  },\r\n  {\r\n    title: '✂️ Crop Tool (C)',\r\n    description:\r\n      'Click and drag to select a crop area. Press Enter to apply the crop or Escape to cancel. Perfect for trimming images to the exact size you need.',\r\n  },\r\n  {\r\n    title: '🎨 Color Picker (I)',\r\n    description:\r\n      'Click on any pixel to pick its color. Hold Shift while clicking to pick from the original unedited image instead of the current edited version.',\r\n  },\r\n  {\r\n    title: '🗑️ Color Removal (K)',\r\n    description:\r\n      'Remove specific colors from your image. First use the Color Picker (I) to select a color, then activate this tool to remove it with adjustable tolerance and feathering for smooth edges.',\r\n  },\r\n  {\r\n    title: '📏 Ruler Tool (R)',\r\n    description:\r\n      'Measure distances on your image. Click two points to measure in pixels, then optionally enter a real-world measurement to calculate and display the image DPI.',\r\n  },\r\n  {\r\n    title: '🔲 Perspective Tool (P)',\r\n    description:\r\n      \"Correct perspective distortion in photos. Click to place 4 corner points clockwise, adjust them to match the object's corners, then apply to straighten the perspective.\",\r\n  },\r\n  {\r\n    title: '✏️ Brush Tool (B)',\r\n    description:\r\n      'Freehand drawing with customizable options: brush size, color, opacity, flow rate, and choose between hard-edge and soft-edge brushes for different effects.',\r\n  },\r\n  {\r\n    title: '🖼️ Layer Tool (V)',\r\n    description:\r\n      'Add and manage image layers. Drag and drop images onto the canvas, adjust opacity and blend modes, resize, rotate, and position layers with full control.',\r\n  },\r\n  {\r\n    title: '🔤 Text Tool (T)',\r\n    description:\r\n      'Add text overlays with complete formatting control: font family, size, weight (bold/normal), color, alignment (left/center/right), italic, and text decorations (underline/strikethrough).',\r\n  },\r\n  {\r\n    title: '🔍 Upscale',\r\n    description:\r\n      'Enlarge your image intelligently. Choose from quality presets (low/medium/high) and apply enhancement options like sharpen, edge enhancement, and noise reduction for best results.',\r\n  },\r\n  {\r\n    title: '💾 Export (Ctrl + Shift + S)',\r\n    description:\r\n      'Export your edited image as PNG or JPG with optional overlay layers, or convert to scalable SVG format with customizable tracing parameters for vector graphics.',\r\n  },\r\n  {\r\n    title: '⌨️ Keyboard Shortcuts',\r\n    description: (\r\n      <div style={{ lineHeight: 1.8 }}>\r\n        <div>\r\n          <strong>Space</strong>: Pan tool (hold anywhere)\r\n        </div>\r\n        <div>\r\n          <strong>C</strong>: Crop tool\r\n        </div>\r\n        <div>\r\n          <strong>I</strong>: Color picker\r\n        </div>\r\n        <div>\r\n          <strong>K</strong>: Color removal\r\n        </div>\r\n        <div>\r\n          <strong>R</strong>: Ruler tool\r\n        </div>\r\n        <div>\r\n          <strong>P</strong>: Perspective tool\r\n        </div>\r\n        <div>\r\n          <strong>D</strong>: Draw tool\r\n        </div>\r\n        <div>\r\n          <strong>L</strong>: Layer tool\r\n        </div>\r\n        <div>\r\n          <strong>T</strong>: Text tool\r\n        </div>\r\n        <div>\r\n          <strong>Ctrl+Z</strong>: Undo\r\n        </div>\r\n        <div>\r\n          <strong>Ctrl+Y</strong>: Redo\r\n        </div>\r\n        <div>\r\n          <strong>Scroll</strong>: Zoom in/out\r\n        </div>\r\n        <div>\r\n          <strong>Alt+Scroll</strong>: Fine zoom control\r\n        </div>\r\n        <div>\r\n          <strong>Shift+Click</strong>: Pick from original image\r\n        </div>\r\n      </div>\r\n    ),\r\n  },\r\n];\r\n","//#region Imports\r\nimport React, { useEffect, useMemo, useRef } from 'react';\r\nimport { Modal, message, Button, Tour } from 'antd';\r\nimport { QuestionCircleOutlined } from '@ant-design/icons';\r\n\r\nimport useCanvas from '../../hooks/useCanvas';\r\nimport useHistory from '../../hooks/useHistory';\r\nimport {\r\n  applyCrop,\r\n  rotate,\r\n  samplePixel,\r\n  addOverlayImage,\r\n  drawOverlayHelper,\r\n  exportWithOverlay as helperExportWithOverlay,\r\n  mergeLayerIntoBase as helperMergeLayerIntoBase,\r\n  setLayerOpacity as helperSetLayerOpacity,\r\n  setLayerBlend as helperSetLayerBlend,\r\n  moveLayerUp as helperMoveLayerUp,\r\n  moveLayerDown as helperMoveLayerDown,\r\n  deleteLayer as helperDeleteLayer,\r\n  selectLayer as helperSelectLayer,\r\n  perspectiveApplyHelper,\r\n  addTextLayer as helperAddTextLayer,\r\n  setLayerText as helperSetLayerText,\r\n  setLayerFont as helperSetLayerFont,\r\n  setLayerFontSize as helperSetLayerFontSize,\r\n  setLayerFontWeight as helperSetLayerFontWeight,\r\n  setLayerFontItalic as helperSetLayerFontItalic,\r\n  setLayerTextDecoration as helperSetLayerTextDecoration,\r\n  setLayerTextColor as helperSetLayerTextColor,\r\n  setLayerTextAlign as helperSetLayerTextAlign,\r\n  createTextEditorOverlay,\r\n  applyUpscale,\r\n  applyInvertColors,\r\n  applyMaskToCanvas,\r\n} from '../../utils/helpers';\r\nimport { drawBrushStroke, BrushSettings } from '../../utils/brushHelpers';\r\nimport ImageCanvas from './ImageCanvas';\r\nimport ColorRemovalModal from './ColorRemovalModal';\r\nimport LayerMaskModal from './LayerMaskModal';\r\nimport LayerEffectModal from './LayerEffectModal';\r\nimport SideEditorToolbar from './SideEditorToolbar';\r\nimport TopEditorToolbar from './TopEditorToolbar';\r\n\r\nimport { ImageEditorProps, Tool } from './types';\r\nimport { useViewer } from './hooks/useViewer';\r\nimport { useTools } from './hooks/useTools';\r\nimport { useAdjustments } from './hooks/useAdjustments';\r\nimport { useLayers } from './hooks/useLayers';\r\nimport { useCrop } from './hooks/useCrop';\r\nimport { usePerspective } from './hooks/usePerspective';\r\nimport { useDrawing } from './hooks/useDrawing';\r\nimport { useTextTool } from './hooks/useTextTool';\r\nimport { useEditorState } from './hooks/useEditorState';\r\nimport { getTourSteps } from './tourSteps';\r\nimport { EditorState, Layer } from '../../types';\r\n//#endregion\r\n\r\nconst ImageEditor: React.FC<ImageEditorProps> = ({\r\n  imageUrl,\r\n  addOnFile,\r\n  setAddOnFile,\r\n  onExport,\r\n  onSave,\r\n  initialState,\r\n  settings,\r\n}) => {\r\n  //#region Canvas Setup\r\n  const containerRef = useRef<HTMLDivElement | null>(null);\r\n  const onLoad = (dataUrl: string) => history.push(dataUrl, 'Initial load');\r\n  const { canvasRef, overlayRef, baseCanvas, setBaseCanvas, syncCanvasSize } = useCanvas(\r\n    imageUrl,\r\n    onLoad,\r\n  );\r\n  const history = useHistory(canvasRef, overlayRef, settings.maxHistory);\r\n  const isDirtyRef = useRef(false);\r\n  //#endregion\r\n\r\n  //#region Hooks\r\n  const tools = useTools();\r\n  const viewer = useViewer(containerRef, canvasRef, tools.tool);\r\n  const adjustments = useAdjustments();\r\n  const layersState = useLayers();\r\n  const cropState = useCrop();\r\n  const perspectiveState = usePerspective();\r\n  const drawingState = useDrawing();\r\n  const textToolState = useTextTool();\r\n  const editorState = useEditorState();\r\n  //#endregion\r\n\r\n  // Destructure for easier access\r\n  const { zoom, setZoom, offset, setOffset, isPanning, setIsPanning, panStart } = viewer;\r\n  const { tool, setTool, setToolBefore, setIsSpaceDown, setIsAltDown, setIsShiftDown } = tools;\r\n  const {\r\n    brightness,\r\n    setBrightness,\r\n    contrast,\r\n    setContrast,\r\n    highlights,\r\n    setHighlights,\r\n    shadows,\r\n    setShadows,\r\n    whites,\r\n    setWhites,\r\n    blacks,\r\n    setBlacks,\r\n    vibrance,\r\n    setVibrance,\r\n    saturation,\r\n    setSaturation,\r\n    dehaze,\r\n    setDehaze,\r\n    blur,\r\n    setBlur,\r\n    gaussian,\r\n    setGaussian,\r\n    sharpen,\r\n    setSharpen,\r\n    texture,\r\n    setTexture,\r\n    clarity,\r\n    setClarity,\r\n    bgThreshold,\r\n    setBgThreshold,\r\n    bgThresholdBlack,\r\n    setBgThresholdBlack,\r\n    hslAdjustments,\r\n    setHslAdjustmentsState,\r\n    setHslAdjustments,\r\n  } = adjustments;\r\n  const {\r\n    layers,\r\n    setLayers,\r\n    activeLayerId,\r\n    setActiveLayerId,\r\n    overlaySelected,\r\n    setOverlaySelected,\r\n    overlayDrag,\r\n    overlayResize,\r\n    overlayRotate,\r\n  } = layersState;\r\n  const { cropRect, setCropRect, cropStart, showCropModal, setShowCropModal } = cropState;\r\n  const {\r\n    showPerspectiveModal,\r\n    setShowPerspectiveModal,\r\n    perspectivePoints,\r\n    ensurePerspectiveInit,\r\n    findNearPointIndex,\r\n  } = perspectiveState;\r\n  const {\r\n    drawColor,\r\n    setDrawColor,\r\n    drawLineWidth,\r\n    setDrawLineWidth,\r\n    brushType,\r\n    setBrushType,\r\n    brushOpacity,\r\n    setBrushOpacity,\r\n    brushFlow,\r\n    setBrushFlow,\r\n    isDrawing,\r\n    setIsDrawing,\r\n    drawPoints,\r\n    resizingBrush,\r\n    resizeStartX,\r\n    initialLineWidth,\r\n  } = drawingState;\r\n  const {\r\n    textContent,\r\n    setTextContent,\r\n    textFont,\r\n    setTextFont,\r\n    textFontSize,\r\n    setTextFontSize,\r\n    textColor,\r\n    setTextColor,\r\n    textWeight,\r\n    setTextWeight,\r\n    textItalic,\r\n    setTextItalic,\r\n    textDecoration,\r\n    setTextDecoration,\r\n    textAlign,\r\n    setTextAlign,\r\n    isAddingText,\r\n    setIsAddingText,\r\n    inlineEditorRef,\r\n  } = textToolState;\r\n  const {\r\n    hoverColor,\r\n    setHoverColor,\r\n    pickedColor,\r\n    setPickedColor,\r\n    showColorRemovalModal,\r\n    setShowColorRemovalModal,\r\n    selectedColorForRemoval,\r\n    setSelectedColorForRemoval,\r\n    showLayerMaskModal,\r\n    setShowLayerMaskModal,\r\n    maskEditingLayerId,\r\n    setMaskEditingLayerId,\r\n    showLayerEffectModal,\r\n    setShowLayerEffectModal,\r\n    effectEditingLayerId,\r\n    setEffectEditingLayerId,\r\n    rulerPoints,\r\n    dpiMeasured,\r\n    setDpiMeasured,\r\n    showExportModal,\r\n    setShowExportModal,\r\n    openTour,\r\n    setOpenTour,\r\n    toolbarRef,\r\n    sidebarRef,\r\n    canvasContainerRef,\r\n  } = editorState;\r\n\r\n  // --- overlay image handlers (delegated to helpers) ---\r\n  useEffect(() => {\r\n    if (addOnFile) {\r\n      onAddImage(addOnFile);\r\n      setAddOnFile(null);\r\n    }\r\n  }, [addOnFile]);\r\n\r\n  // Ensure base overlay layer exists (locked, opacity 0) so overlay tools can reference it\r\n  useEffect(() => {\r\n    if (!baseCanvas) return;\r\n    setLayers((prev) => {\r\n      if (prev[0] && prev[0].locked) return prev;\r\n      const img = new Image();\r\n      img.src = baseCanvas.toDataURL();\r\n      const id = `base_overlay_${Date.now()}`;\r\n      const baseLayer = {\r\n        id,\r\n        type: 'image' as const,\r\n        img,\r\n        rect: { x: 0, y: 0, w: baseCanvas.width, h: baseCanvas.height },\r\n        opacity: 0,\r\n        blend: 'source-over' as const,\r\n        locked: true,\r\n      } as any;\r\n      return [baseLayer, ...prev];\r\n    });\r\n    // redraw overlay and sync sizes\r\n    setTimeout(() => {\r\n      try {\r\n        syncCanvasSize();\r\n        drawOverlay();\r\n      } catch (_) {}\r\n    }, 50);\r\n  }, [baseCanvas]);\r\n\r\n  const onAddImage = (file: File) =>\r\n    addOverlayImage(\r\n      file,\r\n      canvasRef,\r\n      setLayers,\r\n      setActiveLayerId,\r\n      setOverlaySelected,\r\n      drawOverlay,\r\n      setTool,\r\n    );\r\n\r\n  const exportWithOverlay = async (\r\n    asJpeg: boolean,\r\n    canvasRefArg: React.RefObject<HTMLCanvasElement>,\r\n    callback?: (blob: Blob) => void,\r\n    includeOverlays: boolean = true,\r\n  ) => helperExportWithOverlay(asJpeg, canvasRefArg, includeOverlays ? layers : [], callback);\r\n\r\n  // Merge active layer into base canvas and record history\r\n  const mergeLayerIntoBase = (id?: string) =>\r\n    helperMergeLayerIntoBase(canvasRef, layers, setLayers, history, id);\r\n\r\n  // Layer controls\r\n  const setLayerOpacity = (id: string, opacity: number) =>\r\n    helperSetLayerOpacity(setLayers, id, opacity);\r\n  const setLayerBlend = (id: string, blend: GlobalCompositeOperation) =>\r\n    helperSetLayerBlend(setLayers, id, blend);\r\n  const moveLayerUp = (id: string) => helperMoveLayerUp(setLayers, id);\r\n  const moveLayerDown = (id: string) => helperMoveLayerDown(setLayers, id);\r\n  const deleteLayer = (id: string) => helperDeleteLayer(setLayers, id, setActiveLayerId);\r\n  const selectLayer = (id: string) => {\r\n    helperSelectLayer(setActiveLayerId, id);\r\n    setOverlaySelected(true);\r\n    // when selecting a text layer, populate toolbar globals so controls reflect the layer\r\n    const layer = layers.find((l) => l.id === id);\r\n    if (layer && layer.type === 'text') {\r\n      setTextContent(layer.text || '');\r\n      setTextFont(layer.font || 'Arial');\r\n      setTextFontSize(layer.fontSize || 32);\r\n      setTextColor(layer.textColor || '#000000');\r\n      setTextWeight(layer.fontWeight || 'normal');\r\n      setTextItalic(Boolean(layer.fontItalic));\r\n      setTextDecoration((layer.textDecoration as any) || 'none');\r\n      setTextAlign((layer.textAlign as any) || 'left');\r\n    }\r\n  };\r\n\r\n  // Text tool callbacks\r\n  const onAddTextLayer = () => {\r\n    setIsAddingText(true);\r\n    message.info('Click on the image to place the text');\r\n  };\r\n\r\n  const updateTextContent = (id: string, text: string) => helperSetLayerText(setLayers, id, text);\r\n  const updateTextFont = (id: string, font: string) => helperSetLayerFont(setLayers, id, font);\r\n  const updateTextFontSize = (id: string, size: number) =>\r\n    helperSetLayerFontSize(setLayers, id, size);\r\n  const updateTextWeight = (id: string, weight: any) =>\r\n    helperSetLayerFontWeight(setLayers, id, weight);\r\n  const updateTextItalic = (id: string, italic: boolean) =>\r\n    helperSetLayerFontItalic(setLayers, id, italic);\r\n  const updateTextDecoration = (id: string, decoration: 'none' | 'underline' | 'line-through') =>\r\n    helperSetLayerTextDecoration(setLayers, id, decoration);\r\n  const updateTextColor = (id: string, color: string) =>\r\n    helperSetLayerTextColor(setLayers, id, color);\r\n  const updateTextAlign = (id: string, align: 'left' | 'center' | 'right') =>\r\n    helperSetLayerTextAlign(setLayers, id, align);\r\n\r\n  // wrapper setters\r\n  const handleSetTextContent = (v: string) => {\r\n    const active = layers.find((l) => l.id === activeLayerId);\r\n    if (active && active.type === 'text') updateTextContent(active.id, v);\r\n    else setTextContent(v);\r\n  };\r\n  const handleSetTextFont = (v: string) => {\r\n    const active = layers.find((l) => l.id === activeLayerId);\r\n    if (active && active.type === 'text') updateTextFont(active.id, v);\r\n    else setTextFont(v);\r\n  };\r\n  const handleSetTextFontSize = (v: number) => {\r\n    const active = layers.find((l) => l.id === activeLayerId);\r\n    if (active && active.type === 'text') updateTextFontSize(active.id, v);\r\n    else setTextFontSize(v);\r\n  };\r\n  const handleSetTextWeight = (v: any) => {\r\n    const active = layers.find((l) => l.id === activeLayerId);\r\n    if (active && active.type === 'text') updateTextWeight(active.id, v);\r\n    else setTextWeight(v);\r\n  };\r\n  const handleSetTextItalic = (v: boolean) => {\r\n    const active = layers.find((l) => l.id === activeLayerId);\r\n    if (active && active.type === 'text') updateTextItalic(active.id, v);\r\n    else setTextItalic(v);\r\n  };\r\n  const handleSetTextDecoration = (v: 'none' | 'underline' | 'line-through') => {\r\n    const active = layers.find((l) => l.id === activeLayerId);\r\n    if (active && active.type === 'text') updateTextDecoration(active.id, v);\r\n    else setTextDecoration(v);\r\n  };\r\n  const handleSetTextColor = (v: string) => {\r\n    const active = layers.find((l) => l.id === activeLayerId);\r\n    if (active && active.type === 'text') updateTextColor(active.id, v);\r\n    else setTextColor(v);\r\n  };\r\n  const handleSetTextAlign = (v: 'left' | 'center' | 'right') => {\r\n    const active = layers.find((l) => l.id === activeLayerId);\r\n    if (active && active.type === 'text') updateTextAlign(active.id, v);\r\n    else setTextAlign(v);\r\n  };\r\n\r\n  //#region Layer Mask Handlers\r\n  const handleOpenMaskTool = (layerId: string) => {\r\n    setMaskEditingLayerId(layerId);\r\n    setShowLayerMaskModal(true);\r\n  };\r\n\r\n  const handleOpenLayerEffects = () => {\r\n    if (!activeLayerId) {\r\n      message.warning('Please select a layer first');\r\n      return;\r\n    }\r\n    const layer = layers.find((l) => l.id === activeLayerId);\r\n    if (!layer || layer.type !== 'image') {\r\n      message.warning('Effects can only be applied to image layers');\r\n      return;\r\n    }\r\n    setEffectEditingLayerId(activeLayerId);\r\n    setShowLayerEffectModal(true);\r\n  };\r\n\r\n  const handleApplyLayerEffects = (newImage: HTMLImageElement) => {\r\n    if (!effectEditingLayerId) return;\r\n\r\n    setLayers((prev) => {\r\n      return prev.map((l) => {\r\n        if (l.id === effectEditingLayerId) {\r\n          return {\r\n            ...l,\r\n            img: newImage,\r\n          };\r\n        }\r\n        return l;\r\n      });\r\n    });\r\n\r\n    // Update overlay immediately\r\n    setTimeout(() => {\r\n      drawOverlay();\r\n    }, 0);\r\n\r\n    setShowLayerEffectModal(false);\r\n    setEffectEditingLayerId(null);\r\n  };\r\n\r\n  const handleApplyMask = (maskCanvas: HTMLCanvasElement) => {\r\n    if (!maskEditingLayerId) return;\r\n\r\n    const layer = layers.find((l) => l.id === maskEditingLayerId);\r\n    if (!layer || layer.type !== 'image' || !layer.img) {\r\n      message.error('Can only apply mask to image layers');\r\n      return;\r\n    }\r\n\r\n    // Convert the black/white mask to an alpha mask\r\n    const alphaMaskCanvas = document.createElement('canvas');\r\n    alphaMaskCanvas.width = maskCanvas.width;\r\n    alphaMaskCanvas.height = maskCanvas.height;\r\n    const amCtx = alphaMaskCanvas.getContext('2d')!;\r\n    amCtx.drawImage(maskCanvas, 0, 0);\r\n\r\n    const maskImageData = amCtx.getImageData(0, 0, alphaMaskCanvas.width, alphaMaskCanvas.height);\r\n    const data = maskImageData.data;\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      // Use Red channel as Alpha (White=255=Opaque, Black=0=Transparent)\r\n      const brightness = data[i];\r\n      data[i + 3] = brightness;\r\n    }\r\n    amCtx.putImageData(maskImageData, 0, 0);\r\n\r\n    setLayers((prev) => {\r\n      const newLayers = prev.map((l) => {\r\n        if (l.id === maskEditingLayerId) {\r\n          return {\r\n            ...l,\r\n            mask: alphaMaskCanvas,\r\n          };\r\n        }\r\n        return l;\r\n      });\r\n\r\n      // Update overlay immediately with new layers\r\n      drawOverlayHelper(overlayRef, canvasRef, {\r\n        zoom,\r\n        cropRect,\r\n        rulerPoints: rulerPoints.current,\r\n        perspectivePoints: perspectivePoints.current,\r\n        hoverColor,\r\n        tool,\r\n        drawColor,\r\n        drawLineWidth,\r\n        layers: newLayers,\r\n        overlaySelected,\r\n        activeLayerId,\r\n      });\r\n\r\n      return newLayers;\r\n    });\r\n\r\n    setShowLayerMaskModal(false);\r\n    setMaskEditingLayerId(null);\r\n    message.success('Mask applied to layer');\r\n  };\r\n\r\n  const getMaskEditingLayer = (): Layer | undefined => {\r\n    return layers.find((l) => l.id === maskEditingLayerId);\r\n  };\r\n\r\n  const getMaskSourceCanvas = (): HTMLCanvasElement | null => {\r\n    const layer = getMaskEditingLayer();\r\n    if (!layer) return null;\r\n\r\n    // Create a temporary canvas with the layer content\r\n    const tempCanvas = document.createElement('canvas');\r\n    if (layer.type === 'image' && layer.img) {\r\n      tempCanvas.width = layer.img.width;\r\n      tempCanvas.height = layer.img.height;\r\n      const ctx = tempCanvas.getContext('2d')!;\r\n      ctx.drawImage(layer.img, 0, 0);\r\n    } else if (layer.type === 'text') {\r\n      // For text layers, render the text to a canvas\r\n      tempCanvas.width = layer.rect.w;\r\n      tempCanvas.height = layer.rect.h;\r\n      const ctx = tempCanvas.getContext('2d')!;\r\n      ctx.fillStyle = '#ffffff';\r\n      ctx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);\r\n      const fontStyle = layer.fontItalic ? 'italic' : 'normal';\r\n      const fontWeight = layer.fontWeight || 'normal';\r\n      const fontSize = layer.fontSize || 16;\r\n      ctx.font = `${fontStyle} ${fontWeight} ${fontSize}px ${layer.font || 'Arial'}`;\r\n      ctx.fillStyle = layer.textColor || '#000000';\r\n      ctx.textAlign = layer.textAlign || 'left';\r\n      ctx.textBaseline = 'top';\r\n      const lines = (layer.text || '').split('\\n');\r\n      const lineHeight = fontSize * 1.2;\r\n      let currentY = 0;\r\n      for (const line of lines) {\r\n        ctx.fillText(line, 0, currentY);\r\n        currentY += lineHeight;\r\n      }\r\n    }\r\n    return tempCanvas;\r\n  };\r\n  //#endregion\r\n\r\n  //#region Upscale\r\n  // Upscale whole image: delegated to helpers.applyUpscale\r\n  const upscaleImage = (\r\n    factor: number,\r\n    preset?: 'low' | 'medium' | 'high',\r\n    qualityOptions?: { sharpen?: number; edgeEnhancement?: number; denoise?: number },\r\n  ) =>\r\n    applyUpscale(\r\n      canvasRef,\r\n      overlayRef,\r\n      history,\r\n      setBaseCanvas,\r\n      setLayers,\r\n      drawOverlay,\r\n      factor,\r\n      preset,\r\n      qualityOptions,\r\n    );\r\n  //#endregion\r\n\r\n  //#region Sync base canvas when in upscaled mode\r\n  useEffect(() => {\r\n    if (!canvasRef.current) return;\r\n\r\n    if (!history.history[history.index]?.isSetBase) return;\r\n\r\n    const src = canvasRef.current;\r\n    const c = document.createElement('canvas');\r\n    c.width = src.width;\r\n    c.height = src.height;\r\n    c.getContext('2d')!.drawImage(src, 0, 0);\r\n\r\n    setBaseCanvas(c);\r\n    setLayers((prev) => {\r\n      if (!prev[0]) return prev;\r\n      const base = { ...prev[0] };\r\n      if (base.img) base.img.src = c.toDataURL();\r\n      base.rect = { x: 0, y: 0, w: c.width, h: c.height };\r\n      // base.opacity = 1;\r\n      return [base, ...prev.slice(1)];\r\n    });\r\n\r\n    if (overlayRef.current) {\r\n      overlayRef.current.width = c.width;\r\n      overlayRef.current.height = c.height;\r\n    }\r\n\r\n    drawOverlay();\r\n  }, [history.index]);\r\n  //#endregion\r\n\r\n  //#region Save & Restore\r\n  useEffect(() => {\r\n    if (initialState) {\r\n      setBrightness(initialState.brightness);\r\n      setContrast(initialState.contrast);\r\n      setHighlights(initialState.highlights);\r\n      setShadows(initialState.shadows);\r\n      setWhites(initialState.whites);\r\n      setBlacks(initialState.blacks);\r\n      setVibrance(initialState.vibrance);\r\n      setSaturation(initialState.saturation);\r\n      setDehaze(initialState.dehaze);\r\n      setBlur(initialState.blur);\r\n      setGaussian(initialState.gaussian);\r\n      setSharpen(initialState.sharpen);\r\n      setTexture(initialState.texture);\r\n      setClarity(initialState.clarity);\r\n      setBgThreshold(initialState.bgThreshold);\r\n      setBgThresholdBlack(initialState.bgThresholdBlack);\r\n      setHslAdjustmentsState(initialState.hslAdjustments);\r\n\r\n      // Hydrate layers\r\n      const hydratedLayers = initialState.layers.map((l: any) => {\r\n        const layer = { ...l };\r\n        if (l.type === 'image' && l.imgSrc) {\r\n          const img = new Image();\r\n          img.src = l.imgSrc;\r\n          layer.img = img;\r\n        }\r\n        if (l.maskSrc) {\r\n          const maskCanvas = document.createElement('canvas');\r\n          const maskImg = new Image();\r\n          maskImg.onload = () => {\r\n            maskCanvas.width = maskImg.width;\r\n            maskCanvas.height = maskImg.height;\r\n            const ctx = maskCanvas.getContext('2d');\r\n            ctx?.drawImage(maskImg, 0, 0);\r\n          };\r\n          maskImg.src = l.maskSrc;\r\n          layer.mask = maskCanvas;\r\n        }\r\n        return layer;\r\n      });\r\n      setLayers(hydratedLayers);\r\n\r\n      // Reset dirty flag after hydration\r\n      setTimeout(() => {\r\n        isDirtyRef.current = false;\r\n      }, 0);\r\n    }\r\n  }, [initialState]);\r\n\r\n  // Track changes for auto-save\r\n  useEffect(() => {\r\n    isDirtyRef.current = true;\r\n  }, [\r\n    layers,\r\n    brightness,\r\n    contrast,\r\n    highlights,\r\n    shadows,\r\n    whites,\r\n    blacks,\r\n    vibrance,\r\n    saturation,\r\n    dehaze,\r\n    blur,\r\n    gaussian,\r\n    sharpen,\r\n    texture,\r\n    clarity,\r\n    bgThreshold,\r\n    bgThresholdBlack,\r\n    hslAdjustments,\r\n  ]);\r\n\r\n  const handleSave = () => {\r\n    if (!onSave) return;\r\n\r\n    // Serialize layers\r\n    const serializedLayers = layers.map((l) => {\r\n      const serialized: any = { ...l };\r\n      if (l.img) {\r\n        serialized.imgSrc = l.img.src;\r\n        delete serialized.img;\r\n      }\r\n      if (l.mask) {\r\n        serialized.maskSrc = l.mask.toDataURL();\r\n        delete serialized.mask;\r\n      }\r\n      return serialized;\r\n    });\r\n\r\n    const state: EditorState = {\r\n      layers: serializedLayers,\r\n      brightness,\r\n      contrast,\r\n      highlights,\r\n      shadows,\r\n      whites,\r\n      blacks,\r\n      vibrance,\r\n      saturation,\r\n      dehaze,\r\n      blur,\r\n      gaussian,\r\n      sharpen,\r\n      texture,\r\n      clarity,\r\n      bgThreshold,\r\n      bgThresholdBlack,\r\n      hslAdjustments,\r\n    };\r\n    onSave(state);\r\n    isDirtyRef.current = false;\r\n  };\r\n\r\n  // Auto-save effect\r\n  useEffect(() => {\r\n    if (settings.autoSaveInterval > 0 && onSave) {\r\n      const intervalId = setInterval(\r\n        () => {\r\n          if (isDirtyRef.current) {\r\n            handleSave();\r\n            message.success('Auto-saved project');\r\n          }\r\n        },\r\n        settings.autoSaveInterval * 60 * 1000,\r\n      );\r\n\r\n      return () => clearInterval(intervalId);\r\n    }\r\n  }, [\r\n    settings.autoSaveInterval,\r\n    onSave,\r\n    // Dependencies for handleSave (recreated on every render due to closure)\r\n    layers,\r\n    brightness,\r\n    contrast,\r\n    highlights,\r\n    shadows,\r\n    whites,\r\n    blacks,\r\n    vibrance,\r\n    saturation,\r\n    dehaze,\r\n    blur,\r\n    gaussian,\r\n    sharpen,\r\n    texture,\r\n    clarity,\r\n    bgThreshold,\r\n    bgThresholdBlack,\r\n    hslAdjustments,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if ((e.ctrlKey || e.metaKey) && e.key === 's') {\r\n        e.preventDefault();\r\n        handleSave();\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [\r\n    layers,\r\n    brightness,\r\n    contrast,\r\n    highlights,\r\n    shadows,\r\n    whites,\r\n    blacks,\r\n    vibrance,\r\n    saturation,\r\n    dehaze,\r\n    blur,\r\n    gaussian,\r\n    sharpen,\r\n    texture,\r\n    clarity,\r\n    bgThreshold,\r\n    bgThresholdBlack,\r\n    hslAdjustments,\r\n  ]);\r\n  //#endregion\r\n\r\n  //#region Event Effects & Handlers\r\n  // #region 🖱️ Disable Right-Click Context Menu\r\n  useEffect(() => {\r\n    const canvas = containerRef.current;\r\n    if (!canvas) return;\r\n    const handleContextMenu = (e: MouseEvent) => e.preventDefault();\r\n    canvas.addEventListener('contextmenu', handleContextMenu);\r\n    return () => canvas.removeEventListener('contextmenu', handleContextMenu);\r\n  }, []);\r\n  //#endregion\r\n\r\n  // Note: Ctrl+Wheel Zoom is now handled in useViewer hook\r\n\r\n  //#region 🖲️ Mouse Events (Down/Move/Up for Tools)\r\n  const handleMouseDownViewer = (e: React.MouseEvent) => {\r\n    const rect = canvasRef.current!.getBoundingClientRect();\r\n    const x = (e.clientX - rect.left) / zoom;\r\n    const y = (e.clientY - rect.top) / zoom;\r\n    const canvasRect = rect;\r\n    // helper: create inline textarea overlay at canvas coords\r\n    const createEditorAt = (\r\n      canvasX: number,\r\n      canvasY: number,\r\n      initial = '',\r\n      opts?: { layerId?: string; layer?: any },\r\n    ) => {\r\n      createTextEditorOverlay({\r\n        canvasX,\r\n        canvasY,\r\n        canvasRect,\r\n        containerRef,\r\n        inlineEditorRef,\r\n        zoom,\r\n        initial,\r\n        layerId: opts?.layerId,\r\n        layer: opts?.layer,\r\n        textColor,\r\n        textFont,\r\n        textFontSize,\r\n        textWeight,\r\n        textItalic,\r\n        onCommit: (val) => {\r\n          if (opts && opts.layerId) {\r\n            // editing existing layer\r\n            helperSetLayerText(setLayers, opts.layerId, val);\r\n            drawOverlay();\r\n          } else {\r\n            // add layer with position in canvas coords\r\n            helperAddTextLayer(\r\n              canvasRef,\r\n              setLayers,\r\n              setActiveLayerId,\r\n              setOverlaySelected,\r\n              drawOverlay,\r\n              {\r\n                text: val,\r\n                font: textFont,\r\n                fontSize: textFontSize,\r\n                fontWeight: textWeight,\r\n                fontItalic: textItalic,\r\n                textDecoration: textDecoration,\r\n                textColor: textColor,\r\n                textAlign: textAlign,\r\n              },\r\n              { x: canvasX, y: canvasY },\r\n            );\r\n          }\r\n          setIsAddingText(false);\r\n        },\r\n        onCancel: () => {\r\n          setIsAddingText(false);\r\n        },\r\n      });\r\n    };\r\n\r\n    // Helper to transform point by rotation around center\r\n    const rotatePoint = (px: number, py: number, cx: number, cy: number, angle: number) => {\r\n      const rad = (angle * Math.PI) / 180;\r\n      const cos = Math.cos(rad);\r\n      const sin = Math.sin(rad);\r\n      const dx = px - cx;\r\n      const dy = py - cy;\r\n      return {\r\n        x: cx + dx * cos - dy * sin,\r\n        y: cy + dx * sin + dy * cos,\r\n      };\r\n    };\r\n\r\n    // overlay hit-test (priority: if clicking overlay and not using pan tool)\r\n    // overlay hit-test (topmost first)\r\n    if (layers.length > 0) {\r\n      for (let i = layers.length - 1; i >= 0; i--) {\r\n        const L = layers[i];\r\n        const r = L.rect;\r\n        const rotation = L.rotation || 0;\r\n        const centerX = r.x + r.w / 2;\r\n        const centerY = r.y + r.h / 2;\r\n\r\n        // Transform mouse position by inverse rotation to check against unrotated rect\r\n        const inverseMouse = rotatePoint(x, y, centerX, centerY, -rotation);\r\n\r\n        // detect inside area with tolerance\r\n        const hitTol = 6 / Math.max(1, zoom);\r\n        const inside =\r\n          inverseMouse.x >= r.x - hitTol &&\r\n          inverseMouse.y >= r.y - hitTol &&\r\n          inverseMouse.x <= r.x + r.w + hitTol &&\r\n          inverseMouse.y <= r.y + r.h + hitTol;\r\n        if (!inside) continue;\r\n\r\n        // detect corner handles - transform corners to rotated positions\r\n        const tol = 8 / Math.max(1, zoom);\r\n        const corners = {\r\n          tl: rotatePoint(r.x, r.y, centerX, centerY, rotation),\r\n          tr: rotatePoint(r.x + r.w, r.y, centerX, centerY, rotation),\r\n          bl: rotatePoint(r.x, r.y + r.h, centerX, centerY, rotation),\r\n          br: rotatePoint(r.x + r.w, r.y + r.h, centerX, centerY, rotation),\r\n        };\r\n        const midpoints = {\r\n          t: rotatePoint(r.x + r.w / 2, r.y, centerX, centerY, rotation),\r\n          b: rotatePoint(r.x + r.w / 2, r.y + r.h, centerX, centerY, rotation),\r\n          l: rotatePoint(r.x, r.y + r.h / 2, centerX, centerY, rotation),\r\n          r: rotatePoint(r.x + r.w, r.y + r.h / 2, centerX, centerY, rotation),\r\n        };\r\n\r\n        const near = (px: number, py: number) => Math.abs(x - px) <= tol && Math.abs(y - py) <= tol;\r\n        const tl = near(corners.tl.x, corners.tl.y);\r\n        const tr = near(corners.tr.x, corners.tr.y);\r\n        const bl = near(corners.bl.x, corners.bl.y);\r\n        const br = near(corners.br.x, corners.br.y);\r\n\r\n        // If double-clicking a text layer while in text tool, open inline editor for editing\r\n        if (tool === 'text' && L.type === 'text' && e.detail === 2) {\r\n          setActiveLayerId(L.id);\r\n          setOverlaySelected(true);\r\n          // open editor via helper (edit existing layer)\r\n          createEditorAt(x, y, L.text || '', { layerId: L.id, layer: L });\r\n          return;\r\n        }\r\n\r\n        // Allow moving/resizing for layers when tool is 'move', or when tool is 'text' and the layer is a text layer\r\n        if (tool === 'layer' || (tool === 'text' && L.type === 'text')) {\r\n          setActiveLayerId(L.id);\r\n          setOverlaySelected(true);\r\n\r\n          // Check for midpoint handles (using rotated positions)\r\n          const midT = near(midpoints.t.x, midpoints.t.y);\r\n          const midB = near(midpoints.b.x, midpoints.b.y);\r\n          const midL = near(midpoints.l.x, midpoints.l.y);\r\n          const midR = near(midpoints.r.x, midpoints.r.y);\r\n\r\n          if (midT || midB || midL || midR) {\r\n            const handle = midT ? 't' : midB ? 'b' : midL ? 'l' : 'r';\r\n            overlayResize.current = {\r\n              layerId: L.id,\r\n              handle,\r\n              startX: x,\r\n              startY: y,\r\n              orig: { ...r },\r\n            } as any;\r\n            return;\r\n          }\r\n\r\n          if (tl || tr || bl || br) {\r\n            // Check if holding Shift for rotation in corners\r\n            if (e.shiftKey) {\r\n              const startAngle = Math.atan2(y - centerY, x - centerX);\r\n              overlayRotate.current = {\r\n                layerId: L.id,\r\n                startX: x,\r\n                startY: y,\r\n                centerX,\r\n                centerY,\r\n                startAngle,\r\n                originalRotation: L.rotation || 0,\r\n              };\r\n              return;\r\n            }\r\n\r\n            const handle = tl ? 'tl' : tr ? 'tr' : bl ? 'bl' : 'br';\r\n            overlayResize.current = {\r\n              layerId: L.id,\r\n              handle,\r\n              startX: x,\r\n              startY: y,\r\n              orig: { ...r },\r\n            } as any;\r\n            return;\r\n          }\r\n          overlayDrag.current = {\r\n            layerId: L.id,\r\n            startX: x,\r\n            startY: y,\r\n            origX: r.x,\r\n            origY: r.y,\r\n          } as any;\r\n          return;\r\n        }\r\n        // if pan tool, ignore overlay so pan will take effect\r\n        break;\r\n      }\r\n      // if clicked outside any layer\r\n      setOverlaySelected(false);\r\n    }\r\n\r\n    if (tool === 'color' && e.altKey && e.button === 2) setTool('draw');\r\n    // ALT + right button for brush resize\r\n    if ((tool === 'draw' || tool === 'color') && e.altKey && e.button === 2) {\r\n      e.preventDefault();\r\n      resizingBrush.current = true;\r\n      resizeStartX.current = e.clientX;\r\n      initialLineWidth.current = drawLineWidth;\r\n      return;\r\n    }\r\n\r\n    if (tool === 'pan' || tool === 'select') {\r\n      setIsPanning(true);\r\n      panStart.current = { x: e.clientX - offset.x, y: e.clientY - offset.y };\r\n    } else if (tool === 'crop') {\r\n      cropStart.current = { x, y };\r\n      setCropRect({ x, y, w: 1, h: 1 });\r\n    } else if (tool === 'ruler') {\r\n      if (!rulerPoints.current) {\r\n        rulerPoints.current = { x1: x, y1: y, x2: x, y2: y };\r\n      } else {\r\n        rulerPoints.current.x2 = x;\r\n        rulerPoints.current.y2 = y;\r\n        const dx = x - rulerPoints.current.x1;\r\n        const dy = y - rulerPoints.current.y1;\r\n        const px = Math.sqrt(dx * dx + dy * dy);\r\n        const dpi = Math.round(\r\n          (px / (canvasRef.current!.width / (window.devicePixelRatio || 1))) * 96,\r\n        );\r\n        setDpiMeasured(dpi);\r\n        message.info(`Distance: ${Math.round(px)} px, estimated DPI: ${dpi}`);\r\n        rulerPoints.current = null;\r\n      }\r\n    } else if (tool === 'perspective') {\r\n      // initialize if needed\r\n      ensurePerspectiveInit();\r\n\r\n      // if click near an existing point, replace/move it\r\n      const nearIdx = findNearPointIndex(x, y);\r\n      if (nearIdx >= 0) {\r\n        // move existing point\r\n        perspectivePoints.current![nearIdx] = x;\r\n        perspectivePoints.current![nearIdx + 1] = y;\r\n        drawOverlay();\r\n        return;\r\n      }\r\n\r\n      // otherwise, fill first empty (NaN) slot\r\n      const p = perspectivePoints.current!;\r\n      let placed = false;\r\n      for (let i = 0; i < 8; i += 2) {\r\n        if (isNaN(p[i]) || isNaN(p[i + 1])) {\r\n          p[i] = x;\r\n          p[i + 1] = y;\r\n          placed = true;\r\n          break;\r\n        }\r\n      }\r\n      // if all filled and user clicks again, cycle replace the nearest point\r\n      if (!placed) {\r\n        const nearest = findNearPointIndex(x, y, 200); // large tol to find nearest\r\n        if (nearest >= 0) {\r\n          perspectivePoints.current![nearest] = x;\r\n          perspectivePoints.current![nearest + 1] = y;\r\n        } else {\r\n          // replace index 0 (wrap) if nothing better\r\n          perspectivePoints.current![0] = x;\r\n          perspectivePoints.current![1] = y;\r\n        }\r\n      }\r\n\r\n      drawOverlay();\r\n    } else if (tool === 'draw') {\r\n      setIsDrawing(true);\r\n      drawPoints.current = [{ x, y }];\r\n\r\n      // Draw initial dot\r\n      if (canvasRef.current) {\r\n        const ctx = canvasRef.current.getContext('2d')!;\r\n        const settings: BrushSettings = {\r\n          color: drawColor,\r\n          lineWidth: drawLineWidth,\r\n          opacity: brushOpacity,\r\n          flow: brushFlow,\r\n          type: brushType,\r\n        };\r\n        drawBrushStroke(\r\n          ctx,\r\n          [\r\n            { x, y },\r\n            { x, y },\r\n          ],\r\n          settings,\r\n        );\r\n        drawOverlay();\r\n      }\r\n    } else if (tool === 'text') {\r\n      // If text tool is active and user clicked empty canvas, open inline editor to place new text\r\n      createEditorAt(x, y, textContent || '');\r\n      return;\r\n    }\r\n  };\r\n\r\n  const handleMouseMoveViewer = (e: React.MouseEvent) => {\r\n    if (resizingBrush.current && resizeStartX.current !== null) {\r\n      const deltaX = e.clientX - resizeStartX.current;\r\n      const newWidth = Math.max(\r\n        1,\r\n        Math.round(Math.min(500, initialLineWidth.current + deltaX / 2) * 10) / 10,\r\n      );\r\n      setDrawLineWidth(newWidth);\r\n      drawOverlay();\r\n      return;\r\n    }\r\n\r\n    if ((tool === 'pan' || tool === 'select') && isPanning && panStart.current) {\r\n      setOffset({ x: e.clientX - panStart.current.x, y: e.clientY - panStart.current.y });\r\n      return;\r\n    }\r\n\r\n    // pointer / handle hover cursors\r\n    try {\r\n      const rect = canvasRef.current!.getBoundingClientRect();\r\n      const cx = (e.clientX - rect.left) / zoom;\r\n      const cy = (e.clientY - rect.top) / zoom;\r\n      let foundHandle: 'tl' | 'tr' | 'bl' | 'br' | 't' | 'b' | 'l' | 'r' | 'move' | null = null;\r\n\r\n      // Helper to transform point by rotation\r\n      const rotatePoint = (\r\n        px: number,\r\n        py: number,\r\n        centerX: number,\r\n        centerY: number,\r\n        angle: number,\r\n      ) => {\r\n        const rad = (angle * Math.PI) / 180;\r\n        const cos = Math.cos(rad);\r\n        const sin = Math.sin(rad);\r\n        const dx = px - centerX;\r\n        const dy = py - centerY;\r\n        return {\r\n          x: centerX + dx * cos - dy * sin,\r\n          y: centerY + dx * sin + dy * cos,\r\n        };\r\n      };\r\n\r\n      for (let i = layers.length - 1; i >= 0; i--) {\r\n        const L = layers[i];\r\n        const r = L.rect;\r\n        const rotation = L.rotation || 0;\r\n        const centerX = r.x + r.w / 2;\r\n        const centerY = r.y + r.h / 2;\r\n\r\n        if (L.locked || (tool !== 'layer' && tool !== 'text')) {\r\n          foundHandle = null;\r\n          break;\r\n        }\r\n\r\n        // Transform mouse position by inverse rotation\r\n        const inverseMouse = rotatePoint(cx, cy, centerX, centerY, -rotation);\r\n        const inside =\r\n          inverseMouse.x >= r.x &&\r\n          inverseMouse.y >= r.y &&\r\n          inverseMouse.x <= r.x + r.w &&\r\n          inverseMouse.y <= r.y + r.h;\r\n\r\n        const tol = 8 / Math.max(1, zoom);\r\n\r\n        // Transform corners and midpoints to rotated positions\r\n        const corners = {\r\n          tl: rotatePoint(r.x, r.y, centerX, centerY, rotation),\r\n          tr: rotatePoint(r.x + r.w, r.y, centerX, centerY, rotation),\r\n          bl: rotatePoint(r.x, r.y + r.h, centerX, centerY, rotation),\r\n          br: rotatePoint(r.x + r.w, r.y + r.h, centerX, centerY, rotation),\r\n        };\r\n        const midpoints = {\r\n          t: rotatePoint(r.x + r.w / 2, r.y, centerX, centerY, rotation),\r\n          b: rotatePoint(r.x + r.w / 2, r.y + r.h, centerX, centerY, rotation),\r\n          l: rotatePoint(r.x, r.y + r.h / 2, centerX, centerY, rotation),\r\n          r: rotatePoint(r.x + r.w, r.y + r.h / 2, centerX, centerY, rotation),\r\n        };\r\n\r\n        const near = (px: number, py: number) =>\r\n          Math.abs(cx - px) <= tol && Math.abs(cy - py) <= tol;\r\n\r\n        // Check corners\r\n        if (near(corners.tl.x, corners.tl.y)) {\r\n          foundHandle = 'tl';\r\n          break;\r\n        }\r\n        if (near(corners.tr.x, corners.tr.y)) {\r\n          foundHandle = 'tr';\r\n          break;\r\n        }\r\n        if (near(corners.bl.x, corners.bl.y)) {\r\n          foundHandle = 'bl';\r\n          break;\r\n        }\r\n        if (near(corners.br.x, corners.br.y)) {\r\n          foundHandle = 'br';\r\n          break;\r\n        }\r\n\r\n        // Check midpoints\r\n        if (near(midpoints.t.x, midpoints.t.y)) {\r\n          foundHandle = 't';\r\n          break;\r\n        }\r\n        if (near(midpoints.b.x, midpoints.b.y)) {\r\n          foundHandle = 'b';\r\n          break;\r\n        }\r\n        if (near(midpoints.l.x, midpoints.l.y)) {\r\n          foundHandle = 'l';\r\n          break;\r\n        }\r\n        if (near(midpoints.r.x, midpoints.r.y)) {\r\n          foundHandle = 'r';\r\n          break;\r\n        }\r\n\r\n        if (inside) {\r\n          foundHandle = 'move';\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (containerRef.current) {\r\n        if (!foundHandle) {\r\n          containerRef.current.style.cursor = currentCursor;\r\n        } else if (foundHandle === 'move') {\r\n          containerRef.current.style.cursor = 'move';\r\n        } else if (foundHandle === 't' || foundHandle === 'b') {\r\n          containerRef.current.style.cursor = 'ns-resize';\r\n        } else if (foundHandle === 'l' || foundHandle === 'r') {\r\n          containerRef.current.style.cursor = 'ew-resize';\r\n        } else if (\r\n          e.shiftKey &&\r\n          (foundHandle === 'tl' ||\r\n            foundHandle === 'tr' ||\r\n            foundHandle === 'bl' ||\r\n            foundHandle === 'br')\r\n        ) {\r\n          // Show rotation cursor when shift is held over corners\r\n          containerRef.current.style.cursor = 'crosshair';\r\n        } else if (foundHandle === 'tl' || foundHandle === 'br') {\r\n          containerRef.current.style.cursor = 'nwse-resize';\r\n        } else {\r\n          containerRef.current.style.cursor = 'nesw-resize';\r\n        }\r\n      }\r\n    } catch (err) {\r\n      // ignore\r\n    }\r\n\r\n    // overlay dragging\r\n    const od = overlayDrag.current;\r\n    if (od) {\r\n      const rect = canvasRef.current!.getBoundingClientRect();\r\n      const cx = (e.clientX - rect.left) / zoom;\r\n      const cy = (e.clientY - rect.top) / zoom;\r\n      const dx = cx - od.startX;\r\n      const dy = cy - od.startY;\r\n      setLayers((prev) =>\r\n        prev.map((L) =>\r\n          L.id === od.layerId && !L.locked\r\n            ? { ...L, rect: { x: od.origX + dx, y: od.origY + dy, w: L.rect.w, h: L.rect.h } }\r\n            : L,\r\n        ),\r\n      );\r\n      drawOverlay();\r\n      return;\r\n    } else if (tool === 'crop' && cropStart.current) {\r\n      const rect = canvasRef.current!.getBoundingClientRect();\r\n      const cur = { x: (e.clientX - rect.left) / zoom, y: (e.clientY - rect.top) / zoom };\r\n      setCropRect({\r\n        x: Math.min(cropStart.current.x, cur.x),\r\n        y: Math.min(cropStart.current.y, cur.y),\r\n        w: Math.abs(cur.x - cropStart.current.x),\r\n        h: Math.abs(cur.y - cropStart.current.y),\r\n      });\r\n      drawOverlay();\r\n    } else if (tool === 'draw' && isDrawing && canvasRef.current) {\r\n      const rect = canvasRef.current.getBoundingClientRect();\r\n      const x = (e.clientX - rect.left) / zoom;\r\n      const y = (e.clientY - rect.top) / zoom;\r\n\r\n      drawPoints.current.push({ x, y });\r\n\r\n      const ctx = canvasRef.current.getContext('2d')!;\r\n      const settings: BrushSettings = {\r\n        color: drawColor,\r\n        lineWidth: drawLineWidth,\r\n        opacity: brushOpacity,\r\n        flow: brushFlow,\r\n        type: brushType,\r\n      };\r\n\r\n      const points = drawPoints.current;\r\n      drawBrushStroke(ctx, points.slice(-2), settings);\r\n      drawOverlay();\r\n    } else {\r\n      // overlay rotation handling\r\n      const orot = overlayRotate.current;\r\n      if (orot) {\r\n        const rect = canvasRef.current!.getBoundingClientRect();\r\n        const cx = (e.clientX - rect.left) / zoom;\r\n        const cy = (e.clientY - rect.top) / zoom;\r\n        const { layerId, centerX, centerY, startAngle, originalRotation } = orot;\r\n        const currentAngle = Math.atan2(cy - centerY, cx - centerX);\r\n        const angleDelta = (currentAngle - startAngle) * (180 / Math.PI);\r\n\r\n        setLayers((prev) =>\r\n          prev.map((L) => {\r\n            if (L.id !== layerId || L.locked) return L;\r\n            return { ...L, rotation: originalRotation + angleDelta };\r\n          }),\r\n        );\r\n        drawOverlay();\r\n        return;\r\n      }\r\n\r\n      // overlay resize handling (mouse move without active drag)\r\n      const or = overlayResize.current;\r\n      if (or) {\r\n        const rect = canvasRef.current!.getBoundingClientRect();\r\n        const cx = (e.clientX - rect.left) / zoom;\r\n        const cy = (e.clientY - rect.top) / zoom;\r\n        const { layerId, handle, startX, startY, orig } = or;\r\n        // compute new rect depending on handle\r\n        let nx = orig.x;\r\n        let ny = orig.y;\r\n        let nw = orig.w;\r\n        let nh = orig.h;\r\n\r\n        // Handle midpoint resizing (new feature)\r\n        if (handle === 't') {\r\n          // Top midpoint - only move top edge\r\n          ny = cy;\r\n          nh = orig.h + (orig.y - ny);\r\n        } else if (handle === 'b') {\r\n          // Bottom midpoint - only move bottom edge\r\n          nh = cy - orig.y;\r\n        } else if (handle === 'l') {\r\n          // Left midpoint - only move left edge\r\n          nx = cx;\r\n          nw = orig.w + (orig.x - nx);\r\n        } else if (handle === 'r') {\r\n          // Right midpoint - only move right edge\r\n          nw = cx - orig.x;\r\n        } else if (handle === 'tl') {\r\n          nx = cx;\r\n          ny = cy;\r\n          nw = orig.w + (orig.x - nx);\r\n          nh = orig.h + (orig.y - ny);\r\n        } else if (handle === 'tr') {\r\n          ny = cy;\r\n          nw = cx - orig.x;\r\n          nh = orig.h + (orig.y - ny);\r\n        } else if (handle === 'bl') {\r\n          nx = cx;\r\n          nw = orig.w + (orig.x - nx);\r\n          nh = cy - orig.y;\r\n        } else if (handle === 'br') {\r\n          nw = cx - orig.x;\r\n          nh = cy - orig.y;\r\n        }\r\n        // aspect ratio lock when Shift pressed (only for corner handles)\r\n        if (\r\n          e.shiftKey &&\r\n          (handle === 'tl' || handle === 'tr' || handle === 'bl' || handle === 'br')\r\n        ) {\r\n          const aspect = orig.w / Math.max(1, orig.h);\r\n          // derive size by larger delta\r\n          const signW = nw < 0 ? -1 : 1;\r\n          const signH = nh < 0 ? -1 : 1;\r\n          const absW = Math.abs(nw);\r\n          const absH = Math.abs(nh);\r\n          if (absW / Math.max(1, absH) > aspect) {\r\n            // width changed more -> adjust height\r\n            nh = (absW / aspect) * signH;\r\n          } else {\r\n            nw = absH * aspect * signW;\r\n          }\r\n          // when changing top handles, adjust nx/ny to keep corner anchored\r\n          if (handle === 'tl') {\r\n            nx = orig.x + (orig.w - nw);\r\n            ny = orig.y + (orig.h - nh);\r\n          } else if (handle === 'tr') {\r\n            ny = orig.y + (orig.h - nh);\r\n          } else if (handle === 'bl') {\r\n            nx = orig.x + (orig.w - nw);\r\n          }\r\n        }\r\n        // enforce min size\r\n        nw = Math.max(4 / zoom, nw);\r\n        nh = Math.max(4 / zoom, nh);\r\n        setLayers((prev) =>\r\n          prev.map((L) => {\r\n            if (L.id !== layerId) return L;\r\n            if (L.locked) return L;\r\n            // if text layer, also adjust fontSize to roughly match new height\r\n            if (L.type === 'text') {\r\n              const padding = 10; // small padding inside rect\r\n              const newFontSize = Math.max(8, Math.round(Math.max(1, nh) - padding));\r\n              return { ...L, rect: { x: nx, y: ny, w: nw, h: nh }, fontSize: newFontSize };\r\n            }\r\n            return { ...L, rect: { x: nx, y: ny, w: nw, h: nh } };\r\n          }),\r\n        );\r\n        drawOverlay();\r\n        return;\r\n      }\r\n\r\n      drawOverlay();\r\n    }\r\n  };\r\n\r\n  const handleMouseUpViewer = () => {\r\n    if (resizingBrush.current) {\r\n      resizingBrush.current = false;\r\n      resizeStartX.current = null;\r\n      initialLineWidth.current = drawLineWidth;\r\n      return;\r\n    }\r\n    // finalize overlay drag/resize/rotate\r\n    if (overlayDrag.current || overlayResize.current || overlayRotate.current) {\r\n      overlayDrag.current = null;\r\n      overlayResize.current = null;\r\n      overlayRotate.current = null;\r\n      // leave overlaySelected true\r\n      // do not push to history for now (overlay is non-destructive until user exports)\r\n      drawOverlay();\r\n      return;\r\n    }\r\n\r\n    setIsPanning(false);\r\n    panStart.current = null;\r\n    if (tool === 'crop' && cropRect) {\r\n      if (cropRect.w > 5 && cropRect.h > 5) {\r\n        setShowCropModal(true);\r\n      } else {\r\n        setCropRect(null);\r\n      }\r\n    }\r\n    if (tool === 'draw' && isDrawing) {\r\n      setIsDrawing(false);\r\n      history.push(canvasRef.current!.toDataURL(), 'Draw');\r\n    }\r\n  };\r\n  //#endregion\r\n\r\n  //#region 🎨 Draw Overlay Layer (Crop / Ruler / Perspective / Hover Preview)\r\n  const drawOverlay = () => {\r\n    drawOverlayHelper(overlayRef, canvasRef, {\r\n      zoom,\r\n      cropRect,\r\n      rulerPoints: rulerPoints.current,\r\n      perspectivePoints: perspectivePoints.current,\r\n      hoverColor,\r\n      tool: resizingBrush.current ? 'draw' : tool,\r\n      drawColor,\r\n      drawLineWidth,\r\n      layers,\r\n      overlaySelected,\r\n      activeLayerId,\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    drawOverlay();\r\n  }, [cropRect]);\r\n\r\n  //#region 🎯 Color Picker & Hover Preview\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n\r\n    const handleMove = (e: MouseEvent) => {\r\n      if (tool === 'color' || tool === 'removeColor') {\r\n        const color = samplePixel(e, canvasRef, zoom);\r\n        setHoverColor(color ? { x: e.clientX, y: e.clientY, color } : null);\r\n        drawOverlay();\r\n      } else if (tool === 'draw') {\r\n        setHoverColor(drawColor ? { x: e.clientX, y: e.clientY, color: drawColor } : null);\r\n        drawOverlay();\r\n      }\r\n    };\r\n\r\n    const handleClick = (e: MouseEvent) => {\r\n      if (tool === 'color') {\r\n        const color = samplePixel(e, canvasRef, zoom);\r\n        if (color) {\r\n          setPickedColor(color);\r\n          setDrawColor(color);\r\n          navigator.clipboard.writeText(color).catch(() => {});\r\n          message.success(`Picked color ${color}`);\r\n        }\r\n      } else if (tool === 'removeColor') {\r\n        const color = samplePixel(e, canvasRef, zoom);\r\n        if (color) {\r\n          setSelectedColorForRemoval(color);\r\n          setShowColorRemovalModal(true);\r\n          setTool('pan'); // Switch back to pan after picking color\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleLeave = () => {\r\n      if (tool === 'color' || tool === 'removeColor') setHoverColor(null);\r\n    };\r\n\r\n    canvas.addEventListener('mousemove', handleMove);\r\n    canvas.addEventListener('click', handleClick);\r\n    canvas.addEventListener('mouseleave', handleLeave);\r\n\r\n    return () => {\r\n      canvas.removeEventListener('mousemove', handleMove);\r\n      canvas.removeEventListener('click', handleClick);\r\n      canvas.removeEventListener('mouseleave', handleLeave);\r\n    };\r\n  }, [tool, zoom, offset]);\r\n  //#endregion\r\n\r\n  //#region ⌨ Keyboard Shortcuts (key down)\r\n  useEffect(() => {\r\n    const handler = (e: KeyboardEvent) => {\r\n      // disable global shortcuts while inline editor is focused\r\n      if (inlineEditorRef.current && document.activeElement === inlineEditorRef.current) return;\r\n\r\n      if (e.key === 'Escape') {\r\n        if (tool === 'crop') {\r\n          handleCancelCrop();\r\n        }\r\n      }\r\n\r\n      if (e.ctrlKey && (e.key === 'z' || e.key === 'Z')) history.undo();\r\n      if (e.ctrlKey && e.shiftKey && e.key === 'Z') history.redo();\r\n      if (e.key === 'c' || e.key === 'C') setTool('crop');\r\n      if (e.key === 'h' || e.key === 'H') setTool('pan');\r\n      if (e.key === 'v' || e.key === 'V') setTool('layer');\r\n      if (e.key === 't' || e.key === 'T') setTool('text');\r\n      if (e.key === 'r' || e.key === 'R') rotate(90, canvasRef, overlayRef, history.history);\r\n      if (e.key === 'i' || e.key === 'I') setTool('color');\r\n      if (e.key === 'p' || e.key === 'P') setTool('perspective');\r\n      if (e.key === 'b' || e.key === 'B') setTool('draw');\r\n\r\n      // action\r\n      if (e.key === 'Delete' && (tool === 'layer' || tool === 'text') && activeLayerId)\r\n        deleteLayer(activeLayerId);\r\n      if (e.ctrlKey && e.key === 's' && (tool === 'layer' || tool === 'text')) {\r\n        e.preventDefault();\r\n        mergeLayerIntoBase(activeLayerId as string | undefined);\r\n      }\r\n      if (e.ctrlKey && e.key === 'i') {\r\n        e.preventDefault();\r\n        applyInvertColors(canvasRef, history);\r\n      }\r\n      if (e.ctrlKey && e.shiftKey && e.key === 'S') {\r\n        e.preventDefault();\r\n        setShowExportModal(true);\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handler);\r\n    return () => window.removeEventListener('keydown', handler);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [history.index, history.history, tool, activeLayerId, layers]);\r\n  //#endregion\r\n\r\n  // Quick hand tool when holding\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      const triggerTool = (key: 'Space' | 'AltLeft', newTool: Tool, condition = true) => {\r\n        if (e.code === key && condition) {\r\n          e.preventDefault();\r\n          setToolBefore((prev) => prev ?? tool);\r\n          setTool(newTool);\r\n          return true;\r\n        }\r\n        return false;\r\n      };\r\n\r\n      if (e.key === 'Shift') {\r\n        setIsShiftDown(true);\r\n      } else if (triggerTool('Space', 'pan')) {\r\n        setIsSpaceDown(true);\r\n      } else if (triggerTool('AltLeft', 'color', tool === 'draw')) {\r\n        setIsAltDown(true);\r\n      }\r\n    };\r\n\r\n    const handleKeyUp = (e: KeyboardEvent) => {\r\n      const resetTool = (\r\n        key: 'Space' | 'AltLeft',\r\n        setter: React.Dispatch<React.SetStateAction<boolean>>,\r\n      ) => {\r\n        if (e.code === key) {\r\n          setter(false);\r\n          setToolBefore((prev) => {\r\n            if (prev) setTool(prev);\r\n            return null;\r\n          });\r\n        }\r\n      };\r\n\r\n      if (e.key === 'Shift') {\r\n        setIsShiftDown(false);\r\n      }\r\n      resetTool('Space', setIsSpaceDown);\r\n      resetTool('AltLeft', setIsAltDown);\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown, { passive: false });\r\n    window.addEventListener('keyup', handleKeyUp);\r\n\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyDown);\r\n      window.removeEventListener('keyup', handleKeyUp);\r\n    };\r\n  }, [tool]);\r\n\r\n  //#endregion\r\n\r\n  // #region 📐 Perspective Transform Apply\r\n  const perspectiveApply = async () =>\r\n    await perspectiveApplyHelper(\r\n      canvasRef,\r\n      overlayRef,\r\n      perspectivePoints,\r\n      history,\r\n      setShowPerspectiveModal,\r\n      drawOverlay,\r\n    );\r\n\r\n  //#endregion\r\n  //#endregion\r\n\r\n  //#region Cursor Style\r\n  const currentCursor = useMemo(() => {\r\n    if ((tool === 'pan' || tool === 'select') && isPanning) return 'grabbing';\r\n    switch (tool) {\r\n      case 'pan':\r\n        return 'grab';\r\n      // case 'move':\r\n      //   return 'move';\r\n      case 'crop':\r\n      case 'ruler':\r\n      case 'perspective':\r\n        return 'crosshair';\r\n      case 'color':\r\n        return 'copy';\r\n      case 'removeColor':\r\n        return 'crosshair';\r\n      case 'draw':\r\n        return 'pointer';\r\n      case 'text':\r\n        return 'text';\r\n      default:\r\n        return 'default';\r\n    }\r\n  }, [tool, isPanning]);\r\n  //#endregion\r\n\r\n  const resolution = useMemo(() => {\r\n    const c = canvasRef.current;\r\n    if (c) return `${c.width} × ${c.height}`;\r\n    if (baseCanvas) return `${baseCanvas.width} × ${baseCanvas.height}`;\r\n    return null;\r\n  }, [canvasRef.current, baseCanvas]);\r\n\r\n  const handleConfirmCrop = () => {\r\n    if (cropRect) {\r\n      cropStart.current = null;\r\n      applyCrop(canvasRef, overlayRef, cropRect, setCropRect, history);\r\n      setShowCropModal(false);\r\n    }\r\n  };\r\n\r\n  const handleCancelCrop = () => {\r\n    setCropRect(null);\r\n    setShowCropModal(false);\r\n  };\r\n\r\n  const tourSteps = getTourSteps(sidebarRef, canvasContainerRef, toolbarRef);\r\n\r\n  return (\r\n    <div style={{ display: 'flex', gap: 12, position: 'relative' }}>\r\n      {/* Tour Component */}\r\n      <Tour open={openTour} onClose={() => setOpenTour(false)} steps={tourSteps} />\r\n\r\n      <div ref={sidebarRef}>\r\n        <SideEditorToolbar\r\n          canvasRef={canvasRef}\r\n          overlayRef={overlayRef}\r\n          baseCanvas={baseCanvas}\r\n          upscaleImage={upscaleImage}\r\n          history={history}\r\n          setTool={setTool}\r\n          // Exposure & Color\r\n          brightness={brightness}\r\n          setBrightness={setBrightness}\r\n          contrast={contrast}\r\n          setContrast={setContrast}\r\n          highlights={highlights}\r\n          setHighlights={setHighlights}\r\n          shadows={shadows}\r\n          setShadows={setShadows}\r\n          whites={whites}\r\n          setWhites={setWhites}\r\n          blacks={blacks}\r\n          setBlacks={setBlacks}\r\n          vibrance={vibrance}\r\n          setVibrance={setVibrance}\r\n          saturation={saturation}\r\n          setSaturation={setSaturation}\r\n          dehaze={dehaze}\r\n          setDehaze={setDehaze}\r\n          // Blur / Convolution\r\n          blur={blur}\r\n          setBlur={setBlur}\r\n          gaussian={gaussian}\r\n          setGaussian={setGaussian}\r\n          sharpen={sharpen}\r\n          setSharpen={setSharpen}\r\n          texture={texture}\r\n          setTexture={setTexture}\r\n          clarity={clarity}\r\n          setClarity={setClarity}\r\n          // Background removal\r\n          bgThreshold={bgThreshold}\r\n          setBgThreshold={setBgThreshold}\r\n          bgThresholdBlack={bgThresholdBlack}\r\n          setBgThresholdBlack={setBgThresholdBlack}\r\n          // Color mix (HSL)\r\n          hslAdjustments={hslAdjustments}\r\n          setHslAdjustments={setHslAdjustments}\r\n          setShowPerspectiveModal={setShowPerspectiveModal}\r\n          dpiMeasured={dpiMeasured}\r\n          setDpiMeasured={setDpiMeasured}\r\n          exportImage={exportWithOverlay}\r\n          onExport={onExport}\r\n          showExportModal={showExportModal}\r\n          setShowExportModal={setShowExportModal}\r\n          onColorRemovalToolClick={() => setTool('removeColor')}\r\n        />\r\n        {/* Help Button */}\r\n        <Button\r\n          type=\"text\"\r\n          icon={<QuestionCircleOutlined />}\r\n          onClick={() => setOpenTour(true)}\r\n          style={{ width: '100%' }}\r\n        >\r\n          Help\r\n        </Button>\r\n      </div>\r\n\r\n      <div style={{ flex: 1, display: 'flex', flexDirection: 'column' }}>\r\n        <div ref={toolbarRef}>\r\n          <TopEditorToolbar\r\n            history={history}\r\n            setZoom={setZoom}\r\n            tool={tool}\r\n            setTool={setTool}\r\n            brushType={brushType}\r\n            setBrushType={setBrushType}\r\n            drawColor={drawColor}\r\n            setDrawColor={setDrawColor}\r\n            drawLineWidth={drawLineWidth}\r\n            setDrawLineWidth={setDrawLineWidth}\r\n            brushOpacity={brushOpacity}\r\n            setBrushOpacity={setBrushOpacity}\r\n            brushFlow={brushFlow}\r\n            setBrushFlow={setBrushFlow}\r\n            layers={layers}\r\n            activeLayerId={activeLayerId}\r\n            setLayerOpacity={setLayerOpacity}\r\n            setLayerBlend={setLayerBlend}\r\n            moveLayerUp={moveLayerUp}\r\n            moveLayerDown={moveLayerDown}\r\n            deleteLayer={deleteLayer}\r\n            selectLayer={selectLayer}\r\n            mergeLayer={mergeLayerIntoBase}\r\n            textContent={textContent}\r\n            setTextContent={handleSetTextContent}\r\n            textFont={textFont}\r\n            setTextFont={handleSetTextFont}\r\n            textFontSize={textFontSize}\r\n            setTextFontSize={handleSetTextFontSize}\r\n            textColor={textColor}\r\n            setTextColor={handleSetTextColor}\r\n            textWeight={textWeight}\r\n            setTextWeight={handleSetTextWeight}\r\n            textItalic={textItalic}\r\n            setTextItalic={handleSetTextItalic}\r\n            textDecoration={textDecoration}\r\n            setTextDecoration={handleSetTextDecoration}\r\n            textAlign={textAlign}\r\n            setTextAlign={handleSetTextAlign}\r\n            onAddTextLayer={onAddTextLayer}\r\n            isAddingText={isAddingText}\r\n            setIsAddingText={setIsAddingText}\r\n            onOpenMaskTool={handleOpenMaskTool}\r\n            onOpenLayerEffects={handleOpenLayerEffects}\r\n          />\r\n        </div>\r\n\r\n        <div ref={canvasContainerRef} style={{ flex: 1 }}>\r\n          <ImageCanvas\r\n            canvasRef={canvasRef}\r\n            overlayRef={overlayRef}\r\n            containerRef={containerRef}\r\n            offset={offset}\r\n            zoom={zoom}\r\n            tool={tool}\r\n            currentCursor={currentCursor}\r\n            resolution={resolution}\r\n            hoverColor={hoverColor}\r\n            onMouseDown={handleMouseDownViewer}\r\n            onMouseMove={handleMouseMoveViewer}\r\n            onMouseUp={handleMouseUpViewer}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <Modal\r\n        title=\"Confirm Crop\"\r\n        open={showCropModal}\r\n        onOk={handleConfirmCrop}\r\n        onCancel={handleCancelCrop}\r\n        okText=\"Crop\"\r\n        cancelText=\"Cancel\"\r\n      >\r\n        <p>Are you sure you want to crop the image?</p>\r\n      </Modal>\r\n\r\n      <Modal\r\n        title=\"Perspective correction\"\r\n        open={showPerspectiveModal}\r\n        onOk={() => perspectiveApply()}\r\n        onCancel={() => setShowPerspectiveModal(false)}\r\n        okText=\"Apply\"\r\n      >\r\n        <p>Click four points on the image (clockwise) to define the corners, then Apply.</p>\r\n        <p style={{ marginTop: 8 }}>\r\n          Tip: click a corner again to move it (or click near a point to reposition).\r\n        </p>\r\n      </Modal>\r\n\r\n      <ColorRemovalModal\r\n        open={showColorRemovalModal}\r\n        onCancel={() => {\r\n          setShowColorRemovalModal(false);\r\n          setSelectedColorForRemoval(null);\r\n        }}\r\n        onApply={(maskCanvas) => {\r\n          applyMaskToCanvas(canvasRef, maskCanvas, history, 'Color Removal');\r\n          setShowColorRemovalModal(false);\r\n          setSelectedColorForRemoval(null);\r\n        }}\r\n        selectedColor={selectedColorForRemoval}\r\n        canvasRef={canvasRef}\r\n      />\r\n\r\n      <LayerMaskModal\r\n        open={showLayerMaskModal}\r\n        onCancel={() => {\r\n          setShowLayerMaskModal(false);\r\n          setMaskEditingLayerId(null);\r\n        }}\r\n        onApply={handleApplyMask}\r\n        sourceCanvas={getMaskSourceCanvas()}\r\n        existingMask={getMaskEditingLayer()?.mask}\r\n      />\r\n\r\n      <LayerEffectModal\r\n        open={showLayerEffectModal}\r\n        onCancel={() => {\r\n          setShowLayerEffectModal(false);\r\n          setEffectEditingLayerId(null);\r\n        }}\r\n        onApply={handleApplyLayerEffects}\r\n        layer={layers.find((l) => l.id === effectEditingLayerId)}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ImageEditor;\r\n","import { useEffect, useRef, useState } from 'react';\r\nimport { createCanvas, drawImageToCanvasFromUrl } from '../utils/ImageEditorEngine';\r\nimport { message } from 'antd';\r\n\r\nexport default function useCanvas(imageUrl: string, onLoad?: (dataUrl: string) => void) {\r\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\r\n  const overlayRef = useRef<HTMLCanvasElement | null>(null);\r\n\r\n  const [baseCanvas, setBaseCanvas] = useState<HTMLCanvasElement | null>(null);\r\n\r\n  // Load image once\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const c = await drawImageToCanvasFromUrl(imageUrl);\r\n        setBaseCanvas(c);\r\n\r\n        const working = createCanvas(c.width, c.height);\r\n        working.getContext('2d')!.drawImage(c, 0, 0);\r\n\r\n        if (canvasRef.current) {\r\n          canvasRef.current.width = working.width;\r\n          canvasRef.current.height = working.height;\r\n          const ctx = canvasRef.current.getContext('2d')!;\r\n          ctx.clearRect(0, 0, working.width, working.height);\r\n          ctx.drawImage(working, 0, 0);\r\n        }\r\n\r\n        if (onLoad) onLoad(canvasToDataUrl(working));\r\n      } catch (err) {\r\n        console.error('Failed to load image', err);\r\n        message.error('Failed to load image');\r\n      }\r\n    })();\r\n  }, [imageUrl]);\r\n\r\n  // Resize overlay when baseCanvas is ready\r\n  useEffect(() => {\r\n    syncCanvasSize();\r\n  }, [baseCanvas]);\r\n\r\n  /** Convert canvas → dataURL */\r\n  const canvasToDataUrl = (c: HTMLCanvasElement) => c.toDataURL('image/png');\r\n\r\n  /** Sync canvas & overlay sizes */\r\n  const syncCanvasSize = () => {\r\n    if (!canvasRef.current || !baseCanvas) return;\r\n\r\n    canvasRef.current.width = baseCanvas.width;\r\n    canvasRef.current.height = baseCanvas.height;\r\n    overlayRef.current!.width = baseCanvas.width;\r\n    overlayRef.current!.height = baseCanvas.height;\r\n\r\n    const ctx = canvasRef.current.getContext('2d')!;\r\n    ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n    ctx.drawImage(baseCanvas, 0, 0);\r\n  };\r\n\r\n  return { canvasRef, overlayRef, baseCanvas, setBaseCanvas, syncCanvasSize };\r\n}\r\n","import { MutableRefObject, useEffect, useState } from 'react';\r\n\r\ntype HistoryItem = {\r\n  url: string;\r\n  label?: string;\r\n  isSetBase: boolean;\r\n};\r\n\r\nexport type HistoryController = {\r\n  history: HistoryItem[];\r\n  index: number;\r\n  current: HistoryItem;\r\n  push: (url: string, label?: string) => void;\r\n  undo: () => void;\r\n  redo: () => void;\r\n  applyHistory: (idx: number) => void;\r\n};\r\n\r\nexport default function useHistory(\r\n  canvasRef: MutableRefObject<HTMLCanvasElement | null>,\r\n  overlayRef: MutableRefObject<HTMLCanvasElement | null>,\r\n  maxHistory: number = 20,\r\n) {\r\n  const [history, setHistory] = useState<HistoryItem[]>([]);\r\n  const [index, setIndex] = useState(-1);\r\n\r\n  const current = history[index];\r\n\r\n  //\r\n  /** History management */\r\n  const push = (url: string, label = '', isSetBase = true) => {\r\n    let next = history.slice(0, index + 1);\r\n    next.push({ url, label, isSetBase });\r\n\r\n    // Enforce max history limit, but always keep the first item (initial image)\r\n    if (next.length > maxHistory) {\r\n      // Keep the first item (index 0) and the last (maxHistory - 1) items\r\n      const first = next[0];\r\n      const rest = next.slice(next.length - (maxHistory - 1));\r\n      next = [first, ...rest];\r\n    }\r\n\r\n    setHistory(next);\r\n    setIndex(next.length - 1);\r\n  };\r\n  const undo = () => {\r\n    if (index <= 0) return;\r\n    applyHistory(index - 1);\r\n  };\r\n  const redo = () => {\r\n    if (index >= history.length - 1) return;\r\n    applyHistory(index + 1);\r\n  };\r\n\r\n  const applyHistory = (idx: number) => {\r\n    const item = history[idx];\r\n    if (!item) return;\r\n\r\n    const img = new Image();\r\n    img.onload = () => {\r\n      const ctx = canvasRef.current!.getContext('2d')!;\r\n      canvasRef.current!.width = img.naturalWidth;\r\n      canvasRef.current!.height = img.naturalHeight;\r\n      overlayRef.current!.width = img.naturalWidth;\r\n      overlayRef.current!.height = img.naturalHeight;\r\n\r\n      ctx.clearRect(0, 0, canvasRef.current!.width, canvasRef.current!.height);\r\n      ctx.drawImage(img, 0, 0);\r\n      setIndex(idx);\r\n    };\r\n    img.src = item.url;\r\n  };\r\n\r\n  return { history, index, current, push, undo, redo, applyHistory };\r\n}\r\n","import { Form, InputNumber, Modal, Switch } from 'antd';\r\nimport React, { useEffect } from 'react';\r\nimport { EditorSettings } from '../types';\r\n\r\ninterface SettingsModalProps {\r\n  open: boolean;\r\n  onCancel: () => void;\r\n  onSave: (settings: EditorSettings) => void;\r\n  initialSettings: EditorSettings;\r\n}\r\n\r\nconst SettingsModal: React.FC<SettingsModalProps> = ({\r\n  open,\r\n  onCancel,\r\n  onSave,\r\n  initialSettings,\r\n}) => {\r\n  const [form] = Form.useForm();\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      form.setFieldsValue(initialSettings);\r\n    }\r\n  }, [open, initialSettings, form]);\r\n\r\n  const handleOk = () => {\r\n    form.validateFields().then((values) => {\r\n      onSave(values);\r\n      onCancel();\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Modal title=\"Editor Settings\" open={open} onOk={handleOk} onCancel={onCancel}>\r\n      <Form form={form} layout=\"vertical\">\r\n        <Form.Item\r\n          name=\"autoSaveInterval\"\r\n          label=\"Auto Save Interval (minutes)\"\r\n          help=\"Set to 0 to disable auto-save\"\r\n          rules={[{ required: true, message: 'Please enter auto save interval' }]}\r\n        >\r\n          <InputNumber min={0} max={60} style={{ width: '100%' }} />\r\n        </Form.Item>\r\n        <Form.Item\r\n          name=\"maxHistory\"\r\n          label=\"Max History Steps\"\r\n          help=\"Maximum number of undo steps to keep. The initial image is always preserved.\"\r\n          rules={[{ required: true, message: 'Please enter max history steps' }]}\r\n        >\r\n          <InputNumber min={5} max={100} style={{ width: '100%' }} />\r\n        </Form.Item>\r\n      </Form>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default SettingsModal;\r\n","import { EditorSettings, SavedProject } from '../types';\r\n\r\nconst DB_NAME = 'PicsEditorDB';\r\nconst DB_VERSION = 1;\r\nconst STORE_PROJECTS = 'projects';\r\n\r\nexport const initDB = (): Promise<IDBDatabase> => {\r\n  return new Promise((resolve, reject) => {\r\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\r\n\r\n    request.onerror = () => {\r\n      reject('Error opening database');\r\n    };\r\n\r\n    request.onsuccess = (event) => {\r\n      resolve((event.target as IDBOpenDBRequest).result);\r\n    };\r\n\r\n    request.onupgradeneeded = (event) => {\r\n      const db = (event.target as IDBOpenDBRequest).result;\r\n      if (!db.objectStoreNames.contains(STORE_PROJECTS)) {\r\n        db.createObjectStore(STORE_PROJECTS, { keyPath: 'id' });\r\n      }\r\n    };\r\n  });\r\n};\r\n\r\nexport const saveProjectToDB = async (project: SavedProject): Promise<void> => {\r\n  const db = await initDB();\r\n  return new Promise((resolve, reject) => {\r\n    const transaction = db.transaction([STORE_PROJECTS], 'readwrite');\r\n    const store = transaction.objectStore(STORE_PROJECTS);\r\n    const request = store.put(project);\r\n\r\n    request.onsuccess = () => resolve();\r\n    request.onerror = () => reject('Error saving project');\r\n  });\r\n};\r\n\r\nexport const getAllProjectsFromDB = async (): Promise<SavedProject[]> => {\r\n  const db = await initDB();\r\n  return new Promise((resolve, reject) => {\r\n    const transaction = db.transaction([STORE_PROJECTS], 'readonly');\r\n    const store = transaction.objectStore(STORE_PROJECTS);\r\n    const request = store.getAll();\r\n\r\n    request.onsuccess = () => {\r\n      const projects = request.result as SavedProject[];\r\n      // Sort by updatedAt desc\r\n      projects.sort((a, b) => b.updatedAt - a.updatedAt);\r\n      resolve(projects);\r\n    };\r\n    request.onerror = () => reject('Error fetching projects');\r\n  });\r\n};\r\n\r\nexport const deleteProjectFromDB = async (id: string): Promise<void> => {\r\n  const db = await initDB();\r\n  return new Promise((resolve, reject) => {\r\n    const transaction = db.transaction([STORE_PROJECTS], 'readwrite');\r\n    const store = transaction.objectStore(STORE_PROJECTS);\r\n    const request = store.delete(id);\r\n\r\n    request.onsuccess = () => resolve();\r\n    request.onerror = () => reject('Error deleting project');\r\n  });\r\n};\r\n","import DragDropWrapper from '@/components/DragDropWrapper';\r\nimport DragOverlay from '@/components/DragOverlay';\r\nimport {\r\n  DeleteOutlined,\r\n  EditOutlined,\r\n  InboxOutlined,\r\n  PlusOutlined,\r\n  SettingOutlined,\r\n  UploadOutlined,\r\n} from '@ant-design/icons';\r\nimport {\r\n  Button,\r\n  Card,\r\n  Col,\r\n  Empty,\r\n  Image,\r\n  Popconfirm,\r\n  Row,\r\n  Space,\r\n  Tabs,\r\n  Tag,\r\n  Typography,\r\n  Upload,\r\n  message,\r\n} from 'antd';\r\nimport ImageTracer from 'imagetracerjs';\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport ImageEditor from './components/ImageEditor';\r\nimport SettingsModal from './components/SettingsModal';\r\nimport './styles.less';\r\nimport { EditorSettings, EditorState, SavedProject } from './types';\r\nimport { deleteProjectFromDB, getAllProjectsFromDB, saveProjectToDB } from './utils/storage';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\nconst DEFAULT_SETTINGS: EditorSettings = {\r\n  autoSaveInterval: 5,\r\n  maxHistory: 20,\r\n};\r\n\r\nconst PicsEditor: React.FC = () => {\r\n  const [preview, setPreview] = useState<string | null>(null);\r\n  const [svgContent, setSvgContent] = useState<string | null>(null);\r\n  const [dragging, setDragging] = useState(false);\r\n\r\n  const [addOnFile, setAddOnFile] = useState<File | null>(null);\r\n  const [savedProjects, setSavedProjects] = useState<SavedProject[]>([]);\r\n  const [currentProject, setCurrentProject] = useState<SavedProject | null>(null);\r\n  const [initialState, setInitialState] = useState<EditorState | null>(null);\r\n  const [settings, setSettings] = useState<EditorSettings>(DEFAULT_SETTINGS);\r\n  const [showSettings, setShowSettings] = useState(false);\r\n\r\n  const dragCounter = useRef(0);\r\n\r\n  useEffect(() => {\r\n    getAllProjectsFromDB()\r\n      .then(setSavedProjects)\r\n      .catch((err) => console.error('Failed to load projects from DB', err));\r\n\r\n    const savedSettings = localStorage.getItem('pics_editor_settings');\r\n    if (savedSettings) {\r\n      try {\r\n        setSettings({ ...DEFAULT_SETTINGS, ...JSON.parse(savedSettings) });\r\n      } catch (e) {\r\n        console.error('Failed to load settings', e);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  const handleSaveSettings = (newSettings: EditorSettings) => {\r\n    setSettings(newSettings);\r\n    localStorage.setItem('pics_editor_settings', JSON.stringify(newSettings));\r\n    message.success('Settings saved');\r\n  };\r\n\r\n  // --- Clipboard paste support ---\r\n  useEffect(() => {\r\n    const handlePaste = (e: ClipboardEvent) => {\r\n      const items = e.clipboardData?.items;\r\n      if (!items) return;\r\n\r\n      const imageItem = Array.from(items).find((item) => item.type.includes('image'));\r\n      if (imageItem) {\r\n        const blob = imageItem.getAsFile();\r\n        if (blob) {\r\n          handleUpload(blob);\r\n          message.success('Image pasted from clipboard!');\r\n          e.preventDefault();\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('paste', handlePaste);\r\n    return () => window.removeEventListener('paste', handlePaste);\r\n  }, [preview]);\r\n\r\n  const handleUpload = (file: File) => {\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      if (preview) {\r\n        setAddOnFile(file);\r\n      } else {\r\n        setPreview(e.target?.result as string);\r\n        setCurrentProject(null);\r\n        setInitialState(null);\r\n      }\r\n    };\r\n    reader.readAsDataURL(file);\r\n    setDragging(false);\r\n    dragCounter.current = 0;\r\n    return false;\r\n  };\r\n\r\n  const handleClear = () => {\r\n    setPreview(null);\r\n    setSvgContent(null);\r\n    setAddOnFile(null);\r\n    setCurrentProject(null);\r\n    setInitialState(null);\r\n    message.info('Image and SVG cleared.');\r\n  };\r\n\r\n  const handleSaveProject = (state: EditorState) => {\r\n    if (!preview) return;\r\n\r\n    // Create thumbnail (using the current canvas state would be better, but for now use preview)\r\n    // Ideally ImageEditor should pass the thumbnail in onSave, but we can use the base image for now\r\n    // or rely on the fact that the user just saved.\r\n\r\n    // Actually, to get a proper thumbnail of the *edit*, we need the canvas data.\r\n    // But onSave only passes state.\r\n    // Let's assume for now we use the base image as thumbnail or we need to capture it.\r\n    // Since we can't easily capture it here without ref, let's just use the base preview.\r\n    // A better approach would be if onSave passed the dataURL of the result.\r\n\r\n    const newProject: SavedProject = {\r\n      id: currentProject?.id || Date.now().toString(),\r\n      name: currentProject?.name || `Project ${new Date().toLocaleString()}`,\r\n      thumbnail: preview, // TODO: Use actual canvas snapshot\r\n      baseImage: preview,\r\n      state: state,\r\n      createdAt: currentProject?.createdAt || Date.now(),\r\n      updatedAt: Date.now(),\r\n    };\r\n\r\n    saveProjectToDB(newProject)\r\n      .then(() => {\r\n        // Update local state\r\n        const newProjects = currentProject\r\n          ? savedProjects.map((p) => (p.id === currentProject.id ? newProject : p))\r\n          : [newProject, ...savedProjects];\r\n\r\n        // Sort by updatedAt desc\r\n        newProjects.sort((a, b) => b.updatedAt - a.updatedAt);\r\n\r\n        setSavedProjects(newProjects);\r\n        setCurrentProject(newProject);\r\n        message.success('Project saved successfully!');\r\n      })\r\n      .catch((err) => {\r\n        console.error(err);\r\n        message.error('Failed to save project');\r\n      });\r\n  };\r\n\r\n  const loadProject = (project: SavedProject) => {\r\n    setPreview(project.baseImage);\r\n    setInitialState(project.state);\r\n    setCurrentProject(project);\r\n  };\r\n\r\n  const deleteProject = (e: React.MouseEvent, id: string) => {\r\n    e.stopPropagation();\r\n    deleteProjectFromDB(id)\r\n      .then(() => {\r\n        const newProjects = savedProjects.filter((p) => p.id !== id);\r\n        setSavedProjects(newProjects);\r\n        message.success('Project deleted');\r\n      })\r\n      .catch((err) => {\r\n        console.error(err);\r\n        message.error('Failed to delete project');\r\n      });\r\n  };\r\n\r\n  return (\r\n    <DragDropWrapper\r\n      setDragging={setDragging}\r\n      dragCounter={dragCounter}\r\n      handleUpload={handleUpload}\r\n    >\r\n      <Card\r\n        title={\r\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n            <span>\r\n              🖼️ Pics Editor <Tag color=\"cyan\">Beta</Tag>\r\n            </span>\r\n            <Button icon={<SettingOutlined />} onClick={() => setShowSettings(true)}>\r\n              Settings\r\n            </Button>\r\n          </div>\r\n        }\r\n        variant={'borderless'}\r\n      >\r\n        <Space direction=\"vertical\" style={{ width: '100%' }} size=\"large\">\r\n          {!dragging && !preview && (\r\n            <>\r\n              <Upload.Dragger\r\n                beforeUpload={handleUpload}\r\n                showUploadList={false}\r\n                accept=\".png,.jpg,.jpeg\"\r\n                height={200}\r\n              >\r\n                <p className=\"ant-upload-drag-icon\">\r\n                  <InboxOutlined />\r\n                </p>\r\n                <p className=\"ant-upload-text\">Click or drag file to this area to upload</p>\r\n                <p className=\"ant-upload-hint\">\r\n                  Support for a single upload. You can also paste an image from clipboard.\r\n                </p>\r\n              </Upload.Dragger>\r\n\r\n              {savedProjects.length > 0 && (\r\n                <div style={{ marginTop: 24 }}>\r\n                  <Title level={4}>Recent Projects</Title>\r\n                  <Row gutter={[16, 16]}>\r\n                    {savedProjects.map((project) => (\r\n                      <Col key={project.id} xs={12} sm={8} md={6} lg={4}>\r\n                        <Card\r\n                          hoverable\r\n                          cover={\r\n                            <div\r\n                              style={{\r\n                                height: 120,\r\n                                overflow: 'hidden',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                                background: '#f0f0f0',\r\n                              }}\r\n                            >\r\n                              <img\r\n                                alt={project.name}\r\n                                src={project.thumbnail}\r\n                                style={{ maxWidth: '100%', maxHeight: '100%' }}\r\n                              />\r\n                            </div>\r\n                          }\r\n                          onClick={() => loadProject(project)}\r\n                          actions={[\r\n                            <Popconfirm\r\n                              title=\"Delete project?\"\r\n                              onConfirm={(e) => deleteProject(e!, project.id)}\r\n                              onCancel={(e) => e?.stopPropagation()}\r\n                              okText=\"Yes\"\r\n                              cancelText=\"No\"\r\n                            >\r\n                              <DeleteOutlined\r\n                                key=\"delete\"\r\n                                onClick={(e) => e.stopPropagation()}\r\n                                style={{ color: 'red' }}\r\n                              />\r\n                            </Popconfirm>,\r\n                          ]}\r\n                        >\r\n                          <Card.Meta\r\n                            title={\r\n                              <Text ellipsis style={{ width: '100%' }}>\r\n                                {project.name}\r\n                              </Text>\r\n                            }\r\n                            description={new Date(project.updatedAt).toLocaleDateString()}\r\n                          />\r\n                        </Card>\r\n                      </Col>\r\n                    ))}\r\n                  </Row>\r\n                </div>\r\n              )}\r\n            </>\r\n          )}\r\n\r\n          {dragging && <DragOverlay />}\r\n\r\n          {/* Preview */}\r\n          {preview && (\r\n            <div>\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  justifyContent: 'space-between',\r\n                  alignItems: 'center',\r\n                  marginBottom: 16,\r\n                }}\r\n              >\r\n                <Title level={5} style={{ margin: 0 }}>\r\n                  {currentProject ? `Editing: ${currentProject.name}` : 'New Project'}\r\n                </Title>\r\n                <Button onClick={handleClear} danger>\r\n                  Close Editor\r\n                </Button>\r\n              </div>\r\n              <ImageEditor\r\n                addOnFile={addOnFile}\r\n                setAddOnFile={setAddOnFile}\r\n                imageUrl={preview}\r\n                initialState={initialState}\r\n                onSave={handleSaveProject}\r\n                settings={settings}\r\n                onExport={(blob) => {\r\n                  console.log('exported blob', blob);\r\n                }}\r\n              />\r\n            </div>\r\n          )}\r\n        </Space>\r\n      </Card>\r\n\r\n      <SettingsModal\r\n        open={showSettings}\r\n        onCancel={() => setShowSettings(false)}\r\n        onSave={handleSaveSettings}\r\n        initialSettings={settings}\r\n      />\r\n    </DragDropWrapper>\r\n  );\r\n};\r\n\r\nexport default PicsEditor;\r\n"],"names":[],"mappings":"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"}