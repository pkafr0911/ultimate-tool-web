(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]||[]).push([["c64d443d"],{a28c8bad:function(e,t,l){l.d(t,"__esModule",{value:!0}),l.e(t,{VectorEditorProvider:function(){return c;},useVectorEditor:function(){return d;}});var n=l("852bbaa9"),r=l("1a7c85b4"),o=l("d322be42"),i=n._(o);let s=e=>{let[t,l]=(0,i.useState)([]),[n,r]=(0,i.useState)(-1),[o,s]=(0,i.useState)(!1);return{saveState:(0,i.useCallback)(()=>{if(!e||o)return;let i=JSON.stringify(e.toJSON()),s=t.slice(0,n+1);s.push(i),s.length>50&&s.shift(),l(s),r(s.length-1);},[e,t,n,o]),undo:(0,i.useCallback)(()=>{if(!e||n<=0||o)return;s(!0);let l=n-1,i=t[l];e.loadFromJSON(JSON.parse(i),()=>{e.renderAll(),r(l),s(!1);});},[e,t,n,o]),redo:(0,i.useCallback)(()=>{if(!e||n>=t.length-1||o)return;s(!0);let l=n+1,i=t[l];e.loadFromJSON(JSON.parse(i),()=>{e.renderAll(),r(l),s(!1);});},[e,t,n,o]),canUndo:n>0,canRedo:n<t.length-1};},a=(0,i.createContext)(void 0),c=({children:e})=>{let[t,l]=(0,i.useState)(null),[n,o]=(0,i.useState)(null),[c,d]=(0,i.useState)("select"),[u,f]=(0,i.useState)(null),h=s(t);return(0,r.jsx)(a.Provider,{value:{canvas:t,setCanvas:l,selectedObject:n,setSelectedObject:o,activeTool:c,setActiveTool:d,history:h,pointEditor:u,setPointEditor:f},children:e});},d=()=>{let e=(0,i.useContext)(a);if(!e)throw Error("useVectorEditor must be used within a VectorEditorProvider");return e;};},f5c391a5:function(e,t,l){l.d(t,"__esModule",{value:!0}),l.e(t,{default:function(){return eU;}});var n=l("777fffbe"),r=l("852bbaa9"),o=l("1a7c85b4"),i=l("d322be42"),s=r._(i),a=l("28c7d19c"),c=l("e9bcd22d"),d=n._(c),u=l("b091b25f"),f=n._(u),h=l("a28c8bad"),p=l("b2a1469e"),x=n._(p),g=l("d4a32650"),y=n._(g),m=l("ea21718c"),v=n._(m),b=l("1353d6cc"),j=n._(b),k=l("f2806aec"),C=n._(k),w=l("81108cbb"),S=n._(w),A=l("d2d0b3b6"),E=n._(A),R={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372 0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884zm288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372 0 89-31.3 170.8-83.5 234.8z"}}]},name:"stop",theme:"outlined"},T=l("85c4e0d9"),M=n._(T),O=s.forwardRef(function(e,t){return s.createElement(M.default,(0,E.default)((0,E.default)({},e),{},{ref:t,icon:R}));}),_=l("0a08762b"),I=n._(_),P=l("84cd549f"),z=n._(P),W=l("07d5c3d6"),$=n._(W),V=l("34f8e1c9"),q=n._(V),L=l("076b2e3c"),B=n._(L),D=l("5af7999d"),H=n._(D),X=l("adbfb03b"),Y=n._(X),N=l("4e1dc2f8"),Z=l("dfa4ac87"),F=n._(Z),G=l("d5daf11a"),K=n._(G),U=l("97125d22"),J=n._(U),Q=l("2aa4d12e"),ee=n._(Q);let et=({open:e,onClose:t})=>{let{canvas:l,history:n}=(0,h.useVectorEditor)(),[r]=K.default.useForm(),i={backgroundColor:(null==l?void 0:l.backgroundColor)||"#ffffff",width:null==l?void 0:l.width,height:null==l?void 0:l.height};return(0,o.jsx)(F.default,{title:"Canvas Settings",open:e,onCancel:t,footer:null,destroyOnHidden:!0,children:(0,o.jsxs)(K.default,{form:r,layout:"vertical",initialValues:i,onValuesChange:(e,t)=>{if(l){if(e.backgroundColor){let t="string"==typeof e.backgroundColor?e.backgroundColor:e.backgroundColor.toHexString();l.backgroundColor=t,l.requestRenderAll();}(e.width||e.height)&&(l.setDimensions({width:t.width||l.width,height:t.height||l.height}),l.requestRenderAll());}},children:[(0,o.jsx)(K.default.Item,{label:"Background Color",name:"backgroundColor",children:(0,o.jsx)(J.default,{showText:!0})}),(0,o.jsx)(K.default.Item,{label:"Canvas Width",name:"width",children:(0,o.jsx)(ee.default,{})}),(0,o.jsx)(K.default.Item,{label:"Canvas Height",name:"height",children:(0,o.jsx)(ee.default,{})})]})});},el=()=>{let{canvas:e,activeTool:t,setActiveTool:l,history:n}=(0,h.useVectorEditor)(),[r,i]=s.default.useState(!1);return(0,o.jsxs)(v.default,{direction:"vertical",size:"small",children:[(0,o.jsx)(y.default,{title:"Select (V)",children:(0,o.jsx)(x.default,{type:"select"===t?"primary":"default",icon:(0,o.jsx)(C.default,{}),onClick:()=>l("select")})}),(0,o.jsx)(y.default,{title:"Pan (H / Space)",children:(0,o.jsx)(x.default,{type:"pan"===t?"primary":"default",icon:(0,o.jsx)(C.default,{}),onClick:()=>l("pan")})}),(0,o.jsx)(j.default,{style:{margin:"4px 0"}}),(0,o.jsx)(y.default,{title:"Rectangle (R)",children:(0,o.jsx)(x.default,{icon:(0,o.jsx)(S.default,{}),onClick:()=>{if(!e)return;let t=new N.Rect({left:100,top:100,fill:"#ff0000",width:100,height:100});e.add(t),e.setActiveObject(t),l("select");}})}),(0,o.jsx)(y.default,{title:"Circle (C)",children:(0,o.jsx)(x.default,{icon:(0,o.jsx)(O,{rotate:45}),onClick:()=>{if(!e)return;let t=new N.Circle({left:100,top:100,fill:"#00ff00",radius:50});e.add(t),e.setActiveObject(t),l("select");}})}),(0,o.jsx)(y.default,{title:"Text (T)",children:(0,o.jsx)(x.default,{icon:(0,o.jsx)(I.default,{}),onClick:()=>{if(!e)return;let t=new N.IText("Type here",{left:100,top:100,fontFamily:"arial",fill:"#333",fontSize:20});e.add(t),e.setActiveObject(t),l("select");}})}),(0,o.jsx)(y.default,{title:"Pen (P)",children:(0,o.jsx)(x.default,{type:"pen"===t?"primary":"default",icon:(0,o.jsx)(H.default,{}),onClick:()=>l("pen")})}),(0,o.jsx)(j.default,{style:{margin:"4px 0"}}),(0,o.jsx)(y.default,{title:"Undo (Ctrl+Z)",children:(0,o.jsx)(x.default,{icon:(0,o.jsx)(q.default,{}),onClick:n.undo,disabled:!n.canUndo})}),(0,o.jsx)(y.default,{title:"Redo (Ctrl+Shift+Z)",children:(0,o.jsx)(x.default,{icon:(0,o.jsx)(B.default,{}),onClick:n.redo,disabled:!n.canRedo})}),(0,o.jsx)(j.default,{style:{margin:"4px 0"}}),(0,o.jsx)(y.default,{title:"Clear Canvas",children:(0,o.jsx)(x.default,{icon:(0,o.jsx)(z.default,{}),danger:!0,onClick:()=>{e&&(e.clear(),e.backgroundColor="#ffffff",e.renderAll(),n.saveState());}})}),(0,o.jsx)(y.default,{title:"Export SVG",children:(0,o.jsx)(x.default,{icon:(0,o.jsx)($.default,{}),onClick:()=>{let t;if(!e)return;let l=e.backgroundColor;e.backgroundColor="transparent";let n=e.getObjects();if(n.length>0){let l=1/0,r=1/0,o=-1/0,i=-1/0;n.forEach(e=>{let t=e.getBoundingRect();t.left<l&&(l=t.left),t.top<r&&(r=t.top),t.left+t.width>o&&(o=t.left+t.width),t.top+t.height>i&&(i=t.top+t.height);}),l-=10,r-=10,o+=10,i+=10;let s=o-l,a=i-r;t=e.toSVG({viewBox:{x:l,y:r,width:s,height:a},width:s.toString(),height:a.toString()});}else t=e.toSVG();e.backgroundColor=l,e.requestRenderAll();let r=new Blob([t],{type:"image/svg+xml"}),o=URL.createObjectURL(r),i=document.createElement("a");i.href=o,i.download="design.svg",document.body.appendChild(i),i.click(),document.body.removeChild(i);}})}),(0,o.jsx)(y.default,{title:"Settings",children:(0,o.jsx)(x.default,{icon:(0,o.jsx)(Y.default,{}),onClick:()=>i(!0)})}),(0,o.jsx)(et,{open:r,onClose:()=>i(!1)})]});},en=e=>{(0,s.useEffect)(()=>{let t=t=>{if(document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement)return;let l=t.key.toLowerCase(),n=t.ctrlKey||t.metaKey,r=t.shiftKey,o="";n&&(o+="ctrl+"),r&&(o+="shift+"),o+=l,console.log("Key pressed:",{key:l,ctrl:n,shift:r,keyString:o}),e[o]?(t.preventDefault(),e[o](t)):!e[l]||n||r||(t.preventDefault(),e[l](t));};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t);},[e]);},er=(e,t)=>{let[l,n]=(0,s.useState)(!1),r=(0,s.useRef)(null),o=(0,s.useRef)([]),i=(0,s.useRef)([]),a=(0,s.useRef)(!1),c=(0,s.useRef)(null),d=(0,s.useRef)(null),u=(0,s.useRef)([]),f=(e,t=!1)=>{if(0===e.length)return"";let l=`M ${e[0].x} ${e[0].y}`;for(let t=1;t<e.length;t++){let n=e[t],r=e[t-1];if(r.cp2||n.cp1){let e=r.cp2?r.cp2.x:r.x,t=r.cp2?r.cp2.y:r.y,o=n.cp1?n.cp1.x:n.x,i=n.cp1?n.cp1.y:n.y;l+=` C ${e} ${t} ${o} ${i} ${n.x} ${n.y}`;}else l+=` L ${n.x} ${n.y}`;}return t&&(l+=" Z"),l;},h=(0,s.useCallback)(()=>{if(!e||0===o.current.length)return;let t=f(o.current);r.current&&e.remove(r.current);let l=new N.Path(t,{fill:"",stroke:"black",strokeWidth:2,selectable:!1,evented:!1,objectCaching:!1});l.isTemp=!0,e.add(l),e.sendObjectToBack(l),r.current=l,e.requestRenderAll();},[e]),p=(0,s.useCallback)((t,l,n=!1)=>{if(!e)return;let r=new N.Circle({left:t,top:l,radius:4,fill:n?"#00ff00":"#ffffff",stroke:"#333",strokeWidth:1,originX:"center",originY:"center",selectable:!1,evented:!0,hasControls:!1,hasBorders:!1});return r.isTemp=!0,e.add(r),i.current.push(r),e.requestRenderAll(),r;},[e]),x=(0,s.useCallback)((l=!1)=>{if(!e||!r.current)return;let s=f(o.current,l);r.current&&e.remove(r.current),i.current.forEach(t=>e.remove(t)),i.current=[],d.current&&(e.remove(d.current),d.current=null),u.current.forEach(t=>e.remove(t)),u.current=[];let h=new N.Path(s,{fill:l?"#cccccc":"",stroke:"black",strokeWidth:2,selectable:!0,evented:!0,objectCaching:!0});e.add(h),e.setActiveObject(h),n(!1),r.current=null,o.current=[],a.current=!1,c.current=null,t&&t(),e.requestRenderAll();},[e,t]),g=(0,s.useCallback)(t=>{if(!e)return;let r=e.getPointer(t.e);if(l&&i.current.length>0){let e=i.current[0];if(t.target===e){x(!0);return;}if(i.current.includes(t.target))return;}l?(o.current.push({x:r.x,y:r.y}),p(r.x,r.y)):(n(!0),o.current=[{x:r.x,y:r.y}],p(r.x,r.y,!0)),h(),a.current=!0,c.current={x:r.x,y:r.y};},[e,l,h,p,x]),y=(0,s.useCallback)(t=>{if(!e||!l)return;let n=e.getPointer(t.e);if(a.current&&o.current.length>0){let t=o.current.length-1,l=o.current[t],r=n.x-l.x,i=n.y-l.y;if(l.cp2={x:l.x+r,y:l.y+i},l.cp1={x:l.x-r,y:l.y-i},h(),u.current.forEach(t=>e.remove(t)),u.current=[],l.cp1){let t=new N.Line([l.x,l.y,l.cp1.x,l.cp1.y],{stroke:"#666",strokeWidth:1,selectable:!1,evented:!1});t.isTemp=!0,e.add(t),u.current.push(t);}if(l.cp2){let t=new N.Line([l.x,l.y,l.cp2.x,l.cp2.y],{stroke:"#666",strokeWidth:1,selectable:!1,evented:!1});t.isTemp=!0,e.add(t),u.current.push(t);}d.current&&(e.remove(d.current),d.current=null);}else if(o.current.length>0){let t=o.current[o.current.length-1],l=`M ${t.x} ${t.y}`;t.cp2?l+=` C ${t.cp2.x} ${t.cp2.y} ${n.x} ${n.y} ${n.x} ${n.y}`:l+=` L ${n.x} ${n.y}`,d.current&&e.remove(d.current);let r=new N.Path(l,{fill:"",stroke:"#999",strokeWidth:1,strokeDashArray:[5,5],selectable:!1,evented:!1});r.isTemp=!0,e.add(r),d.current=r,e.requestRenderAll();}},[e,l,h]);return{isDrawing:l,onMouseDown:g,onMouseMove:y,onMouseUp:(0,s.useCallback)(t=>{a.current=!1,c.current=null,e&&(u.current.forEach(t=>e.remove(t)),u.current=[],e.requestRenderAll());},[e]),onDoubleClick:(0,s.useCallback)(e=>{x(!1);},[x]),finishPath:x};};function eo(e,t){if(console.log("updateObjectFromAnchors called with",t.length,"anchors for object type:",e.type),e.set("pointMeta",t),"path"===e.type){let l=function(e){if(0===e.length)return[];let t=[];t.push(["M",e[0].x,e[0].y]);for(let l=1;l<e.length;l++){let n=e[l-1],r=e[l];if(n.cp2||r.cp1){let e=n.cp2||{x:n.x,y:n.y},l=r.cp1||{x:r.x,y:r.y};t.push(["C",e.x,e.y,l.x,l.y,r.x,r.y]);}else t.push(["L",r.x,r.y]);}return t;}(t);e.set("path",l),e.setCoords();}else("polyline"===e.type||"polygon"===e.type)&&(e.set("points",t.map(e=>({x:e.x,y:e.y}))),e.setCoords());}let ei=()=>{let e=(0,s.useRef)(null),t=(0,s.useRef)(null),{setCanvas:l,setSelectedObject:n,activeTool:r,setActiveTool:i,history:a,canvas:c,setPointEditor:d}=(0,h.useVectorEditor)(),u=er(c,a.saveState),f=function(e,t,l={}){let[n,r]=(0,s.useState)(!1),[o,i]=(0,s.useState)(null),[a,c]=(0,s.useState)(null),[d,u]=(0,s.useState)("anchor"),f=(0,s.useRef)([]),h=(0,s.useRef)([]),p=(0,s.useRef)([]),x=(0,s.useRef)(null),g=(0,s.useRef)(!1),y=(0,s.useCallback)(e=>e.pointMeta?e.pointMeta:"path"===e.type?function(e){if(!e||0===e.length)return[];let t=[],l={x:0,y:0};return e.forEach(e=>{switch(e[0]){case"M":l={x:e[1],y:e[2]},t.push({x:e[1],y:e[2],type:"corner"});break;case"L":t.push({x:e[1],y:e[2],type:"corner"}),l={x:e[1],y:e[2]};break;case"C":let n=t[t.length-1];n&&(n.cp2={x:e[1],y:e[2]},n.type="smooth"),t.push({x:e[5],y:e[6],type:"smooth",cp1:{x:e[3],y:e[4]}}),l={x:e[5],y:e[6]};break;case"Q":let r={x:l.x+2/3*(e[1]-l.x),y:l.y+2/3*(e[2]-l.y)},o={x:e[3]+2/3*(e[1]-e[3]),y:e[4]+2/3*(e[2]-e[4])},i=t[t.length-1];i&&(i.cp2=r,i.type="smooth"),t.push({x:e[3],y:e[4],type:"smooth",cp1:o}),l={x:e[3],y:e[4]};}}),t;}(e.path):"polyline"===e.type||"polygon"===e.type?e.points.map(e=>({x:e.x,y:e.y,type:"corner"})):function(e){let t=e.type;if("rect"===t){let t=e.width||0,l=e.height||0;return[{x:0,y:0,type:"corner"},{x:t,y:0,type:"corner"},{x:t,y:l,type:"corner"},{x:0,y:l,type:"corner"}];}if("circle"===t||"ellipse"===t){let t=e.radius||0;return[{x:t,y:0,type:"smooth",cp1:{x:t+.5522847498*t,y:0},cp2:{x:t+.5522847498*t,y:0}},{x:t+t,y:t,type:"smooth",cp1:{x:t+t,y:t-.5522847498*t},cp2:{x:t+t,y:t+.5522847498*t}},{x:t,y:t+t,type:"smooth",cp1:{x:t+.5522847498*t,y:t+t},cp2:{x:t-.5522847498*t,y:t+t}},{x:0,y:t,type:"smooth",cp1:{x:0,y:t+.5522847498*t},cp2:{x:0,y:t-.5522847498*t}}];}return[];}(e),[]),m=(0,s.useCallback)(()=>{e&&([...f.current,...h.current].forEach(t=>{e.remove(t);}),f.current=[],h.current=[]);},[e]),v=(0,s.useCallback)(t=>{let n=t||o;if(console.log("createHandles called",{canvas:!!e,targetObject:!!n}),!e||!n)return;m();let r=p.current;console.log("Creating handles for",r.length,"anchors:",r);let i=n.calcTransformMatrix();console.log("Transform matrix:",i),r.forEach((t,n)=>{var r,o,s,c,d,u,p,x,g,y,m,v;let b=new N.Point(t.x,t.y).transform(i);console.log(`Anchor ${n}: local (${t.x}, ${t.y}) -> canvas (${b.x}, ${b.y})`);let j=new N.Circle({left:b.x,top:b.y,radius:l.anchorRadius||5,fill:a===n?"#0066ff":"#fff",stroke:"#0066ff",strokeWidth:2,originX:"center",originY:"center",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1,isTemp:!0});if(j.anchorIndex=n,j.handleType="anchor",f.current.push(j),e.add(j),t.cp1){let a=new N.Point(t.cp1.x,t.cp1.y).transform(i),p=new N.Line([b.x,b.y,a.x,a.y],{stroke:(null===(r=l.lineStyle)||void 0===r?void 0:r.stroke)||"#0066ff",strokeWidth:(null===(o=l.lineStyle)||void 0===o?void 0:o.strokeWidth)||1,strokeDashArray:(null===(s=l.lineStyle)||void 0===s?void 0:s.strokeDashArray)||[3,3],selectable:!1,evented:!1,isTemp:!0});h.current.push(p),e.add(p);let x=new N.Circle({left:a.x,top:a.y,radius:l.handleRadius||4,fill:(null===(c=l.handleStyle)||void 0===c?void 0:c.fill)||"#0066ff",stroke:(null===(d=l.handleStyle)||void 0===d?void 0:d.stroke)||"#fff",strokeWidth:(null===(u=l.handleStyle)||void 0===u?void 0:u.strokeWidth)||1,originX:"center",originY:"center",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1,isTemp:!0});x.anchorIndex=n,x.handleType="cp1",f.current.push(x),e.add(x);}if(t.cp2){let r=new N.Point(t.cp2.x,t.cp2.y).transform(i),o=new N.Line([b.x,b.y,r.x,r.y],{stroke:(null===(p=l.lineStyle)||void 0===p?void 0:p.stroke)||"#0066ff",strokeWidth:(null===(x=l.lineStyle)||void 0===x?void 0:x.strokeWidth)||1,strokeDashArray:(null===(g=l.lineStyle)||void 0===g?void 0:g.strokeDashArray)||[3,3],selectable:!1,evented:!1,isTemp:!0});h.current.push(o),e.add(o);let s=new N.Circle({left:r.x,top:r.y,radius:l.handleRadius||4,fill:(null===(y=l.handleStyle)||void 0===y?void 0:y.fill)||"#0066ff",stroke:(null===(m=l.handleStyle)||void 0===m?void 0:m.stroke)||"#fff",strokeWidth:(null===(v=l.handleStyle)||void 0===v?void 0:v.strokeWidth)||1,originX:"center",originY:"center",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1,isTemp:!0});s.anchorIndex=n,s.handleType="cp2",f.current.push(s),e.add(s);}}),console.log("Created",f.current.length,"handles and",h.current.length,"lines"),e.requestRenderAll();},[e,o,a,l,m]),b=(0,s.useCallback)((t,l={})=>{if(console.log("Point editor enter called",{canvas:!!e,object:!!t,type:null==t?void 0:t.type}),!e||!t)return;x.current=t.toObject(["pointMeta"]);let n=y(t);console.log("Extracted anchors:",n),console.log("Object details:",{type:t.type,left:t.left,top:t.top,width:t.width,height:t.height,scaleX:t.scaleX,scaleY:t.scaleY,angle:t.angle}),p.current=n,i(t),r(!0),u(l.mode||"anchor"),t.set({hasControls:!1,hasBorders:!1,selectable:!1,evented:!1}),e.selection=!1,v(t),e.requestRenderAll();},[e,y,v]),j=(0,s.useCallback)((n=!0)=>{var s,a;o&&e&&(n?(eo(o,p.current),t.saveState(),null===(s=l.onCommit)||void 0===s||s.call(l,o)):(o.set(x.current),null===(a=l.onCancel)||void 0===a||a.call(l)),o.set({hasControls:!0,hasBorders:!0,selectable:!0,evented:!0}),m(),e.selection=!0,i(null),r(!1),c(null),p.current=[],x.current=null,e.requestRenderAll());},[o,e,t,m,l]),k=(0,s.useCallback)((e,t)=>{var n;e<0||e>=p.current.length||!o||(p.current[e]={...p.current[e],x:t.x,y:t.y},eo(o,p.current),v(o),null===(n=l.onChange)||void 0===n||n.call(l,{type:"anchor:move",objectId:o.id,anchorIndex:e,after:p.current[e]}));},[o,v,l]),C=(0,s.useCallback)((e,t,n,r=!1)=>{var i;if(e<0||e>=p.current.length||!o)return;let s=p.current[e];if("cp1"===t?s.cp1=n:s.cp2=n,"smooth"!==s.type||r||s.handlesBroken)r&&(s.handlesBroken=!0);else{let e={x:2*s.x-n.x,y:2*s.y-n.y};s["cp1"===t?"cp2":"cp1"]=e;}eo(o,p.current),v(o),null===(i=l.onChange)||void 0===i||i.call(l,{type:"handle:move",objectId:o.id,anchorIndex:e,after:s});},[o,v,l]),w=(0,s.useCallback)(t=>{var n;if(!o||!e)return null;let r=o.calcTransformMatrix(),i=N.util.invertTransform(r),s=new N.Point(t.x,t.y).transform(i),a=function(e,t){if(e.length<2)return e.length;let l=1/0,n=1;for(let r=0;r<e.length-1;r++){let o=function(e,t,l){let n=l.x-t.x,r=l.y-t.y,o=n*n+r*r;if(0===o)return Math.hypot(e.x-t.x,e.y-t.y);let i=((e.x-t.x)*n+(e.y-t.y)*r)/o;i=Math.max(0,Math.min(1,i));let s=t.x+i*n,a=t.y+i*r;return Math.hypot(e.x-s,e.y-a);}(t,e[r],e[r+1]);o<l&&(l=o,n=r+1);}return n;}(p.current,s),c={x:s.x,y:s.y,type:"smooth"};return p.current.splice(a,0,c),eo(o,p.current),v(o),null===(n=l.onChange)||void 0===n||n.call(l,{type:"anchor:add",objectId:o.id,anchorIndex:a,after:c}),{index:a};},[o,e,v,l]),S=(0,s.useCallback)(e=>{var t;if(e<0||e>=p.current.length||!o||p.current.length<=2)return;let n=p.current[e];p.current.splice(e,1),eo(o,p.current),v(o),a===e&&c(null),null===(t=l.onChange)||void 0===t||t.call(l,{type:"anchor:remove",objectId:o.id,anchorIndex:e,before:n});},[o,a,v,l]),A=(0,s.useCallback)((e,t)=>{var n;if(e<0||e>=p.current.length||!o)return;let r=p.current[e],i={...r};r.type=t,"corner"===t?(delete r.cp1,delete r.cp2,r.handlesBroken=!1):"smooth"!==t||r.cp1||r.cp2||(r.cp1={x:r.x-20,y:r.y},r.cp2={x:r.x+20,y:r.y},r.handlesBroken=!1),eo(o,p.current),v(o),null===(n=l.onChange)||void 0===n||n.call(l,{type:"type:change",objectId:o.id,anchorIndex:e,before:i,after:r});},[o,v,l]);return(0,s.useEffect)(()=>{if(!e||!n)return;let t=null,l=e=>{if(!e.target||!e.target.isTemp)return;t=e.target,g.current=!0;let l=t.anchorIndex;"anchor"===t.handleType&&c(l);},r=l=>{if(!g.current||!t||!o)return;let n=e.getPointer(l.e);t.set({left:n.x,top:n.y});let r=o.calcTransformMatrix(),i=N.util.invertTransform(r),s=new N.Point(n.x,n.y).transform(i),a=t.anchorIndex,c=t.handleType;"anchor"===c?k(a,s):("cp1"===c||"cp2"===c)&&C(a,c,s,l.e.altKey),e.requestRenderAll();},i=()=>{g.current&&(g.current=!1,t=null);};return e.on("mouse:down",l),e.on("mouse:move",r),e.on("mouse:up",i),()=>{e.off("mouse:down",l),e.off("mouse:move",r),e.off("mouse:up",i);};},[e,n,o,k,C]),{isEditing:n,activeObject:o,selectedAnchorIndex:a,mode:d,enter:b,exit:j,addPoint:w,removePoint:S,movePoint:k,selectPoint:c,convertPointType:A,setMode:u,getAnchors:()=>p.current,dispose:m};}(c,a,{onChange:e=>{console.log("Point edit:",e);},onCommit:e=>{console.log("Committed changes to:",e);}});return(0,s.useEffect)(()=>{c&&d(f);},[c,f,d]),(0,s.useEffect)(()=>{if(!e.current||!t.current)return;let r=new N.Canvas(e.current,{width:t.current.clientWidth,height:t.current.clientHeight,backgroundColor:"#ffffff",selection:!0});l(r);let o=()=>{let e=r.getActiveObjects();1===e.length?n(e[0]):n(null);};r.on("selection:created",o),r.on("selection:updated",o),r.on("selection:cleared",()=>n(null));let i=e=>{e.target&&e.target.isTemp||a.saveState();};r.on("object:modified",i),r.on("object:added",i),r.on("object:removed",i),r.on("mouse:wheel",e=>{let t=e.e.deltaY,l=r.getZoom();(l*=.999**t)>20&&(l=20),l<.01&&(l=.01),r.zoomToPoint(new N.Point(e.e.offsetX,e.e.offsetY),l),e.e.preventDefault(),e.e.stopPropagation();});let s=()=>{t.current&&r.setDimensions({width:t.current.clientWidth,height:t.current.clientHeight});};return window.addEventListener("resize",s),()=>{r.dispose(),window.removeEventListener("resize",s);};},[]),(0,s.useEffect)(()=>{c&&(console.log("Active tool changed to:",r),c.isDrawingMode=!1,"pan"===r?(c.defaultCursor="grab",c.selection=!1,c.forEachObject(e=>{e.selectable=!1,e.evented=!1;})):"pen"===r?(c.defaultCursor="crosshair",c.selection=!1,c.forEachObject(e=>{e.selectable=!1,e.evented=!1;})):(c.defaultCursor="default",c.selection=!0,c.forEachObject(e=>{e.selectable=!0,e.evented=!0;})),c.requestRenderAll());},[r,c]),(0,s.useEffect)(()=>{if(!c||"pen"!==r)return;let e=e=>u.onMouseDown(e),t=e=>u.onMouseMove(e),l=e=>u.onMouseUp(e),n=e=>u.onDoubleClick(e);return c.on("mouse:down",e),c.on("mouse:move",t),c.on("mouse:up",l),c.on("mouse:dblclick",n),()=>{c.off("mouse:down",e),c.off("mouse:move",t),c.off("mouse:up",l),c.off("mouse:dblclick",n);};},[c,r,u]),en({v:()=>{console.log("V key pressed - switching to select tool"),f.isEditing&&f.exit(!0),i("select");},h:()=>{console.log("H key pressed - switching to pan tool"),i("pan");}," ":()=>{console.log("Space key pressed - switching to pan tool"),i("pan");},a:()=>{console.log("A key pressed - attempting to enter point edit mode");let e=null==c?void 0:c.getActiveObject();if(console.log("Active object:",e),console.log("Point editor is editing:",f.isEditing),console.log("Canvas exists:",!!c),!c){console.log("No canvas available");return;}if(!e){console.log("No object selected - cannot enter point edit mode");return;}if(f.isEditing){console.log("Already in point edit mode");return;}console.log("Entering point edit mode for object:",e.type),f.enter(e);},r:()=>{if(!c)return;let e=new N.Rect({left:100,top:100,fill:"#ff0000",width:100,height:100});c.add(e),c.setActiveObject(e),i("select");},c:()=>{if(!c)return;let e=new N.Circle({left:100,top:100,fill:"#00ff00",radius:50});c.add(e),c.setActiveObject(e),i("select");},t:()=>{if(!c)return;let e=new N.IText("Type here",{left:100,top:100,fontFamily:"arial",fill:"#333",fontSize:20});c.add(e),c.setActiveObject(e),i("select");},p:()=>{console.log("P key pressed - switching to pen tool"),i("pen");},"shift+c":()=>{if(f.isEditing&&null!==f.selectedAnchorIndex){let e="smooth"===f.getAnchors()[f.selectedAnchorIndex].type?"corner":"smooth";f.convertPointType(f.selectedAnchorIndex,e);}},enter:()=>{f.isEditing&&f.exit(!0);},escape:()=>{f.isEditing&&f.exit(!1);},delete:()=>{if(!c)return;if(f.isEditing&&null!==f.selectedAnchorIndex){f.removePoint(f.selectedAnchorIndex);return;}let e=c.getActiveObjects();e.length&&(c.discardActiveObject(),e.forEach(e=>{c.remove(e);}),c.requestRenderAll());},backspace:()=>{if(!c)return;if(f.isEditing&&null!==f.selectedAnchorIndex){f.removePoint(f.selectedAnchorIndex);return;}let e=c.getActiveObjects();e.length&&(c.discardActiveObject(),e.forEach(e=>{c.remove(e);}),c.requestRenderAll());},"ctrl+z":()=>a.undo(),"ctrl+shift+z":()=>a.redo(),"ctrl+=":()=>{c&&c.setZoom(1.1*c.getZoom());},"ctrl+-":()=>{c&&c.setZoom(.9*c.getZoom());},"ctrl+0":()=>{c&&(c.setZoom(1),c.setViewportTransform([1,0,0,1,0,0]));}}),(0,o.jsx)("div",{ref:t,style:{width:"100%",height:"100%"},children:(0,o.jsx)("canvas",{ref:e})});};var es=l("8e6ac0a6"),ea=n._(es),ec=l("6effc0fd"),ed=n._(ec),eu=l("4bff2451"),ef=n._(eu);let{Title:eh}=ed.default,ep=()=>{let{canvas:e,selectedObject:t}=(0,h.useVectorEditor)(),[l]=K.default.useForm(),[,n]=(0,s.useState)({});return((0,s.useEffect)(()=>{if(t){let r=()=>{let e=e=>"string"==typeof e?e:e&&"object"==typeof e&&"colorStops"in e?"#000000":e?e.toString():"transparent";l.setFieldsValue({fill:e(t.fill),stroke:e(t.stroke),strokeWidth:t.strokeWidth,opacity:t.opacity,left:Math.round(t.left||0),top:Math.round(t.top||0),width:Math.round((t.width||0)*(t.scaleX||1)),height:Math.round((t.height||0)*(t.scaleY||1)),angle:Math.round(t.angle||0)}),n({});};if(r(),e){let t=()=>r();return e.on("object:modified",t),()=>{e.off("object:modified",t);};}}},[t,e,l]),t)?(0,o.jsxs)("div",{children:[(0,o.jsx)(eh,{level:5,children:"Properties"}),(0,o.jsxs)(K.default,{form:l,layout:"vertical",onValuesChange:(l,n)=>{var r,o,i,s;if(t&&e){if("fill"in l){let e="string"==typeof l.fill?l.fill:(null===(o=l.fill)||void 0===o?void 0:null===(r=o.toHexString)||void 0===r?void 0:r.call(o))||"#000000";t.set("fill",e);}if("stroke"in l){let e="string"==typeof l.stroke?l.stroke:(null===(s=l.stroke)||void 0===s?void 0:null===(i=s.toHexString)||void 0===i?void 0:i.call(s))||"#000000";t.set("stroke",e);}if("strokeWidth"in l&&t.set("strokeWidth",l.strokeWidth),"opacity"in l&&t.set("opacity",l.opacity),"left"in l&&t.set("left",l.left),"top"in l&&t.set("top",l.top),"angle"in l&&t.set("angle",l.angle),"width"in l){let e=l.width;t.width&&t.scaleToWidth(e);}if("height"in l){let e=l.height;t.height&&t.scaleToHeight(e);}t.setCoords(),e.requestRenderAll();}},size:"small",children:[(0,o.jsx)(K.default.Item,{name:"fill",label:"Fill Color",children:(0,o.jsx)(J.default,{showText:!0})}),(0,o.jsx)(K.default.Item,{name:"stroke",label:"Stroke Color",children:(0,o.jsx)(J.default,{showText:!0})}),(0,o.jsx)(K.default.Item,{name:"strokeWidth",label:"Stroke Width",children:(0,o.jsx)(ee.default,{min:0})}),(0,o.jsx)(K.default.Item,{name:"opacity",label:"Opacity",children:(0,o.jsx)(ea.default,{min:0,max:1,step:.1})}),(0,o.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,o.jsx)(K.default.Item,{name:"left",label:"X",children:(0,o.jsx)(ee.default,{})}),(0,o.jsx)(K.default.Item,{name:"top",label:"Y",children:(0,o.jsx)(ee.default,{})})]}),(0,o.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,o.jsx)(K.default.Item,{name:"width",label:"Width",children:(0,o.jsx)(ee.default,{min:1})}),(0,o.jsx)(K.default.Item,{name:"height",label:"Height",children:(0,o.jsx)(ee.default,{min:1})})]}),(0,o.jsx)(K.default.Item,{name:"angle",label:"Rotation",children:(0,o.jsx)(ea.default,{min:0,max:360})})]})]}):(0,o.jsx)(ef.default,{description:"No object selected",image:ef.default.PRESENTED_IMAGE_SIMPLE});};var ex=l("f6c9c5f6"),eg=n._(ex),ey=l("54c23ac9"),em=n._(ey),ev=l("7502124f"),eb=n._(ev),ej=l("5a5a4642"),ek=n._(ej),eC=l("6e3683a5"),ew=n._(eC),eS=l("0d6a818e"),eA=l("4989c16f"),eE=l("039e4dd6");let{Title:eR}=ed.default,eT=({id:e,children:t,isSelected:l,onClick:n})=>{let{attributes:r,listeners:i,setNodeRef:s,setActivatorNodeRef:a,transform:c,transition:d}=(0,eA.useSortable)({id:e}),u={transform:eE.CSS.Transform.toString(c),transition:d,backgroundColor:l?"#e6f7ff":"transparent",marginBottom:4,border:"1px solid #f0f0f0",borderRadius:4,padding:"4px 8px",display:"flex",alignItems:"center"};return(0,o.jsxs)("div",{ref:s,style:u,children:[" ",(0,o.jsxs)("div",{ref:a,...r,...i,style:{cursor:"grab",marginRight:8,display:"flex",alignItems:"center",color:"#999"},children:[(0,o.jsx)(ew.default,{})," "]}),(0,o.jsxs)("div",{onClick:n,style:{flex:1,cursor:"pointer"},children:[" ",t," "]})]});},eM=()=>{let{canvas:e,selectedObject:t,setSelectedObject:l,history:n}=(0,h.useVectorEditor)(),[r,i]=(0,s.useState)([]),a=(0,eS.useSensors)((0,eS.useSensor)(eS.PointerSensor),(0,eS.useSensor)(eS.KeyboardSensor,{coordinateGetter:eA.sortableKeyboardCoordinates})),c=()=>{if(!e)return;let t=e.getObjects();t.forEach(e=>{e.uid||(e.uid=Math.random().toString(36).substr(2,9));}),i([...t].reverse());};(0,s.useEffect)(()=>{let t;if(!e)return;let l=()=>{clearTimeout(t),t=setTimeout(c,100);};return e.on("object:added",l),e.on("object:removed",l),e.on("object:modified",l),c(),()=>{e.off("object:added",l),e.off("object:removed",l),e.off("object:modified",l),clearTimeout(t);};},[e]);let d=(t,l)=>{l.stopPropagation(),t.visible=!t.visible,t.visible||null==e||e.discardActiveObject(),null==e||e.requestRenderAll(),n.saveState(),i([...(null==e?void 0:e.getObjects())||[]].reverse());},u=(t,l)=>{l.stopPropagation(),t.lockMovementX=!t.lockMovementX,t.lockMovementY=!t.lockMovementY,t.lockRotation=!t.lockRotation,t.lockScalingX=!t.lockScalingX,t.lockScalingY=!t.lockScalingY,t.selectable=!t.lockMovementX,t.selectable||null==e||e.discardActiveObject(),null==e||e.requestRenderAll(),n.saveState(),i([...(null==e?void 0:e.getObjects())||[]].reverse());},f=t=>{e&&t.visible&&t.selectable&&(e.setActiveObject(t),e.requestRenderAll());},p=(t,l)=>{l.stopPropagation(),null==e||e.remove(t),null==e||e.requestRenderAll(),n.saveState();};return(0,o.jsxs)("div",{style:{marginTop:16},children:[" ",(0,o.jsx)(eR,{level:5,children:"Layers"})," ",(0,o.jsxs)(eS.DndContext,{sensors:a,collisionDetection:eS.closestCenter,onDragEnd:t=>{let{active:l,over:o}=t;if(o&&l.id!==o.id){let t=r.findIndex(e=>e.uid===l.id),i=r.findIndex(e=>e.uid===o.id);if(-1!==t&&-1!==i){let l=r.length-1-i,o=r[t];null==e||e.moveObjectTo(o,l),null==e||e.requestRenderAll(),n.saveState(),c();}}},children:[" ",(0,o.jsx)(eA.SortableContext,{items:r.map(e=>e.uid),strategy:eA.verticalListSortingStrategy,children:(0,o.jsx)("div",{style:{maxHeight:300,overflowY:"auto",border:"1px solid #d9d9d9",borderRadius:4,padding:4},children:r.map((e,l)=>{let n=t===e,i=e.type||"Object",s=e.name||`${i} ${r.length-l}`;return(0,o.jsx)(eT,{id:e.uid,isSelected:n,onClick:()=>f(e),children:(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},children:[(0,o.jsxs)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:120},children:[s," "]}),(0,o.jsxs)(v.default,{size:4,children:[" ",(0,o.jsx)(x.default,{type:"text",size:"small",icon:e.visible?(0,o.jsx)(eg.default,{}):(0,o.jsx)(em.default,{}),onClick:t=>d(e,t),onMouseDown:e=>e.stopPropagation()}),(0,o.jsx)(x.default,{type:"text",size:"small",icon:e.lockMovementX?(0,o.jsx)(eb.default,{}):(0,o.jsx)(ek.default,{}),onClick:t=>u(e,t),onMouseDown:e=>e.stopPropagation()}),(0,o.jsx)(x.default,{type:"text",size:"small",danger:!0,icon:(0,o.jsx)(z.default,{}),onClick:t=>p(e,t),onMouseDown:e=>e.stopPropagation()})]})]})},e.uid);})})})]})]});};var eO=l("711e1aa9"),e_=n._(eO),eI=l("16d526ba"),eP=n._(eI),ez=l("1872ef2e"),eW=n._(ez),e$={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 168H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM518.3 355a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V848c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V509.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 355z"}}]},name:"vertical-align-top",theme:"outlined"},eV=s.forwardRef(function(e,t){return s.createElement(M.default,(0,E.default)((0,E.default)({},e),{},{ref:t,icon:e$}));}),eq=l("0e7003b1"),eL=n._(eq),eB={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 780H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM505.7 669a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V176c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8z"}}]},name:"vertical-align-bottom",theme:"outlined"},eD=s.forwardRef(function(e,t){return s.createElement(M.default,(0,E.default)((0,E.default)({},e),{},{ref:t,icon:eB}));}),eH=l("acdcfa21"),eX=n._(eH),eY=l("e36949ef"),eN=n._(eY);let{Title:eZ}=ed.default,eF=()=>{let{canvas:e,selectedObject:t,history:l}=(0,h.useVectorEditor)(),n=n=>{if(!e||!t)return;let r=e.width||0,o=e.height||0;switch(n){case"left":t.set({left:0});break;case"center":e.centerObjectH(t);break;case"right":t.set({left:r-(t.width||0)*(t.scaleX||1)});break;case"top":t.set({top:0});break;case"middle":e.centerObjectV(t);break;case"bottom":t.set({top:o-(t.height||0)*(t.scaleY||1)});}t.setCoords(),e.requestRenderAll(),l.saveState();};return t?(0,o.jsxs)("div",{style:{marginBottom:16},children:[(0,o.jsx)(eZ,{level:5,children:"Alignment & Grouping"}),(0,o.jsxs)(v.default,{wrap:!0,children:[(0,o.jsx)(y.default,{title:"Align Left",children:(0,o.jsx)(x.default,{size:"small",icon:(0,o.jsx)(e_.default,{}),onClick:()=>n("left")})}),(0,o.jsx)(y.default,{title:"Align Center",children:(0,o.jsx)(x.default,{size:"small",icon:(0,o.jsx)(eP.default,{}),onClick:()=>n("center")})}),(0,o.jsx)(y.default,{title:"Align Right",children:(0,o.jsx)(x.default,{size:"small",icon:(0,o.jsx)(eW.default,{}),onClick:()=>n("right")})}),(0,o.jsx)(y.default,{title:"Align Top",children:(0,o.jsx)(x.default,{size:"small",icon:(0,o.jsx)(eV,{}),onClick:()=>n("top")})}),(0,o.jsx)(y.default,{title:"Align Middle",children:(0,o.jsx)(x.default,{size:"small",icon:(0,o.jsx)(eL.default,{}),onClick:()=>n("middle")})}),(0,o.jsx)(y.default,{title:"Align Bottom",children:(0,o.jsx)(x.default,{size:"small",icon:(0,o.jsx)(eD,{}),onClick:()=>n("bottom")})})]}),(0,o.jsx)("div",{style:{marginTop:8},children:(0,o.jsxs)(v.default,{children:[(0,o.jsx)(y.default,{title:"Group",children:(0,o.jsx)(x.default,{size:"small",icon:(0,o.jsx)(eX.default,{}),onClick:()=>{if(!e)return;let t=e.getActiveObject();t&&"activeSelection"===t.type&&(t.toGroup(),e.requestRenderAll(),l.saveState());}})}),(0,o.jsx)(y.default,{title:"Ungroup",children:(0,o.jsx)(x.default,{size:"small",icon:(0,o.jsx)(eN.default,{}),onClick:()=>{if(!e)return;let t=e.getActiveObject();t&&"group"===t.type&&(t.toActiveSelection(),e.requestRenderAll(),l.saveState());}})})]})})]}):null;},{Sider:eG,Content:eK}=f.default,eU=()=>(0,o.jsx)(a.PageContainer,{title:"Vector Editor",children:(0,o.jsx)(h.VectorEditorProvider,{children:(0,o.jsx)(d.default,{className:"editorContainer-K_31rsCt",bodyStyle:{padding:0,height:"100%"},children:(0,o.jsxs)(f.default,{style:{height:"80vh"},children:[(0,o.jsx)(eG,{theme:"light",width:60,className:"toolbarSider-WrdEPO3N",children:(0,o.jsx)(el,{})}),(0,o.jsx)(eK,{className:"canvasContent-l3CEHf1z",children:(0,o.jsx)(ei,{})}),(0,o.jsxs)(eG,{theme:"light",width:300,className:"propertiesSider-2RCO5zZs",children:[(0,o.jsx)(eF,{}),(0,o.jsx)(ep,{}),(0,o.jsx)(eM,{})]})]})})})});}}]);
//# sourceMappingURL=c64d443d-async.3e030fc0.js.map