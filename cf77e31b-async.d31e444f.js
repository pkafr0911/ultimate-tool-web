(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]||[]).push([["cf77e31b"],{ce47aff6:function(e,t,r){r.d(t,"__esModule",{value:!0}),r.e(t,{default:function(){return lp;}});var l=r("777fffbe"),n=r("852bbaa9"),a=r("95bd365d"),i=r("a4f51854"),o=l._(i),s=r("d6f53458"),c=l._(s),d=r("5f92d263"),u=l._(d),h=r("0ec3d373"),f=l._(h),g=r("bb4b9fac"),m=l._(g),x=r("5a83e636"),p=l._(x),v=r("2206dff1"),y=l._(v),w=r("522a0302"),b=l._(w),j=r("e0fc3175"),C=l._(j),k=r("0ed998a9"),S=l._(k),M=r("314fd1a3"),I=n._(M),E=r("90c13dc1"),R=l._(E),z=r("2ac36d38"),T=l._(z),B=r("0d80f9fc"),D=l._(B),L=r("75108e4c"),$=l._(L),N=r("24580d3d"),A=l._(N),P=r("746af7b4"),O=l._(P),_=r("04a40bcc"),H=l._(_),W=r("23c4f70e"),U=l._(W),F=r("1734979e"),V=l._(F),G=r("8cadd51b"),X=l._(G),K=r("7b3518ff"),Y=l._(K);function q(e){return null!==e&&"object"===(0,$.default)(e);}function Z(e,t,r){if(!1===e||!1===t&&(!q(e)||!e.closeIcon))return null;var l,n="boolean"!=typeof t?t:void 0;return q(e)?(0,T.default)((0,T.default)({},e),{},{closeIcon:null!==(l=e.closeIcon)&&void 0!==l?l:n}):r||e||t?{closeIcon:n}:"empty";}var J=r("97af5592"),Q=l._(J),ee=r("e9dc6605"),et=l._(ee),er={fill:"transparent",pointerEvents:"auto"},el=function(e){var t=e.prefixCls,r=e.rootClassName,l=e.pos,n=e.showMask,a=e.style,i=e.fill,o=e.open,s=e.animated,c=e.zIndex,d=e.disabledInteraction,u=(0,et.default)(),h="".concat(t,"-mask-").concat(u),f="object"===(0,$.default)(s)?null==s?void 0:s.placeholder:s,g="undefined"!=typeof navigator&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return I.default.createElement(H.default,{open:o,autoLock:!0},I.default.createElement("div",{className:(0,V.default)("".concat(t,"-mask"),r),style:(0,T.default)({position:"fixed",left:0,right:0,top:0,bottom:0,zIndex:c,pointerEvents:l&&!d?"none":"auto"},void 0===a?{}:a)},n?I.default.createElement("svg",{style:{width:"100%",height:"100%"}},I.default.createElement("defs",null,I.default.createElement("mask",{id:h},I.default.createElement("rect",(0,D.default)({x:"0",y:"0"},g?{width:"100%",height:"100%"}:{width:"100vw",height:"100vh"},{fill:"white"})),l&&I.default.createElement("rect",{x:l.left,y:l.top,rx:l.radius,width:l.width,height:l.height,fill:"black",className:f?"".concat(t,"-placeholder-animated"):""}))),I.default.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:void 0===i?"rgba(0,0,0,0.5)":i,mask:"url(#".concat(h,")")}),l&&I.default.createElement(I.default.Fragment,null,I.default.createElement("rect",(0,D.default)({},er,{x:"0",y:"0",width:"100%",height:l.top})),I.default.createElement("rect",(0,D.default)({},er,{x:"0",y:"0",width:l.left,height:"100%"})),I.default.createElement("rect",(0,D.default)({},er,{x:"0",y:l.top+l.height,width:"100%",height:"calc(100vh - ".concat(l.top+l.height,"px)")})),I.default.createElement("rect",(0,D.default)({},er,{x:l.left+l.width,y:"0",width:"calc(100vw - ".concat(l.left+l.width,"px)"),height:"100%"})))):null));},en=[0,0],ea={left:{points:["cr","cl"],offset:[-8,0]},right:{points:["cl","cr"],offset:[8,0]},top:{points:["bc","tc"],offset:[0,-8]},bottom:{points:["tc","bc"],offset:[0,8]},topLeft:{points:["bl","tl"],offset:[0,-8]},leftTop:{points:["tr","tl"],offset:[-8,0]},topRight:{points:["br","tr"],offset:[0,-8]},rightTop:{points:["tl","tr"],offset:[8,0]},bottomRight:{points:["tr","br"],offset:[0,8]},rightBottom:{points:["bl","br"],offset:[8,0]},bottomLeft:{points:["tl","bl"],offset:[0,8]},leftBottom:{points:["br","bl"],offset:[-8,0]}};function ei(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={};return Object.keys(ea).forEach(function(r){t[r]=(0,T.default)((0,T.default)({},ea[r]),{},{autoArrow:e,targetOffset:en});}),t;}ei();var eo=r("31eb8043"),es=l._(eo),ec=r("f0df3213"),ed=l._(ec);function eu(e){var t,r=e.prefixCls,l=e.current,n=e.total,a=e.title,i=e.description,o=e.onClose,s=e.onPrev,c=e.onNext,d=e.onFinish,u=e.className,h=e.closable,f=(0,ed.default)(h||{},!0),g=null!==(t=null==h?void 0:h.closeIcon)&&void 0!==t?t:I.createElement("span",{className:"".concat(r,"-close-x")},"\xd7"),m=!!h;return I.createElement("div",{className:(0,V.default)("".concat(r,"-content"),u)},I.createElement("div",{className:"".concat(r,"-inner")},m&&I.createElement("button",(0,D.default)({type:"button",onClick:o,"aria-label":"Close"},f,{className:"".concat(r,"-close")}),g),I.createElement("div",{className:"".concat(r,"-header")},I.createElement("div",{className:"".concat(r,"-title")},a)),I.createElement("div",{className:"".concat(r,"-description")},i),I.createElement("div",{className:"".concat(r,"-footer")},I.createElement("div",{className:"".concat(r,"-sliders")},n>1?(0,es.default)(Array.from({length:n}).keys()).map(function(e,t){return I.createElement("span",{key:e,className:t===l?"active":""});}):null),I.createElement("div",{className:"".concat(r,"-buttons")},0!==l?I.createElement("button",{className:"".concat(r,"-prev-btn"),onClick:s},"Prev"):null,l===n-1?I.createElement("button",{className:"".concat(r,"-finish-btn"),onClick:d},"Finish"):I.createElement("button",{className:"".concat(r,"-next-btn"),onClick:c},"Next")))));}var eh=function(e){var t=e.current,r=e.renderPanel;return I.createElement(I.Fragment,null,"function"==typeof r?r(e,t):I.createElement(eu,e));},ef=["prefixCls","steps","defaultCurrent","current","onChange","onClose","onFinish","open","mask","arrow","rootClassName","placement","renderPanel","gap","animated","scrollIntoViewOptions","zIndex","closeIcon","closable","builtinPlacements","disabledInteraction"],eg={left:"50%",top:"50%",width:1,height:1},em={block:"center",inline:"center"},ex=function(e){var t,r,l,n,a,i,o,s,c,d,u,h,f,g=e.prefixCls,m=void 0===g?"rc-tour":g,x=e.steps,p=void 0===x?[]:x,v=e.defaultCurrent,y=e.current,w=e.onChange,b=e.onClose,j=e.onFinish,C=e.open,k=e.mask,S=e.arrow,M=e.rootClassName,E=e.placement,R=e.renderPanel,z=e.gap,B=e.animated,L=e.scrollIntoViewOptions,N=e.zIndex,P=void 0===N?1001:N,_=e.closeIcon,W=e.closable,F=e.builtinPlacements,G=e.disabledInteraction,K=(0,O.default)(e,ef),q=I.useRef(),J=(0,Y.default)(0,{value:y,defaultValue:v}),ee=(0,A.default)(J,2),et=ee[0],er=ee[1],en=(0,Y.default)(void 0,{value:C,postState:function(e){return!(et<0)&&!(et>=p.length)&&(null==e||e);}}),ea=(0,A.default)(en,2),eo=ea[0],es=ea[1],ec=I.useState(eo),ed=(0,A.default)(ec,2),eu=ed[0],ex=ed[1],ep=I.useRef(eo);(0,X.default)(function(){eo&&(ep.current||er(0),ex(!0)),ep.current=eo;},[eo]);var ev=p[et]||{},ey=ev.target,ew=ev.placement,eb=ev.style,ej=ev.arrow,eC=ev.className,ek=ev.mask,eS=ev.scrollIntoViewOptions,eM=void 0===eS?em:eS,eI=ev.closeIcon,eE=(t=ev.closable,I.useMemo(function(){var e=Z(t,eI,!1),r=Z(W,_,!0);return"empty"!==e?e:r;},[W,_,t,eI])),eR=eo&&(null!=ek?ek:void 0===k||k),ez=(r=null!=eM?eM:void 0===L?em:L,l=(0,I.useState)(void 0),a=(n=(0,A.default)(l,2))[0],i=n[1],(0,X.default)(function(){i(("function"==typeof ey?ey():ey)||null);}),o=(0,I.useState)(null),c=(s=(0,A.default)(o,2))[0],d=s[1],u=(0,Q.default)(function(){if(a){e=window.innerWidth||document.documentElement.clientWidth,t=window.innerHeight||document.documentElement.clientHeight,n=(l=a.getBoundingClientRect()).top,i=l.right,o=l.bottom,s=l.left,n>=0&&s>=0&&i<=e&&o<=t||!C||a.scrollIntoView(r);var e,t,l,n,i,o,s,c=a.getBoundingClientRect(),u={left:c.left,top:c.top,width:c.width,height:c.height,radius:0};d(function(e){return JSON.stringify(e)!==JSON.stringify(u)?u:e;});}else d(null);}),h=function(e){var t;return null!==(t=Array.isArray(null==z?void 0:z.offset)?null==z?void 0:z.offset[e]:null==z?void 0:z.offset)&&void 0!==t?t:6;},(0,X.default)(function(){return u(),window.addEventListener("resize",u),function(){window.removeEventListener("resize",u);};},[a,C,u]),[(0,I.useMemo)(function(){if(!c)return c;var e,t=h(0),r=h(1),l="number"!=typeof(e=null==z?void 0:z.radius)||Number.isNaN(e)?2:null==z?void 0:z.radius;return{left:c.left-t,top:c.top-r,width:c.width+2*t,height:c.height+2*r,radius:l};},[c,z]),a]),eT=(0,A.default)(ez,2),eB=eT[0],eD=eT[1],eL=null!==(f=null!=ew?ew:E)&&void 0!==f?f:null===eD?"center":"bottom",e$=!!eD&&(void 0===ej?void 0===S||S:ej),eN="object"===(0,$.default)(e$)&&e$.pointAtCenter;(0,X.default)(function(){var e;null===(e=q.current)||void 0===e||e.forceAlign();},[eN,et]);var eA=function(e){er(e),null==w||w(e);},eP=(0,I.useMemo)(function(){return F?"function"==typeof F?F({arrowPointAtCenter:eN}):F:ei(eN);},[F,eN]);if(void 0===eD||!eu)return null;var eO=function(){es(!1),null==b||b(et);},e_="boolean"==typeof eR?void 0:eR;return I.createElement(I.Fragment,null,I.createElement(el,{zIndex:P,prefixCls:m,pos:eB,showMask:"boolean"==typeof eR?eR:!!eR,style:null==e_?void 0:e_.style,fill:null==e_?void 0:e_.color,open:eo,animated:B,rootClassName:M,disabledInteraction:G}),I.createElement(U.default,(0,D.default)({},K,{builtinPlacements:eP,ref:q,popupStyle:eb,popupPlacement:eL,popupVisible:eo,popupClassName:(0,V.default)(M,eC),prefixCls:m,popup:function(){return I.createElement(eh,(0,D.default)({arrow:e$,key:"content",prefixCls:m,total:p.length,renderPanel:R,onPrev:function(){eA(et-1);},onNext:function(){eA(et+1);},onClose:eO,current:et,onFinish:function(){eO(),null==j||j();}},p[et],{closable:eE}));},forceRender:!1,destroyPopupOnHide:!0,zIndex:P,getTriggerDOMNode:function(e){return e||eD||document.body;},arrow:!!e$}),I.createElement(H.default,{open:eo,autoLock:!0},I.createElement("div",{className:(0,V.default)(M,"".concat(m,"-target-placeholder")),style:(0,T.default)((0,T.default)({},eB||eg),{},{position:"fixed",pointerEvents:"none"})}))));},ep=r("9d4fd2de"),ev=r("49ad6aa6"),ey=l._(ev),ew=r("a40ac0be"),eb=l._(ew),ej=r("0a1edbdd"),eC=r("e52c3c4e"),ek=r("aece915f"),eS=l._(ek),eM=r("371b674a"),eI=l._(eM),eE=r("25772bbe"),eR=l._(eE);let ez=e=>{var t,r;let l;let{stepProps:n,current:a,type:i,indicatorsRender:o}=e,{prefixCls:s,total:c=1,title:d,onClose:u,onPrev:h,onNext:g,onFinish:m,cover:x,description:p,nextButtonProps:v,prevButtonProps:y,type:w,closable:b}=n,j=null!=w?w:i,C=I.default.createElement("button",{type:"button",onClick:u,className:`${s}-close`},(null==b?void 0:b.closeIcon)||I.default.createElement(eS.default,{className:`${s}-close-icon`})),k=a===c-1,S=null!=d?I.default.createElement("div",{className:`${s}-header`},I.default.createElement("div",{className:`${s}-title`},d)):null,M=null!=p?I.default.createElement("div",{className:`${s}-description`},p):null,E=null!=x?I.default.createElement("div",{className:`${s}-cover`},x):null;l=o?o(a,c):(0,es.default)(Array.from({length:c}).keys()).map((e,t)=>I.default.createElement("span",{key:e,className:(0,V.default)(t===a&&`${s}-indicator-active`,`${s}-indicator`)}));let[R]=(0,eI.default)("Tour",eR.default.Tour);return I.default.createElement("div",{className:`${s}-content`},I.default.createElement("div",{className:`${s}-inner`},b&&C,E,S,M,I.default.createElement("div",{className:`${s}-footer`},c>1&&I.default.createElement("div",{className:`${s}-indicators`},l),I.default.createElement("div",{className:`${s}-buttons`},0!==a?I.default.createElement(f.default,Object.assign({},{type:"default",ghost:"primary"===j},y,{onClick:()=>{var e;null==h||h(),null===(e=null==y?void 0:y.onClick)||void 0===e||e.call(y);},size:"small",className:(0,V.default)(`${s}-prev-btn`,null==y?void 0:y.className)}),null!==(t=null==y?void 0:y.children)&&void 0!==t?t:null==R?void 0:R.Previous):null,I.default.createElement(f.default,Object.assign({type:"primary"===j?"default":"primary"},v,{onClick:()=>{var e;k?null==m||m():null==g||g(),null===(e=null==v?void 0:v.onClick)||void 0===e||e.call(v);},size:"small",className:(0,V.default)(`${s}-next-btn`,null==v?void 0:v.className)}),null!==(r=null==v?void 0:v.children)&&void 0!==r?r:k?null==R?void 0:R.Finish:null==R?void 0:R.Next)))));};var eT=r("3a7d5561"),eB=l._(eT),eD=r("3c67663a"),eL=r("907513d5"),e$=r("67fa5550"),eN=r("8ecd1e8c"),eA=r("aabd7a70"),eP=r("cc9448da"),eO=r("9a49b97d"),e_=n._(eO),eH=r("4f565aee"),eW=r("9f7f85f7"),eU=r("d55878a9");let eF=e=>{let{componentCls:t,padding:r,paddingXS:l,borderRadius:n,borderRadiusXS:a,colorPrimary:i,colorFill:o,indicatorHeight:s,indicatorWidth:c,boxShadowTertiary:d,zIndexPopup:u,colorBgElevated:h,fontWeightStrong:f,marginXS:g,colorTextLightSolid:m,tourBorderRadius:x,colorWhite:p,primaryNextBtnHoverBg:v,closeBtnSize:y,motionDurationSlow:w,antCls:b,primaryPrevBtnBg:j}=e;return[{[t]:Object.assign(Object.assign({},(0,eP.resetComponent)(e)),{position:"absolute",zIndex:u,maxWidth:"fit-content",visibility:"visible",width:520,"--antd-arrow-background-color":h,"&-pure":{maxWidth:"100%",position:"relative"},[`&${t}-hidden`]:{display:"none"},[`${t}-content`]:{position:"relative"},[`${t}-inner`]:{textAlign:"start",textDecoration:"none",borderRadius:x,boxShadow:d,position:"relative",backgroundColor:h,border:"none",backgroundClip:"padding-box",[`${t}-close`]:Object.assign({position:"absolute",top:r,insetInlineEnd:r,color:e.colorIcon,background:"none",border:"none",width:y,height:y,borderRadius:e.borderRadiusSM,transition:`background-color ${e.motionDurationMid}, color ${e.motionDurationMid}`,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer","&:hover":{color:e.colorIconHover,backgroundColor:e.colorBgTextHover},"&:active":{backgroundColor:e.colorBgTextActive}},(0,eP.genFocusStyle)(e)),[`${t}-cover`]:{textAlign:"center",padding:`${(0,eN.unit)(e.calc(r).add(y).add(l).equal())} ${(0,eN.unit)(r)} 0`,img:{width:"100%"}},[`${t}-header`]:{padding:`${(0,eN.unit)(r)} ${(0,eN.unit)(r)} ${(0,eN.unit)(l)}`,width:`calc(100% - ${(0,eN.unit)(y)})`,wordBreak:"break-word",[`${t}-title`]:{fontWeight:f}},[`${t}-description`]:{padding:`0 ${(0,eN.unit)(r)}`,wordWrap:"break-word"},[`${t}-footer`]:{padding:`${(0,eN.unit)(l)} ${(0,eN.unit)(r)} ${(0,eN.unit)(r)}`,textAlign:"end",borderRadius:`0 0 ${(0,eN.unit)(a)} ${(0,eN.unit)(a)}`,display:"flex",[`${t}-indicators`]:{display:"inline-block",[`${t}-indicator`]:{width:c,height:s,display:"inline-block",borderRadius:"50%",background:o,"&:not(:last-child)":{marginInlineEnd:s},"&-active":{background:i}}},[`${t}-buttons`]:{marginInlineStart:"auto",[`${b}-btn`]:{marginInlineStart:g}}}},[`${t}-primary, &${t}-primary`]:{"--antd-arrow-background-color":i,[`${t}-inner`]:{color:m,textAlign:"start",textDecoration:"none",backgroundColor:i,borderRadius:n,boxShadow:d,[`${t}-close`]:{color:m},[`${t}-indicators`]:{[`${t}-indicator`]:{background:j,"&-active":{background:m}}},[`${t}-prev-btn`]:{color:m,borderColor:j,backgroundColor:i,"&:hover":{backgroundColor:j,borderColor:"transparent"}},[`${t}-next-btn`]:{color:i,borderColor:"transparent",background:p,"&:hover":{background:v}}}}}),[`${t}-mask`]:{[`${t}-placeholder-animated`]:{transition:`all ${w}`}},"&-placement-left,&-placement-leftTop,&-placement-leftBottom,&-placement-right,&-placement-rightTop,&-placement-rightBottom":{[`${t}-inner`]:{borderRadius:e.min(x,e_.MAX_VERTICAL_CONTENT_RADIUS)}}},(0,e_.default)(e,"var(--antd-arrow-background-color)")];};var eV=(0,eW.genStyleHooks)("Tour",e=>{let{borderRadiusLG:t}=e;return[eF((0,eU.mergeToken)(e,{indicatorWidth:6,indicatorHeight:6,tourBorderRadius:t}))];},e=>Object.assign(Object.assign({zIndexPopup:e.zIndexPopupBase+70,closeBtnSize:e.fontSize*e.lineHeight,primaryPrevBtnBg:new eA.FastColor(e.colorTextLightSolid).setA(.15).toRgbString(),primaryNextBtnHoverBg:new eA.FastColor(e.colorBgTextHover).onBackground(e.colorWhite).toRgbString()},(0,e_.getArrowOffsetToken)({contentRadius:e.borderRadiusLG,limitVerticalRadius:!0})),(0,eH.getArrowToken)(e))),eG=this&&this.__rest||function(e,t){var r={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&0>t.indexOf(l)&&(r[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,l=Object.getOwnPropertySymbols(e);n<l.length;n++)0>t.indexOf(l[n])&&Object.prototype.propertyIsEnumerable.call(e,l[n])&&(r[l[n]]=e[l[n]]);return r;},eX=(0,eD.withPureRenderTheme)(e=>{let{prefixCls:t,current:r=0,total:l=6,className:n,style:a,type:i,closable:o,closeIcon:s}=e,c=eG(e,["prefixCls","current","total","className","style","type","closable","closeIcon"]),{getPrefixCls:d}=I.useContext(ej.ConfigContext),u=d("tour",t),[h,f,g]=eV(u),[m,x]=(0,eB.default)({closable:o,closeIcon:s},null,{closable:!0,closeIconRender:e=>I.isValidElement(e)?(0,eL.cloneElement)(e,{className:(0,V.default)(e.props.className,`${u}-close-icon`)}):e});return h(I.createElement(e$.RawPurePanel,{prefixCls:u,hashId:f,className:(0,V.default)(n,`${u}-pure`,i&&`${u}-${i}`,g),style:a},I.createElement(ez,{stepProps:Object.assign(Object.assign({},c),{prefixCls:u,total:l,closable:m?{closeIcon:x}:void 0}),current:r,type:i})));}),eK=this&&this.__rest||function(e,t){var r={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&0>t.indexOf(l)&&(r[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,l=Object.getOwnPropertySymbols(e);n<l.length;n++)0>t.indexOf(l[n])&&Object.prototype.propertyIsEnumerable.call(e,l[n])&&(r[l[n]]=e[l[n]]);return r;};let eY=e=>{let{prefixCls:t,type:r,rootClassName:l,indicatorsRender:n,steps:a,closeIcon:i}=e,o=eK(e,["prefixCls","type","rootClassName","indicatorsRender","steps","closeIcon"]),{getPrefixCls:s,direction:c,tour:d}=(0,I.useContext)(ej.ConfigContext),u=s("tour",t),[h,f,g]=eV(u),[,m]=(0,eC.useToken)(),x=I.default.useMemo(()=>null==a?void 0:a.map(e=>{var t;return Object.assign(Object.assign({},e),{className:(0,V.default)(e.className,{[`${u}-primary`]:(null!==(t=e.type)&&void 0!==t?t:r)==="primary"})});}),[a,r]),p=(0,V.default)({[`${u}-rtl`]:"rtl"===c},f,g,l),[v,y]=(0,ep.useZIndex)("Tour",o.zIndex);return h(I.default.createElement(eb.default.Provider,{value:y},I.default.createElement(ex,Object.assign({},o,{closeIcon:null!=i?i:null==d?void 0:d.closeIcon,zIndex:v,rootClassName:p,prefixCls:u,animated:!0,renderPanel:(e,t)=>I.default.createElement(ez,{type:r,stepProps:e,current:t,indicatorsRender:n}),builtinPlacements:e=>{var t;return(0,ey.default)({arrowPointAtCenter:null===(t=null==e?void 0:e.arrowPointAtCenter)||void 0===t||t,autoAdjustOverflow:!0,offset:m.marginXXS,arrowWidth:m.sizePopupArrow,borderRadius:m.borderRadius});},steps:x}))));};eY._InternalPanelDoNotUseOrYouWillBeFired=eX;var eq=r("95d03ed3"),eZ=l._(eq);function eJ(e,t){let r=document.createElement("canvas");return r.width=e,r.height=t,r;}function eQ(e,t,r){let l=e.width,n=e.height,a=e.data,i=new Uint8ClampedArray(a.length),o=Math.floor(r/2);for(let e=0;e<n;e++)for(let s=0;s<l;s++){let c=0,d=0,u=0,h=0;for(let i=0;i<r;i++)for(let f=0;f<r;f++){let g=s+f-o,m=e+i-o;if(g<0||g>=l||m<0||m>=n)continue;let x=(m*l+g)*4,p=t[i*r+f];c+=a[x]*p,d+=a[x+1]*p,u+=a[x+2]*p,h+=a[x+3]*p;}let f=(e*l+s)*4;i[f]=Math.min(255,Math.max(0,c)),i[f+1]=Math.min(255,Math.max(0,d)),i[f+2]=Math.min(255,Math.max(0,u)),i[f+3]=Math.min(255,Math.max(0,h||a[f+3]));}return e.data.set(i),e;}let e0={sharpen:[0,-1,0,-1,5,-1,0,-1,0],blur3:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],gaussian5:[1/273,4/273,7/273,4/273,1/273,4/273,16/273,26/273,16/273,4/273,7/273,26/273,41/273,26/273,7/273,4/273,16/273,26/273,16/273,4/273,1/273,4/273,7/273,4/273,1/273],generateBoxBlurKernel(e){let t=0|e,r=t*t;return Array(r).fill(1/r);},generateGaussianKernel(e){let t=0|e,r=t/2,l=2*r*r,n=[],a=0;for(let e=-t;e<=t;e++)for(let r=-t;r<=t;r++){let t=Math.exp(-(r*r+e*e)/l);n.push(t),a+=t;}return n.map(e=>e/a);}},e1=(e,t=0,r=255)=>Math.min(r,Math.max(t,e)),e2=e=>Math.min(1,Math.max(0,e)),e8=(e,t,r)=>{let l=Math.max(e/=255,t/=255,r/=255),n=Math.min(e,t,r),a=0,i=0,o=(l+n)/2;if(l!==n){let s=l-n;switch(i=o>.5?s/(2-l-n):s/(l+n),l){case e:a=(t-r)/s+(t<r?6:0);break;case t:a=(r-e)/s+2;break;case r:a=(e-t)/s+4;}a/=6;}return[a,i,o];},e4=(e,t,r)=>{let l,n,a;if(0===t)l=n=a=r;else{let i=(e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6)?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e,o=r<.5?r*(1+t):r+t-r*t,s=2*r-o;l=i(s,o,e+1/3),n=i(s,o,e),a=i(s,o,e-1/3);}return[Math.round(255*l),Math.round(255*n),Math.round(255*a)];},e6=(e,{highlights:t=0,shadows:r=0,whites:l=0,blacks:n=0,vibrance:a=0,saturation:i=0,clarity:o=0,dehaze:s=0})=>{let c=e.data,d=0!==o?new Uint8ClampedArray(c):null;for(let e=0;e<c.length;e+=4){let u=c[e],h=c[e+1],f=c[e+2],g=.299*u+.587*h+.114*f;if(g>192&&0!==t){let e=(g-192)/63;u=e1(u+t*e),h=e1(h+t*e),f=e1(f+t*e);}if(g<64&&0!==r){let e=1-g/64;u=e1(u+r*e),h=e1(h+r*e),f=e1(f+r*e);}if(u=e1(u+l-n),h=e1(h+l-n),f=e1(f+l-n),0!==s&&(u=e1(u*(1+s/100)),h=e1(h*(1-s/200)),f=e1(f*(1-s/200))),0!==a||0!==i){let e=[u,h,f];e3(e,0,{vibrance:a,saturation:i}),[u,h,f]=e;}if(0!==o&&d){let t=o/100*(g-(.299*d[e]+.587*d[e+1]+.114*d[e+2]));u=e1(u+t),h=e1(h+t),f=e1(f+t);}c[e]=u,c[e+1]=h,c[e+2]=f;}return e;},e5=(e,t,r)=>{let l=e[t],n=e[t+1],a=e[t+2],[i,o,s]=e8(l,n,a),c=1+r/100*1.5;l=e1(128+(l-128)*c),n=e1(128+(n-128)*c),a=e1(128+(a-128)*c),[i,o,s]=e8(l,n,a),o=e2(o*(1+r/100*.6)),s=e2(s*(1+r/100*.15)),[l,n,a]=e4(i,o,s),e[t]=l,e[t+1]=n,e[t+2]=a;},e3=(e,t,{vibrance:r=0,saturation:l=0})=>{let[n,a,i]=e8(e[t],e[t+1],e[t+2]);0!==l&&(a=e2(a*(1+l/100))),0!==r&&(a=e2(a+r/100*(1-a)*(1-a)));let[o,s,c]=e4(n,a,i);e[t]=o,e[t+1]=s,e[t+2]=c;},e9=[{name:"red",range:[345,15]},{name:"orange",range:[15,45]},{name:"yellow",range:[45,75]},{name:"green",range:[75,165]},{name:"aqua",range:[165,195]},{name:"blue",range:[195,255]},{name:"purple",range:[255,285]},{name:"magenta",range:[285,345]}],e7=(e,t)=>{let r=e.data;for(let e=0;e<r.length;e+=4){let[l,n,a]=[r[e],r[e+1],r[e+2]],[i,o,s]=e8(l,n,a),c=(360*i+360)%360,d=e9.find(({range:e})=>{let[t,r]=e;return t<=r?c>=t&&c<=r:c>=t||c<=r;});if(!d){[r[e],r[e+1],r[e+2]]=e4(i,o,s);continue;}let u=t[d.name];if(!u){[r[e],r[e+1],r[e+2]]=e4(i,o,s);continue;}let[h,f]=d.range,g=f;h>g&&(g+=360);let m=c;if(m<h&&(m+=360),"number"==typeof u.h&&0!==u.h){let e=m+u.h;e<h&&(e=h),e>g&&(e=g),i=(c=(e%360+360)%360)/360;}"number"==typeof u.s&&0!==u.s&&(o=e2(o*(1+(1>=Math.abs(u.s)?100*u.s:u.s)/100))),"number"==typeof u.l&&0!==u.l&&(s=e2(s*(1+(1>=Math.abs(u.l)?100*u.l:u.l)/100))),[r[e],r[e+1],r[e+2]]=e4(i,o,s);}return e;},te=(e,t,r,l)=>{if(!t.current)return;let n=t.current,a=eJ(n.width,n.height);a.getContext("2d").drawImage(n,0,0);let i=eJ(n.height,n.width),o=i.getContext("2d");o.translate(i.width/2,i.height/2),o.rotate(e*Math.PI/180),o.drawImage(a,-a.width/2,-a.height/2),t.current.width=i.width,t.current.height=i.height,r.current.width=i.width,r.current.height=i.height;let s=t.current.getContext("2d");s.clearRect(0,0,i.width,i.height),s.drawImage(i,0,0),l.push(t.current.toDataURL(),`Rotate ${e}`);},tt=(e,t)=>{if(!e.current)return;let r=e.current.getContext("2d"),l=eJ(e.current.width,e.current.height);l.getContext("2d").drawImage(e.current,0,0),r.save(),r.clearRect(0,0,e.current.width,e.current.height),r.scale(-1,1),r.drawImage(l,-e.current.width,0),r.restore(),t.push(e.current.toDataURL(),"Flip horizontal");},tr=(e,t)=>{if(!e.current)return;let r=e.current.getContext("2d"),l=eJ(e.current.width,e.current.height);l.getContext("2d").drawImage(e.current,0,0),r.save(),r.clearRect(0,0,e.current.width,e.current.height),r.scale(1,-1),r.drawImage(l,0,-e.current.height),r.restore(),t.push(e.current.toDataURL(),"Flip vertical");},tl=(e,t,r,l,n)=>{if(!e.current||!r)return;let a=eJ(Math.max(1,Math.round(r.w)),Math.max(1,Math.round(r.h)));a.getContext("2d").drawImage(e.current,r.x,r.y,r.w,r.h,0,0,r.w,r.h),e.current.width=a.width,e.current.height=a.height,t.current.width=a.width,t.current.height=a.height;let i=e.current.getContext("2d");i.clearRect(0,0,a.width,a.height),i.drawImage(a,0,0),l(null),n.push(e.current.toDataURL(),"Cropped");},tn=async e=>{if(e.current)try{let t=await new Promise(t=>e.current.toBlob(e=>t(e),"image/png"));if(!t)return;await navigator.clipboard.write([new ClipboardItem({"image/png":t})]),S.default.success("Image copied to clipboard");}catch(e){console.warn("clipboard failed",e),S.default.error("Copy failed (browser may not support)");}},ta=(e,t,r)=>{let l=t.current;if(!l)return null;let n=l.getBoundingClientRect(),a=Math.floor((e.clientX-n.left)/r),i=Math.floor((e.clientY-n.top)/r);if(a<0||i<0||a>=l.width||i>=l.height)return null;let o=l.getContext("2d",{willReadFrequently:!0});if(!o)return null;let s=o.getImageData(a,i,1,1).data;return`#${[s[0],s[1],s[2]].map(e=>e.toString(16).padStart(2,"0")).join("")}`;},ti=(e,t,r,l,n,a,i)=>{let o=new Image;o.onload=()=>{var e,i;let s=(null===(e=t.current)||void 0===e?void 0:e.width)||o.naturalWidth,c=(null===(i=t.current)||void 0===i?void 0:i.height)||o.naturalHeight,d=o.naturalWidth,u=o.naturalHeight,h=Math.min(1,Math.min(s/(1.2*d),c/(1.2*u))),f=Math.round((s-(d=Math.round(d*h)))/2),g=Math.round((c-(u=Math.round(u*h)))/2),m=`${Date.now()}_${Math.round(1e4*Math.random())}`,x={id:m,type:"image",img:o,rect:{x:f,y:g,w:d,h:u},opacity:1,blend:"source-over"};r(e=>[...e,x]),l(m),n(!0),a(),S.default.success("Overlay image added");},o.onerror=()=>S.default.error("Failed to load overlay image"),o.src=URL.createObjectURL(e),i("layer");},to=(e,t,r,l,n,a)=>{if(!e.mask){"image"===e.type&&e.img&&t.drawImage(e.img,r,l,n,a);return;}let i=eJ(n,a),o=i.getContext("2d");"image"===e.type&&e.img&&o.drawImage(e.img,0,0,n,a),o.globalCompositeOperation="destination-in",o.drawImage(e.mask,0,0,n,a),t.drawImage(i,r,l);},ts=async(e,t,r,l)=>{if(!t.current)return;let n=t.current,a=eJ(n.width,n.height),i=a.getContext("2d");for(let e of(i.clearRect(0,0,a.width,a.height),i.drawImage(n,0,0),r))try{if(i.save(),i.globalAlpha=e.opacity,i.globalCompositeOperation=e.blend||"source-over",e.rotation&&0!==e.rotation){let t=e.rect.x+e.rect.w/2,r=e.rect.y+e.rect.h/2;i.translate(t,r),i.rotate(e.rotation*Math.PI/180),i.translate(-t,-r);}if("image"===e.type&&e.img)to(e,i,e.rect.x,e.rect.y,e.rect.w,e.rect.h);else if("text"===e.type){let t=e.fontItalic?"italic":"normal",r=e.fontWeight||"normal",l=e.fontSize||16;i.font=`${t} ${r} ${l}px ${e.font||"Arial"}`,i.fillStyle=e.textColor||"#000000",i.textAlign=e.textAlign||"left",i.textBaseline="top";let n=(e.text||"").split("\n"),a=1.2*l,o=e.rect.y;for(let t of n){let r=e.rect.x;if("center"===e.textAlign?r+=e.rect.w/2:"right"===e.textAlign&&(r+=e.rect.w),i.fillText(t,r,o),"underline"===e.textDecoration){let n=i.measureText(t);i.strokeStyle=e.textColor||"#000000",i.lineWidth=1,i.beginPath(),i.moveTo(r,o+l),i.lineTo(r+n.width,o+l),i.stroke();}else if("line-through"===e.textDecoration){let n=i.measureText(t);i.strokeStyle=e.textColor||"#000000",i.lineWidth=1,i.beginPath(),i.moveTo(r,o+l/2),i.lineTo(r+n.width,o+l/2),i.stroke();}o+=a;}}i.restore();}catch(e){}i.globalAlpha=1,i.globalCompositeOperation="source-over";let o=await new Promise(t=>a.toBlob(e=>t(e),e?"image/jpeg":"image/png",.92));if(o){l&&l(o);let t=URL.createObjectURL(o),r=document.createElement("a");r.href=t,r.download=e?"edited.jpg":"edited.png",r.click(),URL.revokeObjectURL(t),S.default.success("Exported image (with overlays)");}},tc=(e,t,r,l,n)=>{if(!e.current)return;let a=n?t.filter(e=>e.id===n&&!e.locked):t.slice();if(0===a.length)return;let i=e.current.getContext("2d");for(let e of a)try{if(i.save(),i.globalAlpha=e.opacity,i.globalCompositeOperation=e.blend||"source-over",e.rotation&&0!==e.rotation){let t=e.rect.x+e.rect.w/2,r=e.rect.y+e.rect.h/2;i.translate(t,r),i.rotate(e.rotation*Math.PI/180),i.translate(-t,-r);}if("image"===e.type&&e.img)to(e,i,e.rect.x,e.rect.y,e.rect.w,e.rect.h);else if("text"===e.type){let t=e.fontItalic?"italic":"normal",r=e.fontWeight||"normal",l=e.fontSize||16;i.font=`${t} ${r} ${l}px ${e.font||"Arial"}`,i.fillStyle=e.textColor||"#000000",i.textAlign=e.textAlign||"left",i.textBaseline="top";let n=(e.text||"").split("\n"),a=1.2*l,o=e.rect.y;for(let t of n){let r=e.rect.x;if("center"===e.textAlign?r+=e.rect.w/2:"right"===e.textAlign&&(r+=e.rect.w),i.fillText(t,r,o),"underline"===e.textDecoration){let n=i.measureText(t);i.strokeStyle=e.textColor||"#000000",i.lineWidth=1,i.beginPath(),i.moveTo(r,o+l),i.lineTo(r+n.width,o+l),i.stroke();}else if("line-through"===e.textDecoration){let n=i.measureText(t);i.strokeStyle=e.textColor||"#000000",i.lineWidth=1,i.beginPath(),i.moveTo(r,o+l/2),i.lineTo(r+n.width,o+l/2),i.stroke();}o+=a;}}i.restore();}catch(e){}r(e=>e.filter(e=>!a.find(t=>t.id===e.id))),l.push(e.current.toDataURL(),n?"Merge layer":"Merge layers"),S.default.success("Layer(s) merged into base");},td=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,opacity:r}:e)),tu=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,blend:r}:e)),th=(e,t)=>e(e=>{let r=e.findIndex(e=>e.id===t);if(-1===r||r===e.length-1)return e;let l=e.slice(),n=l[r+1];return l[r+1]=l[r],l[r]=n,l;}),tf=(e,t)=>e(e=>{let r=e.findIndex(e=>e.id===t);if(r<=0)return e;let l=e.slice(),n=l[r-1];return l[r-1]=l[r],l[r]=n,l;}),tg=(e,t,r)=>e(e=>{let l=e.filter(e=>e.id!==t||e.locked);return r&&r(l.length?l[l.length-1].id:null),l;}),tm=(e,t)=>{e(t);},tx=(e,t,r,l,n,a,i)=>{var o,s;if(!a.text.trim()){S.default.warning("Please enter text first");return;}let c=(null===(o=e.current)||void 0===o?void 0:o.width)||400,d=(null===(s=e.current)||void 0===s?void 0:s.height)||300,u=i?Math.round(i.x):Math.round(c/4),h=i?Math.round(i.y):Math.round(d/4),f=`text_${Date.now()}_${Math.round(1e4*Math.random())}`,g={id:f,type:"text",rect:{x:u,y:h,w:Math.min(300,c/2),h:a.fontSize+20},opacity:1,blend:"source-over",text:a.text,font:a.font,fontSize:a.fontSize,fontWeight:a.fontWeight,fontItalic:a.fontItalic,textDecoration:a.textDecoration,textColor:a.textColor,textAlign:a.textAlign};t(e=>[...e,g]),r(f),l(!0),n(),S.default.success("Text layer added");},tp=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,text:r}:e)),tv=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,font:r}:e)),ty=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,fontSize:r}:e)),tw=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,fontWeight:r}:e)),tb=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,fontItalic:r}:e)),tj=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,textDecoration:r}:e)),tC=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,textColor:r}:e)),tk=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,textAlign:r}:e)),tS=(e,t,r)=>{if(!(t.length<2)){e.save(),e.globalAlpha=r.opacity*r.flow,"soft"===r.type?(e.shadowColor=r.color,e.shadowBlur=.5*r.lineWidth,e.lineWidth=.5*r.lineWidth):(e.shadowBlur=0,e.lineWidth=r.lineWidth),e.strokeStyle=r.color,e.lineCap="round",e.lineJoin="round",e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let r=1;r<t.length;r++)e.lineTo(t[r].x,t[r].y);e.stroke(),e.restore();}},tM=(e,t,r,l,n,a=1)=>{e.save(),e.strokeStyle=n,e.lineWidth=2/a,e.beginPath(),e.arc(t,r,l/2,0,2*Math.PI),e.stroke(),e.restore();},tI=(e,t,r=1,l={x:0,y:0})=>{if(!t.current)return null;let n=t.current.getBoundingClientRect();return{x:(e.clientX-n.left)/r-l.x,y:(e.clientY-n.top)/r-l.y};},tE=(e,t,r)=>{let l=e.getContext("2d");if(!l)return null;let[n,a,i]=l.getImageData(t,r,1,1).data;return`#${[n,a,i].map(e=>e.toString(16).padStart(2,"0")).join("")}`;},tR=(e,t,r)=>{if(!e.current||!t.current)return;let{zoom:l,cropRect:n,rulerPoints:a,perspectivePoints:i,hoverColor:o,tool:s,drawColor:c,drawLineWidth:d,layers:u,overlaySelected:h,activeLayerId:f}=r,g=e.current.getContext("2d");if(g.clearRect(0,0,e.current.width,e.current.height),n&&(g.save(),g.strokeStyle="#00aaff",g.lineWidth=2,g.setLineDash([6,4]),g.strokeRect(n.x,n.y,n.w,n.h),g.restore()),a&&(g.save(),g.strokeStyle="#ffcc00",g.lineWidth=2,g.beginPath(),g.moveTo(a.x1,a.y1),g.lineTo(a.x2,a.y2),g.stroke(),g.restore()),i){g.save();let e=[];for(let t=0;t<8;t+=2){let r=i[t],l=i[t+1];isNaN(r)||isNaN(l)||e.push({x:r,y:l});}if(e.length>=2){g.strokeStyle="rgba(0,255,0,0.9)",g.lineWidth=2,g.setLineDash([4,4]),g.beginPath(),g.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++)g.lineTo(e[t].x,e[t].y);4===e.length&&g.closePath(),g.stroke();}g.fillStyle="rgba(0,255,0,0.9)";for(let e=0;e<8;e+=2){let t=i[e],r=i[e+1];isNaN(t)||isNaN(r)||g.fillRect(t-5,r-5,10,10);}g.restore();}if(o&&("color"===s||"removeColor"===s)){let e=t.current.getBoundingClientRect();tM(g,(o.x-e.left)/l,(o.y-e.top)/l,16/l,o.color,l);}for(let e of u)try{if(g.save(),g.globalAlpha=e.opacity,g.globalCompositeOperation=e.blend||"source-over",e.rotation&&0!==e.rotation){let t=e.rect.x+e.rect.w/2,r=e.rect.y+e.rect.h/2;g.translate(t,r),g.rotate(e.rotation*Math.PI/180),g.translate(-t,-r);}if("image"===e.type&&e.img){if(e.mask){let t=document.createElement("canvas");t.width=e.rect.w,t.height=e.rect.h;let r=t.getContext("2d");r.drawImage(e.img,0,0,e.rect.w,e.rect.h),r.globalCompositeOperation="destination-in",r.drawImage(e.mask,0,0,e.rect.w,e.rect.h),g.drawImage(t,e.rect.x,e.rect.y);}else g.drawImage(e.img,e.rect.x,e.rect.y,e.rect.w,e.rect.h);}else if("text"===e.type){let t=e.fontItalic?"italic":"normal",r=e.fontWeight||"normal",l=e.fontSize||16;g.font=`${t} ${r} ${l}px ${e.font||"Arial"}`,g.fillStyle=e.textColor||"#000000",g.textAlign=e.textAlign||"left",g.textBaseline="top";let n=(e.text||"").split("\n"),a=1.2*l,i=e.rect.y;for(let t of n){let r=e.rect.x;if("center"===e.textAlign?r+=e.rect.w/2:"right"===e.textAlign&&(r+=e.rect.w),g.fillText(t,r,i),"underline"===e.textDecoration){let n=g.measureText(t);g.strokeStyle=e.textColor||"#000000",g.lineWidth=1,g.beginPath(),g.moveTo(r,i+l),g.lineTo(r+n.width,i+l),g.stroke();}else if("line-through"===e.textDecoration){let n=g.measureText(t);g.strokeStyle=e.textColor||"#000000",g.lineWidth=1,g.beginPath(),g.moveTo(r,i+l/2),g.lineTo(r+n.width,i+l/2),g.stroke();}i+=a;}}g.restore();}catch(e){}if(h&&f){let e=u.find(e=>e.id===f);if(e){let t=e.rect;if(g.save(),g.globalAlpha=1,g.globalCompositeOperation="source-over",e.rotation&&0!==e.rotation){let r=t.x+t.w/2,l=t.y+t.h/2;g.translate(r,l),g.rotate(e.rotation*Math.PI/180),g.translate(-r,-l);}g.strokeStyle="rgba(255,165,0,0.95)",g.lineWidth=2,g.setLineDash([6,3]),g.strokeRect(t.x,t.y,t.w,t.h),g.setLineDash([]),g.fillStyle="rgba(255,165,0,0.95)";let r=Math.max(6/Math.max(1,l),6),n=r/2;[[t.x,t.y],[t.x+t.w,t.y],[t.x,t.y+t.h],[t.x+t.w,t.y+t.h]].forEach(([e,t])=>g.fillRect(e-n,t-n,r,r)),g.fillStyle="rgba(0,180,255,0.95)",[[t.x+t.w/2,t.y],[t.x+t.w/2,t.y+t.h],[t.x,t.y+t.h/2],[t.x+t.w,t.y+t.h/2]].forEach(([e,t])=>{g.fillRect(e-n,t-n,r,r);}),g.restore();}}if(o&&"draw"===s){let e=t.current.getBoundingClientRect();tM(g,(o.x-e.left)/l,(o.y-e.top)/l,d,c,l);}},tz=e=>{let{canvasX:t,canvasY:r,canvasRect:l,containerRef:n,inlineEditorRef:a,zoom:i,initial:o="",layerId:s,layer:c,textColor:d="#000",textFont:u="Arial",textFontSize:h=16,textWeight:f="normal",textItalic:g=!1,onCommit:m,onCancel:x}=e;a.current&&(a.current.remove(),a.current=null);let p=n.current,v=p?p.getBoundingClientRect():{left:0,top:0},y=l.left+t*i,w=l.top+r*i,b=y-v.left,j=w-v.top,C=document.createElement("textarea");C.value=o,C.style.position="absolute",C.style.left=`${b}px`,C.style.top=`${j}px`,C.style.zIndex="10000",C.style.minWidth="60px",C.style.minHeight="24px",C.style.background="transparent",C.style.border="1px dashed rgba(0,0,0,0.4)",C.style.color=c&&c.textColor||d||"#000",C.style.fontFamily=c&&c.font||u||"Arial";let k=c&&c.fontSize||h||16;C.style.fontSize=`${k*i}px`,C.style.fontWeight=String(c&&c.fontWeight||f||"normal"),C.style.fontStyle=c&&c.fontItalic||g?"italic":"normal",C.style.resize="both",C.style.outline="none",C.style.padding="4px",C.placeholder="Type text and press Enter";let S=!1,M=()=>{S||(S=!!C.value&&!o,m(C.value||""),C.remove(),a.current=null);},I=()=>{C.remove(),a.current=null,x&&x();};C.addEventListener("keydown",e=>{e.shiftKey&&"Enter"===e.key||("Enter"!==e.key||e.shiftKey?"Escape"===e.key&&(e.preventDefault(),I()):(e.preventDefault(),M()));}),C.addEventListener("blur",()=>{M();});let E=()=>{C.style.position="fixed",C.style.left=`${y}px`,C.style.top=`${w}px`,C.style.zIndex="200000",document.body.appendChild(C),a.current=C,C.focus(),C.selectionStart=C.selectionEnd=C.value.length,console.log("[DEBUG] appended editor to document.body at",{fixedLeft:y,fixedTop:w});};p?(()=>{try{if(p)p.appendChild(C);else throw Error("no container");}catch(e){console.warn("[DEBUG] append to container failed, will fallback to body",e),E();return;}a.current=C,C.focus(),C.selectionStart=C.selectionEnd=C.value.length,requestAnimationFrame(()=>{try{let e=C.getBoundingClientRect();0===e.width&&0===e.height&&(console.warn("[DEBUG] appended editor has zero size; falling back to body"),C.remove(),E());}catch(e){}});})():E();},tT=async(e,t,r,l,n,a)=>{if(!e.current||!r.current){S.default.warning("No perspective points defined.");return;}let i=r.current,o=[];for(let e=0;e<8;e+=2){let t=i[e],r=i[e+1];isNaN(t)||isNaN(r)||o.push([t,r]);}if(4!==o.length){S.default.error("Please select 4 corner points before applying perspective correction.");return;}try{let i=(e=>{let t=e.reduce((e,t)=>e+t[0],0)/e.length,r=e.reduce((e,t)=>e+t[1],0)/e.length,l=e.map(e=>({pt:e,angle:Math.atan2(e[1]-r,e[0]-t)})).sort((e,t)=>e.angle-t.angle).map(e=>e.pt),n=0;for(let e=0;e<l.length;e++){let[t,r]=l[e],[a,i]=l[(e+1)%l.length];n+=t*i-a*r;}n>0&&l.reverse();let a=0;for(let e=1;e<l.length;e++)(l[e][1]<l[a][1]||l[e][1]===l[a][1]&&l[e][0]<l[a][0])&&(a=e);return Array.from({length:l.length},(e,t)=>l[(a+t)%l.length]);})(o),s=[Math.round(i[0][0]),Math.round(i[0][1]),Math.round(i[1][0]),Math.round(i[1][1]),Math.round(i[2][0]),Math.round(i[2][1]),Math.round(i[3][0]),Math.round(i[3][1])],c=function(e,t,r,l){let n=eJ(r,l),a=n.getContext("2d"),i=e.getContext("2d").getImageData(0,0,e.width,e.height),o=a.createImageData(r,l),s=[[t[0],t[1]],[t[2],t[3]],[t[4],t[5]],[t[6],t[7]]],c=function(e,t){if(4!==e.length||4!==t.length)throw Error("computeHomography requires exactly 4 points for src and dst");let r=[];for(let l=0;l<4;l++){let[n,a]=e[l],[i,o]=t[l];r.push([-n,-a,-1,0,0,0,n*i,a*i,i]),r.push([0,0,0,-n,-a,-1,n*o,a*o,o]);}let l=[],n=[];for(let e=0;e<8;e++)l.push(r[e].slice(0,8)),n.push(-r[e][8]);let a=[...function(e,t){let r=t.length,l=e.map((e,r)=>[...e,t[r]]);for(let e=0;e<r;e++){let t=e;for(let n=e+1;n<r;n++)Math.abs(l[n][e])>Math.abs(l[t][e])&&(t=n);[l[e],l[t]]=[l[t],l[e]];for(let t=e+1;t<r;t++){let n=l[t][e]/l[e][e];for(let a=e;a<=r;a++)l[t][a]-=n*l[e][a];}}let n=Array(r).fill(0);for(let e=r-1;e>=0;e--){let t=l[e][r];for(let a=e+1;a<r;a++)t-=l[e][a]*n[a];n[e]=t/l[e][e];}return n;}(l,n),1];return[[a[0],a[1],a[2]],[a[3],a[4],a[5]],[a[6],a[7],a[8]]];}(s,[[0,0],[r,0],[r,l],[0,l]]);for(let t=0;t<l;t++)for(let l=0;l<r;l++){let[n,a]=function(e,t,r){let[[l,n,a],[i,o,s],[c,d,u]]=e,h=l*(o*u-s*d)-n*(i*u-s*c)+a*(i*d-o*c);if(1e-10>Math.abs(h))return[0,0];let f=[[(o*u-s*d)/h,(a*d-n*u)/h,(n*s-a*o)/h],[(s*c-i*u)/h,(l*u-a*c)/h,(a*i-l*s)/h],[(i*d-o*c)/h,(n*c-l*d)/h,(l*o-n*i)/h]],g=f[0][0]*t+f[0][1]*r+f[0][2],m=f[1][0]*t+f[1][1]*r+f[1][2],x=f[2][0]*t+f[2][1]*r+f[2][2];return[g/x,m/x];}(c,l,t);if(n>=0&&n<e.width&&a>=0&&a<e.height){let s=Math.floor(n),c=(Math.floor(a)*e.width+s)*4,d=(t*r+l)*4;o.data[d]=i.data[c],o.data[d+1]=i.data[c+1],o.data[d+2]=i.data[c+2],o.data[d+3]=i.data[c+3];}}return a.putImageData(o,0,0),n;}(e.current,s,e.current.width,e.current.height);e.current.width=c.width,e.current.height=c.height,t.current.width=c.width,t.current.height=c.height;let d=e.current.getContext("2d");d.clearRect(0,0,c.width,c.height),d.drawImage(c,0,0),l.push(e.current.toDataURL(),"Perspective corrected"),r.current=null,n(!1),a(),S.default.success("Perspective correction applied.");}catch(e){console.error("Perspective transform failed",e),S.default.error("Failed to apply perspective correction.");}},tB=async(e,t,r,l)=>{if(!e||t<=1)return e;let n=e,a=1;for(;a<t;){let e=Math.min(2,t/a),l=Math.max(1,Math.round(n.width*e)),i=Math.max(1,Math.round(n.height*e)),o=eJ(l,i),s=o.getContext("2d");s.imageSmoothingEnabled=!0,s.imageSmoothingQuality=r,s.clearRect(0,0,l,i),s.drawImage(n,0,0,n.width,n.height,0,0,l,i),n=o,a*=e,await new Promise(e=>setTimeout(e,0));}if(l&&(l.sharpen||l.edgeEnhancement||l.denoise)){let e=n.getContext("2d"),t=e.getImageData(0,0,n.width,n.height);if(l.denoise&&l.denoise>0){let e=l.denoise/100,r=e0.gaussian5,n=Math.ceil(2*e);for(let e=0;e<n;e++)eQ(t,r,5);}if(l.edgeEnhancement&&l.edgeEnhancement>0){let e=l.edgeEnhancement/100;eQ(t,[0,-1*e,0,-1*e,1+4*e,-1*e,0,-1*e,0],3);}if(l.sharpen&&l.sharpen>0){let e=Math.ceil(3*(l.sharpen/100));for(let r=0;r<e;r++)eQ(t,e0.sharpen,3);}e.putImageData(t,0,0);}return n;},tD=async(e,t,r,l,n,a,i,o,s)=>{if(e.current)try{let c=await tB(e.current,i,o,s);if(!c)return;let d=c.toDataURL(),u=new Image,h=t.current?t.current.style.display:"";t.current&&(t.current.style.display="none"),u.onload=()=>{try{let o=document.createElement("canvas");o.width=u.naturalWidth,o.height=u.naturalHeight,o.getContext("2d").drawImage(u,0,0);try{l(o);}catch(e){}e.current.width=o.width,e.current.height=o.height,t.current&&(t.current.width=o.width,t.current.height=o.height);let s=e.current.getContext("2d");s.clearRect(0,0,o.width,o.height),s.drawImage(u,0,0),r.push(e.current.toDataURL(),`Upscaled ${i}x`),n(e=>{if(!e[0])return e;let t=e.slice(),r={...t[0]};return r.img&&(r.img.src=d),r.rect={x:0,y:0,w:o.width,h:o.height},t[0]=r,t;}),t.current&&(t.current.style.display=h||""),a(),S.default.success(`Upscaled ${i}x`);}catch(e){console.error("Failed to finalize upscale draw",e),t.current&&(t.current.style.display=h||""),S.default.error("Upscale failed to render");}},u.onerror=e=>{t.current&&(t.current.style.display=h||""),console.error("Upscaled image failed to load",e),S.default.error("Upscaled image failed to load");},u.src=d;}catch(e){console.error("Upscale failed",e),S.default.error("Upscale failed");}},tL={blur:0,gaussian:0,sharpen:0,texture:0,clarity:0,bgThreshold:0,bgThresholdBlack:0,brightness:0,contrast:0,highlights:0,shadows:0,whites:0,blacks:0,vibrance:0,saturation:0,dehaze:0,hslAdjustments:{}},t$=null,tN=(e,t,{blur:r=0,gaussian:l=0,sharpen:n=0,bgThreshold:a=0,bgThresholdBlack:i=0,brightness:o=0,contrast:s=0,texture:c=0,clarity:d=0,highlights:u=0,shadows:h=0,whites:f=0,blacks:g=0,vibrance:m=0,saturation:x=0,dehaze:p=0,hslAdjustments:v={}},y,w)=>{if(!e.current||!t)return;let b=e.current.getContext("2d"),j=t.getContext("2d").getImageData(0,0,t.width,t.height);if(t$||(t$=j),!t$)return;let C=function(e){let t=new ImageData(e.width,e.height);return t.data.set(new Uint8ClampedArray(e.data)),t;}(j);if(0===r&&0===l&&0===n&&0===c&&0===d&&0===a&&0===i&&0===o&&0===s&&0===u&&0===h&&0===f&&0===g&&0===m&&0===x&&0===p&&0===Object.keys(v).length){b.putImageData(C,0,0),e.current&&w(tA(e.current));return;}if(r>0){let e=r%2==0?r+1:r;eQ(C,e0.generateBoxBlurKernel(e),e);}if(l>0&&eQ(C,e0.generateGaussianKernel(l),2*l+1),n>0&&eQ(C,e0.sharpen.map(e=>5===e?1+4*n:-1===e?-n:e),3),0!==c){let e=c/100,t=-(2*e);eQ(C,[0,t,0,t,1+8*e,t,0,t,0],3);}if(0!==d){let e=d/100,t=-(2.5*e);eQ(C,[0,t,0,t,1+10*e,t,0,t,0],3);}if(a>0&&function(e,t=0){t=255-t;let r=e.data;for(let e=0;e<r.length;e+=4)r[e]>t&&r[e+1]>t&&r[e+2]>t&&(r[e+3]=0);}(C,a),i>0&&function(e,t=0){let r=e.data;for(let e=0;e<r.length;e+=4)r[e]<t&&r[e+1]<t&&r[e+2]<t&&(r[e+3]=0);}(C,i),(0!==o||0!==s)&&function(e,t=0,r=0){let l=e.data,n=r/100+1,a=128*(1-n);for(let e=0;e<l.length;e+=4)l[e]=Math.min(255,Math.max(0,l[e]*n+a+t)),l[e+1]=Math.min(255,Math.max(0,l[e+1]*n+a+t)),l[e+2]=Math.min(255,Math.max(0,l[e+2]*n+a+t));}(C,o,s),0!==u||0!==h||0!==f||0!==g||0!==m||0!==x||0!==p){let e=C.data;for(let t=0;t<e.length;t+=4)p&&e5(e,t,p),(m||x)&&e3(e,t,{vibrance:m,saturation:x});e6(C,{highlights:u,shadows:h,whites:f,blacks:g,vibrance:m,saturation:x,clarity:d,dehaze:p});}Object.keys(v).length>0&&e7(C,v),b.putImageData(C,0,0);let k=Object.entries({blur:r,gaussian:l,sharpen:n,texture:c,clarity:d,bgThreshold:a,bgThresholdBlack:i,brightness:o,contrast:s,highlights:u,shadows:h,whites:f,blacks:g,vibrance:m,saturation:x,dehaze:p,hslAdjustments:v}).filter(([e,t])=>tL[e]!==t);if(k.length>0){let t=k.map(([e,t])=>`${e}=${JSON.stringify(t)}`).join(", ");y.push(e.current.toDataURL(),`${t}`,!1),tL={blur:r,gaussian:l,sharpen:n,texture:c,clarity:d,bgThreshold:a,bgThresholdBlack:i,brightness:o,contrast:s,highlights:u,shadows:h,whites:f,blacks:g,vibrance:m,saturation:x,dehaze:p,hslAdjustments:v};}e.current&&w(tA(e.current));},tA=e=>{if(!e)return{red:Array(256).fill(0),green:Array(256).fill(0),blue:Array(256).fill(0)};let t=e.getContext("2d");if(!t)return{red:Array(256).fill(0),green:Array(256).fill(0),blue:Array(256).fill(0)};let{width:r,height:l}=e,{data:n}=t.getImageData(0,0,r,l),a=Array(256).fill(0),i=Array(256).fill(0),o=Array(256).fill(0);for(let e=0;e<n.length;e+=4)a[n[e]]++,i[n[e+1]]++,o[n[e+2]]++;return{red:a,green:i,blue:o};},tP=(e,t)=>{if(!e.current)return;let r=e.current,l=r.getContext("2d"),n=l.getImageData(0,0,r.width,r.height),a=n.data;for(let e=0;e<a.length;e+=4)a[e]=255-a[e],a[e+1]=255-a[e+1],a[e+2]=255-a[e+2];l.putImageData(n,0,0),t.push(r.toDataURL(),"Invert colors",!1);},tO=(e,t,r,l,n=!1,a=0)=>{if(!e.current)return;let i=e.current,o=i.getContext("2d"),s=o.getImageData(0,0,i.width,i.height),c=s.data,d=t.replace("#",""),u=parseInt(d.substring(0,2),16),h=parseInt(d.substring(2,4),16),f=parseInt(d.substring(4,6),16),g=new Uint8Array(c.length/4);for(let e=0;e<c.length;e+=4){let t;let l=Math.sqrt(Math.pow(c[e]-u,2)+Math.pow(c[e+1]-h,2)+Math.pow(c[e+2]-f,2))/Math.sqrt(195075),i=r/100;if(0===a)t=l<=i?0:1;else{let e=a/100,r=l-i;t=r<-e?0:r>e?1:(r+e)/(2*e);}n&&(t=1-t),g[e/4]=Math.round(255*t);}for(let e=0;e<c.length;e+=4)c[e+3]=g[e/4];o.putImageData(s,0,0);let m=n?`Keep color ${t} (tolerance: ${r}%, feather: ${a}%)`:`Remove color ${t} (tolerance: ${r}%, feather: ${a}%)`;l.push(i.toDataURL(),m,!1);},t_=({canvasRef:e,overlayRef:t,containerRef:r,offset:l,zoom:n,tool:i,currentCursor:o,hoverColor:s,resolution:c,onMouseDown:d,onMouseMove:u,onMouseUp:h})=>(0,a.jsxs)("div",{ref:r,onMouseDown:d,onMouseMove:u,onMouseUp:h,style:{width:"100%",height:"100vh",overflow:"hidden",border:"1px solid #eee",position:"relative",background:"#fafafa",cursor:o},children:[c&&(0,a.jsx)("div",{style:{position:"absolute",right:12,top:12,background:"rgba(0,0,0,0.6)",color:"#fff",padding:"4px 8px",borderRadius:4,fontSize:12,zIndex:99999,pointerEvents:"none"},children:c}),(0,a.jsxs)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden"},children:[(0,a.jsx)("canvas",{ref:e,style:{transform:`translate(${l.x}px, ${l.y}px) scale(${n})`,transformOrigin:"top left",display:"block"}}),(0,a.jsx)("canvas",{ref:t,style:{position:"absolute",left:0,top:0,pointerEvents:"none",transform:`translate(${l.x}px, ${l.y}px) scale(${n})`,transformOrigin:"top left"}})]}),s&&"color"===i&&(0,a.jsxs)("div",{style:{position:"fixed",left:s.x+12,top:s.y+12,background:"#fff",padding:"4px 8px",borderRadius:4,boxShadow:"0 0 6px rgba(0,0,0,0.2)",fontSize:12,zIndex:999999,pointerEvents:"none",display:"flex",alignItems:"center",gap:6},children:[(0,a.jsx)("span",{style:{display:"inline-block",width:12,height:12,background:s.color,border:"1px solid #ccc"}}),s.color]})]});var tH=r("649689e8"),tW=l._(tH),tU=r("c4e93e50"),tF=l._(tU);let tV=({open:e,onCancel:t,onApply:r,selectedColor:l,canvasRef:n})=>{var i;let[o,s]=(0,I.useState)(30),[c,d]=(0,I.useState)("normal"),[u,h]=(0,I.useState)(!1),[f,g]=(0,I.useState)(0),m=(0,I.useRef)(null);return(0,I.useEffect)(()=>{if(!e||!n.current||!l||!m.current)return;let t=n.current,r=m.current,a=r.getContext("2d");r.width=t.width,r.height=t.height;let i=t.getContext("2d").getImageData(0,0,t.width,t.height),s=i.data,d=l.replace("#",""),h=parseInt(d.substring(0,2),16),g=parseInt(d.substring(2,4),16),x=parseInt(d.substring(4,6),16),p=new Uint8Array(s.length/4);for(let e=0;e<s.length;e+=4){let t;let r=Math.sqrt(Math.pow(s[e]-h,2)+Math.pow(s[e+1]-g,2)+Math.pow(s[e+2]-x,2))/Math.sqrt(195075),l=o/100;if(0===f)t=r<=l?0:1;else{let e=f/100,n=r-l;t=n<-e?0:n>e?1:(n+e)/(2*e);}u&&(t=1-t),p[e/4]=Math.round(255*t);}for(let e=0;e<s.length;e+=4){let t=p[e/4];"mask"===c?(0===t?(s[e]=0,s[e+1]=0,s[e+2]=0):255===t?(s[e]=255,s[e+1]=255,s[e+2]=255):(s[e]=t,s[e+1]=t,s[e+2]=t),s[e+3]=255):s[e+3]=t;}a.putImageData(i,0,0);},[e,o,c,l,n,u,f]),(0,a.jsx)(R.default,{title:"Remove Color",open:e,onCancel:t,onOk:()=>{r(o,u,f);},width:Math.min((null===(i=n.current)||void 0===i?void 0:i.width)?n.current.width+100:800,.9*window.innerWidth),okText:"Apply",cancelText:"Cancel",children:(0,a.jsxs)(p.default,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("div",{style:{marginBottom:8},children:[(0,a.jsx)("strong",{children:"Selected Color:"})," ",(0,a.jsx)("span",{style:{display:"inline-block",width:24,height:24,background:l||"#000",border:"1px solid #ccc",verticalAlign:"middle",marginLeft:8}}),(0,a.jsx)("span",{style:{marginLeft:8},children:l})]})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{marginBottom:8},children:[(0,a.jsx)("strong",{children:"Tolerance:"})," ",o,"%"]}),(0,a.jsx)(tW.default,{min:0,max:100,value:o,onChange:s,tooltip:{formatter:e=>`${e}%`}}),(0,a.jsx)("div",{style:{fontSize:12,color:"#666",marginTop:4},children:"Adjust how similar colors will be removed (0 = exact match, 100 = all colors)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{marginBottom:8},children:[(0,a.jsx)("strong",{children:"Feather:"})," ",f,"%"]}),(0,a.jsx)(tW.default,{min:0,max:50,value:f,onChange:g,tooltip:{formatter:e=>`${e}%`}}),(0,a.jsx)("div",{style:{fontSize:12,color:"#666",marginTop:4},children:"Soften the edge transition (0 = hard edge, 50 = very soft)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsx)("strong",{children:"Invert Selection:"})}),(0,a.jsxs)(tF.default.Group,{value:u,onChange:e=>h(e.target.value),children:[(0,a.jsx)(tF.default.Button,{value:!1,children:"Normal"}),(0,a.jsx)(tF.default.Button,{value:!0,children:"Inverted"})]}),(0,a.jsx)("div",{style:{fontSize:12,color:"#666",marginTop:4},children:u?"Remove everything EXCEPT the selected color":"Remove the selected color"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsx)("strong",{children:"Preview Mode:"})}),(0,a.jsxs)(tF.default.Group,{value:c,onChange:e=>d(e.target.value),children:[(0,a.jsx)(tF.default.Button,{value:"normal",children:"Normal"}),(0,a.jsx)(tF.default.Button,{value:"mask",children:"Black & White Mask"})]}),(0,a.jsx)("div",{style:{fontSize:12,color:"#666",marginTop:4},children:"normal"===c?"Shows how the final image will look":"Black = removed area, White = kept area"})]}),(0,a.jsx)("div",{style:{maxHeight:"60vh",overflow:"auto",border:"1px solid #d9d9d9",borderRadius:4,padding:8,backgroundImage:"normal"===c?`linear-gradient(45deg, #ccc 25%, transparent 25%),
                   linear-gradient(-45deg, #ccc 25%, transparent 25%),
                   linear-gradient(45deg, transparent 75%, #ccc 75%),
                   linear-gradient(-45deg, transparent 75%, #ccc 75%)`:"none",backgroundSize:"normal"===c?"20px 20px":"auto",backgroundPosition:"normal"===c?"0 0, 0 10px, 10px -10px, -10px 0px":"auto",backgroundColor:"#fff"},children:(0,a.jsx)("canvas",{ref:m,style:{maxWidth:"100%",height:"auto",display:"block",imageRendering:"pixelated"}})})]})});};var tG=r("4f331305"),tX=l._(tG),tK=r("a9a67fa4"),tY=l._(tK),tq=r("cb204712"),tZ=l._(tq),tJ=r("c9122736"),tQ=l._(tJ),t0=r("27aee2a8"),t1=l._(t0);let{Option:t2}=tX.default,t8=({open:e,onCancel:t,onApply:r,sourceCanvas:l,existingMask:n})=>{let i=(0,I.useRef)(null),o=(0,I.useRef)(null),s=(0,I.useRef)(null),[c,d]=(0,I.useState)("remove"),[u,h]=(0,I.useState)(20),[g,m]=(0,I.useState)(1),[x,v]=(0,I.useState)("hard"),[y,w]=(0,I.useState)("normal"),[b,j]=(0,I.useState)(!1),C=(0,I.useRef)([]),[k,S]=(0,I.useState)(null),[M,E]=(0,I.useState)(!1),[z,T]=(0,I.useState)(30),[B,D]=(0,I.useState)(5),[L,$]=(0,I.useState)(!1),[N,A]=(0,I.useState)(null),P=(0,I.useRef)(!1),O=(0,I.useRef)(null),_=(0,I.useRef)(u),[H,W]=(0,I.useState)(!1);(0,I.useEffect)(()=>{if(!e||!l||!i.current)return;let t=i.current;t.width=l.width,t.height=l.height;let r=t.getContext("2d");n?r.drawImage(n,0,0):(r.fillStyle="#ffffff",r.fillRect(0,0,t.width,t.height)),U();},[e,l,n]);let U=()=>{if(!i.current||!o.current||!l)return;let e=i.current,t=o.current;t.width=l.width,t.height=l.height;let r=t.getContext("2d");if("mask"===y)r.drawImage(e,0,0);else{let t=l.getContext("2d"),n=e.getContext("2d"),a=t.getImageData(0,0,l.width,l.height),i=n.getImageData(0,0,e.width,e.height),o=r.createImageData(l.width,l.height);for(let e=0;e<a.data.length;e+=4)o.data[e]=a.data[e],o.data[e+1]=a.data[e+1],o.data[e+2]=a.data[e+2],o.data[e+3]=i.data[e];r.putImageData(o,0,0);}F();},F=()=>{if(!s.current||!i.current)return;let e=s.current,t=e.getContext("2d");if(t.clearRect(0,0,e.width,e.height),k){if(H)t.save(),t.strokeStyle="#00aaff",t.lineWidth=2,t.beginPath(),t.arc(k.x,k.y,8,0,2*Math.PI),t.stroke(),t.restore();else{let e="remove"===c?"#000000":"#ffffff";tM(t,k.x,k.y,u,e,1);}}};return(0,I.useEffect)(()=>{if(!e)return;let t=e=>{("x"===e.key||"X"===e.key)&&d(e=>"remove"===e?"keep":"remove"),(e.ctrlKey||e.metaKey)&&W(!0);},r=e=>{e.ctrlKey||e.metaKey||W(!1);};return window.addEventListener("keydown",t),window.addEventListener("keyup",r),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",r);};},[e]),(0,I.useEffect)(()=>{F();},[k,u,c,H,M]),(0,a.jsx)(R.default,{title:"Layer Mask Editor",open:e,onCancel:t,onOk:()=>{i.current&&r(i.current);},width:Math.min((null==l?void 0:l.width)?l.width+400:900,.95*window.innerWidth),style:{top:20},okText:"Apply Mask",cancelText:"Cancel",children:(0,a.jsxs)(p.default,{direction:"vertical",style:{width:"100%"},size:"middle",children:[(0,a.jsxs)(p.default,{wrap:!0,children:[(0,a.jsxs)(tX.default,{value:M?"color":"brush",onChange:e=>E("color"===e),style:{width:140},children:[(0,a.jsxs)(t2,{value:"brush",children:[(0,a.jsx)(t1.default,{})," Brush Tool"]}),(0,a.jsxs)(t2,{value:"color",children:[(0,a.jsx)(tQ.default,{})," Color Removal"]})]}),(0,a.jsxs)(tF.default.Group,{value:y,onChange:e=>{w(e.target.value),U();},children:[(0,a.jsx)(tF.default.Button,{value:"normal",children:"Normal"}),(0,a.jsx)(tF.default.Button,{value:"mask",children:"Mask View"})]}),(0,a.jsx)(f.default,{onClick:()=>{if(!i.current)return;let e=i.current.getContext("2d");e.fillStyle="#ffffff",e.fillRect(0,0,i.current.width,i.current.height),U();},children:"Clear Mask"}),(0,a.jsx)(f.default,{onClick:()=>{if(!i.current)return;let e=i.current.getContext("2d"),t=e.getImageData(0,0,i.current.width,i.current.height),r=t.data;for(let e=0;e<r.length;e+=4)r[e]=255-r[e],r[e+1]=255-r[e+1],r[e+2]=255-r[e+2];e.putImageData(t,0,0),U();},children:"Invert Mask"})]}),!M&&(0,a.jsxs)(p.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)(p.default,{wrap:!0,children:[(0,a.jsxs)(tF.default.Group,{value:c,onChange:e=>d(e.target.value),buttonStyle:"solid",children:[(0,a.jsx)(tF.default.Button,{value:"remove",children:"Remove (Black)"}),(0,a.jsx)(tF.default.Button,{value:"keep",children:"Keep (White)"})]}),(0,a.jsx)("span",{style:{fontSize:12,color:"#666"},children:"Press 'X' to toggle"})]}),(0,a.jsxs)(p.default,{wrap:!0,align:"center",children:[(0,a.jsx)("span",{children:"Brush Type:"}),(0,a.jsxs)(tX.default,{value:x,onChange:e=>v(e),style:{width:100},children:[(0,a.jsx)(t2,{value:"hard",children:"Hard"}),(0,a.jsx)(t2,{value:"soft",children:"Soft"})]}),(0,a.jsx)("span",{children:"Size:"}),(0,a.jsx)(tY.default,{min:1,max:500,value:u,onChange:e=>h(e||1),style:{width:80}}),(0,a.jsx)(tZ.default,{title:"Alt + Drag to resize",children:(0,a.jsx)("span",{style:{fontSize:12,color:"#666"},children:"Alt+Drag"})}),(0,a.jsx)("span",{children:"Opacity:"}),(0,a.jsx)(tW.default,{min:0,max:1,step:.01,value:g,onChange:m,style:{width:100}}),(0,a.jsxs)("span",{children:[Math.round(100*g),"%"]})]})]}),M&&(0,a.jsxs)(p.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Selected Color:"}),N?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{style:{display:"inline-block",width:24,height:24,background:N,border:"1px solid #ccc",verticalAlign:"middle",marginLeft:8,marginRight:8}}),(0,a.jsx)("span",{children:N}),(0,a.jsx)(f.default,{size:"small",style:{marginLeft:8},onClick:()=>{if(!N||!l||!i.current)return;let e=i.current,t=e.getContext("2d"),r=l.getContext("2d").getImageData(0,0,l.width,l.height),n=t.getImageData(0,0,e.width,e.height),a=N.replace("#",""),o=parseInt(a.substring(0,2),16),s=parseInt(a.substring(2,4),16),c=parseInt(a.substring(4,6),16);for(let e=0;e<r.data.length;e+=4){let t;let l=Math.sqrt(Math.pow(r.data[e]-o,2)+Math.pow(r.data[e+1]-s,2)+Math.pow(r.data[e+2]-c,2))/Math.sqrt(195075),a=z/100;if(0===B)t=l<=a?0:255;else{let e=B/100,r=l-a;t=r<-e?0:r>e?255:Math.round((r+e)/(2*e)*255);}L&&(t=255-t);let i=Math.round(n.data[e]/255*(t/255)*255);n.data[e]=i,n.data[e+1]=i,n.data[e+2]=i,n.data[e+3]=255;}t.putImageData(n,0,0),U(),E(!1);},type:"primary",children:"Apply Color Removal"})]}):(0,a.jsx)("span",{style:{marginLeft:8,color:"#999"},children:"Click on image to pick color (or Ctrl+Click)"})]}),(0,a.jsxs)(p.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Tolerance:"})," ",z,"%",(0,a.jsx)(tW.default,{min:0,max:100,value:z,onChange:T,style:{marginTop:4}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Feather:"})," ",B,"%",(0,a.jsx)(tW.default,{min:0,max:50,value:B,onChange:D})]}),(0,a.jsxs)(tF.default.Group,{value:L,onChange:e=>$(e.target.value),children:[(0,a.jsx)(tF.default.Button,{value:!1,children:"Remove Color"}),(0,a.jsx)(tF.default.Button,{value:!0,children:"Keep Only Color"})]})]})]}),(0,a.jsx)("div",{style:{maxHeight:"60vh",overflow:"auto",border:"1px solid #d9d9d9",borderRadius:4,padding:8,position:"relative",backgroundImage:"normal"===y?`linear-gradient(45deg, #ccc 25%, transparent 25%),
                   linear-gradient(-45deg, #ccc 25%, transparent 25%),
                   linear-gradient(45deg, transparent 75%, #ccc 75%),
                   linear-gradient(-45deg, transparent 75%, #ccc 75%)`:"none",backgroundSize:"normal"===y?"20px 20px":"auto",backgroundPosition:"normal"===y?"0 0, 0 10px, 10px -10px, -10px 0px":"auto",backgroundColor:"mask"===y?"#808080":"#fff"},children:(0,a.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,a.jsx)("canvas",{ref:i,style:{display:"none"}}),(0,a.jsx)("canvas",{ref:o,style:{maxWidth:"100%",height:"auto",display:"block",imageRendering:"pixelated"},onMouseDown:e=>{if(!i.current)return;let t=tI(e,o,1);if(t){if(e.altKey){e.preventDefault(),P.current=!0,O.current=e.clientX,_.current=u;return;}if(e.ctrlKey||e.metaKey){let e=tE(l,t.x,t.y);e&&(A(e),M||E(!0));return;}j(!0),C.current=[t],tS(i.current.getContext("2d"),[t,t],{color:"remove"===c?"#000000":"#ffffff",lineWidth:u,opacity:g,flow:1,type:x}),U();}},onMouseMove:e=>{if(!i.current)return;let t=tI(e,o,1);if(!t)return;if(S(t),P.current&&null!==O.current){let t=e.clientX-O.current;h(Math.round(Math.max(1,Math.min(500,_.current+.5*t)))),F();return;}if(!b){F();return;}C.current.push(t);let r=i.current.getContext("2d"),l="remove"===c?"#000000":"#ffffff",n=C.current;n.length>=2&&(tS(r,n.slice(-2),{color:l,lineWidth:u,opacity:g,flow:1,type:x}),U());},onMouseUp:()=>{j(!1),P.current=!1,O.current=null,C.current=[];},onMouseLeave:()=>{S(null),j(!1),P.current=!1,F();}}),(0,a.jsx)("canvas",{ref:s,width:(null==l?void 0:l.width)||0,height:(null==l?void 0:l.height)||0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",imageRendering:"pixelated"}})]})}),(0,a.jsxs)("div",{style:{fontSize:12,color:"#666",marginTop:8},children:[(0,a.jsx)("strong",{children:"Instructions:"}),(0,a.jsxs)("ul",{style:{margin:"4px 0",paddingLeft:20},children:[(0,a.jsx)("li",{children:"Paint to remove or keep areas (toggle with 'X' key)"}),(0,a.jsx)("li",{children:"Black areas = removed, White areas = kept"}),(0,a.jsx)("li",{children:"Alt + Drag to resize brush"}),M&&(0,a.jsx)("li",{children:"Ctrl/Cmd + Click to pick color from image"}),(0,a.jsx)("li",{children:"Color removal combines with existing mask"})]})]})]})});};var t4=r("00798b85"),t6=l._(t4),t5=r("d90c6c6d"),t3=l._(t5),t9=r("13afdc7a"),t7=l._(t9),re=r("a41070f7"),rt=l._(re),rr=r("8fb0e3f9"),rl=l._(rr),rn=I.forwardRef(function(e,t){return I.createElement(rl.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:rt.default}));}),ra=r("a12e4141"),ri=l._(ra),ro=r("65094f81"),rs=l._(ro),rc={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M567.1 512l318.5-319.3c5-5 1.5-13.7-5.6-13.7h-90.5c-2.1 0-4.2.8-5.6 2.3l-273.3 274-90.2-90.5c12.5-22.1 19.7-47.6 19.7-74.8 0-83.9-68.1-152-152-152s-152 68.1-152 152 68.1 152 152 152c27.7 0 53.6-7.4 75.9-20.3l90 90.3-90.1 90.3A151.04 151.04 0 00288 582c-83.9 0-152 68.1-152 152s68.1 152 152 152 152-68.1 152-152c0-27.2-7.2-52.7-19.7-74.8l90.2-90.5 273.3 274c1.5 1.5 3.5 2.3 5.6 2.3H880c7.1 0 10.7-8.6 5.6-13.7L567.1 512zM288 370c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80zm0 444c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}}]},name:"scissor",theme:"outlined"},rd=I.forwardRef(function(e,t){return I.createElement(rl.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:rc}));}),ru={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},rh=I.forwardRef(function(e,t){return I.createElement(rl.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:ru}));}),rf=r("4f4539af"),rg=l._(rf),rm=r("674a8f9a"),rx=l._(rm),rp=r("16137db5"),rv=l._(rp),ry={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 476H548V144h-72v332H152c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h324v332h72V548h324c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-166h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 498h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-664h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 498h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM650 216h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm56 592h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-332 0h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-56-592h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-166 0h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm56 592h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-56-426h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm56 260h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"border-inner",theme:"outlined"},rw=I.forwardRef(function(e,t){return I.createElement(rl.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:ry}));}),rb={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M145.71 752c2 0 4-.2 5.98-.5L319.9 722c1.99-.4 3.88-1.3 5.28-2.8l423.91-423.87a9.93 9.93 0 000-14.06L582.88 114.9C581 113 578.5 112 575.82 112s-5.18 1-7.08 2.9L144.82 538.76c-1.5 1.5-2.4 3.29-2.8 5.28l-29.5 168.17a33.59 33.59 0 009.37 29.81c6.58 6.48 14.95 9.97 23.82 9.97m51.75-85.43l15.65-88.92 362.7-362.67 73.28 73.27-362.7 362.67zm401.37-98.64c27.69-14.81 57.29-20.85 85.54-15.52 32.37 6.1 59.72 26.53 78.96 59.4 29.97 51.22 21.64 102.34-18.48 144.26-17.58 18.36-41.07 35.01-70 50.3l-.3.15.86.26a147.88 147.88 0 0041.54 6.2l1.17.01c61.07 0 100.98-22.1 125.28-67.87a36 36 0 0163.6 33.76C869.7 849.1 804.9 885 718.12 885c-47.69 0-91.94-15.03-128.19-41.36l-1.05-.78-1.36.47c-46.18 16-98.74 29.95-155.37 41.94l-2.24.47a1931.1 1931.1 0 01-139.16 23.96 36 36 0 11-9.5-71.38 1860.1 1860.1 0 00133.84-23.04c42.8-9 83-19.13 119.35-30.34l.24-.08-.44-.69c-16.46-26.45-25.86-55.43-26.14-83.24v-1.3c0-49.9 39.55-104.32 90.73-131.7M671 623.17c-10.74-2.03-24.1.7-38.22 8.26-29.55 15.8-52.7 47.64-52.7 68.2 0 18.2 8.9 40.14 24.71 59.73l.24.3 1.22-.52c39.17-16.58 68.49-34.27 85.93-52.18l.64-.67c18.74-19.57 21.39-35.84 8.36-58.1-9.06-15.47-19.03-22.92-30.18-25.02"}}]},name:"signature",theme:"outlined"},rj=I.forwardRef(function(e,t){return I.createElement(rl.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:rb}));}),rC={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M136 552h63.6c4.4 0 8-3.6 8-8V288.7h528.6v72.6c0 1.9.6 3.7 1.8 5.2a8.3 8.3 0 0011.7 1.4L893 255.4c4.3-5 3.6-10.3 0-13.2L749.7 129.8a8.22 8.22 0 00-5.2-1.8c-4.6 0-8.4 3.8-8.4 8.4V209H199.7c-39.5 0-71.7 32.2-71.7 71.8V544c0 4.4 3.6 8 8 8zm752-80h-63.6c-4.4 0-8 3.6-8 8v255.3H287.8v-72.6c0-1.9-.6-3.7-1.8-5.2a8.3 8.3 0 00-11.7-1.4L131 768.6c-4.3 5-3.6 10.3 0 13.2l143.3 112.4c1.5 1.2 3.3 1.8 5.2 1.8 4.6 0 8.4-3.8 8.4-8.4V815h536.6c39.5 0 71.7-32.2 71.7-71.8V480c-.2-4.4-3.8-8-8.2-8z"}}]},name:"retweet",theme:"outlined"},rk=I.forwardRef(function(e,t){return I.createElement(rl.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:rC}));}),rS=r("f9cbb0db"),rM=l._(rS);let rI=({label:e,value:t,min:r,max:l,gradient:n,onChange:i,onChangeComplete:o})=>(0,a.jsxs)("div",{className:"custom-slider-container",children:[(0,a.jsxs)("div",{style:{width:"100%"},children:[(0,a.jsx)("span",{className:"custom-label",children:e}),(0,a.jsx)(tY.default,{min:r,max:l,value:t,onChange:e=>i(Number(e)),onBlur:()=>null==o?void 0:o(),className:"custom-number",size:"small"})]}),(0,a.jsx)(tW.default,{min:r,max:l,value:t,onChange:i,onChangeComplete:o,className:"custom-slider",style:{"--custom-slider-gradient":n},handleStyle:{opacity:1}})]});var rE=r("376ce0b3"),rR=l._(rE),rz=r("235f33b8"),rT=l._(rz);let rB=({canvasRef:e,redData:t,greenData:r,blueData:l})=>{let n=(0,I.useMemo)(()=>({chart:{backgroundColor:"#2b2b2b",height:120,spacing:[5,5,5,5]},title:{text:""},xAxis:{title:{text:"",style:{color:"#fff"}},labels:{style:{color:"#fff",fontSize:"5px"}},gridLineColor:"rgba(255,255,255,0.1)"},yAxis:{title:{text:"",style:{color:"#fff"}},labels:{style:{color:"#fff",fontSize:"5px"}},gridLineColor:"rgba(255,255,255,0.1)"},legend:{enabled:!1},plotOptions:{histogram:{binWidth:4},series:{animation:!1,marker:{enabled:!1}}},series:[{name:"Red",data:t,color:"#ff4444",zIndex:3,lineWidth:1,marker:{radius:1}},{name:"Green",data:r,color:"#44ff44",zIndex:2,lineWidth:1,marker:{radius:1}},{name:"Blue",data:l,color:"#4444ff",zIndex:1,lineWidth:1,marker:{radius:1}}],credits:{enabled:!1},tooltip:{enabled:!1}}),[t,r,l]);return(0,a.jsx)(rT.default,{highcharts:rR.default,options:n});},rD=({open:e,onCancel:t,onOk:r,upscaleFactor:l,setUpscaleFactor:n,presetLocal:i,setPresetLocal:o,sharpenAmount:s,setSharpenAmount:c,edgeEnhancement:d,setEdgeEnhancement:u,denoiseAmount:h,setDenoiseAmount:f})=>(0,a.jsx)(R.default,{title:"Custom Upscale",open:e,onCancel:t,onOk:r,okText:"Upscale",width:500,children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[(0,a.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[(0,a.jsxs)("div",{style:{minWidth:120},children:[(0,a.jsx)("div",{children:"Multiplier"}),(0,a.jsx)(tY.default,{min:1,max:8,step:.1,value:l,onChange:e=>n(Number(e||1))})]}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)("div",{children:"Smoothing Quality"}),(0,a.jsx)("div",{style:{marginTop:8},children:(0,a.jsx)(tF.default.Group,{value:i,onChange:e=>o(e.target.value),options:[{label:"Low",value:"low"},{label:"Medium",value:"medium"},{label:"High",value:"high"}],optionType:"button",buttonStyle:"solid"})})]})]}),(0,a.jsxs)("div",{style:{borderTop:"1px solid #f0f0f0",paddingTop:12},children:[(0,a.jsx)("div",{style:{marginBottom:8,fontWeight:500},children:"Quality Enhancements"}),(0,a.jsxs)("div",{style:{marginBottom:12},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[(0,a.jsx)("span",{children:"Sharpen"}),(0,a.jsxs)("span",{children:[s,"%"]})]}),(0,a.jsx)(tW.default,{min:0,max:100,value:s,onChange:c,tooltip:{formatter:e=>`${e}%`}})]}),(0,a.jsxs)("div",{style:{marginBottom:12},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[(0,a.jsx)("span",{children:"Edge Enhancement"}),(0,a.jsxs)("span",{children:[d,"%"]})]}),(0,a.jsx)(tW.default,{min:0,max:100,value:d,onChange:u,tooltip:{formatter:e=>`${e}%`}})]}),(0,a.jsxs)("div",{style:{marginBottom:12},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[(0,a.jsx)("span",{children:"Denoise"}),(0,a.jsxs)("span",{children:[h,"%"]})]}),(0,a.jsx)(tW.default,{min:0,max:100,value:h,onChange:f,tooltip:{formatter:e=>`${e}%`}})]})]})]})});var rL=r("25896c82"),r$=l._(rL),rN=r("05c9ca64"),rA=l._(rN),rP=r("339facb1"),rO=l._(rP),r_=r("94e78bcf"),rH=l._(r_),rW={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"}}]},name:"info-circle",theme:"outlined"},rU=I.forwardRef(function(e,t){return I.createElement(rl.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:rW}));}),rF=r("1d2482ba"),rV=l._(rF),rG=r("d4f20bc1"),rX=l._(rG),rK=I.forwardRef(function(e,t){return I.createElement(rl.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:rX.default}));}),rY=r("434db6d0");let rq=({open:e,onCancel:t,onExportImage:r,onExportSvg:l,canvasRef:n,processing:i,svgContent:o,scale:s,setScale:c,ltres:d,setLtres:u,qtres:h,setQtres:g,pathomit:m,setPathomit:x,colorsampling:v,setColorsampling:y,strokewidth:w,setStrokewidth:b,onDownload:j,getSvgModalWidth:C,getSvgModalHeight:k})=>{let[S,M]=(0,I.useState)("image"),[E,z]=(0,I.useState)("png"),[T,B]=(0,I.useState)(!0),D=o?btoa(unescape(encodeURIComponent(o))):"",L=o?`data:image/svg+xml;base64,${D}`:"";return(0,a.jsx)(R.default,{title:"Export Options",open:e,onCancel:t,onOk:()=>{"image"===S?(r(E,T),t()):l();},okText:"image"===S?"Export":"Convert to SVG",okButtonProps:{loading:i&&"svg"===S},width:"svg"===S&&o?C():500,style:"svg"===S&&o?{height:k()}:void 0,children:(0,a.jsxs)(p.default,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:12,fontWeight:500},children:"Export Format"}),(0,a.jsxs)(tF.default.Group,{value:S,onChange:e=>M(e.target.value),buttonStyle:"solid",children:[(0,a.jsx)(tF.default.Button,{value:"image",children:"Image (PNG/JPG)"}),(0,a.jsx)(tF.default.Button,{value:"svg",children:"SVG"})]})]}),(0,a.jsx)(rH.default,{style:{margin:"8px 0"}}),"image"===S&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:12,fontWeight:500},children:"Image Options"}),(0,a.jsxs)(p.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)(tF.default.Group,{value:E,onChange:e=>z(e.target.value),buttonStyle:"solid",children:[(0,a.jsx)(tF.default.Button,{value:"png",children:"PNG"}),(0,a.jsx)(tF.default.Button,{value:"jpg",children:"JPG"})]}),(0,a.jsx)(r$.default,{checked:T,onChange:e=>B(e.target.checked),children:"Include overlay layers"}),(0,a.jsx)("div",{style:{fontSize:12,color:"#666",marginLeft:24,marginTop:-8},children:T?"Export will include all visible layers and text overlays":"Export will only include the base image without layers"})]})]}),"svg"===S&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:12,fontWeight:500},children:"SVG Tracing Options"}),(0,a.jsxs)(p.default,{wrap:!0,size:"small",children:[(0,a.jsx)(tZ.default,{title:"Scale factor for the SVG output. Higher = larger SVG.",children:(0,a.jsxs)(p.default,{size:4,children:[(0,a.jsx)("label",{children:"Scale"}),(0,a.jsx)(rU,{style:{fontSize:12,color:"#999"}}),(0,a.jsx)(tY.default,{size:"small",min:.1,step:.1,value:s,onChange:e=>c(e||1),style:{width:70}})]})}),(0,a.jsx)(tZ.default,{title:"Error threshold for line detection. Lower = more precise lines.",children:(0,a.jsxs)(p.default,{size:4,children:[(0,a.jsx)("label",{children:"ltres"}),(0,a.jsx)(rU,{style:{fontSize:12,color:"#999"}}),(0,a.jsx)(tY.default,{size:"small",min:0,value:d,onChange:e=>u(e||1),style:{width:70}})]})}),(0,a.jsx)(tZ.default,{title:"Error threshold for curve detection. Lower = more precise curves.",children:(0,a.jsxs)(p.default,{size:4,children:[(0,a.jsx)("label",{children:"qtres"}),(0,a.jsx)(rU,{style:{fontSize:12,color:"#999"}}),(0,a.jsx)(tY.default,{size:"small",min:0,value:h,onChange:e=>g(e||1),style:{width:70}})]})}),(0,a.jsx)(tZ.default,{title:"Minimum path length to keep. Higher = simpler SVG with fewer tiny paths.",children:(0,a.jsxs)(p.default,{size:4,children:[(0,a.jsx)("label",{children:"Pathomit"}),(0,a.jsx)(rU,{style:{fontSize:12,color:"#999"}}),(0,a.jsx)(tY.default,{size:"small",min:0,value:m,onChange:e=>x(e||0),style:{width:70}})]})}),(0,a.jsx)(tZ.default,{title:"Pixel sampling interval for colors. 1 = every pixel, higher = faster but less accurate colors.",children:(0,a.jsxs)(p.default,{size:4,children:[(0,a.jsx)("label",{children:"ColorSampling"}),(0,a.jsx)(rU,{style:{fontSize:12,color:"#999"}}),(0,a.jsx)(tY.default,{size:"small",min:1,value:v,onChange:e=>y(e||1),style:{width:70}})]})}),(0,a.jsx)(tZ.default,{title:"Stroke width in the output SVG.",children:(0,a.jsxs)(p.default,{size:4,children:[(0,a.jsx)("label",{children:"StrokeWidth"}),(0,a.jsx)(rU,{style:{fontSize:12,color:"#999"}}),(0,a.jsx)(tY.default,{size:"small",min:0,value:w,onChange:e=>b(e||1),style:{width:70}})]})})]}),o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(rH.default,{style:{margin:"16px 0"}}),(0,a.jsx)("div",{style:{marginBottom:12,fontWeight:500},children:"SVG Results"}),(0,a.jsxs)(rA.default,{defaultActiveKey:"svg",type:"card",size:"small",children:[(0,a.jsxs)(rA.default.TabPane,{tab:"Preview",children:[(0,a.jsxs)(p.default,{style:{marginBottom:8},children:[(0,a.jsx)(f.default,{size:"small",onClick:()=>j(o,"image.svg"),icon:(0,a.jsx)(rV.default,{}),children:"Download"}),(0,a.jsx)(f.default,{size:"small",onClick:()=>(0,rY.handleCopy)(o,"SVG copied!"),icon:(0,a.jsx)(rg.default,{}),children:"Copy"})]}),(0,a.jsx)("div",{style:{border:"1px solid #eee",borderRadius:6,padding:12,overflow:"auto",maxHeight:n.current?n.current.height:400},children:(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:o}})})]},"svg"),(0,a.jsxs)(rA.default.TabPane,{tab:"Base64",children:[(0,a.jsxs)(p.default,{style:{marginBottom:8},children:[(0,a.jsx)(f.default,{size:"small",onClick:()=>(0,rY.handleCopy)(D,"Base64 copied!"),icon:(0,a.jsx)(rg.default,{}),children:"Copy"}),(0,a.jsx)(f.default,{size:"small",onClick:()=>j(D,"image-base64.txt"),icon:(0,a.jsx)(rV.default,{}),children:"Download"})]}),(0,a.jsx)("pre",{style:{background:"#f7f7f7",padding:12,borderRadius:6,whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:300,overflow:"auto",fontSize:12},children:D})]},"base64"),(0,a.jsxs)(rA.default.TabPane,{tab:"Data URI",children:[(0,a.jsxs)(p.default,{style:{marginBottom:8},children:[(0,a.jsx)(f.default,{size:"small",onClick:()=>(0,rY.handleCopy)(L,"Data URI copied!"),icon:(0,a.jsx)(rg.default,{}),children:"Copy"}),(0,a.jsx)(f.default,{size:"small",onClick:()=>j(L,"image-datauri.txt"),icon:(0,a.jsx)(rV.default,{}),children:"Download"})]}),(0,a.jsx)("pre",{style:{background:"#f7f7f7",padding:12,borderRadius:6,whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:300,overflow:"auto",fontSize:12},children:L})]},"datauri")]})]}),i&&(0,a.jsx)("div",{style:{textAlign:"center",padding:24},children:(0,a.jsx)(rO.default,{indicator:(0,a.jsx)(rK,{style:{fontSize:32},spin:!0}),tip:"Converting to SVG..."})})]})]})});},{Panel:rZ}=t6.default,rJ=({canvasRef:e,baseCanvas:t,history:r,setTool:l,brightness:n,setBrightness:i,contrast:o,setContrast:s,blur:c,setBlur:d,gaussian:u,setGaussian:h,sharpen:g,setSharpen:m,bgThreshold:x,setBgThreshold:v,bgThresholdBlack:y,setBgThresholdBlack:w,setShowPerspectiveModal:b,dpiMeasured:j,setDpiMeasured:C,exportImage:k,onExport:M,overlayRef:E,texture:R,setTexture:z,clarity:T,setClarity:B,highlights:D,setHighlights:L,shadows:$,setShadows:N,whites:A,setWhites:P,blacks:O,setBlacks:_,vibrance:H,setVibrance:W,saturation:U,setSaturation:F,dehaze:V,setDehaze:G,hslAdjustments:X,setHslAdjustments:K,upscaleImage:Y,onColorRemovalToolClick:q,showExportModal:Z,setShowExportModal:J})=>{let[Q,ee]=(0,I.useState)("red"),[et,er]=(0,I.useState)(!1),[el,en]=(0,I.useState)(2),[ea,ei]=(0,I.useState)("medium"),[eo,es]=(0,I.useState)(0),[ec,ed]=(0,I.useState)(0),[eu,eh]=(0,I.useState)(0),[ef,eg]=(0,I.useState)(null),[em,ex]=(0,I.useState)(!1),[ep,ev]=(0,I.useState)(1),[ey,ew]=(0,I.useState)(1),[eb,ej]=(0,I.useState)(1),[eC,ek]=(0,I.useState)(8),[eS,eM]=(0,I.useState)(2),[eI,eE]=(0,I.useState)(1),[eR,ez]=(0,I.useState)({red:[],green:[],blue:[]});(0,I.useEffect)(()=>{e.current&&ez(tA(e.current));},[e.current]);let eT=[{name:"red",color:"#ff4d4d"},{name:"orange",color:"#ffa500"},{name:"yellow",color:"#ffd700"},{name:"green",color:"#00c853"},{name:"aqua",color:"#00e5ff"},{name:"blue",color:"#2979ff"},{name:"purple",color:"#9c27b0"},{name:"magenta",color:"#ff00aa"}],eB=(e,t)=>{var r,l,n;let a=(null===(r=eT.find(t=>t.name===e))||void 0===r?void 0:r.color)||"#ffffff",i=eT.findIndex(t=>t.name===e);if(-1===i)return"#555";let o=eT[i].color,s=(null===(l=eT[i-1])||void 0===l?void 0:l.color)||o,c=(null===(n=eT[i+1])||void 0===n?void 0:n.color)||o;switch(t){case"h":return`linear-gradient(90deg, ${s}, ${o}, ${c})`;case"s":return`linear-gradient(90deg, gray, ${a})`;case"l":return`linear-gradient(90deg, black, ${a}, white)`;default:return"#555";}},eD=[{key:"texture",label:"Texture",value:R,setter:z},{key:"clarity",label:"Clarity",value:T,setter:B},{key:"highlights",label:"Highlights",value:D,setter:L},{key:"shadows",label:"Shadows",value:$,setter:N},{key:"whites",label:"Whites",value:A,setter:P},{key:"blacks",label:"Blacks",value:O,setter:_}],eL=[{key:"blur",label:"Box Blur",min:0,max:25,value:c,setter:d},{key:"gaussian",label:"Gaussian",min:0,max:20,value:u,setter:h},{key:"sharpen",label:"Sharpen",min:0,max:5,value:g,setter:m},{key:"bgThreshold",label:"Remove White",min:0,max:255,value:x,setter:v},{key:"bgThresholdBlack",label:"Remove Black",min:0,max:255,value:y,setter:w}],e$=()=>tN(e,t,{blur:c,gaussian:u,sharpen:g,texture:R,clarity:T,bgThreshold:x,bgThresholdBlack:y,brightness:n,contrast:o,highlights:D,shadows:$,whites:A,blacks:O,vibrance:H,saturation:U,dehaze:V,hslAdjustments:X},r,ez);return(0,a.jsxs)("div",{style:{width:260},children:[(0,a.jsxs)(t6.default,{defaultActiveKey:["histogram","basic","lights","effects"],ghost:!0,expandIconPosition:"end",children:[(0,a.jsx)(rZ,{header:"Histogram",children:(0,a.jsx)(rB,{canvasRef:e,redData:eR.red,greenData:eR.green,blueData:eR.blue})},"histogram"),(0,a.jsx)(rZ,{header:"\u{1F6E0} Basic",children:(0,a.jsxs)(p.default,{wrap:!0,children:[(0,a.jsx)(tZ.default,{title:"Undo (Ctrl+Z)",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(t3.default,{}),onClick:r.undo})}),(0,a.jsx)(tZ.default,{title:"Redo (Ctrl+Shift+Z)",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(t7.default,{}),onClick:r.redo})}),(0,a.jsx)(tZ.default,{title:"Rotate left",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(rn,{}),onClick:()=>te(-90,e,E,r)})}),(0,a.jsx)(tZ.default,{title:"Rotate right (R)",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(ri.default,{}),onClick:()=>te(90,e,E,r)})}),(0,a.jsx)(tZ.default,{title:"Flip horizontal",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(rs.default,{}),onClick:()=>tt(e,r)})}),(0,a.jsx)(tZ.default,{title:"Flip vertical",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(rs.default,{rotate:90}),onClick:()=>tr(e,r)})}),(0,a.jsx)(tZ.default,{title:"Crop (C)",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(rd,{}),onClick:()=>l("crop")})}),(0,a.jsx)(tZ.default,{title:"Perspective",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(rw,{}),onClick:()=>{b(!0),l("perspective");}})}),(0,a.jsx)(tZ.default,{title:"Brush (B)",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(rj,{}),onClick:()=>l("draw")})}),(0,a.jsx)(tZ.default,{title:"Text (T)",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(rv.default,{}),onClick:()=>l("text")})}),(0,a.jsx)(tZ.default,{title:"Layer (V)",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(rx.default,{}),onClick:()=>l("layer")})}),(0,a.jsx)(tZ.default,{title:"Invert Colors (Ctrl+I)",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(rk,{}),onClick:()=>tP(e,r)})}),(0,a.jsx)(tZ.default,{title:"Remove color",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(tQ.default,{}),onClick:q})})]})},"basic"),(0,a.jsxs)(rZ,{header:"\u{1F506} Light",children:[(0,a.jsx)(rI,{label:"Brightness",value:n,min:-150,max:150,onChange:i,onChangeComplete:e$},"brightness"),(0,a.jsx)(rI,{label:"Contrast",value:o,min:-100,max:100,onChange:s,onChangeComplete:e$},"contrast")]},"lights"),(0,a.jsxs)(rZ,{header:"\u{1F3A8} Color",children:[(0,a.jsx)(rI,{label:"Vibrance",value:H,min:-100,max:100,onChange:W,onChangeComplete:e$},"vibrance"),(0,a.jsx)(rI,{label:"Saturation",value:U,min:-100,max:100,onChange:F,onChangeComplete:e$},"saturation"),(0,a.jsx)(rI,{label:"Dehaze",value:V,min:-100,max:100,onChange:G,onChangeComplete:e$},"dehaze"),(0,a.jsx)("div",{style:{marginTop:10},children:"HSL Mixer"}),(0,a.jsx)("div",{style:{display:"flex",gap:8,marginBottom:10},children:eT.map(({name:e,color:t})=>(0,a.jsx)(tZ.default,{title:e.toUpperCase(),children:(0,a.jsx)("div",{onClick:()=>ee(e),style:{width:20,height:20,borderRadius:"50%",background:t,border:Q===e?"2px solid white":"1px solid #555",boxShadow:Q===e?"0 0 6px rgba(255,255,255,0.8)":"",cursor:"pointer"}},e)}))}),["Hue","Saturation","Luminance"].map(e=>{var t;let r=e[0].toLowerCase();return(0,a.jsx)(rI,{label:e,value:(null===(t=X[Q])||void 0===t?void 0:t[r])??0,min:"Hue"===e?-180:-100,max:"Hue"===e?180:100,onChange:e=>K(Q,{[r]:e}),onChangeComplete:e$,gradient:eB(Q,r)},e);}),(0,a.jsx)(f.default,{size:"small",onClick:()=>K(Q,{h:0,s:0,l:0}),children:"Reset"})]},"color"),(0,a.jsx)(rZ,{header:"\u2728 Effects",children:eD.map(({key:e,label:t,value:r,setter:l})=>(0,a.jsx)(rI,{label:t,value:r,min:-100,max:100,onChange:l,onChangeComplete:e$},e))},"effects"),(0,a.jsx)(rZ,{header:"\u{1F3AD} Filters",children:eL.map(({key:e,label:t,min:r,max:l,value:n,setter:i})=>(0,a.jsx)(rI,{label:t,value:n,min:r,max:l,onChange:i,onChangeComplete:e$},e))},"filters"),(0,a.jsxs)(rZ,{header:"\u{1F4D0} Crop & Ruler",children:[(0,a.jsxs)(p.default,{children:[(0,a.jsx)(f.default,{icon:(0,a.jsx)(rd,{}),onClick:()=>l("crop"),children:"Crop"}),(0,a.jsx)(f.default,{onClick:()=>{b(!0),l("perspective");},children:"Perspective"})]}),(0,a.jsx)("div",{style:{marginTop:10},children:"Ruler"}),(0,a.jsxs)(p.default,{children:[(0,a.jsx)(f.default,{onClick:()=>l("ruler"),children:"\u{1F4CF} Ruler"}),(0,a.jsx)(f.default,{onClick:()=>{null==C||C(null),S.default.info("Ruler cleared");},children:"Clear"})]}),j&&(0,a.jsxs)("div",{children:["Estimated DPI: ",j]})]},"crop"),(0,a.jsx)(rZ,{header:"\u{1F53C} Upscale Options",children:(0,a.jsx)(f.default,{onClick:()=>{er(!0);},children:"Custom Upscale..."})},"upscaleOptions"),(0,a.jsx)(rZ,{header:"\u{1F4E4} Export",children:(0,a.jsxs)(p.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsx)(f.default,{icon:(0,a.jsx)(rh,{}),onClick:()=>{J(!0);},type:"primary",block:!0,children:"Export Image / SVG"}),(0,a.jsx)(f.default,{icon:(0,a.jsx)(rg.default,{}),onClick:()=>tn(e),block:!0,children:"Copy to Clipboard"})]})},"export")]}),(0,a.jsx)(rD,{open:et,onCancel:()=>er(!1),onOk:()=>{l("upscale"),null==Y||Y(el,ea,{sharpen:eo,edgeEnhancement:ec,denoise:eu}),er(!1);},upscaleFactor:el,setUpscaleFactor:en,presetLocal:ea,setPresetLocal:ei,sharpenAmount:eo,setSharpenAmount:es,edgeEnhancement:ec,setEdgeEnhancement:ed,denoiseAmount:eu,setDenoiseAmount:eh}),(0,a.jsx)(rq,{open:Z,onCancel:()=>{J(!1),eg(null);},onExportImage:(t,r)=>{k("jpg"===t,e,M,r);},onExportSvg:()=>{if(!e.current){S.default.error("No image to convert");return;}ex(!0);let t=e.current.toDataURL();try{rM.default.imageToSVG(t,e=>{eg(e),ex(!1),S.default.success("Image converted to SVG successfully!");},{scale:ep,ltres:ey,qtres:eb,pathomit:eC,colorsampling:eS,strokewidth:eI});}catch(e){console.error(e),ex(!1),S.default.error("Error converting image to SVG.");}},canvasRef:e,processing:em,svgContent:ef,scale:ep,setScale:ev,ltres:ey,setLtres:ew,qtres:eb,setQtres:ej,pathomit:eC,setPathomit:ek,colorsampling:eS,setColorsampling:eM,strokewidth:eI,setStrokewidth:eE,onDownload:(e,t)=>{let r=new Blob([e],{type:"image/svg+xml"}),l=document.createElement("a");l.href=URL.createObjectURL(r),l.download=t,l.click();},getSvgModalWidth:()=>e.current?Math.min(Math.max(e.current.width+100,500),.9*window.innerWidth):700,getSvgModalHeight:()=>{if(e.current)return Math.min(e.current.height+300,.85*window.innerHeight);}})]});};var rQ=r("d62d811b"),r0=l._(rQ),r1=r("5e015b19"),r2=l._(r1),r8=r("a408d8c9"),r4=l._(r8),r6={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M482.2 508.4L331.3 389c-3-2.4-7.3-.2-7.3 3.6V478H184V184h204v128c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V144c0-15.5-12.5-28-28-28H144c-15.5 0-28 12.5-28 28v736c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v128H184V546h140v85.4c0 3.8 4.4 6 7.3 3.6l150.9-119.4a4.5 4.5 0 000-7.2zM880 116H596c-15.5 0-28 12.5-28 28v168c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V184h204v294H700v-85.4c0-3.8-4.3-6-7.3-3.6l-151 119.4a4.52 4.52 0 000 7.1l151 119.5c2.9 2.3 7.3.2 7.3-3.6V546h140v294H636V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v168c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V144c0-15.5-12.5-28-28-28z"}}]},name:"merge-cells",theme:"outlined"},r5=I.forwardRef(function(e,t){return I.createElement(rl.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:r6}));}),r3=r("1f06600b"),r9=l._(r3),r7=I.forwardRef(function(e,t){return I.createElement(rl.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:r9.default}));}),le=r("69757292"),lt=l._(le),lr=I.forwardRef(function(e,t){return I.createElement(rl.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:lt.default}));}),ll=r("30963339"),ln=l._(ll),la={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M798 160H366c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h181.2l-156 544H229c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h432c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8H474.4l156-544H798c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"italic",theme:"outlined"},li=I.forwardRef(function(e,t){return I.createElement(rl.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:la}));}),lo={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M120 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm0 424h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm784 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"align-left",theme:"outlined"},ls=I.forwardRef(function(e,t){return I.createElement(rl.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:lo}));}),lc={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M264 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H264c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm496 424c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H264c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496zm144 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"align-center",theme:"outlined"},ld=I.forwardRef(function(e,t){return I.createElement(rl.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:lc}));}),lu={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 158H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 424H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 212H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"align-right",theme:"outlined"},lh=I.forwardRef(function(e,t){return I.createElement(rl.default,(0,T.default)((0,T.default)({},e),{},{ref:t,icon:lu}));});let{Option:lf}=tX.default,lg=({history:e,setZoom:t,tool:r,setTool:l,brushType:n,setBrushType:i,drawColor:o,setDrawColor:s,drawLineWidth:c,setDrawLineWidth:d,brushOpacity:u,setBrushOpacity:h,brushFlow:g,setBrushFlow:m,layers:x,activeLayerId:v,setLayerOpacity:y,setLayerBlend:w,moveLayerUp:b,moveLayerDown:j,deleteLayer:C,selectLayer:k,mergeLayer:S,textContent:M,setTextContent:E,textFont:R,setTextFont:z,textFontSize:T,setTextFontSize:B,textColor:D,setTextColor:L,textWeight:$,setTextWeight:N,textItalic:A,setTextItalic:P,textDecoration:O,setTextDecoration:_,textAlign:H,setTextAlign:W,onAddTextLayer:U,isAddingText:F,setIsAddingText:V,onOpenMaskTool:G})=>{let X=(0,I.useRef)(!1),K=(0,I.useRef)(null),Y=(0,I.useRef)(u),q=(0,I.useRef)(!1),Z=(0,I.useRef)(null),J=(0,I.useRef)(g),Q=e=>{if(0!==e.button)return;e.preventDefault(),X.current=!0,K.current=e.clientX;let t=document.body.style.userSelect;document.body.style.userSelect="none";let l=e=>{let t=Number(e.toFixed(2));if("draw"===r){h(t);return;}if("layer"===r&&x){let e=x.find(e=>e.id===v);e&&y&&y(e.id,t);}};Y.current=(()=>{if("draw"===r)return u;if("layer"===r&&x){let e=x.find(e=>e.id===v);return(null==e?void 0:e.opacity)??u;}return u;})();let n=e=>{if(!X.current||null===K.current)return;let t=e.clientX-K.current;l(Math.min(1,Math.max(0,Y.current+.005*t)));},a=()=>{X.current=!1,K.current=null,document.body.style.userSelect=t,window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",a);};window.addEventListener("mousemove",n),window.addEventListener("mouseup",a);};return(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsxs)(p.default,{children:[(0,a.jsx)(tX.default,{style:{width:150},placeholder:"History",value:e.index,onChange:t=>e.applyHistory(t),optionLabelProp:"label",children:e.history.map((e,t)=>(0,a.jsx)(tX.default.Option,{value:t,label:e.label||`Step ${t+1}`,children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("img",{src:e.url,alt:"",style:{width:40,height:30,objectFit:"contain",border:"1px solid #ddd"}}),(0,a.jsx)("span",{children:e.label||`Step ${t+1}`})]})},t))}),(0,a.jsx)(tZ.default,{title:"Zoom In",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(r2.default,{}),onClick:()=>t(e=>Math.min(1.2*e,8))})}),(0,a.jsx)(tZ.default,{title:"Zoom Out",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(r4.default,{}),onClick:()=>t(e=>Math.max(e/1.2,.1))})}),(0,a.jsxs)(tX.default,{value:r,onChange:e=>l(e),style:{width:140},children:[(0,a.jsx)(lf,{value:"pan",children:"Pan"}),(0,a.jsx)(lf,{value:"move",children:"Move"}),(0,a.jsx)(lf,{value:"color",children:"Color Picker"}),(0,a.jsx)(lf,{value:"crop",children:"Crop"}),(0,a.jsx)(lf,{value:"ruler",children:"Ruler"}),(0,a.jsx)(lf,{value:"perspective",children:"Perspective"}),(0,a.jsx)(lf,{value:"draw",children:"Brush"}),(0,a.jsx)(lf,{value:"text",children:"Text"})]}),(0,a.jsxs)(p.default,{style:{width:"100%"},wrap:!0,children:["color"===r?(0,a.jsx)(r0.default,{value:o,onChange:e=>s(e.toHexString())}):null,"draw"===r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(tX.default,{value:n,onChange:e=>i(e),style:{width:80},children:[(0,a.jsx)(lf,{value:"hard",children:"Hard"}),(0,a.jsx)(lf,{value:"soft",children:"Soft"})]}),(0,a.jsx)(r0.default,{value:o,onChange:e=>s(e.toHexString())}),(0,a.jsx)(tY.default,{style:{width:100},min:1,max:500,value:c,onChange:e=>d(e||1),addonAfter:"px"}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("span",{onMouseDown:Q,style:{cursor:"ew-resize",userSelect:"none"},title:"Drag left/right to change opacity",children:"Opacity:"}),(0,a.jsx)(tY.default,{min:0,max:1,step:.01,style:{width:60},value:u,onChange:e=>h(e||0)})]}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("span",{onMouseDown:e=>{if(0!==e.button)return;e.preventDefault(),q.current=!0,Z.current=e.clientX,J.current=g;let t=document.body.style.userSelect;document.body.style.userSelect="none";let r=e=>{if(!q.current||null===Z.current)return;let t=e.clientX-Z.current,r=J.current+.005*t;m(Number((r=Math.max(0,Math.min(1,r))).toFixed(2)));},l=()=>{q.current=!1,Z.current=null,J.current=g,document.body.style.userSelect=t,window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",l);};window.addEventListener("mousemove",r),window.addEventListener("mouseup",l);},style:{cursor:"ew-resize",userSelect:"none"},title:"Drag left/right to change flow",children:"Flow:"}),(0,a.jsx)(tY.default,{min:0,max:1,step:.01,style:{width:60},value:g,onChange:e=>m(e||0)})]})]}):null,"text"===r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(tX.default,{value:R||"Arial",onChange:e=>z&&z(e),style:{width:100},children:[(0,a.jsx)(lf,{value:"Arial",children:"Arial"}),(0,a.jsx)(lf,{value:"Helvetica",children:"Helvetica"}),(0,a.jsx)(lf,{value:"Times New Roman",children:"Times New Roman"}),(0,a.jsx)(lf,{value:"Courier New",children:"Courier New"}),(0,a.jsx)(lf,{value:"Georgia",children:"Georgia"}),(0,a.jsx)(lf,{value:"Verdana",children:"Verdana"})]}),(0,a.jsx)(tY.default,{min:8,max:200,value:T||32,onChange:e=>B&&B(e||32),addonAfter:"px",style:{width:90}}),(0,a.jsx)(r0.default,{value:D||"#000000",onChange:e=>L&&L(e.toHexString())}),(0,a.jsxs)(tX.default,{value:$||"normal",onChange:e=>N&&N(e),style:{width:80},children:[(0,a.jsx)(lf,{value:"lighter",children:"Lighter"}),(0,a.jsx)(lf,{value:"normal",children:"Normal"}),(0,a.jsx)(lf,{value:"bold",children:"Bold"}),(0,a.jsx)(lf,{value:"900",children:"900"})]}),(0,a.jsx)(tZ.default,{title:"Italic",children:(0,a.jsx)(f.default,{size:"small",icon:(0,a.jsx)(li,{}),type:A?"primary":"default",onClick:()=>P&&P(!A)})}),(0,a.jsxs)(tX.default,{value:O||"none",onChange:e=>_&&_(e),style:{width:100},children:[(0,a.jsx)(lf,{value:"none",children:"No decoration"}),(0,a.jsx)(lf,{value:"underline",children:"Underline"}),(0,a.jsx)(lf,{value:"line-through",children:"Strike"})]}),(0,a.jsx)(tZ.default,{title:"Align",children:(0,a.jsxs)(p.default,{size:"small",children:[(0,a.jsx)(f.default,{size:"small",icon:(0,a.jsx)(ls,{}),type:"left"===H?"primary":"default",onClick:()=>W&&W("left")}),(0,a.jsx)(f.default,{size:"small",icon:(0,a.jsx)(ld,{}),type:"center"===H?"primary":"default",onClick:()=>W&&W("center")}),(0,a.jsx)(f.default,{size:"small",icon:(0,a.jsx)(lh,{}),type:"right"===H?"primary":"default",onClick:()=>W&&W("right")})]})})]}):null,"layer"===r?(0,a.jsx)(a.Fragment,{children:x&&x.length>0&&(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("span",{style:{fontSize:12,fontWeight:600},children:"Layers"}),(0,a.jsx)(tX.default,{value:v||void 0,placeholder:"Select layer",onChange:e=>k&&k(e),style:{width:180},showSearch:!0,children:x.slice().reverse().map(e=>{var t;return(0,a.jsx)(lf,{value:e.id,label:`Layer ${e.id}`,children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.img&&(0,a.jsx)("img",{src:null===(t=e.img)||void 0===t?void 0:t.src,alt:"",style:{width:40,height:28,objectFit:"cover"}}),e.text&&(0,a.jsx)(rv.default,{}),(0,a.jsx)("span",{style:{fontSize:12},children:e.id})]})},e.id);})})]}),(0,a.jsx)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:(0,a.jsx)(f.default,{size:"small",icon:(0,a.jsx)(r5,{}),onClick:()=>S&&S(),children:"Merge All"})}),v&&(()=>{let e=x.find(e=>e.id===v);return e?(0,a.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,a.jsx)(f.default,{size:"small",icon:(0,a.jsx)(r5,{}),onClick:()=>S&&S(e.id),children:"Merge"}),(0,a.jsx)(f.default,{size:"small",icon:(0,a.jsx)(t1.default,{}),onClick:()=>G&&G(e.id),children:"Mask"}),(0,a.jsx)(f.default,{size:"small",icon:(0,a.jsx)(r7,{}),onClick:()=>b&&b(e.id)}),(0,a.jsx)(f.default,{size:"small",icon:(0,a.jsx)(lr,{}),onClick:()=>j&&j(e.id)}),(0,a.jsx)(f.default,{size:"small",danger:!0,icon:(0,a.jsx)(ln.default,{}),onClick:()=>C&&C(e.id)}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginLeft:8},children:[(0,a.jsx)("span",{onMouseDown:Q,style:{cursor:"ew-resize",userSelect:"none"},title:"Drag left/right to change opacity",children:"Opacity:"}),(0,a.jsx)(tY.default,{min:0,max:1,step:.01,style:{width:80},value:Number(e.opacity.toFixed(2)),onChange:t=>y&&y(e.id,Number(t||0))})]}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("span",{style:{userSelect:"none"},children:"Blend:"}),(0,a.jsxs)(tX.default,{value:e.blend||"source-over",onChange:t=>w&&w(e.id,t),style:{width:140},children:[(0,a.jsx)(lf,{value:"source-over",children:"Normal"}),(0,a.jsx)(lf,{value:"multiply",children:"Multiply"}),(0,a.jsx)(lf,{value:"screen",children:"Screen"}),(0,a.jsx)(lf,{value:"overlay",children:"Overlay"}),(0,a.jsx)(lf,{value:"lighter",children:"Lighten"}),(0,a.jsx)(lf,{value:"darken",children:"Darken"})]})]})]}):null;})()]})}):null]})]})});},lm=({imageUrl:e,addOnFile:t,setAddOnFile:r,onExport:l})=>{var n;let i=(0,I.useRef)(null),{canvasRef:o,overlayRef:s,baseCanvas:c,setBaseCanvas:d,syncCanvasSize:u}=function(e,t){let r=(0,I.useRef)(null),l=(0,I.useRef)(null),[n,a]=(0,I.useState)(null);(0,I.useEffect)(()=>{(async()=>{try{let l=await new Promise((t,r)=>{let l=new Image;l.crossOrigin="anonymous",l.onload=()=>{let e=eJ(l.naturalWidth,l.naturalHeight);e.getContext("2d").drawImage(l,0,0),t(e);},l.onerror=r,l.src=e;});a(l);let n=eJ(l.width,l.height);if(n.getContext("2d").drawImage(l,0,0),r.current){r.current.width=n.width,r.current.height=n.height;let e=r.current.getContext("2d");e.clearRect(0,0,n.width,n.height),e.drawImage(n,0,0);}t&&t(i(n));}catch(e){console.error("Failed to load image",e),S.default.error("Failed to load image");}})();},[e]),(0,I.useEffect)(()=>{o();},[n]);let i=e=>e.toDataURL("image/png"),o=()=>{if(!r.current||!n)return;r.current.width=n.width,r.current.height=n.height,l.current.width=n.width,l.current.height=n.height;let e=r.current.getContext("2d");e.clearRect(0,0,r.current.width,r.current.height),e.drawImage(n,0,0);};return{canvasRef:r,overlayRef:l,baseCanvas:n,setBaseCanvas:a,syncCanvasSize:o};}(e,e=>h.push(e,"Initial load")),h=function(e,t){let[r,l]=(0,I.useState)([]),[n,a]=(0,I.useState)(-1),i=r[n],o=l=>{let n=r[l];if(!n)return;let i=new Image;i.onload=()=>{let r=e.current.getContext("2d");e.current.width=i.naturalWidth,e.current.height=i.naturalHeight,t.current.width=i.naturalWidth,t.current.height=i.naturalHeight,r.clearRect(0,0,e.current.width,e.current.height),r.drawImage(i,0,0),a(l);},i.src=n.url;};return{history:r,index:n,current:i,push:(e,t="",i=!0)=>{let o=r.slice(0,n+1);o.push({url:e,label:t,isSetBase:i}),l(o),a(o.length-1);},undo:()=>{n<=0||o(n-1);},redo:()=>{n>=r.length-1||o(n+1);},applyHistory:o};}(o,s),[g,m]=(0,I.useState)(1),[x,p]=(0,I.useState)({x:0,y:0}),[v,y]=(0,I.useState)(!1),w=(0,I.useRef)(null),[b,j]=(0,I.useState)("pan"),[C,k]=(0,I.useState)(0),[M,E]=(0,I.useState)(0),[z,T]=(0,I.useState)(0),[B,D]=(0,I.useState)(0),[L,$]=(0,I.useState)(0),[N,A]=(0,I.useState)(0),[P,O]=(0,I.useState)(0),[_,H]=(0,I.useState)(0),[W,U]=(0,I.useState)(0),[F,V]=(0,I.useState)(null),G=(0,I.useRef)(null),[X,K]=(0,I.useState)(!1),Y=(0,I.useRef)(null),q=()=>{Y.current||(Y.current=[NaN,NaN,NaN,NaN,NaN,NaN,NaN,NaN]);},Z=(e,t,r=12)=>{if(!Y.current)return -1;let l=Y.current;for(let n=0;n<8;n+=2){let a=l[n],i=l[n+1];if(!isNaN(a)&&!isNaN(i)){let l=a-e,o=i-t;if(Math.sqrt(l*l+o*o)<=r)return n;}}return -1;},[J,Q]=(0,I.useState)(null),[ee,et]=(0,I.useState)(!1),[er,el]=(0,I.useState)(!1),[en,ea]=(0,I.useState)(!1),[ei,eo]=(0,I.useState)(null),[es,ec]=(0,I.useState)(null),[ed,eu]=(0,I.useState)(!1),[eh,ef]=(0,I.useState)(null),[eg,em]=(0,I.useState)(!1),[ex,ep]=(0,I.useState)(null),ev=(0,I.useRef)(null),[ey,ew]=(0,I.useState)(null),[eb,ej]=(0,I.useState)([]),[eC,ek]=(0,I.useState)(null),[eS,eM]=(0,I.useState)(!1),[eI,eE]=(0,I.useState)(""),[eR,ez]=(0,I.useState)("Arial"),[eT,eB]=(0,I.useState)(32),[eD,eL]=(0,I.useState)("#000000"),[e$,eN]=(0,I.useState)("normal"),[eA,eP]=(0,I.useState)(!1),[eO,e_]=(0,I.useState)("none"),[eH,eW]=(0,I.useState)("left"),[eU,eF]=(0,I.useState)(!1),eV=(0,I.useRef)(null),eG=(0,I.useRef)(null),eX=(0,I.useRef)(null),eK=(0,I.useRef)(null),[eq,eQ]=(0,I.useState)(!1),[e0,e1]=(0,I.useState)(!1),e2=(0,I.useRef)(null),e8=(0,I.useRef)(null),e4=(0,I.useRef)(null);(0,I.useEffect)(()=>{t&&(e6(t),r(null));},[t]),(0,I.useEffect)(()=>{c&&(ej(e=>{if(e[0]&&e[0].locked)return e;let t=new Image;return t.src=c.toDataURL(),[{id:`base_overlay_${Date.now()}`,type:"image",img:t,rect:{x:0,y:0,w:c.width,h:c.height},opacity:0,blend:"source-over",locked:!0},...e];}),setTimeout(()=>{try{u(),ro();}catch(e){}},50));},[c]);let e6=e=>ti(e,o,ej,ek,eM,ro,j),e5=async(e,t,r,l=!0)=>ts(e,t,l?eb:[],r),e3=e=>tc(o,eb,ej,h,e),e9=e=>tg(ej,e,ek),e7=(e,t)=>tp(ej,e,t),tt=(e,t)=>tv(ej,e,t),tr=(e,t)=>ty(ej,e,t),tn=(e,t)=>tw(ej,e,t),to=(e,t)=>tb(ej,e,t),tM=(e,t)=>tj(ej,e,t),tI=(e,t)=>tC(ej,e,t),tE=(e,t)=>tk(ej,e,t),tB=()=>eb.find(e=>e.id===ex);(0,I.useEffect)(()=>{var e;if(!o.current||!(null===(e=h.history[h.index])||void 0===e?void 0:e.isSetBase))return;let t=o.current,r=document.createElement("canvas");r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0),d(r),ej(e=>{if(!e[0])return e;let t={...e[0]};return t.img&&(t.img.src=r.toDataURL()),t.rect={x:0,y:0,w:r.width,h:r.height},[t,...e.slice(1)];}),s.current&&(s.current.width=r.width,s.current.height=r.height),ro();},[h.index]);let[tL,t$]=(0,I.useState)("#ff0000"),[tN,tA]=(0,I.useState)(2),[tH,tW]=(0,I.useState)("hard"),[tU,tF]=(0,I.useState)(1),[tG,tX]=(0,I.useState)(1),[tK,tY]=(0,I.useState)(!1),tq=(0,I.useRef)([]),tZ=(0,I.useRef)(!1),tJ=(0,I.useRef)(null),tQ=(0,I.useRef)(tN),[t0,t1]=(0,I.useState)(0),[t2,t4]=(0,I.useState)(0),[t6,t5]=(0,I.useState)(0),[t3,t9]=(0,I.useState)(0),[t7,re]=(0,I.useState)(0),[rt,rr]=(0,I.useState)(0),[rl,rn]=(0,I.useState)(0),[ra,ri]=(0,I.useState)({});(0,I.useEffect)(()=>{let e=i.current;if(!e)return;let t=e=>e.preventDefault();return e.addEventListener("contextmenu",t),()=>e.removeEventListener("contextmenu",t);},[]),(0,I.useEffect)(()=>{let e=i.current,t=o.current;if(!e||!t)return;let r=e=>{if(!e.ctrlKey)return;e.preventDefault();let r=t.getBoundingClientRect(),l=e.clientX-r.left,n=e.clientY-r.top;m(t=>{let r=Math.min(Math.max(t*(e.deltaY<0?1.1:.9),.1),12),a=r/t;return p(e=>({x:l-(l-e.x)*a,y:n-(n-e.y)*a})),r;});};return e.addEventListener("wheel",r,{passive:!1}),()=>e.removeEventListener("wheel",r);},[]);let ro=()=>{tR(s,o,{zoom:g,cropRect:F,rulerPoints:ev.current,perspectivePoints:Y.current,hoverColor:ei,tool:b,drawColor:tL,drawLineWidth:tN,layers:eb,overlaySelected:eS,activeLayerId:eC});};(0,I.useEffect)(()=>{let e=o.current;if(!e)return;let t=e=>{if("color"===b||"removeColor"===b){let t=ta(e,o,g);eo(t?{x:e.clientX,y:e.clientY,color:t}:null),ro();}else"draw"===b&&(eo(tL?{x:e.clientX,y:e.clientY,color:tL}:null),ro());},r=e=>{if("color"===b){let t=ta(e,o,g);t&&(ec(t),t$(t),navigator.clipboard.writeText(t).catch(()=>{}),S.default.success(`Picked color ${t}`));}else if("removeColor"===b){let t=ta(e,o,g);t&&(ef(t),eu(!0),j("pan"));}},l=()=>{("color"===b||"removeColor"===b)&&eo(null);};return e.addEventListener("mousemove",t),e.addEventListener("click",r),e.addEventListener("mouseleave",l),()=>{e.removeEventListener("mousemove",t),e.removeEventListener("click",r),e.removeEventListener("mouseleave",l);};},[b,g,x]),(0,I.useEffect)(()=>{let e=e=>{(!eG.current||document.activeElement!==eG.current)&&(e.ctrlKey&&"z"===e.key&&h.undo(),e.ctrlKey&&e.shiftKey&&"Z"===e.key&&h.redo(),"c"===e.key&&j("crop"),"h"===e.key&&j("pan"),"v"===e.key&&j("layer"),"t"===e.key&&j("text"),"r"===e.key&&te(90,o,s,h.history),"i"===e.key&&j("color"),"p"===e.key&&j("perspective"),"b"===e.key&&j("draw"),"Delete"===e.key&&("layer"===b||"text"===b)&&eC&&e9(eC),e.ctrlKey&&"s"===e.key&&("layer"===b||"text"===b)&&(e.preventDefault(),e3(eC)),e.ctrlKey&&"i"===e.key&&(e.preventDefault(),tP(o,h)),e.ctrlKey&&e.shiftKey&&"S"===e.key&&(e.preventDefault(),eQ(!0)));};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e);},[h.index,h.history,b,eC,eb]),(0,I.useEffect)(()=>{let e=e=>{let t=(t,r,l=!0)=>e.code===t&&!!l&&(e.preventDefault(),Q(e=>e??b),j(r),!0);"Shift"===e.key?ea(!0):t("Space","pan")?et(!0):t("AltLeft","color","draw"===b)&&el(!0);},t=e=>{let t=(t,r)=>{e.code===t&&(r(!1),Q(e=>(e&&j(e),null)));};"Shift"===e.key&&ea(!1),t("Space",et),t("AltLeft",el);};return window.addEventListener("keydown",e,{passive:!1}),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t);};},[b]);let rs=async()=>await tT(o,s,Y,h,K,ro),rc=(0,I.useMemo)(()=>{if(("pan"===b||"select"===b)&&v)return"grabbing";switch(b){case"pan":return"grab";case"crop":case"ruler":case"perspective":case"removeColor":return"crosshair";case"color":return"copy";case"draw":return"pointer";case"text":return"text";default:return"default";}},[b,v]),rd=(0,I.useMemo)(()=>{let e=o.current;return e?`${e.width} \xd7 ${e.height}`:c?`${c.width} \xd7 ${c.height}`:null;},[o.current,c]),ru=[{title:"\u{1F3A8} Welcome to Pics Editor",description:"This is a powerful image editing tool with many features. Let me show you around!",target:null},{title:"\u{1F6E0}\uFE0F Side Panel",description:"Access all editing tools here: adjustments, effects, color grading, and export options. Apply changes to see them on the canvas.",target:()=>e8.current},{title:"\u{1F5BC}\uFE0F Canvas Area",description:"Your main workspace. Use Space + drag to pan, scroll to zoom, or Alt + scroll for fine zoom control. The resolution is shown in the top right.",target:()=>e4.current},{title:"\u2328\uFE0F Top Toolbar",description:"Quick access to undo/redo, zoom controls, and tool-specific options. Draw settings, layer management, and text formatting appear when those tools are active.",target:()=>e2.current},{title:'\u{1F3AD} Hand Tool (Hold "Space" or press "H")',description:"Navigate around your canvas. Hold Space key anywhere to temporarily activate pan mode, making it easy to move around large images."},{title:"\u2702\uFE0F Crop Tool (C)",description:"Click and drag to select a crop area. Press Enter to apply the crop or Escape to cancel. Perfect for trimming images to the exact size you need."},{title:"\u{1F3A8} Color Picker (I)",description:"Click on any pixel to pick its color. Hold Shift while clicking to pick from the original unedited image instead of the current edited version."},{title:"\u{1F5D1}\uFE0F Color Removal (K)",description:"Remove specific colors from your image. First use the Color Picker (I) to select a color, then activate this tool to remove it with adjustable tolerance and feathering for smooth edges."},{title:"\u{1F4CF} Ruler Tool (R)",description:"Measure distances on your image. Click two points to measure in pixels, then optionally enter a real-world measurement to calculate and display the image DPI."},{title:"\u{1F532} Perspective Tool (P)",description:"Correct perspective distortion in photos. Click to place 4 corner points clockwise, adjust them to match the object's corners, then apply to straighten the perspective."},{title:"\u270F\uFE0F Brush Tool (B)",description:"Freehand drawing with customizable options: brush size, color, opacity, flow rate, and choose between hard-edge and soft-edge brushes for different effects."},{title:"\u{1F5BC}\uFE0F Layer Tool (V)",description:"Add and manage image layers. Drag and drop images onto the canvas, adjust opacity and blend modes, resize, rotate, and position layers with full control."},{title:"\u{1F524} Text Tool (T)",description:"Add text overlays with complete formatting control: font family, size, weight (bold/normal), color, alignment (left/center/right), italic, and text decorations (underline/strikethrough)."},{title:"\u{1F50D} Upscale",description:"Enlarge your image intelligently. Choose from quality presets (low/medium/high) and apply enhancement options like sharpen, edge enhancement, and noise reduction for best results."},{title:"\u{1F4BE} Export (Ctrl + Shift + S)",description:"Export your edited image as PNG or JPG with optional overlay layers, or convert to scalable SVG format with customizable tracing parameters for vector graphics."},{title:"\u2328\uFE0F Keyboard Shortcuts",description:(0,a.jsxs)("div",{style:{lineHeight:1.8},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Space"}),": Pan tool (hold anywhere)"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"C"}),": Crop tool"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"I"}),": Color picker"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"K"}),": Color removal"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"R"}),": Ruler tool"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"P"}),": Perspective tool"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"D"}),": Draw tool"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"L"}),": Layer tool"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"T"}),": Text tool"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Ctrl+Z"}),": Undo"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Ctrl+Y"}),": Redo"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Scroll"}),": Zoom in/out"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Alt+Scroll"}),": Fine zoom control"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Shift+Click"}),": Pick from original image"]})]})}];return(0,a.jsxs)("div",{style:{display:"flex",gap:12,position:"relative"},children:[(0,a.jsx)(eY,{open:e0,onClose:()=>e1(!1),steps:ru}),(0,a.jsxs)("div",{ref:e8,children:[(0,a.jsx)(rJ,{canvasRef:o,overlayRef:s,baseCanvas:c,upscaleImage:(e,t,r)=>tD(o,s,h,d,ej,ro,e,t,r),history:h,setTool:j,brightness:C,setBrightness:k,contrast:M,setContrast:E,highlights:z,setHighlights:T,shadows:B,setShadows:D,whites:L,setWhites:$,blacks:N,setBlacks:A,vibrance:P,setVibrance:O,saturation:_,setSaturation:H,dehaze:W,setDehaze:U,blur:t0,setBlur:t1,gaussian:t2,setGaussian:t4,sharpen:t6,setSharpen:t5,texture:t3,setTexture:t9,clarity:t7,setClarity:re,bgThreshold:rt,setBgThreshold:rr,bgThresholdBlack:rl,setBgThresholdBlack:rn,hslAdjustments:ra,setHslAdjustments:(e,t)=>{ri(r=>({...r,[e]:{...r[e]||{},...t}}));},setShowPerspectiveModal:K,dpiMeasured:ey,setDpiMeasured:ew,exportImage:e5,onExport:l,showExportModal:eq,setShowExportModal:eQ,onColorRemovalToolClick:()=>j("removeColor")}),(0,a.jsx)(f.default,{type:"text",icon:(0,a.jsx)(eZ.default,{}),onClick:()=>e1(!0),style:{width:"100%"},children:"Help"})]}),(0,a.jsxs)("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[(0,a.jsx)("div",{ref:e2,children:(0,a.jsx)(lg,{history:h,setZoom:m,tool:b,setTool:j,brushType:tH,setBrushType:tW,drawColor:tL,setDrawColor:t$,drawLineWidth:tN,setDrawLineWidth:tA,brushOpacity:tU,setBrushOpacity:tF,brushFlow:tG,setBrushFlow:tX,layers:eb,activeLayerId:eC,setLayerOpacity:(e,t)=>td(ej,e,t),setLayerBlend:(e,t)=>tu(ej,e,t),moveLayerUp:e=>th(ej,e),moveLayerDown:e=>tf(ej,e),deleteLayer:e9,selectLayer:e=>{tm(ek,e),eM(!0);let t=eb.find(t=>t.id===e);t&&"text"===t.type&&(eE(t.text||""),ez(t.font||"Arial"),eB(t.fontSize||32),eL(t.textColor||"#000000"),eN(t.fontWeight||"normal"),eP(!!t.fontItalic),e_(t.textDecoration||"none"),eW(t.textAlign||"left"));},mergeLayer:e3,textContent:eI,setTextContent:e=>{let t=eb.find(e=>e.id===eC);t&&"text"===t.type?e7(t.id,e):eE(e);},textFont:eR,setTextFont:e=>{let t=eb.find(e=>e.id===eC);t&&"text"===t.type?tt(t.id,e):ez(e);},textFontSize:eT,setTextFontSize:e=>{let t=eb.find(e=>e.id===eC);t&&"text"===t.type?tr(t.id,e):eB(e);},textColor:eD,setTextColor:e=>{let t=eb.find(e=>e.id===eC);t&&"text"===t.type?tI(t.id,e):eL(e);},textWeight:e$,setTextWeight:e=>{let t=eb.find(e=>e.id===eC);t&&"text"===t.type?tn(t.id,e):eN(e);},textItalic:eA,setTextItalic:e=>{let t=eb.find(e=>e.id===eC);t&&"text"===t.type?to(t.id,e):eP(e);},textDecoration:eO,setTextDecoration:e=>{let t=eb.find(e=>e.id===eC);t&&"text"===t.type?tM(t.id,e):e_(e);},textAlign:eH,setTextAlign:e=>{let t=eb.find(e=>e.id===eC);t&&"text"===t.type?tE(t.id,e):eW(e);},onAddTextLayer:()=>{eF(!0),S.default.info("Click on the image to place the text");},isAddingText:eU,setIsAddingText:eF,onOpenMaskTool:e=>{ep(e),em(!0);}})}),(0,a.jsx)("div",{ref:e4,style:{flex:1},children:(0,a.jsx)(t_,{canvasRef:o,overlayRef:s,containerRef:i,offset:x,zoom:g,tool:b,currentCursor:rc,resolution:rd,hoverColor:ei,onMouseDown:e=>{let t=o.current.getBoundingClientRect(),r=(e.clientX-t.left)/g,l=(e.clientY-t.top)/g,n=(e,r,l="",n)=>{tz({canvasX:e,canvasY:r,canvasRect:t,containerRef:i,inlineEditorRef:eG,zoom:g,initial:l,layerId:null==n?void 0:n.layerId,layer:null==n?void 0:n.layer,textColor:eD,textFont:eR,textFontSize:eT,textWeight:e$,textItalic:eA,onCommit:t=>{n&&n.layerId?(tp(ej,n.layerId,t),ro()):tx(o,ej,ek,eM,ro,{text:t,font:eR,fontSize:eT,fontWeight:e$,fontItalic:eA,textDecoration:eO,textColor:eD,textAlign:eH},{x:e,y:r}),eF(!1);},onCancel:()=>{eF(!1);}});},a=(e,t,r,l,n)=>{let a=n*Math.PI/180,i=Math.cos(a),o=Math.sin(a),s=e-r,c=t-l;return{x:r+s*i-c*o,y:l+s*o+c*i};};if(eb.length>0){for(let t=eb.length-1;t>=0;t--){let i=eb[t],o=i.rect,s=i.rotation||0,c=o.x+o.w/2,d=o.y+o.h/2,u=a(r,l,c,d,-s),h=6/Math.max(1,g);if(!(u.x>=o.x-h&&u.y>=o.y-h&&u.x<=o.x+o.w+h&&u.y<=o.y+o.h+h))continue;let f=8/Math.max(1,g),m={tl:a(o.x,o.y,c,d,s),tr:a(o.x+o.w,o.y,c,d,s),bl:a(o.x,o.y+o.h,c,d,s),br:a(o.x+o.w,o.y+o.h,c,d,s)},x={t:a(o.x+o.w/2,o.y,c,d,s),b:a(o.x+o.w/2,o.y+o.h,c,d,s),l:a(o.x,o.y+o.h/2,c,d,s),r:a(o.x+o.w,o.y+o.h/2,c,d,s)},p=(e,t)=>Math.abs(r-e)<=f&&Math.abs(l-t)<=f,v=p(m.tl.x,m.tl.y),y=p(m.tr.x,m.tr.y),w=p(m.bl.x,m.bl.y),j=p(m.br.x,m.br.y);if("text"===b&&"text"===i.type&&2===e.detail){ek(i.id),eM(!0),n(r,l,i.text||"",{layerId:i.id,layer:i});return;}if("layer"===b||"text"===b&&"text"===i.type){ek(i.id),eM(!0);let t=p(x.t.x,x.t.y),n=p(x.b.x,x.b.y),a=p(x.l.x,x.l.y),s=p(x.r.x,x.r.y);if(t||n||a||s){let e=t?"t":n?"b":a?"l":"r";eX.current={layerId:i.id,handle:e,startX:r,startY:l,orig:{...o}};return;}if(v||y||w||j){if(e.shiftKey){let e=Math.atan2(l-d,r-c);eK.current={layerId:i.id,startX:r,startY:l,centerX:c,centerY:d,startAngle:e,originalRotation:i.rotation||0};return;}let t=v?"tl":y?"tr":w?"bl":"br";eX.current={layerId:i.id,handle:t,startX:r,startY:l,orig:{...o}};return;}eV.current={layerId:i.id,startX:r,startY:l,origX:o.x,origY:o.y};return;}break;}eM(!1);}if("color"===b&&e.altKey&&2===e.button&&j("draw"),("draw"===b||"color"===b)&&e.altKey&&2===e.button){e.preventDefault(),tZ.current=!0,tJ.current=e.clientX,tQ.current=tN;return;}if("pan"===b||"select"===b)y(!0),w.current={x:e.clientX-x.x,y:e.clientY-x.y};else if("crop"===b)G.current={x:r,y:l},V({x:r,y:l,w:1,h:1});else if("ruler"===b){if(ev.current){ev.current.x2=r,ev.current.y2=l;let e=r-ev.current.x1,t=l-ev.current.y1,n=Math.sqrt(e*e+t*t),a=Math.round(n/(o.current.width/(window.devicePixelRatio||1))*96);ew(a),S.default.info(`Distance: ${Math.round(n)} px, estimated DPI: ${a}`),ev.current=null;}else ev.current={x1:r,y1:l,x2:r,y2:l};}else if("perspective"===b){q();let e=Z(r,l);if(e>=0){Y.current[e]=r,Y.current[e+1]=l,ro();return;}let t=Y.current,n=!1;for(let e=0;e<8;e+=2)if(isNaN(t[e])||isNaN(t[e+1])){t[e]=r,t[e+1]=l,n=!0;break;}if(!n){let e=Z(r,l,200);e>=0?(Y.current[e]=r,Y.current[e+1]=l):(Y.current[0]=r,Y.current[1]=l);}ro();}else if("draw"===b)tY(!0),tq.current=[{x:r,y:l}],o.current&&(tS(o.current.getContext("2d"),[{x:r,y:l},{x:r,y:l}],{color:tL,lineWidth:tN,opacity:tU,flow:tG,type:tH}),ro());else if("text"===b){n(r,l,eI||"");return;}},onMouseMove:e=>{if(tZ.current&&null!==tJ.current){let t=e.clientX-tJ.current;tA(Math.max(1,Math.round(10*Math.min(500,tQ.current+t/2))/10)),ro();return;}if(("pan"===b||"select"===b)&&v&&w.current){p({x:e.clientX-w.current.x,y:e.clientY-w.current.y});return;}try{let t=o.current.getBoundingClientRect(),r=(e.clientX-t.left)/g,l=(e.clientY-t.top)/g,n=null,a=(e,t,r,l,n)=>{let a=n*Math.PI/180,i=Math.cos(a),o=Math.sin(a),s=e-r,c=t-l;return{x:r+s*i-c*o,y:l+s*o+c*i};};for(let e=eb.length-1;e>=0;e--){let t=eb[e],i=t.rect,o=t.rotation||0,s=i.x+i.w/2,c=i.y+i.h/2;if(t.locked||"layer"!==b&&"text"!==b){n=null;break;}let d=a(r,l,s,c,-o),u=d.x>=i.x&&d.y>=i.y&&d.x<=i.x+i.w&&d.y<=i.y+i.h,h=8/Math.max(1,g),f={tl:a(i.x,i.y,s,c,o),tr:a(i.x+i.w,i.y,s,c,o),bl:a(i.x,i.y+i.h,s,c,o),br:a(i.x+i.w,i.y+i.h,s,c,o)},m={t:a(i.x+i.w/2,i.y,s,c,o),b:a(i.x+i.w/2,i.y+i.h,s,c,o),l:a(i.x,i.y+i.h/2,s,c,o),r:a(i.x+i.w,i.y+i.h/2,s,c,o)},x=(e,t)=>Math.abs(r-e)<=h&&Math.abs(l-t)<=h;if(x(f.tl.x,f.tl.y)){n="tl";break;}if(x(f.tr.x,f.tr.y)){n="tr";break;}if(x(f.bl.x,f.bl.y)){n="bl";break;}if(x(f.br.x,f.br.y)){n="br";break;}if(x(m.t.x,m.t.y)){n="t";break;}if(x(m.b.x,m.b.y)){n="b";break;}if(x(m.l.x,m.l.y)){n="l";break;}if(x(m.r.x,m.r.y)){n="r";break;}if(u){n="move";break;}}i.current&&(n?"move"===n?i.current.style.cursor="move":"t"===n||"b"===n?i.current.style.cursor="ns-resize":"l"===n||"r"===n?i.current.style.cursor="ew-resize":e.shiftKey&&("tl"===n||"tr"===n||"bl"===n||"br"===n)?i.current.style.cursor="crosshair":"tl"===n||"br"===n?i.current.style.cursor="nwse-resize":i.current.style.cursor="nesw-resize":i.current.style.cursor=rc);}catch(e){}let t=eV.current;if(t){let r=o.current.getBoundingClientRect(),l=(e.clientX-r.left)/g,n=(e.clientY-r.top)/g,a=l-t.startX,i=n-t.startY;ej(e=>e.map(e=>e.id!==t.layerId||e.locked?e:{...e,rect:{x:t.origX+a,y:t.origY+i,w:e.rect.w,h:e.rect.h}})),ro();return;}if("crop"===b&&G.current){let t=o.current.getBoundingClientRect(),r={x:(e.clientX-t.left)/g,y:(e.clientY-t.top)/g};V({x:Math.min(G.current.x,r.x),y:Math.min(G.current.y,r.y),w:Math.abs(r.x-G.current.x),h:Math.abs(r.y-G.current.y)}),ro();}else if("draw"===b&&tK&&o.current){let t=o.current.getBoundingClientRect(),r=(e.clientX-t.left)/g,l=(e.clientY-t.top)/g;tq.current.push({x:r,y:l}),tS(o.current.getContext("2d"),tq.current.slice(-2),{color:tL,lineWidth:tN,opacity:tU,flow:tG,type:tH}),ro();}else{let t=eK.current;if(t){let r=o.current.getBoundingClientRect(),l=(e.clientX-r.left)/g,n=(e.clientY-r.top)/g,{layerId:a,centerX:i,centerY:s,startAngle:c,originalRotation:d}=t,u=180/Math.PI*(Math.atan2(n-s,l-i)-c);ej(e=>e.map(e=>e.id!==a||e.locked?e:{...e,rotation:d+u})),ro();return;}let r=eX.current;if(r){let t=o.current.getBoundingClientRect(),l=(e.clientX-t.left)/g,n=(e.clientY-t.top)/g,{layerId:a,handle:i,startX:s,startY:c,orig:d}=r,u=d.x,h=d.y,f=d.w,m=d.h;if("t"===i?(h=n,m=d.h+(d.y-h)):"b"===i?m=n-d.y:"l"===i?(u=l,f=d.w+(d.x-u)):"r"===i?f=l-d.x:"tl"===i?(u=l,h=n,f=d.w+(d.x-u),m=d.h+(d.y-h)):"tr"===i?(h=n,f=l-d.x,m=d.h+(d.y-h)):"bl"===i?(u=l,f=d.w+(d.x-u),m=n-d.y):"br"===i&&(f=l-d.x,m=n-d.y),e.shiftKey&&("tl"===i||"tr"===i||"bl"===i||"br"===i)){let e=d.w/Math.max(1,d.h),t=f<0?-1:1,r=m<0?-1:1,l=Math.abs(f),n=Math.abs(m);l/Math.max(1,n)>e?m=l/e*r:f=n*e*t,"tl"===i?(u=d.x+(d.w-f),h=d.y+(d.h-m)):"tr"===i?h=d.y+(d.h-m):"bl"===i&&(u=d.x+(d.w-f));}f=Math.max(4/g,f),m=Math.max(4/g,m),ej(e=>e.map(e=>{if(e.id!==a||e.locked)return e;if("text"===e.type){let t=Math.max(8,Math.round(Math.max(1,m)-10));return{...e,rect:{x:u,y:h,w:f,h:m},fontSize:t};}return{...e,rect:{x:u,y:h,w:f,h:m}};})),ro();return;}ro();}},onMouseUp:()=>{if(tZ.current){tZ.current=!1,tJ.current=null,tQ.current=tN;return;}if(eV.current||eX.current||eK.current){eV.current=null,eX.current=null,eK.current=null,ro();return;}y(!1),w.current=null,"crop"===b&&F&&tl(o,s,F,V,h),"draw"===b&&tK&&(tY(!1),h.push(o.current.toDataURL(),"Draw"));}})})]}),(0,a.jsxs)(R.default,{title:"Perspective correction",open:X,onOk:()=>rs(),onCancel:()=>K(!1),okText:"Apply",children:[(0,a.jsx)("p",{children:"Click four points on the image (clockwise) to define the corners, then Apply."}),(0,a.jsx)("p",{style:{marginTop:8},children:"Tip: click a corner again to move it (or click near a point to reposition)."})]}),(0,a.jsx)(tV,{open:ed,onCancel:()=>{eu(!1),ef(null);},onApply:(e,t,r)=>{eh&&(tO(o,eh,e,h,t,r),eu(!1),ef(null));},selectedColor:eh,canvasRef:o}),(0,a.jsx)(t8,{open:eg,onCancel:()=>{em(!1),ep(null);},onApply:e=>{if(!ex)return;let t=eb.find(e=>e.id===ex);if(!t||"image"!==t.type||!t.img){S.default.error("Can only apply mask to image layers");return;}let r=document.createElement("canvas");r.width=e.width,r.height=e.height;let l=r.getContext("2d");l.drawImage(e,0,0);let n=l.getImageData(0,0,r.width,r.height),a=n.data;for(let e=0;e<a.length;e+=4){let t=a[e];a[e+3]=t;}l.putImageData(n,0,0),ej(e=>{let t=e.map(e=>e.id===ex?{...e,mask:r}:e);return tR(s,o,{zoom:g,cropRect:F,rulerPoints:ev.current,perspectivePoints:Y.current,hoverColor:ei,tool:b,drawColor:tL,drawLineWidth:tN,layers:t,overlaySelected:eS,activeLayerId:eC}),t;}),em(!1),ep(null),S.default.success("Mask applied to layer");},sourceCanvas:(()=>{let e=tB();if(!e)return null;let t=document.createElement("canvas");if("image"===e.type&&e.img)t.width=e.img.width,t.height=e.img.height,t.getContext("2d").drawImage(e.img,0,0);else if("text"===e.type){t.width=e.rect.w,t.height=e.rect.h;let r=t.getContext("2d");r.fillStyle="#ffffff",r.fillRect(0,0,t.width,t.height);let l=e.fontItalic?"italic":"normal",n=e.fontWeight||"normal",a=e.fontSize||16;r.font=`${l} ${n} ${a}px ${e.font||"Arial"}`,r.fillStyle=e.textColor||"#000000",r.textAlign=e.textAlign||"left",r.textBaseline="top";let i=(e.text||"").split("\n"),o=1.2*a,s=0;for(let e of i)r.fillText(e,0,s),s+=o;}return t;})(),existingMask:null===(n=tB())||void 0===n?void 0:n.mask})]});},{Title:lx}=b.default,lp=()=>{let[e,t]=(0,I.useState)(null),[r,l]=(0,I.useState)(null),[n,i]=(0,I.useState)(!1),[s,d]=(0,I.useState)(null),h=(0,I.useRef)(0);(0,I.useEffect)(()=>{let e=e=>{var t;let r=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!r)return;let l=Array.from(r).find(e=>e.type.includes("image"));if(l){let t=l.getAsFile();t&&(g(t),S.default.success("Image pasted from clipboard!"),e.preventDefault());}};return window.addEventListener("paste",e),()=>window.removeEventListener("paste",e);},[e]);let g=r=>{let l=new FileReader;return l.onload=l=>{var n;return e?d(r):t(null===(n=l.target)||void 0===n?void 0:n.result);},l.readAsDataURL(r),i(!1),h.current=0,!1;};return(0,a.jsx)(o.default,{setDragging:i,dragCounter:h,handleUpload:g,children:(0,a.jsx)(m.default,{title:(0,a.jsxs)(a.Fragment,{children:["\u{1F5BC}\uFE0F Pics Editor ",(0,a.jsx)(y.default,{color:"cyan",children:"Beta"})]}),variant:"borderless",children:(0,a.jsxs)(p.default,{direction:"vertical",style:{width:"100%"},size:"large",children:[!n&&(0,a.jsx)(C.default,{beforeUpload:g,showUploadList:!1,accept:".png,.jpg,.jpeg",children:(0,a.jsx)(f.default,{icon:(0,a.jsx)(u.default,{}),children:"Upload Image (PNG/JPG)"})}),n&&(0,a.jsx)(c.default,{}),e&&(0,a.jsxs)("div",{children:[(0,a.jsx)(lx,{level:5,children:"Preview & Editor:"}),(0,a.jsx)(lm,{addOnFile:s,setAddOnFile:d,imageUrl:e,onExport:e=>{console.log("exported blob",e);}})]}),(0,a.jsx)(f.default,{onClick:()=>{t(null),l(null),d(null),S.default.info("Image and SVG cleared.");},danger:!0,disabled:!e,children:"Clear Image"})]})})});};}}]);
//# sourceMappingURL=cf77e31b-async.d31e444f.js.map