(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]||[]).push([["ad692153"],{a3ee7ca9:function(e,t,l){l.d(t,"__esModule",{value:!0}),l.e(t,{PhotoEditorProvider:function(){return o;},usePhotoEditor:function(){return c;}});var n=l("852bbaa9"),r=l("95bd365d"),a=l("314fd1a3"),i=n._(a);let s=e=>{let[t,l]=(0,i.useState)([]),[n,r]=(0,i.useState)(-1),[a,s]=(0,i.useState)(!1),d=(0,i.useCallback)(()=>{if(!e||a)return;let i=JSON.stringify(e.toJSON());if(t.length>0&&n>=0&&t[n]===i)return;let s=t.slice(0,n+1);s.push(i),s.length>50&&s.shift(),l(s),r(s.length-1);},[e,t,n,a]);return(0,i.useEffect)(()=>{if(!e)return;let t=()=>{d();};return e.on("object:modified",t),e.on("object:added",t),e.on("object:removed",t),e.on("path:created",t),()=>{e.off("object:modified",t),e.off("object:added",t),e.off("object:removed",t),e.off("path:created",t);};},[e,d]),{saveState:d,undo:(0,i.useCallback)(()=>{if(!e||n<=0||a)return;s(!0);let l=n-1,i=t[l];e.loadFromJSON(JSON.parse(i)).then(()=>{e.renderAll(),r(l),s(!1);});},[e,t,n,a]),redo:(0,i.useCallback)(()=>{if(!e||n>=t.length-1||a)return;s(!0);let l=n+1,i=t[l];e.loadFromJSON(JSON.parse(i)).then(()=>{e.renderAll(),r(l),s(!1);});},[e,t,n,a]),canUndo:n>0,canRedo:n<t.length-1};},d=(0,i.createContext)(void 0),o=({children:e,imageUrl:t,initialProject:l,addOnFile:n,setAddOnFile:a})=>{let[o,c]=(0,i.useState)(null),[u,f]=(0,i.useState)("select"),[h,x]=(0,i.useState)(null),[g,j]=(0,i.useState)(null),m=s(o);return(0,r.jsx)(d.Provider,{value:{canvas:o,setCanvas:c,activeTool:u,setActiveTool:f,selectedObject:h,setSelectedObject:x,history:m,clipboard:g,setClipboard:j,imageUrl:t,initialProject:l,addOnFile:n,setAddOnFile:a},children:e});},c=()=>{let e=(0,i.useContext)(d);if(!e)throw Error("usePhotoEditor must be used within a PhotoEditorProvider");return e;};},fbf56fb0:function(e,t,l){l.d(t,"__esModule",{value:!0}),l.e(t,{default:function(){return tX;}});var n=l("777fffbe"),r=l("852bbaa9"),a=l("95bd365d"),i=l("314fd1a3"),s=r._(i),d=l("26d8ab20"),o=l("bb4b9fac"),c=n._(o),u=l("4c7c6319"),f=n._(u),h=l("2206dff1"),x=n._(h),g=l("94e78bcf"),j=n._(g),m=l("a4f51854"),p=n._(m),v=l("d6f53458"),y=n._(v),w=l("a3ee7ca9"),b=l("0ec3d373"),C=n._(b),S=l("cb204712"),k=n._(S),A=l("5a83e636"),E=n._(A),R=l("67a6fb6d"),D=n._(R),M=l("97c6ca6a"),I=n._(M),O=l("674a8f9a"),B=n._(O),T=l("319d83bc"),P=n._(T),_=l("2ac36d38"),L=n._(_),N={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},F=l("8fb0e3f9"),V=n._(F),z=s.forwardRef(function(e,t){return s.createElement(V.default,(0,L.default)((0,L.default)({},e),{},{ref:t,icon:N}));}),H=l("82f0b5b5"),U=n._(H),W=l("b6114613"),Y=n._(W),K=l("d90c6c6d"),X=n._(K),J=l("13afdc7a"),G=n._(J),q=l("27aee2a8"),Q=n._(q),$=l("2b5b5e7f"),Z=n._($),ee=l("46433e8f"),et=n._(ee),el=l("4f4539af"),en=n._(el),er=l("f4398a75"),ea=n._(er),ei=l("0605432d"),es=n._(ei),ed=l("092feb2c"),eo=n._(ed),ec=s.forwardRef(function(e,t){return s.createElement(V.default,(0,L.default)((0,L.default)({},e),{},{ref:t,icon:eo.default}));}),eu={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},ef=s.forwardRef(function(e,t){return s.createElement(V.default,(0,L.default)((0,L.default)({},e),{},{ref:t,icon:eu}));}),eh=l("5f92d263"),ex=n._(eh),eg=l("3cad22b8"),ej=l("90c13dc1"),em=n._(ej),ep=l("f80e7e46"),ev=n._(ep),ey=l("4f331305"),ew=n._(ey),eb=l("a9a67fa4"),eC=n._(eb),eS=l("0ed998a9"),ek=n._(eS),eA=l("25896c82"),eE=n._(eA);let eR=({visible:e,onCancel:t,canvas:l})=>{let[n,r]=(0,s.useState)("png"),[i,d]=(0,s.useState)(1),[o,c]=(0,s.useState)(1),[u,f]=(0,s.useState)(!0),h=(e,t)=>{let l=document.createElement("a");l.href=URL.createObjectURL(e),l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l);};return(0,a.jsx)(em.default,{title:"Export Image",open:e,onCancel:t,footer:[(0,a.jsx)(C.default,{onClick:t,children:"Cancel"},"cancel"),(0,a.jsx)(C.default,{type:"primary",onClick:()=>{if(l){if("json"===n)h(new Blob([JSON.stringify(l.toJSON())],{type:"application/json"}),"project.json");else if("svg"===n)h(new Blob([l.toSVG()],{type:"image/svg+xml"}),"image.svg");else{let e={format:n,quality:i,multiplier:o},t=null,r=null;if(u){let n=l.getObjects();if(n.length>0){let a=1/0,i=1/0,s=-1/0,d=-1/0;n.forEach(e=>{let t=e.getBoundingRect();t.left<a&&(a=t.left),t.top<i&&(i=t.top),t.left+t.width>s&&(s=t.left+t.width),t.top+t.height>d&&(d=t.top+t.height);}),e={...e,left:a,top:i,width:s-a,height:d-i},t=l.backgroundColor,r=l.backgroundImage,l.backgroundColor=null,l.backgroundImage=null;}}let a=l.toDataURL(e);u&&(l.backgroundColor=t,l.backgroundImage=r);let s=document.createElement("a");s.download=`image.${n}`,s.href=a,document.body.appendChild(s),s.click(),document.body.removeChild(s);}ek.default.success("Export successful"),t();}},children:"Export"},"export")],children:(0,a.jsxs)(ev.default,{layout:"vertical",children:[(0,a.jsx)(ev.default.Item,{label:"Format",children:(0,a.jsxs)(ew.default,{value:n,onChange:e=>r(e),children:[(0,a.jsx)(ew.default.Option,{value:"png",children:"PNG"}),(0,a.jsx)(ew.default.Option,{value:"jpeg",children:"JPEG"}),(0,a.jsx)(ew.default.Option,{value:"svg",children:"SVG"}),(0,a.jsx)(ew.default.Option,{value:"json",children:"JSON (Project)"})]})}),"json"!==n&&"svg"!==n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ev.default.Item,{label:"Quality (0.1 - 1)",children:(0,a.jsx)(eC.default,{min:.1,max:1,step:.1,value:i,onChange:e=>d(e||1),style:{width:"100%"}})}),(0,a.jsx)(ev.default.Item,{label:"Multiplier (Scale)",children:(0,a.jsx)(eC.default,{min:.1,max:5,step:.1,value:o,onChange:e=>c(e||1),style:{width:"100%"}})}),(0,a.jsx)(ev.default.Item,{children:(0,a.jsx)(eE.default,{checked:u,onChange:e=>f(e.target.checked),children:"Trim Whitespace (Export content only)"})})]})]})});};var eD=l("649689e8"),eM=n._(eD),eI=l("c4e93e50"),eO=n._(eI),eB=l("d62d811b"),eT=n._(eB);let eP=(e,t,l)=>{if(0!==t.length){if(e.save(),e.globalAlpha=l.opacity*l.flow,"soft"===l.type?(e.shadowColor=l.color,e.shadowBlur=.5*l.lineWidth,e.lineWidth=.5*l.lineWidth):(e.shadowBlur=0,e.lineWidth=l.lineWidth),e.strokeStyle=l.color,e.fillStyle=l.color,e.lineCap="round",e.lineJoin="round",e.beginPath(),1===t.length)e.arc(t[0].x,t[0].y,e.lineWidth/2,0,2*Math.PI),e.fill();else{e.moveTo(t[0].x,t[0].y);for(let l=1;l<t.length;l++)e.lineTo(t[l].x,t[l].y);e.stroke();}e.restore();}},e_=(e,t,l,n,r,a=1)=>{e.save(),e.strokeStyle=r,e.lineWidth=2/a,e.beginPath(),e.arc(t,l,n/2,0,2*Math.PI),e.stroke(),e.restore();},eL=(e,t,l=1,n={x:0,y:0})=>{if(!t.current)return null;let r=t.current.getBoundingClientRect();return{x:(e.clientX-r.left-n.x)/l,y:(e.clientY-r.top-n.y)/l};},eN=(e,t,l,n=!1,r=0)=>{let a=t.replace("#",""),i=parseInt(a.substring(0,2),16),s=parseInt(a.substring(2,4),16),d=parseInt(a.substring(4,6),16),o=new Uint8Array(e.length/4),c=Math.sqrt(195075),u=l/100,f=r/100;for(let t=0;t<e.length;t+=4){let l;let a=Math.sqrt(Math.pow(e[t]-i,2)+Math.pow(e[t+1]-s,2)+Math.pow(e[t+2]-d,2))/c;if(0===r)l=a<=u?0:1;else{let e=a-u;l=e<-f?0:e>f?1:(e+f)/(2*f);}n&&(l=1-l),o[t/4]=Math.round(255*l);}return o;},eF=(e,t,l)=>{if(!(t instanceof eg.FabricImage))return;let n=t.getElement(),r=n.width,a=n.height,i=document.createElement("canvas");i.width=r,i.height=a;let s=i.getContext("2d");s.drawImage(n,0,0,r,a);let d=s.getImageData(0,0,r,a),o=d.data;l.getContext("2d");let c=document.createElement("canvas");c.width=r,c.height=a;let u=c.getContext("2d");u.drawImage(l,0,0,r,a);let f=u.getImageData(0,0,r,a).data;for(let e=0;e<o.length;e+=4){let t=f[e];o[e+3]=t;}s.putImageData(d,0,0);let h=new eg.FabricImage(i);h.set({left:t.left,top:t.top,scaleX:t.scaleX,scaleY:t.scaleY,angle:t.angle,skewX:t.skewX,skewY:t.skewY,flipX:t.flipX,flipY:t.flipY,originX:t.originX,originY:t.originY,opacity:t.opacity});let x=e.getObjects().indexOf(t);e.remove(t),e.add(h),e.moveObjectTo(h,x),e.setActiveObject(h),e.requestRenderAll();},eV=({open:e,onCancel:t,onApply:l,selectedColor:n,sourceCanvas:r})=>{let[i,d]=(0,s.useState)(30),[o,c]=(0,s.useState)("normal"),[u,f]=(0,s.useState)(!1),[h,x]=(0,s.useState)(0),[g,j]=(0,s.useState)(n||"#000000"),[m,p]=(0,s.useState)(!1);(0,s.useEffect)(()=>{n&&j(n);},[n]),(0,s.useEffect)(()=>{let e=e=>{"Alt"===e.key&&p(!0);},t=e=>{"Alt"===e.key&&p(!1);};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t);};},[]);let[v,y]=(0,s.useState)("remove"),[w,b]=(0,s.useState)(20),[S,k]=(0,s.useState)(1),[A,R]=(0,s.useState)("hard"),[D,M]=(0,s.useState)(!1),[I,O]=(0,s.useState)(null),[B,T]=(0,s.useState)(null),[P,_]=(0,s.useState)({scale:1,x:0,y:0}),L=(0,s.useRef)(null),N=(0,s.useRef)(null),F=(0,s.useRef)(null),V=(0,s.useRef)(null),z=(0,s.useRef)([]),H=(0,s.useRef)(null),[U,W]=(0,s.useState)([]),[Y,K]=(0,s.useState)(-1);(0,s.useEffect)(()=>{if(e&&r&&N.current&&F.current&&V.current&&L.current){let e=r.width,t=r.height,{clientWidth:l,clientHeight:n}=L.current,a=Math.min(l/e,n/t),i=e*a,s=t*a;_({scale:a,x:(l-i)/2,y:(n-s)/2}),N.current.width=e,N.current.height=t,F.current.width=e,F.current.height=t,V.current.width=l,V.current.height=n,N.current.getContext("2d").drawImage(r,0,0);let d=F.current.getContext("2d");d.fillStyle="white",d.fillRect(0,0,e,t),J();}},[e,r]);let J=()=>{if(!F.current)return;let e=F.current.getContext("2d").getImageData(0,0,F.current.width,F.current.height),t=U.slice(0,Y+1);t.push(e),W(t),K(t.length-1);},q=()=>{if(!r||!N.current||!F.current)return;let e=r.width,t=r.height,l=N.current.getContext("2d"),n=F.current.getContext("2d");l.clearRect(0,0,e,t),l.drawImage(r,0,0);let a=l.getImageData(0,0,e,t),s=eN(a.data,g,i,u,h),d=n.getImageData(0,0,e,t),c=l.createImageData(e,t);for(let l=0;l<e*t;l++){let e=a.data[4*l],t=a.data[4*l+1],n=a.data[4*l+2],r=a.data[4*l+3],i=s[l]/255*r*(d.data[4*l]/255);c.data[4*l]=e,c.data[4*l+1]=t,c.data[4*l+2]=n,c.data[4*l+3]=i;}if("mask"===o)for(let l=0;l<e*t;l++){let e=c.data[4*l+3];c.data[4*l]=e,c.data[4*l+1]=e,c.data[4*l+2]=e,c.data[4*l+3]=255;}l.putImageData(c,0,0);};(0,s.useEffect)(()=>{q();},[i,u,h,g,o,Y]);let Q=e=>{if(!r||!V.current)return;let t=eL(e,V,P.scale,{x:P.x,y:P.y});if(t){let e=r.getContext("2d");if(!e)return;let l=Math.max(0,Math.min(t.x,r.width-1)),n=Math.max(0,Math.min(t.y,r.height-1)),a=e.getImageData(l,n,1,1).data;j("#"+[a[0],a[1],a[2]].map(e=>e.toString(16).padStart(2,"0")).join(""));}},$=()=>{D&&(M(!1),z.current=[],H.current=null,J(),q());},Z=e=>{F.current&&(eP(F.current.getContext("2d"),e,{color:"remove"===v?"#000000":"#ffffff",lineWidth:w,opacity:S,flow:1,type:A}),q());};return(0,s.useEffect)(()=>{if(!V.current||!I)return;let e=V.current.getContext("2d");e.clearRect(0,0,V.current.width,V.current.height);let t=I.x*P.scale+P.x,l=I.y*P.scale+P.y,n=w*P.scale;if(e_(e,t,l,n,"#fff"),e_(e,t,l,n,"#000"),m&&B){let n=Math.min(V.current.width-9-4,Math.max(13,t+12)),r=Math.min(V.current.height-9-4,Math.max(13,l+12));e.beginPath(),e.arc(n,r,11,0,2*Math.PI),e.fillStyle="#00000088",e.fill(),e.beginPath(),e.arc(n,r,9,0,2*Math.PI),e.fillStyle=B,e.fill(),e.font="12px sans-serif",e.fillStyle="#fff",e.textAlign="center",e.fillText(B.toUpperCase(),n,r+9+14);}},[I,w,P,m,B]),(0,a.jsx)(em.default,{title:"Mask",open:e,onCancel:t,onOk:()=>{N.current&&l(N.current);},width:1e3,style:{top:20},maskClosable:!1,children:(0,a.jsxs)("div",{style:{display:"flex",gap:16},children:[(0,a.jsx)("div",{style:{width:300},children:(0,a.jsxs)(E.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"Target Color:"}),(0,a.jsx)(eT.default,{value:g,onChange:e=>j(e.toHexString()),showText:!0}),(0,a.jsx)("div",{style:{fontSize:12,color:"#999",marginTop:4},children:"Hold Alt + Click on image to pick color"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{children:["Tolerance: ",i,"%"]}),(0,a.jsx)(eM.default,{value:i,onChange:d})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{children:["Feather: ",h,"%"]}),(0,a.jsx)(eM.default,{value:h,onChange:x})]}),(0,a.jsx)("div",{children:(0,a.jsxs)(E.default,{children:[(0,a.jsx)("span",{children:"Invert:"}),(0,a.jsx)(C.default,{onClick:()=>f(!u),type:u?"primary":"default",children:u?"Yes":"No"})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"Preview Mode:"}),(0,a.jsxs)(eO.default.Group,{value:o,onChange:e=>c(e.target.value),children:[(0,a.jsx)(eO.default.Button,{value:"normal",children:"Normal"}),(0,a.jsx)(eO.default.Button,{value:"mask",children:"Mask"})]})]}),(0,a.jsxs)("div",{style:{borderTop:"1px solid #eee",paddingTop:16,marginTop:16},children:[(0,a.jsx)("h4",{children:"Manual Adjustments"}),(0,a.jsxs)(E.default,{children:[(0,a.jsx)(C.default,{type:"remove"===v?"primary":"default",onClick:()=>y("remove"),children:"Remove"}),(0,a.jsx)(C.default,{type:"keep"===v?"primary":"default",onClick:()=>y("keep"),children:"Keep"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{children:["Size: ",w]}),(0,a.jsx)(eM.default,{min:1,max:100,value:w,onChange:b})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{children:["Opacity: ",S]}),(0,a.jsx)(eM.default,{min:0,max:1,step:.1,value:S,onChange:k})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"Hardness:"}),(0,a.jsxs)(eO.default.Group,{value:A,onChange:e=>R(e.target.value),children:[(0,a.jsx)(eO.default.Button,{value:"hard",children:"Hard"}),(0,a.jsx)(eO.default.Button,{value:"soft",children:"Soft"})]})]})]}),(0,a.jsxs)(E.default,{children:[(0,a.jsx)(C.default,{icon:(0,a.jsx)(X.default,{}),onClick:()=>{if(Y>0){let e=Y-1,t=U[e];F.current.getContext("2d").putImageData(t,0,0),K(e),q();}},disabled:Y<=0}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(G.default,{}),onClick:()=>{if(Y<U.length-1){let e=Y+1,t=U[e];F.current.getContext("2d").putImageData(t,0,0),K(e),q();}},disabled:Y>=U.length-1})]})]})}),(0,a.jsxs)("div",{ref:L,style:{flex:1,position:"relative",border:"1px solid #ccc",height:500,overflow:"hidden",background:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==)"},children:[(0,a.jsx)("canvas",{ref:N,style:{position:"absolute",top:P.y,left:P.x,width:P.scale*((null==r?void 0:r.width)||0),height:P.scale*((null==r?void 0:r.height)||0)}}),(0,a.jsx)("canvas",{ref:V,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",cursor:m?"crosshair":"none"},onMouseDown:e=>{if(m){Q(e);return;}M(!0);let t=eL(e,V,P.scale,{x:P.x,y:P.y});t&&(z.current=[t],H.current=t,Z([t]));},onMouseMove:e=>{let t=eL(e,V,P.scale,{x:P.x,y:P.y});if(O(t),m&&t&&r)try{let e=r.getContext("2d");if(e){let l=Math.max(0,Math.min(t.x,r.width-1)),n=Math.max(0,Math.min(t.y,r.height-1)),a=e.getImageData(l,n,1,1).data,i="#"+[a[0],a[1],a[2]].map(e=>e.toString(16).padStart(2,"0")).join("");T(i);}}catch(e){T(null);}else T(null);!m&&D&&t&&H.current&&(z.current.push(t),Z([H.current,t]),H.current=t);},onMouseUp:$,onMouseLeave:$}),(0,a.jsx)("canvas",{ref:F,style:{display:"none"}})]})]})});};var ez=l("06b66aab"),eH=n._(ez),eU=l("9cfcaa09"),eW=n._(eU),eY=l("68091597"),eK=n._(eY),eX=l("522a0302"),eJ=n._(eX),eG=l("30963339"),eq=n._(eG);let eQ=({projects:e,onLoad:t,onDelete:l})=>0===e.length?(0,a.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,a.jsx)(eJ.default.Text,{type:"secondary",children:"No saved projects found."})}):(0,a.jsx)(eH.default,{grid:{gutter:16,column:3},dataSource:e,renderItem:e=>(0,a.jsx)(eH.default.Item,{children:(0,a.jsx)(c.default,{hoverable:!0,cover:(0,a.jsx)("div",{style:{height:150,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f0f0f0"},children:(0,a.jsx)(eK.default,{src:e.thumbnail,preview:!1,style:{maxHeight:"100%",maxWidth:"100%",objectFit:"contain"}})}),actions:[(0,a.jsx)(C.default,{type:"text",icon:(0,a.jsx)(ec,{}),onClick:()=>t(e),children:"Load"}),(0,a.jsx)(eW.default,{title:"Delete project?",onConfirm:()=>l(e.id),okText:"Yes",cancelText:"No",children:(0,a.jsx)(C.default,{type:"text",danger:!0,icon:(0,a.jsx)(eq.default,{}),children:"Delete"})})],children:(0,a.jsx)(c.default.Meta,{title:e.name,description:new Date(e.updatedAt).toLocaleString()})})})}),e$=({visible:e,onCancel:t,projects:l,onLoad:n,onDelete:r})=>(0,a.jsx)(em.default,{title:"Saved Projects",open:e,onCancel:t,footer:null,width:800,children:(0,a.jsx)(eQ,{projects:l,onLoad:n,onDelete:r})}),eZ="projects",e0=()=>new Promise((e,t)=>{let l=indexedDB.open("PhotoEditorDB",1);l.onerror=()=>{t("Error opening database");},l.onsuccess=t=>{e(t.target.result);},l.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(eZ)||t.createObjectStore(eZ,{keyPath:"id"});};}),e1=async e=>{let t=await e0();return new Promise((l,n)=>{let r=t.transaction([eZ],"readwrite").objectStore(eZ).put(e);r.onsuccess=()=>l(),r.onerror=()=>n("Error saving project");});},e2=async()=>{let e=await e0();return new Promise((t,l)=>{let n=e.transaction([eZ],"readonly").objectStore(eZ).getAll();n.onsuccess=()=>{let e=n.result;e.sort((e,t)=>t.updatedAt-e.updatedAt),t(e);},n.onerror=()=>l("Error fetching projects");});},e4=async e=>{let t=await e0();return new Promise((l,n)=>{let r=t.transaction([eZ],"readwrite").objectStore(eZ).delete(e);r.onsuccess=()=>l(),r.onerror=()=>n("Error deleting project");});},e6=()=>{let[e,t]=(0,s.useState)([]),[l,n]=(0,s.useState)(null),r=(0,s.useCallback)(()=>{e2().then(t).catch(e=>console.error("Failed to load projects from DB",e));},[]);(0,s.useEffect)(()=>{r();},[r]);let a=(0,s.useCallback)(async(e,r)=>{if(!e)return;let a={id:(null==l?void 0:l.id)||Date.now().toString(),name:(null==l?void 0:l.name)||`Project ${new Date().toLocaleString()}`,thumbnail:e,json:r,createdAt:(null==l?void 0:l.createdAt)||Date.now(),updatedAt:Date.now()};try{await e1(a),t(e=>(e.some(e=>e.id===a.id)?e.map(e=>e.id===a.id?a:e):[a,...e]).sort((e,t)=>t.updatedAt-e.updatedAt)),n(a),ek.default.success("Project saved successfully!");}catch(e){console.error(e),ek.default.error("Failed to save project");}},[l]);return{savedProjects:e,currentProject:l,loadProjects:r,saveProject:a,deleteProject:(0,s.useCallback)(async e=>{try{await e4(e),t(t=>t.filter(t=>t.id!==e)),ek.default.success("Project deleted");}catch(e){console.error(e),ek.default.error("Failed to delete project");}},[]),loadProjectIntoEditor:(0,s.useCallback)(e=>{n(e);},[]),clearCurrentProject:(0,s.useCallback)(()=>{n(null);},[]),setCurrentProject:n};},e3=()=>{let{canvas:e,setActiveTool:t,activeTool:l,history:n,selectedObject:r,clipboard:i,setClipboard:d}=(0,w.usePhotoEditor)(),[o,c]=(0,s.useState)(!1),[u,f]=(0,s.useState)(!1),[h,x]=(0,s.useState)(!1),{savedProjects:g,saveProject:m,deleteProject:p,loadProjects:v}=e6(),y=()=>{if(!e)return;let t=e.toJSON();m(e.toDataURL({format:"png",multiplier:.5}),t);},b=async()=>{if(!e)return;let t=e.getActiveObject();t&&d(await t.clone());},S=async()=>{if(!e||!i)return;let t=await i.clone();e.discardActiveObject(),t.set({left:(t.left||0)+10,top:(t.top||0)+10,evented:!0}),t instanceof eg.ActiveSelection?(t.canvas=e,t.forEachObject(t=>{e.add(t);}),t.setCoords()):e.add(t),e.setActiveObject(t),e.requestRenderAll(),n.saveState();};(0,s.useEffect)(()=>{let l=l=>{"INPUT"!==l.target.tagName&&"TEXTAREA"!==l.target.tagName&&((null==e?void 0:e.getActiveObject())instanceof eg.IText&&e.getActiveObject().isEditing||(("v"===l.key||"V"===l.key)&&t("select"),("b"===l.key||"B"===l.key)&&t("brush"),("m"===l.key||"M"===l.key)&&r instanceof eg.FabricImage&&f(!0),("r"===l.key||"R"===l.key)&&A(),("t"===l.key||"T"===l.key)&&t("text"),("Delete"===l.key||"Backspace"===l.key)&&R(),(l.ctrlKey||l.metaKey)&&"z"===l.key&&(l.preventDefault(),l.shiftKey?n.redo():n.undo()),(l.ctrlKey||l.metaKey)&&"y"===l.key&&(l.preventDefault(),n.redo()),(l.ctrlKey||l.metaKey)&&"c"===l.key&&(l.preventDefault(),b()),(l.ctrlKey||l.metaKey)&&"v"===l.key&&(l.preventDefault(),S()),(l.ctrlKey||l.metaKey)&&"s"===l.key&&(l.preventDefault(),y()),(l.ctrlKey||l.metaKey)&&l.shiftKey&&"S"===l.key&&(l.preventDefault(),c(!0))));};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l);},[e,r,n,l,i]);let A=()=>{if(!e)return;let t=new eg.Rect({left:100,top:100,fill:"#ff0000",width:100,height:100});e.add(t),e.setActiveObject(t),n.saveState();},R=()=>{if(!e)return;let t=e.getActiveObjects();t.length&&(e.discardActiveObject(),t.forEach(t=>{e.remove(t);}),n.saveState());},M=r instanceof eg.FabricImage;return(0,a.jsxs)(E.default,{direction:"vertical",style:{padding:"8px"},children:[(0,a.jsx)(k.default,{title:"Select (V)",children:(0,a.jsx)(C.default,{type:"select"===l?"primary":"default",icon:(0,a.jsx)(B.default,{}),onClick:()=>t("select")})}),(0,a.jsx)(k.default,{title:"Brush (B)",children:(0,a.jsx)(C.default,{type:"brush"===l?"primary":"default",icon:(0,a.jsx)(Q.default,{}),onClick:()=>t("brush")})}),(0,a.jsx)(k.default,{title:"Rectangle (R)",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(P.default,{}),onClick:A})}),(0,a.jsx)(k.default,{title:"Circle (C)",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(z,{}),onClick:()=>{if(!e)return;let t=new eg.Circle({left:100,top:100,fill:"#00ff00",radius:50});e.add(t),e.setActiveObject(t),n.saveState();}})}),(0,a.jsx)(k.default,{title:"Text (T)",children:(0,a.jsx)(C.default,{type:"text"===l?"primary":"default",icon:(0,a.jsx)(U.default,{}),onClick:()=>t("text")})}),(0,a.jsx)("input",{type:"file",id:"image-upload",hidden:!0,accept:"image/*",onChange:t=>{if(!e||!t.target.files||!t.target.files[0])return;let l=t.target.files[0],r=new FileReader;r.onload=t=>{var l;let r=null===(l=t.target)||void 0===l?void 0:l.result;eg.FabricImage.fromURL(r).then(t=>{t.scaleToWidth(200),e.add(t),e.centerObject(t),e.setActiveObject(t),n.saveState();});},r.readAsDataURL(l);}}),(0,a.jsx)("input",{type:"file",id:"project-import",hidden:!0,accept:"application/json, .json",onChange:t=>{if(!e)return;let l=t.target.files&&t.target.files[0];if(!l)return;let r=new FileReader;r.onload=t=>{try{var l;let r=null===(l=t.target)||void 0===l?void 0:l.result,a=JSON.parse(r);e.loadFromJSON(a,()=>{e.renderAll(),n.saveState();});}catch(e){console.error("Failed to import project JSON",e),alert("Failed to import project file. Make sure it is a valid project JSON.");}},r.readAsText(l),t.currentTarget.value="";}}),(0,a.jsx)(j.default,{style:{margin:"8px 0"}}),(0,a.jsx)(k.default,{title:"Mask (M)",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(et.default,{}),onClick:()=>f(!0),disabled:!M})}),(0,a.jsx)(j.default,{style:{margin:"8px 0"}}),(0,a.jsx)(k.default,{title:"Undo (Ctrl+Z)",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(X.default,{}),onClick:n.undo,disabled:!n.canUndo})}),(0,a.jsx)(k.default,{title:"Redo (Ctrl+Y)",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(G.default,{}),onClick:n.redo,disabled:!n.canRedo})}),(0,a.jsx)(j.default,{style:{margin:"8px 0"}}),(0,a.jsx)(D.default,{overlay:(0,a.jsxs)(I.default,{children:[(0,a.jsx)(I.default.Item,{icon:(0,a.jsx)(Y.default,{}),onClick:()=>{var e;return null===(e=document.getElementById("image-upload"))||void 0===e?void 0:e.click();},children:"Upload Image"},"upload"),(0,a.jsx)(I.default.Item,{icon:(0,a.jsx)(en.default,{}),onClick:b,disabled:!r,children:"Copy (Ctrl + C)"},"copy"),(0,a.jsx)(I.default.Item,{icon:(0,a.jsx)(ea.default,{}),onClick:S,disabled:!i,children:"Paste (Ctrl + V)"},"paste"),(0,a.jsx)(I.default.Divider,{}),(0,a.jsx)(I.default.Item,{icon:(0,a.jsx)(es.default,{}),onClick:y,children:"Save Project (Ctrl + S)"},"save"),(0,a.jsx)(I.default.Item,{icon:(0,a.jsx)(ec,{}),onClick:()=>x(!0),children:"Open Projects"},"open"),(0,a.jsx)(I.default.Item,{icon:(0,a.jsx)(ex.default,{}),onClick:()=>{var e;return null===(e=document.getElementById("project-import"))||void 0===e?void 0:e.click();},children:"Import Project (JSON)"},"import"),(0,a.jsx)(I.default.Item,{icon:(0,a.jsx)(Z.default,{}),onClick:()=>c(!0),children:"Export (Ctrl + Shift + S)"},"export")]}),trigger:["click"],children:(0,a.jsx)(k.default,{title:"More",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(ef,{})})})}),(0,a.jsx)(eR,{visible:o,onCancel:()=>c(!1),canvas:e}),u&&M&&(0,a.jsx)(eV,{open:u,onCancel:()=>f(!1),onApply:t=>{e&&r&&(eF(e,r,t),n.saveState(),f(!1));},sourceCanvas:(()=>{if(!r||!(r instanceof eg.FabricImage))return null;let e=r.getElement(),t=document.createElement("canvas");t.width=e.width,t.height=e.height;let l=t.getContext("2d");return l&&l.drawImage(e,0,0),t;})(),selectedColor:null}),(0,a.jsx)(e$,{visible:h,onCancel:()=>x(!1),projects:g,onLoad:t=>{e&&e.loadFromJSON(t.json).then(()=>{e.renderAll(),x(!1),n.saveState();});},onDelete:p})]});},e8=e=>{let t=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!e)return;let l=async l=>{if((l.ctrlKey||l.metaKey)&&"c"===l.key){let l=e.getActiveObject();if(l){let e=await l.clone();t.current=e;}}if((l.ctrlKey||l.metaKey)&&"v"===l.key&&t.current){let l=await t.current.clone();e.discardActiveObject(),l.set({left:(l.left||0)+10,top:(l.top||0)+10,evented:!0}),"activeSelection"===l.type?(l.canvas=e,l.forEachObject(t=>{e.add(t);}),l.setCoords()):e.add(l),t.current=l,e.setActiveObject(l),e.requestRenderAll();}e.isDrawingMode&&e.freeDrawingBrush&&("["===l.key?e.freeDrawingBrush.width=Math.max(1,e.freeDrawingBrush.width-5):"]"===l.key&&(e.freeDrawingBrush.width+=5));};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l);};},[e]);},e5=()=>{let e=(0,s.useRef)(null),t=(0,s.useRef)(null),{canvas:l,setCanvas:n,selectedObject:r,setSelectedObject:i,history:d,imageUrl:o,initialProject:c,activeTool:u,addOnFile:f,setAddOnFile:h,setActiveTool:x}=(0,w.usePhotoEditor)(),g=(0,s.useRef)(!1);e8(l);let j=(0,s.useRef)(!1),m=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!l||!f)return;let e=new FileReader;e.onload=e=>{var t;let n=null===(t=e.target)||void 0===t?void 0:t.result;eg.Image.fromURL(n).then(e=>{e.scaleToWidth(200),l.add(e),l.centerObject(e),l.setActiveObject(e),d.saveState(),h&&h(null);});},e.readAsDataURL(f);},[f,l]),(0,s.useEffect)(()=>{if(!l||!t.current)return;let e=t.current,n=l.lowerCanvasEl||null,r=document.createElement("div");r.style.position="absolute",r.style.pointerEvents="none",r.style.width="28px",r.style.height="28px",r.style.borderRadius="50%",r.style.boxShadow="0 0 4px rgba(0,0,0,0.5)",r.style.border="2px solid #fff",r.style.transform="translate(-50%, -50%)",r.style.display="none",e.appendChild(r),m.current=r;let a=e=>{"Alt"===e.key&&(j.current=!0,"brush"===u&&(l.isDrawingMode=!1));},i=e=>{"Alt"===e.key&&(j.current=!1,"brush"===u&&(l.isDrawingMode=!0),m.current&&(m.current.style.display="none"));},s=t=>{if(j.current&&"brush"===u)try{let r=t&&t.e,a=l.getPointer(r);if(!n)return;let i=n.getContext("2d");if(!i)return;let s=Math.floor(a.x),d=Math.floor(a.y);if(s<0||d<0||s>=n.width||d>=n.height){m.current&&(m.current.style.display="none");return;}let o=i.getImageData(s,d,1,1).data,c="#"+[o[0],o[1],o[2]].map(e=>e.toString(16).padStart(2,"0")).join("");if(m.current){m.current.style.background=c,m.current.style.display="block";let t=e.getBoundingClientRect(),l=r.clientX||t.left+a.x,n=r.clientY||t.top+a.y;m.current.style.left=l-t.left+24+"px",m.current.style.top=n-t.top+24+"px";}}catch(e){m.current&&(m.current.style.display="none");}},d=e=>{if(j.current&&"brush"===u)try{let t=e&&e.e,r=l.getPointer(t);if(!n)return;let a=n.getContext("2d");if(!a)return;let i=Math.floor(r.x),s=Math.floor(r.y);if(i<0||s<0||i>=n.width||s>=n.height)return;let d=a.getImageData(i,s,1,1).data,o="#"+[d[0],d[1],d[2]].map(e=>e.toString(16).padStart(2,"0")).join("");l.freeDrawingBrush&&(l.freeDrawingBrush.color=o);}catch(e){}};return window.addEventListener("keydown",a),window.addEventListener("keyup",i),l.on("mouse:move",s),l.on("mouse:down",d),()=>{if(window.removeEventListener("keydown",a),window.removeEventListener("keyup",i),l.off("mouse:move",s),l.off("mouse:down",d),m.current){try{e.removeChild(m.current);}catch(e){}m.current=null;}};},[l,u]),(0,s.useEffect)(()=>{if(!e.current||!t.current)return;let l=new eg.Canvas(e.current,{width:t.current.clientWidth,height:t.current.clientHeight,backgroundColor:"#ffffff",preserveObjectStacking:!0,selection:!0});n(l),c?l.loadFromJSON(c.json).then(()=>{l.renderAll(),d.saveState();}):o&&eg.Image.fromURL(o).then(e=>{let n=t.current.clientWidth,r=t.current.clientHeight;(e.width>n||e.height>r)&&e.scaleToWidth(.8*n),l.add(e),l.centerObject(e),l.setActiveObject(e),d.saveState();});let r=()=>{let e=l.getActiveObjects();1===e.length?i(e[0]):i(null);};l.on("selection:created",r),l.on("selection:updated",r),l.on("selection:cleared",()=>i(null)),l.on("text:editing:entered",()=>x&&x("text")),l.on("text:editing:exited",()=>x&&x("select"));let a=()=>{d.saveState();};l.on("object:modified",a),l.on("object:added",a),l.on("object:removed",a);let s=()=>{t.current&&l.setDimensions({width:t.current.clientWidth,height:t.current.clientHeight});};return window.addEventListener("resize",s),()=>{l.dispose(),window.removeEventListener("resize",s);};},[]),(0,s.useEffect)(()=>{if(r)try{let e=!!r.isEditing;g.current=e,e&&x&&x("text");}catch(e){}},[r,x]),(0,s.useEffect)(()=>{l&&("brush"===u?(l.isDrawingMode=!0,l.freeDrawingBrush=new eg.PencilBrush(l),l.freeDrawingBrush.width=5,l.freeDrawingBrush.color="black"):l.isDrawingMode=!1);},[u,l]),(0,s.useEffect)(()=>{if(!l||"text"!==u)return;let e=e=>{try{if(g.current)return;let t=l.getViewportPoint(e.e),n=new eg.IText("Text",{left:t.x,top:t.y,fontSize:24});l.add(n),l.setActiveObject(n),i&&i(n),n.enterEditing&&n.enterEditing(),n.selectAll&&n.selectAll(),l.requestRenderAll(),d.saveState(),x&&x("select");}catch(e){}};return l.on("mouse:down",e),()=>{l.off("mouse:down",e);};},[l,u,d,i,x]),(0,a.jsx)("div",{ref:t,style:{width:"100%",height:"100%"},children:(0,a.jsx)("canvas",{ref:e})});};var e7=l("307d4d2d"),e9=n._(e7),te=l("fff4acbb"),tt=n._(te),tl=l("7a7f784d"),tn=n._(tl),tr=l("a7018c48"),ta=n._(tr),ti=l("b79df40c"),ts=n._(ti),td=l("f1931921"),to=l("32ef4833"),tc=l("dd7f7981");let{Title:tu}=eJ.default,{Option:tf}=ew.default,th=({id:e,children:t,isSelected:l,onClick:n})=>{let{attributes:r,listeners:i,setNodeRef:s,setActivatorNodeRef:d,transform:o,transition:c}=(0,to.useSortable)({id:e}),u={transform:tc.CSS.Transform.toString(o),transition:c,backgroundColor:l?"#e6f7ff":"transparent",marginBottom:4,border:"1px solid #f0f0f0",borderRadius:4,padding:"4px 8px",display:"flex",alignItems:"center"};return(0,a.jsxs)("div",{ref:s,style:u,children:[(0,a.jsx)("div",{ref:d,...r,...i,style:{cursor:"grab",marginRight:8,display:"flex",alignItems:"center",color:"#999"},children:(0,a.jsx)(ts.default,{})}),(0,a.jsx)("div",{onClick:n,style:{flex:1,cursor:"pointer"},children:t})]});},tx=()=>{let{canvas:e,selectedObject:t,setSelectedObject:l,history:n}=(0,w.usePhotoEditor)(),[r,i]=(0,s.useState)([]),d=(0,td.useSensors)((0,td.useSensor)(td.PointerSensor),(0,td.useSensor)(td.KeyboardSensor,{coordinateGetter:to.sortableKeyboardCoordinates})),o=()=>{if(!e)return;let t=e.getObjects();t.forEach(e=>{e.uid||(e.uid=Math.random().toString(36).substr(2,9));}),i([...t].reverse());};(0,s.useEffect)(()=>{let t;if(!e)return;let l=()=>{clearTimeout(t),t=setTimeout(o,100);};return e.on("object:added",l),e.on("object:removed",l),e.on("object:modified",l),o(),()=>{e.off("object:added",l),e.off("object:removed",l),e.off("object:modified",l),clearTimeout(t);};},[e]);let c=(t,l)=>{l.stopPropagation(),t.visible=!t.visible,t.visible||null==e||e.discardActiveObject(),null==e||e.requestRenderAll(),n.saveState(),i([...(null==e?void 0:e.getObjects())||[]].reverse());},u=(t,l)=>{l.stopPropagation(),t.lockMovementX=!t.lockMovementX,t.lockMovementY=!t.lockMovementY,t.lockRotation=!t.lockRotation,t.lockScalingX=!t.lockScalingX,t.lockScalingY=!t.lockScalingY,t.selectable=!t.lockMovementX,t.selectable||null==e||e.discardActiveObject(),null==e||e.requestRenderAll(),n.saveState(),i([...(null==e?void 0:e.getObjects())||[]].reverse());},f=t=>{e&&t.visible&&t.selectable&&(e.setActiveObject(t),e.requestRenderAll());},h=(t,l)=>{l.stopPropagation(),null==e||e.remove(t),null==e||e.requestRenderAll(),n.saveState();};return(0,a.jsxs)("div",{style:{padding:10},children:[(0,a.jsx)(tu,{level:5,children:"Layers"}),t&&(0,a.jsxs)("div",{style:{marginBottom:16,padding:8,background:"#fafafa",borderRadius:4},children:[(0,a.jsxs)("div",{style:{marginBottom:8},children:[(0,a.jsxs)("span",{style:{fontSize:12},children:["Opacity: ",Math.round(100*(t.opacity||1)),"%"]}),(0,a.jsx)(eM.default,{min:0,max:1,step:.01,value:t.opacity??1,onChange:l=>{e&&t&&(t.set("opacity",l),e.requestRenderAll());},onAfterChange:()=>{n.saveState();}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{style:{fontSize:12},children:"Blend Mode:"}),(0,a.jsxs)(ew.default,{size:"small",style:{width:"100%"},value:t.globalCompositeOperation||"source-over",onChange:l=>{e&&t&&(t.set("globalCompositeOperation",l),e.requestRenderAll(),n.saveState());},children:[(0,a.jsx)(tf,{value:"source-over",children:"Normal"}),(0,a.jsx)(tf,{value:"multiply",children:"Multiply"}),(0,a.jsx)(tf,{value:"screen",children:"Screen"}),(0,a.jsx)(tf,{value:"overlay",children:"Overlay"}),(0,a.jsx)(tf,{value:"darken",children:"Darken"}),(0,a.jsx)(tf,{value:"lighten",children:"Lighten"}),(0,a.jsx)(tf,{value:"color-dodge",children:"Color Dodge"}),(0,a.jsx)(tf,{value:"color-burn",children:"Color Burn"}),(0,a.jsx)(tf,{value:"hard-light",children:"Hard Light"}),(0,a.jsx)(tf,{value:"soft-light",children:"Soft Light"}),(0,a.jsx)(tf,{value:"difference",children:"Difference"}),(0,a.jsx)(tf,{value:"exclusion",children:"Exclusion"}),(0,a.jsx)(tf,{value:"hue",children:"Hue"}),(0,a.jsx)(tf,{value:"saturation",children:"Saturation"}),(0,a.jsx)(tf,{value:"color",children:"Color"}),(0,a.jsx)(tf,{value:"luminosity",children:"Luminosity"})]})]})]}),(0,a.jsx)(td.DndContext,{sensors:d,collisionDetection:td.closestCenter,onDragEnd:t=>{let{active:l,over:a}=t;if(a&&l.id!==a.id){let t=r.findIndex(e=>e.uid===l.id),i=r.findIndex(e=>e.uid===a.id);if(-1!==t&&-1!==i){let l=r.length-1-i,a=r[t];null==e||e.moveObjectTo(a,l),null==e||e.requestRenderAll(),n.saveState(),o();}}},children:(0,a.jsx)(to.SortableContext,{items:r.map(e=>e.uid),strategy:to.verticalListSortingStrategy,children:(0,a.jsx)("div",{style:{overflowY:"auto",border:"1px solid #d9d9d9",borderRadius:4,padding:4},children:r.map((e,l)=>{let n=t===e,i=e.type||"Object",s=e.name||`${i} ${r.length-l}`;return(0,a.jsx)(th,{id:e.uid,isSelected:n,onClick:()=>f(e),children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},children:[(0,a.jsx)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:120},children:s}),(0,a.jsxs)(E.default,{size:4,children:[(0,a.jsx)(C.default,{type:"text",size:"small",icon:e.visible?(0,a.jsx)(e9.default,{}):(0,a.jsx)(tt.default,{}),onClick:t=>c(e,t),onMouseDown:e=>e.stopPropagation()}),(0,a.jsx)(C.default,{type:"text",size:"small",icon:e.lockMovementX?(0,a.jsx)(tn.default,{}):(0,a.jsx)(ta.default,{}),onClick:t=>u(e,t),onMouseDown:e=>e.stopPropagation()}),(0,a.jsx)(C.default,{type:"text",size:"small",danger:!0,icon:(0,a.jsx)(eq.default,{}),onClick:t=>h(e,t),onMouseDown:e=>e.stopPropagation()})]})]})},e.uid);})})})})]});};var tg=l("00798b85"),tj=n._(tg);let{Panel:tm}=tj.default,tp=[{name:"Grayscale",filter:eg.filters.Grayscale,index:9},{name:"Invert",filter:eg.filters.Invert,index:10},{name:"Sepia",filter:eg.filters.Sepia,index:11},{name:"Black&White",filter:eg.filters.BlackWhite,index:12},{name:"Brownie",filter:eg.filters.Brownie,index:13},{name:"Vintage",filter:eg.filters.Vintage,index:14},{name:"Kodachrome",filter:eg.filters.Kodachrome,index:15},{name:"Technicolor",filter:eg.filters.Technicolor,index:16},{name:"Polaroid",filter:eg.filters.Polaroid,index:17}],tv=({name:e,filterClass:t,originalImage:l,isActive:n,onClick:r})=>{let i=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!l||!i.current)return;let e=i.current,n=e.getContext("2d");if(!n)return;e.width=60,e.height=60;let r=new eg.FabricImage(l),a=60/Math.max(r.width||1,r.height||1);r.scale(a);let s=new t;r.filters=[s],r.applyFilters();let d=r.getElement();n.clearRect(0,0,60,60);let o=(r.width||0)*(r.scaleX||1),c=(r.height||0)*(r.scaleY||1);n.drawImage(d,(60-o)/2,(60-c)/2,o,c);},[l,t]),(0,a.jsxs)("div",{onClick:r,style:{cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[(0,a.jsx)("div",{style:{width:64,height:64,border:n?"2px solid #1890ff":"1px solid #f0f0f0",borderRadius:4,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f5f5f5"},children:(0,a.jsx)("canvas",{ref:i})}),(0,a.jsx)(eJ.default.Text,{style:{fontSize:10,textAlign:"center",lineHeight:1.2},children:e})]});},ty=()=>{let{canvas:e,selectedObject:t,history:l}=(0,w.usePhotoEditor)(),[n,r]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(t&&t.isType("image")){let e=t.getSrc(),l=new Image;l.crossOrigin="anonymous",l.src=e,l.onload=()=>{r(l);};}else r(null);},[t]);let i=(l,n)=>{t&&t.isType("image")&&(t.filters[l]=n,t.applyFilters(),null==e||e.requestRenderAll());},d=(e,t,n)=>{i(e,!!n&&new t),l.saveState();};return t&&t.isType("image")?(0,a.jsxs)("div",{style:{padding:10,height:"100%",overflowY:"auto"},children:[(0,a.jsx)(eJ.default.Title,{level:5,children:"Adjustments"}),(0,a.jsxs)(tj.default,{defaultActiveKey:["1","2","3"],ghost:!0,children:[(0,a.jsx)(tm,{header:"Basic",children:(0,a.jsxs)(E.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(eJ.default.Text,{children:"Brightness"}),(0,a.jsx)(eM.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:e=>{i(0,new eg.filters.Brightness({brightness:e}));},onAfterChange:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eJ.default.Text,{children:"Contrast"}),(0,a.jsx)(eM.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:e=>{i(1,new eg.filters.Contrast({contrast:e}));},onAfterChange:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eJ.default.Text,{children:"Saturation"}),(0,a.jsx)(eM.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:e=>{i(2,new eg.filters.Saturation({saturation:e}));},onAfterChange:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eJ.default.Text,{children:"Vibrance"}),(0,a.jsx)(eM.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:e=>{i(7,new eg.filters.Vibrance({vibrance:e}));},onAfterChange:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eJ.default.Text,{children:"Gamma"}),(0,a.jsx)(eM.default,{min:.1,max:2.2,step:.1,defaultValue:1,onChange:e=>{i(6,new eg.filters.Gamma({gamma:[e,e,e]}));},onAfterChange:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eJ.default.Text,{children:"Hue Rotation"}),(0,a.jsx)(eM.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:e=>{i(8,new eg.filters.HueRotation({rotation:e}));},onAfterChange:()=>l.saveState()})]})]})},"1"),(0,a.jsx)(tm,{header:"Effects",children:(0,a.jsxs)(E.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(eJ.default.Text,{children:"Blur"}),(0,a.jsx)(eM.default,{min:0,max:1,step:.01,defaultValue:0,onChange:e=>{i(5,new eg.filters.Blur({blur:e}));},onAfterChange:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eJ.default.Text,{children:"Noise"}),(0,a.jsx)(eM.default,{min:0,max:1e3,defaultValue:0,onChange:e=>{i(3,new eg.filters.Noise({noise:e}));},onAfterChange:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eJ.default.Text,{children:"Pixelate"}),(0,a.jsx)(eM.default,{min:1,max:20,defaultValue:1,onChange:e=>{i(4,e>1&&new eg.filters.Pixelate({blocksize:e}));},onAfterChange:()=>l.saveState()})]})]})},"2"),(0,a.jsx)(tm,{header:"Filters",children:(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12},children:tp.map(e=>{var l;let r=!!(null==t?void 0:null===(l=t.filters)||void 0===l?void 0:l[e.index]);return(0,a.jsx)(tv,{name:e.name,filterClass:e.filter,originalImage:n,isActive:r,onClick:()=>d(e.index,e.filter,!r)},e.name);})})},"3")]})]}):(0,a.jsx)("div",{style:{padding:10},children:"Select an image to adjust"});},tw=()=>{let{canvas:e}=(0,w.usePhotoEditor)(),[t,l]=(0,s.useState)("#000000"),[n,r]=(0,s.useState)(5),[i,d]=(0,s.useState)(0),[o,c]=(0,s.useState)("Pencil"),u=(0,s.useRef)(!1),f=(0,s.useRef)(null),h=(0,s.useRef)(n),x=(0,s.useRef)(!1),g=(0,s.useRef)(null),j=(0,s.useRef)(i);return(0,s.useEffect)(()=>{if(!e)return;e.freeDrawingBrush||(e.freeDrawingBrush=new eg.PencilBrush(e));let l=e.freeDrawingBrush;l.color=t,l.width=n,i>0?l.shadow=new eg.Shadow({blur:i,color:t}):l.shadow=null;},[e,t,n,i]),(0,a.jsxs)("div",{style:{padding:10},children:[(0,a.jsx)(eJ.default.Title,{level:5,children:"Brush Settings"}),(0,a.jsxs)(E.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(eJ.default.Text,{children:"Type"}),(0,a.jsxs)(ew.default,{value:o,style:{width:"100%"},onChange:l=>{let r;if(e){switch(c(l),l){case"Circle":r=new eg.CircleBrush(e);break;case"Spray":r=new eg.SprayBrush(e);break;default:r=new eg.PencilBrush(e);}r.color=t,r.width=n,i>0&&(r.shadow=new eg.Shadow({blur:i,color:t})),e.freeDrawingBrush=r;}},children:[(0,a.jsx)(ew.default.Option,{value:"Pencil",children:"Pencil"}),(0,a.jsx)(ew.default.Option,{value:"Circle",children:"Circle"}),(0,a.jsx)(ew.default.Option,{value:"Spray",children:"Spray"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eJ.default.Text,{children:"Color"}),(0,a.jsx)("br",{}),(0,a.jsx)(eT.default,{value:t,onChange:e=>l(e.toHexString()),showText:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eJ.default.Text,{onMouseDown:e=>{if(0!==e.button)return;e.preventDefault(),u.current=!0,f.current=e.clientX,h.current=n;let t=document.body.style.userSelect;document.body.style.userSelect="none";let l=e=>{if(!u.current||null===f.current)return;let t=e.clientX-f.current;r(Number(Math.max(1,Math.min(2e3,h.current+.2*t)).toFixed(0)));},a=()=>{u.current=!1,f.current=null,document.body.style.userSelect=t,window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",a);};window.addEventListener("mousemove",l),window.addEventListener("mouseup",a);},style:{cursor:"ew-resize",userSelect:"none"},children:"Width"}),(0,a.jsx)("br",{}),(0,a.jsx)("input",{type:"number",min:1,max:2e3,value:n,onChange:e=>r(Number(e.target.value||1)),style:{width:"100%"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eJ.default.Text,{onMouseDown:e=>{if(0!==e.button)return;e.preventDefault(),x.current=!0,g.current=e.clientX,j.current=i;let t=document.body.style.userSelect;document.body.style.userSelect="none";let l=e=>{if(!x.current||null===g.current)return;let t=e.clientX-g.current;d(Number(Math.max(0,Math.min(200,j.current+.2*t)).toFixed(0)));},n=()=>{x.current=!1,g.current=null,document.body.style.userSelect=t,window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",n);};window.addEventListener("mousemove",l),window.addEventListener("mouseup",n);},style:{cursor:"ew-resize",userSelect:"none"},children:"Shadow Blur"}),(0,a.jsx)("br",{}),(0,a.jsx)("input",{type:"number",min:0,max:500,value:i,onChange:e=>d(Number(e.target.value||0)),style:{width:"100%"}})]})]})]});};var tb={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M697.8 481.4c33.6-35 54.2-82.3 54.2-134.3v-10.2C752 229.3 663.9 142 555.3 142H259.4c-15.1 0-27.4 12.3-27.4 27.4v679.1c0 16.3 13.2 29.5 29.5 29.5h318.7c117 0 211.8-94.2 211.8-210.5v-11c0-73-37.4-137.3-94.2-175.1zM328 238h224.7c57.1 0 103.3 44.4 103.3 99.3v9.5c0 54.8-46.3 99.3-103.3 99.3H328V238zm366.6 429.4c0 62.9-51.7 113.9-115.5 113.9H328V542.7h251.1c63.8 0 115.5 51 115.5 113.9v10.8z"}}]},name:"bold",theme:"outlined"},tC=s.forwardRef(function(e,t){return s.createElement(V.default,(0,L.default)((0,L.default)({},e),{},{ref:t,icon:tb}));}),tS=l("96102293"),tk=n._(tS),tA={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M824 804H200c-4.4 0-8 3.4-8 7.6v60.8c0 4.2 3.6 7.6 8 7.6h624c4.4 0 8-3.4 8-7.6v-60.8c0-4.2-3.6-7.6-8-7.6zm-312-76c69.4 0 134.6-27.1 183.8-76.2C745 602.7 772 537.4 772 468V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 97-79 176-176 176s-176-79-176-176V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 69.4 27.1 134.6 76.2 183.8C377.3 701 442.6 728 512 728z"}}]},name:"underline",theme:"outlined"},tE=s.forwardRef(function(e,t){return s.createElement(V.default,(0,L.default)((0,L.default)({},e),{},{ref:t,icon:tA}));}),tR=l("21b4a197"),tD=n._(tR),tM=l("1ffcd493"),tI=n._(tM),tO=l("37a7e6a1"),tB=n._(tO);let tT=["Arial","Helvetica","Times New Roman","Georgia","Courier New","Verdana"],tP=()=>{let{canvas:e,selectedObject:t,history:l,setActiveTool:n}=(0,w.usePhotoEditor)(),[r,i]=(0,s.useState)("Arial"),[d,o]=(0,s.useState)(24),[c,u]=(0,s.useState)(!1),[f,h]=(0,s.useState)(!1),[x,g]=(0,s.useState)(!1),[m,p]=(0,s.useState)("left"),[v,y]=(0,s.useState)("#000000");(0,s.useEffect)(()=>{t&&"i-text"===t.isType&&(i(t.fontFamily||"Arial"),o(t.fontSize||24),u("bold"===t.fontWeight||700===t.fontWeight),h("italic"===t.fontStyle),g(t.underline||!1),p(t.textAlign||"left"),y(t.fill||"#000000"));},[t]);let b=(n,r=!0)=>{t&&(t.set(n),t.setCoords&&t.setCoords(),e&&e.requestRenderAll(),r&&l&&l.saveState());};return(0,a.jsxs)("div",{style:{padding:12},children:[(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsx)("strong",{children:"Font"})}),(0,a.jsxs)(E.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsx)(ew.default,{value:r,onChange:e=>{i(e),b({fontFamily:e});},children:tT.map(e=>(0,a.jsx)(ew.default.Option,{value:e,children:e},e))}),(0,a.jsx)(eC.default,{min:8,max:200,value:d,onChange:e=>{o(e||24),b({fontSize:e||24});},style:{width:"100%"}}),(0,a.jsx)("div",{children:(0,a.jsxs)(E.default,{children:[(0,a.jsx)(C.default,{icon:(0,a.jsx)(tC,{}),type:c?"primary":"default",onClick:()=>{let e=!c;u(e),b({fontWeight:e?"bold":"normal"});}}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(tk.default,{}),type:f?"primary":"default",onClick:()=>{let e=!f;h(e),b({fontStyle:e?"italic":"normal"});}}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(tE,{}),type:x?"primary":"default",onClick:()=>{let e=!x;g(e),b({underline:e});}})]})}),(0,a.jsx)(j.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Horizontal Align (textAlign)"}),(0,a.jsx)("div",{style:{marginTop:8},children:(0,a.jsxs)(E.default,{children:[(0,a.jsx)(C.default,{icon:(0,a.jsx)(tD.default,{}),type:"left"===m?"primary":"default",onClick:()=>{p("left"),b({textAlign:"left"});}}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(tI.default,{}),type:"center"===m?"primary":"default",onClick:()=>{p("center"),b({textAlign:"center"});}}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(tB.default,{}),type:"right"===m?"primary":"default",onClick:()=>{p("right"),b({textAlign:"right"});}})]})})]}),(0,a.jsx)(j.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Color"}),(0,a.jsx)("div",{style:{marginTop:8},children:(0,a.jsx)(eT.default,{value:v,onChange:e=>{let l=e.toHexString();y(l),b({fill:l});try{(null==t?void 0:t.isEditing)&&n&&n("text");}catch(e){}},showText:!0})})]})]})]});},t_=()=>{let{canvas:e,selectedObject:t,history:l}=(0,w.usePhotoEditor)(),n=()=>{if(!e)return null;let t=e.getObjects();if(!t||0===t.length)return null;let l=t[0];try{return l.getBoundingRect();}catch(e){return null;}},r=n=>{t&&(t.set(n),t.setCoords&&t.setCoords(),e&&e.requestRenderAll(),l&&l.saveState());},i=l=>{if(!e||!t)return;let a=n();if(!a)return;let i=t.getBoundingRect(),s=t.left||0;"left"===l?s=a.left:"center"===l?s=a.left+(a.width-i.width)/2:"right"===l&&(s=a.left+a.width-i.width),r({left:s});},s=l=>{if(!e||!t)return;let a=n();if(!a)return;let i=t.getBoundingRect(),s=t.top||0;"top"===l?s=a.top:"middle"===l?s=a.top+(a.height-i.height)/2:"bottom"===l&&(s=a.top+a.height-i.height),r({top:s});};return(0,a.jsxs)("div",{style:{padding:12},children:[(0,a.jsx)("div",{style:{marginBottom:6},children:(0,a.jsx)("strong",{children:"Align to First Layer"})}),(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsxs)(E.default,{children:[(0,a.jsx)(C.default,{onClick:()=>i("left"),children:"H: Left"}),(0,a.jsx)(C.default,{onClick:()=>i("center"),children:"H: Center"}),(0,a.jsx)(C.default,{onClick:()=>i("right"),children:"H: Right"})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)(E.default,{children:[(0,a.jsx)(C.default,{onClick:()=>s("top"),children:"V: Top"}),(0,a.jsx)(C.default,{onClick:()=>s("middle"),children:"V: Middle"}),(0,a.jsx)(C.default,{onClick:()=>s("bottom"),children:"V: Bottom"})]})})]});},tL=()=>{let{activeTool:e,selectedObject:t}=(0,w.usePhotoEditor)();return"brush"===e?(0,a.jsx)(tw,{}):"text"===e?(0,a.jsx)(tP,{}):t&&"i-text"===t.isType?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tP,{}),(0,a.jsx)(t_,{})]}):t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ty,{}),(0,a.jsx)(t_,{})]}):(0,a.jsx)(ty,{});};var tN=l("e0fc3175"),tF=n._(tN),tV=l("dcbd67b9"),tz=n._(tV);let tH=({onUpload:e})=>(0,a.jsxs)(tF.default.Dragger,{beforeUpload:e,showUploadList:!1,accept:".png,.jpg,.jpeg",height:200,children:[(0,a.jsx)("p",{className:"ant-upload-drag-icon",children:(0,a.jsx)(tz.default,{})}),(0,a.jsx)("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),(0,a.jsx)("p",{className:"ant-upload-hint",children:"Support for a single upload. You can also paste an image from clipboard."})]}),tU=()=>{let[e,t]=(0,s.useState)(null),[l,n]=(0,s.useState)(null),[r,a]=(0,s.useState)(null),[i,d]=(0,s.useState)(!1),o=(0,s.useRef)(0),c=(0,s.useCallback)(l=>{let r=new FileReader;return r.onload=r=>{if(e)a(l);else{var i;t(null===(i=r.target)||void 0===i?void 0:i.result),n(null);}},r.readAsDataURL(l),d(!1),o.current=0,!1;},[e]),u=(0,s.useCallback)(e=>{n(e),t(e.thumbnail);},[]),f=(0,s.useCallback)(()=>{t(null),a(null),n(null),ek.default.info("Image cleared.");},[]);return(0,s.useEffect)(()=>{let e=e=>{var t;let l=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!l)return;let n=Array.from(l).find(e=>e.type.includes("image"));if(n){let t=n.getAsFile();t&&(c(t),ek.default.success("Image pasted from clipboard!"),e.preventDefault());}};return window.addEventListener("paste",e),()=>window.removeEventListener("paste",e);},[c]),{preview:e,setPreview:t,addOnFile:r,setAddOnFile:a,dragging:i,setDragging:d,dragCounter:o,handleUpload:c,handleClear:f,loadProject:u,initialProject:l};};var tW={propertiesSider:"propertiesSider-heiVp6pb",toolbarSider:"toolbarSider-du7VhC79",editorContainer:"editorContainer-d13_yHC3",canvasContent:"canvasContent-Dy5SW4-T"};let{Sider:tY,Content:tK}=f.default,tX=()=>{let{preview:e,dragging:t,setDragging:l,dragCounter:n,handleUpload:r,addOnFile:i,setAddOnFile:s,loadProject:o,initialProject:u}=tU(),{savedProjects:h,deleteProject:g}=e6();return(0,a.jsx)(d.PageContainer,{title:(0,a.jsxs)("span",{children:["Photo Editor ",(0,a.jsx)(x.default,{color:"cyan",children:"Beta"})]}),children:(0,a.jsx)(p.default,{setDragging:l,dragCounter:n,handleUpload:r,children:(0,a.jsxs)(c.default,{className:tW.editorContainer,bodyStyle:{padding:0,height:"100%"},children:[t&&(0,a.jsx)(y.default,{}),e?(0,a.jsx)(w.PhotoEditorProvider,{imageUrl:e,initialProject:u,addOnFile:i,setAddOnFile:s,children:(0,a.jsxs)(f.default,{style:{height:"100%"},children:[(0,a.jsx)(tY,{theme:"light",width:60,className:tW.toolbarSider,children:(0,a.jsx)(e3,{})}),(0,a.jsx)(tK,{className:tW.canvasContent,children:(0,a.jsx)(e5,{})}),(0,a.jsxs)(tY,{theme:"light",width:300,className:tW.propertiesSider,children:[(0,a.jsx)(tL,{}),(0,a.jsx)(tx,{})]})]})}):(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%",padding:"20px",overflowY:"auto"},children:[(0,a.jsx)(tH,{onUpload:r}),h.length>0&&(0,a.jsxs)("div",{style:{width:"100%",maxWidth:"800px",marginTop:"40px"},children:[(0,a.jsx)(j.default,{children:"Or Open Saved Project"}),(0,a.jsx)(eQ,{projects:h,onLoad:o,onDelete:g})]})]})]})})});};}}]);
//# sourceMappingURL=ad692153-async.a75054b3.js.map