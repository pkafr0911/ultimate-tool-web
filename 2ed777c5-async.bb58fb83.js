(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]||[]).push([["2ed777c5"],{f0e8d3d2:function(e,t,r){r.d(t,"__esModule",{value:!0}),r.e(t,{default:function(){return eY;}});var l=r("777fffbe"),n=r("852bbaa9"),a=r("1a7c85b4"),i=r("13dfe186"),s=l._(i),d=r("85d53cee"),o=l._(d),c=r("47ffc2fb"),u=r("1ee4d6ad"),h=l._(u),f=r("07d5c3d6"),g=l._(f),x=r("d2d0b3b6"),m=l._(x),p=r("d322be42"),j=n._(p),w={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"}}]},name:"info-circle",theme:"outlined"},v=r("85c4e0d9"),y=l._(v),C=j.forwardRef(function(e,t){return j.createElement(y.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:w}));}),b=r("f6ee8121"),k=l._(b),R=j.forwardRef(function(e,t){return j.createElement(y.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:k.default}));}),S=r("70bd2056"),M=l._(S),B=r("b2a1469e"),I=l._(B),L=r("e9bcd22d"),E=l._(L),D=r("2aa4d12e"),_=l._(D),P=r("ea21718c"),U=l._(P),z=r("6caefff4"),T=l._(z),G=r("92be0fc5"),V=l._(G),$=r("e23084de"),A=l._($),H=r("d4a32650"),K=l._(H),N=r("6effc0fd"),W=l._(N),X=r("34f06567"),F=l._(X),O=r("c9d8dc0b"),Y=l._(O),Z=r("a1e53af5"),q=l._(Z),J=r("dfa4ac87"),Q=l._(J),ee=r("3eb6f542"),et=l._(ee),er=r("452a6b49"),el=l._(er),en=r("54c1db7a"),ea=l._(en);function ei(e,t){let r=document.createElement("canvas");return r.width=e,r.height=t,r;}function es(e,t,r){let l=e.width,n=e.height,a=e.data,i=new Uint8ClampedArray(a.length),s=Math.floor(r/2);for(let e=0;e<n;e++)for(let d=0;d<l;d++){let o=0,c=0,u=0,h=0;for(let i=0;i<r;i++)for(let f=0;f<r;f++){let g=d+f-s,x=e+i-s;if(g<0||g>=l||x<0||x>=n)continue;let m=(x*l+g)*4,p=t[i*r+f];o+=a[m]*p,c+=a[m+1]*p,u+=a[m+2]*p,h+=a[m+3]*p;}let f=(e*l+d)*4;i[f]=Math.min(255,Math.max(0,o)),i[f+1]=Math.min(255,Math.max(0,c)),i[f+2]=Math.min(255,Math.max(0,u)),i[f+3]=Math.min(255,Math.max(0,h||a[f+3]));}return e.data.set(i),e;}let ed={sharpen:[0,-1,0,-1,5,-1,0,-1,0],blur3:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],gaussian5:[1/273,4/273,7/273,4/273,1/273,4/273,16/273,26/273,16/273,4/273,7/273,26/273,41/273,26/273,7/273,4/273,16/273,26/273,16/273,4/273,1/273,4/273,7/273,4/273,1/273],generateBoxBlurKernel(e){let t=0|e,r=t*t;return Array(r).fill(1/r);},generateGaussianKernel(e){let t=0|e,r=t/2,l=2*r*r,n=[],a=0;for(let e=-t;e<=t;e++)for(let r=-t;r<=t;r++){let t=Math.exp(-(r*r+e*e)/l);n.push(t),a+=t;}return n.map(e=>e/a);}};function eo(e,t="image/png",r=.92){return new Promise(l=>e.toBlob(e=>l(e),t,r));}let ec=(e,t,r,l)=>{if(!t.current)return;let n=t.current,a=ei(n.width,n.height);a.getContext("2d").drawImage(n,0,0);let i=ei(n.height,n.width),s=i.getContext("2d");s.translate(i.width/2,i.height/2),s.rotate(e*Math.PI/180),s.drawImage(a,-a.width/2,-a.height/2),t.current.width=i.width,t.current.height=i.height,r.current.width=i.width,r.current.height=i.height;let d=t.current.getContext("2d");d.clearRect(0,0,i.width,i.height),d.drawImage(i,0,0),l.push(t.current.toDataURL(),`Rotate ${e}`);},eu=async(e=!1,t,r)=>{if(!t.current)return;let l=await eo(t.current,e?"image/jpeg":"image/png",.92);r&&r(l);let n=URL.createObjectURL(l),a=document.createElement("a");a.href=n,a.download=e?"edited.jpg":"edited.png",a.click(),URL.revokeObjectURL(n),Y.default.success("Exported image");},eh=async e=>{if(e.current)try{let t=await eo(e.current,"image/png");await navigator.clipboard.write([new ClipboardItem({"image/png":t})]),Y.default.success("Image copied to clipboard");}catch(e){console.warn("clipboard failed",e),Y.default.error("Copy failed (browser may not support)");}},ef=(e,t)=>{if(!e.current)return;let r=e.current.getContext("2d"),l=ei(e.current.width,e.current.height);l.getContext("2d").drawImage(e.current,0,0),r.save(),r.clearRect(0,0,e.current.width,e.current.height),r.scale(-1,1),r.drawImage(l,-e.current.width,0),r.restore(),t.push(e.current.toDataURL(),"Flip horizontal");},eg=(e,t)=>{if(!e.current)return;let r=e.current.getContext("2d"),l=ei(e.current.width,e.current.height);l.getContext("2d").drawImage(e.current,0,0),r.save(),r.clearRect(0,0,e.current.width,e.current.height),r.scale(1,-1),r.drawImage(l,0,-e.current.height),r.restore(),t.push(e.current.toDataURL(),"Flip vertical");},ex=(e,t,r,l,n)=>{if(!e.current||!r)return;let a=ei(Math.max(1,Math.round(r.w)),Math.max(1,Math.round(r.h)));a.getContext("2d").drawImage(e.current,r.x,r.y,r.w,r.h,0,0,r.w,r.h),e.current.width=a.width,e.current.height=a.height,t.current.width=a.width,t.current.height=a.height;let i=e.current.getContext("2d");i.clearRect(0,0,a.width,a.height),i.drawImage(a,0,0),l(null),n.push(e.current.toDataURL(),"Cropped");},em=(e,t,r)=>{let l=t.current;if(!l)return null;let n=l.getBoundingClientRect(),a=Math.floor((e.clientX-n.left)/r),i=Math.floor((e.clientY-n.top)/r);if(a<0||i<0||a>=l.width||i>=l.height)return null;let s=l.getContext("2d",{willReadFrequently:!0});if(!s)return null;let d=s.getImageData(a,i,1,1).data;return`#${[d[0],d[1],d[2]].map(e=>e.toString(16).padStart(2,"0")).join("")}`;},ep={blur:0,gaussian:0,sharpen:0,bgThreshold:0,bgThresholdBlack:0,brightness:0,contrast:0},ej=null,ew=(e,t,{blur:r=0,gaussian:l=0,sharpen:n=0,bgThreshold:a=0,bgThresholdBlack:i=0,brightness:s=0,contrast:d=0},o)=>{if(!e.current||!t)return;let c=e.current.getContext("2d"),u=t.getContext("2d");if(ej||(ej=u.getImageData(0,0,t.width,t.height)),!ej)return;let h=function(e){let t=new ImageData(e.width,e.height);return t.data.set(new Uint8ClampedArray(e.data)),t;}(ej);if(0===r&&0===l&&0===n&&0===a&&0===i&&0===s&&0===d){c.putImageData(h,0,0);return;}if(r>0){let e=r%2==0?r+1:r;es(h,ed.generateBoxBlurKernel(e),e);}l>0&&es(h,ed.generateGaussianKernel(l),2*l+1),n>0&&es(h,ed.sharpen.map(e=>5===e?1+4*n:-1===e?-n:e),3),a<255&&function(e,t=255){let r=e.data;for(let e=0;e<r.length;e+=4)r[e]>t&&r[e+1]>t&&r[e+2]>t&&(r[e+3]=0);}(h,a),i>0&&function(e,t=0){let r=e.data;for(let e=0;e<r.length;e+=4)r[e]<t&&r[e+1]<t&&r[e+2]<t&&(r[e+3]=0);}(h,i),(0!==s||0!==d)&&function(e,t=0,r=0){let l=e.data,n=r/100+1,a=128*(1-n);for(let e=0;e<l.length;e+=4)l[e]=Math.min(255,Math.max(0,l[e]*n+a+t)),l[e+1]=Math.min(255,Math.max(0,l[e+1]*n+a+t)),l[e+2]=Math.min(255,Math.max(0,l[e+2]*n+a+t));}(h,s,d),c.putImageData(h,0,0);let f=Object.entries({blur:r,gaussian:l,sharpen:n,bgThreshold:a,bgThresholdBlack:i,brightness:s,contrast:d}).filter(([e,t])=>ep[e]!==t);if(0===f.length)return;let g=f.map(([e,t])=>`${e}=${t}`).join(", ");o.push(e.current.toDataURL(),`Effects: ${g}`),ep={blur:r,gaussian:l,sharpen:n,bgThreshold:a,bgThresholdBlack:i,brightness:s,contrast:d};},ev=({canvasRef:e,overlayRef:t,containerRef:r,offset:l,zoom:n,tool:i,currentCursor:s,hoverColor:d,onMouseDown:o,onMouseMove:c,onMouseUp:u})=>(0,a.jsxs)("div",{ref:r,onMouseDown:o,onMouseMove:c,onMouseUp:u,style:{width:"100%",height:"100vh",overflow:"hidden",border:"1px solid #eee",position:"relative",background:"#fafafa",cursor:s},children:[(0,a.jsx)("canvas",{ref:e,style:{transform:`translate(${l.x}px, ${l.y}px) scale(${n})`,transformOrigin:"top left",display:"block"}}),(0,a.jsx)("canvas",{ref:t,style:{position:"absolute",left:0,top:0,pointerEvents:"none",transform:`translate(${l.x}px, ${l.y}px) scale(${n})`,transformOrigin:"top left"}}),d&&"color"===i&&(0,a.jsxs)("div",{style:{position:"fixed",left:d.x+12,top:d.y+12,background:"#fff",padding:"4px 8px",borderRadius:4,boxShadow:"0 0 6px rgba(0,0,0,0.2)",fontSize:12,zIndex:999999,pointerEvents:"none",display:"flex",alignItems:"center",gap:6},children:[(0,a.jsx)("span",{style:{display:"inline-block",width:12,height:12,background:d.color,border:"1px solid #ccc"}}),d.color]})]});var ey=r("1353d6cc"),eC=l._(ey),eb=r("8e6ac0a6"),ek=l._(eb),eR=r("97125d22"),eS=l._(eR),eM=r("34f8e1c9"),eB=l._(eM),eI=r("076b2e3c"),eL=l._(eI),eE=r("047b2dca"),eD=l._(eE),e_=j.forwardRef(function(e,t){return j.createElement(y.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:eD.default}));}),eP=r("3dfab21c"),eU=l._(eP),ez=r("376b0022"),eT=l._(ez),eG={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M567.1 512l318.5-319.3c5-5 1.5-13.7-5.6-13.7h-90.5c-2.1 0-4.2.8-5.6 2.3l-273.3 274-90.2-90.5c12.5-22.1 19.7-47.6 19.7-74.8 0-83.9-68.1-152-152-152s-152 68.1-152 152 68.1 152 152 152c27.7 0 53.6-7.4 75.9-20.3l90 90.3-90.1 90.3A151.04 151.04 0 00288 582c-83.9 0-152 68.1-152 152s68.1 152 152 152 152-68.1 152-152c0-27.2-7.2-52.7-19.7-74.8l90.2-90.5 273.3 274c1.5 1.5 3.5 2.3 5.6 2.3H880c7.1 0 10.7-8.6 5.6-13.7L567.1 512zM288 370c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80zm0 444c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}}]},name:"scissor",theme:"outlined"},eV=j.forwardRef(function(e,t){return j.createElement(y.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:eG}));}),e$={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},eA=j.forwardRef(function(e,t){return j.createElement(y.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:e$}));}),eH=r("5af7999d"),eK=l._(eH);let eN=({canvasRef:e,baseCanvas:t,history:r,drawColor:l,setDrawColor:n,drawLineWidth:i,setDrawLineWidth:s,setTool:d,brightness:o,setBrightness:c,contrast:u,setContrast:f,blur:g,setBlur:x,gaussian:m,setGaussian:p,sharpen:j,setSharpen:w,bgThreshold:v,setBgThreshold:y,bgThresholdBlack:C,setBgThresholdBlack:b,setShowPerspectiveModal:k,dpiMeasured:R,setDpiMeasured:S,exportImage:M,onExport:B,overlayRef:L})=>(0,a.jsx)("div",{style:{width:260},children:(0,a.jsxs)(U.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)(U.default,{wrap:!0,children:[(0,a.jsx)(K.default,{title:"Undo (Ctrl+Z)",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(eB.default,{}),onClick:r.undo})}),(0,a.jsx)(K.default,{title:"Redo (Ctrl+Shift+Z)",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(eL.default,{}),onClick:r.redo})}),(0,a.jsx)(K.default,{title:"Rotate left",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(e_,{}),onClick:()=>ec(-90,e,L,r)})}),(0,a.jsx)(K.default,{title:"Rotate right",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(eU.default,{}),onClick:()=>ec(90,e,L,r)})}),(0,a.jsx)(K.default,{title:"Flip horizontal",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(eT.default,{}),onClick:()=>ef(e,r)})}),(0,a.jsx)(K.default,{title:"Flip vertical",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(eT.default,{rotate:90}),onClick:()=>eg(e,r)})})]}),(0,a.jsx)(eC.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{marginBottom:8},children:["Brush Tool"," ",(0,a.jsx)(I.default,{size:"small",onClick:()=>d("draw"),children:(0,a.jsx)(eK.default,{})})]}),(0,a.jsxs)(U.default,{children:[(0,a.jsx)(eS.default,{value:l,onChange:e=>n(e.toHexString()),allowClear:!1,showText:!0}),(0,a.jsx)(_.default,{min:1,max:50,value:i,onChange:e=>s(e||1),style:{width:60}})]})]}),(0,a.jsx)(eC.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:"Brightness"}),(0,a.jsx)(ek.default,{min:-150,max:150,value:o,onChange:c,onChangeComplete:()=>ew(e,t,{blur:g,gaussian:m,sharpen:j,bgThreshold:v,bgThresholdBlack:C,brightness:o,contrast:u},r)}),(0,a.jsx)("div",{style:{marginBottom:8},children:"Contrast"}),(0,a.jsx)(ek.default,{min:-100,max:100,value:u,onChange:f,onChangeComplete:()=>ew(e,t,{blur:g,gaussian:m,sharpen:j,bgThreshold:v,bgThresholdBlack:C,brightness:o,contrast:u},r)})]}),(0,a.jsx)(eC.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:"Box Blur"}),(0,a.jsx)(ek.default,{min:0,max:25,value:g,onChange:x,onChangeComplete:l=>ew(e,t,{blur:g,gaussian:m,sharpen:j,bgThreshold:v},r)}),(0,a.jsx)("div",{style:{marginBottom:8},children:"Gaussian Blur"}),(0,a.jsx)(ek.default,{min:0,max:20,value:m,onChange:p,onChangeComplete:l=>ew(e,t,{blur:g,gaussian:m,sharpen:j,bgThreshold:v,bgThresholdBlack:C,brightness:o,contrast:u},r)}),(0,a.jsx)("div",{style:{marginBottom:8},children:"Sharpen"}),(0,a.jsx)(ek.default,{min:0,max:5,value:j,onChange:w,onChangeComplete:l=>ew(e,t,{blur:g,gaussian:m,sharpen:j,bgThreshold:v,bgThresholdBlack:C,brightness:o,contrast:u},r)}),(0,a.jsx)(eC.default,{}),(0,a.jsx)("div",{style:{marginBottom:8},children:"Background Threshold "}),(0,a.jsx)("div",{children:"Remove white "}),(0,a.jsx)(ek.default,{min:0,max:255,value:v,onChange:y,onChangeComplete:l=>ew(e,t,{blur:g,gaussian:m,sharpen:j,bgThreshold:v,bgThresholdBlack:C,brightness:o,contrast:u},r)}),(0,a.jsx)("div",{children:"Remove black "}),(0,a.jsx)(ek.default,{min:0,max:255,value:C,onChange:b,onChangeComplete:l=>ew(e,t,{blur:g,gaussian:m,sharpen:j,bgThreshold:v,bgThresholdBlack:C,brightness:o,contrast:u},r)})]}),(0,a.jsx)(eC.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:"Crop & Perspective"}),(0,a.jsxs)(U.default,{children:[(0,a.jsx)(I.default,{icon:(0,a.jsx)(eV,{}),onClick:()=>d("crop"),children:"Crop (C)"}),(0,a.jsx)(I.default,{onClick:()=>{k(!0),d("perspective");},children:"Perspective"})]})]}),(0,a.jsx)(eC.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:"Ruler / DPI"}),(0,a.jsxs)(U.default,{children:[(0,a.jsx)(I.default,{icon:"\u{1F4CF}",onClick:()=>d("ruler"),children:"Ruler"}),(0,a.jsx)(I.default,{onClick:()=>{null==S||S(null),Y.default.info("Ruler cleared");},children:"Clear"})]}),R&&(0,a.jsxs)("div",{children:["Estimated DPI: ",R]})]}),(0,a.jsx)(eC.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:"Export"}),(0,a.jsxs)(U.default,{children:[(0,a.jsx)(I.default,{icon:(0,a.jsx)(eA,{}),onClick:()=>M(!1,e,B),children:"PNG"}),(0,a.jsx)(I.default,{onClick:()=>M(!0,e,B),children:"JPG"}),(0,a.jsx)(I.default,{icon:(0,a.jsx)(h.default,{}),onClick:()=>eh(e),children:"Copy"})]})]})]})}),{Option:eW}=et.default,eX=({imageUrl:e,onExport:t})=>{let r=(0,j.useRef)(null),{canvasRef:l,overlayRef:n,baseCanvas:i}=function(e,t){let r=(0,j.useRef)(null),l=(0,j.useRef)(null),[n,a]=(0,j.useState)(null);(0,j.useEffect)(()=>{(async()=>{try{let l=await new Promise((t,r)=>{let l=new Image;l.crossOrigin="anonymous",l.onload=()=>{let e=ei(l.naturalWidth,l.naturalHeight);e.getContext("2d").drawImage(l,0,0),t(e);},l.onerror=r,l.src=e;});a(l);let n=ei(l.width,l.height);if(n.getContext("2d").drawImage(l,0,0),r.current){r.current.width=n.width,r.current.height=n.height;let e=r.current.getContext("2d");e.clearRect(0,0,n.width,n.height),e.drawImage(n,0,0);}t&&t(i(n));}catch(e){console.error("Failed to load image",e),Y.default.error("Failed to load image");}})();},[e]),(0,j.useEffect)(()=>{s();},[n]);let i=e=>e.toDataURL("image/png"),s=()=>{if(!r.current||!n)return;r.current.width=n.width,r.current.height=n.height,l.current.width=n.width,l.current.height=n.height;let e=r.current.getContext("2d");e.clearRect(0,0,r.current.width,r.current.height),e.drawImage(n,0,0);};return{canvasRef:r,overlayRef:l,baseCanvas:n,syncCanvasSize:s};}(e,e=>{s.push(e,"Initial load");}),s=function(e,t){let[r,l]=(0,j.useState)([]),[n,a]=(0,j.useState)(-1),i=r[n],s=l=>{let n=r[l];if(!n)return;let i=new Image;i.onload=()=>{let r=e.current.getContext("2d");e.current.width=i.naturalWidth,e.current.height=i.naturalHeight,t.current.width=i.naturalWidth,t.current.height=i.naturalHeight,r.clearRect(0,0,e.current.width,e.current.height),r.drawImage(i,0,0),a(l);},i.src=n.url;};return{history:r,index:n,current:i,push:(e,t="")=>{let i=r.slice(0,n+1);i.push({url:e,label:t}),l(i),a(i.length-1);},undo:()=>{n<=0||s(n-1);},redo:()=>{n>=r.length-1||s(n+1);}};}(l,n),[d,o]=(0,j.useState)(1),[c,u]=(0,j.useState)({x:0,y:0}),[h,f]=(0,j.useState)(!1),g=(0,j.useRef)(null),[x,m]=(0,j.useState)("pan"),[p,w]=(0,j.useState)(0),[v,y]=(0,j.useState)(0),[C,b]=(0,j.useState)(null),k=(0,j.useRef)(null),[R,S]=(0,j.useState)(!1),M=(0,j.useRef)(null),[B,L]=(0,j.useState)(null),[E,D]=(0,j.useState)(!1),[_,P]=(0,j.useState)(!1),[z,T]=(0,j.useState)(null),[G,V]=(0,j.useState)(null),[$]=(0,j.useState)(!1),A=(0,j.useRef)(null),[H,N]=(0,j.useState)(null),[W,X]=(0,j.useState)("#ff0000"),[F,O]=(0,j.useState)(2),[Z,q]=(0,j.useState)(!1),J=(0,j.useRef)([]),[ee,er]=(0,j.useState)(0),[en,es]=(0,j.useState)(0),[ed,eo]=(0,j.useState)(0),[eh,ef]=(0,j.useState)(255),[eg,ep]=(0,j.useState)(0),ej=(0,j.useRef)(!1),ew=(0,j.useRef)(null),ey=(0,j.useRef)(F);(0,j.useEffect)(()=>{let e=r.current;if(!e)return;let t=e=>e.preventDefault();return e.addEventListener("contextmenu",t),()=>e.removeEventListener("contextmenu",t);},[]),(0,j.useEffect)(()=>{let e=r.current,t=l.current;if(!e||!t)return;let n=e=>{if(!e.ctrlKey)return;e.preventDefault();let r=t.getBoundingClientRect(),l=e.clientX-r.left,n=e.clientY-r.top;o(t=>{let r=Math.min(Math.max(t*(e.deltaY<0?1.1:.9),.1),12),a=r/t;return u(e=>({x:l-(l-e.x)*a,y:n-(n-e.y)*a})),r;});};return e.addEventListener("wheel",n,{passive:!1}),()=>e.removeEventListener("wheel",n);},[]);let eC=()=>{if(!n.current||!l.current)return;let e=n.current.getContext("2d");if(e.clearRect(0,0,n.current.width,n.current.height),C&&(e.save(),e.strokeStyle="#00aaff",e.lineWidth=2,e.setLineDash([6,4]),e.strokeRect(C.x,C.y,C.w,C.h),e.restore()),A.current&&(e.save(),e.strokeStyle="#ffcc00",e.lineWidth=2,e.beginPath(),e.moveTo(A.current.x1,A.current.y1),e.lineTo(A.current.x2,A.current.y2),e.stroke(),e.restore()),M.current){e.save(),e.fillStyle="rgba(0,255,0,0.8)";for(let t=0;t<8;t+=2){let r=M.current[t],l=M.current[t+1];isNaN(r)||isNaN(l)||e.fillRect(r-4,l-4,8,8);}e.restore();}if(z&&"color"===x){let t=l.current.getBoundingClientRect(),r=(z.x-t.left)/d,n=(z.y-t.top)/d;e.save(),e.strokeStyle=z.color,e.lineWidth=2/d,e.beginPath(),e.arc(r,n,8/d,0,2*Math.PI),e.stroke(),e.restore();}if(z&&"draw"===x){let t=l.current.getBoundingClientRect(),r=(z.x-t.left)/d,n=(z.y-t.top)/d;e.save(),e.strokeStyle=W,e.lineWidth=2/d,e.beginPath(),e.arc(r,n,F/2,0,2*Math.PI),e.stroke(),e.restore();}};(0,j.useEffect)(()=>{let e=l.current;if(!e)return;let t=e=>{if("color"===x){let t=em(e,l,d);T(t?{x:e.clientX,y:e.clientY,color:t}:null),eC();}else"draw"===x&&(T(W?{x:e.clientX,y:e.clientY,color:W}:null),eC());},r=e=>{if("color"===x){let t=em(e,l,d);t&&(V(t),X(t),navigator.clipboard.writeText(t).catch(()=>{}),Y.default.success(`Picked color ${t}`));}},n=()=>{"color"===x&&T(null);};return e.addEventListener("mousemove",t),e.addEventListener("click",r),e.addEventListener("mouseleave",n),()=>{e.removeEventListener("mousemove",t),e.removeEventListener("click",r),e.removeEventListener("mouseleave",n);};},[x,d,c]),(0,j.useEffect)(()=>{let e=e=>{e.ctrlKey&&"z"===e.key&&s.undo(),e.ctrlKey&&e.shiftKey&&"Z"===e.key&&s.redo(),"c"===e.key&&m("crop"),"h"===e.key&&m("pan"),"r"===e.key&&ec(90,l,n,s.history),"p"===e.key&&m("color"),"b"===e.key&&m("draw");};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e);},[s.index,s.history]),(0,j.useEffect)(()=>{let e=e=>{"Space"===e.code?(e.preventDefault(),D(e=>(e||(L(e=>null===e?x:e),m("pan")),!0))):"AltLeft"===e.code&&"draw"===x&&(e.preventDefault(),P(e=>(e||(L(e=>null===e?x:e),m("color")),!0)));},t=e=>{"Space"===e.code?(D(!1),L(e=>(e&&m(e),null))):"AltLeft"===e.code&&"draw"===B&&(P(!1),L(e=>(e&&m(e),null)));};return window.addEventListener("keydown",e,{passive:!1}),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t);};},[x]);let eb=async()=>{if(!l.current||!M.current)return;let e=l.current,t=e.width,r=e.height,a=function(e,t,r,l){let n=ei(r,l),a=n.getContext("2d");function i(t,n){let[i,s,d,o,c,u]=t,[h,f,g,x,m,p]=n;1e-6>Math.abs(h*(x-p)+g*(p-f)+m*(f-x))||(a.save(),a.beginPath(),a.moveTo(h,f),a.lineTo(g,x),a.lineTo(m,p),a.closePath(),a.clip(),a.drawImage(e,0,0,r,l),a.restore());}e.getContext("2d").getImageData(0,0,e.width,e.height);let[s,d,o,c,u,h,f,g]=t;return i([s,d,o,c,u,h],[0,0,r,0,0,l]),i([u,h,f,g,s,d],[r,l,0,l,r,0]),n;}(e,M.current,t,r);l.current.width=a.width,l.current.height=a.height,n.current.width=a.width,n.current.height=a.height,l.current.getContext("2d").clearRect(0,0,a.width,a.height),l.current.getContext("2d").drawImage(a,0,0),s.push(l.current.toDataURL(),"Perspective corrected"),S(!1);},ek=(0,j.useMemo)(()=>{if(("pan"===x||"select"===x)&&h)return"grabbing";switch(x){case"pan":return"grab";case"crop":case"ruler":case"perspective":return"crosshair";case"color":return"copy";case"draw":return"pointer";default:return"default";}},[x,h]);return(0,a.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,a.jsx)(eN,{canvasRef:l,overlayRef:n,baseCanvas:i,history:s,drawColor:W,setDrawColor:X,drawLineWidth:F,setDrawLineWidth:O,setTool:m,brightness:p,setBrightness:w,contrast:v,setContrast:y,blur:ee,setBlur:er,gaussian:en,setGaussian:es,sharpen:ed,setSharpen:eo,bgThreshold:eh,setBgThreshold:ef,bgThresholdBlack:eg,setBgThresholdBlack:ep,setShowPerspectiveModal:S,dpiMeasured:H,setDpiMeasured:N,exportImage:eu,onExport:t}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsxs)(U.default,{children:[(0,a.jsx)(K.default,{title:"Zoom In",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(el.default,{}),onClick:()=>o(e=>Math.min(1.2*e,8))})}),(0,a.jsx)(K.default,{title:"Zoom Out",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(ea.default,{}),onClick:()=>o(e=>Math.max(e/1.2,.1))})}),(0,a.jsxs)(et.default,{value:x,onChange:e=>m(e),style:{width:140},children:[(0,a.jsx)(eW,{value:"pan",children:"Pan"}),(0,a.jsx)(eW,{value:"color",children:"Color Picker"}),(0,a.jsx)(eW,{value:"crop",children:"Crop"}),(0,a.jsx)(eW,{value:"ruler",children:"Ruler"}),(0,a.jsx)(eW,{value:"perspective",children:"Perspective"}),(0,a.jsx)(eW,{value:"draw",children:"Brush"})]})]})}),(0,a.jsx)(ev,{canvasRef:l,overlayRef:n,containerRef:r,offset:c,zoom:d,tool:x,currentCursor:ek,hoverColor:z,onMouseDown:e=>{let t=l.current.getBoundingClientRect(),r=(e.clientX-t.left)/d,n=(e.clientY-t.top)/d;if("color"===x&&e.altKey&&2===e.button&&m("draw"),("draw"===x||"color"===x)&&e.altKey&&2===e.button){e.preventDefault(),ej.current=!0,ew.current=e.clientX,ey.current=F;return;}if("pan"===x||"select"===x)f(!0),g.current={x:e.clientX-c.x,y:e.clientY-c.y};else if("crop"===x)k.current={x:r,y:n},b({x:r,y:n,w:1,h:1});else if("ruler"===x){if(A.current){A.current.x2=r,A.current.y2=n;let e=r-A.current.x1,t=n-A.current.y1,a=Math.sqrt(e*e+t*t),i=Math.round(a/(l.current.width/(window.devicePixelRatio||1))*96);N(i),Y.default.info(`Distance: ${Math.round(a)} px, estimated DPI: ${i}`),A.current=null;}else A.current={x1:r,y1:n,x2:r,y2:n};}else if("perspective"===x){M.current||(M.current=[r,n,r,n,r,n,r,n]);let e=M.current;for(let t=0;t<8;t+=2)if(isNaN(e[t])||isNaN(e[t+1])||0===e[t]&&0===e[t+1]){e[t]=r,e[t+1]=n;break;}}else"draw"===x&&(q(!0),J.current=[{x:r,y:n}]);},onMouseMove:e=>{if(ej.current&&null!==ew.current){let t=e.clientX-ew.current;O(Math.max(1,Math.min(50,ey.current+t/5)));return;}if(("pan"===x||"select"===x)&&h&&g.current)u({x:e.clientX-g.current.x,y:e.clientY-g.current.y});else if("crop"===x&&k.current){let t=l.current.getBoundingClientRect(),r={x:(e.clientX-t.left)/d,y:(e.clientY-t.top)/d};b({x:Math.min(k.current.x,r.x),y:Math.min(k.current.y,r.y),w:Math.abs(r.x-k.current.x),h:Math.abs(r.y-k.current.y)}),eC();}else if("draw"===x&&Z&&l.current){let t=l.current.getBoundingClientRect(),r=(e.clientX-t.left)/d,n=(e.clientY-t.top)/d;J.current.push({x:r,y:n});let a=l.current.getContext("2d");a.save(),a.strokeStyle=W,a.lineWidth=F,a.lineCap="round",a.beginPath();let i=J.current;a.moveTo(i[i.length-2].x,i[i.length-2].y),a.lineTo(i[i.length-1].x,i[i.length-1].y),a.stroke(),a.restore();}else eC();},onMouseUp:()=>{if(ej.current){ej.current=!1,ew.current=null,ey.current=F;return;}f(!1),g.current=null,"crop"===x&&C&&ex(l,n,C,b,s),"draw"===x&&Z&&(q(!1),s.push(l.current.toDataURL(),"Draw"));}})]}),(0,a.jsx)(Q.default,{title:"Perspective correction",open:R,onOk:()=>eb(),onCancel:()=>S(!1),okText:"Apply",children:(0,a.jsx)("p",{children:"Click four points on the image (clockwise) to define the corners, then Apply."})})]});},{Title:eF}=W.default,{TabPane:eO}=V.default,eY=()=>{let[e,t]=(0,j.useState)(null),[r,l]=(0,j.useState)(null),[n,i]=(0,j.useState)(null),[d,u]=(0,j.useState)(!1),[f,x]=(0,j.useState)(!1),m=(0,j.useRef)(0),[p,w]=(0,j.useState)(1),[v,y]=(0,j.useState)(1),[b,k]=(0,j.useState)(1),[S,B]=(0,j.useState)(8),[L,D]=(0,j.useState)(2),[P,z]=(0,j.useState)(1);(0,j.useEffect)(()=>{let e=e=>{var t;let r=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!r)return;let l=Array.from(r).find(e=>e.type.includes("image"));if(l){let t=l.getAsFile();t&&(G(t),Y.default.success("Image pasted from clipboard!"),e.preventDefault());}};return window.addEventListener("paste",e),()=>window.removeEventListener("paste",e);},[]);let G=e=>{t(e);let r=new FileReader;return r.onload=e=>{var t;return l(null===(t=e.target)||void 0===t?void 0:t.result);},r.readAsDataURL(e),u(!1),m.current=0,!1;},$=(e,t)=>{let r=new Blob([e],{type:"image/svg+xml"}),l=document.createElement("a");l.href=URL.createObjectURL(r),l.download=t,l.click();},H=n?btoa(unescape(encodeURIComponent(n))):"",N=n?`data:image/svg+xml;base64,${H}`:"";return(0,a.jsx)(s.default,{setDragging:u,dragCounter:m,handleUpload:G,children:(0,a.jsx)(E.default,{title:(0,a.jsxs)(a.Fragment,{children:["\u{1F5BC}\uFE0F PNG / JPEG Viewer ",(0,a.jsx)(A.default,{color:"cyan",children:"Beta"})]}),variant:"borderless",children:(0,a.jsxs)(U.default,{direction:"vertical",style:{width:"100%"},size:"large",children:[!d&&(0,a.jsx)(F.default,{beforeUpload:G,showUploadList:!1,accept:".png,.jpg,.jpeg",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(M.default,{}),children:"Upload Image (PNG/JPG)"})}),d&&(0,a.jsx)(o.default,{}),r&&(0,a.jsxs)("div",{children:[(0,a.jsx)(eF,{level:5,children:"Preview & Editor:"}),(0,a.jsx)(eX,{imageUrl:r,onExport:e=>{console.log("exported blob",e);}})]}),f&&(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(255, 255, 255, 0.7)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:(0,a.jsx)(T.default,{indicator:(0,a.jsx)(R,{style:{fontSize:48,color:"#1890ff"},spin:!0}),tip:"Converting image to SVG...",size:"large"})}),(0,a.jsx)(E.default,{size:"small",title:"Tracing Options (Adjust before converting)",children:(0,a.jsxs)(U.default,{wrap:!0,size:"large",children:[(0,a.jsxs)(U.default,{size:"small",children:[(0,a.jsx)(K.default,{title:"Scale factor for the SVG output. Higher = larger SVG.",children:(0,a.jsxs)("label",{children:["Scale ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:.1,step:.1,value:p,onChange:e=>w(e||1)})]}),(0,a.jsxs)(U.default,{size:"small",children:[(0,a.jsx)(K.default,{title:"Error threshold for line detection. Lower = more precise lines.",children:(0,a.jsxs)("label",{children:["ltres ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:0,value:v,onChange:e=>y(e||1)})]}),(0,a.jsxs)(U.default,{size:"small",children:[(0,a.jsx)(K.default,{title:"Error threshold for curve detection. Lower = more precise curves.",children:(0,a.jsxs)("label",{children:["qtres ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:0,value:b,onChange:e=>k(e||1)})]}),(0,a.jsxs)(U.default,{size:"small",children:[(0,a.jsx)(K.default,{title:"Minimum path length to keep. Higher = simpler SVG with fewer tiny paths.",children:(0,a.jsxs)("label",{children:["Pathomit ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:0,value:S,onChange:e=>B(e||0)})]}),(0,a.jsxs)(U.default,{size:"small",children:[(0,a.jsx)(K.default,{title:"Pixel sampling interval for colors. 1 = every pixel, higher = faster but less accurate colors.",children:(0,a.jsxs)("label",{children:["ColorSampling ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:1,value:L,onChange:e=>D(e||1)})]}),(0,a.jsxs)(U.default,{size:"small",children:[(0,a.jsx)(K.default,{title:"Stroke width in the output SVG.",children:(0,a.jsxs)("label",{children:["StrokeWidth ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:0,value:P,onChange:e=>z(e||1)})]})]})}),(0,a.jsxs)(U.default,{children:[(0,a.jsx)(I.default,{type:"primary",onClick:()=>{if(!r){Y.default.error("Please upload an image first.");return;}x(!0);try{q.default.imageToSVG(r,e=>{i(e),x(!1),Y.default.success("Image converted to SVG successfully!");},{scale:p,ltres:v,qtres:b,pathomit:S,colorsampling:L,strokewidth:P});}catch(e){console.error(e),x(!1),Y.default.error("Error converting image to SVG.");}},disabled:!e,children:"Convert to SVG"}),(0,a.jsx)(I.default,{onClick:()=>{t(null),l(null),i(null),Y.default.info("Image and SVG cleared.");},danger:!0,disabled:!e&&!n,children:"Clear Image"})]}),n&&(0,a.jsxs)(V.default,{defaultActiveKey:"svg",type:"card",style:{marginTop:16},children:[(0,a.jsxs)(eO,{tab:"SVG",children:[(0,a.jsxs)(U.default,{style:{marginBottom:8},children:[(0,a.jsx)(I.default,{onClick:()=>$(n,"image.svg"),icon:(0,a.jsx)(g.default,{}),children:"Download"}),(0,a.jsx)(I.default,{onClick:()=>(0,c.handleCopy)(n,"SVG copied!"),icon:(0,a.jsx)(h.default,{}),children:"Copy"})]}),(0,a.jsx)("div",{style:{border:"1px solid #eee",borderRadius:6,padding:12,overflow:"auto"},children:(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:n}})})]},"svg"),(0,a.jsxs)(eO,{tab:"Base64",children:[(0,a.jsxs)(U.default,{style:{marginBottom:8},children:[(0,a.jsx)(I.default,{onClick:()=>(0,c.handleCopy)(H,"Base64 copied!"),icon:(0,a.jsx)(h.default,{}),children:"Copy Base64"}),(0,a.jsx)(I.default,{onClick:()=>$(H,"image-base64.txt"),icon:(0,a.jsx)(g.default,{}),children:"Download Base64"})]}),(0,a.jsx)("pre",{style:{background:"#f7f7f7",padding:12,borderRadius:6,whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:300,overflow:"auto"},children:H})]},"base64"),(0,a.jsxs)(eO,{tab:"Data URI",children:[(0,a.jsxs)(U.default,{style:{marginBottom:8},children:[(0,a.jsx)(I.default,{onClick:()=>(0,c.handleCopy)(N,"Data URI copied!"),icon:(0,a.jsx)(h.default,{}),children:"Copy Data URI"}),(0,a.jsx)(I.default,{onClick:()=>$(N,"image-datauri.txt"),icon:(0,a.jsx)(g.default,{}),children:"Download Data URI"})]}),(0,a.jsx)("pre",{style:{background:"#f7f7f7",padding:12,borderRadius:6,whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:300,overflow:"auto"},children:N})]},"datauri")]})]})})});};}}]);
//# sourceMappingURL=2ed777c5-async.bb58fb83.js.map