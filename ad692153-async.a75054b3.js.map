{"version":3,"sources":["src/pages/PhotoEditor/hooks/useHistory.ts","src/pages/PhotoEditor/context.tsx","node_modules/@ant-design/icons-svg/es/asn/PlusCircleOutlined.js","node_modules/@ant-design/icons/es/icons/PlusCircleOutlined.js","node_modules/@ant-design/icons/es/icons/FolderOpenOutlined.js","node_modules/@ant-design/icons-svg/es/asn/MoreOutlined.js","node_modules/@ant-design/icons/es/icons/MoreOutlined.js","src/pages/PhotoEditor/components/ExportModal.tsx","src/pages/PhotoEditor/utils/brushHelpers.ts","src/pages/PhotoEditor/utils/effectsHelpers.ts","src/pages/PhotoEditor/components/LayerMaskModal.tsx","src/pages/PhotoEditor/components/SavedProjectsList.tsx","src/pages/PhotoEditor/components/ProjectModal.tsx","src/pages/PhotoEditor/utils/storage.ts","src/pages/PhotoEditor/hooks/useProjects.ts","src/pages/PhotoEditor/components/Toolbar.tsx","src/pages/PhotoEditor/hooks/useKeyboardShortcuts.ts","src/pages/PhotoEditor/components/CanvasArea.tsx","src/pages/PhotoEditor/components/LayersPanel.tsx","src/pages/PhotoEditor/components/AdjustmentPanel.tsx","src/pages/PhotoEditor/components/BrushPanel.tsx","node_modules/@ant-design/icons-svg/es/asn/BoldOutlined.js","node_modules/@ant-design/icons/es/icons/BoldOutlined.js","node_modules/@ant-design/icons-svg/es/asn/UnderlineOutlined.js","node_modules/@ant-design/icons/es/icons/UnderlineOutlined.js","src/pages/PhotoEditor/components/TextStylePanel.tsx","src/pages/PhotoEditor/components/AlignControls.tsx","src/pages/PhotoEditor/components/PropertiesPanel.tsx","src/pages/PhotoEditor/components/UploadArea.tsx","src/pages/PhotoEditor/hooks/useImageUpload.ts","E:/code\\ultimate-tool-web\\src\\pages\\PhotoEditor\\styles.less?asmodule","src/pages/PhotoEditor/index.tsx"],"sourcesContent":["import { useState, useCallback, useEffect } from 'react';\r\nimport { Canvas } from 'fabric';\r\n\r\nexport const useHistory = (canvas: Canvas | null) => {\r\n  const [history, setHistory] = useState<string[]>([]);\r\n  const [historyIndex, setHistoryIndex] = useState<number>(-1);\r\n  const [isHistoryProcessing, setIsHistoryProcessing] = useState<boolean>(false);\r\n\r\n  const saveState = useCallback(() => {\r\n    if (!canvas || isHistoryProcessing) return;\r\n\r\n    const json = JSON.stringify(canvas.toJSON());\r\n\r\n    // Avoid saving duplicate states\r\n    if (history.length > 0 && historyIndex >= 0 && history[historyIndex] === json) {\r\n      return;\r\n    }\r\n\r\n    // If we are in the middle of the history, discard the future\r\n    const newHistory = history.slice(0, historyIndex + 1);\r\n    newHistory.push(json);\r\n\r\n    // Limit history size if needed (e.g., 50)\r\n    if (newHistory.length > 50) {\r\n      newHistory.shift();\r\n    }\r\n\r\n    setHistory(newHistory);\r\n    setHistoryIndex(newHistory.length - 1);\r\n  }, [canvas, history, historyIndex, isHistoryProcessing]);\r\n\r\n  useEffect(() => {\r\n    if (!canvas) return;\r\n\r\n    const handleSave = () => {\r\n      saveState();\r\n    };\r\n\r\n    canvas.on('object:modified', handleSave);\r\n    canvas.on('object:added', handleSave);\r\n    canvas.on('object:removed', handleSave);\r\n    canvas.on('path:created', handleSave);\r\n\r\n    return () => {\r\n      canvas.off('object:modified', handleSave);\r\n      canvas.off('object:added', handleSave);\r\n      canvas.off('object:removed', handleSave);\r\n      canvas.off('path:created', handleSave);\r\n    };\r\n  }, [canvas, saveState]);\r\n\r\n  const undo = useCallback(() => {\r\n    if (!canvas || historyIndex <= 0 || isHistoryProcessing) return;\r\n\r\n    setIsHistoryProcessing(true);\r\n    const newIndex = historyIndex - 1;\r\n    const json = history[newIndex];\r\n\r\n    canvas.loadFromJSON(JSON.parse(json)).then(() => {\r\n      canvas.renderAll();\r\n      setHistoryIndex(newIndex);\r\n      setIsHistoryProcessing(false);\r\n    });\r\n  }, [canvas, history, historyIndex, isHistoryProcessing]);\r\n\r\n  const redo = useCallback(() => {\r\n    if (!canvas || historyIndex >= history.length - 1 || isHistoryProcessing) return;\r\n\r\n    setIsHistoryProcessing(true);\r\n    const newIndex = historyIndex + 1;\r\n    const json = history[newIndex];\r\n\r\n    canvas.loadFromJSON(JSON.parse(json)).then(() => {\r\n      canvas.renderAll();\r\n      setHistoryIndex(newIndex);\r\n      setIsHistoryProcessing(false);\r\n    });\r\n  }, [canvas, history, historyIndex, isHistoryProcessing]);\r\n\r\n  return {\r\n    saveState,\r\n    undo,\r\n    redo,\r\n    canUndo: historyIndex > 0,\r\n    canRedo: historyIndex < history.length - 1,\r\n  };\r\n};\r\n","import React, { createContext, useContext, useState } from 'react';\r\nimport { Canvas, FabricObject } from 'fabric';\r\nimport { useHistory } from './hooks/useHistory';\r\n\r\ninterface PhotoEditorContextType {\r\n  canvas: Canvas | null;\r\n  setCanvas: (canvas: Canvas) => void;\r\n  activeTool: string;\r\n  setActiveTool: (tool: string) => void;\r\n  selectedObject: FabricObject | null;\r\n  setSelectedObject: (object: FabricObject | null) => void;\r\n  history: {\r\n    saveState: () => void;\r\n    undo: () => void;\r\n    redo: () => void;\r\n    canUndo: boolean;\r\n    canRedo: boolean;\r\n  };\r\n  clipboard: FabricObject | null;\r\n  setClipboard: (object: FabricObject | null) => void;\r\n  imageUrl?: string | null;\r\n  initialProject?: any;\r\n  addOnFile?: File | null;\r\n  setAddOnFile?: (file: File | null) => void;\r\n}\r\n\r\nconst PhotoEditorContext = createContext<PhotoEditorContextType | undefined>(undefined);\r\n\r\nexport const PhotoEditorProvider: React.FC<{\r\n  children: React.ReactNode;\r\n  imageUrl?: string | null;\r\n  initialProject?: any;\r\n  addOnFile?: File | null;\r\n  setAddOnFile?: (file: File | null) => void;\r\n}> = ({ children, imageUrl, initialProject, addOnFile, setAddOnFile }) => {\r\n  const [canvas, setCanvas] = useState<Canvas | null>(null);\r\n  const [activeTool, setActiveTool] = useState<string>('select');\r\n  const [selectedObject, setSelectedObject] = useState<FabricObject | null>(null);\r\n  const [clipboard, setClipboard] = useState<FabricObject | null>(null);\r\n\r\n  const history = useHistory(canvas);\r\n\r\n  return (\r\n    <PhotoEditorContext.Provider\r\n      value={{\r\n        canvas,\r\n        setCanvas,\r\n        activeTool,\r\n        setActiveTool,\r\n        selectedObject,\r\n        setSelectedObject,\r\n        history,\r\n        clipboard,\r\n        setClipboard,\r\n        imageUrl,\r\n        initialProject,\r\n        addOnFile,\r\n        setAddOnFile,\r\n      }}\r\n    >\r\n      {children}\r\n    </PhotoEditorContext.Provider>\r\n  );\r\n};\r\nexport const usePhotoEditor = () => {\r\n  const context = useContext(PhotoEditorContext);\r\n  if (!context) {\r\n    throw new Error('usePhotoEditor must be used within a PhotoEditorProvider');\r\n  }\r\n  return context;\r\n};\r\n","// This icon file is generated automatically.\nvar PlusCircleOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z\" } }, { \"tag\": \"path\", \"attrs\": { \"d\": \"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z\" } }] }, \"name\": \"plus-circle\", \"theme\": \"outlined\" };\nexport default PlusCircleOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport PlusCircleOutlinedSvg from \"@ant-design/icons-svg/es/asn/PlusCircleOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar PlusCircleOutlined = function PlusCircleOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: PlusCircleOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(PlusCircleOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'PlusCircleOutlined';\n}\nexport default RefIcon;","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport FolderOpenOutlinedSvg from \"@ant-design/icons-svg/es/asn/FolderOpenOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar FolderOpenOutlined = function FolderOpenOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: FolderOpenOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(FolderOpenOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'FolderOpenOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar MoreOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z\" } }] }, \"name\": \"more\", \"theme\": \"outlined\" };\nexport default MoreOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport MoreOutlinedSvg from \"@ant-design/icons-svg/es/asn/MoreOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar MoreOutlined = function MoreOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: MoreOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(MoreOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'MoreOutlined';\n}\nexport default RefIcon;","import React, { useState } from 'react';\r\nimport { Modal, Form, Select, InputNumber, Button, message, Checkbox } from 'antd';\r\nimport { Canvas } from 'fabric';\r\n\r\ninterface ExportModalProps {\r\n  visible: boolean;\r\n  onCancel: () => void;\r\n  canvas: Canvas | null;\r\n}\r\n\r\nconst ExportModal: React.FC<ExportModalProps> = ({ visible, onCancel, canvas }) => {\r\n  const [format, setFormat] = useState<'png' | 'jpeg' | 'json' | 'svg'>('png');\r\n  const [quality, setQuality] = useState<number>(1);\r\n  const [multiplier, setMultiplier] = useState<number>(1);\r\n  const [trimWhitespace, setTrimWhitespace] = useState<boolean>(true);\r\n\r\n  const handleExport = () => {\r\n    if (!canvas) return;\r\n\r\n    if (format === 'json') {\r\n      const json = canvas.toJSON();\r\n      const blob = new Blob([JSON.stringify(json)], { type: 'application/json' });\r\n      downloadBlob(blob, 'project.json');\r\n    } else if (format === 'svg') {\r\n      const svg = canvas.toSVG();\r\n      const blob = new Blob([svg], { type: 'image/svg+xml' });\r\n      downloadBlob(blob, 'image.svg');\r\n    } else {\r\n      let options: any = {\r\n        format,\r\n        quality,\r\n        multiplier,\r\n      };\r\n\r\n      let savedBackgroundColor: any = null;\r\n      let savedBackgroundImage: any = null;\r\n\r\n      if (trimWhitespace) {\r\n        const objects = canvas.getObjects();\r\n        if (objects.length > 0) {\r\n          let minX = Infinity;\r\n          let minY = Infinity;\r\n          let maxX = -Infinity;\r\n          let maxY = -Infinity;\r\n\r\n          objects.forEach((obj) => {\r\n            const bound = obj.getBoundingRect();\r\n            if (bound.left < minX) minX = bound.left;\r\n            if (bound.top < minY) minY = bound.top;\r\n            if (bound.left + bound.width > maxX) maxX = bound.left + bound.width;\r\n            if (bound.top + bound.height > maxY) maxY = bound.top + bound.height;\r\n          });\r\n\r\n          options = {\r\n            ...options,\r\n            left: minX,\r\n            top: minY,\r\n            width: maxX - minX,\r\n            height: maxY - minY,\r\n          };\r\n\r\n          // Save and remove background\r\n          savedBackgroundColor = canvas.backgroundColor;\r\n          savedBackgroundImage = canvas.backgroundImage;\r\n          canvas.backgroundColor = null as any;\r\n          canvas.backgroundImage = null as any;\r\n        }\r\n      }\r\n\r\n      const dataURL = canvas.toDataURL(options);\r\n\r\n      // Restore background\r\n      if (trimWhitespace) {\r\n        canvas.backgroundColor = savedBackgroundColor;\r\n        canvas.backgroundImage = savedBackgroundImage;\r\n      }\r\n\r\n      const link = document.createElement('a');\r\n      link.download = `image.${format}`;\r\n      link.href = dataURL;\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n    }\r\n    message.success('Export successful');\r\n    onCancel();\r\n  };\r\n\r\n  const downloadBlob = (blob: Blob, fileName: string) => {\r\n    const link = document.createElement('a');\r\n    link.href = URL.createObjectURL(blob);\r\n    link.download = fileName;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Export Image\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={[\r\n        <Button key=\"cancel\" onClick={onCancel}>\r\n          Cancel\r\n        </Button>,\r\n        <Button key=\"export\" type=\"primary\" onClick={handleExport}>\r\n          Export\r\n        </Button>,\r\n      ]}\r\n    >\r\n      <Form layout=\"vertical\">\r\n        <Form.Item label=\"Format\">\r\n          <Select value={format} onChange={(v) => setFormat(v)}>\r\n            <Select.Option value=\"png\">PNG</Select.Option>\r\n            <Select.Option value=\"jpeg\">JPEG</Select.Option>\r\n            <Select.Option value=\"svg\">SVG</Select.Option>\r\n            <Select.Option value=\"json\">JSON (Project)</Select.Option>\r\n          </Select>\r\n        </Form.Item>\r\n        {format !== 'json' && format !== 'svg' && (\r\n          <>\r\n            <Form.Item label=\"Quality (0.1 - 1)\">\r\n              <InputNumber\r\n                min={0.1}\r\n                max={1}\r\n                step={0.1}\r\n                value={quality}\r\n                onChange={(v) => setQuality(v || 1)}\r\n                style={{ width: '100%' }}\r\n              />\r\n            </Form.Item>\r\n            <Form.Item label=\"Multiplier (Scale)\">\r\n              <InputNumber\r\n                min={0.1}\r\n                max={5}\r\n                step={0.1}\r\n                value={multiplier}\r\n                onChange={(v) => setMultiplier(v || 1)}\r\n                style={{ width: '100%' }}\r\n              />\r\n            </Form.Item>\r\n            <Form.Item>\r\n              <Checkbox\r\n                checked={trimWhitespace}\r\n                onChange={(e) => setTrimWhitespace(e.target.checked)}\r\n              >\r\n                Trim Whitespace (Export content only)\r\n              </Checkbox>\r\n            </Form.Item>\r\n          </>\r\n        )}\r\n      </Form>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ExportModal;\r\n","export type BrushSettings = {\r\n  color: string;\r\n  lineWidth: number;\r\n  opacity: number;\r\n  flow: number;\r\n  type: 'hard' | 'soft';\r\n};\r\n\r\nexport const drawBrushStroke = (\r\n  ctx: CanvasRenderingContext2D,\r\n  points: { x: number; y: number }[],\r\n  settings: BrushSettings,\r\n) => {\r\n  if (points.length === 0) return;\r\n\r\n  ctx.save();\r\n  ctx.globalAlpha = settings.opacity * settings.flow;\r\n\r\n  if (settings.type === 'soft') {\r\n    ctx.shadowColor = settings.color;\r\n    ctx.shadowBlur = settings.lineWidth * 0.5;\r\n    ctx.lineWidth = settings.lineWidth * 0.5;\r\n  } else {\r\n    ctx.shadowBlur = 0;\r\n    ctx.lineWidth = settings.lineWidth;\r\n  }\r\n\r\n  ctx.strokeStyle = settings.color;\r\n  ctx.fillStyle = settings.color;\r\n  ctx.lineCap = 'round';\r\n  ctx.lineJoin = 'round';\r\n\r\n  ctx.beginPath();\r\n  if (points.length === 1) {\r\n    ctx.arc(points[0].x, points[0].y, ctx.lineWidth / 2, 0, Math.PI * 2);\r\n    ctx.fill();\r\n  } else {\r\n    ctx.moveTo(points[0].x, points[0].y);\r\n    for (let i = 1; i < points.length; i++) {\r\n      ctx.lineTo(points[i].x, points[i].y);\r\n    }\r\n    ctx.stroke();\r\n  }\r\n  ctx.restore();\r\n};\r\n\r\nexport const drawBrushCursor = (\r\n  ctx: CanvasRenderingContext2D,\r\n  x: number,\r\n  y: number,\r\n  size: number,\r\n  color: string,\r\n  zoom: number = 1,\r\n) => {\r\n  ctx.save();\r\n  ctx.strokeStyle = color;\r\n  ctx.lineWidth = 2 / zoom;\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, size / 2, 0, Math.PI * 2);\r\n  ctx.stroke();\r\n  ctx.restore();\r\n};\r\n\r\nexport const getCanvasCoords = (\r\n  e: MouseEvent | React.MouseEvent,\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  zoom: number = 1,\r\n  offset: { x: number; y: number } = { x: 0, y: 0 },\r\n) => {\r\n  if (!canvasRef.current) return null;\r\n  const rect = canvasRef.current.getBoundingClientRect();\r\n  const x = (e.clientX - rect.left - offset.x) / zoom;\r\n  const y = (e.clientY - rect.top - offset.y) / zoom;\r\n  return { x, y };\r\n};\r\n\r\nexport const samplePixelColor = (\r\n  canvas: HTMLCanvasElement,\r\n  x: number,\r\n  y: number,\r\n): string | null => {\r\n  const ctx = canvas.getContext('2d');\r\n  if (!ctx) return null;\r\n\r\n  const imageData = ctx.getImageData(x, y, 1, 1);\r\n  const [r, g, b] = imageData.data;\r\n  return `#${[r, g, b].map((v) => v.toString(16).padStart(2, '0')).join('')}`;\r\n};\r\n","export const calculateColorRemovalAlphaMap = (\r\n  data: Uint8ClampedArray,\r\n  targetColor: string,\r\n  tolerance: number,\r\n  invert: boolean = false,\r\n  feather: number = 0,\r\n): Uint8Array => {\r\n  const hex = targetColor.replace('#', '');\r\n  const targetR = parseInt(hex.substring(0, 2), 16);\r\n  const targetG = parseInt(hex.substring(2, 4), 16);\r\n  const targetB = parseInt(hex.substring(4, 6), 16);\r\n\r\n  const alphaMap = new Uint8Array(data.length / 4);\r\n  const maxDistance = Math.sqrt(255 * 255 * 3);\r\n  const threshold = tolerance / 100;\r\n  const featherRange = feather / 100;\r\n\r\n  for (let i = 0; i < data.length; i += 4) {\r\n    const r = data[i];\r\n    const g = data[i + 1];\r\n    const b = data[i + 2];\r\n\r\n    const distance = Math.sqrt(\r\n      Math.pow(r - targetR, 2) + Math.pow(g - targetG, 2) + Math.pow(b - targetB, 2),\r\n    );\r\n\r\n    const normalizedDistance = distance / maxDistance;\r\n\r\n    let baseAlpha;\r\n\r\n    if (feather === 0) {\r\n      baseAlpha = normalizedDistance <= threshold ? 0 : 1;\r\n    } else {\r\n      const distanceFromThreshold = normalizedDistance - threshold;\r\n\r\n      if (distanceFromThreshold < -featherRange) {\r\n        baseAlpha = 0;\r\n      } else if (distanceFromThreshold > featherRange) {\r\n        baseAlpha = 1;\r\n      } else {\r\n        baseAlpha = (distanceFromThreshold + featherRange) / (featherRange * 2);\r\n      }\r\n    }\r\n\r\n    if (invert) {\r\n      baseAlpha = 1 - baseAlpha;\r\n    }\r\n\r\n    alphaMap[i / 4] = Math.round(baseAlpha * 255);\r\n  }\r\n  return alphaMap;\r\n};\r\n\r\nimport { Canvas, FabricObject, FabricImage } from 'fabric';\r\n\r\nexport const applyMaskToFabricObject = (\r\n  canvas: Canvas,\r\n  object: FabricObject,\r\n  maskCanvas: HTMLCanvasElement,\r\n) => {\r\n  if (!(object instanceof FabricImage)) return;\r\n\r\n  const imgElement = object.getElement() as HTMLImageElement | HTMLCanvasElement;\r\n  const width = imgElement.width;\r\n  const height = imgElement.height;\r\n\r\n  const tempCanvas = document.createElement('canvas');\r\n  tempCanvas.width = width;\r\n  tempCanvas.height = height;\r\n  const ctx = tempCanvas.getContext('2d')!;\r\n\r\n  // Draw original image\r\n  ctx.drawImage(imgElement, 0, 0, width, height);\r\n\r\n  const imageData = ctx.getImageData(0, 0, width, height);\r\n  const data = imageData.data;\r\n\r\n  const maskCtx = maskCanvas.getContext('2d')!;\r\n\r\n  const tempMaskCanvas = document.createElement('canvas');\r\n  tempMaskCanvas.width = width;\r\n  tempMaskCanvas.height = height;\r\n  const tempMaskCtx = tempMaskCanvas.getContext('2d')!;\r\n  tempMaskCtx.drawImage(maskCanvas, 0, 0, width, height);\r\n  const maskData = tempMaskCtx.getImageData(0, 0, width, height).data;\r\n\r\n  for (let i = 0; i < data.length; i += 4) {\r\n    const maskVal = maskData[i]; // Red channel\r\n    data[i + 3] = maskVal;\r\n  }\r\n\r\n  ctx.putImageData(imageData, 0, 0);\r\n\r\n  // Create new FabricImage\r\n  const newImg = new FabricImage(tempCanvas);\r\n\r\n  // Copy properties\r\n  newImg.set({\r\n    left: object.left,\r\n    top: object.top,\r\n    scaleX: object.scaleX,\r\n    scaleY: object.scaleY,\r\n    angle: object.angle,\r\n    skewX: object.skewX,\r\n    skewY: object.skewY,\r\n    flipX: object.flipX,\r\n    flipY: object.flipY,\r\n    originX: object.originX,\r\n    originY: object.originY,\r\n    opacity: object.opacity,\r\n  });\r\n\r\n  // Replace in canvas\r\n  const index = canvas.getObjects().indexOf(object);\r\n  canvas.remove(object);\r\n  canvas.add(newImg);\r\n  canvas.moveObjectTo(newImg, index);\r\n  canvas.setActiveObject(newImg);\r\n  canvas.requestRenderAll();\r\n};\r\n\r\nexport const applyMaskToCanvas = (\r\n  canvasRef: React.RefObject<HTMLCanvasElement>,\r\n  maskCanvas: HTMLCanvasElement,\r\n  history: { push: (img: string, label: string, isSetBase: boolean) => void },\r\n  label: string = 'Apply Mask',\r\n) => {\r\n  if (!canvasRef.current) return;\r\n\r\n  const canvas = canvasRef.current;\r\n  const ctx = canvas.getContext('2d')!;\r\n  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n  const data = imageData.data;\r\n\r\n  const maskCtx = maskCanvas.getContext('2d')!;\r\n  const maskData = maskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n\r\n  for (let i = 0; i < data.length; i += 4) {\r\n    const maskAlpha = maskData.data[i];\r\n    data[i + 3] = maskAlpha;\r\n  }\r\n\r\n  ctx.putImageData(imageData, 0, 0);\r\n  // history.push(canvas.toDataURL(), label, false); // History handling might differ\r\n};\r\n","import React, { useEffect, useState, useRef } from 'react';\r\nimport {\r\n  Modal,\r\n  Slider,\r\n  Radio,\r\n  Space,\r\n  Button,\r\n  Select,\r\n  InputNumber,\r\n  Tooltip,\r\n  ColorPicker,\r\n} from 'antd';\r\nimport { UndoOutlined, RedoOutlined, QuestionCircleOutlined } from '@ant-design/icons';\r\nimport {\r\n  BrushSettings,\r\n  drawBrushStroke,\r\n  drawBrushCursor,\r\n  getCanvasCoords,\r\n} from '../utils/brushHelpers';\r\nimport { calculateColorRemovalAlphaMap } from '../utils/effectsHelpers';\r\n\r\nconst { Option } = Select;\r\n\r\ntype ColorRemovalModalProps = {\r\n  open: boolean;\r\n  onCancel: () => void;\r\n  onApply: (maskCanvas: HTMLCanvasElement) => void;\r\n  selectedColor: string | null;\r\n  sourceCanvas: HTMLCanvasElement | null;\r\n};\r\n\r\nconst ColorRemovalModal: React.FC<ColorRemovalModalProps> = ({\r\n  open,\r\n  onCancel,\r\n  onApply,\r\n  selectedColor,\r\n  sourceCanvas,\r\n}) => {\r\n  const [tolerance, setTolerance] = useState(30);\r\n  const [previewMode, setPreviewMode] = useState<'normal' | 'mask'>('normal');\r\n  const [invert, setInvert] = useState(false);\r\n  const [feather, setFeather] = useState(0);\r\n  const [activeColor, setActiveColor] = useState(selectedColor || '#000000');\r\n  const [isAltPressed, setIsAltPressed] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (selectedColor) setActiveColor(selectedColor);\r\n  }, [selectedColor]);\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key === 'Alt') setIsAltPressed(true);\r\n    };\r\n    const handleKeyUp = (e: KeyboardEvent) => {\r\n      if (e.key === 'Alt') setIsAltPressed(false);\r\n    };\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    window.addEventListener('keyup', handleKeyUp);\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyDown);\r\n      window.removeEventListener('keyup', handleKeyUp);\r\n    };\r\n  }, []);\r\n\r\n  const [brushMode, setBrushMode] = useState<'remove' | 'keep'>('remove');\r\n  const [brushSize, setBrushSize] = useState(20);\r\n  const [brushOpacity, setBrushOpacity] = useState(1);\r\n  const [brushType, setBrushType] = useState<'hard' | 'soft'>('hard');\r\n  const [isDrawing, setIsDrawing] = useState(false);\r\n  const [cursorPos, setCursorPos] = useState<{ x: number; y: number } | null>(null);\r\n  const [previewColor, setPreviewColor] = useState<string | null>(null);\r\n  const [displayParams, setDisplayParams] = useState({ scale: 1, x: 0, y: 0 });\r\n\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const previewCanvasRef = useRef<HTMLCanvasElement>(null);\r\n  const maskCanvasRef = useRef<HTMLCanvasElement>(null);\r\n  const overlayCanvasRef = useRef<HTMLCanvasElement>(null);\r\n  const drawPoints = useRef<{ x: number; y: number }[]>([]);\r\n  const lastDrawPoint = useRef<{ x: number; y: number } | null>(null);\r\n\r\n  const [history, setHistory] = useState<ImageData[]>([]);\r\n  const [historyIndex, setHistoryIndex] = useState(-1);\r\n\r\n  useEffect(() => {\r\n    if (\r\n      open &&\r\n      sourceCanvas &&\r\n      previewCanvasRef.current &&\r\n      maskCanvasRef.current &&\r\n      overlayCanvasRef.current &&\r\n      containerRef.current\r\n    ) {\r\n      const w = sourceCanvas.width;\r\n      const h = sourceCanvas.height;\r\n      const container = containerRef.current;\r\n      const { clientWidth: cw, clientHeight: ch } = container;\r\n\r\n      // Calculate scale to fit image in container\r\n      const scale = Math.min(cw / w, ch / h);\r\n      const displayW = w * scale;\r\n      const displayH = h * scale;\r\n      const displayX = (cw - displayW) / 2;\r\n      const displayY = (ch - displayH) / 2;\r\n\r\n      setDisplayParams({ scale, x: displayX, y: displayY });\r\n\r\n      previewCanvasRef.current.width = w;\r\n      previewCanvasRef.current.height = h;\r\n      maskCanvasRef.current.width = w;\r\n      maskCanvasRef.current.height = h;\r\n\r\n      // Overlay canvas matches container size (screen pixels)\r\n      overlayCanvasRef.current.width = cw;\r\n      overlayCanvasRef.current.height = ch;\r\n\r\n      const ctx = previewCanvasRef.current.getContext('2d')!;\r\n      ctx.drawImage(sourceCanvas, 0, 0);\r\n\r\n      const maskCtx = maskCanvasRef.current.getContext('2d')!;\r\n      maskCtx.fillStyle = 'white';\r\n      maskCtx.fillRect(0, 0, w, h);\r\n\r\n      saveHistory();\r\n    }\r\n  }, [open, sourceCanvas]);\r\n\r\n  const saveHistory = () => {\r\n    if (!maskCanvasRef.current) return;\r\n    const ctx = maskCanvasRef.current.getContext('2d')!;\r\n    const data = ctx.getImageData(0, 0, maskCanvasRef.current.width, maskCanvasRef.current.height);\r\n    const newHistory = history.slice(0, historyIndex + 1);\r\n    newHistory.push(data);\r\n    setHistory(newHistory);\r\n    setHistoryIndex(newHistory.length - 1);\r\n  };\r\n\r\n  const undo = () => {\r\n    if (historyIndex > 0) {\r\n      const newIndex = historyIndex - 1;\r\n      const data = history[newIndex];\r\n      const ctx = maskCanvasRef.current!.getContext('2d')!;\r\n      ctx.putImageData(data, 0, 0);\r\n      setHistoryIndex(newIndex);\r\n      updatePreview();\r\n    }\r\n  };\r\n\r\n  const redo = () => {\r\n    if (historyIndex < history.length - 1) {\r\n      const newIndex = historyIndex + 1;\r\n      const data = history[newIndex];\r\n      const ctx = maskCanvasRef.current!.getContext('2d')!;\r\n      ctx.putImageData(data, 0, 0);\r\n      setHistoryIndex(newIndex);\r\n      updatePreview();\r\n    }\r\n  };\r\n\r\n  const updatePreview = () => {\r\n    if (!sourceCanvas || !previewCanvasRef.current || !maskCanvasRef.current) return;\r\n\r\n    const w = sourceCanvas.width;\r\n    const h = sourceCanvas.height;\r\n    const ctx = previewCanvasRef.current.getContext('2d')!;\r\n    const maskCtx = maskCanvasRef.current.getContext('2d')!;\r\n\r\n    // 1. Draw original image\r\n    ctx.clearRect(0, 0, w, h);\r\n    ctx.drawImage(sourceCanvas, 0, 0);\r\n\r\n    // 2. Calculate auto-mask from color\r\n    const imageData = ctx.getImageData(0, 0, w, h);\r\n    const alphaMap = calculateColorRemovalAlphaMap(\r\n      imageData.data,\r\n      activeColor,\r\n      tolerance,\r\n      invert,\r\n      feather,\r\n    );\r\n\r\n    // 3. Combine with manual mask\r\n    const manualMaskData = maskCtx.getImageData(0, 0, w, h);\r\n    const finalImageData = ctx.createImageData(w, h);\r\n\r\n    for (let i = 0; i < w * h; i++) {\r\n      const r = imageData.data[i * 4];\r\n      const g = imageData.data[i * 4 + 1];\r\n      const b = imageData.data[i * 4 + 2];\r\n      const a = imageData.data[i * 4 + 3];\r\n\r\n      const autoAlpha = alphaMap[i];\r\n      const manualAlpha = manualMaskData.data[i * 4]; // Red channel of white mask\r\n\r\n      // Combine alphas (multiply)\r\n      const finalAlpha = a * (autoAlpha / 255) * (manualAlpha / 255);\r\n\r\n      finalImageData.data[i * 4] = r;\r\n      finalImageData.data[i * 4 + 1] = g;\r\n      finalImageData.data[i * 4 + 2] = b;\r\n      finalImageData.data[i * 4 + 3] = finalAlpha;\r\n    }\r\n\r\n    if (previewMode === 'mask') {\r\n      // Draw mask only (black and white)\r\n      for (let i = 0; i < w * h; i++) {\r\n        const alpha = finalImageData.data[i * 4 + 3];\r\n        finalImageData.data[i * 4] = alpha;\r\n        finalImageData.data[i * 4 + 1] = alpha;\r\n        finalImageData.data[i * 4 + 2] = alpha;\r\n        finalImageData.data[i * 4 + 3] = 255;\r\n      }\r\n    }\r\n\r\n    ctx.putImageData(finalImageData, 0, 0);\r\n  };\r\n\r\n  useEffect(() => {\r\n    updatePreview();\r\n  }, [tolerance, invert, feather, activeColor, previewMode, historyIndex]);\r\n\r\n  const pickColor = (e: React.MouseEvent) => {\r\n    if (!sourceCanvas || !overlayCanvasRef.current) return;\r\n    const coords = getCanvasCoords(e, overlayCanvasRef, displayParams.scale, {\r\n      x: displayParams.x,\r\n      y: displayParams.y,\r\n    });\r\n    if (coords) {\r\n      const ctx = sourceCanvas.getContext('2d');\r\n      if (!ctx) return;\r\n      const x = Math.max(0, Math.min(coords.x, sourceCanvas.width - 1));\r\n      const y = Math.max(0, Math.min(coords.y, sourceCanvas.height - 1));\r\n      const pixel = ctx.getImageData(x, y, 1, 1).data;\r\n      const hex =\r\n        '#' + [pixel[0], pixel[1], pixel[2]].map((x) => x.toString(16).padStart(2, '0')).join('');\r\n      setActiveColor(hex);\r\n    }\r\n  };\r\n\r\n  const handleMouseDown = (e: React.MouseEvent) => {\r\n    if (isAltPressed) {\r\n      pickColor(e);\r\n      return;\r\n    }\r\n    setIsDrawing(true);\r\n    const coords = getCanvasCoords(e, overlayCanvasRef, displayParams.scale, {\r\n      x: displayParams.x,\r\n      y: displayParams.y,\r\n    });\r\n    if (coords) {\r\n      drawPoints.current = [coords];\r\n      lastDrawPoint.current = coords;\r\n      draw([coords]);\r\n    }\r\n  };\r\n\r\n  const handleMouseMove = (e: React.MouseEvent) => {\r\n    const coords = getCanvasCoords(e, overlayCanvasRef, displayParams.scale, {\r\n      x: displayParams.x,\r\n      y: displayParams.y,\r\n    });\r\n    setCursorPos(coords);\r\n\r\n    // when alt is pressed, sample color under cursor and show preview\r\n    if (isAltPressed && coords && sourceCanvas) {\r\n      try {\r\n        const ctx = sourceCanvas.getContext('2d');\r\n        if (ctx) {\r\n          const x = Math.max(0, Math.min(coords.x, sourceCanvas.width - 1));\r\n          const y = Math.max(0, Math.min(coords.y, sourceCanvas.height - 1));\r\n          const pixel = ctx.getImageData(x, y, 1, 1).data;\r\n          const hex =\r\n            '#' +\r\n            [pixel[0], pixel[1], pixel[2]].map((v) => v.toString(16).padStart(2, '0')).join('');\r\n          setPreviewColor(hex);\r\n        }\r\n      } catch (err) {\r\n        setPreviewColor(null);\r\n      }\r\n    } else {\r\n      setPreviewColor(null);\r\n    }\r\n\r\n    if (isAltPressed) return;\r\n\r\n    if (isDrawing && coords && lastDrawPoint.current) {\r\n      drawPoints.current.push(coords);\r\n      draw([lastDrawPoint.current, coords]);\r\n      lastDrawPoint.current = coords;\r\n    }\r\n  };\r\n\r\n  const handleMouseUp = () => {\r\n    if (isDrawing) {\r\n      setIsDrawing(false);\r\n      drawPoints.current = [];\r\n      lastDrawPoint.current = null;\r\n      saveHistory();\r\n      updatePreview();\r\n    }\r\n  };\r\n\r\n  const draw = (points: { x: number; y: number }[]) => {\r\n    if (!maskCanvasRef.current) return;\r\n    const ctx = maskCanvasRef.current.getContext('2d')!;\r\n\r\n    const settings: BrushSettings = {\r\n      color: brushMode === 'remove' ? '#000000' : '#ffffff',\r\n      lineWidth: brushSize,\r\n      opacity: brushOpacity,\r\n      flow: 1,\r\n      type: brushType,\r\n    };\r\n\r\n    drawBrushStroke(ctx, points, settings);\r\n\r\n    // Update preview immediately for better feedback\r\n    updatePreview();\r\n  };\r\n\r\n  // Draw cursor\r\n  useEffect(() => {\r\n    if (!overlayCanvasRef.current || !cursorPos) return;\r\n    const ctx = overlayCanvasRef.current.getContext('2d')!;\r\n    ctx.clearRect(0, 0, overlayCanvasRef.current.width, overlayCanvasRef.current.height);\r\n\r\n    const screenX = cursorPos.x * displayParams.scale + displayParams.x;\r\n    const screenY = cursorPos.y * displayParams.scale + displayParams.y;\r\n    const screenSize = brushSize * displayParams.scale;\r\n\r\n    // draw brush cursor\r\n    drawBrushCursor(ctx, screenX, screenY, screenSize, '#fff');\r\n    drawBrushCursor(ctx, screenX, screenY, screenSize, '#000'); // Double outline for visibility\r\n\r\n    // draw live color preview when alt is pressed\r\n    if (isAltPressed && previewColor) {\r\n      const previewRadius = 9;\r\n      const offset = 12; // offset so preview doesn't sit under cursor\r\n      const px = Math.min(\r\n        overlayCanvasRef.current.width - previewRadius - 4,\r\n        Math.max(previewRadius + 4, screenX + offset),\r\n      );\r\n      const py = Math.min(\r\n        overlayCanvasRef.current.height - previewRadius - 4,\r\n        Math.max(previewRadius + 4, screenY + offset),\r\n      );\r\n\r\n      // outer border\r\n      ctx.beginPath();\r\n      ctx.arc(px, py, previewRadius + 2, 0, Math.PI * 2);\r\n      ctx.fillStyle = '#00000088';\r\n      ctx.fill();\r\n\r\n      // color circle\r\n      ctx.beginPath();\r\n      ctx.arc(px, py, previewRadius, 0, Math.PI * 2);\r\n      ctx.fillStyle = previewColor;\r\n      ctx.fill();\r\n\r\n      // hex label\r\n      ctx.font = '12px sans-serif';\r\n      ctx.fillStyle = '#fff';\r\n      ctx.textAlign = 'center';\r\n      ctx.fillText(previewColor.toUpperCase(), px, py + previewRadius + 14);\r\n    }\r\n  }, [cursorPos, brushSize, displayParams, isAltPressed, previewColor]);\r\n\r\n  const handleApply = () => {\r\n    if (previewCanvasRef.current) {\r\n      onApply(previewCanvasRef.current);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Mask\"\r\n      open={open}\r\n      onCancel={onCancel}\r\n      onOk={handleApply}\r\n      width={1000}\r\n      style={{ top: 20 }}\r\n      maskClosable={false}\r\n    >\r\n      <div style={{ display: 'flex', gap: 16 }}>\r\n        <div style={{ width: 300 }}>\r\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n            <div>\r\n              <span>Target Color:</span>\r\n              <ColorPicker\r\n                value={activeColor}\r\n                onChange={(c) => setActiveColor(c.toHexString())}\r\n                showText\r\n              />\r\n              <div style={{ fontSize: 12, color: '#999', marginTop: 4 }}>\r\n                Hold Alt + Click on image to pick color\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <span>Tolerance: {tolerance}%</span>\r\n              <Slider value={tolerance} onChange={setTolerance} />\r\n            </div>\r\n            <div>\r\n              <span>Feather: {feather}%</span>\r\n              <Slider value={feather} onChange={setFeather} />\r\n            </div>\r\n            <div>\r\n              <Space>\r\n                <span>Invert:</span>\r\n                <Button onClick={() => setInvert(!invert)} type={invert ? 'primary' : 'default'}>\r\n                  {invert ? 'Yes' : 'No'}\r\n                </Button>\r\n              </Space>\r\n            </div>\r\n            <div>\r\n              <span>Preview Mode:</span>\r\n              <Radio.Group value={previewMode} onChange={(e) => setPreviewMode(e.target.value)}>\r\n                <Radio.Button value=\"normal\">Normal</Radio.Button>\r\n                <Radio.Button value=\"mask\">Mask</Radio.Button>\r\n              </Radio.Group>\r\n            </div>\r\n\r\n            <div style={{ borderTop: '1px solid #eee', paddingTop: 16, marginTop: 16 }}>\r\n              <h4>Manual Adjustments</h4>\r\n              <Space>\r\n                <Button\r\n                  type={brushMode === 'remove' ? 'primary' : 'default'}\r\n                  onClick={() => setBrushMode('remove')}\r\n                >\r\n                  Remove\r\n                </Button>\r\n                <Button\r\n                  type={brushMode === 'keep' ? 'primary' : 'default'}\r\n                  onClick={() => setBrushMode('keep')}\r\n                >\r\n                  Keep\r\n                </Button>\r\n              </Space>\r\n              <div>\r\n                <span>Size: {brushSize}</span>\r\n                <Slider min={1} max={100} value={brushSize} onChange={setBrushSize} />\r\n              </div>\r\n              <div>\r\n                <span>Opacity: {brushOpacity}</span>\r\n                <Slider\r\n                  min={0}\r\n                  max={1}\r\n                  step={0.1}\r\n                  value={brushOpacity}\r\n                  onChange={setBrushOpacity}\r\n                />\r\n              </div>\r\n              <div>\r\n                <span>Hardness:</span>\r\n                <Radio.Group value={brushType} onChange={(e) => setBrushType(e.target.value)}>\r\n                  <Radio.Button value=\"hard\">Hard</Radio.Button>\r\n                  <Radio.Button value=\"soft\">Soft</Radio.Button>\r\n                </Radio.Group>\r\n              </div>\r\n            </div>\r\n\r\n            <Space>\r\n              <Button icon={<UndoOutlined />} onClick={undo} disabled={historyIndex <= 0} />\r\n              <Button\r\n                icon={<RedoOutlined />}\r\n                onClick={redo}\r\n                disabled={historyIndex >= history.length - 1}\r\n              />\r\n            </Space>\r\n          </Space>\r\n        </div>\r\n\r\n        <div\r\n          ref={containerRef}\r\n          style={{\r\n            flex: 1,\r\n            position: 'relative',\r\n            border: '1px solid #ccc',\r\n            height: 500,\r\n            overflow: 'hidden',\r\n            background:\r\n              'url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==)',\r\n          }}\r\n        >\r\n          <canvas\r\n            ref={previewCanvasRef}\r\n            style={{\r\n              position: 'absolute',\r\n              top: displayParams.y,\r\n              left: displayParams.x,\r\n              width: displayParams.scale * (sourceCanvas?.width || 0),\r\n              height: displayParams.scale * (sourceCanvas?.height || 0),\r\n            }}\r\n          />\r\n          <canvas\r\n            ref={overlayCanvasRef}\r\n            style={{\r\n              position: 'absolute',\r\n              top: 0,\r\n              left: 0,\r\n              width: '100%',\r\n              height: '100%',\r\n              cursor: isAltPressed ? 'crosshair' : 'none',\r\n            }}\r\n            onMouseDown={handleMouseDown}\r\n            onMouseMove={handleMouseMove}\r\n            onMouseUp={handleMouseUp}\r\n            onMouseLeave={handleMouseUp}\r\n          />\r\n          {/* Hidden mask canvas */}\r\n          <canvas ref={maskCanvasRef} style={{ display: 'none' }} />\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ColorRemovalModal;\r\n","import React from 'react';\r\nimport { List, Card, Button, Popconfirm, Image, Typography } from 'antd';\r\nimport { DeleteOutlined, FolderOpenOutlined } from '@ant-design/icons';\r\nimport { SavedProject } from '../types';\r\n\r\ninterface SavedProjectsListProps {\r\n  projects: SavedProject[];\r\n  onLoad: (project: SavedProject) => void;\r\n  onDelete: (id: string) => void;\r\n}\r\n\r\nconst SavedProjectsList: React.FC<SavedProjectsListProps> = ({ projects, onLoad, onDelete }) => {\r\n  if (projects.length === 0) {\r\n    return (\r\n      <div style={{ textAlign: 'center', padding: '20px' }}>\r\n        <Typography.Text type=\"secondary\">No saved projects found.</Typography.Text>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <List\r\n      grid={{ gutter: 16, column: 3 }}\r\n      dataSource={projects}\r\n      renderItem={(item) => (\r\n        <List.Item>\r\n          <Card\r\n            hoverable\r\n            cover={\r\n              <div\r\n                style={{\r\n                  height: 150,\r\n                  overflow: 'hidden',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'center',\r\n                  background: '#f0f0f0',\r\n                }}\r\n              >\r\n                <Image\r\n                  src={item.thumbnail}\r\n                  preview={false}\r\n                  style={{ maxHeight: '100%', maxWidth: '100%', objectFit: 'contain' }}\r\n                />\r\n              </div>\r\n            }\r\n            actions={[\r\n              <Button type=\"text\" icon={<FolderOpenOutlined />} onClick={() => onLoad(item)}>\r\n                Load\r\n              </Button>,\r\n              <Popconfirm\r\n                title=\"Delete project?\"\r\n                onConfirm={() => onDelete(item.id)}\r\n                okText=\"Yes\"\r\n                cancelText=\"No\"\r\n              >\r\n                <Button type=\"text\" danger icon={<DeleteOutlined />}>\r\n                  Delete\r\n                </Button>\r\n              </Popconfirm>,\r\n            ]}\r\n          >\r\n            <Card.Meta title={item.name} description={new Date(item.updatedAt).toLocaleString()} />\r\n          </Card>\r\n        </List.Item>\r\n      )}\r\n    />\r\n  );\r\n};\r\n\r\nexport default SavedProjectsList;\r\n","import React from 'react';\r\nimport { Modal } from 'antd';\r\nimport { SavedProject } from '../types';\r\nimport SavedProjectsList from './SavedProjectsList';\r\n\r\ninterface ProjectModalProps {\r\n  visible: boolean;\r\n  onCancel: () => void;\r\n  projects: SavedProject[];\r\n  onLoad: (project: SavedProject) => void;\r\n  onDelete: (id: string) => void;\r\n}\r\n\r\nconst ProjectModal: React.FC<ProjectModalProps> = ({\r\n  visible,\r\n  onCancel,\r\n  projects,\r\n  onLoad,\r\n  onDelete,\r\n}) => {\r\n  return (\r\n    <Modal title=\"Saved Projects\" open={visible} onCancel={onCancel} footer={null} width={800}>\r\n      <SavedProjectsList projects={projects} onLoad={onLoad} onDelete={onDelete} />\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ProjectModal;\r\n","import { SavedProject } from '../types';\r\n\r\nconst DB_NAME = 'PhotoEditorDB';\r\nconst DB_VERSION = 1;\r\nconst STORE_PROJECTS = 'projects';\r\n\r\nexport const initDB = (): Promise<IDBDatabase> => {\r\n  return new Promise((resolve, reject) => {\r\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\r\n\r\n    request.onerror = () => {\r\n      reject('Error opening database');\r\n    };\r\n\r\n    request.onsuccess = (event) => {\r\n      resolve((event.target as IDBOpenDBRequest).result);\r\n    };\r\n\r\n    request.onupgradeneeded = (event) => {\r\n      const db = (event.target as IDBOpenDBRequest).result;\r\n      if (!db.objectStoreNames.contains(STORE_PROJECTS)) {\r\n        db.createObjectStore(STORE_PROJECTS, { keyPath: 'id' });\r\n      }\r\n    };\r\n  });\r\n};\r\n\r\nexport const saveProjectToDB = async (project: SavedProject): Promise<void> => {\r\n  const db = await initDB();\r\n  return new Promise((resolve, reject) => {\r\n    const transaction = db.transaction([STORE_PROJECTS], 'readwrite');\r\n    const store = transaction.objectStore(STORE_PROJECTS);\r\n    const request = store.put(project);\r\n\r\n    request.onsuccess = () => resolve();\r\n    request.onerror = () => reject('Error saving project');\r\n  });\r\n};\r\n\r\nexport const getAllProjectsFromDB = async (): Promise<SavedProject[]> => {\r\n  const db = await initDB();\r\n  return new Promise((resolve, reject) => {\r\n    const transaction = db.transaction([STORE_PROJECTS], 'readonly');\r\n    const store = transaction.objectStore(STORE_PROJECTS);\r\n    const request = store.getAll();\r\n\r\n    request.onsuccess = () => {\r\n      const projects = request.result as SavedProject[];\r\n      // Sort by updatedAt desc\r\n      projects.sort((a, b) => b.updatedAt - a.updatedAt);\r\n      resolve(projects);\r\n    };\r\n    request.onerror = () => reject('Error fetching projects');\r\n  });\r\n};\r\n\r\nexport const deleteProjectFromDB = async (id: string): Promise<void> => {\r\n  const db = await initDB();\r\n  return new Promise((resolve, reject) => {\r\n    const transaction = db.transaction([STORE_PROJECTS], 'readwrite');\r\n    const store = transaction.objectStore(STORE_PROJECTS);\r\n    const request = store.delete(id);\r\n\r\n    request.onsuccess = () => resolve();\r\n    request.onerror = () => reject('Error deleting project');\r\n  });\r\n};\r\n","import { useState, useEffect, useCallback } from 'react';\r\nimport { message } from 'antd';\r\nimport { SavedProject } from '../types';\r\nimport { getAllProjectsFromDB, saveProjectToDB, deleteProjectFromDB } from '../utils/storage';\r\n\r\nexport const useProjects = () => {\r\n  const [savedProjects, setSavedProjects] = useState<SavedProject[]>([]);\r\n  const [currentProject, setCurrentProject] = useState<SavedProject | null>(null);\r\n\r\n  const loadProjects = useCallback(() => {\r\n    getAllProjectsFromDB()\r\n      .then(setSavedProjects)\r\n      .catch((err) => console.error('Failed to load projects from DB', err));\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadProjects();\r\n  }, [loadProjects]);\r\n\r\n  const saveProject = useCallback(\r\n    async (preview: string, json: any) => {\r\n      if (!preview) return;\r\n\r\n      const newProject: SavedProject = {\r\n        id: currentProject?.id || Date.now().toString(),\r\n        name: currentProject?.name || `Project ${new Date().toLocaleString()}`,\r\n        thumbnail: preview,\r\n        json: json,\r\n        createdAt: currentProject?.createdAt || Date.now(),\r\n        updatedAt: Date.now(),\r\n      };\r\n\r\n      try {\r\n        await saveProjectToDB(newProject);\r\n\r\n        // Update local state\r\n        setSavedProjects((prev) => {\r\n          const exists = prev.some((p) => p.id === newProject.id);\r\n          const updated = exists\r\n            ? prev.map((p) => (p.id === newProject.id ? newProject : p))\r\n            : [newProject, ...prev];\r\n\r\n          // Sort by updatedAt desc\r\n          return updated.sort((a, b) => b.updatedAt - a.updatedAt);\r\n        });\r\n\r\n        setCurrentProject(newProject);\r\n        message.success('Project saved successfully!');\r\n      } catch (err) {\r\n        console.error(err);\r\n        message.error('Failed to save project');\r\n      }\r\n    },\r\n    [currentProject],\r\n  );\r\n\r\n  const deleteProject = useCallback(async (id: string) => {\r\n    try {\r\n      await deleteProjectFromDB(id);\r\n      setSavedProjects((prev) => prev.filter((p) => p.id !== id));\r\n      message.success('Project deleted');\r\n    } catch (err) {\r\n      console.error(err);\r\n      message.error('Failed to delete project');\r\n    }\r\n  }, []);\r\n\r\n  const loadProjectIntoEditor = useCallback((project: SavedProject) => {\r\n    setCurrentProject(project);\r\n  }, []);\r\n\r\n  const clearCurrentProject = useCallback(() => {\r\n    setCurrentProject(null);\r\n  }, []);\r\n\r\n  return {\r\n    savedProjects,\r\n    currentProject,\r\n    loadProjects,\r\n    saveProject,\r\n    deleteProject,\r\n    loadProjectIntoEditor,\r\n    clearCurrentProject,\r\n    setCurrentProject,\r\n  };\r\n};\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Button, Tooltip, Space, Divider, Dropdown, Menu } from 'antd';\r\nimport {\r\n  DragOutlined,\r\n  BorderOutlined,\r\n  PlusCircleOutlined,\r\n  FontSizeOutlined,\r\n  FileImageOutlined,\r\n  DeleteOutlined,\r\n  UndoOutlined,\r\n  RedoOutlined,\r\n  HighlightOutlined,\r\n  ExportOutlined,\r\n  ScissorOutlined,\r\n  BgColorsOutlined,\r\n  CopyOutlined,\r\n  SnippetsOutlined,\r\n  SaveOutlined,\r\n  FolderOpenOutlined,\r\n  MoreOutlined,\r\n  UploadOutlined,\r\n} from '@ant-design/icons';\r\nimport { Rect, Circle, IText, FabricImage, ActiveSelection } from 'fabric';\r\nimport { usePhotoEditor } from '../context';\r\nimport ExportModal from './ExportModal';\r\nimport LayerMaskModal from './LayerMaskModal';\r\nimport ProjectModal from './ProjectModal';\r\nimport { useProjects } from '../hooks/useProjects';\r\nimport { applyMaskToFabricObject } from '../utils/effectsHelpers';\r\n\r\nconst Toolbar: React.FC = () => {\r\n  const { canvas, setActiveTool, activeTool, history, selectedObject, clipboard, setClipboard } =\r\n    usePhotoEditor();\r\n  const [exportModalVisible, setExportModalVisible] = useState(false);\r\n  const [maskModalVisible, setMaskModalVisible] = useState(false);\r\n  const [projectModalVisible, setProjectModalVisible] = useState(false);\r\n\r\n  const { savedProjects, saveProject, deleteProject, loadProjects } = useProjects();\r\n\r\n  const handleSaveProject = () => {\r\n    if (!canvas) return;\r\n    const json = canvas.toJSON();\r\n    const preview = canvas.toDataURL({ format: 'png', multiplier: 0.5 });\r\n    saveProject(preview, json);\r\n  };\r\n\r\n  const handleLoadProject = (project: any) => {\r\n    if (!canvas) return;\r\n    canvas.loadFromJSON(project.json).then(() => {\r\n      canvas.renderAll();\r\n      setProjectModalVisible(false);\r\n      history.saveState();\r\n    });\r\n  };\r\n\r\n  const copy = async () => {\r\n    if (!canvas) return;\r\n    const activeObject = canvas.getActiveObject();\r\n    if (activeObject) {\r\n      const cloned = await activeObject.clone();\r\n      setClipboard(cloned);\r\n    }\r\n  };\r\n\r\n  const paste = async () => {\r\n    if (!canvas || !clipboard) return;\r\n    const clonedObj = await clipboard.clone();\r\n    canvas.discardActiveObject();\r\n\r\n    clonedObj.set({\r\n      left: (clonedObj.left || 0) + 10,\r\n      top: (clonedObj.top || 0) + 10,\r\n      evented: true,\r\n    });\r\n\r\n    if (clonedObj instanceof ActiveSelection) {\r\n      // active selection needs a reference to the canvas.\r\n      clonedObj.canvas = canvas;\r\n      clonedObj.forEachObject((obj) => {\r\n        canvas.add(obj);\r\n      });\r\n      clonedObj.setCoords();\r\n    } else {\r\n      canvas.add(clonedObj);\r\n    }\r\n\r\n    canvas.setActiveObject(clonedObj);\r\n    canvas.requestRenderAll();\r\n    history.saveState();\r\n  };\r\n\r\n  const handleImportProjectFile = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    if (!canvas) return;\r\n    const file = e.target.files && e.target.files[0];\r\n    if (!file) return;\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = (ev) => {\r\n      try {\r\n        const text = ev.target?.result as string;\r\n        const json = JSON.parse(text);\r\n        canvas.loadFromJSON(json, () => {\r\n          canvas.renderAll();\r\n          history.saveState();\r\n        });\r\n      } catch (err) {\r\n        // eslint-disable-next-line no-console\r\n        console.error('Failed to import project JSON', err);\r\n        // message could be used but importing antd here would duplicate import; use alert as fallback\r\n        // If you prefer antd message, we can import it at top.\r\n        alert('Failed to import project file. Make sure it is a valid project JSON.');\r\n      }\r\n    };\r\n    reader.readAsText(file);\r\n    // reset input so same file can be re-imported if needed\r\n    e.currentTarget.value = '';\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      // Ignore if typing in an input or textarea\r\n      if (\r\n        (e.target as HTMLElement).tagName === 'INPUT' ||\r\n        (e.target as HTMLElement).tagName === 'TEXTAREA'\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      // Ignore if editing text on canvas\r\n      if (\r\n        canvas?.getActiveObject() instanceof IText &&\r\n        (canvas.getActiveObject() as IText).isEditing\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'v' || e.key === 'V') setActiveTool('select');\r\n      if (e.key === 'b' || e.key === 'B') setActiveTool('brush');\r\n      if (e.key === 'm' || e.key === 'M') {\r\n        if (selectedObject instanceof FabricImage) setMaskModalVisible(true);\r\n      }\r\n      if (e.key === 'r' || e.key === 'R') addRectangle();\r\n      if (e.key === 't' || e.key === 'T') setActiveTool('text');\r\n\r\n      if (e.key === 'Delete' || e.key === 'Backspace') deleteSelected();\r\n\r\n      if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\r\n        e.preventDefault();\r\n        if (e.shiftKey) {\r\n          history.redo();\r\n        } else {\r\n          history.undo();\r\n        }\r\n      }\r\n      if ((e.ctrlKey || e.metaKey) && e.key === 'y') {\r\n        e.preventDefault();\r\n        history.redo();\r\n      }\r\n\r\n      if ((e.ctrlKey || e.metaKey) && e.key === 'c') {\r\n        e.preventDefault();\r\n        copy();\r\n      }\r\n\r\n      if ((e.ctrlKey || e.metaKey) && e.key === 'v') {\r\n        e.preventDefault();\r\n        paste();\r\n      }\r\n\r\n      if ((e.ctrlKey || e.metaKey) && e.key === 's') {\r\n        e.preventDefault();\r\n        handleSaveProject();\r\n      }\r\n\r\n      if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'S') {\r\n        e.preventDefault();\r\n        setExportModalVisible(true);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [canvas, selectedObject, history, activeTool, clipboard]);\r\n\r\n  const addRectangle = () => {\r\n    if (!canvas) return;\r\n    const rect = new Rect({\r\n      left: 100,\r\n      top: 100,\r\n      fill: '#ff0000',\r\n      width: 100,\r\n      height: 100,\r\n    });\r\n    canvas.add(rect);\r\n    canvas.setActiveObject(rect);\r\n    history.saveState();\r\n  };\r\n\r\n  const addCircle = () => {\r\n    if (!canvas) return;\r\n    const circle = new Circle({\r\n      left: 100,\r\n      top: 100,\r\n      fill: '#00ff00',\r\n      radius: 50,\r\n    });\r\n    canvas.add(circle);\r\n    canvas.setActiveObject(circle);\r\n    history.saveState();\r\n  };\r\n\r\n  const addText = () => {\r\n    if (!canvas) return;\r\n    const text = new IText('Text', {\r\n      left: 100,\r\n      top: 100,\r\n      fontSize: 24,\r\n    });\r\n    canvas.add(text);\r\n    canvas.setActiveObject(text);\r\n    setActiveTool('text');\r\n    history.saveState();\r\n  };\r\n\r\n  const handleImageUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    if (!canvas || !e.target.files || !e.target.files[0]) return;\r\n    const file = e.target.files[0];\r\n    const reader = new FileReader();\r\n    reader.onload = (f) => {\r\n      const data = f.target?.result as string;\r\n      FabricImage.fromURL(data).then((img) => {\r\n        img.scaleToWidth(200);\r\n        canvas.add(img);\r\n        canvas.centerObject(img);\r\n        canvas.setActiveObject(img);\r\n        history.saveState();\r\n      });\r\n    };\r\n    reader.readAsDataURL(file);\r\n  };\r\n\r\n  const deleteSelected = () => {\r\n    if (!canvas) return;\r\n    const activeObjects = canvas.getActiveObjects();\r\n    if (activeObjects.length) {\r\n      canvas.discardActiveObject();\r\n      activeObjects.forEach((obj) => {\r\n        canvas.remove(obj);\r\n      });\r\n      history.saveState();\r\n    }\r\n  };\r\n\r\n  const handleApplyMask = (maskCanvas: HTMLCanvasElement) => {\r\n    if (!canvas || !selectedObject) return;\r\n    applyMaskToFabricObject(canvas, selectedObject, maskCanvas);\r\n    history.saveState();\r\n    setMaskModalVisible(false);\r\n  };\r\n\r\n  const getSelectedImageCanvas = (): HTMLCanvasElement | null => {\r\n    if (!selectedObject || !(selectedObject instanceof FabricImage)) return null;\r\n    const imgElement = selectedObject.getElement() as HTMLImageElement | HTMLCanvasElement;\r\n    const tempCanvas = document.createElement('canvas');\r\n    tempCanvas.width = imgElement.width;\r\n    tempCanvas.height = imgElement.height;\r\n    const ctx = tempCanvas.getContext('2d');\r\n    if (ctx) {\r\n      ctx.drawImage(imgElement, 0, 0);\r\n    }\r\n    return tempCanvas;\r\n  };\r\n\r\n  const isImageSelected = selectedObject instanceof FabricImage;\r\n\r\n  return (\r\n    <Space direction=\"vertical\" style={{ padding: '8px' }}>\r\n      <Tooltip title=\"Select (V)\">\r\n        <Button\r\n          type={activeTool === 'select' ? 'primary' : 'default'}\r\n          icon={<DragOutlined />}\r\n          onClick={() => setActiveTool('select')}\r\n        />\r\n      </Tooltip>\r\n      <Tooltip title=\"Brush (B)\">\r\n        <Button\r\n          type={activeTool === 'brush' ? 'primary' : 'default'}\r\n          icon={<HighlightOutlined />}\r\n          onClick={() => setActiveTool('brush')}\r\n        />\r\n      </Tooltip>\r\n      <Tooltip title=\"Rectangle (R)\">\r\n        <Button icon={<BorderOutlined />} onClick={addRectangle} />\r\n      </Tooltip>\r\n      <Tooltip title=\"Circle (C)\">\r\n        <Button icon={<PlusCircleOutlined />} onClick={addCircle} />\r\n      </Tooltip>\r\n      <Tooltip title=\"Text (T)\">\r\n        <Button\r\n          type={activeTool === 'text' ? 'primary' : 'default'}\r\n          icon={<FontSizeOutlined />}\r\n          onClick={() => setActiveTool('text')}\r\n        />\r\n      </Tooltip>\r\n\r\n      <input type=\"file\" id=\"image-upload\" hidden accept=\"image/*\" onChange={handleImageUpload} />\r\n      <input\r\n        type=\"file\"\r\n        id=\"project-import\"\r\n        hidden\r\n        accept=\"application/json, .json\"\r\n        onChange={handleImportProjectFile}\r\n      />\r\n\r\n      <Divider style={{ margin: '8px 0' }} />\r\n\r\n      <Tooltip title=\"Mask (M)\">\r\n        <Button\r\n          icon={<ScissorOutlined />}\r\n          onClick={() => setMaskModalVisible(true)}\r\n          disabled={!isImageSelected}\r\n        />\r\n      </Tooltip>\r\n\r\n      <Divider style={{ margin: '8px 0' }} />\r\n\r\n      <Tooltip title=\"Undo (Ctrl+Z)\">\r\n        <Button icon={<UndoOutlined />} onClick={history.undo} disabled={!history.canUndo} />\r\n      </Tooltip>\r\n      <Tooltip title=\"Redo (Ctrl+Y)\">\r\n        <Button icon={<RedoOutlined />} onClick={history.redo} disabled={!history.canRedo} />\r\n      </Tooltip>\r\n\r\n      <Divider style={{ margin: '8px 0' }} />\r\n\r\n      <Dropdown\r\n        overlay={\r\n          <Menu>\r\n            <Menu.Item\r\n              key=\"upload\"\r\n              icon={<FileImageOutlined />}\r\n              onClick={() => document.getElementById('image-upload')?.click()}\r\n            >\r\n              Upload Image\r\n            </Menu.Item>\r\n            <Menu.Item key=\"copy\" icon={<CopyOutlined />} onClick={copy} disabled={!selectedObject}>\r\n              Copy (Ctrl + C)\r\n            </Menu.Item>\r\n            <Menu.Item\r\n              key=\"paste\"\r\n              icon={<SnippetsOutlined />}\r\n              onClick={paste}\r\n              disabled={!clipboard}\r\n            >\r\n              Paste (Ctrl + V)\r\n            </Menu.Item>\r\n            <Menu.Divider />\r\n            <Menu.Item key=\"save\" icon={<SaveOutlined />} onClick={handleSaveProject}>\r\n              Save Project (Ctrl + S)\r\n            </Menu.Item>\r\n            <Menu.Item\r\n              key=\"open\"\r\n              icon={<FolderOpenOutlined />}\r\n              onClick={() => setProjectModalVisible(true)}\r\n            >\r\n              Open Projects\r\n            </Menu.Item>\r\n            <Menu.Item\r\n              key=\"import\"\r\n              icon={<UploadOutlined />}\r\n              onClick={() => document.getElementById('project-import')?.click()}\r\n            >\r\n              Import Project (JSON)\r\n            </Menu.Item>\r\n            <Menu.Item\r\n              key=\"export\"\r\n              icon={<ExportOutlined />}\r\n              onClick={() => setExportModalVisible(true)}\r\n            >\r\n              Export (Ctrl + Shift + S)\r\n            </Menu.Item>\r\n          </Menu>\r\n        }\r\n        trigger={['click']}\r\n      >\r\n        <Tooltip title=\"More\">\r\n          <Button icon={<MoreOutlined />}></Button>\r\n        </Tooltip>\r\n      </Dropdown>\r\n\r\n      <ExportModal\r\n        visible={exportModalVisible}\r\n        onCancel={() => setExportModalVisible(false)}\r\n        canvas={canvas}\r\n      />\r\n\r\n      {maskModalVisible && isImageSelected && (\r\n        <LayerMaskModal\r\n          open={maskModalVisible}\r\n          onCancel={() => setMaskModalVisible(false)}\r\n          onApply={handleApplyMask}\r\n          sourceCanvas={getSelectedImageCanvas()}\r\n          selectedColor={null}\r\n        />\r\n      )}\r\n\r\n      <ProjectModal\r\n        visible={projectModalVisible}\r\n        onCancel={() => setProjectModalVisible(false)}\r\n        projects={savedProjects}\r\n        onLoad={handleLoadProject}\r\n        onDelete={deleteProject}\r\n      />\r\n    </Space>\r\n  );\r\n};\r\n\r\nexport default Toolbar;\r\n","import { useEffect, useRef } from 'react';\r\nimport { Canvas, FabricObject } from 'fabric';\r\n\r\nexport const useKeyboardShortcuts = (canvas: Canvas | null) => {\r\n  const clipboard = useRef<FabricObject | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!canvas) return;\r\n\r\n    const handleKeyDown = async (e: KeyboardEvent) => {\r\n      // Copy\r\n      if ((e.ctrlKey || e.metaKey) && e.key === 'c') {\r\n        const activeObject = canvas.getActiveObject();\r\n        if (activeObject) {\r\n          const cloned = await activeObject.clone();\r\n          clipboard.current = cloned;\r\n        }\r\n      }\r\n\r\n      // Paste\r\n      if ((e.ctrlKey || e.metaKey) && e.key === 'v') {\r\n        if (clipboard.current) {\r\n          const clonedObj = await clipboard.current.clone();\r\n          canvas.discardActiveObject();\r\n\r\n          clonedObj.set({\r\n            left: (clonedObj.left || 0) + 10,\r\n            top: (clonedObj.top || 0) + 10,\r\n            evented: true,\r\n          });\r\n\r\n          if (clonedObj.type === 'activeSelection') {\r\n            // active selection needs a reference to the canvas.\r\n            clonedObj.canvas = canvas;\r\n            (clonedObj as any).forEachObject((obj: any) => {\r\n              canvas.add(obj);\r\n            });\r\n            clonedObj.setCoords();\r\n          } else {\r\n            canvas.add(clonedObj);\r\n          }\r\n\r\n          clipboard.current = clonedObj; // Update clipboard to allow multiple pastes with offset\r\n          canvas.setActiveObject(clonedObj);\r\n          canvas.requestRenderAll();\r\n        }\r\n      }\r\n\r\n      // Brush Size\r\n      if (canvas.isDrawingMode && canvas.freeDrawingBrush) {\r\n        if (e.key === '[') {\r\n          canvas.freeDrawingBrush.width = Math.max(1, canvas.freeDrawingBrush.width - 5);\r\n        } else if (e.key === ']') {\r\n          canvas.freeDrawingBrush.width += 5;\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyDown);\r\n    };\r\n  }, [canvas]);\r\n};\r\n","import React, { useEffect, useRef } from 'react';\r\nimport { Canvas, Image, PencilBrush, IText } from 'fabric';\r\nimport { usePhotoEditor } from '../context';\r\nimport { useKeyboardShortcuts } from '../hooks/useKeyboardShortcuts';\r\n\r\nconst CanvasArea: React.FC = () => {\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const {\r\n    canvas,\r\n    setCanvas,\r\n    selectedObject,\r\n    setSelectedObject,\r\n    history,\r\n    imageUrl,\r\n    initialProject,\r\n    activeTool,\r\n    addOnFile,\r\n    setAddOnFile,\r\n    setActiveTool,\r\n  } = usePhotoEditor();\r\n\r\n  const isEditingRef = useRef(false);\r\n\r\n  useKeyboardShortcuts(canvas);\r\n\r\n  const altPressedRef = useRef(false);\r\n  const previewDivRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!canvas || !addOnFile) return;\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = (f) => {\r\n      const data = f.target?.result as string;\r\n      Image.fromURL(data).then((img) => {\r\n        img.scaleToWidth(200);\r\n        canvas.add(img);\r\n        canvas.centerObject(img);\r\n        canvas.setActiveObject(img);\r\n        history.saveState();\r\n        if (setAddOnFile) setAddOnFile(null);\r\n      });\r\n    };\r\n    reader.readAsDataURL(addOnFile);\r\n  }, [addOnFile, canvas]);\r\n\r\n  // Alt+hover preview and Alt+click to pick brush color when activeTool === 'brush'\r\n  useEffect(() => {\r\n    if (!canvas || !containerRef.current) return;\r\n\r\n    const container = containerRef.current;\r\n    const lower = (canvas.lowerCanvasEl as HTMLCanvasElement) || null;\r\n\r\n    // create preview div\r\n    const preview = document.createElement('div');\r\n    preview.style.position = 'absolute';\r\n    preview.style.pointerEvents = 'none';\r\n    preview.style.width = '28px';\r\n    preview.style.height = '28px';\r\n    preview.style.borderRadius = '50%';\r\n    preview.style.boxShadow = '0 0 4px rgba(0,0,0,0.5)';\r\n    preview.style.border = '2px solid #fff';\r\n    preview.style.transform = 'translate(-50%, -50%)';\r\n    preview.style.display = 'none';\r\n    container.appendChild(preview);\r\n    previewDivRef.current = preview;\r\n\r\n    const onKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key === 'Alt') {\r\n        altPressedRef.current = true;\r\n        if (activeTool === 'brush') {\r\n          // disable drawing while picking\r\n          canvas.isDrawingMode = false;\r\n        }\r\n      }\r\n    };\r\n\r\n    const onKeyUp = (e: KeyboardEvent) => {\r\n      if (e.key === 'Alt') {\r\n        altPressedRef.current = false;\r\n        if (activeTool === 'brush') {\r\n          canvas.isDrawingMode = true;\r\n        }\r\n        if (previewDivRef.current) previewDivRef.current.style.display = 'none';\r\n      }\r\n    };\r\n\r\n    const onMouseMove = (opt: any) => {\r\n      if (!altPressedRef.current || activeTool !== 'brush') return;\r\n      try {\r\n        const evt = opt && opt.e;\r\n        const pointer = canvas.getPointer(evt);\r\n        if (!lower) return;\r\n        const ctx = lower.getContext('2d');\r\n        if (!ctx) return;\r\n        const x = Math.floor(pointer.x);\r\n        const y = Math.floor(pointer.y);\r\n        if (x < 0 || y < 0 || x >= lower.width || y >= lower.height) {\r\n          if (previewDivRef.current) previewDivRef.current.style.display = 'none';\r\n          return;\r\n        }\r\n        const pixel = ctx.getImageData(x, y, 1, 1).data;\r\n        const hex =\r\n          '#' + [pixel[0], pixel[1], pixel[2]].map((v) => v.toString(16).padStart(2, '0')).join('');\r\n        if (previewDivRef.current) {\r\n          previewDivRef.current.style.background = hex;\r\n          previewDivRef.current.style.display = 'block';\r\n          // position using client coords\r\n          const rect = container.getBoundingClientRect();\r\n          const clientX = evt.clientX || rect.left + pointer.x;\r\n          const clientY = evt.clientY || rect.top + pointer.y;\r\n          previewDivRef.current.style.left = clientX - rect.left + 24 + 'px';\r\n          previewDivRef.current.style.top = clientY - rect.top + 24 + 'px';\r\n        }\r\n      } catch (err) {\r\n        if (previewDivRef.current) previewDivRef.current.style.display = 'none';\r\n      }\r\n    };\r\n\r\n    const onMouseDown = (opt: any) => {\r\n      if (!altPressedRef.current || activeTool !== 'brush') return;\r\n      try {\r\n        const evt = opt && opt.e;\r\n        const pointer = canvas.getPointer(evt);\r\n        if (!lower) return;\r\n        const ctx = lower.getContext('2d');\r\n        if (!ctx) return;\r\n        const x = Math.floor(pointer.x);\r\n        const y = Math.floor(pointer.y);\r\n        if (x < 0 || y < 0 || x >= lower.width || y >= lower.height) return;\r\n        const pixel = ctx.getImageData(x, y, 1, 1).data;\r\n        const hex =\r\n          '#' + [pixel[0], pixel[1], pixel[2]].map((v) => v.toString(16).padStart(2, '0')).join('');\r\n        if (canvas.freeDrawingBrush) {\r\n          (canvas.freeDrawingBrush as any).color = hex;\r\n        }\r\n      } catch (err) {\r\n        // ignore\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', onKeyDown);\r\n    window.addEventListener('keyup', onKeyUp);\r\n    canvas.on('mouse:move', onMouseMove);\r\n    canvas.on('mouse:down', onMouseDown);\r\n\r\n    return () => {\r\n      window.removeEventListener('keydown', onKeyDown);\r\n      window.removeEventListener('keyup', onKeyUp);\r\n      canvas.off('mouse:move', onMouseMove);\r\n      canvas.off('mouse:down', onMouseDown);\r\n      if (previewDivRef.current) {\r\n        try {\r\n          container.removeChild(previewDivRef.current);\r\n        } catch (e) {\r\n          // ignore\r\n        }\r\n        previewDivRef.current = null;\r\n      }\r\n    };\r\n  }, [canvas, activeTool]);\r\n\r\n  useEffect(() => {\r\n    if (!canvasRef.current || !containerRef.current) return;\r\n\r\n    const fabricCanvas = new Canvas(canvasRef.current, {\r\n      width: containerRef.current.clientWidth,\r\n      height: containerRef.current.clientHeight,\r\n      backgroundColor: '#ffffff',\r\n      preserveObjectStacking: true, // Important for layers\r\n      selection: true,\r\n    });\r\n\r\n    setCanvas(fabricCanvas);\r\n\r\n    if (initialProject) {\r\n      fabricCanvas.loadFromJSON(initialProject.json).then(() => {\r\n        fabricCanvas.renderAll();\r\n        history.saveState();\r\n      });\r\n    } else if (imageUrl) {\r\n      Image.fromURL(imageUrl).then((img) => {\r\n        const containerWidth = containerRef.current!.clientWidth;\r\n        const containerHeight = containerRef.current!.clientHeight;\r\n\r\n        if (img.width! > containerWidth || img.height! > containerHeight) {\r\n          img.scaleToWidth(containerWidth * 0.8);\r\n        }\r\n\r\n        fabricCanvas.add(img);\r\n        fabricCanvas.centerObject(img);\r\n        fabricCanvas.setActiveObject(img);\r\n        history.saveState();\r\n      });\r\n    }\r\n\r\n    const updateSelection = () => {\r\n      const activeObjects = fabricCanvas.getActiveObjects();\r\n      if (activeObjects.length === 1) {\r\n        setSelectedObject(activeObjects[0]);\r\n      } else {\r\n        setSelectedObject(null);\r\n      }\r\n    };\r\n\r\n    fabricCanvas.on('selection:created', updateSelection);\r\n    fabricCanvas.on('selection:updated', updateSelection);\r\n    fabricCanvas.on('selection:cleared', () => setSelectedObject(null));\r\n\r\n    // When entering/exiting text editing, keep the active tool in 'text'\r\n    const onTextEnter = () => setActiveTool && setActiveTool('text');\r\n    const onTextExit = () => setActiveTool && setActiveTool('select');\r\n\r\n    fabricCanvas.on('text:editing:entered', onTextEnter);\r\n    fabricCanvas.on('text:editing:exited', onTextExit);\r\n\r\n    const saveHistory = () => {\r\n      history.saveState();\r\n    };\r\n\r\n    fabricCanvas.on('object:modified', saveHistory);\r\n    fabricCanvas.on('object:added', saveHistory);\r\n    fabricCanvas.on('object:removed', saveHistory);\r\n\r\n    const handleResize = () => {\r\n      if (containerRef.current) {\r\n        fabricCanvas.setDimensions({\r\n          width: containerRef.current.clientWidth,\r\n          height: containerRef.current.clientHeight,\r\n        });\r\n      }\r\n    };\r\n\r\n    window.addEventListener('resize', handleResize);\r\n\r\n    return () => {\r\n      fabricCanvas.dispose();\r\n      window.removeEventListener('resize', handleResize);\r\n    };\r\n  }, []);\r\n\r\n  // If selected object is a text object and is being edited, ensure the active tool is 'text'\r\n  useEffect(() => {\r\n    if (!selectedObject) return;\r\n    try {\r\n      const editing = !!(selectedObject as any).isEditing;\r\n      isEditingRef.current = editing;\r\n      if (editing) {\r\n        setActiveTool && setActiveTool('text');\r\n      }\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }, [selectedObject, setActiveTool]);\r\n\r\n  useEffect(() => {\r\n    if (!canvas) return;\r\n    if (activeTool === 'brush') {\r\n      canvas.isDrawingMode = true;\r\n      canvas.freeDrawingBrush = new PencilBrush(canvas);\r\n      canvas.freeDrawingBrush.width = 5;\r\n      canvas.freeDrawingBrush.color = 'black';\r\n    } else {\r\n      canvas.isDrawingMode = false;\r\n    }\r\n  }, [activeTool, canvas]);\r\n\r\n  // Place text on first mouse click when activeTool === 'text'\r\n  useEffect(() => {\r\n    if (!canvas) return;\r\n    if (activeTool !== 'text') return;\r\n\r\n    const handleMouseDown = (opt: any) => {\r\n      try {\r\n        // If a text object is currently being edited, do not create a new text object\r\n        if (isEditingRef.current) return;\r\n\r\n        const pointer = canvas.getViewportPoint(opt.e);\r\n        const txt = new IText('Text', {\r\n          left: pointer.x,\r\n          top: pointer.y,\r\n          fontSize: 24,\r\n        });\r\n        canvas.add(txt);\r\n        canvas.setActiveObject(txt);\r\n        setSelectedObject && setSelectedObject(txt);\r\n        txt.enterEditing && txt.enterEditing();\r\n        txt.selectAll && txt.selectAll();\r\n        canvas.requestRenderAll();\r\n        history.saveState();\r\n        // switch back to select so subsequent clicks don't add more text\r\n        setActiveTool && setActiveTool('select');\r\n      } catch (err) {\r\n        // ignore\r\n      }\r\n    };\r\n\r\n    canvas.on('mouse:down', handleMouseDown);\r\n    return () => {\r\n      canvas.off('mouse:down', handleMouseDown);\r\n    };\r\n  }, [canvas, activeTool, history, setSelectedObject, setActiveTool]);\r\n\r\n  return (\r\n    <div ref={containerRef} style={{ width: '100%', height: '100%' }}>\r\n      <canvas ref={canvasRef} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CanvasArea;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { List, Button, Typography, Space, Slider, Select } from 'antd';\r\nimport {\r\n  EyeOutlined,\r\n  EyeInvisibleOutlined,\r\n  LockOutlined,\r\n  UnlockOutlined,\r\n  DeleteOutlined,\r\n  HolderOutlined,\r\n} from '@ant-design/icons';\r\nimport { usePhotoEditor } from '../context';\r\nimport { FabricObject } from 'fabric';\r\nimport {\r\n  DndContext,\r\n  closestCenter,\r\n  KeyboardSensor,\r\n  PointerSensor,\r\n  useSensor,\r\n  useSensors,\r\n  DragEndEvent,\r\n} from '@dnd-kit/core';\r\nimport {\r\n  SortableContext,\r\n  sortableKeyboardCoordinates,\r\n  verticalListSortingStrategy,\r\n  useSortable,\r\n} from '@dnd-kit/sortable';\r\nimport { CSS } from '@dnd-kit/utilities';\r\n\r\nconst { Title } = Typography;\r\nconst { Option } = Select;\r\n\r\ninterface SortableItemProps {\r\n  id: string;\r\n  children: React.ReactNode;\r\n  isSelected: boolean;\r\n  onClick: () => void;\r\n}\r\n\r\nconst SortableItem: React.FC<SortableItemProps> = ({ id, children, isSelected, onClick }) => {\r\n  const { attributes, listeners, setNodeRef, setActivatorNodeRef, transform, transition } =\r\n    useSortable({ id });\r\n\r\n  const style = {\r\n    transform: CSS.Transform.toString(transform),\r\n    transition,\r\n    backgroundColor: isSelected ? '#e6f7ff' : 'transparent',\r\n    marginBottom: 4,\r\n    border: '1px solid #f0f0f0',\r\n    borderRadius: 4,\r\n    padding: '4px 8px',\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n  };\r\n\r\n  return (\r\n    <div ref={setNodeRef} style={style}>\r\n      <div\r\n        ref={setActivatorNodeRef}\r\n        {...attributes}\r\n        {...listeners}\r\n        style={{\r\n          cursor: 'grab',\r\n          marginRight: 8,\r\n          display: 'flex',\r\n          alignItems: 'center',\r\n          color: '#999',\r\n        }}\r\n      >\r\n        <HolderOutlined />\r\n      </div>\r\n      <div onClick={onClick} style={{ flex: 1, cursor: 'pointer' }}>\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst LayersPanel: React.FC = () => {\r\n  const { canvas, selectedObject, setSelectedObject, history } = usePhotoEditor();\r\n  const [objects, setObjects] = useState<FabricObject[]>([]);\r\n\r\n  const sensors = useSensors(\r\n    useSensor(PointerSensor),\r\n    useSensor(KeyboardSensor, {\r\n      coordinateGetter: sortableKeyboardCoordinates,\r\n    }),\r\n  );\r\n\r\n  const updateObjects = () => {\r\n    if (!canvas) return;\r\n    const objs = canvas.getObjects();\r\n    objs.forEach((obj: any) => {\r\n      if (!obj.uid) obj.uid = Math.random().toString(36).substr(2, 9);\r\n    });\r\n    // Reverse to show top layers first\r\n    setObjects([...objs].reverse());\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!canvas) return;\r\n\r\n    let timeout: NodeJS.Timeout;\r\n    const debouncedUpdate = () => {\r\n      clearTimeout(timeout);\r\n      timeout = setTimeout(updateObjects, 100);\r\n    };\r\n\r\n    canvas.on('object:added', debouncedUpdate);\r\n    canvas.on('object:removed', debouncedUpdate);\r\n    canvas.on('object:modified', debouncedUpdate);\r\n\r\n    updateObjects();\r\n\r\n    return () => {\r\n      canvas.off('object:added', debouncedUpdate);\r\n      canvas.off('object:removed', debouncedUpdate);\r\n      canvas.off('object:modified', debouncedUpdate);\r\n      clearTimeout(timeout);\r\n    };\r\n  }, [canvas]);\r\n\r\n  const handleDragEnd = (event: DragEndEvent) => {\r\n    const { active, over } = event;\r\n\r\n    if (over && active.id !== over.id) {\r\n      const oldIndex = objects.findIndex((obj: any) => obj.uid === active.id);\r\n      const newIndex = objects.findIndex((obj: any) => obj.uid === over.id);\r\n\r\n      if (oldIndex !== -1 && newIndex !== -1) {\r\n        const fabricNewIndex = objects.length - 1 - newIndex;\r\n        const obj = objects[oldIndex];\r\n\r\n        canvas?.moveObjectTo(obj, fabricNewIndex);\r\n        canvas?.requestRenderAll();\r\n        history.saveState();\r\n        updateObjects();\r\n      }\r\n    }\r\n  };\r\n\r\n  const toggleVisibility = (obj: FabricObject, e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    obj.visible = !obj.visible;\r\n    if (!obj.visible) {\r\n      canvas?.discardActiveObject();\r\n    }\r\n    canvas?.requestRenderAll();\r\n    history.saveState();\r\n    setObjects([...(canvas?.getObjects() || [])].reverse());\r\n  };\r\n\r\n  const toggleLock = (obj: FabricObject, e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    obj.lockMovementX = !obj.lockMovementX;\r\n    obj.lockMovementY = !obj.lockMovementY;\r\n    obj.lockRotation = !obj.lockRotation;\r\n    obj.lockScalingX = !obj.lockScalingX;\r\n    obj.lockScalingY = !obj.lockScalingY;\r\n    obj.selectable = !obj.lockMovementX;\r\n\r\n    if (!obj.selectable) {\r\n      canvas?.discardActiveObject();\r\n    }\r\n\r\n    canvas?.requestRenderAll();\r\n    history.saveState();\r\n    setObjects([...(canvas?.getObjects() || [])].reverse());\r\n  };\r\n\r\n  const selectObject = (obj: FabricObject) => {\r\n    if (!canvas || !obj.visible || !obj.selectable) return;\r\n    canvas.setActiveObject(obj);\r\n    canvas.requestRenderAll();\r\n  };\r\n\r\n  const deleteObject = (obj: FabricObject, e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    canvas?.remove(obj);\r\n    canvas?.requestRenderAll();\r\n    history.saveState();\r\n  };\r\n\r\n  const handleOpacityChange = (value: number) => {\r\n    if (!canvas || !selectedObject) return;\r\n    selectedObject.set('opacity', value);\r\n    canvas.requestRenderAll();\r\n    // history.saveState(); // Maybe debounce this or save onAfterChange\r\n  };\r\n\r\n  const handleOpacityAfterChange = () => {\r\n    history.saveState();\r\n  };\r\n\r\n  const handleBlendModeChange = (value: string) => {\r\n    if (!canvas || !selectedObject) return;\r\n    selectedObject.set('globalCompositeOperation', value);\r\n    canvas.requestRenderAll();\r\n    history.saveState();\r\n  };\r\n\r\n  return (\r\n    <div style={{ padding: 10 }}>\r\n      <Title level={5}>Layers</Title>\r\n\r\n      {selectedObject && (\r\n        <div style={{ marginBottom: 16, padding: 8, background: '#fafafa', borderRadius: 4 }}>\r\n          <div style={{ marginBottom: 8 }}>\r\n            <span style={{ fontSize: 12 }}>\r\n              Opacity: {Math.round((selectedObject.opacity || 1) * 100)}%\r\n            </span>\r\n            <Slider\r\n              min={0}\r\n              max={1}\r\n              step={0.01}\r\n              value={selectedObject.opacity ?? 1}\r\n              onChange={handleOpacityChange}\r\n              onAfterChange={handleOpacityAfterChange}\r\n            />\r\n          </div>\r\n          <div>\r\n            <span style={{ fontSize: 12 }}>Blend Mode:</span>\r\n            <Select\r\n              size=\"small\"\r\n              style={{ width: '100%' }}\r\n              value={selectedObject.globalCompositeOperation || 'source-over'}\r\n              onChange={handleBlendModeChange}\r\n            >\r\n              <Option value=\"source-over\">Normal</Option>\r\n              <Option value=\"multiply\">Multiply</Option>\r\n              <Option value=\"screen\">Screen</Option>\r\n              <Option value=\"overlay\">Overlay</Option>\r\n              <Option value=\"darken\">Darken</Option>\r\n              <Option value=\"lighten\">Lighten</Option>\r\n              <Option value=\"color-dodge\">Color Dodge</Option>\r\n              <Option value=\"color-burn\">Color Burn</Option>\r\n              <Option value=\"hard-light\">Hard Light</Option>\r\n              <Option value=\"soft-light\">Soft Light</Option>\r\n              <Option value=\"difference\">Difference</Option>\r\n              <Option value=\"exclusion\">Exclusion</Option>\r\n              <Option value=\"hue\">Hue</Option>\r\n              <Option value=\"saturation\">Saturation</Option>\r\n              <Option value=\"color\">Color</Option>\r\n              <Option value=\"luminosity\">Luminosity</Option>\r\n            </Select>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <DndContext sensors={sensors} collisionDetection={closestCenter} onDragEnd={handleDragEnd}>\r\n        <SortableContext\r\n          items={objects.map((obj: any) => obj.uid)}\r\n          strategy={verticalListSortingStrategy}\r\n        >\r\n          <div\r\n            style={{\r\n              // maxHeight: 300, // Removed to allow scrolling\r\n              overflowY: 'auto',\r\n              border: '1px solid #d9d9d9',\r\n              borderRadius: 4,\r\n              padding: 4,\r\n            }}\r\n          >\r\n            {objects.map((item: any, index) => {\r\n              const isSelected = selectedObject === item;\r\n              const type = item.type || 'Object';\r\n              const name = item.name || `${type} ${objects.length - index}`;\r\n\r\n              return (\r\n                <SortableItem\r\n                  key={item.uid}\r\n                  id={item.uid}\r\n                  isSelected={isSelected}\r\n                  onClick={() => selectObject(item)}\r\n                >\r\n                  <div\r\n                    style={{\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      width: '100%',\r\n                      justifyContent: 'space-between',\r\n                    }}\r\n                  >\r\n                    <span\r\n                      style={{\r\n                        overflow: 'hidden',\r\n                        textOverflow: 'ellipsis',\r\n                        whiteSpace: 'nowrap',\r\n                        maxWidth: 120,\r\n                      }}\r\n                    >\r\n                      {name}\r\n                    </span>\r\n                    <Space size={4}>\r\n                      <Button\r\n                        type=\"text\"\r\n                        size=\"small\"\r\n                        icon={item.visible ? <EyeOutlined /> : <EyeInvisibleOutlined />}\r\n                        onClick={(e) => toggleVisibility(item, e)}\r\n                        onMouseDown={(e) => e.stopPropagation()}\r\n                      />\r\n                      <Button\r\n                        type=\"text\"\r\n                        size=\"small\"\r\n                        icon={item.lockMovementX ? <LockOutlined /> : <UnlockOutlined />}\r\n                        onClick={(e) => toggleLock(item, e)}\r\n                        onMouseDown={(e) => e.stopPropagation()}\r\n                      />\r\n                      <Button\r\n                        type=\"text\"\r\n                        size=\"small\"\r\n                        danger\r\n                        icon={<DeleteOutlined />}\r\n                        onClick={(e) => deleteObject(item, e)}\r\n                        onMouseDown={(e) => e.stopPropagation()}\r\n                      />\r\n                    </Space>\r\n                  </div>\r\n                </SortableItem>\r\n              );\r\n            })}\r\n          </div>\r\n        </SortableContext>\r\n      </DndContext>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LayersPanel;\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { Slider, Typography, Space, Collapse } from 'antd';\r\nimport { usePhotoEditor } from '../context';\r\nimport { filters, FabricImage } from 'fabric';\r\n\r\nconst { Panel } = Collapse;\r\n\r\nconst FILTER_LIST = [\r\n  { name: 'Grayscale', filter: filters.Grayscale, index: 9 },\r\n  { name: 'Invert', filter: filters.Invert, index: 10 },\r\n  { name: 'Sepia', filter: filters.Sepia, index: 11 },\r\n  { name: 'Black&White', filter: filters.BlackWhite, index: 12 },\r\n  { name: 'Brownie', filter: filters.Brownie, index: 13 },\r\n  { name: 'Vintage', filter: filters.Vintage, index: 14 },\r\n  { name: 'Kodachrome', filter: filters.Kodachrome, index: 15 },\r\n  { name: 'Technicolor', filter: filters.Technicolor, index: 16 },\r\n  { name: 'Polaroid', filter: filters.Polaroid, index: 17 },\r\n];\r\n\r\nconst FilterPreview: React.FC<{\r\n  name: string;\r\n  filterClass: any;\r\n  originalImage: HTMLImageElement | null;\r\n  isActive: boolean;\r\n  onClick: () => void;\r\n}> = ({ name, filterClass, originalImage, isActive, onClick }) => {\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n\r\n  useEffect(() => {\r\n    if (!originalImage || !canvasRef.current) return;\r\n\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) return;\r\n\r\n    const size = 60;\r\n    canvas.width = size;\r\n    canvas.height = size;\r\n\r\n    // Create a temporary fabric image\r\n    const fImg = new FabricImage(originalImage);\r\n\r\n    const scale = size / Math.max(fImg.width || 1, fImg.height || 1);\r\n    fImg.scale(scale);\r\n\r\n    const filter = new filterClass();\r\n    fImg.filters = [filter];\r\n    fImg.applyFilters();\r\n\r\n    const element = fImg.getElement();\r\n\r\n    ctx.clearRect(0, 0, size, size);\r\n\r\n    const dw = (fImg.width || 0) * (fImg.scaleX || 1);\r\n    const dh = (fImg.height || 0) * (fImg.scaleY || 1);\r\n    const dx = (size - dw) / 2;\r\n    const dy = (size - dh) / 2;\r\n\r\n    ctx.drawImage(element, dx, dy, dw, dh);\r\n  }, [originalImage, filterClass]);\r\n\r\n  return (\r\n    <div\r\n      onClick={onClick}\r\n      style={{\r\n        cursor: 'pointer',\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        alignItems: 'center',\r\n        gap: 4,\r\n      }}\r\n    >\r\n      <div\r\n        style={{\r\n          width: 64,\r\n          height: 64,\r\n          border: isActive ? '2px solid #1890ff' : '1px solid #f0f0f0',\r\n          borderRadius: 4,\r\n          overflow: 'hidden',\r\n          display: 'flex',\r\n          alignItems: 'center',\r\n          justifyContent: 'center',\r\n          background: '#f5f5f5',\r\n        }}\r\n      >\r\n        <canvas ref={canvasRef} />\r\n      </div>\r\n      <Typography.Text style={{ fontSize: 10, textAlign: 'center', lineHeight: 1.2 }}>\r\n        {name}\r\n      </Typography.Text>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst AdjustmentPanel: React.FC = () => {\r\n  const { canvas, selectedObject, history } = usePhotoEditor();\r\n  const [originalImage, setOriginalImage] = useState<HTMLImageElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (selectedObject && selectedObject.isType('image')) {\r\n      const img = selectedObject as FabricImage;\r\n      const src = img.getSrc();\r\n      const image = new Image();\r\n      image.crossOrigin = 'anonymous';\r\n      image.src = src;\r\n      image.onload = () => {\r\n        setOriginalImage(image);\r\n      };\r\n    } else {\r\n      setOriginalImage(null);\r\n    }\r\n  }, [selectedObject]);\r\n\r\n  const applyFilter = (index: number, filter: any) => {\r\n    if (!selectedObject || !selectedObject.isType('image')) return;\r\n    const img = selectedObject as any;\r\n    img.filters[index] = filter;\r\n    img.applyFilters();\r\n    canvas?.requestRenderAll();\r\n  };\r\n\r\n  const handleBrightness = (value: number) => {\r\n    const filter = new filters.Brightness({ brightness: value });\r\n    applyFilter(0, filter);\r\n  };\r\n\r\n  const handleContrast = (value: number) => {\r\n    const filter = new filters.Contrast({ contrast: value });\r\n    applyFilter(1, filter);\r\n  };\r\n\r\n  const handleSaturation = (value: number) => {\r\n    const filter = new filters.Saturation({ saturation: value });\r\n    applyFilter(2, filter);\r\n  };\r\n\r\n  const handleNoise = (value: number) => {\r\n    const filter = new filters.Noise({ noise: value });\r\n    applyFilter(3, filter);\r\n  };\r\n\r\n  const handlePixelate = (value: number) => {\r\n    const filter = value > 1 ? new filters.Pixelate({ blocksize: value }) : false;\r\n    applyFilter(4, filter);\r\n  };\r\n\r\n  const handleBlur = (value: number) => {\r\n    const filter = new filters.Blur({ blur: value });\r\n    applyFilter(5, filter);\r\n  };\r\n\r\n  const handleGamma = (value: number) => {\r\n    const filter = new filters.Gamma({ gamma: [value, value, value] });\r\n    applyFilter(6, filter);\r\n  };\r\n\r\n  const handleVibrance = (value: number) => {\r\n    const filter = new filters.Vibrance({ vibrance: value });\r\n    applyFilter(7, filter);\r\n  };\r\n\r\n  const handleHueRotation = (value: number) => {\r\n    const filter = new filters.HueRotation({ rotation: value });\r\n    applyFilter(8, filter);\r\n  };\r\n\r\n  const handleToggleFilter = (index: number, FilterClass: any, checked: boolean) => {\r\n    const filter = checked ? new FilterClass() : false;\r\n    applyFilter(index, filter);\r\n    history.saveState();\r\n  };\r\n\r\n  if (!selectedObject || !selectedObject.isType('image')) {\r\n    return <div style={{ padding: 10 }}>Select an image to adjust</div>;\r\n  }\r\n\r\n  return (\r\n    <div style={{ padding: 10, height: '100%', overflowY: 'auto' }}>\r\n      <Typography.Title level={5}>Adjustments</Typography.Title>\r\n      <Collapse defaultActiveKey={['1', '2', '3']} ghost>\r\n        <Panel header=\"Basic\" key=\"1\">\r\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n            <div>\r\n              <Typography.Text>Brightness</Typography.Text>\r\n              <Slider\r\n                min={-1}\r\n                max={1}\r\n                step={0.01}\r\n                defaultValue={0}\r\n                onChange={handleBrightness}\r\n                onAfterChange={() => history.saveState()}\r\n              />\r\n            </div>\r\n            <div>\r\n              <Typography.Text>Contrast</Typography.Text>\r\n              <Slider\r\n                min={-1}\r\n                max={1}\r\n                step={0.01}\r\n                defaultValue={0}\r\n                onChange={handleContrast}\r\n                onAfterChange={() => history.saveState()}\r\n              />\r\n            </div>\r\n            <div>\r\n              <Typography.Text>Saturation</Typography.Text>\r\n              <Slider\r\n                min={-1}\r\n                max={1}\r\n                step={0.01}\r\n                defaultValue={0}\r\n                onChange={handleSaturation}\r\n                onAfterChange={() => history.saveState()}\r\n              />\r\n            </div>\r\n            <div>\r\n              <Typography.Text>Vibrance</Typography.Text>\r\n              <Slider\r\n                min={-1}\r\n                max={1}\r\n                step={0.01}\r\n                defaultValue={0}\r\n                onChange={handleVibrance}\r\n                onAfterChange={() => history.saveState()}\r\n              />\r\n            </div>\r\n            <div>\r\n              <Typography.Text>Gamma</Typography.Text>\r\n              <Slider\r\n                min={0.1}\r\n                max={2.2}\r\n                step={0.1}\r\n                defaultValue={1}\r\n                onChange={handleGamma}\r\n                onAfterChange={() => history.saveState()}\r\n              />\r\n            </div>\r\n            <div>\r\n              <Typography.Text>Hue Rotation</Typography.Text>\r\n              <Slider\r\n                min={-1}\r\n                max={1}\r\n                step={0.01}\r\n                defaultValue={0}\r\n                onChange={handleHueRotation}\r\n                onAfterChange={() => history.saveState()}\r\n              />\r\n            </div>\r\n          </Space>\r\n        </Panel>\r\n\r\n        <Panel header=\"Effects\" key=\"2\">\r\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n            <div>\r\n              <Typography.Text>Blur</Typography.Text>\r\n              <Slider\r\n                min={0}\r\n                max={1}\r\n                step={0.01}\r\n                defaultValue={0}\r\n                onChange={handleBlur}\r\n                onAfterChange={() => history.saveState()}\r\n              />\r\n            </div>\r\n            <div>\r\n              <Typography.Text>Noise</Typography.Text>\r\n              <Slider\r\n                min={0}\r\n                max={1000}\r\n                defaultValue={0}\r\n                onChange={handleNoise}\r\n                onAfterChange={() => history.saveState()}\r\n              />\r\n            </div>\r\n            <div>\r\n              <Typography.Text>Pixelate</Typography.Text>\r\n              <Slider\r\n                min={1}\r\n                max={20}\r\n                defaultValue={1}\r\n                onChange={handlePixelate}\r\n                onAfterChange={() => history.saveState()}\r\n              />\r\n            </div>\r\n          </Space>\r\n        </Panel>\r\n\r\n        <Panel header=\"Filters\" key=\"3\">\r\n          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 12 }}>\r\n            {FILTER_LIST.map((item) => {\r\n              const isActive = !!(selectedObject as any)?.filters?.[item.index];\r\n              return (\r\n                <FilterPreview\r\n                  key={item.name}\r\n                  name={item.name}\r\n                  filterClass={item.filter}\r\n                  originalImage={originalImage}\r\n                  isActive={isActive}\r\n                  onClick={() => handleToggleFilter(item.index, item.filter, !isActive)}\r\n                />\r\n              );\r\n            })}\r\n          </div>\r\n        </Panel>\r\n      </Collapse>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdjustmentPanel;\r\n","import React, { useEffect, useState, useRef } from 'react';\r\nimport { ColorPicker, Slider, Typography, Space, Select } from 'antd';\r\nimport { usePhotoEditor } from '../context';\r\nimport { PencilBrush, CircleBrush, SprayBrush, Shadow } from 'fabric';\r\n\r\nconst BrushPanel: React.FC = () => {\r\n  const { canvas } = usePhotoEditor();\r\n  const [color, setColor] = useState<string>('#000000');\r\n  const [width, setWidth] = useState<number>(5);\r\n  const [shadowWidth, setShadowWidth] = useState<number>(0);\r\n  const [brushType, setBrushType] = useState<string>('Pencil');\r\n\r\n  const draggingWidth = useRef(false);\r\n  const widthStartX = useRef<number | null>(null);\r\n  const widthStartValue = useRef<number>(width);\r\n\r\n  const draggingShadow = useRef(false);\r\n  const shadowStartX = useRef<number | null>(null);\r\n  const shadowStartValue = useRef<number>(shadowWidth);\r\n\r\n  const handleWidthLabelMouseDown = (e: React.MouseEvent) => {\r\n    if (e.button !== 0) return;\r\n    e.preventDefault();\r\n    draggingWidth.current = true;\r\n    widthStartX.current = e.clientX;\r\n    widthStartValue.current = width;\r\n    const prevUserSelect = document.body.style.userSelect;\r\n    document.body.style.userSelect = 'none';\r\n\r\n    const onMouseMove = (ev: MouseEvent) => {\r\n      if (!draggingWidth.current || widthStartX.current === null) return;\r\n      const delta = ev.clientX - widthStartX.current;\r\n      const sensitivity = 0.2; // pixels -> width\r\n      const newVal = Math.max(1, Math.min(2000, widthStartValue.current + delta * sensitivity));\r\n      setWidth(Number(newVal.toFixed(0)));\r\n    };\r\n\r\n    const onMouseUp = () => {\r\n      draggingWidth.current = false;\r\n      widthStartX.current = null;\r\n      document.body.style.userSelect = prevUserSelect;\r\n      window.removeEventListener('mousemove', onMouseMove);\r\n      window.removeEventListener('mouseup', onMouseUp);\r\n    };\r\n\r\n    window.addEventListener('mousemove', onMouseMove);\r\n    window.addEventListener('mouseup', onMouseUp);\r\n  };\r\n\r\n  const handleShadowLabelMouseDown = (e: React.MouseEvent) => {\r\n    if (e.button !== 0) return;\r\n    e.preventDefault();\r\n    draggingShadow.current = true;\r\n    shadowStartX.current = e.clientX;\r\n    shadowStartValue.current = shadowWidth;\r\n    const prevUserSelect = document.body.style.userSelect;\r\n    document.body.style.userSelect = 'none';\r\n\r\n    const onMouseMove = (ev: MouseEvent) => {\r\n      if (!draggingShadow.current || shadowStartX.current === null) return;\r\n      const delta = ev.clientX - shadowStartX.current;\r\n      const sensitivity = 0.2;\r\n      const newVal = Math.max(0, Math.min(200, shadowStartValue.current + delta * sensitivity));\r\n      setShadowWidth(Number(newVal.toFixed(0)));\r\n    };\r\n\r\n    const onMouseUp = () => {\r\n      draggingShadow.current = false;\r\n      shadowStartX.current = null;\r\n      document.body.style.userSelect = prevUserSelect;\r\n      window.removeEventListener('mousemove', onMouseMove);\r\n      window.removeEventListener('mouseup', onMouseUp);\r\n    };\r\n\r\n    window.addEventListener('mousemove', onMouseMove);\r\n    window.addEventListener('mouseup', onMouseUp);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!canvas) return;\r\n\r\n    // Ensure brush exists\r\n    if (!canvas.freeDrawingBrush) {\r\n      canvas.freeDrawingBrush = new PencilBrush(canvas);\r\n    }\r\n\r\n    const brush = canvas.freeDrawingBrush;\r\n    brush.color = color;\r\n    brush.width = width;\r\n\r\n    if (shadowWidth > 0) {\r\n      brush.shadow = new Shadow({ blur: shadowWidth, color: color });\r\n    } else {\r\n      brush.shadow = null;\r\n    }\r\n  }, [canvas, color, width, shadowWidth]);\r\n\r\n  const handleBrushChange = (type: string) => {\r\n    if (!canvas) return;\r\n    setBrushType(type);\r\n    let brush;\r\n    switch (type) {\r\n      case 'Circle':\r\n        brush = new CircleBrush(canvas);\r\n        break;\r\n      case 'Spray':\r\n        brush = new SprayBrush(canvas);\r\n        break;\r\n      case 'Pencil':\r\n      default:\r\n        brush = new PencilBrush(canvas);\r\n        break;\r\n    }\r\n    brush.color = color;\r\n    brush.width = width;\r\n    if (shadowWidth > 0) {\r\n      brush.shadow = new Shadow({ blur: shadowWidth, color: color });\r\n    }\r\n    canvas.freeDrawingBrush = brush;\r\n  };\r\n\r\n  return (\r\n    <div style={{ padding: 10 }}>\r\n      <Typography.Title level={5}>Brush Settings</Typography.Title>\r\n      <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n        <div>\r\n          <Typography.Text>Type</Typography.Text>\r\n          <Select value={brushType} style={{ width: '100%' }} onChange={handleBrushChange}>\r\n            <Select.Option value=\"Pencil\">Pencil</Select.Option>\r\n            <Select.Option value=\"Circle\">Circle</Select.Option>\r\n            <Select.Option value=\"Spray\">Spray</Select.Option>\r\n          </Select>\r\n        </div>\r\n        <div>\r\n          <Typography.Text>Color</Typography.Text>\r\n          <br />\r\n          <ColorPicker value={color} onChange={(c) => setColor(c.toHexString())} showText />\r\n        </div>\r\n        <div>\r\n          <Typography.Text\r\n            onMouseDown={handleWidthLabelMouseDown}\r\n            style={{ cursor: 'ew-resize', userSelect: 'none' }}\r\n          >\r\n            Width\r\n          </Typography.Text>\r\n          <br />\r\n          <input\r\n            type=\"number\"\r\n            min={1}\r\n            max={2000}\r\n            value={width}\r\n            onChange={(e) => setWidth(Number(e.target.value || 1))}\r\n            style={{ width: '100%' }}\r\n          />\r\n        </div>\r\n        <div>\r\n          <Typography.Text\r\n            onMouseDown={handleShadowLabelMouseDown}\r\n            style={{ cursor: 'ew-resize', userSelect: 'none' }}\r\n          >\r\n            Shadow Blur\r\n          </Typography.Text>\r\n          <br />\r\n          <input\r\n            type=\"number\"\r\n            min={0}\r\n            max={500}\r\n            value={shadowWidth}\r\n            onChange={(e) => setShadowWidth(Number(e.target.value || 0))}\r\n            style={{ width: '100%' }}\r\n          />\r\n        </div>\r\n      </Space>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BrushPanel;\r\n","// This icon file is generated automatically.\nvar BoldOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M697.8 481.4c33.6-35 54.2-82.3 54.2-134.3v-10.2C752 229.3 663.9 142 555.3 142H259.4c-15.1 0-27.4 12.3-27.4 27.4v679.1c0 16.3 13.2 29.5 29.5 29.5h318.7c117 0 211.8-94.2 211.8-210.5v-11c0-73-37.4-137.3-94.2-175.1zM328 238h224.7c57.1 0 103.3 44.4 103.3 99.3v9.5c0 54.8-46.3 99.3-103.3 99.3H328V238zm366.6 429.4c0 62.9-51.7 113.9-115.5 113.9H328V542.7h251.1c63.8 0 115.5 51 115.5 113.9v10.8z\" } }] }, \"name\": \"bold\", \"theme\": \"outlined\" };\nexport default BoldOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport BoldOutlinedSvg from \"@ant-design/icons-svg/es/asn/BoldOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar BoldOutlined = function BoldOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: BoldOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(BoldOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'BoldOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar UnderlineOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M824 804H200c-4.4 0-8 3.4-8 7.6v60.8c0 4.2 3.6 7.6 8 7.6h624c4.4 0 8-3.4 8-7.6v-60.8c0-4.2-3.6-7.6-8-7.6zm-312-76c69.4 0 134.6-27.1 183.8-76.2C745 602.7 772 537.4 772 468V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 97-79 176-176 176s-176-79-176-176V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 69.4 27.1 134.6 76.2 183.8C377.3 701 442.6 728 512 728z\" } }] }, \"name\": \"underline\", \"theme\": \"outlined\" };\nexport default UnderlineOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport UnderlineOutlinedSvg from \"@ant-design/icons-svg/es/asn/UnderlineOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar UnderlineOutlined = function UnderlineOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: UnderlineOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(UnderlineOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'UnderlineOutlined';\n}\nexport default RefIcon;","import React, { useEffect, useState } from 'react';\r\nimport { Select, InputNumber, Button, Space, Divider, ColorPicker } from 'antd';\r\nimport {\r\n  BoldOutlined,\r\n  ItalicOutlined,\r\n  UnderlineOutlined,\r\n  AlignLeftOutlined,\r\n  AlignCenterOutlined,\r\n  AlignRightOutlined,\r\n} from '@ant-design/icons';\r\nimport { usePhotoEditor } from '../context';\r\nimport { IText } from 'fabric';\r\n\r\nconst fonts = ['Arial', 'Helvetica', 'Times New Roman', 'Georgia', 'Courier New', 'Verdana'];\r\n\r\nconst TextStylePanel: React.FC = () => {\r\n  const { canvas, selectedObject, history, setActiveTool } = usePhotoEditor();\r\n  const [fontFamily, setFontFamily] = useState<string>('Arial');\r\n  const [fontSize, setFontSize] = useState<number>(24);\r\n  const [bold, setBold] = useState<boolean>(false);\r\n  const [italic, setItalic] = useState<boolean>(false);\r\n  const [underline, setUnderline] = useState<boolean>(false);\r\n  const [align, setAlign] = useState<'left' | 'center' | 'right'>('left');\r\n  const [color, setColor] = useState<string>('#000000');\r\n\r\n  useEffect(() => {\r\n    if (selectedObject && (selectedObject as any).isType === 'i-text') {\r\n      const txt = selectedObject as IText;\r\n      setFontFamily((txt.fontFamily as string) || 'Arial');\r\n      setFontSize((txt.fontSize as number) || 24);\r\n      setBold(txt.fontWeight === 'bold' || txt.fontWeight === 700);\r\n      setItalic(txt.fontStyle === 'italic');\r\n      setUnderline((txt.underline as boolean) || false);\r\n      setAlign((txt.textAlign as any) || 'left');\r\n      setColor((txt.fill as string) || '#000000');\r\n    }\r\n  }, [selectedObject]);\r\n\r\n  const apply = (patch: Record<string, any>, save = true) => {\r\n    if (!selectedObject) return;\r\n    selectedObject.set(patch);\r\n    selectedObject.setCoords && selectedObject.setCoords();\r\n    canvas && canvas.requestRenderAll();\r\n    if (save && history) history.saveState();\r\n  };\r\n\r\n  const getFirstLayerRect = () => {\r\n    if (!canvas) return null;\r\n    const objs = canvas.getObjects();\r\n    if (!objs || objs.length === 0) return null;\r\n    const first = objs[0];\r\n    try {\r\n      return first.getBoundingRect();\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const alignHorizontalToFirst = (mode: 'left' | 'center' | 'right') => {\r\n    if (!canvas || !selectedObject) return;\r\n    const target = getFirstLayerRect();\r\n    if (!target) return;\r\n    const objRect = selectedObject.getBoundingRect();\r\n\r\n    let left = selectedObject.left || 0;\r\n    if (mode === 'left') {\r\n      left = target.left;\r\n    } else if (mode === 'center') {\r\n      left = target.left + (target.width - objRect.width) / 2;\r\n    } else if (mode === 'right') {\r\n      left = target.left + target.width - objRect.width;\r\n    }\r\n\r\n    apply({ left }, true);\r\n  };\r\n\r\n  const alignVerticalToFirst = (mode: 'top' | 'middle' | 'bottom') => {\r\n    if (!canvas || !selectedObject) return;\r\n    const target = getFirstLayerRect();\r\n    if (!target) return;\r\n    const objRect = selectedObject.getBoundingRect();\r\n\r\n    let top = selectedObject.top || 0;\r\n    if (mode === 'top') {\r\n      top = target.top;\r\n    } else if (mode === 'middle') {\r\n      top = target.top + (target.height - objRect.height) / 2;\r\n    } else if (mode === 'bottom') {\r\n      top = target.top + target.height - objRect.height;\r\n    }\r\n\r\n    apply({ top }, true);\r\n  };\r\n\r\n  return (\r\n    <div style={{ padding: 12 }}>\r\n      <div style={{ marginBottom: 8 }}>\r\n        <strong>Font</strong>\r\n      </div>\r\n\r\n      <Space direction=\"vertical\" style={{ width: '100%' }}>\r\n        <Select\r\n          value={fontFamily}\r\n          onChange={(v) => {\r\n            setFontFamily(v);\r\n            apply({ fontFamily: v });\r\n          }}\r\n        >\r\n          {fonts.map((f) => (\r\n            <Select.Option key={f} value={f}>\r\n              {f}\r\n            </Select.Option>\r\n          ))}\r\n        </Select>\r\n\r\n        <InputNumber\r\n          min={8}\r\n          max={200}\r\n          value={fontSize}\r\n          onChange={(v) => {\r\n            setFontSize(v || 24);\r\n            apply({ fontSize: v || 24 });\r\n          }}\r\n          style={{ width: '100%' }}\r\n        />\r\n\r\n        <div>\r\n          <Space>\r\n            <Button\r\n              icon={<BoldOutlined />}\r\n              type={bold ? 'primary' : 'default'}\r\n              onClick={() => {\r\n                const newVal = !bold;\r\n                setBold(newVal);\r\n                apply({ fontWeight: newVal ? 'bold' : 'normal' });\r\n              }}\r\n            />\r\n            <Button\r\n              icon={<ItalicOutlined />}\r\n              type={italic ? 'primary' : 'default'}\r\n              onClick={() => {\r\n                const newVal = !italic;\r\n                setItalic(newVal);\r\n                apply({ fontStyle: newVal ? 'italic' : 'normal' });\r\n              }}\r\n            />\r\n            <Button\r\n              icon={<UnderlineOutlined />}\r\n              type={underline ? 'primary' : 'default'}\r\n              onClick={() => {\r\n                const newVal = !underline;\r\n                setUnderline(newVal);\r\n                apply({ underline: newVal });\r\n              }}\r\n            />\r\n          </Space>\r\n        </div>\r\n\r\n        <Divider />\r\n\r\n        <div>\r\n          <strong>Horizontal Align (textAlign)</strong>\r\n          <div style={{ marginTop: 8 }}>\r\n            <Space>\r\n              <Button\r\n                icon={<AlignLeftOutlined />}\r\n                type={align === 'left' ? 'primary' : 'default'}\r\n                onClick={() => {\r\n                  setAlign('left');\r\n                  apply({ textAlign: 'left' });\r\n                }}\r\n              />\r\n              <Button\r\n                icon={<AlignCenterOutlined />}\r\n                type={align === 'center' ? 'primary' : 'default'}\r\n                onClick={() => {\r\n                  setAlign('center');\r\n                  apply({ textAlign: 'center' });\r\n                }}\r\n              />\r\n              <Button\r\n                icon={<AlignRightOutlined />}\r\n                type={align === 'right' ? 'primary' : 'default'}\r\n                onClick={() => {\r\n                  setAlign('right');\r\n                  apply({ textAlign: 'right' });\r\n                }}\r\n              />\r\n            </Space>\r\n          </div>\r\n        </div>\r\n\r\n        <Divider />\r\n\r\n        <div>\r\n          <strong>Color</strong>\r\n          <div style={{ marginTop: 8 }}>\r\n            <ColorPicker\r\n              value={color}\r\n              onChange={(c) => {\r\n                const hex = c.toHexString();\r\n                setColor(hex);\r\n                apply({ fill: hex });\r\n                // if user is currently editing the text, ensure text tool stays active\r\n                try {\r\n                  if ((selectedObject as any)?.isEditing) {\r\n                    setActiveTool && setActiveTool('text');\r\n                  }\r\n                } catch (e) {\r\n                  // ignore\r\n                }\r\n              }}\r\n              showText\r\n            />\r\n          </div>\r\n        </div>\r\n      </Space>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TextStylePanel;\r\n","import React from 'react';\r\nimport { Button, Space } from 'antd';\r\nimport { usePhotoEditor } from '../context';\r\n\r\nconst AlignControls: React.FC = () => {\r\n  const { canvas, selectedObject, history } = usePhotoEditor();\r\n\r\n  const getFirstLayerRect = () => {\r\n    if (!canvas) return null;\r\n    const objs = canvas.getObjects();\r\n    if (!objs || objs.length === 0) return null;\r\n    const first = objs[0];\r\n    try {\r\n      return first.getBoundingRect();\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const apply = (patch: Record<string, any>) => {\r\n    if (!selectedObject) return;\r\n    selectedObject.set(patch);\r\n    selectedObject.setCoords && selectedObject.setCoords();\r\n    canvas && canvas.requestRenderAll();\r\n    if (history) history.saveState();\r\n  };\r\n\r\n  const alignHorizontalToFirst = (mode: 'left' | 'center' | 'right') => {\r\n    if (!canvas || !selectedObject) return;\r\n    const target = getFirstLayerRect();\r\n    if (!target) return;\r\n    const objRect = selectedObject.getBoundingRect();\r\n\r\n    let left = selectedObject.left || 0;\r\n    if (mode === 'left') {\r\n      left = target.left;\r\n    } else if (mode === 'center') {\r\n      left = target.left + (target.width - objRect.width) / 2;\r\n    } else if (mode === 'right') {\r\n      left = target.left + target.width - objRect.width;\r\n    }\r\n\r\n    apply({ left });\r\n  };\r\n\r\n  const alignVerticalToFirst = (mode: 'top' | 'middle' | 'bottom') => {\r\n    if (!canvas || !selectedObject) return;\r\n    const target = getFirstLayerRect();\r\n    if (!target) return;\r\n    const objRect = selectedObject.getBoundingRect();\r\n\r\n    let top = selectedObject.top || 0;\r\n    if (mode === 'top') {\r\n      top = target.top;\r\n    } else if (mode === 'middle') {\r\n      top = target.top + (target.height - objRect.height) / 2;\r\n    } else if (mode === 'bottom') {\r\n      top = target.top + target.height - objRect.height;\r\n    }\r\n\r\n    apply({ top });\r\n  };\r\n\r\n  return (\r\n    <div style={{ padding: 12 }}>\r\n      <div style={{ marginBottom: 6 }}>\r\n        <strong>Align to First Layer</strong>\r\n      </div>\r\n      <div style={{ marginBottom: 8 }}>\r\n        <Space>\r\n          <Button onClick={() => alignHorizontalToFirst('left')}>H: Left</Button>\r\n          <Button onClick={() => alignHorizontalToFirst('center')}>H: Center</Button>\r\n          <Button onClick={() => alignHorizontalToFirst('right')}>H: Right</Button>\r\n        </Space>\r\n      </div>\r\n      <div>\r\n        <Space>\r\n          <Button onClick={() => alignVerticalToFirst('top')}>V: Top</Button>\r\n          <Button onClick={() => alignVerticalToFirst('middle')}>V: Middle</Button>\r\n          <Button onClick={() => alignVerticalToFirst('bottom')}>V: Bottom</Button>\r\n        </Space>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AlignControls;\r\n","import React from 'react';\r\nimport { usePhotoEditor } from '../context';\r\nimport AdjustmentPanel from './AdjustmentPanel';\r\nimport BrushPanel from './BrushPanel';\r\nimport TextStylePanel from './TextStylePanel';\r\nimport AlignControls from './AlignControls';\r\n\r\nconst PropertiesPanel: React.FC = () => {\r\n  const { activeTool, selectedObject } = usePhotoEditor();\r\n\r\n  if (activeTool === 'brush') return <BrushPanel />;\r\n\r\n  if (activeTool === 'text') return <TextStylePanel />;\r\n\r\n  // if a text object is selected, show text panel too\r\n  if (selectedObject && (selectedObject as any).isType === 'i-text')\r\n    return (\r\n      <>\r\n        <TextStylePanel />\r\n        <AlignControls />\r\n      </>\r\n    );\r\n\r\n  if (selectedObject)\r\n    return (\r\n      <>\r\n        <AdjustmentPanel />\r\n        <AlignControls />\r\n      </>\r\n    );\r\n\r\n  return <AdjustmentPanel />;\r\n};\r\n\r\nexport default PropertiesPanel;\r\n","import React from 'react';\r\nimport { Upload } from 'antd';\r\nimport { InboxOutlined } from '@ant-design/icons';\r\n\r\ninterface UploadAreaProps {\r\n  onUpload: (file: File) => boolean | void;\r\n}\r\n\r\nconst UploadArea: React.FC<UploadAreaProps> = ({ onUpload }) => {\r\n  return (\r\n    <Upload.Dragger\r\n      beforeUpload={onUpload}\r\n      showUploadList={false}\r\n      accept=\".png,.jpg,.jpeg\"\r\n      height={200}\r\n    >\r\n      <p className=\"ant-upload-drag-icon\">\r\n        <InboxOutlined />\r\n      </p>\r\n      <p className=\"ant-upload-text\">Click or drag file to this area to upload</p>\r\n      <p className=\"ant-upload-hint\">\r\n        Support for a single upload. You can also paste an image from clipboard.\r\n      </p>\r\n    </Upload.Dragger>\r\n  );\r\n};\r\n\r\nexport default UploadArea;\r\n","import { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { message } from 'antd';\r\nimport { SavedProject } from '../types';\r\n\r\nexport const useImageUpload = () => {\r\n  const [preview, setPreview] = useState<string | null>(null);\r\n  const [initialProject, setInitialProject] = useState<SavedProject | null>(null);\r\n  const [addOnFile, setAddOnFile] = useState<File | null>(null);\r\n  const [dragging, setDragging] = useState(false);\r\n  const dragCounter = useRef(0);\r\n\r\n  const handleUpload = useCallback(\r\n    (file: File) => {\r\n      const reader = new FileReader();\r\n      reader.onload = (e) => {\r\n        if (preview) {\r\n          setAddOnFile(file);\r\n        } else {\r\n          setPreview(e.target?.result as string);\r\n          setInitialProject(null);\r\n        }\r\n      };\r\n      reader.readAsDataURL(file);\r\n      setDragging(false);\r\n      dragCounter.current = 0;\r\n      return false;\r\n    },\r\n    [preview],\r\n  );\r\n\r\n  const loadProject = useCallback((project: SavedProject) => {\r\n    setInitialProject(project);\r\n    setPreview(project.thumbnail);\r\n  }, []);\r\n\r\n  const handleClear = useCallback(() => {\r\n    setPreview(null);\r\n    setAddOnFile(null);\r\n    setInitialProject(null);\r\n    message.info('Image cleared.');\r\n  }, []);\r\n\r\n  // --- Clipboard paste support ---\r\n  useEffect(() => {\r\n    const handlePaste = (e: ClipboardEvent) => {\r\n      const items = e.clipboardData?.items;\r\n      if (!items) return;\r\n\r\n      const imageItem = Array.from(items).find((item) => item.type.includes('image'));\r\n      if (imageItem) {\r\n        const blob = imageItem.getAsFile();\r\n        if (blob) {\r\n          handleUpload(blob);\r\n          message.success('Image pasted from clipboard!');\r\n          e.preventDefault();\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('paste', handlePaste);\r\n    return () => window.removeEventListener('paste', handlePaste);\r\n  }, [handleUpload]);\r\n\r\n  return {\r\n    preview,\r\n    setPreview, // Exposed if needed\r\n    addOnFile,\r\n    setAddOnFile,\r\n    dragging,\r\n    setDragging,\r\n    dragCounter,\r\n    handleUpload,\r\n    handleClear,\r\n    loadProject,\r\n    initialProject,\r\n  };\r\n};\r\n","\nimport \"E:/code/ultimate-tool-web/src/pages/PhotoEditor/styles.less?modules\";\nexport default {\"propertiesSider\": `propertiesSider-heiVp6pb`,\"panelHeader\": `panelHeader-0S5MqsF1`,\"toolButton\": `toolButton-pum2QQv_`,\"active\": `active-75qPXh8u`,\"layerItem\": `layerItem-XS7O71j5`,\"toolbarSider\": `toolbarSider-du7VhC79`,\"panelContent\": `panelContent-6e6CcFDp`,\"editorContainer\": `editorContainer-d13_yHC3`,\"canvasContent\": `canvasContent-Dy5SW4-T`}\n","import React from 'react';\r\nimport { PageContainer } from '@ant-design/pro-components';\r\nimport { Card, Layout, Tag, Divider } from 'antd';\r\nimport DragDropWrapper from '@/components/DragDropWrapper';\r\nimport DragOverlay from '@/components/DragOverlay';\r\nimport { PhotoEditorProvider } from './context';\r\nimport Toolbar from './components/Toolbar';\r\nimport CanvasArea from './components/CanvasArea';\r\nimport LayersPanel from './components/LayersPanel';\r\nimport PropertiesPanel from './components/PropertiesPanel';\r\nimport UploadArea from './components/UploadArea';\r\nimport SavedProjectsList from './components/SavedProjectsList';\r\nimport { useImageUpload } from './hooks/useImageUpload';\r\nimport { useProjects } from './hooks/useProjects';\r\nimport styles from './styles.less';\r\n\r\nconst { Sider, Content } = Layout;\r\n\r\nconst PhotoEditor: React.FC = () => {\r\n  const {\r\n    preview,\r\n    dragging,\r\n    setDragging,\r\n    dragCounter,\r\n    handleUpload,\r\n    addOnFile,\r\n    setAddOnFile,\r\n    loadProject,\r\n    initialProject,\r\n  } = useImageUpload();\r\n\r\n  const { savedProjects, deleteProject } = useProjects();\r\n\r\n  return (\r\n    <PageContainer\r\n      title={\r\n        <span>\r\n          Photo Editor <Tag color=\"cyan\">Beta</Tag>\r\n        </span>\r\n      }\r\n    >\r\n      <DragDropWrapper\r\n        setDragging={setDragging}\r\n        dragCounter={dragCounter}\r\n        handleUpload={handleUpload}\r\n      >\r\n        <Card className={styles.editorContainer} bodyStyle={{ padding: 0, height: '100%' }}>\r\n          {dragging && <DragOverlay />}\r\n\r\n          {!preview ? (\r\n            <div\r\n              style={{\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                justifyContent: 'center',\r\n                alignItems: 'center',\r\n                height: '100%',\r\n                padding: '20px',\r\n                overflowY: 'auto',\r\n              }}\r\n            >\r\n              <UploadArea onUpload={handleUpload} />\r\n              {savedProjects.length > 0 && (\r\n                <div style={{ width: '100%', maxWidth: '800px', marginTop: '40px' }}>\r\n                  <Divider>Or Open Saved Project</Divider>\r\n                  <SavedProjectsList\r\n                    projects={savedProjects}\r\n                    onLoad={loadProject}\r\n                    onDelete={deleteProject}\r\n                  />\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <PhotoEditorProvider\r\n              imageUrl={preview}\r\n              initialProject={initialProject}\r\n              addOnFile={addOnFile}\r\n              setAddOnFile={setAddOnFile}\r\n            >\r\n              <Layout style={{ height: '100%' }}>\r\n                <Sider theme=\"light\" width={60} className={styles.toolbarSider}>\r\n                  <Toolbar />\r\n                </Sider>\r\n                <Content className={styles.canvasContent}>\r\n                  <CanvasArea />\r\n                </Content>\r\n                <Sider theme=\"light\" width={300} className={styles.propertiesSider}>\r\n                  <PropertiesPanel />\r\n                  <LayersPanel />\r\n                </Sider>\r\n              </Layout>\r\n            </PhotoEditorProvider>\r\n          )}\r\n        </Card>\r\n      </DragDropWrapper>\r\n    </PageContainer>\r\n  );\r\n};\r\n\r\nexport default PhotoEditor;\r\n"],"names":[],"mappings":"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"}