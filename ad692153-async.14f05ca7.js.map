{"version":3,"sources":["node_modules/@ant-design/icons-svg/es/asn/PlusCircleOutlined.js","node_modules/@ant-design/icons/es/icons/PlusCircleOutlined.js","node_modules/@ant-design/icons/es/icons/FolderOpenOutlined.js","node_modules/@ant-design/icons-svg/es/asn/MoreOutlined.js","node_modules/@ant-design/icons/es/icons/MoreOutlined.js","node_modules/@ant-design/icons-svg/es/asn/AppstoreAddOutlined.js","node_modules/@ant-design/icons/es/icons/AppstoreAddOutlined.js","node_modules/@ant-design/icons-svg/es/asn/BorderOuterOutlined.js","node_modules/@ant-design/icons/es/icons/BorderOuterOutlined.js","src/pages/PhotoEditor/components/ExportModal.tsx","src/pages/PhotoEditor/utils/brushHelpers.ts","src/pages/PhotoEditor/utils/effectsHelpers.ts","src/pages/PhotoEditor/components/LayerMaskModal.tsx","src/pages/PhotoEditor/components/SavedProjectsList.tsx","src/pages/PhotoEditor/components/ProjectModal.tsx","src/pages/PhotoEditor/components/CropModal.tsx","src/pages/PhotoEditor/utils/opencvHelpers.ts","src/pages/PhotoEditor/components/BlurBrush/BlurBrushModal.tsx","src/pages/PhotoEditor/utils/storage.ts","src/pages/PhotoEditor/hooks/useProjects.ts","src/components/IconFont/IconFont.tsx","src/pages/PhotoEditor/utils/hslHelpers.ts","src/pages/PhotoEditor/utils/cameraRawHelpers.ts","src/pages/PhotoEditor/components/CustomSlider.tsx","src/pages/PhotoEditor/components/CameraRaw/HslPanel.tsx","src/pages/PhotoEditor/components/CameraRaw/CurvesPanel.tsx","src/pages/PhotoEditor/components/CameraRaw/ColorGradingPanel.tsx","src/pages/PhotoEditor/components/CameraRaw/RGBHistogram.tsx","src/pages/PhotoEditor/components/CameraRaw/CameraRawModal.tsx","src/pages/PhotoEditor/components/Toolbar.tsx","src/pages/PhotoEditor/hooks/useKeyboardShortcuts.ts","src/pages/PhotoEditor/components/CanvasArea.tsx","src/pages/PhotoEditor/components/LayersPanel.tsx","src/pages/PhotoEditor/components/AdjustmentPanel.tsx","src/pages/PhotoEditor/components/BrushPanel.tsx","node_modules/@ant-design/icons-svg/es/asn/BoldOutlined.js","node_modules/@ant-design/icons/es/icons/BoldOutlined.js","node_modules/@ant-design/icons-svg/es/asn/UnderlineOutlined.js","node_modules/@ant-design/icons/es/icons/UnderlineOutlined.js","src/pages/PhotoEditor/components/TextStylePanel.tsx","src/pages/PhotoEditor/components/AlignControls.tsx","src/pages/PhotoEditor/components/LayerStylePanel.tsx","src/pages/PhotoEditor/components/PropertiesPanel.tsx","src/pages/PhotoEditor/components/UploadArea.tsx","src/pages/PhotoEditor/hooks/useImageUpload.ts","/home/thanhnd/Downloads/code/ultimate-tool-web/src/pages/PhotoEditor/styles.less?asmodule","src/pages/PhotoEditor/index.tsx","src/pages/PhotoEditor/hooks/useHistory.ts","src/pages/PhotoEditor/context.tsx"],"sourcesContent":["// This icon file is generated automatically.\nvar PlusCircleOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z\" } }, { \"tag\": \"path\", \"attrs\": { \"d\": \"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z\" } }] }, \"name\": \"plus-circle\", \"theme\": \"outlined\" };\nexport default PlusCircleOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport PlusCircleOutlinedSvg from \"@ant-design/icons-svg/es/asn/PlusCircleOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar PlusCircleOutlined = function PlusCircleOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: PlusCircleOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(PlusCircleOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'PlusCircleOutlined';\n}\nexport default RefIcon;","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport FolderOpenOutlinedSvg from \"@ant-design/icons-svg/es/asn/FolderOpenOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar FolderOpenOutlined = function FolderOpenOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: FolderOpenOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(FolderOpenOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'FolderOpenOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar MoreOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z\" } }] }, \"name\": \"more\", \"theme\": \"outlined\" };\nexport default MoreOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport MoreOutlinedSvg from \"@ant-design/icons-svg/es/asn/MoreOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar MoreOutlined = function MoreOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: MoreOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(MoreOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'MoreOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar AppstoreAddOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"defs\", \"attrs\": {}, \"children\": [{ \"tag\": \"style\", \"attrs\": {} }] }, { \"tag\": \"path\", \"attrs\": { \"d\": \"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zm52 132H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200zM424 712H296V584c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v128H104c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h128v128c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V776h128c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"appstore-add\", \"theme\": \"outlined\" };\nexport default AppstoreAddOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport AppstoreAddOutlinedSvg from \"@ant-design/icons-svg/es/asn/AppstoreAddOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar AppstoreAddOutlined = function AppstoreAddOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: AppstoreAddOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(AppstoreAddOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'AppstoreAddOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar BorderOuterOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656zM484 366h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zM302 548h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm364 0h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-182 0h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm0 182h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8z\" } }] }, \"name\": \"border-outer\", \"theme\": \"outlined\" };\nexport default BorderOuterOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport BorderOuterOutlinedSvg from \"@ant-design/icons-svg/es/asn/BorderOuterOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar BorderOuterOutlined = function BorderOuterOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: BorderOuterOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(BorderOuterOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'BorderOuterOutlined';\n}\nexport default RefIcon;","import React, { useState } from 'react';\nimport { Modal, Form, Select, InputNumber, Button, message, Checkbox } from 'antd';\nimport { Canvas } from 'fabric';\n\ninterface ExportModalProps {\n  visible: boolean;\n  onCancel: () => void;\n  canvas: Canvas | null;\n}\n\nconst ExportModal: React.FC<ExportModalProps> = ({ visible, onCancel, canvas }) => {\n  const [format, setFormat] = useState<'png' | 'jpeg' | 'json' | 'svg'>('png');\n  const [quality, setQuality] = useState<number>(1);\n  const [multiplier, setMultiplier] = useState<number>(1);\n  const [trimWhitespace, setTrimWhitespace] = useState<boolean>(true);\n\n  const handleExport = () => {\n    if (!canvas) return;\n\n    if (format === 'json') {\n      const json = canvas.toJSON();\n      const blob = new Blob([JSON.stringify(json)], { type: 'application/json' });\n      downloadBlob(blob, 'project.json');\n    } else if (format === 'svg') {\n      const svg = canvas.toSVG();\n      const blob = new Blob([svg], { type: 'image/svg+xml' });\n      downloadBlob(blob, 'image.svg');\n    } else {\n      let options: any = {\n        format,\n        quality,\n        multiplier,\n      };\n\n      let savedBackgroundColor: any = null;\n      let savedBackgroundImage: any = null;\n\n      if (trimWhitespace) {\n        const objects = canvas.getObjects();\n        if (objects.length > 0) {\n          let minX = Infinity;\n          let minY = Infinity;\n          let maxX = -Infinity;\n          let maxY = -Infinity;\n\n          objects.forEach((obj) => {\n            const bound = obj.getBoundingRect();\n            if (bound.left < minX) minX = bound.left;\n            if (bound.top < minY) minY = bound.top;\n            if (bound.left + bound.width > maxX) maxX = bound.left + bound.width;\n            if (bound.top + bound.height > maxY) maxY = bound.top + bound.height;\n          });\n\n          options = {\n            ...options,\n            left: minX,\n            top: minY,\n            width: maxX - minX,\n            height: maxY - minY,\n          };\n\n          // Save and remove background\n          savedBackgroundColor = canvas.backgroundColor;\n          savedBackgroundImage = canvas.backgroundImage;\n          canvas.backgroundColor = null as any;\n          canvas.backgroundImage = null as any;\n        }\n      }\n\n      const dataURL = canvas.toDataURL(options);\n\n      // Restore background\n      if (trimWhitespace) {\n        canvas.backgroundColor = savedBackgroundColor;\n        canvas.backgroundImage = savedBackgroundImage;\n      }\n\n      const link = document.createElement('a');\n      link.download = `image.${format}`;\n      link.href = dataURL;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    }\n    message.success('Export successful');\n    onCancel();\n  };\n\n  const downloadBlob = (blob: Blob, fileName: string) => {\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = fileName;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  return (\n    <Modal\n      title=\"Export Image\"\n      open={visible}\n      onCancel={onCancel}\n      footer={[\n        <Button key=\"cancel\" onClick={onCancel}>\n          Cancel\n        </Button>,\n        <Button key=\"export\" type=\"primary\" onClick={handleExport}>\n          Export\n        </Button>,\n      ]}\n    >\n      <Form layout=\"vertical\">\n        <Form.Item label=\"Format\">\n          <Select value={format} onChange={(v) => setFormat(v)}>\n            <Select.Option value=\"png\">PNG</Select.Option>\n            <Select.Option value=\"jpeg\">JPEG</Select.Option>\n            <Select.Option value=\"svg\">SVG</Select.Option>\n            <Select.Option value=\"json\">JSON (Project)</Select.Option>\n          </Select>\n        </Form.Item>\n        {format !== 'json' && format !== 'svg' && (\n          <>\n            <Form.Item label=\"Quality (0.1 - 1)\">\n              <InputNumber\n                min={0.1}\n                max={1}\n                step={0.1}\n                value={quality}\n                onChange={(v) => setQuality(v || 1)}\n                style={{ width: '100%' }}\n              />\n            </Form.Item>\n            <Form.Item label=\"Multiplier (Scale)\">\n              <InputNumber\n                min={0.1}\n                max={5}\n                step={0.1}\n                value={multiplier}\n                onChange={(v) => setMultiplier(v || 1)}\n                style={{ width: '100%' }}\n              />\n            </Form.Item>\n            <Form.Item>\n              <Checkbox\n                checked={trimWhitespace}\n                onChange={(e) => setTrimWhitespace(e.target.checked)}\n              >\n                Trim Whitespace (Export content only)\n              </Checkbox>\n            </Form.Item>\n          </>\n        )}\n      </Form>\n    </Modal>\n  );\n};\n\nexport default ExportModal;\n","export type BrushSettings = {\n  color: string;\n  lineWidth: number;\n  opacity: number;\n  flow: number;\n  type: 'hard' | 'soft';\n};\n\nexport const drawBrushStroke = (\n  ctx: CanvasRenderingContext2D,\n  points: { x: number; y: number }[],\n  settings: BrushSettings,\n) => {\n  if (points.length === 0) return;\n\n  ctx.save();\n  ctx.globalAlpha = settings.opacity * settings.flow;\n\n  if (settings.type === 'soft') {\n    ctx.shadowColor = settings.color;\n    ctx.shadowBlur = settings.lineWidth * 0.5;\n    ctx.lineWidth = settings.lineWidth * 0.5;\n  } else {\n    ctx.shadowBlur = 0;\n    ctx.lineWidth = settings.lineWidth;\n  }\n\n  ctx.strokeStyle = settings.color;\n  ctx.fillStyle = settings.color;\n  ctx.lineCap = 'round';\n  ctx.lineJoin = 'round';\n\n  ctx.beginPath();\n  if (points.length === 1) {\n    ctx.arc(points[0].x, points[0].y, ctx.lineWidth / 2, 0, Math.PI * 2);\n    ctx.fill();\n  } else {\n    ctx.moveTo(points[0].x, points[0].y);\n    for (let i = 1; i < points.length; i++) {\n      ctx.lineTo(points[i].x, points[i].y);\n    }\n    ctx.stroke();\n  }\n  ctx.restore();\n};\n\nexport const drawBrushCursor = (\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  zoom: number = 1,\n) => {\n  ctx.save();\n  ctx.strokeStyle = color;\n  ctx.lineWidth = 2 / zoom;\n  ctx.beginPath();\n  ctx.arc(x, y, size / 2, 0, Math.PI * 2);\n  ctx.stroke();\n  ctx.restore();\n};\n\nexport const getCanvasCoords = (\n  e: MouseEvent | React.MouseEvent,\n  canvasRef: React.RefObject<HTMLCanvasElement>,\n  zoom: number = 1,\n  offset: { x: number; y: number } = { x: 0, y: 0 },\n) => {\n  if (!canvasRef.current) return null;\n  const rect = canvasRef.current.getBoundingClientRect();\n  const x = (e.clientX - rect.left - offset.x) / zoom;\n  const y = (e.clientY - rect.top - offset.y) / zoom;\n  return { x, y };\n};\n\nexport const samplePixelColor = (\n  canvas: HTMLCanvasElement,\n  x: number,\n  y: number,\n): string | null => {\n  const ctx = canvas.getContext('2d');\n  if (!ctx) return null;\n\n  const imageData = ctx.getImageData(x, y, 1, 1);\n  const [r, g, b] = imageData.data;\n  return `#${[r, g, b].map((v) => v.toString(16).padStart(2, '0')).join('')}`;\n};\n","export const calculateColorRemovalAlphaMap = (\n  data: Uint8ClampedArray,\n  targetColor: string,\n  tolerance: number,\n  invert: boolean = false,\n  feather: number = 0,\n): Uint8Array => {\n  const hex = targetColor.replace('#', '');\n  const targetR = parseInt(hex.substring(0, 2), 16);\n  const targetG = parseInt(hex.substring(2, 4), 16);\n  const targetB = parseInt(hex.substring(4, 6), 16);\n\n  const alphaMap = new Uint8Array(data.length / 4);\n  const maxDistance = Math.sqrt(255 * 255 * 3);\n  const threshold = tolerance / 100;\n  const featherRange = feather / 100;\n\n  for (let i = 0; i < data.length; i += 4) {\n    const r = data[i];\n    const g = data[i + 1];\n    const b = data[i + 2];\n\n    const distance = Math.sqrt(\n      Math.pow(r - targetR, 2) + Math.pow(g - targetG, 2) + Math.pow(b - targetB, 2),\n    );\n\n    const normalizedDistance = distance / maxDistance;\n\n    let baseAlpha;\n\n    if (feather === 0) {\n      baseAlpha = normalizedDistance <= threshold ? 0 : 1;\n    } else {\n      const distanceFromThreshold = normalizedDistance - threshold;\n\n      if (distanceFromThreshold < -featherRange) {\n        baseAlpha = 0;\n      } else if (distanceFromThreshold > featherRange) {\n        baseAlpha = 1;\n      } else {\n        baseAlpha = (distanceFromThreshold + featherRange) / (featherRange * 2);\n      }\n    }\n\n    if (invert) {\n      baseAlpha = 1 - baseAlpha;\n    }\n\n    alphaMap[i / 4] = Math.round(baseAlpha * 255);\n  }\n  return alphaMap;\n};\n\nimport { Canvas, FabricObject, FabricImage } from 'fabric';\n\nexport const applyMaskToFabricObject = (\n  canvas: Canvas,\n  object: FabricObject,\n  maskCanvas: HTMLCanvasElement,\n) => {\n  if (!(object instanceof FabricImage)) return;\n\n  const imgElement = object.getElement() as HTMLImageElement | HTMLCanvasElement;\n  const width = imgElement.width;\n  const height = imgElement.height;\n\n  const tempCanvas = document.createElement('canvas');\n  tempCanvas.width = width;\n  tempCanvas.height = height;\n  const ctx = tempCanvas.getContext('2d')!;\n\n  // Draw original image\n  ctx.drawImage(imgElement, 0, 0, width, height);\n\n  const imageData = ctx.getImageData(0, 0, width, height);\n  const data = imageData.data;\n\n  const maskCtx = maskCanvas.getContext('2d')!;\n\n  const tempMaskCanvas = document.createElement('canvas');\n  tempMaskCanvas.width = width;\n  tempMaskCanvas.height = height;\n  const tempMaskCtx = tempMaskCanvas.getContext('2d')!;\n  tempMaskCtx.drawImage(maskCanvas, 0, 0, width, height);\n  const maskData = tempMaskCtx.getImageData(0, 0, width, height).data;\n\n  for (let i = 0; i < data.length; i += 4) {\n    const maskVal = maskData[i]; // Red channel\n    data[i + 3] = maskVal;\n  }\n\n  ctx.putImageData(imageData, 0, 0);\n\n  // Create new FabricImage\n  const newImg = new FabricImage(tempCanvas);\n\n  // Copy properties\n  newImg.set({\n    left: object.left,\n    top: object.top,\n    scaleX: object.scaleX,\n    scaleY: object.scaleY,\n    angle: object.angle,\n    skewX: object.skewX,\n    skewY: object.skewY,\n    flipX: object.flipX,\n    flipY: object.flipY,\n    originX: object.originX,\n    originY: object.originY,\n    opacity: object.opacity,\n  });\n\n  // Replace in canvas\n  const index = canvas.getObjects().indexOf(object);\n  canvas.remove(object);\n  canvas.add(newImg);\n  canvas.moveObjectTo(newImg, index);\n  canvas.setActiveObject(newImg);\n  canvas.requestRenderAll();\n};\n\nexport const applyMaskToCanvas = (\n  canvasRef: React.RefObject<HTMLCanvasElement>,\n  maskCanvas: HTMLCanvasElement,\n  history: { push: (img: string, label: string, isSetBase: boolean) => void },\n  label: string = 'Apply Mask',\n) => {\n  if (!canvasRef.current) return;\n\n  const canvas = canvasRef.current;\n  const ctx = canvas.getContext('2d')!;\n  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n  const data = imageData.data;\n\n  const maskCtx = maskCanvas.getContext('2d')!;\n  const maskData = maskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\n\n  for (let i = 0; i < data.length; i += 4) {\n    const maskAlpha = maskData.data[i];\n    data[i + 3] = maskAlpha;\n  }\n\n  ctx.putImageData(imageData, 0, 0);\n  // history.push(canvas.toDataURL(), label, false); // History handling might differ\n};\n\nexport const applyBlurResultToCanvas = async (\n  canvas: Canvas,\n  resultCanvas: HTMLCanvasElement,\n  mode: 'overlay' | 'flatten' = 'overlay',\n) => {\n  const resultImg = new FabricImage(resultCanvas);\n\n  if (mode === 'flatten') {\n    // Flatten: clear and replace with single image\n    canvas.clear();\n    // Assuming resultCanvas has same dimensions as canvas\n    // canvas.setDimensions({ width: resultImg.width!, height: resultImg.height! });\n\n    resultImg.set({\n      left: 0,\n      top: 0,\n      originX: 'left',\n      originY: 'top',\n      selectable: true,\n      evented: true,\n    });\n    canvas.add(resultImg);\n  } else {\n    // Overlay: add on top, locked\n    resultImg.set({\n      left: 0,\n      top: 0,\n      originX: 'left',\n      originY: 'top',\n      selectable: false,\n      evented: false,\n      opacity: 1,\n    });\n    canvas.add(resultImg);\n  }\n\n  canvas.requestRenderAll();\n};\n","import React, { useEffect, useState, useRef } from 'react';\nimport {\n  Modal,\n  Slider,\n  Radio,\n  Space,\n  Button,\n  Select,\n  InputNumber,\n  Tooltip,\n  ColorPicker,\n} from 'antd';\nimport { UndoOutlined, RedoOutlined, QuestionCircleOutlined } from '@ant-design/icons';\nimport {\n  BrushSettings,\n  drawBrushStroke,\n  drawBrushCursor,\n  getCanvasCoords,\n} from '../utils/brushHelpers';\nimport { calculateColorRemovalAlphaMap } from '../utils/effectsHelpers';\n\nconst { Option } = Select;\n\ntype ColorRemovalModalProps = {\n  open: boolean;\n  onCancel: () => void;\n  onApply: (maskCanvas: HTMLCanvasElement) => void;\n  selectedColor: string | null;\n  sourceCanvas: HTMLCanvasElement | null;\n};\n\nconst ColorRemovalModal: React.FC<ColorRemovalModalProps> = ({\n  open,\n  onCancel,\n  onApply,\n  selectedColor,\n  sourceCanvas,\n}) => {\n  const [tolerance, setTolerance] = useState(30);\n  const [previewMode, setPreviewMode] = useState<'normal' | 'mask'>('normal');\n  const [invert, setInvert] = useState(false);\n  const [feather, setFeather] = useState(0);\n  const [activeColor, setActiveColor] = useState(selectedColor || '#000000');\n  const [isAltPressed, setIsAltPressed] = useState(false);\n\n  useEffect(() => {\n    if (selectedColor) setActiveColor(selectedColor);\n  }, [selectedColor]);\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Alt') setIsAltPressed(true);\n    };\n    const handleKeyUp = (e: KeyboardEvent) => {\n      if (e.key === 'Alt') setIsAltPressed(false);\n    };\n    window.addEventListener('keydown', handleKeyDown);\n    window.addEventListener('keyup', handleKeyUp);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n      window.removeEventListener('keyup', handleKeyUp);\n    };\n  }, []);\n\n  const [brushMode, setBrushMode] = useState<'remove' | 'keep'>('remove');\n  const [brushSize, setBrushSize] = useState(20);\n  const [brushOpacity, setBrushOpacity] = useState(1);\n  const [brushType, setBrushType] = useState<'hard' | 'soft'>('hard');\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [cursorPos, setCursorPos] = useState<{ x: number; y: number } | null>(null);\n  const [previewColor, setPreviewColor] = useState<string | null>(null);\n  const [displayParams, setDisplayParams] = useState({ scale: 1, x: 0, y: 0 });\n\n  const containerRef = useRef<HTMLDivElement>(null);\n  const previewCanvasRef = useRef<HTMLCanvasElement>(null);\n  const maskCanvasRef = useRef<HTMLCanvasElement>(null);\n  const overlayCanvasRef = useRef<HTMLCanvasElement>(null);\n  const drawPoints = useRef<{ x: number; y: number }[]>([]);\n  const lastDrawPoint = useRef<{ x: number; y: number } | null>(null);\n\n  const [history, setHistory] = useState<ImageData[]>([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n\n  useEffect(() => {\n    if (\n      open &&\n      sourceCanvas &&\n      previewCanvasRef.current &&\n      maskCanvasRef.current &&\n      overlayCanvasRef.current &&\n      containerRef.current\n    ) {\n      const w = sourceCanvas.width;\n      const h = sourceCanvas.height;\n      const container = containerRef.current;\n      const { clientWidth: cw, clientHeight: ch } = container;\n\n      // Calculate scale to fit image in container\n      const scale = Math.min(cw / w, ch / h);\n      const displayW = w * scale;\n      const displayH = h * scale;\n      const displayX = (cw - displayW) / 2;\n      const displayY = (ch - displayH) / 2;\n\n      setDisplayParams({ scale, x: displayX, y: displayY });\n\n      previewCanvasRef.current.width = w;\n      previewCanvasRef.current.height = h;\n      maskCanvasRef.current.width = w;\n      maskCanvasRef.current.height = h;\n\n      // Overlay canvas matches container size (screen pixels)\n      overlayCanvasRef.current.width = cw;\n      overlayCanvasRef.current.height = ch;\n\n      const ctx = previewCanvasRef.current.getContext('2d')!;\n      ctx.drawImage(sourceCanvas, 0, 0);\n\n      const maskCtx = maskCanvasRef.current.getContext('2d')!;\n      maskCtx.fillStyle = 'white';\n      maskCtx.fillRect(0, 0, w, h);\n\n      saveHistory();\n    }\n  }, [open, sourceCanvas]);\n\n  const saveHistory = () => {\n    if (!maskCanvasRef.current) return;\n    const ctx = maskCanvasRef.current.getContext('2d')!;\n    const data = ctx.getImageData(0, 0, maskCanvasRef.current.width, maskCanvasRef.current.height);\n    const newHistory = history.slice(0, historyIndex + 1);\n    newHistory.push(data);\n    setHistory(newHistory);\n    setHistoryIndex(newHistory.length - 1);\n  };\n\n  const undo = () => {\n    if (historyIndex > 0) {\n      const newIndex = historyIndex - 1;\n      const data = history[newIndex];\n      const ctx = maskCanvasRef.current!.getContext('2d')!;\n      ctx.putImageData(data, 0, 0);\n      setHistoryIndex(newIndex);\n      updatePreview();\n    }\n  };\n\n  const redo = () => {\n    if (historyIndex < history.length - 1) {\n      const newIndex = historyIndex + 1;\n      const data = history[newIndex];\n      const ctx = maskCanvasRef.current!.getContext('2d')!;\n      ctx.putImageData(data, 0, 0);\n      setHistoryIndex(newIndex);\n      updatePreview();\n    }\n  };\n\n  const updatePreview = () => {\n    if (!sourceCanvas || !previewCanvasRef.current || !maskCanvasRef.current) return;\n\n    const w = sourceCanvas.width;\n    const h = sourceCanvas.height;\n    const ctx = previewCanvasRef.current.getContext('2d')!;\n    const maskCtx = maskCanvasRef.current.getContext('2d')!;\n\n    // 1. Draw original image\n    ctx.clearRect(0, 0, w, h);\n    ctx.drawImage(sourceCanvas, 0, 0);\n\n    // 2. Calculate auto-mask from color\n    const imageData = ctx.getImageData(0, 0, w, h);\n    const alphaMap = calculateColorRemovalAlphaMap(\n      imageData.data,\n      activeColor,\n      tolerance,\n      invert,\n      feather,\n    );\n\n    // 3. Combine with manual mask\n    const manualMaskData = maskCtx.getImageData(0, 0, w, h);\n    const finalImageData = ctx.createImageData(w, h);\n\n    for (let i = 0; i < w * h; i++) {\n      const r = imageData.data[i * 4];\n      const g = imageData.data[i * 4 + 1];\n      const b = imageData.data[i * 4 + 2];\n      const a = imageData.data[i * 4 + 3];\n\n      const autoAlpha = alphaMap[i];\n      const manualAlpha = manualMaskData.data[i * 4]; // Red channel of white mask\n\n      // Combine alphas (multiply)\n      const finalAlpha = a * (autoAlpha / 255) * (manualAlpha / 255);\n\n      finalImageData.data[i * 4] = r;\n      finalImageData.data[i * 4 + 1] = g;\n      finalImageData.data[i * 4 + 2] = b;\n      finalImageData.data[i * 4 + 3] = finalAlpha;\n    }\n\n    if (previewMode === 'mask') {\n      // Draw mask only (black and white)\n      for (let i = 0; i < w * h; i++) {\n        const alpha = finalImageData.data[i * 4 + 3];\n        finalImageData.data[i * 4] = alpha;\n        finalImageData.data[i * 4 + 1] = alpha;\n        finalImageData.data[i * 4 + 2] = alpha;\n        finalImageData.data[i * 4 + 3] = 255;\n      }\n    }\n\n    ctx.putImageData(finalImageData, 0, 0);\n  };\n\n  useEffect(() => {\n    updatePreview();\n  }, [tolerance, invert, feather, activeColor, previewMode, historyIndex]);\n\n  const pickColor = (e: React.MouseEvent) => {\n    if (!sourceCanvas || !overlayCanvasRef.current) return;\n    const coords = getCanvasCoords(e, overlayCanvasRef, displayParams.scale, {\n      x: displayParams.x,\n      y: displayParams.y,\n    });\n    if (coords) {\n      const ctx = sourceCanvas.getContext('2d');\n      if (!ctx) return;\n      const x = Math.max(0, Math.min(coords.x, sourceCanvas.width - 1));\n      const y = Math.max(0, Math.min(coords.y, sourceCanvas.height - 1));\n      const pixel = ctx.getImageData(x, y, 1, 1).data;\n      const hex =\n        '#' + [pixel[0], pixel[1], pixel[2]].map((x) => x.toString(16).padStart(2, '0')).join('');\n      setActiveColor(hex);\n    }\n  };\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    if (isAltPressed) {\n      pickColor(e);\n      return;\n    }\n    setIsDrawing(true);\n    const coords = getCanvasCoords(e, overlayCanvasRef, displayParams.scale, {\n      x: displayParams.x,\n      y: displayParams.y,\n    });\n    if (coords) {\n      drawPoints.current = [coords];\n      lastDrawPoint.current = coords;\n      draw([coords]);\n    }\n  };\n\n  const handleMouseMove = (e: React.MouseEvent) => {\n    const coords = getCanvasCoords(e, overlayCanvasRef, displayParams.scale, {\n      x: displayParams.x,\n      y: displayParams.y,\n    });\n    setCursorPos(coords);\n\n    // when alt is pressed, sample color under cursor and show preview\n    if (isAltPressed && coords && sourceCanvas) {\n      try {\n        const ctx = sourceCanvas.getContext('2d');\n        if (ctx) {\n          const x = Math.max(0, Math.min(coords.x, sourceCanvas.width - 1));\n          const y = Math.max(0, Math.min(coords.y, sourceCanvas.height - 1));\n          const pixel = ctx.getImageData(x, y, 1, 1).data;\n          const hex =\n            '#' +\n            [pixel[0], pixel[1], pixel[2]].map((v) => v.toString(16).padStart(2, '0')).join('');\n          setPreviewColor(hex);\n        }\n      } catch (err) {\n        setPreviewColor(null);\n      }\n    } else {\n      setPreviewColor(null);\n    }\n\n    if (isAltPressed) return;\n\n    if (isDrawing && coords && lastDrawPoint.current) {\n      drawPoints.current.push(coords);\n      draw([lastDrawPoint.current, coords]);\n      lastDrawPoint.current = coords;\n    }\n  };\n\n  const handleMouseUp = () => {\n    if (isDrawing) {\n      setIsDrawing(false);\n      drawPoints.current = [];\n      lastDrawPoint.current = null;\n      saveHistory();\n      updatePreview();\n    }\n  };\n\n  const draw = (points: { x: number; y: number }[]) => {\n    if (!maskCanvasRef.current) return;\n    const ctx = maskCanvasRef.current.getContext('2d')!;\n\n    const settings: BrushSettings = {\n      color: brushMode === 'remove' ? '#000000' : '#ffffff',\n      lineWidth: brushSize,\n      opacity: brushOpacity,\n      flow: 1,\n      type: brushType,\n    };\n\n    drawBrushStroke(ctx, points, settings);\n\n    // Update preview immediately for better feedback\n    updatePreview();\n  };\n\n  // Draw cursor\n  useEffect(() => {\n    if (!overlayCanvasRef.current || !cursorPos) return;\n    const ctx = overlayCanvasRef.current.getContext('2d')!;\n    ctx.clearRect(0, 0, overlayCanvasRef.current.width, overlayCanvasRef.current.height);\n\n    const screenX = cursorPos.x * displayParams.scale + displayParams.x;\n    const screenY = cursorPos.y * displayParams.scale + displayParams.y;\n    const screenSize = brushSize * displayParams.scale;\n\n    // draw brush cursor\n    drawBrushCursor(ctx, screenX, screenY, screenSize, '#fff');\n    drawBrushCursor(ctx, screenX, screenY, screenSize, '#000'); // Double outline for visibility\n\n    // draw live color preview when alt is pressed\n    if (isAltPressed && previewColor) {\n      const previewRadius = 9;\n      const offset = 12; // offset so preview doesn't sit under cursor\n      const px = Math.min(\n        overlayCanvasRef.current.width - previewRadius - 4,\n        Math.max(previewRadius + 4, screenX + offset),\n      );\n      const py = Math.min(\n        overlayCanvasRef.current.height - previewRadius - 4,\n        Math.max(previewRadius + 4, screenY + offset),\n      );\n\n      // outer border\n      ctx.beginPath();\n      ctx.arc(px, py, previewRadius + 2, 0, Math.PI * 2);\n      ctx.fillStyle = '#00000088';\n      ctx.fill();\n\n      // color circle\n      ctx.beginPath();\n      ctx.arc(px, py, previewRadius, 0, Math.PI * 2);\n      ctx.fillStyle = previewColor;\n      ctx.fill();\n\n      // hex label\n      ctx.font = '12px sans-serif';\n      ctx.fillStyle = '#fff';\n      ctx.textAlign = 'center';\n      ctx.fillText(previewColor.toUpperCase(), px, py + previewRadius + 14);\n    }\n  }, [cursorPos, brushSize, displayParams, isAltPressed, previewColor]);\n\n  const handleApply = () => {\n    if (previewCanvasRef.current) {\n      onApply(previewCanvasRef.current);\n    }\n  };\n\n  return (\n    <Modal\n      title=\"Mask\"\n      open={open}\n      onCancel={onCancel}\n      onOk={handleApply}\n      width={1000}\n      style={{ top: 20 }}\n      maskClosable={false}\n    >\n      <div style={{ display: 'flex', gap: 16 }}>\n        <div style={{ width: 300 }}>\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\n            <div>\n              <span>Target Color:</span>\n              <ColorPicker\n                value={activeColor}\n                onChange={(c) => setActiveColor(c.toHexString())}\n                showText\n              />\n              <div style={{ fontSize: 12, color: '#999', marginTop: 4 }}>\n                Hold Alt + Click on image to pick color\n              </div>\n            </div>\n            <div>\n              <span>Tolerance: {tolerance}%</span>\n              <Slider value={tolerance} onChange={setTolerance} />\n            </div>\n            <div>\n              <span>Feather: {feather}%</span>\n              <Slider value={feather} onChange={setFeather} />\n            </div>\n            <div>\n              <Space>\n                <span>Invert:</span>\n                <Button onClick={() => setInvert(!invert)} type={invert ? 'primary' : 'default'}>\n                  {invert ? 'Yes' : 'No'}\n                </Button>\n              </Space>\n            </div>\n            <div>\n              <span>Preview Mode:</span>\n              <Radio.Group value={previewMode} onChange={(e) => setPreviewMode(e.target.value)}>\n                <Radio.Button value=\"normal\">Normal</Radio.Button>\n                <Radio.Button value=\"mask\">Mask</Radio.Button>\n              </Radio.Group>\n            </div>\n\n            <div style={{ borderTop: '1px solid #eee', paddingTop: 16, marginTop: 16 }}>\n              <h4>Manual Adjustments</h4>\n              <Space>\n                <Button\n                  type={brushMode === 'remove' ? 'primary' : 'default'}\n                  onClick={() => setBrushMode('remove')}\n                >\n                  Remove\n                </Button>\n                <Button\n                  type={brushMode === 'keep' ? 'primary' : 'default'}\n                  onClick={() => setBrushMode('keep')}\n                >\n                  Keep\n                </Button>\n              </Space>\n              <div>\n                <span>Size: {brushSize}</span>\n                <Slider min={1} max={100} value={brushSize} onChange={setBrushSize} />\n              </div>\n              <div>\n                <span>Opacity: {brushOpacity}</span>\n                <Slider\n                  min={0}\n                  max={1}\n                  step={0.1}\n                  value={brushOpacity}\n                  onChange={setBrushOpacity}\n                />\n              </div>\n              <div>\n                <span>Hardness:</span>\n                <Radio.Group value={brushType} onChange={(e) => setBrushType(e.target.value)}>\n                  <Radio.Button value=\"hard\">Hard</Radio.Button>\n                  <Radio.Button value=\"soft\">Soft</Radio.Button>\n                </Radio.Group>\n              </div>\n            </div>\n\n            <Space>\n              <Button icon={<UndoOutlined />} onClick={undo} disabled={historyIndex <= 0} />\n              <Button\n                icon={<RedoOutlined />}\n                onClick={redo}\n                disabled={historyIndex >= history.length - 1}\n              />\n            </Space>\n          </Space>\n        </div>\n\n        <div\n          ref={containerRef}\n          style={{\n            flex: 1,\n            position: 'relative',\n            border: '1px solid #ccc',\n            height: 500,\n            overflow: 'hidden',\n            background:\n              'url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==)',\n          }}\n        >\n          <canvas\n            ref={previewCanvasRef}\n            style={{\n              position: 'absolute',\n              top: displayParams.y,\n              left: displayParams.x,\n              width: displayParams.scale * (sourceCanvas?.width || 0),\n              height: displayParams.scale * (sourceCanvas?.height || 0),\n            }}\n          />\n          <canvas\n            ref={overlayCanvasRef}\n            style={{\n              position: 'absolute',\n              top: 0,\n              left: 0,\n              width: '100%',\n              height: '100%',\n              cursor: isAltPressed ? 'crosshair' : 'none',\n            }}\n            onMouseDown={handleMouseDown}\n            onMouseMove={handleMouseMove}\n            onMouseUp={handleMouseUp}\n            onMouseLeave={handleMouseUp}\n          />\n          {/* Hidden mask canvas */}\n          <canvas ref={maskCanvasRef} style={{ display: 'none' }} />\n        </div>\n      </div>\n    </Modal>\n  );\n};\n\nexport default ColorRemovalModal;\n","import React from 'react';\nimport { List, Card, Button, Popconfirm, Image, Typography } from 'antd';\nimport { DeleteOutlined, FolderOpenOutlined } from '@ant-design/icons';\nimport { SavedProject } from '../types';\n\ninterface SavedProjectsListProps {\n  projects: SavedProject[];\n  onLoad: (project: SavedProject) => void;\n  onDelete: (id: string) => void;\n}\n\nconst SavedProjectsList: React.FC<SavedProjectsListProps> = ({ projects, onLoad, onDelete }) => {\n  if (projects.length === 0) {\n    return (\n      <div style={{ textAlign: 'center', padding: '20px' }}>\n        <Typography.Text type=\"secondary\">No saved projects found.</Typography.Text>\n      </div>\n    );\n  }\n\n  return (\n    <List\n      grid={{ gutter: 16, column: 3 }}\n      dataSource={projects}\n      renderItem={(item) => (\n        <List.Item>\n          <Card\n            hoverable\n            cover={\n              <div\n                style={{\n                  height: 150,\n                  overflow: 'hidden',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  background: '#f0f0f0',\n                }}\n              >\n                <Image\n                  src={item.thumbnail}\n                  preview={false}\n                  style={{ maxHeight: '100%', maxWidth: '100%', objectFit: 'contain' }}\n                />\n              </div>\n            }\n            onClick={() => onLoad(item)}\n            actions={[\n              <Popconfirm\n                title=\"Delete project?\"\n                onConfirm={() => {\n                  onDelete(item.id);\n                }}\n                okText=\"Yes\"\n                cancelText=\"No\"\n              >\n                <Button\n                  type=\"text\"\n                  danger\n                  icon={<DeleteOutlined />}\n                  onClick={(e) => e.stopPropagation()}\n                >\n                  Delete\n                </Button>\n              </Popconfirm>,\n            ]}\n          >\n            <Card.Meta title={item.name} description={new Date(item.updatedAt).toLocaleString()} />\n          </Card>\n        </List.Item>\n      )}\n    />\n  );\n};\n\nexport default SavedProjectsList;\n","import React from 'react';\nimport { Modal } from 'antd';\nimport { SavedProject } from '../types';\nimport SavedProjectsList from './SavedProjectsList';\n\ninterface ProjectModalProps {\n  visible: boolean;\n  onCancel: () => void;\n  projects: SavedProject[];\n  onLoad: (project: SavedProject) => void;\n  onDelete: (id: string) => void;\n}\n\nconst ProjectModal: React.FC<ProjectModalProps> = ({\n  visible,\n  onCancel,\n  projects,\n  onLoad,\n  onDelete,\n}) => {\n  return (\n    <Modal title=\"Saved Projects\" open={visible} onCancel={onCancel} footer={null} width={800}>\n      <SavedProjectsList projects={projects} onLoad={onLoad} onDelete={onDelete} />\n    </Modal>\n  );\n};\n\nexport default ProjectModal;\n","import React, { useEffect, useRef, useState } from 'react';\nimport { Modal, InputNumber, Button, Space, message, Select, Checkbox } from 'antd';\nimport { Canvas as FabricCanvas } from 'fabric';\n\nconst { Option } = Select;\n\ninterface CropModalProps {\n  visible: boolean;\n  onCancel: () => void;\n  canvas: FabricCanvas | null;\n  history: any;\n}\n\nconst CropModal: React.FC<CropModalProps> = ({ visible, onCancel, canvas, history }) => {\n  const previewCanvasRef = useRef<HTMLCanvasElement>(null);\n  const [cropArea, setCropArea] = useState({ x: 0, y: 0, width: 0, height: 0 });\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n  const [resizeHandle, setResizeHandle] = useState<string | null>(null);\n  const [aspectRatio, setAspectRatio] = useState<number | null>(null);\n  const [lockRatio, setLockRatio] = useState(false);\n\n  useEffect(() => {\n    if (visible && canvas) {\n      // Initialize crop area to full canvas\n      const width = canvas.getWidth();\n      const height = canvas.getHeight();\n      setCropArea({ x: 0, y: 0, width, height });\n      setAspectRatio(null);\n      setLockRatio(false);\n    }\n  }, [visible, canvas]);\n\n  useEffect(() => {\n    if (!visible || !canvas || !previewCanvasRef.current) return;\n\n    const previewCanvas = previewCanvasRef.current;\n    const ctx = previewCanvas.getContext('2d');\n    if (!ctx) return;\n\n    // Set preview canvas size\n    const canvasWidth = canvas.getWidth();\n    const canvasHeight = canvas.getHeight();\n    previewCanvas.width = canvasWidth;\n    previewCanvas.height = canvasHeight;\n\n    // Draw the current canvas state\n    const canvasElement = canvas.getElement();\n    ctx.drawImage(canvasElement, 0, 0);\n\n    // Draw crop overlay\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n\n    // Clear crop area to show it\n    ctx.clearRect(cropArea.x, cropArea.y, cropArea.width, cropArea.height);\n    ctx.drawImage(\n      canvasElement,\n      cropArea.x,\n      cropArea.y,\n      cropArea.width,\n      cropArea.height,\n      cropArea.x,\n      cropArea.y,\n      cropArea.width,\n      cropArea.height,\n    );\n\n    // Draw crop rectangle border\n    ctx.strokeStyle = '#1890ff';\n    ctx.lineWidth = 2;\n    ctx.strokeRect(cropArea.x, cropArea.y, cropArea.width, cropArea.height);\n\n    // Draw resize handles\n    const handleSize = 8;\n    ctx.fillStyle = '#1890ff';\n    const handles = [\n      { x: cropArea.x, y: cropArea.y }, // top-left\n      { x: cropArea.x + cropArea.width, y: cropArea.y }, // top-right\n      { x: cropArea.x, y: cropArea.y + cropArea.height }, // bottom-left\n      { x: cropArea.x + cropArea.width, y: cropArea.y + cropArea.height }, // bottom-right\n      { x: cropArea.x + cropArea.width / 2, y: cropArea.y }, // top-middle\n      { x: cropArea.x + cropArea.width / 2, y: cropArea.y + cropArea.height }, // bottom-middle\n      { x: cropArea.x, y: cropArea.y + cropArea.height / 2 }, // left-middle\n      { x: cropArea.x + cropArea.width, y: cropArea.y + cropArea.height / 2 }, // right-middle\n    ];\n\n    handles.forEach((handle) => {\n      ctx.fillRect(handle.x - handleSize / 2, handle.y - handleSize / 2, handleSize, handleSize);\n    });\n  }, [visible, canvas, cropArea]);\n\n  const getHandleAtPosition = (x: number, y: number): string | null => {\n    const threshold = 10;\n    const { x: cx, y: cy, width, height } = cropArea;\n\n    if (Math.abs(x - cx) < threshold && Math.abs(y - cy) < threshold) return 'tl';\n    if (Math.abs(x - (cx + width)) < threshold && Math.abs(y - cy) < threshold) return 'tr';\n    if (Math.abs(x - cx) < threshold && Math.abs(y - (cy + height)) < threshold) return 'bl';\n    if (Math.abs(x - (cx + width)) < threshold && Math.abs(y - (cy + height)) < threshold)\n      return 'br';\n    if (Math.abs(x - (cx + width / 2)) < threshold && Math.abs(y - cy) < threshold) return 't';\n    if (Math.abs(x - (cx + width / 2)) < threshold && Math.abs(y - (cy + height)) < threshold)\n      return 'b';\n    if (Math.abs(x - cx) < threshold && Math.abs(y - (cy + height / 2)) < threshold) return 'l';\n    if (Math.abs(x - (cx + width)) < threshold && Math.abs(y - (cy + height / 2)) < threshold)\n      return 'r';\n\n    return null;\n  };\n\n  const isInsideCropArea = (x: number, y: number): boolean => {\n    return (\n      x >= cropArea.x &&\n      x <= cropArea.x + cropArea.width &&\n      y >= cropArea.y &&\n      y <= cropArea.y + cropArea.height\n    );\n  };\n\n  const handleMouseDown = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    const rect = previewCanvasRef.current?.getBoundingClientRect();\n    if (!rect) return;\n\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n\n    const handle = getHandleAtPosition(x, y);\n    if (handle) {\n      setResizeHandle(handle);\n      setDragStart({ x, y });\n    } else if (isInsideCropArea(x, y)) {\n      setIsDragging(true);\n      setDragStart({ x, y });\n    }\n  };\n\n  const handleMouseMove = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!canvas) return;\n    const rect = previewCanvasRef.current?.getBoundingClientRect();\n    if (!rect) return;\n\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n\n    if (resizeHandle) {\n      const dx = x - dragStart.x;\n      const dy = y - dragStart.y;\n\n      let newCrop = { ...cropArea };\n\n      switch (resizeHandle) {\n        case 'tl':\n          newCrop.x += dx;\n          newCrop.y += dy;\n          newCrop.width -= dx;\n          newCrop.height -= dy;\n          break;\n        case 'tr':\n          newCrop.y += dy;\n          newCrop.width += dx;\n          newCrop.height -= dy;\n          break;\n        case 'bl':\n          newCrop.x += dx;\n          newCrop.width -= dx;\n          newCrop.height += dy;\n          break;\n        case 'br':\n          newCrop.width += dx;\n          newCrop.height += dy;\n          break;\n        case 't':\n          newCrop.y += dy;\n          newCrop.height -= dy;\n          break;\n        case 'b':\n          newCrop.height += dy;\n          break;\n        case 'l':\n          newCrop.x += dx;\n          newCrop.width -= dx;\n          break;\n        case 'r':\n          newCrop.width += dx;\n          break;\n      }\n\n      // Apply aspect ratio lock if enabled\n      if (lockRatio && aspectRatio) {\n        if (resizeHandle.includes('r') || resizeHandle.includes('l')) {\n          newCrop.height = newCrop.width / aspectRatio;\n        } else if (resizeHandle.includes('t') || resizeHandle.includes('b')) {\n          newCrop.width = newCrop.height * aspectRatio;\n        } else {\n          // Corner handles - maintain ratio based on which dimension changed more\n          newCrop.height = newCrop.width / aspectRatio;\n        }\n      }\n\n      // Ensure minimum size and bounds\n      if (newCrop.width > 10 && newCrop.height > 10) {\n        newCrop.x = Math.max(0, Math.min(newCrop.x, canvas.getWidth() - newCrop.width));\n        newCrop.y = Math.max(0, Math.min(newCrop.y, canvas.getHeight() - newCrop.height));\n\n        // Ensure width and height don't exceed canvas bounds\n        if (newCrop.x + newCrop.width > canvas.getWidth()) {\n          newCrop.width = canvas.getWidth() - newCrop.x;\n          if (lockRatio && aspectRatio) {\n            newCrop.height = newCrop.width / aspectRatio;\n          }\n        }\n        if (newCrop.y + newCrop.height > canvas.getHeight()) {\n          newCrop.height = canvas.getHeight() - newCrop.y;\n          if (lockRatio && aspectRatio) {\n            newCrop.width = newCrop.height * aspectRatio;\n          }\n        }\n\n        setCropArea(newCrop);\n        setDragStart({ x, y });\n      }\n    } else if (isDragging) {\n      const dx = x - dragStart.x;\n      const dy = y - dragStart.y;\n\n      let newX = cropArea.x + dx;\n      let newY = cropArea.y + dy;\n\n      // Keep within bounds\n      newX = Math.max(0, Math.min(newX, canvas.getWidth() - cropArea.width));\n      newY = Math.max(0, Math.min(newY, canvas.getHeight() - cropArea.height));\n\n      setCropArea({ ...cropArea, x: newX, y: newY });\n      setDragStart({ x, y });\n    }\n  };\n\n  const handleMouseUp = () => {\n    setIsDragging(false);\n    setResizeHandle(null);\n  };\n\n  const handleConfirm = () => {\n    if (!canvas) {\n      message.error('Canvas not available');\n      return;\n    }\n\n    if (cropArea.width < 1 || cropArea.height < 1) {\n      message.error('Crop area is too small');\n      return;\n    }\n\n    // Save state before cropping for undo\n    history.saveState();\n\n    try {\n      // Get all objects with their full data including custom properties\n      const canvasJSON = canvas.toJSON();\n      const objects = canvasJSON.objects || [];\n\n      // Get canvas background color\n      const bgColor = canvas.backgroundColor || '#ffffff';\n\n      // Clear the canvas\n      canvas.clear();\n      canvas.setDimensions({ width: cropArea.width, height: cropArea.height });\n      canvas.set('backgroundColor', bgColor);\n\n      // Adjust all objects' positions relative to the crop\n      objects.forEach((objData: any) => {\n        // Offset positions\n        if (objData.left !== undefined) objData.left -= cropArea.x;\n        if (objData.top !== undefined) objData.top -= cropArea.y;\n\n        // For groups and active selections, offset the objects inside\n        if (objData.objects && Array.isArray(objData.objects)) {\n          objData.objects.forEach((innerObj: any) => {\n            if (innerObj.left !== undefined) innerObj.left -= cropArea.x;\n            if (innerObj.top !== undefined) innerObj.top -= cropArea.y;\n          });\n        }\n      });\n\n      // Reload objects into canvas with proper custom properties\n      canvas.loadFromJSON(\n        {\n          version: canvasJSON.version || '5.3.0',\n          objects,\n        },\n        () => {\n          canvas.renderAll();\n          // Save state after cropping\n          history.saveState();\n          message.success('Canvas cropped successfully');\n          onCancel();\n        },\n      );\n    } catch (error) {\n      console.error('Crop error:', error);\n      message.error('Failed to crop canvas');\n    }\n  };\n\n  const handleAspectRatioChange = (value: string) => {\n    if (value === 'free') {\n      setAspectRatio(null);\n      setLockRatio(false);\n    } else {\n      let ratio: number;\n      switch (value) {\n        case '16:9':\n          ratio = 16 / 9;\n          break;\n        case '4:3':\n          ratio = 4 / 3;\n          break;\n        case '3:2':\n          ratio = 3 / 2;\n          break;\n        case '1:1':\n          ratio = 1;\n          break;\n        case '9:16':\n          ratio = 9 / 16;\n          break;\n        case '3:4':\n          ratio = 3 / 4;\n          break;\n        case '2:3':\n          ratio = 2 / 3;\n          break;\n        default:\n          ratio = 1;\n      }\n      setAspectRatio(ratio);\n      setLockRatio(true);\n\n      // Adjust current crop area to match ratio\n      const newHeight = cropArea.width / ratio;\n      if (newHeight <= (canvas?.getHeight() || 0)) {\n        setCropArea({ ...cropArea, height: newHeight });\n      } else {\n        const newWidth = cropArea.height * ratio;\n        setCropArea({ ...cropArea, width: newWidth });\n      }\n    }\n  };\n\n  return (\n    <Modal\n      title=\"Crop Canvas\"\n      open={visible}\n      onCancel={onCancel}\n      width={Math.min(canvas?.getWidth() || 800, 1200) + 100}\n      footer={[\n        <Button key=\"cancel\" onClick={onCancel}>\n          Cancel\n        </Button>,\n        <Button key=\"confirm\" type=\"primary\" onClick={handleConfirm}>\n          Confirm Crop\n        </Button>,\n      ]}\n    >\n      <div style={{ marginBottom: 16 }}>\n        <Space direction=\"vertical\" style={{ width: '100%' }}>\n          <Space>\n            <span>Aspect Ratio:</span>\n            <Select\n              style={{ width: 120 }}\n              value={\n                !lockRatio\n                  ? 'free'\n                  : aspectRatio === 16 / 9\n                    ? '16:9'\n                    : aspectRatio === 4 / 3\n                      ? '4:3'\n                      : aspectRatio === 3 / 2\n                        ? '3:2'\n                        : aspectRatio === 1\n                          ? '1:1'\n                          : aspectRatio === 9 / 16\n                            ? '9:16'\n                            : aspectRatio === 3 / 4\n                              ? '3:4'\n                              : aspectRatio === 2 / 3\n                                ? '2:3'\n                                : 'free'\n              }\n              onChange={handleAspectRatioChange}\n            >\n              <Option value=\"free\">Free</Option>\n              <Option value=\"16:9\">16:9 (Landscape)</Option>\n              <Option value=\"4:3\">4:3 (Landscape)</Option>\n              <Option value=\"3:2\">3:2 (Landscape)</Option>\n              <Option value=\"1:1\">1:1 (Square)</Option>\n              <Option value=\"9:16\">9:16 (Portrait)</Option>\n              <Option value=\"3:4\">3:4 (Portrait)</Option>\n              <Option value=\"2:3\">2:3 (Portrait)</Option>\n            </Select>\n            <Checkbox checked={lockRatio} onChange={(e) => setLockRatio(e.target.checked)}>\n              Lock\n            </Checkbox>\n          </Space>\n          <Space>\n            <span>X:</span>\n            <InputNumber\n              min={0}\n              max={canvas?.getWidth() || 0}\n              value={Math.round(cropArea.x)}\n              onChange={(val) => setCropArea({ ...cropArea, x: val || 0 })}\n            />\n            <span>Y:</span>\n            <InputNumber\n              min={0}\n              max={canvas?.getHeight() || 0}\n              value={Math.round(cropArea.y)}\n              onChange={(val) => setCropArea({ ...cropArea, y: val || 0 })}\n            />\n            <span>Width:</span>\n            <InputNumber\n              min={1}\n              max={canvas?.getWidth() || 0}\n              value={Math.round(cropArea.width)}\n              onChange={(val) => {\n                const newWidth = val || 1;\n                if (lockRatio && aspectRatio) {\n                  setCropArea({ ...cropArea, width: newWidth, height: newWidth / aspectRatio });\n                } else {\n                  setCropArea({ ...cropArea, width: newWidth });\n                }\n              }}\n            />\n            <span>Height:</span>\n            <InputNumber\n              min={1}\n              max={canvas?.getHeight() || 0}\n              value={Math.round(cropArea.height)}\n              onChange={(val) => {\n                const newHeight = val || 1;\n                if (lockRatio && aspectRatio) {\n                  setCropArea({ ...cropArea, width: newHeight * aspectRatio, height: newHeight });\n                } else {\n                  setCropArea({ ...cropArea, height: newHeight });\n                }\n              }}\n            />\n          </Space>\n        </Space>\n      </div>\n      <div\n        style={{\n          overflow: 'auto',\n          maxHeight: '600px',\n          border: '1px solid #d9d9d9',\n          borderRadius: '4px',\n        }}\n      >\n        <canvas\n          ref={previewCanvasRef}\n          style={{ display: 'block', cursor: isDragging ? 'move' : 'crosshair' }}\n          onMouseDown={handleMouseDown}\n          onMouseMove={handleMouseMove}\n          onMouseUp={handleMouseUp}\n          onMouseLeave={handleMouseUp}\n        />\n      </div>\n      <div style={{ marginTop: 12, fontSize: 12, color: '#666' }}>\n         Drag to move crop area, drag handles to resize, or use inputs above. Select an aspect\n        ratio preset or lock custom ratio. Click \"Confirm Crop\" to apply changes to all layers.\n      </div>\n    </Modal>\n  );\n};\n\nexport default CropModal;\n","// Helper to manage OpenCV.js loading and operations\nimport cv from '@techstark/opencv-js';\n\n// Ensure global cv is available for potential legacy or debug usage\n// @ts-ignore\nif (typeof window !== 'undefined' && !window.cv) {\n  // @ts-ignore\n  window.cv = cv;\n}\n\nexport const loadOpenCv = (): Promise<void> => {\n  return new Promise((resolve) => {\n    // @ts-ignore\n    if (cv.getBuildInformation) {\n      resolve();\n    } else {\n      // @ts-ignore\n      cv['onRuntimeInitialized'] = () => {\n        resolve();\n      };\n    }\n  });\n};\n\nexport const applyBlurWithMask = async (\n  sourceCanvas: HTMLCanvasElement,\n  maskCanvas: HTMLCanvasElement,\n  blurAmount: number = 15,\n  maskFeather: number = 7,\n): Promise<HTMLCanvasElement> => {\n  // Using imported cv module\n  // @ts-ignore\n  if (!cv || !cv.imread) throw new Error('OpenCV.js not loaded');\n\n  // Ensure mask and source dimensions match\n  if (sourceCanvas.width !== maskCanvas.width || sourceCanvas.height !== maskCanvas.height) {\n    const tempMask = document.createElement('canvas');\n    tempMask.width = sourceCanvas.width;\n    tempMask.height = sourceCanvas.height;\n    const ctx = tempMask.getContext('2d');\n    if (ctx) {\n      ctx.drawImage(maskCanvas, 0, 0, sourceCanvas.width, sourceCanvas.height);\n    }\n    maskCanvas = tempMask;\n  }\n\n  const src = cv.imread(sourceCanvas); // CV_8UC4\n  const maskColor = cv.imread(maskCanvas); // CV_8UC4 (white painted areas)\n  const mask = new cv.Mat();\n\n  // grayscale and threshold mask\n  cv.cvtColor(maskColor, mask, cv.COLOR_RGBA2GRAY);\n  cv.threshold(mask, mask, 10, 255, cv.THRESH_BINARY);\n\n  // optional feather mask for smooth edges\n  if (maskFeather && maskFeather > 1) {\n    let f = Math.round(maskFeather);\n    if (f % 2 === 0) f += 1;\n    const kf = new cv.Size(f, f);\n    cv.GaussianBlur(mask, mask, kf, 0);\n  }\n\n  // ensure odd kernel for image blur\n  let k = Math.max(1, Math.floor(blurAmount));\n  if (k % 2 === 0) k += 1;\n  const ksize = new cv.Size(k, k);\n\n  const blurred = new cv.Mat();\n  cv.GaussianBlur(src, blurred, ksize, 0);\n\n  // Composition\n  const dst = src.clone();\n\n  // Use mask to copy blurred to dst\n  blurred.copyTo(dst, mask);\n\n  const out = document.createElement('canvas');\n  out.width = dst.cols;\n  out.height = dst.rows;\n  cv.imshow(out, dst);\n\n  // cleanup\n  src.delete();\n  maskColor.delete();\n  mask.delete();\n  blurred.delete();\n  dst.delete();\n\n  return out;\n};\n","import React, { useEffect, useRef, useState } from 'react';\nimport { Modal, Slider, Button, Space, Typography, Spin, Radio, message, Tooltip } from 'antd';\nimport { Canvas as FabricCanvas, FabricImage, PencilBrush } from 'fabric';\nimport { DeleteOutlined, UndoOutlined, EyeOutlined } from '@ant-design/icons';\nimport { loadOpenCv, applyBlurWithMask } from '../../utils/opencvHelpers';\nimport { applyBlurResultToCanvas } from '../../utils/effectsHelpers';\n\nconst { Text } = Typography;\n\ninterface BlurBrushModalProps {\n  visible: boolean;\n  onCancel: () => void;\n  canvas: FabricCanvas | null;\n  history: any;\n}\n\nconst BlurBrushModal: React.FC<BlurBrushModalProps> = ({ visible, onCancel, canvas, history }) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const maskCanvasRef = useRef<HTMLCanvasElement>(null);\n  const previewCanvasRef = useRef<HTMLCanvasElement>(null);\n  const cursorRef = useRef<HTMLDivElement>(null); // Ref for cursor overlay\n  const [maskFabricCanvas, setMaskFabricCanvas] = useState<FabricCanvas | null>(null);\n\n  const [brushSize, setBrushSize] = useState(30);\n  const [blurAmount, setBlurAmount] = useState(15);\n  const [feather, setFeather] = useState(5);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [applyMode, setApplyMode] = useState<'overlay' | 'flatten'>('overlay');\n\n  const blurAmountRef = useRef(blurAmount);\n  const featherRef = useRef(feather);\n\n  useEffect(() => {\n    blurAmountRef.current = blurAmount;\n  }, [blurAmount]);\n  useEffect(() => {\n    featherRef.current = feather;\n  }, [feather]);\n\n  // Initialize OpenCV on mount\n  useEffect(() => {\n    if (visible) {\n      loadOpenCv().catch((err) => {\n        message.error('Failed to load OpenCV libraries: ' + err.message);\n      });\n    }\n  }, [visible]);\n\n  // Setup canvases\n  useEffect(() => {\n    if (\n      visible &&\n      canvas &&\n      maskCanvasRef.current &&\n      previewCanvasRef.current &&\n      containerRef.current\n    ) {\n      // 1. Setup Preview (Background) Canvas\n      // For performance, we could use a static image of the current canvas state\n      const width = canvas.getWidth();\n      const height = canvas.getHeight();\n\n      const previewCtx = previewCanvasRef.current.getContext('2d');\n      if (previewCtx) {\n        previewCanvasRef.current.width = width;\n        previewCanvasRef.current.height = height;\n\n        // Use toDataURL to capture the absolute canvas state (ignoring zoom/viewport)\n        const dataURL = canvas.toDataURL({ format: 'png', multiplier: 1 });\n        const img = new Image();\n        img.onload = () => {\n          previewCtx.drawImage(img, 0, 0, width, height);\n        };\n        img.src = dataURL;\n      }\n\n      // 2. Setup Mask Fabric Canvas\n      // It sits on top of the preview\n      if (maskFabricCanvas) {\n        maskFabricCanvas.dispose();\n      }\n\n      const mCanvas = new FabricCanvas(maskCanvasRef.current, {\n        isDrawingMode: true,\n        width: width,\n        height: height,\n        backgroundColor: 'rgba(0,0,0,0)', // Transparent\n        selection: false,\n      });\n\n      // Cursor Overlay Logic\n      mCanvas.on('mouse:move', (opt) => {\n        if (cursorRef.current) {\n          const pointer = mCanvas.getScenePoint(opt.e);\n          const size = mCanvas.freeDrawingBrush?.width || 30;\n          cursorRef.current.style.display = 'block';\n          cursorRef.current.style.transform = `translate(${pointer.x - size / 2}px, ${pointer.y - size / 2}px)`;\n          cursorRef.current.style.width = `${size}px`;\n          cursorRef.current.style.height = `${size}px`;\n        }\n      });\n\n      mCanvas.on('mouse:out', () => {\n        if (cursorRef.current) {\n          cursorRef.current.style.display = 'none';\n        }\n      });\n\n      // Configure Brush\n      // We draw with white color which represents the mask\n      // But visually we might want it semi-transparent red or something?\n      // For logic: mask should be white on black.\n      // For UX: user wants to see what they are painting (e.g., Red 50%).\n      // We can paint with Red, then when extracting mask, we convert Red pixels to White.\n      const brush = new PencilBrush(mCanvas);\n      brush.color = 'rgba(255, 0, 0, 0.5)';\n      brush.width = brushSize;\n      mCanvas.freeDrawingBrush = brush;\n\n      // Handle Instant Apply on Stroke End\n      mCanvas.on('path:created', async (opt: any) => {\n        try {\n          setIsProcessing(true);\n          const path = opt.path;\n\n          // Generate Mask from valid mCanvas state (containing the new path)\n          // Create temp canvas for mask processing\n          const tempCanvas = document.createElement('canvas');\n          tempCanvas.width = mCanvas.getWidth();\n          tempCanvas.height = mCanvas.getHeight();\n          const ctx = tempCanvas.getContext('2d')!;\n\n          // Fill black\n          ctx.fillStyle = 'black';\n          ctx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);\n\n          // Get data from fabric canvas\n          const dataUrl = mCanvas.toDataURL({ format: 'png', multiplier: 1 });\n          const img = new Image();\n          img.src = dataUrl;\n          await new Promise<void>((resolve) => {\n            img.onload = () => resolve();\n          });\n\n          ctx.drawImage(img, 0, 0);\n\n          // Threshold to binary white\n          const imageData = ctx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);\n          const data = imageData.data;\n          for (let i = 0; i < data.length; i += 4) {\n            // Check Red channel\n            if (data[i] > 20) {\n              data[i] = 255;\n              data[i + 1] = 255;\n              data[i + 2] = 255;\n              data[i + 3] = 255;\n            } else {\n              data[i] = 0;\n              data[i + 1] = 0;\n              data[i + 2] = 0;\n              data[i + 3] = 255;\n            }\n          }\n          ctx.putImageData(imageData, 0, 0);\n\n          // Apply Blur to PREVIEW canvas\n          if (previewCanvasRef.current) {\n            const result = await applyBlurWithMask(\n              previewCanvasRef.current,\n              tempCanvas,\n              blurAmountRef.current,\n              featherRef.current,\n            );\n\n            // Update preview with result\n            const pCtx = previewCanvasRef.current.getContext('2d');\n            if (pCtx) {\n              pCtx.drawImage(result, 0, 0);\n            }\n          }\n\n          // Clear the red stroke\n          mCanvas.remove(path);\n          mCanvas.requestRenderAll();\n        } catch (e) {\n          console.error('Auto blur failed', e);\n        } finally {\n          setIsProcessing(false);\n        }\n      });\n\n      setMaskFabricCanvas(mCanvas);\n\n      return () => {\n        mCanvas.dispose();\n      };\n    }\n  }, [visible, canvas]);\n\n  // Update brush\n  useEffect(() => {\n    if (maskFabricCanvas) {\n      maskFabricCanvas.freeDrawingBrush!.width = brushSize;\n    }\n  }, [brushSize, maskFabricCanvas]);\n\n  const clearMask = () => {\n    if (maskFabricCanvas) {\n      maskFabricCanvas.clear();\n      maskFabricCanvas.set('backgroundColor', 'rgba(0,0,0,0)');\n      maskFabricCanvas.renderAll();\n    }\n  };\n\n  const undoMask = () => {\n    // Simple undo for fabric canvas (pop last object)\n    if (maskFabricCanvas) {\n      const objects = maskFabricCanvas.getObjects();\n      if (objects.length > 0) {\n        maskFabricCanvas.remove(objects[objects.length - 1]);\n      }\n    }\n  };\n\n  const getMaskImage = async (): Promise<HTMLCanvasElement> => {\n    if (!maskFabricCanvas) throw new Error('No mask canvas');\n\n    // We need a binary mask (white on black)\n    // The user painted with rgba(255,0,0,0.5).\n    // Export to dataURL/image then draw to temp canvas and threshold?\n    // Or just iterate pixels?\n\n    // Fabric toDataURL might include background transparency.\n    // Let's create a temp canvas, fill black, draw the fabric mask objects in WHITE.\n\n    const tempCanvas = document.createElement('canvas');\n    tempCanvas.width = maskFabricCanvas.getWidth();\n    tempCanvas.height = maskFabricCanvas.getHeight();\n    const ctx = tempCanvas.getContext('2d')!;\n\n    // Fill black\n    ctx.fillStyle = 'black';\n    ctx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);\n\n    // To draw objects in white:\n    // We can iterate objects on maskFabricCanvas, clone them, set stroke to white, add to a static canvas?\n    // Or simpler: use globalCompositeOperation if we export the current red mask.\n\n    // Export the current mask as image (preserves transparency)\n    const dataUrl = maskFabricCanvas.toDataURL({ format: 'png', multiplier: 1 });\n\n    return new Promise((resolve) => {\n      const img = new Image();\n      img.onload = () => {\n        // Draw the red tracks\n        ctx.drawImage(img, 0, 0);\n\n        // Now convert all non-black pixels to white?\n        // Or better: Use 'source-in' composite?\n        // Since we filled black, the transparent parts are black now (if we composed).\n        // Wait, drawImage over black rect -> transparent parts remain black. Red parts become red on black.\n        // We want Red -> White.\n\n        const imageData = ctx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);\n        const data = imageData.data;\n        for (let i = 0; i < data.length; i += 4) {\n          // If alpha > 0 or specific color?\n          // The brush was red 0.5.\n          // Check R channel.\n          if (data[i] > 20) {\n            // Threshold\n            data[i] = 255; // R\n            data[i + 1] = 255; // G\n            data[i + 2] = 255; // B\n            data[i + 3] = 255; // Alpha full\n          } else {\n            data[i] = 0;\n            data[i + 1] = 0;\n            data[i + 2] = 0;\n            data[i + 3] = 255; // Full opaque black\n          }\n        }\n        ctx.putImageData(imageData, 0, 0);\n        resolve(tempCanvas);\n      };\n      img.src = dataUrl;\n    });\n  };\n\n  const handlePreview = async () => {\n    if (!canvas || !previewCanvasRef.current) return;\n    setIsProcessing(true);\n    try {\n      const maskCanvas = await getMaskImage();\n      const sourceCanvas = previewCanvasRef.current; // Currently holds original image\n\n      // Perform Blur\n      // For preview, we might want to downscale if large.\n      // But let's try full res first or stick to plan (downscale).\n      // Given structure, downscaling requires management of scaling factors.\n      // Let's rely on simple full res for now, assuming average image < 4K.\n\n      const result = await applyBlurWithMask(sourceCanvas, maskCanvas, blurAmount, feather);\n\n      // Show result in preview canvas\n      const ctx = previewCanvasRef.current.getContext('2d');\n      if (ctx) {\n        ctx.drawImage(result, 0, 0);\n      }\n      message.success('Preview generated');\n    } catch (e: any) {\n      console.error(e);\n      message.error('Preview failed: ' + e.message);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleApply = async () => {\n    if (!canvas || !previewCanvasRef.current) return;\n    setIsProcessing(true);\n    try {\n      // Use the preview canvas as the result directly\n      // Because we have been accumulating blurs on it\n\n      history.saveState();\n      await applyBlurResultToCanvas(canvas, previewCanvasRef.current, applyMode);\n      history.saveState();\n\n      message.success('Blur applied successfully');\n      onCancel();\n    } catch (e: any) {\n      console.error(e);\n      message.error('Apply failed: ' + e.message);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  return (\n    <Modal\n      title=\"Blur Brush\"\n      open={visible}\n      onCancel={onCancel}\n      width={1000}\n      footer={null}\n      destroyOnClose\n    >\n      <div style={{ display: 'flex', gap: 16 }}>\n        {/* Left: Canvas Area */}\n        <div\n          ref={containerRef}\n          style={{\n            position: 'relative',\n            border: '1px solid #d9d9d9',\n            width: canvas?.getWidth() || 800,\n            height: canvas?.getHeight() || 600,\n            overflow: 'hidden',\n          }}\n        >\n          {/* Background / Preview Layer */}\n          <canvas ref={previewCanvasRef} style={{ position: 'absolute', top: 0, left: 0 }} />\n          {/* Mask / Drawing Layer */}\n          <canvas\n            ref={maskCanvasRef}\n            style={{ position: 'absolute', top: 0, left: 0, opacity: 1 }}\n          />\n          <div\n            ref={cursorRef}\n            style={{\n              position: 'absolute',\n              top: 0,\n              left: 0,\n              display: 'none',\n              borderRadius: '50%',\n              border: '2px solid rgba(255, 255, 255, 0.8)',\n              boxShadow: '0 0 4px rgba(0,0,0,0.8)',\n              pointerEvents: 'none',\n              zIndex: 1000,\n            }}\n          />\n        </div>\n\n        {/* Right: Controls */}\n        <div style={{ width: 300, display: 'flex', flexDirection: 'column', gap: 16 }}>\n          <div>\n            <Text strong>Brush Size: {brushSize}px</Text>\n            <Slider min={5} max={200} value={brushSize} onChange={setBrushSize} />\n          </div>\n\n          <div>\n            <Text strong>Blur Amount: {blurAmount}</Text>\n            <Slider min={1} max={100} value={blurAmount} onChange={setBlurAmount} />\n          </div>\n\n          <div>\n            <Text strong>Feather: {feather}px</Text>\n            <Slider min={0} max={50} value={feather} onChange={setFeather} />\n          </div>\n\n          <Space>\n            <Tooltip title=\"Undo Mask Stroke\">\n              <Button icon={<UndoOutlined />} onClick={undoMask} />\n            </Tooltip>\n            <Tooltip title=\"Clear Mask\">\n              <Button icon={<DeleteOutlined />} onClick={clearMask} />\n            </Tooltip>\n          </Space>\n\n          <Space direction=\"vertical\" style={{ marginTop: 16 }}>\n            <Text strong>Apply Mode:</Text>\n            <Radio.Group value={applyMode} onChange={(e) => setApplyMode(e.target.value)}>\n              <Radio value=\"overlay\">Overlay (Non-destructive)</Radio>\n              <Radio value=\"flatten\">Flatten (Permanent)</Radio>\n            </Radio.Group>\n          </Space>\n\n          <div style={{ marginTop: 'auto', display: 'flex', flexDirection: 'column', gap: 8 }}>\n            <Button icon={<EyeOutlined />} onClick={handlePreview} loading={isProcessing}>\n              Update Preview\n            </Button>\n            <Space>\n              <Button onClick={onCancel}>Cancel</Button>\n              <Button type=\"primary\" onClick={handleApply} loading={isProcessing}>\n                Apply Blur\n              </Button>\n            </Space>\n          </div>\n        </div>\n      </div>\n      <div style={{ marginTop: 8, color: '#666' }}>\n        Paint over areas to blur. Red overlay shows masked area. Click Preview to test settings.\n      </div>\n    </Modal>\n  );\n};\n\nexport default BlurBrushModal;\n","import { SavedProject } from '../types';\n\nconst DB_NAME = 'PhotoEditorDB';\nconst DB_VERSION = 1;\nconst STORE_PROJECTS = 'projects';\n\nexport const initDB = (): Promise<IDBDatabase> => {\n  return new Promise((resolve, reject) => {\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\n\n    request.onerror = () => {\n      reject('Error opening database');\n    };\n\n    request.onsuccess = (event) => {\n      resolve((event.target as IDBOpenDBRequest).result);\n    };\n\n    request.onupgradeneeded = (event) => {\n      const db = (event.target as IDBOpenDBRequest).result;\n      if (!db.objectStoreNames.contains(STORE_PROJECTS)) {\n        db.createObjectStore(STORE_PROJECTS, { keyPath: 'id' });\n      }\n    };\n  });\n};\n\nexport const saveProjectToDB = async (project: SavedProject): Promise<void> => {\n  const db = await initDB();\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction([STORE_PROJECTS], 'readwrite');\n    const store = transaction.objectStore(STORE_PROJECTS);\n    const request = store.put(project);\n\n    request.onsuccess = () => resolve();\n    request.onerror = () => reject('Error saving project');\n  });\n};\n\nexport const getAllProjectsFromDB = async (): Promise<SavedProject[]> => {\n  const db = await initDB();\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction([STORE_PROJECTS], 'readonly');\n    const store = transaction.objectStore(STORE_PROJECTS);\n    const request = store.getAll();\n\n    request.onsuccess = () => {\n      const projects = request.result as SavedProject[];\n      // Sort by updatedAt desc\n      projects.sort((a, b) => b.updatedAt - a.updatedAt);\n      resolve(projects);\n    };\n    request.onerror = () => reject('Error fetching projects');\n  });\n};\n\nexport const deleteProjectFromDB = async (id: string): Promise<void> => {\n  const db = await initDB();\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction([STORE_PROJECTS], 'readwrite');\n    const store = transaction.objectStore(STORE_PROJECTS);\n    const request = store.delete(id);\n\n    request.onsuccess = () => resolve();\n    request.onerror = () => reject('Error deleting project');\n  });\n};\n","import { useState, useEffect, useCallback } from 'react';\nimport { message } from 'antd';\nimport { SavedProject } from '../types';\nimport { getAllProjectsFromDB, saveProjectToDB, deleteProjectFromDB } from '../utils/storage';\n\nexport const useProjects = () => {\n  const [savedProjects, setSavedProjects] = useState<SavedProject[]>([]);\n  const [currentProject, setCurrentProject] = useState<SavedProject | null>(null);\n\n  const loadProjects = useCallback(() => {\n    getAllProjectsFromDB()\n      .then(setSavedProjects)\n      .catch((err) => console.error('Failed to load projects from DB', err));\n  }, []);\n\n  useEffect(() => {\n    loadProjects();\n  }, [loadProjects]);\n\n  const saveProject = useCallback(\n    async (preview: string, json: any) => {\n      if (!preview) return;\n\n      const newProject: SavedProject = {\n        id: currentProject?.id || Date.now().toString(),\n        name: currentProject?.name || `Project ${new Date().toLocaleString()}`,\n        thumbnail: preview,\n        json: json,\n        createdAt: currentProject?.createdAt || Date.now(),\n        updatedAt: Date.now(),\n      };\n\n      try {\n        await saveProjectToDB(newProject);\n\n        // Update local state\n        setSavedProjects((prev) => {\n          const exists = prev.some((p) => p.id === newProject.id);\n          const updated = exists\n            ? prev.map((p) => (p.id === newProject.id ? newProject : p))\n            : [newProject, ...prev];\n\n          // Sort by updatedAt desc\n          return updated.sort((a, b) => b.updatedAt - a.updatedAt);\n        });\n\n        setCurrentProject(newProject);\n        message.success('Project saved successfully!');\n      } catch (err) {\n        console.error(err);\n        message.error('Failed to save project');\n      }\n    },\n    [currentProject],\n  );\n\n  const deleteProject = useCallback(async (id: string) => {\n    try {\n      await deleteProjectFromDB(id);\n      setSavedProjects((prev) => prev.filter((p) => p.id !== id));\n      // If the deleted project is currently loaded, clear it so editor doesn't reference it\n      setCurrentProject((cur) => (cur && cur.id === id ? null : cur));\n      message.success('Project deleted');\n    } catch (err) {\n      console.error(err);\n      message.error('Failed to delete project');\n    }\n  }, []);\n\n  const loadProjectIntoEditor = useCallback((project: SavedProject) => {\n    setCurrentProject(project);\n  }, []);\n\n  const clearCurrentProject = useCallback(() => {\n    setCurrentProject(null);\n  }, []);\n\n  return {\n    savedProjects,\n    currentProject,\n    loadProjects,\n    saveProject,\n    deleteProject,\n    loadProjectIntoEditor,\n    clearCurrentProject,\n    setCurrentProject,\n  };\n};\n","import React, { CSSProperties } from 'react';\n\ntype Props = {\n  name: string;\n  styles?: CSSProperties;\n};\n\n/**\n * Icon Font\n * https://www.iconfont.cn/help/detail?helptype=code\n */\nconst IconFont: React.FC<Props> = ({ name, styles }) => (\n  <svg className=\"icon\" aria-hidden=\"true\" style={styles}>\n    <use xlinkHref={`#${name}`} />\n  </svg>\n);\n\nexport default IconFont;\n","export const clamp = (value: number, min = 0, max = 255) => {\n  return Math.min(max, Math.max(min, value));\n};\n\n// For 0..1 ranges\nexport const clamp01 = (value: number) => {\n  return Math.min(1, Math.max(0, value));\n};\n\nexport const rgbToHsl = (r: number, g: number, b: number): [number, number, number] => {\n  r /= 255;\n  g /= 255;\n  b /= 255;\n\n  const max = Math.max(r, g, b);\n  const min = Math.min(r, g, b);\n  let h = 0,\n    s = 0,\n    l = (max + min) / 2;\n\n  if (max !== min) {\n    const d = max - min;\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\n    switch (max) {\n      case r:\n        h = (g - b) / d + (g < b ? 6 : 0);\n        break;\n      case g:\n        h = (b - r) / d + 2;\n        break;\n      case b:\n        h = (r - g) / d + 4;\n        break;\n    }\n    h /= 6;\n  }\n\n  return [h, s, l];\n};\n\nexport const hslToRgb = (h: number, s: number, l: number): [number, number, number] => {\n  let r: number, g: number, b: number;\n\n  if (s === 0) {\n    r = g = b = l; // achromatic\n  } else {\n    const hue2rgb = (p: number, q: number, t: number) => {\n      if (t < 0) t += 1;\n      if (t > 1) t -= 1;\n      if (t < 1 / 6) return p + (q - p) * 6 * t;\n      if (t < 1 / 2) return q;\n      if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\n      return p;\n    };\n\n    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n    const p = 2 * l - q;\n\n    r = hue2rgb(p, q, h + 1 / 3);\n    g = hue2rgb(p, q, h);\n    b = hue2rgb(p, q, h - 1 / 3);\n  }\n\n  return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];\n};\n\nexport const colorRanges = [\n  { name: 'red', range: [345, 15] },\n  { name: 'orange', range: [15, 45] },\n  { name: 'yellow', range: [45, 75] },\n  { name: 'green', range: [75, 165] },\n  { name: 'aqua', range: [165, 195] },\n  { name: 'blue', range: [195, 255] },\n  { name: 'purple', range: [255, 285] },\n  { name: 'magenta', range: [285, 345] },\n];\n\nexport const getColorNameFromHue = (hue: number): string => {\n  const deg = ((hue % 360) + 360) % 360;\n  const entry = colorRanges.find(({ range }) => {\n    const [start, end] = range;\n    if (start <= end) {\n      return deg >= start && deg < end;\n    }\n    return deg >= start || deg < end;\n  });\n  return entry?.name || 'red';\n};\n\n/**\n * Applies HSL adjustments to specific color ranges.\n * @param data Image data to modify\n * @param adjustments Map of color names to HSL adjustments\n * @returns Modified image data\n */\nexport const applyHslAdjustments = (\n  data: ImageData,\n  adjustments: Record<string, { h?: number; s?: number; l?: number }>, // h: degrees, s/l: percent or fractional\n) => {\n  const d = data.data;\n\n  for (let i = 0; i < d.length; i += 4) {\n    // Loop through each pixel (step 4: R,G,B,A)\n    let [r, g, b] = [d[i], d[i + 1], d[i + 2]]; // Extract RGB\n    let [h, s, l] = rgbToHsl(r, g, b); // Convert to HSL (h: 01)\n    let deg = (h * 360 + 360) % 360; // Convert hue to 0360 safely\n\n    // find color range (handles wrap ranges like [345,15])\n    const entry = colorRanges.find(({ range }) => {\n      const [start, end] = range;\n      if (start <= end) {\n        return deg >= start && deg <= end;\n      } else {\n        // wrapped range (e.g. 345 -> 15)\n        return deg >= start || deg <= end;\n      }\n    });\n\n    if (!entry) {\n      // no matching range  write back unchanged\n      [d[i], d[i + 1], d[i + 2]] = hslToRgb(h, s, l);\n      continue;\n    }\n\n    const adj = adjustments[entry.name];\n    if (!adj) {\n      [d[i], d[i + 1], d[i + 2]] = hslToRgb(h, s, l);\n      continue;\n    }\n\n    const [startRaw, endRaw] = entry.range;\n    // Normalize start/end so start <= end (for clamping). If wrapped, push end +360.\n    let start = startRaw;\n    let end = endRaw;\n    if (start > end) end += 360; // e.g., 345..15 => 345..375\n\n    // Normalize deg into the same space as start..end\n    let degNorm = deg;\n    if (degNorm < start) degNorm += 360;\n\n    // ----- HUE: apply degree shift but clamp within the color's range -----\n    if (typeof adj.h === 'number' && adj.h !== 0) {\n      let newDeg = degNorm + adj.h; // tentative\n      // clamp to the range boundaries so it cannot jump outside the color band\n      if (newDeg < start) newDeg = start;\n      if (newDeg > end) newDeg = end;\n      // bring back to 0..360\n      deg = ((newDeg % 360) + 360) % 360; // Normalize back to 0360\n      h = deg / 360; // Convert back to 01 for HSL\n    }\n\n    // ----- SATURATION: flexible input handling -----\n    if (typeof adj.s === 'number' && adj.s !== 0) {\n      // interpret 0.2 as +20% for backward compatibility\n      const satPercent = Math.abs(adj.s) <= 1 ? adj.s * 100 : adj.s; // Allow 0.2 or 20  both = +20%\n      s = clamp01(s * (1 + satPercent / 100)); // Apply proportionally\n    }\n\n    // ----- LUMINANCE: same handling as saturation -----\n    if (typeof adj.l === 'number' && adj.l !== 0) {\n      const lumPercent = Math.abs(adj.l) <= 1 ? adj.l * 100 : adj.l; // e.g. 0.1  +10%\n      l = clamp01(l * (1 + lumPercent / 100)); // Apply multiplicatively\n    }\n\n    // Write final adjusted color back to RGBA buffer\n    [d[i], d[i + 1], d[i + 2]] = hslToRgb(h, s, l);\n  }\n\n  return data;\n};\n","import { clamp, clamp01, rgbToHsl, hslToRgb, colorRanges } from './hslHelpers';\n\nexport type CurvePoint = { x: number; y: number };\n\nexport interface CameraRawSettings {\n  hsl: Record<string, { h: number; s: number; l: number }>;\n  curves: {\n    master: CurvePoint[];\n    red: CurvePoint[];\n    green: CurvePoint[];\n    blue: CurvePoint[];\n  };\n  colorGrading: {\n    shadows: { h: number; s: number; l: number };\n    midtones: { h: number; s: number; l: number };\n    highlights: { h: number; s: number; l: number };\n    blending: number;\n    balance: number;\n    temperature: number;\n    tint: number;\n  };\n}\n\n// --- Spline Interpolation for Curves ---\n// Monotone Cubic Spline interpolation helps avoid overshooting\nexport const calculateSpline = (points: CurvePoint[]): number[] => {\n  // Sort points by X\n  const sorted = [...points].sort((a, b) => a.x - b.x);\n  // Ensure 0 and 255 exist\n  if (sorted[0].x > 0) sorted.unshift({ x: 0, y: sorted[0].y });\n  if (sorted[sorted.length - 1].x < 255) sorted.push({ x: 255, y: sorted[sorted.length - 1].y });\n\n  const xs = sorted.map((p) => p.x);\n  const ys = sorted.map((p) => p.y);\n  const n = xs.length;\n\n  // Calculate secants and tangents\n  const dys: number[] = [];\n  const dxs: number[] = [];\n  const ms: number[] = [];\n  for (let i = 0; i < n - 1; i++) {\n    const dx = xs[i + 1] - xs[i];\n    const dy = ys[i + 1] - ys[i];\n    dxs.push(dx);\n    dys.push(dy);\n    ms.push(dy / dx);\n  }\n\n  const c1s: number[] = [ms[0]];\n  for (let i = 0; i < n - 2; i++) {\n    const m = ms[i];\n    const mNext = ms[i + 1];\n    if (m * mNext <= 0) {\n      c1s.push(0);\n    } else {\n      const dx = dxs[i];\n      const dxNext = dxs[i + 1];\n      const common = dx + dxNext;\n      c1s.push((3 * common) / ((common + dxNext) / m + (common + dx) / mNext));\n    }\n  }\n  c1s.push(ms[ms.length - 1]);\n\n  // Generate LUT\n  const lut: number[] = new Array(256).fill(0);\n  // Loop through segments\n  for (let i = 0; i < n - 1; i++) {\n    const xStart = xs[i];\n    const xEnd = xs[i + 1];\n    const yStart = ys[i];\n    const yEnd = ys[i + 1];\n    const m1 = c1s[i];\n    const m2 = c1s[i + 1];\n    const dx = xEnd - xStart;\n\n    /*\n         Hermite basis:\n         h00 = 2t^3 - 3t^2 + 1\n         h10 = t^3 - 2t^2 + t\n         h01 = -2t^3 + 3t^2\n         h11 = t^3 - t^2\n        */\n\n    for (let x = xStart; x <= xEnd; x++) {\n      if (x >= 256) break;\n      const t = (x - xStart) / dx;\n      const t2 = t * t;\n      const t3 = t2 * t;\n\n      const h00 = 2 * t3 - 3 * t2 + 1;\n      const h10 = t3 - 2 * t2 + t;\n      const h01 = -2 * t3 + 3 * t2;\n      const h11 = t3 - t2;\n\n      const y = h00 * yStart + h10 * dx * m1 + h01 * yEnd + h11 * dx * m2;\n      lut[Math.round(x)] = clamp(Math.round(y));\n    }\n  }\n  return lut;\n};\n\n// --- Pipeline ---\n\nexport const applyCameraRawPipeline = (imageData: ImageData, settings: CameraRawSettings) => {\n  const data = imageData.data;\n  const { hsl, curves, colorGrading } = settings;\n\n  // 1. Prepare Curve LUTs\n  // Optimize: only recalc if specific curve changed? For now, recalculate on apply (preview might need optimization)\n  const masterLut = calculateSpline(curves.master);\n  const redLut = calculateSpline(curves.red);\n  const greenLut = calculateSpline(curves.green);\n  const blueLut = calculateSpline(curves.blue);\n\n  // Color Grading adjustments preparation\n  // Convert grading HSL to RGB offsets or factors?\n  // A common way for color grading is to add color to shadows/highlights.\n  // Shadows: add color to low luma. Highlights: to high luma. Midtones: to mid pixels.\n  const shadowRgb = hslToRgb(\n    colorGrading.shadows.h / 360,\n    colorGrading.shadows.s,\n    colorGrading.shadows.l * 2,\n  ); // l*2 rough scaling\n  const midtoneRgb = hslToRgb(\n    colorGrading.midtones.h / 360,\n    colorGrading.midtones.s,\n    colorGrading.midtones.l * 2,\n  );\n  const highlightRgb = hslToRgb(\n    colorGrading.highlights.h / 360,\n    colorGrading.highlights.s,\n    colorGrading.highlights.l * 2,\n  );\n\n  // Pre-calculate grading factors to avoid per-pixel expensive math if possible,\n  // but Grading is dependent on pixel luma, so we do it per pixel.\n\n  for (let i = 0; i < data.length; i += 4) {\n    let r = data[i];\n    let g = data[i + 1];\n    let b = data[i + 2];\n\n    // --- 1. Curves ---\n    // Apply channel curves then master curve\n    r = redLut[r];\n    g = greenLut[g];\n    b = blueLut[b];\n\n    // Master affects all\n    r = masterLut[r];\n    g = masterLut[g];\n    b = masterLut[b];\n\n    // --- 2. HSL Adjustments (Selective Color) ---\n    // We reuse logic from ApplyHslAdjustments but localized variables to avoid function call overhead if possible\n    // But for maintainability, let's copy the inner logic structure or just call the logic inline.\n    // Inline is faster for loops.\n\n    let [h, s, l] = rgbToHsl(r, g, b);\n    let deg = (h * 360 + 360) % 360;\n\n    // Find color range\n    // Optimization: Pre-map ranges? ColorRanges is small array (8), linear scan is acceptable.\n    const entry = colorRanges.find(({ range }) => {\n      const [start, end] = range;\n      if (start <= end) return deg >= start && deg <= end;\n      return deg >= start || deg <= end;\n    });\n\n    if (entry) {\n      const adj = hsl[entry.name];\n      if (adj) {\n        const [startRaw, endRaw] = entry.range;\n        let start = startRaw;\n        let end = endRaw;\n        if (start > end) end += 360;\n\n        let degNorm = deg;\n        if (degNorm < start) degNorm += 360;\n\n        if (adj.h !== 0) {\n          let newDeg = degNorm + adj.h;\n          if (newDeg < start) newDeg = start;\n          if (newDeg > end) newDeg = end;\n          deg = ((newDeg % 360) + 360) % 360;\n          h = deg / 360;\n        }\n        if (adj.s !== 0) {\n          const satPercent = Math.abs(adj.s) <= 1 ? adj.s * 100 : adj.s;\n          s = clamp01(s * (1 + satPercent / 100));\n        }\n        if (adj.l !== 0) {\n          const lumPercent = Math.abs(adj.l) <= 1 ? adj.l * 100 : adj.l;\n          l = clamp01(l * (1 + lumPercent / 100));\n        }\n        // Convert back to RGB for next stage if needed, or keep in HSL?\n        // Grading is usually done on RGB or Luma, easier on RGB here.\n        [r, g, b] = hslToRgb(h, s, l);\n      } else {\n        [r, g, b] = hslToRgb(h, s, l); // Just convert back if no adjustment found? Or just skip?\n        // If no adjustment, [r,g,b] are consistent with h,s,l. If we adjusted h,s,l we updated r,g,b.\n        // Actually if we only calculated h,s,l and didn't change them, r,g,b are original.\n        // So we need to ensure r,g,b are updated if HSL changed.\n      }\n    }\n\n    // --- 3. Color Grading ---\n    // Calculate Luma (0..1)\n    const luma = 0.299 * (r / 255) + 0.587 * (g / 255) + 0.114 * (b / 255);\n\n    // Balance shifts the midpoint of tones (-1..1) -> center shift up to +/-0.25\n    const center = 0.5 + (colorGrading.balance || 0) * 0.25;\n    // Blending controls the softness (0..1)\n    const width = 0.5 + (colorGrading.blending ?? 0) * 0.5; // denom scale\n    const denom = Math.max(0.001, 0.5 * width);\n\n    // Compute per-zone factors with linear falloff centered on `center`.\n    let shadowFactor = clamp01((center - luma) / denom);\n    let highlightFactor = clamp01((luma - center) / denom);\n    let midtoneFactor = Math.max(0, 1 - Math.abs(luma - center) / denom);\n\n    // Simple additive color grading + luminance shift\n    const gradingIntensity = 2.0;\n\n    // Shadows\n    if (Math.abs(colorGrading.shadows.s) > 0 || Math.abs(colorGrading.shadows.l) > 0) {\n      const [sr, sg, sb] = hslToRgb(colorGrading.shadows.h / 360, colorGrading.shadows.s, 0.5);\n      const lShift = colorGrading.shadows.l || 0;\n      r += (sr - 128) * shadowFactor * gradingIntensity;\n      g += (sg - 128) * shadowFactor * gradingIntensity;\n      b += (sb - 128) * shadowFactor * gradingIntensity;\n      const lumAdd = lShift * 255 * shadowFactor;\n      r += lumAdd;\n      g += lumAdd;\n      b += lumAdd;\n    }\n\n    // Highlights\n    if (Math.abs(colorGrading.highlights.s) > 0 || Math.abs(colorGrading.highlights.l) > 0) {\n      const [hr, hg, hb] = hslToRgb(\n        colorGrading.highlights.h / 360,\n        colorGrading.highlights.s,\n        0.5,\n      );\n      const lShift = colorGrading.highlights.l || 0;\n      r += (hr - 128) * highlightFactor * gradingIntensity;\n      g += (hg - 128) * highlightFactor * gradingIntensity;\n      b += (hb - 128) * highlightFactor * gradingIntensity;\n      const lumAdd = lShift * 255 * highlightFactor;\n      r += lumAdd;\n      g += lumAdd;\n      b += lumAdd;\n    }\n\n    // Midtones\n    if (Math.abs(colorGrading.midtones.s) > 0 || Math.abs(colorGrading.midtones.l) > 0) {\n      const [mr, mg, mb] = hslToRgb(colorGrading.midtones.h / 360, colorGrading.midtones.s, 0.5);\n      const lShift = colorGrading.midtones.l || 0;\n      r += (mr - 128) * midtoneFactor * gradingIntensity;\n      g += (mg - 128) * midtoneFactor * gradingIntensity;\n      b += (mb - 128) * midtoneFactor * gradingIntensity;\n      const lumAdd = lShift * 255 * midtoneFactor;\n      r += lumAdd;\n      g += lumAdd;\n      b += lumAdd;\n    }\n\n    // --- 4. Temperature & Tint ---\n    // Temperature: warm (positive) -> more red, less blue\n    // Tint: green (positive) / magenta (negative)\n    const temp = colorGrading.temperature || 0; // -1..1\n    const tint = colorGrading.tint || 0; // -1..1\n    if (temp !== 0) {\n      const tempAmount = temp * 40; // tunable intensity\n      r += tempAmount;\n      b -= tempAmount;\n    }\n    if (tint !== 0) {\n      const tintAmount = tint * 30;\n      g += tintAmount;\n      // reduce red and blue slightly for magenta/green balance\n      r -= tintAmount * 0.35;\n      b -= tintAmount * 0.35;\n    }\n\n    data[i] = clamp(r);\n    data[i + 1] = clamp(g);\n    data[i + 2] = clamp(b);\n  }\n\n  return imageData;\n};\n","import { InputNumber, Slider, Space } from 'antd';\nimport React from 'react';\n\ntype CustomSliderProps = {\n  label: string;\n  value: number;\n  min: number;\n  max: number;\n  step?: number;\n  onChange: (v: number) => void;\n  onChangeComplete?: () => void;\n  gradient?: string; //  dynamic CSS gradient for track\n};\n\nexport const CustomSlider = ({\n  label,\n  value,\n  min,\n  max,\n  step = 1,\n  gradient,\n  onChange,\n  onChangeComplete,\n}: CustomSliderProps) => (\n  <div className=\"custom-slider-container\">\n    <div\n      style={{\n        width: '100%',\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n      }}\n    >\n      <span className=\"custom-label\" style={{ fontSize: 12 }}>\n        {label}\n      </span>\n      <InputNumber\n        min={min}\n        max={max}\n        step={step}\n        value={value}\n        onChange={(v) => onChange(Number(v))}\n        onBlur={() => onChangeComplete?.()}\n        className=\"custom-number\"\n        size=\"small\"\n        style={{ width: 50, fontSize: 12 }}\n      />\n    </div>\n\n    <Slider\n      min={min}\n      max={max}\n      step={step}\n      value={value}\n      onChange={onChange}\n      onChangeComplete={onChangeComplete}\n      className=\"custom-slider\"\n      style={\n        { '--custom-slider-gradient': gradient, margin: '6px 0 16px 0' } as React.CSSProperties\n      }\n      handleStyle={{ opacity: 1 }}\n    />\n  </div>\n);\n","import React, { useState } from 'react';\nimport { Tabs, Typography, Button } from 'antd';\nimport { colorRanges } from '../../utils/hslHelpers';\nimport { CustomSlider } from '../CustomSlider';\n\nconst { Text } = Typography;\n\ninterface HslPanelProps {\n  adjustments: Record<string, { h: number; s: number; l: number }>;\n  onChange: (adjustments: Record<string, { h: number; s: number; l: number }>) => void;\n  activeChannel?: string;\n  onActiveChannelChange?: (channel: string) => void;\n}\n\nconst colorSwatches = [\n  { name: 'red', color: '#ff4d4d' },\n  { name: 'orange', color: '#ffa500' },\n  { name: 'yellow', color: '#ffd700' },\n  { name: 'green', color: '#00c853' },\n  { name: 'aqua', color: '#00e5ff' },\n  { name: 'blue', color: '#2979ff' },\n  { name: 'purple', color: '#9c27b0' },\n  { name: 'magenta', color: '#ff00aa' },\n];\n\nconst getSliderGradient = (activeColor: string, type: 'h' | 's' | 'l') => {\n  const base = colorSwatches.find((c) => c.name === activeColor)?.color || '#ffffff';\n  const index = colorSwatches.findIndex((c) => c.name === activeColor);\n\n  // If not found, default to grayscale\n  if (index === -1) return '#555';\n\n  const current = colorSwatches[index].color;\n  const left = colorSwatches[index - 1]?.color || current;\n  const right = colorSwatches[index + 1]?.color || current;\n\n  switch (type) {\n    case 'h':\n      return `linear-gradient(90deg, ${left}, ${current}, ${right})`;\n    case 's':\n      return `linear-gradient(90deg, gray, ${base})`;\n    case 'l':\n      return `linear-gradient(90deg, black, ${base}, white)`;\n    default:\n      return '#555';\n  }\n};\n\nconst HslPanel: React.FC<HslPanelProps> = ({\n  adjustments,\n  onChange,\n  activeChannel: propActiveChannel,\n  onActiveChannelChange,\n}) => {\n  const [localActiveChannel, setLocalActiveChannel] = useState<string>('red');\n\n  const activeChannel = propActiveChannel !== undefined ? propActiveChannel : localActiveChannel;\n\n  const handleChannelChange = (channel: string) => {\n    if (onActiveChannelChange) {\n      onActiveChannelChange(channel);\n    } else {\n      setLocalActiveChannel(channel);\n    }\n  };\n\n  const currentAdj = adjustments[activeChannel] || { h: 0, s: 0, l: 0 };\n\n  const updateAdjustment = (field: 'h' | 's' | 'l', value: number) => {\n    onChange({\n      ...adjustments,\n      [activeChannel]: {\n        ...adjustments[activeChannel],\n        [field]: value,\n      },\n    });\n  };\n\n  return (\n    <div>\n      <Tabs\n        activeKey={activeChannel}\n        onChange={handleChannelChange}\n        type=\"card\"\n        size=\"small\"\n        items={colorRanges.map((range) => ({\n          label: (\n            <span\n              style={{\n                display: 'inline-block',\n                width: 12,\n                height: 12,\n                background: colorSwatches.find((c) => c.name === range.name)?.color || '#eee',\n                borderRadius: '50%',\n                marginRight: 4,\n              }}\n              title={range.name}\n            />\n          ),\n          key: range.name,\n        }))}\n        tabPosition=\"top\"\n        tabBarGutter={4}\n      />\n      <div style={{ marginTop: 16 }}>\n        <Typography.Title level={5} style={{ textTransform: 'capitalize' }}>\n          {activeChannel}\n        </Typography.Title>\n\n        <div style={{ marginBottom: 16 }}>\n          <CustomSlider\n            label={`Hue (${currentAdj.h})`}\n            min={-180}\n            max={180}\n            value={currentAdj.h}\n            onChange={(v) => updateAdjustment('h', v)}\n            gradient={getSliderGradient(activeChannel, 'h')}\n          />\n        </div>\n\n        <div style={{ marginBottom: 16 }}>\n          <CustomSlider\n            label={`Saturation (${Math.round(currentAdj.s * 100)}%)`}\n            min={-1}\n            max={1}\n            step={0.01}\n            value={currentAdj.s}\n            onChange={(v) => updateAdjustment('s', v)}\n            gradient={getSliderGradient(activeChannel, 's')}\n          />\n        </div>\n\n        <div style={{ marginBottom: 16 }}>\n          <CustomSlider\n            label={`Luminance (${Math.round(currentAdj.l * 100)}%)`}\n            min={-1}\n            max={1}\n            step={0.01}\n            value={currentAdj.l}\n            onChange={(v) => updateAdjustment('l', v)}\n            gradient={getSliderGradient(activeChannel, 'l')}\n          />\n        </div>\n\n        <Button\n          onClick={() => {\n            onChange({\n              ...adjustments,\n              [activeChannel]: { h: 0, s: 0, l: 0 },\n            });\n          }}\n          size=\"small\"\n        >\n          Reset {activeChannel}\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nexport default HslPanel;\n","import React, { useRef, useEffect, useState } from 'react';\nimport { Button, Select, Space } from 'antd';\nimport { CameraRawSettings, CurvePoint, calculateSpline } from '../../utils/cameraRawHelpers';\n\ninterface CurvesPanelProps {\n  curves: CameraRawSettings['curves'];\n  onChange: (curves: CameraRawSettings['curves']) => void;\n}\n\nconst CHANNEL_COLORS: Record<string, string> = {\n  master: '#ffffff', // black/white curve usually white line on dark bg\n  red: '#ff4d4f',\n  green: '#52c41a',\n  blue: '#1890ff',\n};\n\nconst CurvesPanel: React.FC<CurvesPanelProps> = ({ curves, onChange }) => {\n  const [activeChannel, setActiveChannel] = useState<'master' | 'red' | 'green' | 'blue'>('master');\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [dragIndex, setDragIndex] = useState<number | null>(null);\n\n  const points = curves[activeChannel];\n\n  // Draw function\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    const width = canvas.width;\n    const height = canvas.height;\n\n    // Clear\n    ctx.fillStyle = '#262626'; // Dark background\n    ctx.fillRect(0, 0, width, height);\n\n    // Draw grid\n    ctx.strokeStyle = '#434343';\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    for (let i = 1; i < 4; i++) {\n      const pos = i * (width / 4);\n      ctx.moveTo(pos, 0);\n      ctx.lineTo(pos, height);\n      ctx.moveTo(0, pos);\n      ctx.lineTo(width, pos);\n    }\n    ctx.stroke();\n\n    // Calculate Curve LUT for visualization\n    const lut = calculateSpline(points);\n\n    // Draw Curve\n    ctx.strokeStyle = CHANNEL_COLORS[activeChannel];\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    for (let x = 0; x < 256; x++) {\n      const y = lut[x];\n      // Canvas Y is inverted (0 at top, 255 at bottom in image coords but usually curves are 0,0 bottom-left)\n      // Let's standard: Input X (0..255 left-right), Output Y (0..255 bottom-top)\n      // so canvas y = height - (y / 255 * height)\n      const cx = (x / 255) * width;\n      const cy = height - (y / 255) * height;\n      if (x === 0) ctx.moveTo(cx, cy);\n      else ctx.lineTo(cx, cy);\n    }\n    ctx.stroke();\n\n    // Draw Points\n    points.forEach((p, i) => {\n      const cx = (p.x / 255) * width;\n      const cy = height - (p.y / 255) * height;\n\n      ctx.fillStyle = i === dragIndex ? '#fff' : '#aaa';\n      ctx.beginPath();\n      ctx.arc(cx, cy, 4, 0, Math.PI * 2);\n      ctx.fill();\n    });\n  }, [points, activeChannel, dragIndex]);\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const rect = canvas.getBoundingClientRect();\n    const x = ((e.clientX - rect.left) / rect.width) * 255;\n    const y = (1 - (e.clientY - rect.top) / rect.height) * 255;\n\n    // Find integer coordinates\n    const cx = Math.round(x);\n    const cy = Math.round(y);\n\n    // Check if clicked on existing point\n    const threshold = 10; // visual distance units\n    const idx = points.findIndex(\n      (p) => Math.abs(p.x - cx) < threshold && Math.abs(p.y - cy) < threshold,\n    );\n\n    if (idx !== -1) {\n      setDragIndex(idx);\n    } else {\n      // Add new point\n      const newPoint = { x: cx, y: cy };\n      const newPoints = [...points, newPoint].sort((a, b) => a.x - b.x);\n      onChange({ ...curves, [activeChannel]: newPoints });\n      // Find the index of the newly added point to drag it immediately\n      const newIdx = newPoints.indexOf(newPoint); // object ref might fail due to copy? no, straightforward here but sort changes order\n      // Simpler: just set drag index to the new point's location in sorted array\n      // Since we might sort, finding by value is safer perfectly, or just wait for next render?\n      // For smoothness, let's just trigger updates.\n    }\n  };\n\n  const handleMouseMove = (e: React.MouseEvent) => {\n    if (dragIndex === null) return;\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const rect = canvas.getBoundingClientRect();\n    // Clamp to 0..255\n    let x = ((e.clientX - rect.left) / rect.width) * 255;\n    let y = (1 - (e.clientY - rect.top) / rect.height) * 255;\n\n    x = Math.max(0, Math.min(255, x));\n    y = Math.max(0, Math.min(255, y));\n\n    const newPoints = [...points];\n\n    // Constraints: Point cannot cross neighbors in X\n    // Start (0) and End (last) usually have fixed X (0 and 255)?\n    // User can move start Y and end Y, but X remains 0/255 for coverage.\n    // But standard curves allow moving endpoints too? Usually start is fixed at x=0, end x=255.\n    // Let's enforce first point x=0, last point x=255.\n\n    const isFirst = dragIndex === 0;\n    const isLast = dragIndex === points.length - 1;\n\n    if (isFirst) x = 0;\n    if (isLast) x = 255;\n\n    if (!isFirst && !isLast) {\n      // Prevent crossing neighbors X\n      const prevX = newPoints[dragIndex - 1].x;\n      const nextX = newPoints[dragIndex + 1].x;\n      // Add some buffer\n      x = Math.max(prevX + 1, Math.min(nextX - 1, x));\n    }\n\n    newPoints[dragIndex] = { x: Math.round(x), y: Math.round(y) };\n    onChange({ ...curves, [activeChannel]: newPoints });\n  };\n\n  const handleMouseUp = () => {\n    setDragIndex(null);\n  };\n\n  const handleDoubleClick = (e: React.MouseEvent) => {\n    // Remove point if clicked\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const rect = canvas.getBoundingClientRect();\n    const x = ((e.clientX - rect.left) / rect.width) * 255;\n    const y = (1 - (e.clientY - rect.top) / rect.height) * 255;\n\n    const threshold = 10;\n    const idx = points.findIndex(\n      (p) => Math.abs(p.x - x) < threshold && Math.abs(p.y - y) < threshold,\n    );\n\n    // Don't remove first or last\n    if (idx > 0 && idx < points.length - 1) {\n      const newPoints = points.filter((_, i) => i !== idx);\n      onChange({ ...curves, [activeChannel]: newPoints });\n    }\n  };\n\n  return (\n    <div>\n      <Space style={{ marginBottom: 16 }}>\n        <Select\n          value={activeChannel}\n          onChange={setActiveChannel}\n          options={[\n            { label: 'RGB (Master)', value: 'master' },\n            { label: 'Red', value: 'red' },\n            { label: 'Green', value: 'green' },\n            { label: 'Blue', value: 'blue' },\n          ]}\n          style={{ width: 120 }}\n        />\n        <Button\n          onClick={() =>\n            onChange({\n              ...curves,\n              [activeChannel]: [\n                { x: 0, y: 0 },\n                { x: 255, y: 255 },\n              ],\n            })\n          }\n        >\n          Reset Channel\n        </Button>\n      </Space>\n\n      <div\n        className=\"curves-canvas-container\"\n        style={{ cursor: dragIndex !== null ? 'grabbing' : 'crosshair' }}\n      >\n        <canvas\n          ref={canvasRef}\n          width={256}\n          height={256}\n          style={{ width: '100%', maxWidth: 256, background: '#222', borderRadius: 4 }}\n          onMouseDown={handleMouseDown}\n          onMouseMove={handleMouseMove}\n          onMouseUp={handleMouseUp}\n          onMouseLeave={handleMouseUp}\n          onDoubleClick={handleDoubleClick}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default CurvesPanel;\n","import React from 'react';\nimport { Typography, Collapse, Button } from 'antd';\nimport { CustomSlider } from '../CustomSlider';\nimport { CameraRawSettings } from '../../utils/cameraRawHelpers';\n\nconst { Panel } = Collapse;\nconst { Text } = Typography;\n\ninterface ColorGradingPanelProps {\n  settings: CameraRawSettings['colorGrading'];\n  onChange: (settings: CameraRawSettings['colorGrading']) => void;\n}\n\nconst ColorGradingPanel: React.FC<ColorGradingPanelProps> = ({ settings, onChange }) => {\n  const updateZone = (\n    zone: 'shadows' | 'midtones' | 'highlights',\n    field: 'h' | 's' | 'l',\n    value: number,\n  ) => {\n    onChange({\n      ...settings,\n      [zone]: {\n        ...settings[zone],\n        [field]: value,\n      },\n    });\n  };\n\n  const updateGlobal = (field: 'blending' | 'balance' | 'temperature' | 'tint', value: number) => {\n    onChange({\n      ...settings,\n      [field]: value,\n    } as any);\n  };\n\n  const getRainbowGradient = () =>\n    'linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%)';\n  const getSaturationGradient = (hue: number) =>\n    `linear-gradient(to right, #888, hsl(${hue}, 100%, 50%))`;\n\n  return (\n    <div>\n      <Collapse defaultActiveKey={['shadows', 'midtones', 'highlights']} ghost>\n        <Panel header=\"Shadows\" key=\"shadows\">\n          <CustomSlider\n            label={`Hue (${Math.round(settings.shadows.h)})`}\n            min={0}\n            max={360}\n            value={settings.shadows.h}\n            onChange={(v) => updateZone('shadows', 'h', v)}\n            gradient={getRainbowGradient()}\n          />\n          <CustomSlider\n            label={`Saturation (${Math.round(settings.shadows.s * 100)}%)`}\n            min={0}\n            max={1}\n            step={0.01}\n            value={settings.shadows.s}\n            onChange={(v) => updateZone('shadows', 's', v)}\n            gradient={getSaturationGradient(settings.shadows.h)}\n          />\n          <CustomSlider\n            label={`Luminance (${Math.round(settings.shadows.l * 100)}%)`}\n            min={-1}\n            max={1}\n            step={0.01}\n            value={settings.shadows.l}\n            onChange={(v) => updateZone('shadows', 'l', v)}\n            gradient={`linear-gradient(to right, #000, #888, #fff)`}\n          />\n          {/* Luminance for grading? usually grading is just Tint, but some tools allow Luma shift too. Kept simple for now (Tint). */}\n        </Panel>\n\n        <Panel header=\"Midtones\" key=\"midtones\">\n          <CustomSlider\n            label={`Hue (${Math.round(settings.midtones.h)})`}\n            min={0}\n            max={360}\n            value={settings.midtones.h}\n            onChange={(v) => updateZone('midtones', 'h', v)}\n            gradient={getRainbowGradient()}\n          />\n          <CustomSlider\n            label={`Saturation (${Math.round(settings.midtones.s * 100)}%)`}\n            min={0}\n            max={1}\n            step={0.01}\n            value={settings.midtones.s}\n            onChange={(v) => updateZone('midtones', 's', v)}\n            gradient={getSaturationGradient(settings.midtones.h)}\n          />\n          <CustomSlider\n            label={`Luminance (${Math.round(settings.midtones.l * 100)}%)`}\n            min={-1}\n            max={1}\n            step={0.01}\n            value={settings.midtones.l}\n            onChange={(v) => updateZone('midtones', 'l', v)}\n            gradient={`linear-gradient(to right, #000, #888, #fff)`}\n          />\n        </Panel>\n\n        <Panel header=\"Highlights\" key=\"highlights\">\n          <CustomSlider\n            label={`Hue (${Math.round(settings.highlights.h)})`}\n            min={0}\n            max={360}\n            value={settings.highlights.h}\n            onChange={(v) => updateZone('highlights', 'h', v)}\n            gradient={getRainbowGradient()}\n          />\n          <CustomSlider\n            label={`Saturation (${Math.round(settings.highlights.s * 100)}%)`}\n            min={0}\n            max={1}\n            step={0.01}\n            value={settings.highlights.s}\n            onChange={(v) => updateZone('highlights', 's', v)}\n            gradient={getSaturationGradient(settings.highlights.h)}\n          />\n          <CustomSlider\n            label={`Luminance (${Math.round(settings.highlights.l * 100)}%)`}\n            min={-1}\n            max={1}\n            step={0.01}\n            value={settings.highlights.l}\n            onChange={(v) => updateZone('highlights', 'l', v)}\n            gradient={`linear-gradient(to right, #000, #888, #fff)`}\n          />\n        </Panel>\n      </Collapse>\n\n      <div style={{ marginTop: 12 }}>\n        <CustomSlider\n          label={`Blending (${Math.round(settings.blending * 100)}%)`}\n          min={0}\n          max={1}\n          step={0.01}\n          value={settings.blending}\n          onChange={(v) => updateGlobal('blending', v)}\n          gradient={`linear-gradient(to right, #444, #888, #ccc)`}\n        />\n        <CustomSlider\n          label={`Balance (${Math.round(settings.balance * 100)}%)`}\n          min={-1}\n          max={1}\n          step={0.01}\n          value={settings.balance}\n          onChange={(v) => updateGlobal('balance', v)}\n          gradient={`linear-gradient(to right, #f00, #888, #00f)`}\n        />\n        <CustomSlider\n          label={`Temperature (${Math.round(settings.temperature * 100)}%)`}\n          min={-1}\n          max={1}\n          step={0.01}\n          value={settings.temperature}\n          onChange={(v) => updateGlobal('temperature', v)}\n          gradient={`linear-gradient(to right, #001f3f, #888, #ffdd99)`}\n        />\n        <CustomSlider\n          label={`Tint (${Math.round(settings.tint * 100)}%)`}\n          min={-1}\n          max={1}\n          step={0.01}\n          value={settings.tint}\n          onChange={(v) => updateGlobal('tint', v)}\n          gradient={`linear-gradient(to right, #ff88ff, #888, #88ff88)`}\n        />\n      </div>\n\n      {/* \n      <div style={{ marginTop: 16 }}>\n          <Text strong>Blending / Balance (Not Implemented)</Text>\n           // These require more complex shader/pixel math, keeping it simple additive for now.\n      </div> \n      */}\n\n      <Button\n        onClick={() =>\n          onChange({\n            shadows: { h: 0, s: 0, l: 0 },\n            midtones: { h: 0, s: 0, l: 0 },\n            highlights: { h: 0, s: 0, l: 0 },\n            blending: 0.5,\n            balance: 0,\n            temperature: 0,\n            tint: 0,\n          })\n        }\n        style={{ marginTop: 16 }}\n      >\n        Reset Grading\n      </Button>\n    </div>\n  );\n};\n\nexport default ColorGradingPanel;\n","import React, { RefObject, useMemo } from 'react';\nimport Highcharts from 'highcharts';\nimport HighchartsReact from 'highcharts-react-official';\n\ntype RGBHistogramProps = {\n  canvasRef: RefObject<HTMLCanvasElement>;\n  redData: number[];\n  greenData: number[];\n  blueData: number[];\n};\n\nconst RGBHistogram: React.FC<RGBHistogramProps> = ({ canvasRef, redData, greenData, blueData }) => {\n  const options = useMemo(() => {\n    return {\n      chart: {\n        backgroundColor: '#2b2b2b',\n        height: 120,\n        spacing: [5, 5, 5, 5],\n      },\n      title: { text: '' },\n      xAxis: {\n        title: { text: '', style: { color: '#fff' } },\n\n        labels: { style: { color: '#fff', fontSize: '5px' } },\n        gridLineColor: 'rgba(255,255,255,0.1)',\n      },\n      yAxis: {\n        title: { text: '', style: { color: '#fff' } },\n        labels: { style: { color: '#fff', fontSize: '5px' } },\n        gridLineColor: 'rgba(255,255,255,0.1)',\n      },\n      legend: { enabled: false },\n      plotOptions: {\n        histogram: { binWidth: 4 },\n        series: { animation: false, marker: { enabled: false } },\n      },\n      series: [\n        {\n          name: 'Red',\n          data: redData,\n          color: '#ff4444',\n          zIndex: 3,\n          lineWidth: 1,\n          marker: {\n            radius: 1,\n          },\n        },\n        {\n          name: 'Green',\n          data: greenData,\n          color: '#44ff44',\n          zIndex: 2,\n          lineWidth: 1,\n          marker: {\n            radius: 1,\n          },\n        },\n        {\n          name: 'Blue',\n          data: blueData,\n          color: '#4444ff',\n          zIndex: 1,\n          lineWidth: 1,\n          marker: {\n            radius: 1,\n          },\n        },\n      ],\n      credits: { enabled: false },\n      tooltip: { enabled: false },\n    };\n  }, [redData, greenData, blueData]);\n\n  return <HighchartsReact highcharts={Highcharts} options={options} />;\n};\n\nexport default RGBHistogram;\n","import React, { useEffect, useRef, useState, useMemo } from 'react';\nimport { Modal, Tabs, Row, Col, Typography, Button, Spin, Tooltip } from 'antd';\nimport { EyeOutlined, EyeInvisibleOutlined, AimOutlined } from '@ant-design/icons';\nimport { CameraRawSettings, applyCameraRawPipeline } from '../../utils/cameraRawHelpers';\nimport HslPanel from './HslPanel';\nimport CurvesPanel from './CurvesPanel';\nimport ColorGradingPanel from './ColorGradingPanel';\nimport { colorRanges, rgbToHsl, getColorNameFromHue } from '../../utils/hslHelpers';\nimport RGBHistogram from './RGBHistogram';\n\nconst { Text } = Typography;\n\ninterface CameraRawModalProps {\n  visible: boolean;\n  onCancel: () => void;\n  onApply: (processedCanvas: HTMLCanvasElement) => void;\n  sourceCanvas: HTMLCanvasElement | null;\n}\n\nconst CameraRawModal: React.FC<CameraRawModalProps> = ({\n  visible,\n  onCancel,\n  onApply,\n  sourceCanvas,\n}) => {\n  const [loading, setLoading] = useState(false);\n  const previewCanvasRef = useRef<HTMLCanvasElement>(null);\n  const [showBefore, setShowBefore] = useState(false);\n  const [redData, setRedData] = useState<number[]>(new Array(256).fill(0));\n  const [greenData, setGreenData] = useState<number[]>(new Array(256).fill(0));\n  const [blueData, setBlueData] = useState<number[]>(new Array(256).fill(0));\n\n  const initialSettings: CameraRawSettings = useMemo(() => {\n    const hsl: any = {};\n    colorRanges.forEach((c) => (hsl[c.name] = { h: 0, s: 0, l: 0 }));\n\n    return {\n      hsl,\n      curves: {\n        master: [\n          { x: 0, y: 0 },\n          { x: 255, y: 255 },\n        ],\n        red: [\n          { x: 0, y: 0 },\n          { x: 255, y: 255 },\n        ],\n        green: [\n          { x: 0, y: 0 },\n          { x: 255, y: 255 },\n        ],\n        blue: [\n          { x: 0, y: 0 },\n          { x: 255, y: 255 },\n        ],\n      },\n      colorGrading: {\n        shadows: { h: 0, s: 0, l: 0 },\n        midtones: { h: 0, s: 0, l: 0 },\n        highlights: { h: 0, s: 0, l: 0 },\n        blending: 0.5,\n        balance: 0,\n        temperature: 0,\n        tint: 0,\n      },\n    };\n  }, []);\n\n  const [settings, setSettings] = useState<CameraRawSettings>(initialSettings);\n\n  // Color Picker State\n  const [isPicking, setIsPicking] = useState(false);\n  const [activeHslChannel, setActiveHslChannel] = useState<string>('red');\n  const [activeTab, setActiveTab] = useState('hsl');\n  const [pickerPos, setPickerPos] = useState<{ x: number; y: number } | null>(null);\n  const [sampledColor, setSampledColor] = useState<{ h: number; s: number; l: number } | null>(\n    null,\n  );\n\n  // Reset when opened\n  useEffect(() => {\n    if (visible) {\n      setSettings(initialSettings);\n    }\n  }, [visible, initialSettings]);\n\n  // Preview Logic\n  useEffect(() => {\n    if (!visible || !sourceCanvas || !previewCanvasRef.current) return;\n\n    const canvas = previewCanvasRef.current;\n\n    // Use a timeout to debounce heavy processing\n    const timer = setTimeout(() => {\n      const MAX_PREVIEW_SIZE = 600;\n      let previewWidth = sourceCanvas.width;\n      let previewHeight = sourceCanvas.height;\n\n      if (sourceCanvas.width > MAX_PREVIEW_SIZE || sourceCanvas.height > MAX_PREVIEW_SIZE) {\n        const ratio = Math.min(\n          MAX_PREVIEW_SIZE / sourceCanvas.width,\n          MAX_PREVIEW_SIZE / sourceCanvas.height,\n        );\n        previewWidth = Math.floor(sourceCanvas.width * ratio);\n        previewHeight = Math.floor(sourceCanvas.height * ratio);\n      }\n\n      canvas.width = previewWidth;\n      canvas.height = previewHeight;\n\n      const ctx = canvas.getContext('2d');\n      if (!ctx) return;\n\n      // Draw source to preview\n      ctx.drawImage(sourceCanvas, 0, 0, previewWidth, previewHeight);\n\n      // Get image data\n      const imageData = ctx.getImageData(0, 0, previewWidth, previewHeight);\n\n      // If showing 'before', skip processing and show original\n      if (showBefore) {\n        // Compute hist from original\n        const rHist = new Array(256).fill(0);\n        const gHist = new Array(256).fill(0);\n        const bHist = new Array(256).fill(0);\n        const d = imageData.data;\n        for (let i = 0; i < d.length; i += 4) {\n          rHist[d[i]] += 1;\n          gHist[d[i + 1]] += 1;\n          bHist[d[i + 2]] += 1;\n        }\n        setRedData(rHist);\n        setGreenData(gHist);\n        setBlueData(bHist);\n\n        // original already on canvas; nothing else to do\n      } else {\n        // Apply Pipeline\n        applyCameraRawPipeline(imageData, settings);\n\n        // Compute simple 256-bin RGB histograms from processed image\n        const rHist = new Array(256).fill(0);\n        const gHist = new Array(256).fill(0);\n        const bHist = new Array(256).fill(0);\n        const d = imageData.data;\n        for (let i = 0; i < d.length; i += 4) {\n          rHist[d[i]] += 1;\n          gHist[d[i + 1]] += 1;\n          bHist[d[i + 2]] += 1;\n        }\n        setRedData(rHist);\n        setGreenData(gHist);\n        setBlueData(bHist);\n\n        // Put processed data back\n        ctx.putImageData(imageData, 0, 0);\n      }\n    }, 50);\n\n    return () => clearTimeout(timer);\n  }, [visible, sourceCanvas, settings, showBefore]);\n\n  const handleApply = async () => {\n    if (!sourceCanvas) return;\n    setLoading(true);\n\n    setTimeout(() => {\n      const tempCanvas = document.createElement('canvas');\n      tempCanvas.width = sourceCanvas.width;\n      tempCanvas.height = sourceCanvas.height;\n      const ctx = tempCanvas.getContext('2d');\n      if (!ctx) {\n        setLoading(false);\n        return;\n      }\n\n      ctx.drawImage(sourceCanvas, 0, 0);\n      const imageData = ctx.getImageData(0, 0, sourceCanvas.width, sourceCanvas.height);\n\n      applyCameraRawPipeline(imageData, settings);\n      ctx.putImageData(imageData, 0, 0);\n\n      onApply(tempCanvas);\n      setLoading(false);\n    }, 100);\n  };\n\n  const handleCanvasClick = (\n    e: React.MouseEvent<HTMLCanvasElement> | React.TouchEvent<HTMLCanvasElement>,\n  ) => {\n    // Enable picking if isPicking mode is on OR Alt key is pressed\n    const isAlt = (e as React.MouseEvent).altKey;\n    if ((!isPicking && !isAlt) || !previewCanvasRef.current) return;\n\n    const canvas = previewCanvasRef.current;\n    const rect = canvas.getBoundingClientRect();\n    let clientX, clientY;\n\n    if ('touches' in e) {\n      clientX = e.touches[0].clientX;\n      clientY = e.touches[0].clientY;\n    } else {\n      clientX = (e as React.MouseEvent).clientX;\n      clientY = (e as React.MouseEvent).clientY;\n    }\n\n    const x = clientX - rect.left;\n    const y = clientY - rect.top;\n\n    const scaleX = canvas.width / rect.width;\n    const scaleY = canvas.height / rect.height;\n    const canvasX = Math.floor(x * scaleX);\n    const canvasY = Math.floor(y * scaleY);\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    const size = 3;\n    const imageData = ctx.getImageData(\n      Math.max(0, canvasX - 1),\n      Math.max(0, canvasY - 1),\n      size,\n      size,\n    );\n    const data = imageData.data;\n    if (data.length === 0) return;\n\n    let r = 0,\n      g = 0,\n      b = 0;\n    const count = data.length / 4;\n    for (let i = 0; i < data.length; i += 4) {\n      r += data[i];\n      g += data[i + 1];\n      b += data[i + 2];\n    }\n    r = Math.round(r / count);\n    g = Math.round(g / count);\n    b = Math.round(b / count);\n\n    const [h, s, l] = rgbToHsl(r, g, b);\n    const hueDeg = h * 360;\n\n    const channel = getColorNameFromHue(hueDeg);\n\n    setActiveHslChannel(channel);\n    setActiveTab('hsl');\n    setSampledColor({ h: hueDeg, s, l });\n    setPickerPos({ x, y });\n  };\n\n  const tabsItems = [\n    {\n      key: 'hsl',\n      label: 'HSL Mixer',\n      children: (\n        <HslPanel\n          adjustments={settings.hsl}\n          onChange={(hsl) => setSettings({ ...settings, hsl })}\n          activeChannel={activeHslChannel}\n          onActiveChannelChange={setActiveHslChannel}\n        />\n      ),\n    },\n    {\n      key: 'curves',\n      label: 'Curves',\n      children: (\n        <CurvesPanel\n          curves={settings.curves}\n          onChange={(curves) => setSettings({ ...settings, curves })}\n        />\n      ),\n    },\n    {\n      key: 'grading',\n      label: 'Color Grading',\n      children: (\n        <ColorGradingPanel\n          settings={settings.colorGrading}\n          onChange={(colorGrading) => setSettings({ ...settings, colorGrading })}\n        />\n      ),\n    },\n  ];\n\n  return (\n    <Modal\n      title=\"Camera Raw Filter\"\n      open={visible}\n      onCancel={onCancel}\n      width={1200}\n      onOk={handleApply}\n      confirmLoading={loading}\n      okText=\"Apply\"\n      style={{ top: 20 }}\n    >\n      <Row gutter={24}>\n        <Col\n          span={16}\n          style={{\n            textAlign: 'center',\n            background: '#f0f0f0',\n            padding: 16,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            minHeight: 400,\n            flexDirection: 'column',\n          }}\n        >\n          <div\n            style={{\n              width: '100%',\n              display: 'flex',\n              justifyContent: 'center',\n              position: 'relative',\n            }}\n          >\n            <div\n              style={{\n                position: 'absolute',\n                right: 12,\n                top: 12,\n                zIndex: 3,\n                display: 'flex',\n                gap: 8,\n              }}\n            >\n              <Tooltip title=\"Pick color to select HSL channel\">\n                <Button\n                  size=\"small\"\n                  type={isPicking ? 'primary' : 'default'}\n                  icon={<AimOutlined />}\n                  onClick={() => {\n                    setIsPicking(!isPicking);\n                    setPickerPos(null);\n                  }}\n                />\n              </Tooltip>\n              <Button\n                size=\"small\"\n                icon={showBefore ? <EyeInvisibleOutlined /> : <EyeOutlined />}\n                onClick={() => setShowBefore((s) => !s)}\n              />\n            </div>\n            <div style={{ position: 'relative', display: 'inline-block' }}>\n              <canvas\n                ref={previewCanvasRef}\n                onClick={handleCanvasClick}\n                onTouchStart={handleCanvasClick}\n                style={{\n                  maxWidth: '100%',\n                  maxHeight: '550px',\n                  border: '1px solid #ccc',\n                  boxShadow: '0 4px 12px rgba(0,0,0,0.1)',\n                  cursor: isPicking ? 'crosshair' : 'default',\n                  display: 'block',\n                }}\n              />\n              {isPicking && pickerPos && sampledColor && (\n                <div\n                  style={{\n                    position: 'absolute',\n                    left: pickerPos.x,\n                    top: pickerPos.y,\n                    transform: 'translate(-50%, -50%)',\n                    pointerEvents: 'none',\n                    zIndex: 10,\n                  }}\n                >\n                  <div\n                    style={{\n                      width: 20,\n                      height: 20,\n                      border: '2px solid white',\n                      borderRadius: '50%',\n                      boxShadow: '0 0 2px black',\n                    }}\n                  />\n                  <div\n                    style={{\n                      position: 'absolute',\n                      top: 24,\n                      left: 0,\n                      background: 'rgba(0,0,0,0.8)',\n                      color: '#fff',\n                      padding: '2px 6px',\n                      borderRadius: 4,\n                      fontSize: 10,\n                      whiteSpace: 'nowrap',\n                    }}\n                  >\n                    H:{Math.round(sampledColor.h)} S:{Math.round(sampledColor.s * 100)} L:\n                    {Math.round(sampledColor.l * 100)}\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        </Col>\n        <Col span={8}>\n          <div style={{ width: '100%' }}>\n            <RGBHistogram\n              canvasRef={previewCanvasRef}\n              redData={redData}\n              greenData={greenData}\n              blueData={blueData}\n            />\n          </div>\n\n          <div style={{ marginTop: 12, marginBottom: 16, padding: '0 8px' }}>\n            <Row gutter={[12, 8]}>\n              <Col span={12}>\n                <Text type=\"secondary\" style={{ fontSize: 12, display: 'block' }}>\n                  Resolution\n                </Text>\n                <Text style={{ fontSize: 13 }}>\n                  {sourceCanvas ? `${sourceCanvas.width}  ${sourceCanvas.height}` : 'N/A'}\n                </Text>\n              </Col>\n              <Col span={6}>\n                <Text type=\"secondary\" style={{ fontSize: 12, display: 'block' }}>\n                  ISO\n                </Text>\n                <Text style={{ fontSize: 13 }}>--</Text>\n              </Col>\n              <Col span={6}>\n                <Text type=\"secondary\" style={{ fontSize: 12, display: 'block' }}>\n                  Exp\n                </Text>\n                <Text style={{ fontSize: 13 }}>--</Text>\n              </Col>\n            </Row>\n          </div>\n\n          <Tabs activeKey={activeTab} onChange={setActiveTab} items={tabsItems} />\n        </Col>\n      </Row>\n    </Modal>\n  );\n};\n\nexport default CameraRawModal;\n","import React, { useEffect, useState, useRef } from 'react';\nimport { Button, Tooltip, Space, Divider, Dropdown, Menu } from 'antd';\nimport {\n  DragOutlined,\n  BorderOutlined,\n  PlusCircleOutlined,\n  FontSizeOutlined,\n  FileImageOutlined,\n  DeleteOutlined,\n  UndoOutlined,\n  RedoOutlined,\n  HighlightOutlined,\n  ExportOutlined,\n  ScissorOutlined,\n  BgColorsOutlined,\n  CopyOutlined,\n  SnippetsOutlined,\n  SaveOutlined,\n  FolderOpenOutlined,\n  MoreOutlined,\n  AppstoreAddOutlined,\n  UploadOutlined,\n  ColumnWidthOutlined,\n  BorderOuterOutlined,\n} from '@ant-design/icons';\nimport {\n  Rect,\n  Circle,\n  Triangle,\n  Polygon,\n  IText,\n  FabricImage,\n  ActiveSelection,\n  Point,\n} from 'fabric';\nimport { usePhotoEditor } from '../context';\nimport ExportModal from './ExportModal';\nimport LayerMaskModal from './LayerMaskModal';\nimport ProjectModal from './ProjectModal';\nimport CropModal from './CropModal';\nimport BlurBrushModal from './BlurBrush/BlurBrushModal';\nimport { useProjects } from '../hooks/useProjects';\nimport { applyMaskToFabricObject } from '../utils/effectsHelpers';\nimport IconFont from '@/components/IconFont';\nimport CameraRawModal from './CameraRaw/CameraRawModal';\n\nconst Toolbar: React.FC = () => {\n  const { canvas, setActiveTool, activeTool, history, selectedObject, clipboard, setClipboard } =\n    usePhotoEditor();\n  const prevToolRef = useRef<string | null>(null);\n  const spacePressedRef = useRef(false);\n  const [exportModalVisible, setExportModalVisible] = useState(false);\n  const [maskModalVisible, setMaskModalVisible] = useState(false);\n  const [cameraRawVisible, setCameraRawVisible] = useState(false);\n  const [projectModalVisible, setProjectModalVisible] = useState(false);\n  const [cropModalVisible, setCropModalVisible] = useState(false);\n  const [blurBrushVisible, setBlurBrushVisible] = useState(false);\n\n  const {\n    savedProjects,\n    saveProject,\n    deleteProject,\n    loadProjects,\n    loadProjectIntoEditor,\n    clearCurrentProject,\n  } = useProjects();\n\n  const handleSaveProject = () => {\n    if (!canvas) return;\n    const json = canvas.toJSON();\n    const preview = canvas.toDataURL({ format: 'png', multiplier: 0.5 });\n    saveProject(preview, json);\n  };\n\n  const handleLoadProject = (project: any) => {\n    if (!canvas) return;\n    canvas.loadFromJSON(project.json).then(() => {\n      canvas.renderAll();\n      // mark the project as current so saving will overwrite\n      loadProjectIntoEditor(project);\n      setProjectModalVisible(false);\n      history.saveState();\n    });\n  };\n\n  const newProject = () => {\n    if (!canvas) return;\n    // clear canvas and reset state\n    canvas.discardActiveObject();\n    canvas.clear();\n    // ensure any background or options are reset if needed (left minimal)\n    history.saveState();\n    clearCurrentProject();\n  };\n\n  const copy = async () => {\n    if (!canvas) return;\n    const activeObject = canvas.getActiveObject();\n    if (activeObject) {\n      const cloned = await activeObject.clone();\n      setClipboard(cloned);\n    }\n  };\n\n  const paste = async () => {\n    if (!canvas || !clipboard) return;\n    const clonedObj = await clipboard.clone();\n    canvas.discardActiveObject();\n\n    clonedObj.set({\n      left: (clonedObj.left || 0) + 10,\n      top: (clonedObj.top || 0) + 10,\n      evented: true,\n    });\n\n    if (clonedObj instanceof ActiveSelection) {\n      // active selection needs a reference to the canvas.\n      clonedObj.canvas = canvas;\n      clonedObj.forEachObject((obj) => {\n        canvas.add(obj);\n      });\n      clonedObj.setCoords();\n    } else {\n      canvas.add(clonedObj);\n    }\n\n    canvas.setActiveObject(clonedObj);\n    canvas.requestRenderAll();\n    history.saveState();\n  };\n\n  const handleImportProjectFile = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!canvas) return;\n    const file = e.target.files && e.target.files[0];\n    if (!file) return;\n\n    const reader = new FileReader();\n    reader.onload = (ev) => {\n      try {\n        const text = ev.target?.result as string;\n        const json = JSON.parse(text);\n        canvas.loadFromJSON(json, () => {\n          canvas.renderAll();\n          history.saveState();\n        });\n      } catch (err) {\n        // eslint-disable-next-line no-console\n        console.error('Failed to import project JSON', err);\n        // message could be used but importing antd here would duplicate import; use alert as fallback\n        // If you prefer antd message, we can import it at top.\n        alert('Failed to import project file. Make sure it is a valid project JSON.');\n      }\n    };\n    reader.readAsText(file);\n    // reset input so same file can be re-imported if needed\n    e.currentTarget.value = '';\n  };\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Ignore if typing in an input or textarea\n      if (\n        (e.target as HTMLElement).tagName === 'INPUT' ||\n        (e.target as HTMLElement).tagName === 'TEXTAREA'\n      ) {\n        return;\n      }\n\n      // Ignore if editing text on canvas\n      if (\n        canvas?.getActiveObject() instanceof IText &&\n        (canvas.getActiveObject() as IText).isEditing\n      ) {\n        return;\n      }\n\n      // Hold Space to temporarily switch to Hand tool\n      if (e.code === 'Space') {\n        if (!spacePressedRef.current) {\n          spacePressedRef.current = true;\n          prevToolRef.current = activeTool;\n          if (activeTool !== 'hand') setActiveTool('hand');\n        }\n        e.preventDefault();\n        return;\n      }\n\n      if (e.key === 'v' || e.key === 'V') setActiveTool('select');\n      if (e.key === 'h' || e.key === 'H') setActiveTool('hand');\n      if (e.key === 'b' || e.key === 'B') setActiveTool('brush');\n      if (e.key === 'c' || e.key === 'C') {\n        if (!(e.ctrlKey || e.metaKey)) {\n          setCropModalVisible(true);\n        }\n      }\n      if (e.key === 'm' || e.key === 'M') {\n        if (selectedObject instanceof FabricImage) setMaskModalVisible(true);\n      }\n      if (e.key === 'r' || e.key === 'R') addRectangle();\n      if (e.key === 't' || e.key === 'T') setActiveTool('text');\n\n      if (e.key === 'Delete' || e.key === 'Backspace') deleteSelected();\n\n      if ((e.ctrlKey || e.metaKey) && (e.key === 'z' || e.key === 'Z')) {\n        e.preventDefault();\n        if (e.shiftKey) {\n          history.redo();\n        } else {\n          history.undo();\n        }\n      }\n      if ((e.ctrlKey || e.metaKey) && e.key === 'y') {\n        e.preventDefault();\n        history.redo();\n      }\n\n      if ((e.ctrlKey || e.metaKey) && e.key === 'c') {\n        e.preventDefault();\n        copy();\n      }\n\n      // Paste handled by 'paste' event listener below to support image pasting\n      // if ((e.ctrlKey || e.metaKey) && e.key === 'v') {\n      //   e.preventDefault();\n      //   paste();\n      // }\n\n      if ((e.ctrlKey || e.metaKey) && e.key === 's') {\n        e.preventDefault();\n        handleSaveProject();\n      }\n\n      if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'S') {\n        e.preventDefault();\n        setExportModalVisible(true);\n      }\n\n      if ((e.ctrlKey || e.metaKey) && e.key === 'n') {\n        e.preventDefault();\n        newProject();\n      }\n    };\n\n    const handleKeyUp = (e: KeyboardEvent) => {\n      if (e.code === 'Space' && spacePressedRef.current) {\n        spacePressedRef.current = false;\n        const prev = prevToolRef.current;\n        prevToolRef.current = null;\n        if (prev && prev !== 'hand') {\n          setActiveTool(prev);\n        }\n        e.preventDefault();\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    window.addEventListener('keyup', handleKeyUp);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n      window.removeEventListener('keyup', handleKeyUp);\n    };\n  }, [canvas, selectedObject, history, activeTool, clipboard]);\n\n  // Handle Paste (System Image vs Internal Object)\n  useEffect(() => {\n    const handlePaste = (e: ClipboardEvent) => {\n      // Check for images in system clipboard\n      const items = e.clipboardData?.items;\n      const hasImage = items && Array.from(items).some((item) => item.type.includes('image'));\n\n      if (hasImage) {\n        // Let the global paste handler (in useImageUpload) handle the image\n        return;\n      }\n\n      // If no image, try to paste internal object\n      if (clipboard) {\n        e.preventDefault();\n        paste();\n      }\n    };\n\n    window.addEventListener('paste', handlePaste);\n    return () => window.removeEventListener('paste', handlePaste);\n  }, [clipboard, canvas, history]);\n\n  // Hand/pan tool: enable panning the canvas by dragging when activeTool === 'hand'\n  useEffect(() => {\n    if (!canvas) return;\n\n    let isPanning = false;\n    let lastX = 0;\n    let lastY = 0;\n\n    const startPan = (opt: any) => {\n      if (activeTool !== 'hand') return;\n      isPanning = true;\n      const e = opt.e as MouseEvent;\n      lastX = e.clientX;\n      lastY = e.clientY;\n      // discard selection and prevent object events while panning\n      try {\n        canvas.discardActiveObject();\n      } catch (e) {\n        // ignore\n      }\n      canvas.requestRenderAll();\n      canvas.defaultCursor = 'grabbing';\n      document.body.style.cursor = 'grabbing';\n      canvas.forEachObject((o) => (o.evented = false));\n    };\n\n    const movePan = (opt: any) => {\n      if (!isPanning || activeTool !== 'hand') return;\n      const e = opt.e as MouseEvent;\n      const dx = e.clientX - lastX;\n      const dy = e.clientY - lastY;\n      lastX = e.clientX;\n      lastY = e.clientY;\n      // fabric expects a Point instance\n      canvas.relativePan(new Point(dx, dy));\n      canvas.requestRenderAll();\n    };\n\n    const endPan = () => {\n      if (!isPanning) return;\n      isPanning = false;\n      canvas.defaultCursor = 'default';\n      document.body.style.cursor = 'default';\n      canvas.forEachObject((o) => (o.evented = true));\n    };\n\n    canvas.on('mouse:down', startPan);\n    canvas.on('mouse:move', movePan);\n    canvas.on('mouse:up', endPan);\n\n    // Ensure cleanup and restore state when tool changes or unmount\n    return () => {\n      canvas.off('mouse:down', startPan);\n      canvas.off('mouse:move', movePan);\n      canvas.off('mouse:up', endPan);\n      try {\n        canvas.forEachObject((o) => (o.evented = true));\n      } catch (e) {\n        // ignore\n      }\n      canvas.defaultCursor = 'default';\n      document.body.style.cursor = 'default';\n    };\n  }, [canvas, activeTool]);\n\n  const addRectangle = () => {\n    if (!canvas) return;\n    const rect = new Rect({\n      left: 100,\n      top: 100,\n      fill: '#ff0000',\n      width: 100,\n      height: 100,\n    });\n    canvas.add(rect);\n    canvas.setActiveObject(rect);\n    history.saveState();\n  };\n\n  const addCircle = () => {\n    if (!canvas) return;\n    const circle = new Circle({\n      left: 100,\n      top: 100,\n      fill: '#00ff00',\n      radius: 50,\n    });\n    canvas.add(circle);\n    canvas.setActiveObject(circle);\n    history.saveState();\n  };\n\n  const addTriangle = () => {\n    if (!canvas) return;\n    const triangle = new Triangle({\n      left: 100,\n      top: 100,\n      fill: '#0000ff',\n      width: 100,\n      height: 100,\n    });\n    canvas.add(triangle);\n    canvas.setActiveObject(triangle);\n    history.saveState();\n  };\n\n  const addPolygon = () => {\n    if (!canvas) return;\n    const points = [\n      { x: 200, y: 100 },\n      { x: 250, y: 125 },\n      { x: 250, y: 175 },\n      { x: 200, y: 200 },\n      { x: 150, y: 175 },\n      { x: 150, y: 125 },\n    ];\n    const polygon = new Polygon(points, {\n      left: 100,\n      top: 100,\n      fill: '#ffff00',\n      objectCaching: false,\n    });\n    canvas.add(polygon);\n    canvas.setActiveObject(polygon);\n    history.saveState();\n  };\n\n  const addText = () => {\n    if (!canvas) return;\n    const text = new IText('Text', {\n      left: 100,\n      top: 100,\n      fontSize: 24,\n    });\n    canvas.add(text);\n    canvas.setActiveObject(text);\n    setActiveTool('text');\n    history.saveState();\n  };\n\n  const handleImageUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!canvas || !e.target.files || !e.target.files[0]) return;\n    const file = e.target.files[0];\n    const reader = new FileReader();\n    reader.onload = (f) => {\n      const data = f.target?.result as string;\n      FabricImage.fromURL(data).then((img) => {\n        img.scaleToWidth(200);\n        canvas.add(img);\n        canvas.centerObject(img);\n        canvas.setActiveObject(img);\n        history.saveState();\n      });\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const deleteSelected = () => {\n    if (!canvas) return;\n    const activeObjects = canvas.getActiveObjects();\n    if (activeObjects.length) {\n      canvas.discardActiveObject();\n      activeObjects.forEach((obj) => {\n        canvas.remove(obj);\n      });\n      history.saveState();\n    }\n  };\n\n  const handleApplyMask = (maskCanvas: HTMLCanvasElement) => {\n    if (!canvas || !selectedObject) return;\n    applyMaskToFabricObject(canvas, selectedObject, maskCanvas);\n    history.saveState();\n    setMaskModalVisible(false);\n  };\n\n  const handleApplyCameraRaw = (processedCanvas: HTMLCanvasElement) => {\n    if (!canvas || !selectedObject || !(selectedObject instanceof FabricImage)) return;\n\n    const newImg = new FabricImage(processedCanvas);\n\n    // Copy properties\n    newImg.set({\n      left: selectedObject.left,\n      top: selectedObject.top,\n      scaleX: selectedObject.scaleX,\n      scaleY: selectedObject.scaleY,\n      angle: selectedObject.angle,\n      skewX: selectedObject.skewX,\n      skewY: selectedObject.skewY,\n      flipX: selectedObject.flipX,\n      flipY: selectedObject.flipY,\n      originX: selectedObject.originX,\n      originY: selectedObject.originY,\n      opacity: selectedObject.opacity,\n    });\n\n    // Replace in canvas\n    const index = canvas.getObjects().indexOf(selectedObject);\n    canvas.discardActiveObject();\n    canvas.remove(selectedObject);\n    canvas.add(newImg);\n    canvas.moveObjectTo(newImg, index);\n\n    canvas.setActiveObject(newImg);\n    canvas.requestRenderAll();\n    history.saveState();\n    setCameraRawVisible(false);\n  };\n\n  const getSelectedImageCanvas = (): HTMLCanvasElement | null => {\n    if (!selectedObject || !(selectedObject instanceof FabricImage)) return null;\n    const imgElement = selectedObject.getElement() as HTMLImageElement | HTMLCanvasElement;\n    const tempCanvas = document.createElement('canvas');\n    tempCanvas.width = imgElement.width;\n    tempCanvas.height = imgElement.height;\n    const ctx = tempCanvas.getContext('2d');\n    if (ctx) {\n      ctx.drawImage(imgElement, 0, 0);\n    }\n    return tempCanvas;\n  };\n\n  const isImageSelected = selectedObject instanceof FabricImage;\n\n  return (\n    <Space direction=\"vertical\" style={{ padding: '8px' }}>\n      <Tooltip title=\"Hand (H)\">\n        <Button\n          type={activeTool === 'hand' ? 'primary' : 'default'}\n          icon={<IconFont name=\"iconhand\" styles={{ height: 16, width: 16 }} />}\n          onClick={() => setActiveTool('hand')}\n        />\n      </Tooltip>\n      <Tooltip title=\"Select (V)\">\n        <Button\n          type={activeTool === 'select' ? 'primary' : 'default'}\n          icon={<DragOutlined />}\n          onClick={() => setActiveTool('select')}\n        />\n      </Tooltip>\n      <Tooltip title=\"Brush (B)\">\n        <Button\n          type={activeTool === 'brush' ? 'primary' : 'default'}\n          icon={<HighlightOutlined />}\n          onClick={() => setActiveTool('brush')}\n        />\n      </Tooltip>\n\n      <Dropdown\n        overlay={\n          <Menu>\n            <Menu.Item key=\"rect\" icon={<BorderOutlined />} onClick={addRectangle}>\n              Rectangle\n            </Menu.Item>\n            <Menu.Item key=\"circle\" icon={<PlusCircleOutlined />} onClick={addCircle}>\n              Circle\n            </Menu.Item>\n            <Menu.Item key=\"triangle\" icon={<BorderOutlined />} onClick={addTriangle}>\n              Triangle\n            </Menu.Item>\n            <Menu.Item key=\"polygon\" icon={<BorderOutlined />} onClick={addPolygon}>\n              Polygon\n            </Menu.Item>\n          </Menu>\n        }\n        trigger={['click']}\n      >\n        <Tooltip title=\"Shapes\">\n          <Button icon={<AppstoreAddOutlined />} />\n        </Tooltip>\n      </Dropdown>\n\n      <Tooltip title=\"Text (T)\">\n        <Button\n          type={activeTool === 'text' ? 'primary' : 'default'}\n          icon={<FontSizeOutlined />}\n          onClick={() => setActiveTool('text')}\n        />\n      </Tooltip>\n\n      <input type=\"file\" id=\"image-upload\" hidden accept=\"image/*\" onChange={handleImageUpload} />\n      <input\n        type=\"file\"\n        id=\"project-import\"\n        hidden\n        accept=\"application/json, .json\"\n        onChange={handleImportProjectFile}\n      />\n\n      <Divider style={{ margin: '8px 0' }} />\n\n      <Tooltip title=\"Crop (C)\">\n        <Button icon={<BorderOuterOutlined />} onClick={() => setCropModalVisible(true)} />\n      </Tooltip>\n      <Tooltip title=\"Mask (M)\">\n        <Button\n          icon={<ScissorOutlined />}\n          onClick={() => setMaskModalVisible(true)}\n          disabled={!isImageSelected}\n        />\n      </Tooltip>\n      <Tooltip title=\"Camera Raw Filter\">\n        <Button\n          icon={<BgColorsOutlined />}\n          onClick={() => setCameraRawVisible(true)}\n          disabled={!isImageSelected}\n        />\n      </Tooltip>\n      <Tooltip title=\"Blur Brush\">\n        <Button icon={<HighlightOutlined />} onClick={() => setBlurBrushVisible(true)} />\n      </Tooltip>\n\n      <Divider style={{ margin: '8px 0' }} />\n\n      <Tooltip title=\"Undo (Ctrl+Z)\">\n        <Button icon={<UndoOutlined />} onClick={history.undo} disabled={!history.canUndo} />\n      </Tooltip>\n      <Tooltip title=\"Redo (Ctrl+Y)\">\n        <Button icon={<RedoOutlined />} onClick={history.redo} disabled={!history.canRedo} />\n      </Tooltip>\n\n      <Divider style={{ margin: '8px 0' }} />\n\n      <Dropdown\n        overlay={\n          <Menu>\n            <Menu.Item\n              key=\"upload\"\n              icon={<FileImageOutlined />}\n              onClick={() => document.getElementById('image-upload')?.click()}\n            >\n              Upload Image\n            </Menu.Item>\n            <Menu.Item key=\"copy\" icon={<CopyOutlined />} onClick={copy} disabled={!selectedObject}>\n              Copy (Ctrl + C)\n            </Menu.Item>\n            <Menu.Item\n              key=\"paste\"\n              icon={<SnippetsOutlined />}\n              onClick={paste}\n              disabled={!clipboard}\n            >\n              Paste (Ctrl + V)\n            </Menu.Item>\n            <Menu.Divider />\n            <Menu.Item key=\"new\" icon={<FileImageOutlined />} onClick={newProject}>\n              New Project (Ctrl + N)\n            </Menu.Item>\n            <Menu.Item key=\"save\" icon={<SaveOutlined />} onClick={handleSaveProject}>\n              Save Project (Ctrl + S)\n            </Menu.Item>\n            <Menu.Item\n              key=\"open\"\n              icon={<FolderOpenOutlined />}\n              onClick={() => setProjectModalVisible(true)}\n            >\n              Open Projects\n            </Menu.Item>\n            <Menu.Item\n              key=\"import\"\n              icon={<UploadOutlined />}\n              onClick={() => document.getElementById('project-import')?.click()}\n            >\n              Import Project (JSON)\n            </Menu.Item>\n            <Menu.Item\n              key=\"export\"\n              icon={<ExportOutlined />}\n              onClick={() => setExportModalVisible(true)}\n            >\n              Export (Ctrl + Shift + S)\n            </Menu.Item>\n          </Menu>\n        }\n        trigger={['click']}\n      >\n        <Tooltip title=\"More\">\n          <Button icon={<MoreOutlined />}></Button>\n        </Tooltip>\n      </Dropdown>\n\n      <ExportModal\n        visible={exportModalVisible}\n        onCancel={() => setExportModalVisible(false)}\n        canvas={canvas}\n      />\n\n      {maskModalVisible && isImageSelected && (\n        <LayerMaskModal\n          open={maskModalVisible}\n          onCancel={() => setMaskModalVisible(false)}\n          onApply={handleApplyMask}\n          sourceCanvas={getSelectedImageCanvas()}\n          selectedColor={null}\n        />\n      )}\n\n      {cameraRawVisible && isImageSelected && (\n        <CameraRawModal\n          visible={cameraRawVisible}\n          onCancel={() => setCameraRawVisible(false)}\n          onApply={handleApplyCameraRaw}\n          sourceCanvas={getSelectedImageCanvas()}\n        />\n      )}\n\n      <ProjectModal\n        visible={projectModalVisible}\n        onCancel={() => setProjectModalVisible(false)}\n        projects={savedProjects}\n        onLoad={handleLoadProject}\n        onDelete={deleteProject}\n      />\n\n      {cropModalVisible && (\n        <CropModal\n          visible={cropModalVisible}\n          onCancel={() => setCropModalVisible(false)}\n          canvas={canvas}\n          history={history}\n        />\n      )}\n\n      {blurBrushVisible && (\n        <BlurBrushModal\n          visible={blurBrushVisible}\n          onCancel={() => setBlurBrushVisible(false)}\n          canvas={canvas}\n          history={history}\n        />\n      )}\n    </Space>\n  );\n};\n\nexport default Toolbar;\n","import { useEffect, useRef } from 'react';\nimport { Canvas, FabricObject } from 'fabric';\n\nexport const useKeyboardShortcuts = (canvas: Canvas | null) => {\n  const clipboard = useRef<FabricObject | null>(null);\n\n  useEffect(() => {\n    if (!canvas) return;\n\n    const handleKeyDown = async (e: KeyboardEvent) => {\n      // Copy\n      if ((e.ctrlKey || e.metaKey) && e.key === 'c') {\n        const activeObject = canvas.getActiveObject();\n        if (activeObject) {\n          const cloned = await activeObject.clone();\n          clipboard.current = cloned;\n        }\n      }\n\n      // Paste\n      if ((e.ctrlKey || e.metaKey) && e.key === 'v') {\n        if (clipboard.current) {\n          const clonedObj = await clipboard.current.clone();\n          canvas.discardActiveObject();\n\n          clonedObj.set({\n            left: (clonedObj.left || 0) + 10,\n            top: (clonedObj.top || 0) + 10,\n            evented: true,\n          });\n\n          if (clonedObj.type === 'activeSelection') {\n            // active selection needs a reference to the canvas.\n            clonedObj.canvas = canvas;\n            (clonedObj as any).forEachObject((obj: any) => {\n              canvas.add(obj);\n            });\n            clonedObj.setCoords();\n          } else {\n            canvas.add(clonedObj);\n          }\n\n          clipboard.current = clonedObj; // Update clipboard to allow multiple pastes with offset\n          canvas.setActiveObject(clonedObj);\n          canvas.requestRenderAll();\n        }\n      }\n\n      // Brush Size\n      if (canvas.isDrawingMode && canvas.freeDrawingBrush) {\n        if (e.key === '[') {\n          canvas.freeDrawingBrush.width = Math.max(1, canvas.freeDrawingBrush.width - 5);\n        } else if (e.key === ']') {\n          canvas.freeDrawingBrush.width += 5;\n        }\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [canvas]);\n};\n","import React, { useEffect, useRef } from 'react';\nimport { Canvas, FabricImage, PencilBrush, IText, Point } from 'fabric';\nimport { usePhotoEditor } from '../context';\nimport { useKeyboardShortcuts } from '../hooks/useKeyboardShortcuts';\n\nconst CanvasArea: React.FC = () => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const {\n    canvas,\n    setCanvas,\n    selectedObject,\n    setSelectedObject,\n    history,\n    imageUrl,\n    initialProject,\n    activeTool,\n    addOnFile,\n    setAddOnFile,\n    setActiveTool,\n    brushSize,\n    setBrushSize,\n    brushColor,\n    setBrushColor,\n  } = usePhotoEditor();\n\n  const isEditingRef = useRef(false);\n\n  useKeyboardShortcuts(canvas);\n\n  const altPressedRef = useRef(false);\n  const previewDivRef = useRef<HTMLDivElement | null>(null);\n  const brushOverlayRef = useRef<HTMLDivElement | null>(null);\n  const isResizingBrushRef = useRef(false);\n  const resizeStartXRef = useRef(0);\n  const resizeStartSizeRef = useRef(0);\n  const brushSizeRef = useRef(brushSize);\n\n  useEffect(() => {\n    brushSizeRef.current = brushSize;\n  }, [brushSize]);\n\n  useEffect(() => {\n    if (!canvas || !addOnFile) return;\n\n    const reader = new FileReader();\n    reader.onload = (f) => {\n      const data = f.target?.result as string;\n      FabricImage.fromURL(data).then((img) => {\n        img.scaleToWidth(200);\n        canvas.add(img);\n        canvas.centerObject(img);\n        canvas.setActiveObject(img);\n        history.saveState();\n        if (setAddOnFile) setAddOnFile(null);\n      });\n    };\n    reader.readAsDataURL(addOnFile);\n  }, [addOnFile, canvas]);\n\n  // Sync brush settings\n  useEffect(() => {\n    if (canvas && canvas.freeDrawingBrush && activeTool === 'brush') {\n      canvas.freeDrawingBrush.width = brushSize;\n      canvas.freeDrawingBrush.color = brushColor;\n    }\n  }, [canvas, activeTool, brushSize, brushColor]);\n\n  // Alt+hover preview, Alt+click to pick color, Alt+RightClick drag to resize\n  useEffect(() => {\n    if (!canvas || !containerRef.current) return;\n\n    const container = containerRef.current;\n    const lower = (canvas.lowerCanvasEl as HTMLCanvasElement) || null;\n\n    // Create color preview div\n    const preview = document.createElement('div');\n    preview.style.position = 'absolute';\n    preview.style.pointerEvents = 'none';\n    preview.style.width = '28px';\n    preview.style.height = '28px';\n    preview.style.borderRadius = '50%';\n    preview.style.boxShadow = '0 0 4px rgba(0,0,0,0.5)';\n    preview.style.border = '2px solid #fff';\n    preview.style.transform = 'translate(-50%, -50%)';\n    preview.style.display = 'none';\n    preview.style.zIndex = '1000';\n    container.appendChild(preview);\n    previewDivRef.current = preview;\n\n    // Create brush size overlay\n    const overlay = document.createElement('div');\n    overlay.style.position = 'absolute';\n    overlay.style.pointerEvents = 'none';\n    overlay.style.border = '1px solid rgba(0,0,0,0.5)';\n    overlay.style.borderRadius = '50%';\n    overlay.style.transform = 'translate(-50%, -50%)';\n    overlay.style.display = 'none';\n    overlay.style.zIndex = '999';\n    container.appendChild(overlay);\n    brushOverlayRef.current = overlay;\n\n    const updateCursorAndOverlay = (x: number, y: number, size: number) => {\n      if (!brushOverlayRef.current) return;\n\n      // Only show overlay if size is significantly larger than cursor or if we are resizing\n      // Standard cursor is small. Let's say if size > 10 we show overlay.\n      const showOverlay = activeTool === 'brush' && (size > 10 || isResizingBrushRef.current);\n\n      if (showOverlay) {\n        brushOverlayRef.current.style.width = `${size}px`;\n        brushOverlayRef.current.style.height = `${size}px`;\n        brushOverlayRef.current.style.left = `${x}px`;\n        brushOverlayRef.current.style.top = `${y}px`;\n        brushOverlayRef.current.style.display = 'block';\n\n        // Hide default cursor when overlay is shown\n        if (canvas.defaultCursor !== 'none') {\n          canvas.defaultCursor = 'none';\n          canvas.hoverCursor = 'none';\n          canvas.requestRenderAll();\n        }\n      } else {\n        brushOverlayRef.current.style.display = 'none';\n        if (canvas.defaultCursor === 'none') {\n          canvas.defaultCursor = 'default';\n          canvas.hoverCursor = 'move';\n          canvas.requestRenderAll();\n        }\n      }\n    };\n\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Alt') {\n        altPressedRef.current = true;\n        if (activeTool === 'brush') {\n          canvas.isDrawingMode = false;\n        }\n      }\n    };\n\n    const onKeyUp = (e: KeyboardEvent) => {\n      if (e.key === 'Alt') {\n        altPressedRef.current = false;\n        if (activeTool === 'brush' && !isResizingBrushRef.current) {\n          canvas.isDrawingMode = true;\n        }\n        if (previewDivRef.current) previewDivRef.current.style.display = 'none';\n      }\n    };\n\n    const onContextMenu = (e: MouseEvent) => {\n      if (e.altKey) {\n        e.preventDefault();\n      }\n    };\n\n    const onMouseDown = (e: MouseEvent) => {\n      if (activeTool !== 'brush') return;\n\n      // Alt + Right Click -> Resize\n      if (e.altKey && e.button === 2) {\n        e.preventDefault();\n        isResizingBrushRef.current = true;\n        resizeStartXRef.current = e.clientX;\n        resizeStartSizeRef.current = brushSizeRef.current;\n        canvas.isDrawingMode = false;\n        return;\n      }\n\n      // Alt + Left Click -> Color Pick\n      if (e.altKey && e.button === 0) {\n        try {\n          const rect = container.getBoundingClientRect();\n          const x = e.clientX - rect.left;\n          const y = e.clientY - rect.top;\n\n          if (!lower) return;\n          const ctx = lower.getContext('2d');\n          if (!ctx) return;\n\n          const pixel = ctx.getImageData(x, y, 1, 1).data;\n          const hex =\n            '#' +\n            [pixel[0], pixel[1], pixel[2]].map((v) => v.toString(16).padStart(2, '0')).join('');\n\n          setBrushColor(hex);\n        } catch (err) {\n          // ignore\n        }\n      }\n    };\n\n    const onMouseMove = (e: MouseEvent) => {\n      if (activeTool !== 'brush') {\n        if (brushOverlayRef.current) brushOverlayRef.current.style.display = 'none';\n        return;\n      }\n\n      const rect = container.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const y = e.clientY - rect.top;\n\n      // Handle Resizing\n      if (isResizingBrushRef.current) {\n        const delta = e.clientX - resizeStartXRef.current;\n        // Drag right -> increase, Drag left -> decrease\n        // Sensitivity: 1px drag = 1px size change? Or maybe slower/faster?\n        const newSize = Math.max(1, resizeStartSizeRef.current + delta);\n        setBrushSize(newSize);\n        updateCursorAndOverlay(x, y, newSize);\n        return;\n      }\n\n      // Handle Overlay (Normal movement)\n      updateCursorAndOverlay(x, y, brushSizeRef.current);\n\n      // Handle Color Pick Preview\n      if (altPressedRef.current) {\n        try {\n          if (!lower) return;\n          const ctx = lower.getContext('2d');\n          if (!ctx) return;\n\n          // Check bounds\n          if (x < 0 || y < 0 || x >= lower.width || y >= lower.height) {\n            if (previewDivRef.current) previewDivRef.current.style.display = 'none';\n            return;\n          }\n\n          const pixel = ctx.getImageData(x, y, 1, 1).data;\n          const hex =\n            '#' +\n            [pixel[0], pixel[1], pixel[2]].map((v) => v.toString(16).padStart(2, '0')).join('');\n\n          if (previewDivRef.current) {\n            previewDivRef.current.style.background = hex;\n            previewDivRef.current.style.display = 'block';\n            previewDivRef.current.style.left = x + 24 + 'px';\n            previewDivRef.current.style.top = y + 24 + 'px';\n          }\n        } catch (err) {\n          if (previewDivRef.current) previewDivRef.current.style.display = 'none';\n        }\n      } else {\n        if (previewDivRef.current) previewDivRef.current.style.display = 'none';\n      }\n    };\n\n    const onMouseUp = (e: MouseEvent) => {\n      if (isResizingBrushRef.current) {\n        isResizingBrushRef.current = false;\n        if (activeTool === 'brush' && !altPressedRef.current) {\n          canvas.isDrawingMode = true;\n        }\n      }\n    };\n\n    window.addEventListener('keydown', onKeyDown);\n    window.addEventListener('keyup', onKeyUp);\n    container.addEventListener('contextmenu', onContextMenu);\n    container.addEventListener('mousedown', onMouseDown);\n    window.addEventListener('mousemove', onMouseMove);\n    window.addEventListener('mouseup', onMouseUp);\n\n    return () => {\n      window.removeEventListener('keydown', onKeyDown);\n      window.removeEventListener('keyup', onKeyUp);\n      container.removeEventListener('contextmenu', onContextMenu);\n      container.removeEventListener('mousedown', onMouseDown);\n      window.removeEventListener('mousemove', onMouseMove);\n      window.removeEventListener('mouseup', onMouseUp);\n\n      if (previewDivRef.current) {\n        try {\n          container.removeChild(previewDivRef.current);\n        } catch (e) {}\n        previewDivRef.current = null;\n      }\n      if (brushOverlayRef.current) {\n        try {\n          container.removeChild(brushOverlayRef.current);\n        } catch (e) {}\n        brushOverlayRef.current = null;\n      }\n\n      // Restore cursor\n      if (canvas) {\n        canvas.defaultCursor = 'default';\n        canvas.hoverCursor = 'move';\n      }\n    };\n  }, [canvas, activeTool, setBrushSize, setBrushColor]); // Removed brushSize from dependency to avoid re-bind\n\n  useEffect(() => {\n    if (!canvasRef.current || !containerRef.current) return;\n\n    const fabricCanvas = new Canvas(canvasRef.current, {\n      width: containerRef.current.clientWidth,\n      height: containerRef.current.clientHeight,\n      backgroundColor: '#ffffff',\n      preserveObjectStacking: true, // Important for layers\n      selection: true,\n    });\n\n    setCanvas(fabricCanvas);\n\n    if (initialProject) {\n      fabricCanvas.loadFromJSON(initialProject.json).then(() => {\n        fabricCanvas.renderAll();\n        history.saveState();\n      });\n    } else if (imageUrl) {\n      FabricImage.fromURL(imageUrl).then((img) => {\n        const containerWidth = containerRef.current!.clientWidth;\n        const containerHeight = containerRef.current!.clientHeight;\n\n        if (img.width! > containerWidth || img.height! > containerHeight) {\n          img.scaleToWidth(containerWidth * 0.8);\n        }\n\n        fabricCanvas.add(img);\n        fabricCanvas.centerObject(img);\n        fabricCanvas.setActiveObject(img);\n        history.saveState();\n      });\n    }\n\n    const updateSelection = () => {\n      const activeObjects = fabricCanvas.getActiveObjects();\n      if (activeObjects.length === 1) {\n        setSelectedObject(activeObjects[0]);\n      } else {\n        setSelectedObject(null);\n      }\n    };\n\n    fabricCanvas.on('selection:created', updateSelection);\n    fabricCanvas.on('selection:updated', updateSelection);\n    fabricCanvas.on('selection:cleared', () => setSelectedObject(null));\n\n    // When entering/exiting text editing, keep the active tool in 'text'\n    const onTextEnter = () => {\n      isEditingRef.current = true;\n      setActiveTool && setActiveTool('text');\n    };\n    const onTextExit = () => setActiveTool && setActiveTool('select');\n\n    fabricCanvas.on('text:editing:entered', onTextEnter);\n    fabricCanvas.on('text:editing:exited', onTextExit);\n\n    const saveHistory = () => {\n      history.saveState();\n    };\n\n    fabricCanvas.on('object:modified', saveHistory);\n    fabricCanvas.on('object:added', saveHistory);\n    fabricCanvas.on('object:removed', saveHistory);\n\n    // Ctrl + mouse wheel to zoom (centered at pointer)\n    const onWheel = (ev: WheelEvent) => {\n      // only when ctrlKey is pressed\n      if (!ev.ctrlKey) return;\n      ev.preventDefault();\n\n      try {\n        const currentZoom = fabricCanvas.getZoom() || 1;\n        // wheel up -> zoom in, wheel down -> zoom out\n        const delta = ev.deltaY;\n        // Use an exponential zoom factor for smoother control\n        const zoomFactor = delta < 0 ? 1.12 : 0.88;\n        let newZoom = currentZoom * zoomFactor;\n        newZoom = Math.max(0.1, Math.min(5, newZoom));\n\n        // Get pointer in canvas coordinates\n        // fabricCanvas.getPointer works with native events too\n        const pointer = (fabricCanvas as any).getPointer(ev) as { x: number; y: number };\n        if (pointer && typeof pointer.x === 'number' && typeof pointer.y === 'number') {\n          fabricCanvas.zoomToPoint(new Point(pointer.x, pointer.y), newZoom);\n        } else {\n          // fallback: compute from client coords\n          const rect = fabricCanvas.lowerCanvasEl.getBoundingClientRect();\n          const x = ev.clientX - rect.left;\n          const y = ev.clientY - rect.top;\n          fabricCanvas.zoomToPoint(new Point(x, y), newZoom);\n        }\n\n        fabricCanvas.requestRenderAll();\n      } catch (e) {\n        // ignore\n      }\n    };\n\n    // attach to container so we can prevent browser zoom\n    containerRef.current.addEventListener('wheel', onWheel, { passive: false });\n\n    const handleResize = () => {\n      if (containerRef.current) {\n        fabricCanvas.setDimensions({\n          width: containerRef.current.clientWidth,\n          height: containerRef.current.clientHeight,\n        });\n      }\n    };\n\n    window.addEventListener('resize', handleResize);\n\n    return () => {\n      fabricCanvas.dispose();\n      window.removeEventListener('resize', handleResize);\n      if (containerRef.current) {\n        try {\n          containerRef.current.removeEventListener('wheel', onWheel as EventListener);\n        } catch (e) {}\n      }\n    };\n  }, []);\n\n  // If selected object is a text object and is being edited, ensure the active tool is 'text'\n  useEffect(() => {\n    if (!selectedObject) return;\n    try {\n      const editing = !!(selectedObject as any).isEditing;\n      isEditingRef.current = editing;\n      if (editing) {\n        setActiveTool && setActiveTool('text');\n      }\n    } catch (e) {\n      // ignore\n    }\n  }, [selectedObject, setActiveTool]);\n\n  useEffect(() => {\n    if (!canvas) return;\n    if (activeTool === 'brush') {\n      canvas.isDrawingMode = true;\n      if (!canvas.freeDrawingBrush) {\n        canvas.freeDrawingBrush = new PencilBrush(canvas);\n      }\n      canvas.freeDrawingBrush.width = brushSize;\n      canvas.freeDrawingBrush.color = brushColor;\n    } else {\n      canvas.isDrawingMode = false;\n    }\n  }, [activeTool, canvas]); // brushSize and brushColor are handled by the sync effect\n\n  // Place text on first mouse click when activeTool === 'text'\n  useEffect(() => {\n    if (!canvas) return;\n    if (activeTool !== 'text') return;\n\n    const handleMouseDown = (opt: any) => {\n      try {\n        // If a text object is currently being edited, do not create a new text object\n        if (isEditingRef.current) return;\n\n        const pointer = canvas.getViewportPoint(opt.e);\n        const txt = new IText('Text', {\n          left: pointer.x,\n          top: pointer.y,\n          fontSize: 24,\n        });\n        canvas.add(txt);\n        canvas.setActiveObject(txt);\n        setSelectedObject && setSelectedObject(txt);\n        txt.enterEditing && txt.enterEditing();\n        txt.selectAll && txt.selectAll();\n        canvas.requestRenderAll();\n        history.saveState();\n        // switch back to select so subsequent clicks don't add more text\n        setActiveTool && setActiveTool('select');\n      } catch (err) {\n        // ignore\n      }\n    };\n\n    canvas.on('mouse:down', handleMouseDown);\n    return () => {\n      canvas.off('mouse:down', handleMouseDown);\n    };\n  }, [canvas, activeTool, history, setSelectedObject, setActiveTool]);\n\n  return (\n    <div ref={containerRef} style={{ width: '100%', height: '100%' }}>\n      <canvas ref={canvasRef} />\n    </div>\n  );\n};\n\nexport default CanvasArea;\n","import React, { useEffect, useState, useRef } from 'react';\nimport { List, Button, Typography, Space, InputNumber, Select } from 'antd';\nimport {\n  EyeOutlined,\n  EyeInvisibleOutlined,\n  LockOutlined,\n  UnlockOutlined,\n  DeleteOutlined,\n  HolderOutlined,\n  GroupOutlined,\n  UngroupOutlined,\n} from '@ant-design/icons';\nimport { usePhotoEditor } from '../context';\nimport { FabricObject, ActiveSelection, Group, util } from 'fabric';\nimport {\n  DndContext,\n  closestCenter,\n  KeyboardSensor,\n  PointerSensor,\n  useSensor,\n  useSensors,\n  DragEndEvent,\n} from '@dnd-kit/core';\nimport {\n  SortableContext,\n  sortableKeyboardCoordinates,\n  verticalListSortingStrategy,\n  useSortable,\n} from '@dnd-kit/sortable';\nimport { CSS } from '@dnd-kit/utilities';\n\nconst { Title } = Typography;\nconst { Option } = Select;\n\ninterface SortableItemProps {\n  id: string;\n  children: React.ReactNode;\n  isSelected: boolean;\n  onClick: (e: React.MouseEvent) => void;\n}\n\nconst SortableItem: React.FC<SortableItemProps> = ({ id, children, isSelected, onClick }) => {\n  const { attributes, listeners, setNodeRef, setActivatorNodeRef, transform, transition } =\n    useSortable({ id });\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    backgroundColor: isSelected ? '#e6f7ff' : 'transparent',\n    marginBottom: 4,\n    border: '1px solid #f0f0f0',\n    borderRadius: 4,\n    padding: '4px 8px',\n    display: 'flex',\n    alignItems: 'center',\n  };\n\n  return (\n    <div ref={setNodeRef} style={style}>\n      <div\n        ref={setActivatorNodeRef}\n        {...attributes}\n        {...listeners}\n        style={{\n          cursor: 'grab',\n          marginRight: 8,\n          display: 'flex',\n          alignItems: 'center',\n          color: '#999',\n        }}\n        onMouseDown={(e) => e.stopPropagation()}\n      >\n        <HolderOutlined />\n      </div>\n      <div onClick={(e) => onClick(e)} style={{ flex: 1, cursor: 'pointer' }}>\n        {children}\n      </div>\n    </div>\n  );\n};\n\nconst LayersPanel: React.FC = () => {\n  const { canvas, selectedObject, setSelectedObject, history } = usePhotoEditor();\n  const [objects, setObjects] = useState<FabricObject[]>([]);\n  const [activeUids, setActiveUids] = useState<string[]>([]);\n  const draggingOpacity = useRef(false);\n  const opacityStartX = useRef<number | null>(null);\n  const opacityStartValue = useRef<number>(100);\n  const lastClickedIndex = useRef<number | null>(null);\n\n  const sensors = useSensors(\n    useSensor(PointerSensor),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n    }),\n  );\n\n  const updateObjects = () => {\n    if (!canvas) return;\n    const objs = canvas.getObjects();\n    objs.forEach((obj: any) => {\n      if (!obj.uid) obj.uid = Math.random().toString(36).substr(2, 9);\n    });\n    // Reverse to show top layers first\n    setObjects([...objs].reverse());\n  };\n\n  const handleMerge = () => {\n    if (!canvas) return;\n    const activeObjects = [...canvas.getActiveObjects()];\n    if (activeObjects.length <= 1) return;\n\n    canvas.discardActiveObject();\n\n    const group = new Group(activeObjects);\n    if (!(group as any).uid) (group as any).uid = Math.random().toString(36).substr(2, 9);\n\n    activeObjects.forEach((obj) => canvas.remove(obj));\n    canvas.add(group);\n\n    canvas.setActiveObject(group);\n    canvas.requestRenderAll();\n\n    history.saveState();\n    updateObjects();\n\n    setSelectedObject(group);\n    setActiveUids([(group as any).uid]);\n  };\n\n  const handleUngroup = () => {\n    if (!canvas) return;\n    const activeObject = canvas.getActiveObject();\n    if (!activeObject) return;\n\n    if (activeObject.type === 'group' || activeObject instanceof Group) {\n      const group = activeObject as Group;\n      const items = group.getObjects();\n\n      // In Fabric.js v6, toActiveSelection might be missing or behave differently.\n      // We manually ungroup by calculating the absolute transform of each object.\n      const restoredItems = items.map((item) => {\n        const matrix = item.calcTransformMatrix();\n        const options = util.qrDecompose(matrix);\n\n        // Apply the absolute transform options to the item\n        item.set({\n          ...options,\n          left: options.translateX,\n          top: options.translateY,\n          angle: options.angle,\n          scaleX: options.scaleX,\n          scaleY: options.scaleY,\n          skewX: options.skewX,\n          skewY: options.skewY,\n        });\n        // Remove from group (this might be redundant if we remove group, but safe)\n        // group.remove(item);\n        return item;\n      });\n\n      // Remove the group from canvas\n      canvas.remove(group);\n\n      // Add items back to canvas\n      restoredItems.forEach((item) => {\n        canvas.add(item);\n      });\n\n      // Create selection\n      const activeSelection = new ActiveSelection(restoredItems, { canvas });\n      canvas.setActiveObject(activeSelection);\n\n      canvas.requestRenderAll();\n      history.saveState();\n      updateObjects();\n\n      setSelectedObject(activeSelection);\n      const uids = restoredItems.map((o: any) => o.uid);\n      setActiveUids(uids);\n    }\n  };\n\n  useEffect(() => {\n    if (!canvas) return;\n\n    let timeout: NodeJS.Timeout;\n    const debouncedUpdate = () => {\n      clearTimeout(timeout);\n      timeout = setTimeout(updateObjects, 100);\n    };\n\n    const handleObjectAdded = () => {\n      const objs = canvas.getObjects();\n      if (objs.length === 1) {\n        const obj = objs[0];\n        obj.set({\n          lockMovementX: true,\n          lockMovementY: true,\n          lockRotation: true,\n          lockScalingX: true,\n          lockScalingY: true,\n          selectable: false,\n          hoverCursor: 'default',\n        });\n      }\n      debouncedUpdate();\n    };\n\n    canvas.on('object:added', handleObjectAdded);\n    canvas.on('object:removed', debouncedUpdate);\n    canvas.on('object:modified', debouncedUpdate);\n\n    // update selection highlights when selection changes (supports multi-select)\n    const updateSelection = () => {\n      const active = canvas.getActiveObjects() || [];\n      const uids = active.map((o: any) => o.uid).filter(Boolean);\n      setActiveUids(uids);\n\n      // Sync selectedObject with canvas selection\n      const activeObj = canvas.getActiveObject();\n      setSelectedObject(activeObj ?? null);\n    };\n\n    const clearSelection = () => {\n      setActiveUids([]);\n      setSelectedObject(null);\n    };\n\n    canvas.on('selection:created', updateSelection);\n    canvas.on('selection:updated', updateSelection);\n    canvas.on('selection:cleared', clearSelection);\n\n    updateObjects();\n\n    return () => {\n      canvas.off('object:added', handleObjectAdded);\n      canvas.off('object:removed', debouncedUpdate);\n      canvas.off('object:modified', debouncedUpdate);\n      canvas.off('selection:created', updateSelection);\n      canvas.off('selection:updated', updateSelection);\n      canvas.off('selection:cleared', clearSelection);\n      clearTimeout(timeout);\n    };\n  }, [canvas]);\n\n  const handleDragEnd = (event: DragEndEvent) => {\n    const { active, over } = event;\n\n    if (over && active.id !== over.id) {\n      const oldIndex = objects.findIndex((obj: any) => obj.uid === active.id);\n      const newIndex = objects.findIndex((obj: any) => obj.uid === over.id);\n\n      if (oldIndex !== -1 && newIndex !== -1) {\n        const fabricNewIndex = objects.length - 1 - newIndex;\n        const obj = objects[oldIndex];\n\n        canvas?.moveObjectTo(obj, fabricNewIndex);\n        canvas?.requestRenderAll();\n        history.saveState();\n        updateObjects();\n      }\n    }\n  };\n\n  const toggleVisibility = (obj: FabricObject, e: React.MouseEvent) => {\n    e.stopPropagation();\n    obj.visible = !obj.visible;\n    if (!obj.visible) {\n      canvas?.discardActiveObject();\n    }\n    canvas?.requestRenderAll();\n    history.saveState();\n    setObjects([...(canvas?.getObjects() || [])].reverse());\n  };\n\n  const toggleLock = (obj: FabricObject, e: React.MouseEvent) => {\n    e.stopPropagation();\n    obj.lockMovementX = !obj.lockMovementX;\n    obj.lockMovementY = !obj.lockMovementY;\n    obj.lockRotation = !obj.lockRotation;\n    obj.lockScalingX = !obj.lockScalingX;\n    obj.lockScalingY = !obj.lockScalingY;\n    obj.selectable = !obj.lockMovementX;\n\n    if (!obj.selectable) {\n      canvas?.discardActiveObject();\n    }\n\n    canvas?.requestRenderAll();\n    history.saveState();\n    setObjects([...(canvas?.getObjects() || [])].reverse());\n  };\n\n  const selectObject = (obj: FabricObject, e?: React.MouseEvent) => {\n    if (!canvas || !obj.visible || !obj.selectable) return;\n\n    const idx = objects.findIndex((o: any) => o === obj);\n    // Ctrl/Cmd -> toggle selection\n    const isCtrl = e && (e.ctrlKey || e.metaKey);\n    const isShift = e && e.shiftKey;\n\n    if (isCtrl) {\n      const active = canvas.getActiveObjects() || [];\n      const already = active.includes(obj as any);\n      let newActive = [] as any[];\n      if (already) {\n        newActive = active.filter((a: any) => a !== obj);\n      } else {\n        newActive = [...active, obj];\n      }\n\n      if (newActive.length === 0) {\n        canvas.discardActiveObject();\n        setSelectedObject(null);\n      } else if (newActive.length === 1) {\n        canvas.setActiveObject(newActive[0]);\n        setSelectedObject(newActive[0]);\n      } else {\n        const sel = new ActiveSelection(newActive, { canvas });\n        canvas.setActiveObject(sel);\n        setSelectedObject(newActive[newActive.length - 1]);\n      }\n      canvas.requestRenderAll();\n      lastClickedIndex.current = idx;\n      return;\n    }\n\n    if (isShift && lastClickedIndex.current !== null) {\n      const start = Math.min(lastClickedIndex.current, idx);\n      const end = Math.max(lastClickedIndex.current, idx);\n      const range = objects.slice(start, end + 1).map((o: any) => o) as any[];\n      if (range.length === 1) {\n        canvas.setActiveObject(range[0]);\n        setSelectedObject(range[0]);\n      } else {\n        const sel = new ActiveSelection(range, { canvas });\n        canvas.setActiveObject(sel);\n        setSelectedObject(range[range.length - 1]);\n      }\n      canvas.requestRenderAll();\n      return;\n    }\n\n    // Default: single select\n    canvas.setActiveObject(obj);\n    setSelectedObject(obj);\n    canvas.requestRenderAll();\n    lastClickedIndex.current = idx;\n  };\n\n  const deleteObject = (obj: FabricObject, e: React.MouseEvent) => {\n    e.stopPropagation();\n    canvas?.remove(obj);\n    canvas?.requestRenderAll();\n    history.saveState();\n  };\n\n  const handleOpacityChange = (value: number) => {\n    if (!canvas || !selectedObject) return;\n    selectedObject.set('opacity', value);\n    canvas.requestRenderAll();\n    // history.saveState(); // Maybe debounce this or save onAfterChange\n  };\n\n  const handleOpacityNumberChange = (v: number | undefined | null) => {\n    if (!canvas || !selectedObject) return;\n    const value = Number(v || 0);\n    selectedObject.set('opacity', Math.max(0, Math.min(100, value)) / 100);\n    canvas.requestRenderAll();\n  };\n\n  const handleOpacityLabelMouseDown = (e: React.MouseEvent) => {\n    if (e.button !== 0) return;\n    e.preventDefault();\n    draggingOpacity.current = true;\n    opacityStartX.current = e.clientX;\n    // store percentage (0-100)\n    opacityStartValue.current = Math.round(((selectedObject?.opacity ?? 1) as number) * 100);\n    const prevUserSelect = document.body.style.userSelect;\n    document.body.style.userSelect = 'none';\n\n    const onMouseMove = (ev: MouseEvent) => {\n      if (!draggingOpacity.current || opacityStartX.current === null) return;\n      const delta = ev.clientX - opacityStartX.current;\n      const sensitivity = 0.2; // pixels -> percent\n      let newVal = Math.max(0, Math.min(100, opacityStartValue.current + delta * sensitivity));\n      const obj = canvas?.getActiveObject() as FabricObject | undefined;\n      if (obj && canvas) {\n        obj.set('opacity', newVal / 100);\n        canvas.requestRenderAll();\n      }\n    };\n\n    const onMouseUp = () => {\n      draggingOpacity.current = false;\n      opacityStartX.current = null;\n      document.body.style.userSelect = prevUserSelect;\n      window.removeEventListener('mousemove', onMouseMove);\n      window.removeEventListener('mouseup', onMouseUp);\n      history.saveState();\n    };\n\n    window.addEventListener('mousemove', onMouseMove);\n    window.addEventListener('mouseup', onMouseUp);\n  };\n\n  const handleOpacityAfterChange = () => {\n    history.saveState();\n  };\n\n  const handleBlendModeChange = (value: string) => {\n    if (!canvas || !selectedObject) return;\n    selectedObject.set('globalCompositeOperation', value);\n    canvas.requestRenderAll();\n    history.saveState();\n  };\n\n  return (\n    <div style={{ padding: 10 }}>\n      <Title level={5}>Layers</Title>\n      <div style={{ marginBottom: 8 }}>\n        <Space>\n          <Button\n            icon={<GroupOutlined />}\n            onClick={handleMerge}\n            disabled={!selectedObject}\n            title=\"Merge Layers\"\n          />\n          <Button\n            icon={<UngroupOutlined />}\n            onClick={handleUngroup}\n            disabled={!selectedObject || selectedObject.type !== 'group'}\n            title=\"Ungroup Layers\"\n          />\n        </Space>\n      </div>\n\n      {selectedObject && (\n        <div style={{ marginBottom: 16, padding: 8, background: '#fafafa', borderRadius: 4 }}>\n          <div style={{ marginBottom: 8 }}>\n            <div\n              style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 8,\n                fontSize: 12,\n                cursor: 'ew-resize',\n                userSelect: 'none',\n              }}\n              onMouseDown={handleOpacityLabelMouseDown}\n            >\n              <div style={{ marginRight: 8 }}>Opacity:</div>\n              <InputNumber\n                size=\"small\"\n                min={0}\n                max={100}\n                step={1}\n                value={Math.round((selectedObject.opacity ?? 1) * 100)}\n                onChange={(v) => handleOpacityNumberChange(v)}\n                onBlur={() => handleOpacityAfterChange()}\n                style={{ flex: 1 }}\n              />\n            </div>\n          </div>\n          <div>\n            <div\n              style={{ display: 'flex', alignItems: 'center', gap: 8, fontSize: 12, width: '100%' }}\n            >\n              <div style={{ marginRight: 8 }}>Blend Mode:</div>\n              <Select\n                size=\"small\"\n                style={{ flex: 1 }}\n                value={selectedObject.globalCompositeOperation || 'source-over'}\n                onChange={handleBlendModeChange}\n              >\n                <Option value=\"source-over\">Normal</Option>\n                <Option value=\"multiply\">Multiply</Option>\n                <Option value=\"screen\">Screen</Option>\n                <Option value=\"overlay\">Overlay</Option>\n                <Option value=\"darken\">Darken</Option>\n                <Option value=\"lighten\">Lighten</Option>\n                <Option value=\"color-dodge\">Color Dodge</Option>\n                <Option value=\"color-burn\">Color Burn</Option>\n                <Option value=\"hard-light\">Hard Light</Option>\n                <Option value=\"soft-light\">Soft Light</Option>\n                <Option value=\"difference\">Difference</Option>\n                <Option value=\"exclusion\">Exclusion</Option>\n                <Option value=\"hue\">Hue</Option>\n                <Option value=\"saturation\">Saturation</Option>\n                <Option value=\"color\">Color</Option>\n                <Option value=\"luminosity\">Luminosity</Option>\n              </Select>\n            </div>\n          </div>\n        </div>\n      )}\n\n      <DndContext sensors={sensors} collisionDetection={closestCenter} onDragEnd={handleDragEnd}>\n        <SortableContext\n          items={objects.map((obj: any) => obj.uid)}\n          strategy={verticalListSortingStrategy}\n        >\n          <div\n            style={{\n              // maxHeight: 300, // Removed to allow scrolling\n              overflowY: 'auto',\n              border: '1px solid #d9d9d9',\n              borderRadius: 4,\n              padding: 4,\n            }}\n          >\n            {objects.map((item: any, index) => {\n              const isSelected = activeUids.includes(item.uid);\n              const type = item.type || 'Object';\n              const name = item.name || `${type} ${objects.length - index}`;\n\n              return (\n                <SortableItem\n                  key={item.uid}\n                  id={item.uid}\n                  isSelected={isSelected}\n                  onClick={(e) => selectObject(item, e)}\n                >\n                  <div\n                    style={{\n                      display: 'flex',\n                      alignItems: 'center',\n                      width: '100%',\n                      justifyContent: 'space-between',\n                    }}\n                  >\n                    <span\n                      style={{\n                        overflow: 'hidden',\n                        textOverflow: 'ellipsis',\n                        whiteSpace: 'nowrap',\n                        maxWidth: 120,\n                      }}\n                    >\n                      {name}\n                    </span>\n                    <Space size={4}>\n                      <Button\n                        type=\"text\"\n                        size=\"small\"\n                        icon={item.visible ? <EyeOutlined /> : <EyeInvisibleOutlined />}\n                        onClick={(e) => toggleVisibility(item, e)}\n                        onMouseDown={(e) => e.stopPropagation()}\n                      />\n                      <Button\n                        type=\"text\"\n                        size=\"small\"\n                        icon={item.lockMovementX ? <LockOutlined /> : <UnlockOutlined />}\n                        onClick={(e) => toggleLock(item, e)}\n                        onMouseDown={(e) => e.stopPropagation()}\n                      />\n                      <Button\n                        type=\"text\"\n                        size=\"small\"\n                        danger\n                        icon={<DeleteOutlined />}\n                        onClick={(e) => deleteObject(item, e)}\n                        onMouseDown={(e) => e.stopPropagation()}\n                      />\n                    </Space>\n                  </div>\n                </SortableItem>\n              );\n            })}\n          </div>\n        </SortableContext>\n      </DndContext>\n    </div>\n  );\n};\n\nexport default LayersPanel;\n","import React, { useEffect, useRef, useState } from 'react';\nimport { Slider, Typography, Space, Collapse } from 'antd';\nimport { usePhotoEditor } from '../context';\nimport { filters, FabricImage } from 'fabric';\n\nconst { Panel } = Collapse;\n\nconst FILTER_LIST = [\n  { name: 'Grayscale', filter: filters.Grayscale, index: 9 },\n  { name: 'Invert', filter: filters.Invert, index: 10 },\n  { name: 'Sepia', filter: filters.Sepia, index: 11 },\n  { name: 'Black&White', filter: filters.BlackWhite, index: 12 },\n  { name: 'Brownie', filter: filters.Brownie, index: 13 },\n  { name: 'Vintage', filter: filters.Vintage, index: 14 },\n  { name: 'Kodachrome', filter: filters.Kodachrome, index: 15 },\n  { name: 'Technicolor', filter: filters.Technicolor, index: 16 },\n  { name: 'Polaroid', filter: filters.Polaroid, index: 17 },\n];\n\nconst FilterPreview: React.FC<{\n  name: string;\n  filterClass: any;\n  originalImage: HTMLImageElement | null;\n  isActive: boolean;\n  onClick: () => void;\n}> = ({ name, filterClass, originalImage, isActive, onClick }) => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n\n  useEffect(() => {\n    if (!originalImage || !canvasRef.current) return;\n\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    const size = 60;\n    canvas.width = size;\n    canvas.height = size;\n\n    // Create a temporary fabric image\n    const fImg = new FabricImage(originalImage);\n\n    const scale = size / Math.max(fImg.width || 1, fImg.height || 1);\n    fImg.scale(scale);\n\n    const filter = new filterClass();\n    fImg.filters = [filter];\n    fImg.applyFilters();\n\n    const element = fImg.getElement();\n\n    ctx.clearRect(0, 0, size, size);\n\n    const dw = (fImg.width || 0) * (fImg.scaleX || 1);\n    const dh = (fImg.height || 0) * (fImg.scaleY || 1);\n    const dx = (size - dw) / 2;\n    const dy = (size - dh) / 2;\n\n    ctx.drawImage(element, dx, dy, dw, dh);\n  }, [originalImage, filterClass]);\n\n  return (\n    <div\n      onClick={onClick}\n      style={{\n        cursor: 'pointer',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        gap: 4,\n      }}\n    >\n      <div\n        style={{\n          width: 64,\n          height: 64,\n          border: isActive ? '2px solid #1890ff' : '1px solid #f0f0f0',\n          borderRadius: 4,\n          overflow: 'hidden',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          background: '#f5f5f5',\n        }}\n      >\n        <canvas ref={canvasRef} />\n      </div>\n      <Typography.Text style={{ fontSize: 10, textAlign: 'center', lineHeight: 1.2 }}>\n        {name}\n      </Typography.Text>\n    </div>\n  );\n};\n\nconst AdjustmentPanel: React.FC = () => {\n  const { canvas, selectedObject, history } = usePhotoEditor();\n  const [originalImage, setOriginalImage] = useState<HTMLImageElement | null>(null);\n\n  useEffect(() => {\n    if (selectedObject && selectedObject.isType('image')) {\n      const img = selectedObject as FabricImage;\n      const src = img.getSrc();\n      const image = new Image();\n      image.crossOrigin = 'anonymous';\n      image.src = src;\n      image.onload = () => {\n        setOriginalImage(image);\n      };\n    } else {\n      setOriginalImage(null);\n    }\n  }, [selectedObject]);\n\n  const applyFilter = (index: number, filter: any) => {\n    if (!selectedObject || !selectedObject.isType('image')) return;\n    const img = selectedObject as any;\n    img.filters[index] = filter;\n    img.applyFilters();\n    canvas?.requestRenderAll();\n  };\n\n  const handleBrightness = (value: number) => {\n    const filter = new filters.Brightness({ brightness: value });\n    applyFilter(0, filter);\n  };\n\n  const handleContrast = (value: number) => {\n    const filter = new filters.Contrast({ contrast: value });\n    applyFilter(1, filter);\n  };\n\n  const handleSaturation = (value: number) => {\n    const filter = new filters.Saturation({ saturation: value });\n    applyFilter(2, filter);\n  };\n\n  const handleNoise = (value: number) => {\n    const filter = new filters.Noise({ noise: value });\n    applyFilter(3, filter);\n  };\n\n  const handlePixelate = (value: number) => {\n    const filter = value > 1 ? new filters.Pixelate({ blocksize: value }) : false;\n    applyFilter(4, filter);\n  };\n\n  const handleBlur = (value: number) => {\n    const filter = new filters.Blur({ blur: value });\n    applyFilter(5, filter);\n  };\n\n  const handleGamma = (value: number) => {\n    const filter = new filters.Gamma({ gamma: [value, value, value] });\n    applyFilter(6, filter);\n  };\n\n  const handleVibrance = (value: number) => {\n    const filter = new filters.Vibrance({ vibrance: value });\n    applyFilter(7, filter);\n  };\n\n  const handleHueRotation = (value: number) => {\n    const filter = new filters.HueRotation({ rotation: value });\n    applyFilter(8, filter);\n  };\n\n  const handleToggleFilter = (index: number, FilterClass: any, checked: boolean) => {\n    const filter = checked ? new FilterClass() : false;\n    applyFilter(index, filter);\n    history.saveState();\n  };\n\n  if (!selectedObject || !selectedObject.isType('image')) {\n    return <div style={{ padding: 10 }}>Select an image to adjust</div>;\n  }\n\n  return (\n    <div style={{ padding: 10, height: '100%', overflowY: 'auto' }}>\n      <Typography.Title level={5}>Adjustments</Typography.Title>\n      <Collapse defaultActiveKey={['1', '2', '3']} ghost>\n        <Panel header=\"Basic\" key=\"1\">\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\n            <div>\n              <Typography.Text>Brightness</Typography.Text>\n              <Slider\n                min={-1}\n                max={1}\n                step={0.01}\n                defaultValue={0}\n                onChange={handleBrightness}\n                onChangeComplete={() => history.saveState()}\n              />\n            </div>\n            <div>\n              <Typography.Text>Contrast</Typography.Text>\n              <Slider\n                min={-1}\n                max={1}\n                step={0.01}\n                defaultValue={0}\n                onChange={handleContrast}\n                onChangeComplete={() => history.saveState()}\n              />\n            </div>\n            <div>\n              <Typography.Text>Saturation</Typography.Text>\n              <Slider\n                min={-1}\n                max={1}\n                step={0.01}\n                defaultValue={0}\n                onChange={handleSaturation}\n                onChangeComplete={() => history.saveState()}\n              />\n            </div>\n            <div>\n              <Typography.Text>Vibrance</Typography.Text>\n              <Slider\n                min={-1}\n                max={1}\n                step={0.01}\n                defaultValue={0}\n                onChange={handleVibrance}\n                onChangeComplete={() => history.saveState()}\n              />\n            </div>\n            <div>\n              <Typography.Text>Gamma</Typography.Text>\n              <Slider\n                min={0.1}\n                max={2.2}\n                step={0.1}\n                defaultValue={1}\n                onChange={handleGamma}\n                onChangeComplete={() => history.saveState()}\n              />\n            </div>\n            <div>\n              <Typography.Text>Hue Rotation</Typography.Text>\n              <Slider\n                min={-1}\n                max={1}\n                step={0.01}\n                defaultValue={0}\n                onChange={handleHueRotation}\n                onChangeComplete={() => history.saveState()}\n              />\n            </div>\n          </Space>\n        </Panel>\n\n        <Panel header=\"Effects\" key=\"2\">\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\n            <div>\n              <Typography.Text>Blur</Typography.Text>\n              <Slider\n                min={0}\n                max={1}\n                step={0.01}\n                defaultValue={0}\n                onChange={handleBlur}\n                onChangeComplete={() => history.saveState()}\n              />\n            </div>\n            <div>\n              <Typography.Text>Noise</Typography.Text>\n              <Slider\n                min={0}\n                max={1000}\n                defaultValue={0}\n                onChange={handleNoise}\n                onChangeComplete={() => history.saveState()}\n              />\n            </div>\n            <div>\n              <Typography.Text>Pixelate</Typography.Text>\n              <Slider\n                min={1}\n                max={20}\n                defaultValue={1}\n                onChange={handlePixelate}\n                onChangeComplete={() => history.saveState()}\n              />\n            </div>\n          </Space>\n        </Panel>\n\n        <Panel header=\"Filters\" key=\"3\">\n          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 12 }}>\n            {FILTER_LIST.map((item) => {\n              const isActive = !!(selectedObject as any)?.filters?.[item.index];\n              return (\n                <FilterPreview\n                  key={item.name}\n                  name={item.name}\n                  filterClass={item.filter}\n                  originalImage={originalImage}\n                  isActive={isActive}\n                  onClick={() => handleToggleFilter(item.index, item.filter, !isActive)}\n                />\n              );\n            })}\n          </div>\n        </Panel>\n      </Collapse>\n    </div>\n  );\n};\n\nexport default AdjustmentPanel;\n","import React, { useEffect, useState, useRef } from 'react';\nimport { ColorPicker, Slider, Typography, Space, Select, InputNumber } from 'antd';\nimport { usePhotoEditor } from '../context';\nimport { PencilBrush, CircleBrush, SprayBrush, Shadow } from 'fabric';\n\nconst BrushPanel: React.FC = () => {\n  const {\n    canvas,\n    brushSize,\n    setBrushSize,\n    brushColor,\n    setBrushColor,\n    brushOpacity,\n    setBrushOpacity,\n  } = usePhotoEditor();\n  const [shadowWidth, setShadowWidth] = useState<number>(0);\n  const [brushType, setBrushType] = useState<string>('Pencil');\n\n  const draggingWidth = useRef(false);\n  const widthStartX = useRef<number | null>(null);\n  const widthStartValue = useRef<number>(brushSize);\n\n  const draggingShadow = useRef(false);\n  const shadowStartX = useRef<number | null>(null);\n  const shadowStartValue = useRef<number>(shadowWidth);\n\n  const draggingOpacity = useRef(false);\n  const opacityStartX = useRef<number | null>(null);\n  const opacityStartValue = useRef<number>(brushOpacity);\n\n  const handleWidthLabelMouseDown = (e: React.MouseEvent) => {\n    if (e.button !== 0) return;\n    e.preventDefault();\n    draggingWidth.current = true;\n    widthStartX.current = e.clientX;\n    widthStartValue.current = brushSize;\n    const prevUserSelect = document.body.style.userSelect;\n    document.body.style.userSelect = 'none';\n\n    const onMouseMove = (ev: MouseEvent) => {\n      if (!draggingWidth.current || widthStartX.current === null) return;\n      const delta = ev.clientX - widthStartX.current;\n      const sensitivity = 0.2; // pixels -> width\n      const newVal = Math.max(1, Math.min(2000, widthStartValue.current + delta * sensitivity));\n      setBrushSize(Number(newVal.toFixed(0)));\n    };\n\n    const onMouseUp = () => {\n      draggingWidth.current = false;\n      widthStartX.current = null;\n      document.body.style.userSelect = prevUserSelect;\n      window.removeEventListener('mousemove', onMouseMove);\n      window.removeEventListener('mouseup', onMouseUp);\n    };\n\n    window.addEventListener('mousemove', onMouseMove);\n    window.addEventListener('mouseup', onMouseUp);\n  };\n\n  const handleShadowLabelMouseDown = (e: React.MouseEvent) => {\n    if (e.button !== 0) return;\n    e.preventDefault();\n    draggingShadow.current = true;\n    shadowStartX.current = e.clientX;\n    shadowStartValue.current = shadowWidth;\n    const prevUserSelect = document.body.style.userSelect;\n    document.body.style.userSelect = 'none';\n\n    const onMouseMove = (ev: MouseEvent) => {\n      if (!draggingShadow.current || shadowStartX.current === null) return;\n      const delta = ev.clientX - shadowStartX.current;\n      const sensitivity = 0.2;\n      const newVal = Math.max(0, Math.min(200, shadowStartValue.current + delta * sensitivity));\n      setShadowWidth(Number(newVal.toFixed(0)));\n    };\n\n    const onMouseUp = () => {\n      draggingShadow.current = false;\n      shadowStartX.current = null;\n      document.body.style.userSelect = prevUserSelect;\n      window.removeEventListener('mousemove', onMouseMove);\n      window.removeEventListener('mouseup', onMouseUp);\n    };\n\n    window.addEventListener('mousemove', onMouseMove);\n    window.addEventListener('mouseup', onMouseUp);\n  };\n\n  const handleOpacityLabelMouseDown = (e: React.MouseEvent) => {\n    if (e.button !== 0) return;\n    e.preventDefault();\n    draggingOpacity.current = true;\n    opacityStartX.current = e.clientX;\n    opacityStartValue.current = brushOpacity;\n    const prevUserSelect = document.body.style.userSelect;\n    document.body.style.userSelect = 'none';\n\n    const onMouseMove = (ev: MouseEvent) => {\n      if (!draggingOpacity.current || opacityStartX.current === null) return;\n      const delta = ev.clientX - opacityStartX.current;\n      const sensitivity = 0.002; // pixels -> opacity\n      const newVal = Math.max(0, Math.min(1, opacityStartValue.current + delta * sensitivity));\n      setBrushOpacity(Number(newVal.toFixed(2)));\n    };\n\n    const onMouseUp = () => {\n      draggingOpacity.current = false;\n      opacityStartX.current = null;\n      document.body.style.userSelect = prevUserSelect;\n      window.removeEventListener('mousemove', onMouseMove);\n      window.removeEventListener('mouseup', onMouseUp);\n    };\n\n    window.addEventListener('mousemove', onMouseMove);\n    window.addEventListener('mouseup', onMouseUp);\n  };\n\n  useEffect(() => {\n    if (!canvas) return;\n\n    // Ensure brush exists\n    if (!canvas.freeDrawingBrush) {\n      canvas.freeDrawingBrush = new PencilBrush(canvas);\n    }\n\n    const brush = canvas.freeDrawingBrush;\n    // Apply opacity to color\n    // Fabric brush color is a string. We need to parse it or use rgba.\n    // Assuming brushColor is hex.\n    // Simple hex to rgba conversion\n    const hex = brushColor.replace('#', '');\n    const r = parseInt(hex.substring(0, 2), 16);\n    const g = parseInt(hex.substring(2, 4), 16);\n    const b = parseInt(hex.substring(4, 6), 16);\n    brush.color = `rgba(${r},${g},${b},${brushOpacity})`;\n    brush.width = brushSize;\n\n    if (shadowWidth > 0) {\n      brush.shadow = new Shadow({ blur: shadowWidth, color: brush.color });\n    } else {\n      brush.shadow = null;\n    }\n  }, [canvas, brushColor, brushSize, shadowWidth, brushOpacity]);\n\n  const handleBrushChange = (type: string) => {\n    if (!canvas) return;\n    setBrushType(type);\n    let brush;\n    switch (type) {\n      case 'Circle':\n        brush = new CircleBrush(canvas);\n        break;\n      case 'Spray':\n        brush = new SprayBrush(canvas);\n        break;\n      case 'Pencil':\n      default:\n        brush = new PencilBrush(canvas);\n        break;\n    }\n    const hex = brushColor.replace('#', '');\n    const r = parseInt(hex.substring(0, 2), 16);\n    const g = parseInt(hex.substring(2, 4), 16);\n    const b = parseInt(hex.substring(4, 6), 16);\n    brush.color = `rgba(${r},${g},${b},${brushOpacity})`;\n    brush.width = brushSize;\n    if (shadowWidth > 0) {\n      brush.shadow = new Shadow({ blur: shadowWidth, color: brush.color });\n    }\n    canvas.freeDrawingBrush = brush;\n  };\n\n  return (\n    <div style={{ padding: 10 }}>\n      <Typography.Title level={5}>Brush Settings</Typography.Title>\n      <Space direction=\"vertical\" style={{ width: '100%' }}>\n        <div>\n          <Typography.Text>Type</Typography.Text>\n          <Select value={brushType} style={{ width: '100%' }} onChange={handleBrushChange}>\n            <Select.Option value=\"Pencil\">Pencil</Select.Option>\n            <Select.Option value=\"Circle\">Circle</Select.Option>\n            <Select.Option value=\"Spray\">Spray</Select.Option>\n          </Select>\n        </div>\n        <div>\n          <Typography.Text>Color</Typography.Text>\n          <br />\n          <ColorPicker\n            value={brushColor}\n            onChange={(c) => setBrushColor(c.toHexString())}\n            showText\n          />\n        </div>\n        <div>\n          <Typography.Text\n            onMouseDown={handleWidthLabelMouseDown}\n            style={{ cursor: 'ew-resize', userSelect: 'none' }}\n          >\n            Width\n          </Typography.Text>\n          <br />\n          <InputNumber\n            min={1}\n            max={2000}\n            value={brushSize}\n            onChange={(v) => setBrushSize(Number(v || 1))}\n            style={{ width: '100%' }}\n          />\n        </div>\n        <div>\n          <Typography.Text\n            onMouseDown={handleOpacityLabelMouseDown}\n            style={{ cursor: 'ew-resize', userSelect: 'none' }}\n          >\n            Opacity\n          </Typography.Text>\n          <br />\n          <InputNumber\n            min={0}\n            max={1}\n            step={0.01}\n            value={brushOpacity}\n            onChange={(v) => setBrushOpacity(Number(v || 1))}\n            style={{ width: '100%' }}\n          />\n        </div>\n        <div>\n          <Typography.Text\n            onMouseDown={handleShadowLabelMouseDown}\n            style={{ cursor: 'ew-resize', userSelect: 'none' }}\n          >\n            Shadow Blur\n          </Typography.Text>\n          <br />\n          <InputNumber\n            min={0}\n            max={500}\n            value={shadowWidth}\n            onChange={(v) => setShadowWidth(Number(v || 0))}\n            style={{ width: '100%' }}\n          />\n        </div>\n      </Space>\n    </div>\n  );\n};\n\nexport default BrushPanel;\n","// This icon file is generated automatically.\nvar BoldOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M697.8 481.4c33.6-35 54.2-82.3 54.2-134.3v-10.2C752 229.3 663.9 142 555.3 142H259.4c-15.1 0-27.4 12.3-27.4 27.4v679.1c0 16.3 13.2 29.5 29.5 29.5h318.7c117 0 211.8-94.2 211.8-210.5v-11c0-73-37.4-137.3-94.2-175.1zM328 238h224.7c57.1 0 103.3 44.4 103.3 99.3v9.5c0 54.8-46.3 99.3-103.3 99.3H328V238zm366.6 429.4c0 62.9-51.7 113.9-115.5 113.9H328V542.7h251.1c63.8 0 115.5 51 115.5 113.9v10.8z\" } }] }, \"name\": \"bold\", \"theme\": \"outlined\" };\nexport default BoldOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport BoldOutlinedSvg from \"@ant-design/icons-svg/es/asn/BoldOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar BoldOutlined = function BoldOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: BoldOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(BoldOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'BoldOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar UnderlineOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M824 804H200c-4.4 0-8 3.4-8 7.6v60.8c0 4.2 3.6 7.6 8 7.6h624c4.4 0 8-3.4 8-7.6v-60.8c0-4.2-3.6-7.6-8-7.6zm-312-76c69.4 0 134.6-27.1 183.8-76.2C745 602.7 772 537.4 772 468V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 97-79 176-176 176s-176-79-176-176V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 69.4 27.1 134.6 76.2 183.8C377.3 701 442.6 728 512 728z\" } }] }, \"name\": \"underline\", \"theme\": \"outlined\" };\nexport default UnderlineOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport UnderlineOutlinedSvg from \"@ant-design/icons-svg/es/asn/UnderlineOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar UnderlineOutlined = function UnderlineOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: UnderlineOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(UnderlineOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'UnderlineOutlined';\n}\nexport default RefIcon;","import React, { useEffect, useState } from 'react';\nimport { Select, InputNumber, Button, Space, Divider, ColorPicker } from 'antd';\nimport {\n  BoldOutlined,\n  ItalicOutlined,\n  UnderlineOutlined,\n  AlignLeftOutlined,\n  AlignCenterOutlined,\n  AlignRightOutlined,\n} from '@ant-design/icons';\nimport { usePhotoEditor } from '../context';\nimport { IText } from 'fabric';\n\nconst fonts = ['Arial', 'Helvetica', 'Times New Roman', 'Georgia', 'Courier New', 'Verdana'];\n\nconst TextStylePanel: React.FC = () => {\n  const { canvas, selectedObject, history, setActiveTool } = usePhotoEditor();\n  const [fontFamily, setFontFamily] = useState<string>('Arial');\n  const [fontSize, setFontSize] = useState<number>(24);\n  const [bold, setBold] = useState<boolean>(false);\n  const [italic, setItalic] = useState<boolean>(false);\n  const [underline, setUnderline] = useState<boolean>(false);\n  const [align, setAlign] = useState<'left' | 'center' | 'right'>('left');\n  const [color, setColor] = useState<string>('#000000');\n\n  useEffect(() => {\n    if (selectedObject && (selectedObject as any).isType === 'i-text') {\n      const txt = selectedObject as IText;\n      setFontFamily((txt.fontFamily as string) || 'Arial');\n      setFontSize((txt.fontSize as number) || 24);\n      setBold(txt.fontWeight === 'bold' || txt.fontWeight === 700);\n      setItalic(txt.fontStyle === 'italic');\n      setUnderline((txt.underline as boolean) || false);\n      setAlign((txt.textAlign as any) || 'left');\n      setColor((txt.fill as string) || '#000000');\n    }\n  }, [selectedObject]);\n\n  const apply = (patch: Record<string, any>, save = true) => {\n    if (!selectedObject) return;\n    selectedObject.set(patch);\n    selectedObject.setCoords && selectedObject.setCoords();\n    canvas && canvas.requestRenderAll();\n    if (save && history) history.saveState();\n  };\n\n  const getFirstLayerRect = () => {\n    if (!canvas) return null;\n    const objs = canvas.getObjects();\n    if (!objs || objs.length === 0) return null;\n    const first = objs[0];\n    try {\n      return first.getBoundingRect();\n    } catch (e) {\n      return null;\n    }\n  };\n\n  const alignHorizontalToFirst = (mode: 'left' | 'center' | 'right') => {\n    if (!canvas || !selectedObject) return;\n    const target = getFirstLayerRect();\n    if (!target) return;\n    const objRect = selectedObject.getBoundingRect();\n\n    let left = selectedObject.left || 0;\n    if (mode === 'left') {\n      left = target.left;\n    } else if (mode === 'center') {\n      left = target.left + (target.width - objRect.width) / 2;\n    } else if (mode === 'right') {\n      left = target.left + target.width - objRect.width;\n    }\n\n    apply({ left }, true);\n  };\n\n  const alignVerticalToFirst = (mode: 'top' | 'middle' | 'bottom') => {\n    if (!canvas || !selectedObject) return;\n    const target = getFirstLayerRect();\n    if (!target) return;\n    const objRect = selectedObject.getBoundingRect();\n\n    let top = selectedObject.top || 0;\n    if (mode === 'top') {\n      top = target.top;\n    } else if (mode === 'middle') {\n      top = target.top + (target.height - objRect.height) / 2;\n    } else if (mode === 'bottom') {\n      top = target.top + target.height - objRect.height;\n    }\n\n    apply({ top }, true);\n  };\n\n  return (\n    <div style={{ padding: 12 }}>\n      <div style={{ marginBottom: 8 }}>\n        <strong>Font</strong>\n      </div>\n\n      <Space direction=\"vertical\" style={{ width: '100%' }}>\n        <Select\n          value={fontFamily}\n          onChange={(v) => {\n            setFontFamily(v);\n            apply({ fontFamily: v });\n          }}\n          style={{ width: '100%' }}\n        >\n          {fonts.map((f) => (\n            <Select.Option key={f} value={f}>\n              {f}\n            </Select.Option>\n          ))}\n        </Select>\n\n        <InputNumber\n          min={8}\n          max={200}\n          value={fontSize}\n          onChange={(v) => {\n            setFontSize(v || 24);\n            apply({ fontSize: v || 24 });\n          }}\n          style={{ width: '100%' }}\n        />\n\n        <div>\n          <Space>\n            <Button\n              icon={<BoldOutlined />}\n              type={bold ? 'primary' : 'default'}\n              onClick={() => {\n                const newVal = !bold;\n                setBold(newVal);\n                apply({ fontWeight: newVal ? 'bold' : 'normal' });\n              }}\n            />\n            <Button\n              icon={<ItalicOutlined />}\n              type={italic ? 'primary' : 'default'}\n              onClick={() => {\n                const newVal = !italic;\n                setItalic(newVal);\n                apply({ fontStyle: newVal ? 'italic' : 'normal' });\n              }}\n            />\n            <Button\n              icon={<UnderlineOutlined />}\n              type={underline ? 'primary' : 'default'}\n              onClick={() => {\n                const newVal = !underline;\n                setUnderline(newVal);\n                apply({ underline: newVal });\n              }}\n            />\n          </Space>\n        </div>\n\n        <Divider />\n\n        <div>\n          <strong>Horizontal Align (textAlign)</strong>\n          <div style={{ marginTop: 8 }}>\n            <Space>\n              <Button\n                icon={<AlignLeftOutlined />}\n                type={align === 'left' ? 'primary' : 'default'}\n                onClick={() => {\n                  setAlign('left');\n                  apply({ textAlign: 'left' });\n                }}\n              />\n              <Button\n                icon={<AlignCenterOutlined />}\n                type={align === 'center' ? 'primary' : 'default'}\n                onClick={() => {\n                  setAlign('center');\n                  apply({ textAlign: 'center' });\n                }}\n              />\n              <Button\n                icon={<AlignRightOutlined />}\n                type={align === 'right' ? 'primary' : 'default'}\n                onClick={() => {\n                  setAlign('right');\n                  apply({ textAlign: 'right' });\n                }}\n              />\n            </Space>\n          </div>\n        </div>\n\n        <Divider />\n\n        <div>\n          <strong>Color</strong>\n          <div style={{ marginTop: 8 }}>\n            <ColorPicker\n              value={color}\n              onChange={(c) => {\n                const hex = c.toHexString();\n                setColor(hex);\n                apply({ fill: hex });\n                // if user is currently editing the text, ensure text tool stays active\n                try {\n                  if ((selectedObject as any)?.isEditing) {\n                    setActiveTool && setActiveTool('text');\n                  }\n                } catch (e) {\n                  // ignore\n                }\n              }}\n              showText\n            />\n          </div>\n        </div>\n      </Space>\n    </div>\n  );\n};\n\nexport default TextStylePanel;\n","import React from 'react';\nimport { Button, Space } from 'antd';\nimport { usePhotoEditor } from '../context';\n\nconst AlignControls: React.FC = () => {\n  const { canvas, selectedObject, history } = usePhotoEditor();\n\n  const getFirstLayerRect = () => {\n    if (!canvas) return null;\n    const objs = canvas.getObjects();\n    if (!objs || objs.length === 0) return null;\n    const first = objs[0];\n    try {\n      return first.getBoundingRect();\n    } catch (e) {\n      return null;\n    }\n  };\n\n  const apply = (patch: Record<string, any>) => {\n    if (!selectedObject) return;\n    selectedObject.set(patch);\n    selectedObject.setCoords && selectedObject.setCoords();\n    canvas && canvas.requestRenderAll();\n    if (history) history.saveState();\n  };\n\n  const alignHorizontalToFirst = (mode: 'left' | 'center' | 'right') => {\n    if (!canvas || !selectedObject) return;\n    const target = getFirstLayerRect();\n    if (!target) return;\n    const objRect = selectedObject.getBoundingRect();\n\n    let left = selectedObject.left || 0;\n    if (mode === 'left') {\n      left = target.left;\n    } else if (mode === 'center') {\n      left = target.left + (target.width - objRect.width) / 2;\n    } else if (mode === 'right') {\n      left = target.left + target.width - objRect.width;\n    }\n\n    apply({ left });\n  };\n\n  const alignVerticalToFirst = (mode: 'top' | 'middle' | 'bottom') => {\n    if (!canvas || !selectedObject) return;\n    const target = getFirstLayerRect();\n    if (!target) return;\n    const objRect = selectedObject.getBoundingRect();\n\n    let top = selectedObject.top || 0;\n    if (mode === 'top') {\n      top = target.top;\n    } else if (mode === 'middle') {\n      top = target.top + (target.height - objRect.height) / 2;\n    } else if (mode === 'bottom') {\n      top = target.top + target.height - objRect.height;\n    }\n\n    apply({ top });\n  };\n\n  return (\n    <div style={{ padding: 12 }}>\n      <div style={{ marginBottom: 6 }}>\n        <strong>Align to First Layer</strong>\n      </div>\n      <div style={{ marginBottom: 8 }}>\n        <Space>\n          <Button onClick={() => alignHorizontalToFirst('left')}>H: Left</Button>\n          <Button onClick={() => alignHorizontalToFirst('center')}>H: Center</Button>\n          <Button onClick={() => alignHorizontalToFirst('right')}>H: Right</Button>\n        </Space>\n      </div>\n      <div>\n        <Space>\n          <Button onClick={() => alignVerticalToFirst('top')}>V: Top</Button>\n          <Button onClick={() => alignVerticalToFirst('middle')}>V: Middle</Button>\n          <Button onClick={() => alignVerticalToFirst('bottom')}>V: Bottom</Button>\n        </Space>\n      </div>\n    </div>\n  );\n};\n\nexport default AlignControls;\n","import React from 'react';\nimport { ColorPicker, Slider, InputNumber, Typography, Space, Row, Col } from 'antd';\nimport { usePhotoEditor } from '../context';\nimport { FabricObject } from 'fabric';\n\nconst { Title, Text } = Typography;\n\nconst LayerStylePanel: React.FC = () => {\n  const { canvas, selectedObject, history } = usePhotoEditor();\n\n  if (!selectedObject || !canvas) return null;\n\n  // Helper to update object properties\n  const updateProperty = (key: keyof FabricObject, value: any) => {\n    selectedObject.set(key, value);\n    canvas.requestRenderAll();\n    history.saveState();\n  };\n\n  const strokeWidth = selectedObject.strokeWidth || 0;\n  const strokeColor = selectedObject.stroke || '#000000';\n  const fillColor = selectedObject.fill || 'transparent';\n\n  return (\n    <div style={{ padding: 16 }}>\n      <Title level={5}>Layer Style</Title>\n\n      <Space direction=\"vertical\" style={{ width: '100%' }} size=\"middle\">\n        {/* Fill Color */}\n        <div>\n          <Text strong>Fill Color</Text>\n          <div style={{ marginTop: 8 }}>\n            <ColorPicker\n              value={fillColor as string}\n              onChange={(color) => updateProperty('fill', color.toHexString())}\n              showText\n            />\n          </div>\n        </div>\n\n        {/* Border (Stroke) Color */}\n        <div>\n          <Text strong>Border Color</Text>\n          <div style={{ marginTop: 8 }}>\n            <ColorPicker\n              value={strokeColor as string}\n              onChange={(color) => updateProperty('stroke', color.toHexString())}\n              showText\n            />\n          </div>\n        </div>\n\n        {/* Border Thickness */}\n        <div>\n          <Text strong>Border Thickness</Text>\n          <Row gutter={16} align=\"middle\">\n            <Col span={16}>\n              <Slider\n                min={0}\n                max={50}\n                value={strokeWidth}\n                onChange={(val) => updateProperty('strokeWidth', val)}\n              />\n            </Col>\n            <Col span={8}>\n              <InputNumber\n                min={0}\n                max={50}\n                value={strokeWidth}\n                onChange={(val) => updateProperty('strokeWidth', Number(val))}\n                style={{ width: '100%' }}\n              />\n            </Col>\n          </Row>\n        </div>\n      </Space>\n    </div>\n  );\n};\n\nexport default LayerStylePanel;\n","import React from 'react';\nimport { usePhotoEditor } from '../context';\nimport AdjustmentPanel from './AdjustmentPanel';\nimport BrushPanel from './BrushPanel';\nimport TextStylePanel from './TextStylePanel';\nimport AlignControls from './AlignControls';\nimport LayerStylePanel from './LayerStylePanel';\nimport { FabricImage } from 'fabric';\n\nconst PropertiesPanel: React.FC = () => {\n  const { activeTool, selectedObject } = usePhotoEditor();\n\n  if (activeTool === 'brush') return <BrushPanel />;\n\n  if (activeTool === 'text') return <TextStylePanel />;\n\n  // if a text object is selected, show text panel too\n  if (selectedObject && (selectedObject.type === 'i-text' || selectedObject.type === 'text'))\n    return (\n      <>\n        <TextStylePanel />\n        <LayerStylePanel />\n        <AlignControls />\n      </>\n    );\n\n  if (selectedObject) {\n    const isImage = selectedObject instanceof FabricImage || selectedObject.type === 'image';\n\n    return (\n      <>\n        {isImage ? <AdjustmentPanel /> : <LayerStylePanel />}\n        <AlignControls />\n      </>\n    );\n  }\n\n  return <AdjustmentPanel />;\n};\n\nexport default PropertiesPanel;\n","import React from 'react';\nimport { Upload } from 'antd';\nimport { InboxOutlined } from '@ant-design/icons';\n\ninterface UploadAreaProps {\n  onUpload: (file: File) => boolean | void;\n}\n\nconst UploadArea: React.FC<UploadAreaProps> = ({ onUpload }) => {\n  return (\n    <Upload.Dragger\n      beforeUpload={onUpload}\n      showUploadList={false}\n      accept=\".png,.jpg,.jpeg\"\n      height={200}\n    >\n      <p className=\"ant-upload-drag-icon\">\n        <InboxOutlined />\n      </p>\n      <p className=\"ant-upload-text\">Click or drag file to this area to upload</p>\n      <p className=\"ant-upload-hint\">\n        Support for a single upload. You can also paste an image from clipboard.\n      </p>\n    </Upload.Dragger>\n  );\n};\n\nexport default UploadArea;\n","import { useState, useEffect, useRef, useCallback } from 'react';\nimport { message } from 'antd';\nimport { SavedProject } from '../types';\n\nexport const useImageUpload = () => {\n  const [preview, setPreview] = useState<string | null>(null);\n  const [initialProject, setInitialProject] = useState<SavedProject | null>(null);\n  const [addOnFile, setAddOnFile] = useState<File | null>(null);\n  const [dragging, setDragging] = useState(false);\n  const dragCounter = useRef(0);\n\n  const handleUpload = useCallback(\n    (file: File) => {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        if (preview) {\n          setAddOnFile(file);\n        } else {\n          setPreview(e.target?.result as string);\n          setInitialProject(null);\n        }\n      };\n      reader.readAsDataURL(file);\n      setDragging(false);\n      dragCounter.current = 0;\n      return false;\n    },\n    [preview],\n  );\n\n  const loadProject = useCallback((project: SavedProject) => {\n    setInitialProject(project);\n    setPreview(project.thumbnail);\n  }, []);\n\n  const handleClear = useCallback(() => {\n    setPreview(null);\n    setAddOnFile(null);\n    setInitialProject(null);\n    message.info('Image cleared.');\n  }, []);\n\n  // --- Clipboard paste support ---\n  useEffect(() => {\n    const handlePaste = (e: ClipboardEvent) => {\n      const items = e.clipboardData?.items;\n      if (!items) return;\n\n      const imageItem = Array.from(items).find((item) => item.type.includes('image'));\n      if (imageItem) {\n        const blob = imageItem.getAsFile();\n        if (blob) {\n          handleUpload(blob);\n          message.success('Image pasted from clipboard!');\n          e.preventDefault();\n        }\n      }\n    };\n\n    window.addEventListener('paste', handlePaste);\n    return () => window.removeEventListener('paste', handlePaste);\n  }, [handleUpload]);\n\n  return {\n    preview,\n    setPreview, // Exposed if needed\n    addOnFile,\n    setAddOnFile,\n    dragging,\n    setDragging,\n    dragCounter,\n    handleUpload,\n    handleClear,\n    loadProject,\n    initialProject,\n  };\n};\n","\nimport \"/home/thanhnd/Downloads/code/ultimate-tool-web/src/pages/PhotoEditor/styles.less?modules\";\nexport default {\"custom-slider\": `custom-slider-Mtw5UrX6`,\"propertiesSider\": `propertiesSider-YRVduwgD`,\"custom-label\": `custom-label-NFSO-Wb-`,\"ant-slider-track\": `ant-slider-track-mNuiqDPT`,\"ant-slider-handle\": `ant-slider-handle-sktsRzub`,\"custom-number\": `custom-number-IhimQewC`,\"ant-slider-step\": `ant-slider-step-ePYg7d2c`,\"canvasContent\": `canvasContent-Lj9buPhs`,\"panelHeader\": `panelHeader-hIGLou-U`,\"toolButton\": `toolButton-n4oL9CVE`,\"custom-slider-container\": `custom-slider-container-6zxbttWw`,\"active\": `active-U2nrVjVN`,\"ant-slider-rail\": `ant-slider-rail-b52f3nt3`,\"layerItem\": `layerItem-T1HNTXOA`,\"toolbarSider\": `toolbarSider-ECMIrGgY`,\"panelContent\": `panelContent-S7N1Mu8e`,\"editorContainer\": `editorContainer-SPg3koCD`,\"ant-input-number\": `ant-input-number-MEirfgGR`,\"ant-input-number-input\": `ant-input-number-input-tD-LgqKy`}\n","import React from 'react';\nimport { PageContainer } from '@ant-design/pro-components';\nimport { Card, Layout, Tag, Divider } from 'antd';\nimport DragDropWrapper from '@/components/DragDropWrapper';\nimport DragOverlay from '@/components/DragOverlay';\nimport { PhotoEditorProvider } from './context';\nimport Toolbar from './components/Toolbar';\nimport CanvasArea from './components/CanvasArea';\nimport LayersPanel from './components/LayersPanel';\nimport PropertiesPanel from './components/PropertiesPanel';\nimport UploadArea from './components/UploadArea';\nimport SavedProjectsList from './components/SavedProjectsList';\nimport { useImageUpload } from './hooks/useImageUpload';\nimport { useProjects } from './hooks/useProjects';\nimport styles from './styles.less';\nimport './styles.less';\n\nconst { Sider, Content } = Layout;\n\nconst PhotoEditor: React.FC = () => {\n  const {\n    preview,\n    dragging,\n    setDragging,\n    dragCounter,\n    handleUpload,\n    addOnFile,\n    setAddOnFile,\n    loadProject,\n    initialProject,\n  } = useImageUpload();\n\n  const { savedProjects, deleteProject } = useProjects();\n\n  return (\n    <PageContainer\n      title={\n        <span>\n          Photo Editor <Tag color=\"cyan\">Beta</Tag>\n        </span>\n      }\n    >\n      <DragDropWrapper\n        setDragging={setDragging}\n        dragCounter={dragCounter}\n        handleUpload={handleUpload}\n      >\n        <Card className={styles.editorContainer} bodyStyle={{ padding: 0, height: '100%' }}>\n          {dragging && <DragOverlay />}\n\n          {!preview ? (\n            <div\n              style={{\n                display: 'flex',\n                flexDirection: 'column',\n                justifyContent: 'center',\n                alignItems: 'center',\n                height: '100%',\n                padding: '20px',\n                overflowY: 'auto',\n              }}\n            >\n              <UploadArea onUpload={handleUpload} />\n              {savedProjects.length > 0 && (\n                <div style={{ width: '100%', maxWidth: '800px', marginTop: '40px' }}>\n                  <Divider>Or Open Saved Project</Divider>\n                  <SavedProjectsList\n                    projects={savedProjects}\n                    onLoad={loadProject}\n                    onDelete={deleteProject}\n                  />\n                </div>\n              )}\n            </div>\n          ) : (\n            <PhotoEditorProvider\n              imageUrl={preview}\n              initialProject={initialProject}\n              addOnFile={addOnFile}\n              setAddOnFile={setAddOnFile}\n            >\n              <Layout style={{ height: '100%' }}>\n                <Sider theme=\"light\" width={60} className={styles.toolbarSider}>\n                  <Toolbar />\n                </Sider>\n                <Content className={styles.canvasContent}>\n                  <CanvasArea />\n                </Content>\n                <Sider theme=\"light\" width={300} className={styles.propertiesSider}>\n                  <PropertiesPanel />\n                  <LayersPanel />\n                </Sider>\n              </Layout>\n            </PhotoEditorProvider>\n          )}\n        </Card>\n      </DragDropWrapper>\n    </PageContainer>\n  );\n};\n\nexport default PhotoEditor;\n","import { useState, useCallback, useEffect } from 'react';\nimport { Canvas } from 'fabric';\n\nexport const useHistory = (canvas: Canvas | null) => {\n  const [history, setHistory] = useState<string[]>([]);\n  const [historyIndex, setHistoryIndex] = useState<number>(-1);\n  const [isHistoryProcessing, setIsHistoryProcessing] = useState<boolean>(false);\n\n  const saveState = useCallback(() => {\n    if (!canvas || isHistoryProcessing) return;\n\n    const json = JSON.stringify(canvas.toJSON());\n\n    // Avoid saving duplicate states\n    if (history.length > 0 && historyIndex >= 0 && history[historyIndex] === json) {\n      return;\n    }\n\n    // If we are in the middle of the history, discard the future\n    const newHistory = history.slice(0, historyIndex + 1);\n    newHistory.push(json);\n\n    // Limit history size if needed (e.g., 50)\n    if (newHistory.length > 50) {\n      newHistory.shift();\n    }\n\n    setHistory(newHistory);\n    setHistoryIndex(newHistory.length - 1);\n  }, [canvas, history, historyIndex, isHistoryProcessing]);\n\n  useEffect(() => {\n    if (!canvas) return;\n\n    const handleSave = () => {\n      saveState();\n    };\n\n    canvas.on('object:modified', handleSave);\n    canvas.on('object:added', handleSave);\n    canvas.on('object:removed', handleSave);\n    canvas.on('path:created', handleSave);\n\n    return () => {\n      canvas.off('object:modified', handleSave);\n      canvas.off('object:added', handleSave);\n      canvas.off('object:removed', handleSave);\n      canvas.off('path:created', handleSave);\n    };\n  }, [canvas, saveState]);\n\n  const undo = useCallback(() => {\n    if (!canvas || historyIndex <= 0 || isHistoryProcessing) return;\n\n    setIsHistoryProcessing(true);\n    const newIndex = historyIndex - 1;\n    const json = history[newIndex];\n\n    canvas.loadFromJSON(JSON.parse(json)).then(() => {\n      canvas.renderAll();\n      setHistoryIndex(newIndex);\n      setIsHistoryProcessing(false);\n    });\n  }, [canvas, history, historyIndex, isHistoryProcessing]);\n\n  const redo = useCallback(() => {\n    if (!canvas || historyIndex >= history.length - 1 || isHistoryProcessing) return;\n\n    setIsHistoryProcessing(true);\n    const newIndex = historyIndex + 1;\n    const json = history[newIndex];\n\n    canvas.loadFromJSON(JSON.parse(json)).then(() => {\n      canvas.renderAll();\n      setHistoryIndex(newIndex);\n      setIsHistoryProcessing(false);\n    });\n  }, [canvas, history, historyIndex, isHistoryProcessing]);\n\n  return {\n    saveState,\n    undo,\n    redo,\n    canUndo: historyIndex > 0,\n    canRedo: historyIndex < history.length - 1,\n  };\n};\n","import React, { createContext, useContext, useState } from 'react';\nimport { Canvas, FabricObject } from 'fabric';\nimport { useHistory } from './hooks/useHistory';\n\ninterface PhotoEditorContextType {\n  canvas: Canvas | null;\n  setCanvas: (canvas: Canvas) => void;\n  activeTool: string;\n  setActiveTool: (tool: string) => void;\n  selectedObject: FabricObject | null;\n  setSelectedObject: (object: FabricObject | null) => void;\n  history: {\n    saveState: () => void;\n    undo: () => void;\n    redo: () => void;\n    canUndo: boolean;\n    canRedo: boolean;\n  };\n  clipboard: FabricObject | null;\n  setClipboard: (object: FabricObject | null) => void;\n  imageUrl?: string | null;\n  initialProject?: any;\n  addOnFile?: File | null;\n  setAddOnFile?: (file: File | null) => void;\n  brushSize: number;\n  setBrushSize: (size: number) => void;\n  brushColor: string;\n  setBrushColor: (color: string) => void;\n  brushOpacity: number;\n  setBrushOpacity: (opacity: number) => void;\n}\n\nconst PhotoEditorContext = createContext<PhotoEditorContextType | undefined>(undefined);\n\nexport const PhotoEditorProvider: React.FC<{\n  children: React.ReactNode;\n  imageUrl?: string | null;\n  initialProject?: any;\n  addOnFile?: File | null;\n  setAddOnFile?: (file: File | null) => void;\n}> = ({ children, imageUrl, initialProject, addOnFile, setAddOnFile }) => {\n  const [canvas, setCanvas] = useState<Canvas | null>(null);\n  const [activeTool, setActiveTool] = useState<string>('select');\n  const [selectedObject, setSelectedObject] = useState<FabricObject | null>(null);\n  const [clipboard, setClipboard] = useState<FabricObject | null>(null);\n  const [brushSize, setBrushSize] = useState<number>(5);\n  const [brushColor, setBrushColor] = useState<string>('#000000');\n  const [brushOpacity, setBrushOpacity] = useState<number>(1);\n\n  const history = useHistory(canvas);\n\n  return (\n    <PhotoEditorContext.Provider\n      value={{\n        canvas,\n        setCanvas,\n        activeTool,\n        setActiveTool,\n        selectedObject,\n        setSelectedObject,\n        history,\n        clipboard,\n        setClipboard,\n        imageUrl,\n        initialProject,\n        addOnFile,\n        setAddOnFile,\n        brushSize,\n        setBrushSize,\n        brushColor,\n        setBrushColor,\n        brushOpacity,\n        setBrushOpacity,\n      }}\n    >\n      {children}\n    </PhotoEditorContext.Provider>\n  );\n};\nexport const usePhotoEditor = () => {\n  const context = useContext(PhotoEditorContext);\n  if (!context) {\n    throw new Error('usePhotoEditor must be used within a PhotoEditorProvider');\n  }\n  return context;\n};\n"],"names":[],"mappings":"uuBACI,EAAqB,CAAE,KAAQ,CAAE,IAAO,MAAO,MAAS,CAAE,QAAW,gBAAiB,UAAa,OAAQ,EAAG,SAAY,CAAC,CAAE,IAAO,OAAQ,MAAS,CAAE,EAAK,2LAA4L,CAAE,EAAG,CAAE,IAAO,OAAQ,MAAS,CAAE,EAAK,+KAAgL,CAAE,EAAE,AAAC,EAAG,KAAQ,cAAe,MAAS,UAAW,2BCWjmB,EAAuB,EAAM,UAAU,CANlB,SAA4B,CAAK,CAAE,CAAG,EAC7D,OAAoB,EAAM,aAAa,CAAC,SAAQ,CAAE,GAAA,SAAa,EAAC,GAAA,SAAa,EAAC,CAAC,EAAG,GAAQ,CAAC,EAAG,CAC5F,IAAK,EACL,KAAM,CACR,IACF,iUCCI,GAAuB,EAAM,UAAU,CANlB,SAA4B,CAAK,CAAE,CAAG,EAC7D,OAAoB,EAAM,aAAa,CAAC,SAAQ,CAAE,GAAA,SAAa,EAAC,GAAA,SAAa,EAAC,CAAC,EAAG,GAAQ,CAAC,EAAG,CAC5F,IAAK,EACL,KAAM,UAAqB,AAC7B,IACF,GCVI,GAAe,CAAE,KAAQ,CAAE,IAAO,MAAO,MAAS,CAAE,QAAW,gBAAiB,UAAa,OAAQ,EAAG,SAAY,CAAC,CAAE,IAAO,OAAQ,MAAS,CAAE,EAAK,4HAA6H,CAAE,EAAE,AAAC,EAAG,KAAQ,OAAQ,MAAS,UAAW,ECW/T,GAAuB,EAAM,UAAU,CANxB,SAAsB,CAAK,CAAE,CAAG,EACjD,OAAoB,EAAM,aAAa,CAAC,SAAQ,CAAE,GAAA,SAAa,EAAC,GAAA,SAAa,EAAC,CAAC,EAAG,GAAQ,CAAC,EAAG,CAC5F,IAAK,EACL,KAAM,EACR,IACF,GCVI,GAAsB,CAAE,KAAQ,CAAE,IAAO,MAAO,MAAS,CAAE,QAAW,gBAAiB,UAAa,OAAQ,EAAG,SAAY,CAAC,CAAE,IAAO,OAAQ,MAAS,CAAC,EAAG,SAAY,CAAC,CAAE,IAAO,QAAS,MAAS,CAAC,CAAE,EAAE,AAAC,EAAG,CAAE,IAAO,OAAQ,MAAS,CAAE,EAAK,ujBAAwjB,CAAE,EAAE,AAAC,EAAG,KAAQ,eAAgB,MAAS,UAAW,ECWx1B,GAAuB,EAAM,UAAU,CANjB,SAA6B,CAAK,CAAE,CAAG,EAC/D,OAAoB,EAAM,aAAa,CAAC,SAAQ,CAAE,GAAA,SAAa,EAAC,GAAA,SAAa,EAAC,CAAC,EAAG,GAAQ,CAAC,EAAG,CAC5F,IAAK,EACL,KAAM,EACR,IACF,+BCVI,GAAsB,CAAE,KAAQ,CAAE,IAAO,MAAO,MAAS,CAAE,QAAW,gBAAiB,UAAa,OAAQ,EAAG,SAAY,CAAC,CAAE,IAAO,OAAQ,MAAS,CAAE,EAAK,4jBAA6jB,CAAE,EAAE,AAAC,EAAG,KAAQ,eAAgB,MAAS,UAAW,ECW9wB,GAAuB,EAAM,UAAU,CANjB,SAA6B,CAAK,CAAE,CAAG,EAC/D,OAAoB,EAAM,aAAa,CAAC,SAAQ,CAAE,GAAA,SAAa,EAAC,GAAA,SAAa,EAAC,CAAC,EAAG,GAAQ,CAAC,EAAG,CAC5F,IAAK,EACL,KAAM,EACR,IACF,4LCDA,IAAM,GAA0C,CAAC,CAAE,QAAA,CAAO,CAAE,SAAA,CAAQ,CAAE,OAAA,CAAM,CAAE,IAC5E,GAAM,CAAC,EAAQ,EAAU,CAAG,GAAA,UAAQ,EAAkC,OAChE,CAAC,EAAS,EAAW,CAAG,GAAA,UAAQ,EAAS,GACzC,CAAC,EAAY,EAAc,CAAG,GAAA,UAAQ,EAAS,GAC/C,CAAC,EAAgB,EAAkB,CAAG,GAAA,UAAQ,EAAU,CAAA,GA0ExD,EAAe,CAAC,EAAY,KAChC,IAAM,EAAO,SAAS,aAAa,CAAC,KACpC,EAAK,IAAI,CAAG,IAAI,eAAe,CAAC,GAChC,EAAK,QAAQ,CAAG,EAChB,SAAS,IAAI,CAAC,WAAW,CAAC,GAC1B,EAAK,KAAK,GACV,SAAS,IAAI,CAAC,WAAW,CAAC,GAC5B,EAEA,MACE,UAAC,UAAK,EACJ,MAAM,eACN,KAAM,EACN,SAAU,EACV,OAAQ,CACN,UAAC,SAAM,EAAc,QAAS,WAAU,UAA5B,UAGZ,UAAC,SAAM,EAAc,KAAK,UAAU,QA1FrB,KACnB,GAAK,GAEL,GAAI,AAAW,SAAX,EAGF,EADa,IAAI,KAAK,CAAC,KAAK,SAAS,CADxB,EAAO,MAAM,IACkB,CAAE,CAAE,KAAM,kBAAmB,GACtD,qBACd,GAAI,AAAW,QAAX,EAGT,EADa,IAAI,KAAK,CADV,EAAO,KAAK,GACG,CAAE,CAAE,KAAM,eAAgB,GAClC,iBACd,CACL,IAAI,EAAe,CACjB,OAAA,EACA,QAAA,EACA,WAAA,CACF,EAEI,EAA4B,KAC5B,EAA4B,KAEhC,GAAI,EAAgB,CAClB,IAAM,EAAU,EAAO,UAAU,GACjC,GAAI,EAAQ,MAAM,CAAG,EAAG,CACtB,IAAI,EAAO,IACP,EAAO,IACP,EAAO,CAAC,IACR,EAAO,CAAC,IAEZ,EAAQ,OAAO,CAAC,AAAC,IACf,IAAM,EAAQ,EAAI,eAAe,GAC7B,EAAM,IAAI,CAAG,GAAM,CAAA,EAAO,EAAM,IAAI,AAAD,EACnC,EAAM,GAAG,CAAG,GAAM,CAAA,EAAO,EAAM,GAAG,AAAD,EACjC,EAAM,IAAI,CAAG,EAAM,KAAK,CAAG,GAAM,CAAA,EAAO,EAAM,IAAI,CAAG,EAAM,KAAK,AAAD,EAC/D,EAAM,GAAG,CAAG,EAAM,MAAM,CAAG,GAAM,CAAA,EAAO,EAAM,GAAG,CAAG,EAAM,MAAM,AAAD,EACrE,GAEA,EAAU,CACR,GAAG,CAAO,CACV,KAAM,EACN,IAAK,EACL,MAAO,EAAO,EACd,OAAQ,EAAO,CACjB,EAGA,EAAuB,EAAO,eAAe,CAC7C,EAAuB,EAAO,eAAe,CAC7C,EAAO,eAAe,CAAG,KACzB,EAAO,eAAe,CAAG,KAC3B,CACF,CAEA,IAAM,EAAU,EAAO,SAAS,CAAC,GAG7B,IACF,EAAO,eAAe,CAAG,EACzB,EAAO,eAAe,CAAG,GAG3B,IAAM,EAAO,SAAS,aAAa,CAAC,KACpC,EAAK,QAAQ,CAAG,CAAC,MAAM,EAAE,EAAO,CAAC,CACjC,EAAK,IAAI,CAAG,EACZ,SAAS,IAAI,CAAC,WAAW,CAAC,GAC1B,EAAK,KAAK,GACV,SAAS,IAAI,CAAC,WAAW,CAAC,GAC5B,CACA,UAAO,CAAC,OAAO,CAAC,qBAChB,KACF,WAoBiE,UAA/C,UAGb,UAED,WAAC,UAAI,EAAC,OAAO,qBACX,UAAC,UAAI,CAAC,IAAI,EAAC,MAAM,kBACf,WAAC,UAAM,EAAC,MAAO,EAAQ,SAAU,AAAC,GAAM,EAAU,aAChD,UAAC,UAAM,CAAC,MAAM,EAAC,MAAM,eAAM,QAC3B,UAAC,UAAM,CAAC,MAAM,EAAC,MAAM,gBAAO,SAC5B,UAAC,UAAM,CAAC,MAAM,EAAC,MAAM,eAAM,QAC3B,UAAC,UAAM,CAAC,MAAM,EAAC,MAAM,gBAAO,wBAG/B,AAAW,SAAX,GAAqB,AAAW,QAAX,GACpB,iCACE,UAAC,UAAI,CAAC,IAAI,EAAC,MAAM,6BACf,UAAC,UAAW,EACV,IAAK,GACL,IAAK,EACL,KAAM,GACN,MAAO,EACP,SAAU,AAAC,GAAM,EAAW,GAAK,GACjC,MAAO,CAAE,MAAO,MAAO,MAG3B,UAAC,UAAI,CAAC,IAAI,EAAC,MAAM,8BACf,UAAC,UAAW,EACV,IAAK,GACL,IAAK,EACL,KAAM,GACN,MAAO,EACP,SAAU,AAAC,GAAM,EAAc,GAAK,GACpC,MAAO,CAAE,MAAO,MAAO,MAG3B,UAAC,UAAI,CAAC,IAAI,WACR,UAAC,UAAQ,EACP,QAAS,EACT,SAAU,AAAC,GAAM,EAAkB,EAAE,MAAM,CAAC,OAAO,WACpD,oDASf,0FCnJO,IAAM,GAAkB,CAC7B,EACA,EACA,KAEA,GAAI,AAAkB,IAAlB,EAAO,MAAM,EAoBjB,GAlBA,EAAI,IAAI,GACR,EAAI,WAAW,CAAG,EAAS,OAAO,CAAG,EAAS,IAAI,CAE9C,AAAkB,SAAlB,EAAS,IAAI,EACf,EAAI,WAAW,CAAG,EAAS,KAAK,CAChC,EAAI,UAAU,CAAG,AAAqB,GAArB,EAAS,SAAS,CACnC,EAAI,SAAS,CAAG,AAAqB,GAArB,EAAS,SAAS,GAElC,EAAI,UAAU,CAAG,EACjB,EAAI,SAAS,CAAG,EAAS,SAAS,EAGpC,EAAI,WAAW,CAAG,EAAS,KAAK,CAChC,EAAI,SAAS,CAAG,EAAS,KAAK,CAC9B,EAAI,OAAO,CAAG,QACd,EAAI,QAAQ,CAAG,QAEf,EAAI,SAAS,GACT,AAAkB,IAAlB,EAAO,MAAM,CACf,EAAI,GAAG,CAAC,CAAM,CAAC,EAAE,CAAC,CAAC,CAAE,CAAM,CAAC,EAAE,CAAC,CAAC,CAAE,EAAI,SAAS,CAAG,EAAG,EAAG,AAAU,EAAV,KAAK,EAAE,EAC/D,EAAI,IAAI,OACH,CACL,EAAI,MAAM,CAAC,CAAM,CAAC,EAAE,CAAC,CAAC,CAAE,CAAM,CAAC,EAAE,CAAC,CAAC,EACnC,IAAK,IAAI,EAAI,EAAG,EAAI,EAAO,MAAM,CAAE,IACjC,EAAI,MAAM,CAAC,CAAM,CAAC,EAAE,CAAC,CAAC,CAAE,CAAM,CAAC,EAAE,CAAC,CAAC,EAErC,EAAI,MAAM,GACZ,CACA,EAAI,OAAO,IACb,EAEa,GAAkB,CAC7B,EACA,EACA,EACA,EACA,EACA,EAAe,CAAC,IAEhB,EAAI,IAAI,GACR,EAAI,WAAW,CAAG,EAClB,EAAI,SAAS,CAAG,EAAI,EACpB,EAAI,SAAS,GACb,EAAI,GAAG,CAAC,EAAG,EAAG,EAAO,EAAG,EAAG,AAAU,EAAV,KAAK,EAAE,EAClC,EAAI,MAAM,GACV,EAAI,OAAO,GACb,EAEa,GAAkB,CAC7B,EACA,EACA,EAAe,CAAC,CAChB,EAAmC,CAAE,EAAG,EAAG,EAAG,CAAE,CAAC,IAEjD,GAAI,CAAC,EAAU,OAAO,CAAE,OAAO,KAC/B,IAAM,EAAO,EAAU,OAAO,CAAC,qBAAqB,GAGpD,MAAO,CAAE,EAFC,AAAC,CAAA,EAAE,OAAO,CAAG,EAAK,IAAI,CAAG,EAAO,CAAC,AAAD,EAAK,EAEnC,EADF,AAAC,CAAA,EAAE,OAAO,CAAG,EAAK,GAAG,CAAG,EAAO,CAAC,AAAD,EAAK,CAChC,EAChB,EC1Ea,GAAgC,CAC3C,EACA,EACA,EACA,EAAkB,CAAA,CAAK,CACvB,EAAkB,CAAC,IAEnB,IAAM,EAAM,EAAY,OAAO,CAAC,IAAK,IAC/B,EAAU,SAAS,EAAI,SAAS,CAAC,EAAG,GAAI,IACxC,EAAU,SAAS,EAAI,SAAS,CAAC,EAAG,GAAI,IACxC,EAAU,SAAS,EAAI,SAAS,CAAC,EAAG,GAAI,IAExC,EAAW,IAAI,WAAW,EAAK,MAAM,CAAG,GACxC,EAAc,KAAK,IAAI,CAAC,QACxB,EAAY,EAAY,IACxB,EAAe,EAAU,IAE/B,IAAK,IAAI,EAAI,EAAG,EAAI,EAAK,MAAM,CAAE,GAAK,EAAG,KAWnC,EAVJ,IAQM,EAAqB,AAJV,KAAK,IAAI,CACxB,KAAK,GAAG,CAAC,AALD,CAAI,CAAC,EAAE,CAKF,EAAS,GAAK,KAAK,GAAG,CAAC,AAJ5B,CAAI,CAAC,EAAI,EAAE,CAIqB,EAAS,GAAK,KAAK,GAAG,CAAC,AAHvD,CAAI,CAAC,EAAI,EAAE,CAGgD,EAAS,IAGxC,EAItC,GAAI,AAAY,IAAZ,EACF,EAAY,GAAsB,EAAY,EAAI,MAC7C,CACL,IAAM,EAAwB,EAAqB,EAGjD,EADE,EAAwB,CAAC,EACf,EACH,EAAwB,EACrB,EAEA,AAAC,CAAA,EAAwB,CAAW,EAAM,CAAA,AAAe,EAAf,CAAe,EAEzE,CAEI,GACF,CAAA,EAAY,EAAI,CAAQ,EAG1B,CAAQ,CAAC,EAAI,EAAE,CAAG,KAAK,KAAK,CAAC,AAAY,IAAZ,GAC/B,CACA,OAAO,EACT,EAIa,GAA0B,CACrC,EACA,EACA,KAEA,GAAI,CAAE,CAAA,aAAkB,cAAW,AAAD,EAAI,OAEtC,IAAM,EAAa,EAAO,UAAU,GAC9B,EAAQ,EAAW,KAAK,CACxB,EAAS,EAAW,MAAM,CAE1B,EAAa,SAAS,aAAa,CAAC,UAC1C,EAAW,KAAK,CAAG,EACnB,EAAW,MAAM,CAAG,EACpB,IAAM,EAAM,EAAW,UAAU,CAAC,MAGlC,EAAI,SAAS,CAAC,EAAY,EAAG,EAAG,EAAO,GAEvC,IAAM,EAAY,EAAI,YAAY,CAAC,EAAG,EAAG,EAAO,GAC1C,EAAO,EAAU,IAAI,CAEX,EAAW,UAAU,CAAC,MAEtC,IAAM,EAAiB,SAAS,aAAa,CAAC,UAC9C,EAAe,KAAK,CAAG,EACvB,EAAe,MAAM,CAAG,EACxB,IAAM,EAAc,EAAe,UAAU,CAAC,MAC9C,EAAY,SAAS,CAAC,EAAY,EAAG,EAAG,EAAO,GAC/C,IAAM,EAAW,EAAY,YAAY,CAAC,EAAG,EAAG,EAAO,GAAQ,IAAI,CAEnE,IAAK,IAAI,EAAI,EAAG,EAAI,EAAK,MAAM,CAAE,GAAK,EAAG,CACvC,IAAM,EAAU,CAAQ,CAAC,EAAE,CAC3B,CAAI,CAAC,EAAI,EAAE,CAAG,EAChB,CAEA,EAAI,YAAY,CAAC,EAAW,EAAG,GAG/B,IAAM,EAAS,IAAI,cAAW,CAAC,GAG/B,EAAO,GAAG,CAAC,CACT,KAAM,EAAO,IAAI,CACjB,IAAK,EAAO,GAAG,CACf,OAAQ,EAAO,MAAM,CACrB,OAAQ,EAAO,MAAM,CACrB,MAAO,EAAO,KAAK,CACnB,MAAO,EAAO,KAAK,CACnB,MAAO,EAAO,KAAK,CACnB,MAAO,EAAO,KAAK,CACnB,MAAO,EAAO,KAAK,CACnB,QAAS,EAAO,OAAO,CACvB,QAAS,EAAO,OAAO,CACvB,QAAS,EAAO,OAAO,AACzB,GAGA,IAAM,EAAQ,EAAO,UAAU,GAAG,OAAO,CAAC,GAC1C,EAAO,MAAM,CAAC,GACd,EAAO,GAAG,CAAC,GACX,EAAO,YAAY,CAAC,EAAQ,GAC5B,EAAO,eAAe,CAAC,GACvB,EAAO,gBAAgB,GACzB,EA2Ba,GAA0B,MACrC,EACA,EACA,EAA8B,SAAS,IAEvC,IAAM,EAAY,IAAI,cAAW,CAAC,GAE9B,AAAS,YAAT,GAEF,EAAO,KAAK,GAIZ,EAAU,GAAG,CAAC,CACZ,KAAM,EACN,IAAK,EACL,QAAS,OACT,QAAS,MACT,WAAY,CAAA,EACZ,QAAS,CAAA,CACX,IAIA,EAAU,GAAG,CAAC,CACZ,KAAM,EACN,IAAK,EACL,QAAS,OACT,QAAS,MACT,WAAY,CAAA,EACZ,QAAS,CAAA,EACT,QAAS,CACX,GACA,EAAO,GAAG,CAAC,GAGb,EAAO,gBAAgB,GACzB,ECxJM,GAAsD,CAAC,CAC3D,KAAA,CAAI,CACJ,SAAA,CAAQ,CACR,QAAA,CAAO,CACP,cAAA,CAAa,CACb,aAAA,CAAY,CACb,IACC,GAAM,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAC,IACrC,CAAC,EAAa,EAAe,CAAG,GAAA,UAAQ,EAAoB,UAC5D,CAAC,EAAQ,EAAU,CAAG,GAAA,UAAQ,EAAC,CAAA,GAC/B,CAAC,EAAS,EAAW,CAAG,GAAA,UAAQ,EAAC,GACjC,CAAC,EAAa,EAAe,CAAG,GAAA,UAAQ,EAAC,GAAiB,WAC1D,CAAC,EAAc,EAAgB,CAAG,GAAA,UAAQ,EAAC,CAAA,GAEjD,GAAA,WAAS,EAAC,KACJ,GAAe,EAAe,GACpC,EAAG,CAAC,EAAc,EAElB,GAAA,WAAS,EAAC,KACR,IAAM,EAAgB,AAAC,IACP,QAAV,EAAE,GAAG,EAAY,EAAgB,CAAA,GACvC,EACM,EAAc,AAAC,IACL,QAAV,EAAE,GAAG,EAAY,EAAgB,CAAA,GACvC,EAGA,OAFA,OAAO,gBAAgB,CAAC,UAAW,GACnC,OAAO,gBAAgB,CAAC,QAAS,GAC1B,KACL,OAAO,mBAAmB,CAAC,UAAW,GACtC,OAAO,mBAAmB,CAAC,QAAS,GACtC,EACF,EAAG,EAAE,EAEL,GAAM,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAoB,UACxD,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAC,IACrC,CAAC,EAAc,EAAgB,CAAG,GAAA,UAAQ,EAAC,GAC3C,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAkB,QACtD,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAC,CAAA,GACrC,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAkC,MACtE,CAAC,EAAc,EAAgB,CAAG,GAAA,UAAQ,EAAgB,MAC1D,CAAC,EAAe,EAAiB,CAAG,GAAA,UAAQ,EAAC,CAAE,MAAO,EAAG,EAAG,EAAG,EAAG,CAAE,GAEpE,EAAe,GAAA,QAAM,EAAiB,MACtC,EAAmB,GAAA,QAAM,EAAoB,MAC7C,EAAgB,GAAA,QAAM,EAAoB,MAC1C,EAAmB,GAAA,QAAM,EAAoB,MAC7C,EAAa,GAAA,QAAM,EAA6B,EAAE,EAClD,EAAgB,GAAA,QAAM,EAAkC,MAExD,CAAC,EAAS,EAAW,CAAG,GAAA,UAAQ,EAAc,EAAE,EAChD,CAAC,EAAc,EAAgB,CAAG,GAAA,UAAQ,EAAC,IAEjD,GAAA,WAAS,EAAC,KACR,GACE,GACA,GACA,EAAiB,OAAO,EACxB,EAAc,OAAO,EACrB,EAAiB,OAAO,EACxB,EAAa,OAAO,CACpB,CACA,IAAM,EAAI,EAAa,KAAK,CACtB,EAAI,EAAa,MAAM,CAEvB,CAAE,YAAa,CAAE,CAAE,aAAc,CAAE,CAAE,CADzB,EAAa,OAAO,CAIhC,EAAQ,KAAK,GAAG,CAAC,EAAK,EAAG,EAAK,GAC9B,EAAW,EAAI,EACf,EAAW,EAAI,EAIrB,EAAiB,CAAE,MAAA,EAAO,EAHT,AAAC,CAAA,EAAK,CAAO,EAAK,EAGI,EAFtB,AAAC,CAAA,EAAK,CAAO,EAAK,CAEgB,GAEnD,EAAiB,OAAO,CAAC,KAAK,CAAG,EACjC,EAAiB,OAAO,CAAC,MAAM,CAAG,EAClC,EAAc,OAAO,CAAC,KAAK,CAAG,EAC9B,EAAc,OAAO,CAAC,MAAM,CAAG,EAG/B,EAAiB,OAAO,CAAC,KAAK,CAAG,EACjC,EAAiB,OAAO,CAAC,MAAM,CAAG,EAGlC,AADY,EAAiB,OAAO,CAAC,UAAU,CAAC,MAC5C,SAAS,CAAC,EAAc,EAAG,GAE/B,IAAM,EAAU,EAAc,OAAO,CAAC,UAAU,CAAC,MACjD,EAAQ,SAAS,CAAG,QACpB,EAAQ,QAAQ,CAAC,EAAG,EAAG,EAAG,GAE1B,IACF,CACF,EAAG,CAAC,EAAM,EAAa,EAEvB,IAAM,EAAc,KAClB,GAAI,CAAC,EAAc,OAAO,CAAE,OAE5B,IAAM,EAAO,AADD,EAAc,OAAO,CAAC,UAAU,CAAC,MAC5B,YAAY,CAAC,EAAG,EAAG,EAAc,OAAO,CAAC,KAAK,CAAE,EAAc,OAAO,CAAC,MAAM,EACvF,EAAa,EAAQ,KAAK,CAAC,EAAG,EAAe,GACnD,EAAW,IAAI,CAAC,GAChB,EAAW,GACX,EAAgB,EAAW,MAAM,CAAG,GACtC,EAwBM,EAAgB,KACpB,GAAI,CAAC,GAAgB,CAAC,EAAiB,OAAO,EAAI,CAAC,EAAc,OAAO,CAAE,OAE1E,IAAM,EAAI,EAAa,KAAK,CACtB,EAAI,EAAa,MAAM,CACvB,EAAM,EAAiB,OAAO,CAAC,UAAU,CAAC,MAC1C,EAAU,EAAc,OAAO,CAAC,UAAU,CAAC,MAGjD,EAAI,SAAS,CAAC,EAAG,EAAG,EAAG,GACvB,EAAI,SAAS,CAAC,EAAc,EAAG,GAG/B,IAAM,EAAY,EAAI,YAAY,CAAC,EAAG,EAAG,EAAG,GACtC,EAAW,GACf,EAAU,IAAI,CACd,EACA,EACA,EACA,GAII,EAAiB,EAAQ,YAAY,CAAC,EAAG,EAAG,EAAG,GAC/C,EAAiB,EAAI,eAAe,CAAC,EAAG,GAE9C,IAAK,IAAI,EAAI,EAAG,EAAI,EAAI,EAAG,IAAK,CAC9B,IAAM,EAAI,EAAU,IAAI,CAAC,AAAI,EAAJ,EAAM,CACzB,EAAI,EAAU,IAAI,CAAC,AAAI,EAAJ,EAAQ,EAAE,CAC7B,EAAI,EAAU,IAAI,CAAC,AAAI,EAAJ,EAAQ,EAAE,CAC7B,EAAI,EAAU,IAAI,CAAC,AAAI,EAAJ,EAAQ,EAAE,CAM7B,EAAa,AAJD,CAAQ,CAAC,EAAE,CAIO,IAAjB,EAAyB,CAAA,AAHxB,EAAe,IAAI,CAAC,AAAI,EAAJ,EAAM,CAGY,GAAE,EAE5D,EAAe,IAAI,CAAC,AAAI,EAAJ,EAAM,CAAG,EAC7B,EAAe,IAAI,CAAC,AAAI,EAAJ,EAAQ,EAAE,CAAG,EACjC,EAAe,IAAI,CAAC,AAAI,EAAJ,EAAQ,EAAE,CAAG,EACjC,EAAe,IAAI,CAAC,AAAI,EAAJ,EAAQ,EAAE,CAAG,EACnC,CAEA,GAAI,AAAgB,SAAhB,EAEF,IAAK,IAAI,EAAI,EAAG,EAAI,EAAI,EAAG,IAAK,CAC9B,IAAM,EAAQ,EAAe,IAAI,CAAC,AAAI,EAAJ,EAAQ,EAAE,CAC5C,EAAe,IAAI,CAAC,AAAI,EAAJ,EAAM,CAAG,EAC7B,EAAe,IAAI,CAAC,AAAI,EAAJ,EAAQ,EAAE,CAAG,EACjC,EAAe,IAAI,CAAC,AAAI,EAAJ,EAAQ,EAAE,CAAG,EACjC,EAAe,IAAI,CAAC,AAAI,EAAJ,EAAQ,EAAE,CAAG,IACnC,CAGF,EAAI,YAAY,CAAC,EAAgB,EAAG,GACtC,EAEA,GAAA,WAAS,EAAC,KACR,IACF,EAAG,CAAC,EAAW,EAAQ,EAAS,EAAa,EAAa,EAAa,EAEvE,IAAM,EAAY,AAAC,IACjB,GAAI,CAAC,GAAgB,CAAC,EAAiB,OAAO,CAAE,OAChD,IAAM,EAAS,GAAgB,EAAG,EAAkB,EAAc,KAAK,CAAE,CACvE,EAAG,EAAc,CAAC,CAClB,EAAG,EAAc,CAAC,AACpB,GACA,GAAI,EAAQ,CACV,IAAM,EAAM,EAAa,UAAU,CAAC,MACpC,GAAI,CAAC,EAAK,OACV,IAAM,EAAI,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,EAAO,CAAC,CAAE,EAAa,KAAK,CAAG,IACxD,EAAI,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,EAAO,CAAC,CAAE,EAAa,MAAM,CAAG,IACzD,EAAQ,EAAI,YAAY,CAAC,EAAG,EAAG,EAAG,GAAG,IAAI,CAG/C,EADE,IAAM,CAAC,CAAK,CAAC,EAAE,CAAE,CAAK,CAAC,EAAE,CAAE,CAAK,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,AAAC,GAAM,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,EAAG,MAAM,IAAI,CAAC,KAE1F,CACF,EAuDM,EAAgB,KAChB,IACF,EAAa,CAAA,GACb,EAAW,OAAO,CAAG,EAAE,CACvB,EAAc,OAAO,CAAG,KACxB,IACA,KAEJ,EAEM,EAAO,AAAC,IACP,EAAc,OAAO,GAW1B,GAVY,EAAc,OAAO,CAAC,UAAU,CAAC,MAUxB,EARW,CAC9B,MAAO,AAAc,WAAd,EAAyB,UAAY,UAC5C,UAAW,EACX,QAAS,EACT,KAAM,EACN,KAAM,CACR,GAKA,KACF,QAGA,GAAA,WAAS,EAAC,KACR,GAAI,CAAC,EAAiB,OAAO,EAAI,CAAC,EAAW,OAC7C,IAAM,EAAM,EAAiB,OAAO,CAAC,UAAU,CAAC,MAChD,EAAI,SAAS,CAAC,EAAG,EAAG,EAAiB,OAAO,CAAC,KAAK,CAAE,EAAiB,OAAO,CAAC,MAAM,EAEnF,IAAM,EAAU,EAAU,CAAC,CAAG,EAAc,KAAK,CAAG,EAAc,CAAC,CAC7D,EAAU,EAAU,CAAC,CAAG,EAAc,KAAK,CAAG,EAAc,CAAC,CAC7D,EAAa,EAAY,EAAc,KAAK,CAOlD,GAJA,GAAgB,EAAK,EAAS,EAAS,EAAY,QACnD,GAAgB,EAAK,EAAS,EAAS,EAAY,QAG/C,GAAgB,EAAc,CAGhC,IAAM,EAAK,KAAK,GAAG,CACjB,EAAiB,OAAO,CAAC,KAAK,CAHV,EAG6B,EACjD,KAAK,GAAG,CAAC,GAAmB,EAHf,KAKT,EAAK,KAAK,GAAG,CACjB,EAAiB,OAAO,CAAC,MAAM,CAPX,EAO8B,EAClD,KAAK,GAAG,CAAC,GAAmB,EAPf,KAWf,EAAI,SAAS,GACb,EAAI,GAAG,CAAC,EAAI,EAAI,GAAmB,EAAG,AAAU,EAAV,KAAK,EAAE,EAC7C,EAAI,SAAS,CAAG,YAChB,EAAI,IAAI,GAGR,EAAI,SAAS,GACb,EAAI,GAAG,CAAC,EAAI,EAnBU,EAmBS,EAAG,AAAU,EAAV,KAAK,EAAE,EACzC,EAAI,SAAS,CAAG,EAChB,EAAI,IAAI,GAGR,EAAI,IAAI,CAAG,kBACX,EAAI,SAAS,CAAG,OAChB,EAAI,SAAS,CAAG,SAChB,EAAI,QAAQ,CAAC,EAAa,WAAW,GAAI,EAAI,EA3BvB,EA2B4C,IACpE,CACF,EAAG,CAAC,EAAW,EAAW,EAAe,EAAc,EAAa,EASlE,UAAC,UAAK,EACJ,MAAM,OACN,KAAM,EACN,SAAU,EACV,KAXgB,KACd,EAAiB,OAAO,EAC1B,EAAQ,EAAiB,OAAO,EAEpC,EAQI,MAAO,IACP,MAAO,CAAE,IAAK,EAAG,EACjB,aAAc,CAAA,WAEd,WAAC,OAAI,MAAO,CAAE,QAAS,OAAQ,IAAK,EAAG,YACrC,UAAC,OAAI,MAAO,CAAE,MAAO,GAAI,WACvB,WAAC,SAAK,EAAC,UAAU,WAAW,MAAO,CAAE,MAAO,MAAO,YACjD,WAAC,iBACC,UAAC,iBAAK,kBACN,UAAC,UAAW,EACV,MAAO,EACP,SAAU,AAAC,GAAM,EAAe,EAAE,WAAW,IAC7C,QAAQ,MAEV,UAAC,OAAI,MAAO,CAAE,SAAU,GAAI,MAAO,OAAQ,UAAW,CAAE,WAAG,+CAI7D,WAAC,iBACC,WAAC,kBAAK,cAAY,EAAU,OAC5B,UAAC,UAAM,EAAC,MAAO,EAAW,SAAU,OAEtC,WAAC,iBACC,WAAC,kBAAK,YAAU,EAAQ,OACxB,UAAC,UAAM,EAAC,MAAO,EAAS,SAAU,OAEpC,UAAC,gBACC,WAAC,SAAK,YACJ,UAAC,iBAAK,YACN,UAAC,SAAM,EAAC,QAAS,IAAM,EAAU,CAAC,GAAS,KAAM,EAAS,UAAY,mBACnE,EAAS,MAAQ,YAIxB,WAAC,iBACC,UAAC,iBAAK,kBACN,WAAC,UAAK,CAAC,KAAK,EAAC,MAAO,EAAa,SAAU,AAAC,GAAM,EAAe,EAAE,MAAM,CAAC,KAAK,YAC7E,UAAC,UAAK,CAAC,MAAM,EAAC,MAAM,kBAAS,WAC7B,UAAC,UAAK,CAAC,MAAM,EAAC,MAAM,gBAAO,eAI/B,WAAC,OAAI,MAAO,CAAE,UAAW,iBAAkB,WAAY,GAAI,UAAW,EAAG,YACvE,UAAC,eAAG,uBACJ,WAAC,SAAK,YACJ,UAAC,SAAM,EACL,KAAM,AAAc,WAAd,EAAyB,UAAY,UAC3C,QAAS,IAAM,EAAa,mBAC7B,WAGD,UAAC,SAAM,EACL,KAAM,AAAc,SAAd,EAAuB,UAAY,UACzC,QAAS,IAAM,EAAa,iBAC7B,YAIH,WAAC,iBACC,WAAC,kBAAK,SAAO,KACb,UAAC,UAAM,EAAC,IAAK,EAAG,IAAK,IAAK,MAAO,EAAW,SAAU,OAExD,WAAC,iBACC,WAAC,kBAAK,YAAU,KAChB,UAAC,UAAM,EACL,IAAK,EACL,IAAK,EACL,KAAM,GACN,MAAO,EACP,SAAU,OAGd,WAAC,iBACC,UAAC,iBAAK,cACN,WAAC,UAAK,CAAC,KAAK,EAAC,MAAO,EAAW,SAAU,AAAC,GAAM,EAAa,EAAE,MAAM,CAAC,KAAK,YACzE,UAAC,UAAK,CAAC,MAAM,EAAC,MAAM,gBAAO,SAC3B,UAAC,UAAK,CAAC,MAAM,EAAC,MAAM,gBAAO,kBAKjC,WAAC,SAAK,YACJ,UAAC,SAAM,EAAC,KAAM,UAAC,SAAY,KAAK,QApU/B,KACX,GAAI,EAAe,EAAG,CACpB,IAAM,EAAW,EAAe,EAC1B,EAAO,CAAO,CAAC,EAAS,CAE9B,AADY,EAAc,OAAO,CAAE,UAAU,CAAC,MAC1C,YAAY,CAAC,EAAM,EAAG,GAC1B,EAAgB,GAChB,IACF,CACF,EA2T2D,SAAU,GAAgB,IACzE,UAAC,SAAM,EACL,KAAM,UAAC,SAAY,KACnB,QA5TD,KACX,GAAI,EAAe,EAAQ,MAAM,CAAG,EAAG,CACrC,IAAM,EAAW,EAAe,EAC1B,EAAO,CAAO,CAAC,EAAS,CAE9B,AADY,EAAc,OAAO,CAAE,UAAU,CAAC,MAC1C,YAAY,CAAC,EAAM,EAAG,GAC1B,EAAgB,GAChB,IACF,CACF,EAoTc,SAAU,GAAgB,EAAQ,MAAM,CAAG,YAMnD,WAAC,OACC,IAAK,EACL,MAAO,CACL,KAAM,EACN,SAAU,WACV,OAAQ,iBACR,OAAQ,IACR,SAAU,SACV,WACE,6KACJ,YAEA,UAAC,UACC,IAAK,EACL,MAAO,CACL,SAAU,WACV,IAAK,EAAc,CAAC,CACpB,KAAM,EAAc,CAAC,CACrB,MAAO,EAAc,KAAK,CAAI,CAAA,OAAA,SAAA,EAAc,KAAK,GAAI,CAAA,EACrD,OAAQ,EAAc,KAAK,CAAI,CAAA,OAAA,SAAA,EAAc,MAAM,GAAI,CAAA,CACzD,IAEF,UAAC,UACC,IAAK,EACL,MAAO,CACL,SAAU,WACV,IAAK,EACL,KAAM,EACN,MAAO,OACP,OAAQ,OACR,OAAQ,EAAe,YAAc,MACvC,EACA,YAxQc,AAAC,IACvB,GAAI,EAAc,CAChB,EAAU,GACV,OACF,CACA,EAAa,CAAA,GACb,IAAM,EAAS,GAAgB,EAAG,EAAkB,EAAc,KAAK,CAAE,CACvE,EAAG,EAAc,CAAC,CAClB,EAAG,EAAc,CAAC,AACpB,GACI,IACF,EAAW,OAAO,CAAG,CAAC,EAAO,CAC7B,EAAc,OAAO,CAAG,EACxB,EAAK,CAAC,EAAO,GAEjB,EA0PU,YAxPc,AAAC,IACvB,IAAM,EAAS,GAAgB,EAAG,EAAkB,EAAc,KAAK,CAAE,CACvE,EAAG,EAAc,CAAC,CAClB,EAAG,EAAc,CAAC,AACpB,GAIA,GAHA,EAAa,GAGT,GAAgB,GAAU,EAC5B,GAAI,CACF,IAAM,EAAM,EAAa,UAAU,CAAC,MACpC,GAAI,EAAK,CACP,IAAM,EAAI,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,EAAO,CAAC,CAAE,EAAa,KAAK,CAAG,IACxD,EAAI,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,EAAO,CAAC,CAAE,EAAa,MAAM,CAAG,IACzD,EAAQ,EAAI,YAAY,CAAC,EAAG,EAAG,EAAG,GAAG,IAAI,CACzC,EACJ,IACA,CAAC,CAAK,CAAC,EAAE,CAAE,CAAK,CAAC,EAAE,CAAE,CAAK,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,AAAC,GAAM,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,EAAG,MAAM,IAAI,CAAC,IAClF,EAAgB,GAClB,CACF,CAAE,MAAO,EAAK,CACZ,EAAgB,MAClB,MAEA,EAAgB,OAGd,GAEA,GAAa,GAAU,EAAc,OAAO,GAC9C,EAAW,OAAO,CAAC,IAAI,CAAC,GACxB,EAAK,CAAC,EAAc,OAAO,CAAE,EAAO,EACpC,EAAc,OAAO,CAAG,GAE5B,EAuNU,UAAW,EACX,aAAc,IAGhB,UAAC,UAAO,IAAK,EAAe,MAAO,CAAE,QAAS,MAAO,YAK/D,kJCtfA,IAAM,GAAsD,CAAC,CAAE,SAAA,CAAQ,CAAE,OAAA,CAAM,CAAE,SAAA,CAAQ,CAAE,GACzF,AAAI,AAAoB,IAApB,EAAS,MAAM,CAEf,UAAC,OAAI,MAAO,CAAE,UAAW,SAAU,QAAS,MAAO,WACjD,UAAC,UAAU,CAAC,IAAI,EAAC,KAAK,qBAAY,+BAMtC,UAAC,UAAI,EACH,KAAM,CAAE,OAAQ,GAAI,OAAQ,CAAE,EAC9B,WAAY,EACZ,WAAY,AAAC,GACX,UAAC,UAAI,CAAC,IAAI,WACR,UAAC,SAAI,EACH,SAAS,IACT,MACE,UAAC,OACC,MAAO,CACL,OAAQ,IACR,SAAU,SACV,QAAS,OACT,WAAY,SACZ,eAAgB,SAChB,WAAY,SACd,WAEA,UAAC,UAAK,EACJ,IAAK,EAAK,SAAS,CACnB,QAAS,CAAA,EACT,MAAO,CAAE,UAAW,OAAQ,SAAU,OAAQ,UAAW,SAAU,MAIzE,QAAS,IAAM,EAAO,GACtB,QAAS,CACP,UAAC,UAAU,EACT,MAAM,kBACN,UAAW,KACT,EAAS,EAAK,EAAE,EAClB,EACA,OAAO,MACP,WAAW,cAEX,UAAC,SAAM,EACL,KAAK,OACL,MAAM,IACN,KAAM,UAAC,UAAc,KACrB,QAAS,AAAC,GAAM,EAAE,eAAe,YAClC,aAIJ,UAED,UAAC,SAAI,CAAC,IAAI,EAAC,MAAO,EAAK,IAAI,CAAE,YAAa,IAAI,KAAK,EAAK,SAAS,EAAE,cAAc,WCtDvF,GAA4C,CAAC,CACjD,QAAA,CAAO,CACP,SAAA,CAAQ,CACR,SAAA,CAAQ,CACR,OAAA,CAAM,CACN,SAAA,CAAQ,CACT,GAEG,UAAC,UAAK,EAAC,MAAM,iBAAiB,KAAM,EAAS,SAAU,EAAU,OAAQ,KAAM,MAAO,aACpF,UAAC,IAAkB,SAAU,EAAU,OAAQ,EAAQ,SAAU,MClBjE,CAAE,OAAA,EAAM,CAAE,CAAG,UAAM,CASnB,GAAsC,CAAC,CAAE,QAAA,CAAO,CAAE,SAAA,CAAQ,CAAE,OAAA,CAAM,CAAE,QAAA,CAAO,CAAE,IACjF,IAAM,EAAmB,GAAA,QAAM,EAAoB,MAC7C,CAAC,EAAU,EAAY,CAAG,GAAA,UAAQ,EAAC,CAAE,EAAG,EAAG,EAAG,EAAG,MAAO,EAAG,OAAQ,CAAE,GACrE,CAAC,EAAY,EAAc,CAAG,GAAA,UAAQ,EAAC,CAAA,GACvC,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAC,CAAE,EAAG,EAAG,EAAG,CAAE,GAClD,CAAC,EAAc,EAAgB,CAAG,GAAA,UAAQ,EAAgB,MAC1D,CAAC,EAAa,EAAe,CAAG,GAAA,UAAQ,EAAgB,MACxD,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAC,CAAA,GAE3C,GAAA,WAAS,EAAC,KACJ,GAAW,IAIb,EAAY,CAAE,EAAG,EAAG,EAAG,EAAG,MAFZ,EAAO,QAAQ,GAEI,OADlB,EAAO,SAAS,EACS,GACxC,EAAe,MACf,EAAa,CAAA,IAEjB,EAAG,CAAC,EAAS,EAAO,EAEpB,GAAA,WAAS,EAAC,KACR,GAAI,CAAC,GAAW,CAAC,GAAU,CAAC,EAAiB,OAAO,CAAE,OAEtD,IAAM,EAAgB,EAAiB,OAAO,CACxC,EAAM,EAAc,UAAU,CAAC,MACrC,GAAI,CAAC,EAAK,OAGV,IAAM,EAAc,EAAO,QAAQ,GAC7B,EAAe,EAAO,SAAS,GACrC,EAAc,KAAK,CAAG,EACtB,EAAc,MAAM,CAAG,EAGvB,IAAM,EAAgB,EAAO,UAAU,GACvC,EAAI,SAAS,CAAC,EAAe,EAAG,GAGhC,EAAI,SAAS,CAAG,qBAChB,EAAI,QAAQ,CAAC,EAAG,EAAG,EAAa,GAGhC,EAAI,SAAS,CAAC,EAAS,CAAC,CAAE,EAAS,CAAC,CAAE,EAAS,KAAK,CAAE,EAAS,MAAM,EACrE,EAAI,SAAS,CACX,EACA,EAAS,CAAC,CACV,EAAS,CAAC,CACV,EAAS,KAAK,CACd,EAAS,MAAM,CACf,EAAS,CAAC,CACV,EAAS,CAAC,CACV,EAAS,KAAK,CACd,EAAS,MAAM,EAIjB,EAAI,WAAW,CAAG,UAClB,EAAI,SAAS,CAAG,EAChB,EAAI,UAAU,CAAC,EAAS,CAAC,CAAE,EAAS,CAAC,CAAE,EAAS,KAAK,CAAE,EAAS,MAAM,EAItE,EAAI,SAAS,CAAG,UAYhB,AAXgB,CACd,CAAE,EAAG,EAAS,CAAC,CAAE,EAAG,EAAS,CAAC,AAAC,EAC/B,CAAE,EAAG,EAAS,CAAC,CAAG,EAAS,KAAK,CAAE,EAAG,EAAS,CAAC,AAAC,EAChD,CAAE,EAAG,EAAS,CAAC,CAAE,EAAG,EAAS,CAAC,CAAG,EAAS,MAAM,AAAC,EACjD,CAAE,EAAG,EAAS,CAAC,CAAG,EAAS,KAAK,CAAE,EAAG,EAAS,CAAC,CAAG,EAAS,MAAM,AAAC,EAClE,CAAE,EAAG,EAAS,CAAC,CAAG,EAAS,KAAK,CAAG,EAAG,EAAG,EAAS,CAAC,AAAC,EACpD,CAAE,EAAG,EAAS,CAAC,CAAG,EAAS,KAAK,CAAG,EAAG,EAAG,EAAS,CAAC,CAAG,EAAS,MAAM,AAAC,EACtE,CAAE,EAAG,EAAS,CAAC,CAAE,EAAG,EAAS,CAAC,CAAG,EAAS,MAAM,CAAG,CAAE,EACrD,CAAE,EAAG,EAAS,CAAC,CAAG,EAAS,KAAK,CAAE,EAAG,EAAS,CAAC,CAAG,EAAS,MAAM,CAAG,CAAE,EACvE,CAEO,OAAO,CAAC,AAAC,IACf,EAAI,QAAQ,CAAC,EAAO,CAAC,CAAG,EAAgB,EAAO,CAAC,CAAG,EAdlC,EAAA,GAenB,GACF,EAAG,CAAC,EAAS,EAAQ,EAAS,EAE9B,IAAM,EAAsB,CAAC,EAAW,KAEtC,GAAM,CAAE,EAAG,CAAE,CAAE,EAAG,CAAE,CAAE,MAAA,CAAK,CAAE,OAAA,CAAM,CAAE,CAAG,SAExC,AAAI,AAHc,GAGd,KAAK,GAAG,CAAC,EAAI,IAAmB,AAHlB,GAGkB,KAAK,GAAG,CAAC,EAAI,GAAwB,KACrE,AAJc,GAId,KAAK,GAAG,CAAC,EAAK,CAAA,EAAK,CAAI,IAAmB,AAJ5B,GAI4B,KAAK,GAAG,CAAC,EAAI,GAAwB,KAC/E,AALc,GAKd,KAAK,GAAG,CAAC,EAAI,IAAmB,AALlB,GAKkB,KAAK,GAAG,CAAC,EAAK,CAAA,EAAK,CAAK,GAAwB,KAChF,AANc,GAMd,KAAK,GAAG,CAAC,EAAK,CAAA,EAAK,CAAI,IAAmB,AAN5B,GAM4B,KAAK,GAAG,CAAC,EAAK,CAAA,EAAK,CAAK,GAC7D,KACL,AARc,GAQd,KAAK,GAAG,CAAC,EAAK,CAAA,EAAK,EAAQ,CAAA,IAAmB,AARhC,GAQgC,KAAK,GAAG,CAAC,EAAI,GAAwB,IACnF,AATc,GASd,KAAK,GAAG,CAAC,EAAK,CAAA,EAAK,EAAQ,CAAA,IAAmB,AAThC,GASgC,KAAK,GAAG,CAAC,EAAK,CAAA,EAAK,CAAK,GACjE,IACL,AAXc,GAWd,KAAK,GAAG,CAAC,EAAI,IAAmB,AAXlB,GAWkB,KAAK,GAAG,CAAC,EAAK,CAAA,EAAK,EAAS,CAAA,GAAwB,IACpF,AAZc,GAYd,KAAK,GAAG,CAAC,EAAK,CAAA,EAAK,CAAI,IAAmB,AAZ5B,GAY4B,KAAK,GAAG,CAAC,EAAK,CAAA,EAAK,EAAS,CAAA,GACjE,IAEF,KACT,EAEM,EAAmB,CAAC,EAAW,IAEjC,GAAK,EAAS,CAAC,EACf,GAAK,EAAS,CAAC,CAAG,EAAS,KAAK,EAChC,GAAK,EAAS,CAAC,EACf,GAAK,EAAS,CAAC,CAAG,EAAS,MAAM,CA0H/B,EAAgB,KACpB,EAAc,CAAA,GACd,EAAgB,MAClB,EA6GA,MACE,WAAC,UAAK,EACJ,MAAM,cACN,KAAM,EACN,SAAU,EACV,MAAO,KAAK,GAAG,CAAC,OAAA,SAAA,EAAQ,QAAQ,KAAM,IAAK,MAAQ,IACnD,OAAQ,CACN,UAAC,SAAM,EAAc,QAAS,WAAU,UAA5B,UAGZ,UAAC,SAAM,EAAe,KAAK,UAAU,QArHrB,KACpB,GAAI,CAAC,EAAQ,CACX,UAAO,CAAC,KAAK,CAAC,wBACd,OACF,CAEA,GAAI,EAAS,KAAK,CAAG,GAAK,EAAS,MAAM,CAAG,EAAG,CAC7C,UAAO,CAAC,KAAK,CAAC,0BACd,OACF,CAGA,EAAQ,SAAS,GAEjB,GAAI,CAEF,IAAM,EAAa,EAAO,MAAM,GAC1B,EAAU,EAAW,OAAO,EAAI,EAAE,CAGlC,EAAU,EAAO,eAAe,EAAI,UAG1C,EAAO,KAAK,GACZ,EAAO,aAAa,CAAC,CAAE,MAAO,EAAS,KAAK,CAAE,OAAQ,EAAS,MAAM,AAAC,GACtE,EAAO,GAAG,CAAC,kBAAmB,GAG9B,EAAQ,OAAO,CAAC,AAAC,IAEM,KAAA,IAAjB,EAAQ,IAAI,EAAgB,CAAA,EAAQ,IAAI,EAAI,EAAS,CAAC,AAAD,EACrC,KAAA,IAAhB,EAAQ,GAAG,EAAgB,CAAA,EAAQ,GAAG,EAAI,EAAS,CAAC,AAAD,EAGnD,EAAQ,OAAO,EAAI,MAAM,OAAO,CAAC,EAAQ,OAAO,GAClD,EAAQ,OAAO,CAAC,OAAO,CAAC,AAAC,IACD,KAAA,IAAlB,EAAS,IAAI,EAAgB,CAAA,EAAS,IAAI,EAAI,EAAS,CAAC,AAAD,EACtC,KAAA,IAAjB,EAAS,GAAG,EAAgB,CAAA,EAAS,GAAG,EAAI,EAAS,CAAC,AAAD,EAC3D,GAEJ,GAGA,EAAO,YAAY,CACjB,CACE,QAAS,EAAW,OAAO,EAAI,QAC/B,QAAA,CACF,EACA,KACE,EAAO,SAAS,GAEhB,EAAQ,SAAS,GACjB,UAAO,CAAC,OAAO,CAAC,+BAChB,IACF,GAEJ,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,cAAe,GAC7B,UAAO,CAAC,KAAK,CAAC,yBAChB,CACF,WAyDmE,gBAAjD,WAGb,WAED,UAAC,OAAI,MAAO,CAAE,aAAc,EAAG,WAC7B,WAAC,SAAK,EAAC,UAAU,WAAW,MAAO,CAAE,MAAO,MAAO,YACjD,WAAC,SAAK,YACJ,UAAC,iBAAK,kBACN,WAAC,UAAM,EACL,MAAO,CAAE,MAAO,GAAI,EACpB,MACE,AAAC,EAEG,IAAgB,GAAK,EACnB,OACA,IAAgB,EAAI,EAClB,MACA,AAAgB,MAAhB,EACE,MACA,AAAgB,IAAhB,EACE,MACA,IAAgB,EAAI,GAClB,OACA,IAAgB,EAAI,EAClB,MACA,IAAgB,EAAI,EAClB,MACA,OAfd,OAiBN,SArFoB,AAAC,IAC/B,GAAI,AAAU,SAAV,EACF,EAAe,MACf,EAAa,CAAA,OACR,KACD,EACJ,OAAQ,GACN,IAAK,OACH,EAAQ,GAAK,EACb,MACF,IAAK,MACH,EAAQ,EAAI,EACZ,MACF,IAAK,MACH,EAAQ,IACR,MACF,IAAK,MAYL,QAXE,EAAQ,EACR,MACF,IAAK,OACH,EAAQ,EAAI,GACZ,MACF,IAAK,MACH,EAAQ,EAAI,EACZ,MACF,IAAK,MACH,EAAQ,EAAI,EAIhB,CACA,EAAe,GACf,EAAa,CAAA,GAGb,IAAM,EAAY,EAAS,KAAK,CAAG,EACnC,GAAI,GAAc,CAAA,OAAA,SAAA,EAAQ,SAAS,KAAM,CAAA,EACvC,EAAY,CAAE,GAAG,CAAQ,CAAE,OAAQ,CAAU,OACxC,CACL,IAAM,EAAW,EAAS,MAAM,CAAG,EACnC,EAAY,CAAE,GAAG,CAAQ,CAAE,MAAO,CAAS,GAC7C,CACF,CACF,YA4CY,UAAC,IAAO,MAAM,gBAAO,SACrB,UAAC,IAAO,MAAM,gBAAO,qBACrB,UAAC,IAAO,MAAM,eAAM,oBACpB,UAAC,IAAO,MAAM,eAAM,oBACpB,UAAC,IAAO,MAAM,eAAM,iBACpB,UAAC,IAAO,MAAM,gBAAO,oBACrB,UAAC,IAAO,MAAM,eAAM,mBACpB,UAAC,IAAO,MAAM,eAAM,sBAEtB,UAAC,UAAQ,EAAC,QAAS,EAAW,SAAU,AAAC,GAAM,EAAa,EAAE,MAAM,CAAC,OAAO,WAAG,YAIjF,WAAC,SAAK,YACJ,UAAC,iBAAK,OACN,UAAC,UAAW,EACV,IAAK,EACL,IAAK,OAAA,SAAA,EAAQ,QAAQ,KAAM,EAC3B,MAAO,KAAK,KAAK,CAAC,EAAS,CAAC,EAC5B,SAAU,AAAC,GAAQ,EAAY,CAAE,GAAG,CAAQ,CAAE,EAAG,GAAO,CAAE,KAE5D,UAAC,iBAAK,OACN,UAAC,UAAW,EACV,IAAK,EACL,IAAK,OAAA,SAAA,EAAQ,SAAS,KAAM,EAC5B,MAAO,KAAK,KAAK,CAAC,EAAS,CAAC,EAC5B,SAAU,AAAC,GAAQ,EAAY,CAAE,GAAG,CAAQ,CAAE,EAAG,GAAO,CAAE,KAE5D,UAAC,iBAAK,WACN,UAAC,UAAW,EACV,IAAK,EACL,IAAK,OAAA,SAAA,EAAQ,QAAQ,KAAM,EAC3B,MAAO,KAAK,KAAK,CAAC,EAAS,KAAK,EAChC,SAAU,AAAC,IACT,IAAM,EAAW,GAAO,EACpB,GAAa,EACf,EAAY,CAAE,GAAG,CAAQ,CAAE,MAAO,EAAU,OAAQ,EAAW,CAAY,GAE3E,EAAY,CAAE,GAAG,CAAQ,CAAE,MAAO,CAAS,GAE/C,IAEF,UAAC,iBAAK,YACN,UAAC,UAAW,EACV,IAAK,EACL,IAAK,OAAA,SAAA,EAAQ,SAAS,KAAM,EAC5B,MAAO,KAAK,KAAK,CAAC,EAAS,MAAM,EACjC,SAAU,AAAC,IACT,IAAM,EAAY,GAAO,EACrB,GAAa,EACf,EAAY,CAAE,GAAG,CAAQ,CAAE,MAAO,EAAY,EAAa,OAAQ,CAAU,GAE7E,EAAY,CAAE,GAAG,CAAQ,CAAE,OAAQ,CAAU,GAEjD,YAKR,UAAC,OACC,MAAO,CACL,SAAU,OACV,UAAW,QACX,OAAQ,oBACR,aAAc,KAChB,WAEA,UAAC,UACC,IAAK,EACL,MAAO,CAAE,QAAS,QAAS,OAAQ,EAAa,OAAS,WAAY,EACrE,YAtVgB,AAAC,QACV,EAAb,IAAM,UAAO,EAAA,EAAiB,OAAO,YAAxB,SAAA,EAA0B,qBAAqB,GAC5D,GAAI,CAAC,EAAM,OAEX,IAAM,EAAI,EAAE,OAAO,CAAG,EAAK,IAAI,CACzB,EAAI,EAAE,OAAO,CAAG,EAAK,GAAG,CAExB,EAAS,EAAoB,EAAG,GAClC,GACF,EAAgB,GAChB,EAAa,CAAE,EAAA,EAAG,EAAA,CAAE,IACX,EAAiB,EAAG,KAC7B,EAAc,CAAA,GACd,EAAa,CAAE,EAAA,EAAG,EAAA,CAAE,IAExB,EAwUQ,YAtUgB,AAAC,QAEV,EADb,GAAI,CAAC,EAAQ,OACb,IAAM,UAAO,EAAA,EAAiB,OAAO,YAAxB,SAAA,EAA0B,qBAAqB,GAC5D,GAAI,CAAC,EAAM,OAEX,IAAM,EAAI,EAAE,OAAO,CAAG,EAAK,IAAI,CACzB,EAAI,EAAE,OAAO,CAAG,EAAK,GAAG,CAE9B,GAAI,EAAc,CAChB,IAAM,EAAK,EAAI,EAAU,CAAC,CACpB,EAAK,EAAI,EAAU,CAAC,CAEtB,EAAU,CAAE,GAAG,CAAQ,AAAC,EAE5B,OAAQ,GACN,IAAK,KACH,EAAQ,CAAC,EAAI,EACb,EAAQ,CAAC,EAAI,EACb,EAAQ,KAAK,EAAI,EACjB,EAAQ,MAAM,EAAI,EAClB,MACF,IAAK,KACH,EAAQ,CAAC,EAAI,EACb,EAAQ,KAAK,EAAI,EACjB,EAAQ,MAAM,EAAI,EAClB,MACF,IAAK,KACH,EAAQ,CAAC,EAAI,EACb,EAAQ,KAAK,EAAI,EACjB,EAAQ,MAAM,EAAI,EAClB,MACF,IAAK,KACH,EAAQ,KAAK,EAAI,EACjB,EAAQ,MAAM,EAAI,EAClB,MACF,IAAK,IACH,EAAQ,CAAC,EAAI,EACb,EAAQ,MAAM,EAAI,EAClB,MACF,IAAK,IACH,EAAQ,MAAM,EAAI,EAClB,MACF,IAAK,IACH,EAAQ,CAAC,EAAI,EACb,EAAQ,KAAK,EAAI,EACjB,MACF,IAAK,IACH,EAAQ,KAAK,EAAI,EAErB,CAGI,GAAa,IACX,EAAa,QAAQ,CAAC,MAAQ,EAAa,QAAQ,CAAC,KACtD,EAAQ,MAAM,CAAG,EAAQ,KAAK,CAAG,EACxB,EAAa,QAAQ,CAAC,MAAQ,EAAa,QAAQ,CAAC,KAC7D,EAAQ,KAAK,CAAG,EAAQ,MAAM,CAAG,EAGjC,EAAQ,MAAM,CAAG,EAAQ,KAAK,CAAG,GAKjC,EAAQ,KAAK,CAAG,IAAM,EAAQ,MAAM,CAAG,KACzC,EAAQ,CAAC,CAAG,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,EAAQ,CAAC,CAAE,EAAO,QAAQ,GAAK,EAAQ,KAAK,GAC7E,EAAQ,CAAC,CAAG,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,EAAQ,CAAC,CAAE,EAAO,SAAS,GAAK,EAAQ,MAAM,GAG3E,EAAQ,CAAC,CAAG,EAAQ,KAAK,CAAG,EAAO,QAAQ,KAC7C,EAAQ,KAAK,CAAG,EAAO,QAAQ,GAAK,EAAQ,CAAC,CACzC,GAAa,GACf,CAAA,EAAQ,MAAM,CAAG,EAAQ,KAAK,CAAG,CAAU,GAG3C,EAAQ,CAAC,CAAG,EAAQ,MAAM,CAAG,EAAO,SAAS,KAC/C,EAAQ,MAAM,CAAG,EAAO,SAAS,GAAK,EAAQ,CAAC,CAC3C,GAAa,GACf,CAAA,EAAQ,KAAK,CAAG,EAAQ,MAAM,CAAG,CAAU,GAI/C,EAAY,GACZ,EAAa,CAAE,EAAA,EAAG,EAAA,CAAE,IAExB,MAAO,GAAI,EAAY,CACrB,IAAM,EAAK,EAAI,EAAU,CAAC,CACpB,EAAK,EAAI,EAAU,CAAC,CAEtB,EAAO,EAAS,CAAC,CAAG,EACpB,EAAO,EAAS,CAAC,CAAG,EAGxB,EAAO,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,EAAM,EAAO,QAAQ,GAAK,EAAS,KAAK,GACpE,EAAO,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,EAAM,EAAO,SAAS,GAAK,EAAS,MAAM,GAEtE,EAAY,CAAE,GAAG,CAAQ,CAAE,EAAG,EAAM,EAAG,CAAK,GAC5C,EAAa,CAAE,EAAA,EAAG,EAAA,CAAE,GACtB,CACF,EAoOQ,UAAW,EACX,aAAc,MAGlB,UAAC,OAAI,MAAO,CAAE,UAAW,GAAI,SAAU,GAAI,MAAO,MAAO,WAAG,+LAMlE,8DCrdsB,aAAlB,OAAO,QAA2B,OAAO,EAAE,EAE7C,CAAA,OAAO,EAAE,CAAG,UAAE,AAAD,EAGR,IAAM,GAAa,IACjB,IAAI,QAAQ,AAAC,IAEd,UAAE,CAAC,mBAAmB,CACxB,IAGA,UAAE,CAAC,oBAAuB,CAAG,KAC3B,IACF,EAEJ,GAGW,GAAoB,MAC/B,EACA,EACA,EAAqB,EAAE,CACvB,EAAsB,CAAC,IAIvB,GAAI,CAAC,UAAE,EAAI,CAAC,UAAE,CAAC,MAAM,CAAE,MAAM,AAAI,MAAM,wBAGvC,GAAI,EAAa,KAAK,GAAK,EAAW,KAAK,EAAI,EAAa,MAAM,GAAK,EAAW,MAAM,CAAE,CACxF,IAAM,EAAW,SAAS,aAAa,CAAC,UACxC,EAAS,KAAK,CAAG,EAAa,KAAK,CACnC,EAAS,MAAM,CAAG,EAAa,MAAM,CACrC,IAAM,EAAM,EAAS,UAAU,CAAC,MAC5B,GACF,EAAI,SAAS,CAAC,EAAY,EAAG,EAAG,EAAa,KAAK,CAAE,EAAa,MAAM,EAEzE,EAAa,EACf,CAEA,IAAM,EAAM,UAAE,CAAC,MAAM,CAAC,GAChB,EAAY,UAAE,CAAC,MAAM,CAAC,GACtB,EAAO,IAAI,UAAE,CAAC,GAAG,CAOvB,GAJA,UAAE,CAAC,QAAQ,CAAC,EAAW,EAAM,UAAE,CAAC,eAAe,EAC/C,UAAE,CAAC,SAAS,CAAC,EAAM,EAAM,GAAI,IAAK,UAAE,CAAC,aAAa,EAG9C,GAAe,EAAc,EAAG,CAClC,IAAI,EAAI,KAAK,KAAK,CAAC,GACf,EAAI,GAAM,GAAG,CAAA,GAAK,CAAA,EACtB,IAAM,EAAK,IAAI,UAAE,CAAC,IAAI,CAAC,EAAG,GAC1B,UAAE,CAAC,YAAY,CAAC,EAAM,EAAM,EAAI,GAClC,CAGA,IAAI,EAAI,KAAK,GAAG,CAAC,EAAG,KAAK,KAAK,CAAC,IAC3B,EAAI,GAAM,GAAG,CAAA,GAAK,CAAA,EACtB,IAAM,EAAQ,IAAI,UAAE,CAAC,IAAI,CAAC,EAAG,GAEvB,EAAU,IAAI,UAAE,CAAC,GAAG,CAC1B,UAAE,CAAC,YAAY,CAAC,EAAK,EAAS,EAAO,GAGrC,IAAM,EAAM,EAAI,KAAK,GAGrB,EAAQ,MAAM,CAAC,EAAK,GAEpB,IAAM,EAAM,SAAS,aAAa,CAAC,UAYnC,OAXA,EAAI,KAAK,CAAG,EAAI,IAAI,CACpB,EAAI,MAAM,CAAG,EAAI,IAAI,CACrB,UAAE,CAAC,MAAM,CAAC,EAAK,GAGf,EAAI,MAAM,GACV,EAAU,MAAM,GAChB,EAAK,MAAM,GACX,EAAQ,MAAM,GACd,EAAI,MAAM,GAEH,EACT,EClFM,CAAE,KAAA,EAAI,CAAE,CAAG,UAAU,CASrB,GAAgD,CAAC,CAAE,QAAA,CAAO,CAAE,SAAA,CAAQ,CAAE,OAAA,CAAM,CAAE,QAAA,CAAO,CAAE,IAC3F,IAAM,EAAe,GAAA,QAAM,EAAiB,MACtC,EAAgB,GAAA,QAAM,EAAoB,MAC1C,EAAmB,GAAA,QAAM,EAAoB,MAC7C,EAAY,GAAA,QAAM,EAAiB,MACnC,CAAC,EAAkB,EAAoB,CAAG,GAAA,UAAQ,EAAsB,MAExE,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAC,IACrC,CAAC,EAAY,EAAc,CAAG,GAAA,UAAQ,EAAC,IACvC,CAAC,EAAS,EAAW,CAAG,GAAA,UAAQ,EAAC,GACjC,CAAC,EAAc,EAAgB,CAAG,GAAA,UAAQ,EAAC,CAAA,GAC3C,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAwB,WAE5D,EAAgB,GAAA,QAAM,EAAC,GACvB,EAAa,GAAA,QAAM,EAAC,GAE1B,GAAA,WAAS,EAAC,KACR,EAAc,OAAO,CAAG,EAC1B,EAAG,CAAC,EAAW,EACf,GAAA,WAAS,EAAC,KACR,EAAW,OAAO,CAAG,EACvB,EAAG,CAAC,EAAQ,EAGZ,GAAA,WAAS,EAAC,KACJ,GACF,KAAa,KAAK,CAAC,AAAC,IAClB,UAAO,CAAC,KAAK,CAAC,oCAAsC,EAAI,OAAO,EACjE,GAEJ,EAAG,CAAC,EAAQ,EAGZ,GAAA,WAAS,EAAC,KACR,GACE,GACA,GACA,EAAc,OAAO,EACrB,EAAiB,OAAO,EACxB,EAAa,OAAO,CACpB,CAGA,IAAM,EAAQ,EAAO,QAAQ,GACvB,EAAS,EAAO,SAAS,GAEzB,EAAa,EAAiB,OAAO,CAAC,UAAU,CAAC,MACvD,GAAI,EAAY,CACd,EAAiB,OAAO,CAAC,KAAK,CAAG,EACjC,EAAiB,OAAO,CAAC,MAAM,CAAG,EAGlC,IAAM,EAAU,EAAO,SAAS,CAAC,CAAE,OAAQ,MAAO,WAAY,CAAE,GAC1D,EAAM,IAAI,MAChB,EAAI,MAAM,CAAG,KACX,EAAW,SAAS,CAAC,EAAK,EAAG,EAAG,EAAO,GACzC,EACA,EAAI,GAAG,CAAG,EACZ,CAII,GACF,EAAiB,OAAO,GAG1B,IAAM,EAAU,IAAI,SAAY,CAAC,EAAc,OAAO,CAAE,CACtD,cAAe,CAAA,EACf,MAAO,EACP,OAAQ,EACR,gBAAiB,gBACjB,UAAW,CAAA,CACb,GAGA,EAAQ,EAAE,CAAC,aAAc,AAAC,IACxB,GAAI,EAAU,OAAO,CAAE,KAER,EADb,IAAM,EAAU,EAAQ,aAAa,CAAC,EAAI,CAAC,EACrC,EAAO,SAAA,EAAA,EAAQ,gBAAgB,YAAxB,SAAA,EAA0B,KAAK,GAAI,GAChD,EAAU,OAAO,CAAC,KAAK,CAAC,OAAO,CAAG,QAClC,EAAU,OAAO,CAAC,KAAK,CAAC,SAAS,CAAG,CAAC,UAAU,EAAE,EAAQ,CAAC,CAAG,EAAO,EAAE,IAAI,EAAE,EAAQ,CAAC,CAAG,EAAO,EAAE,GAAG,CAAC,CACrG,EAAU,OAAO,CAAC,KAAK,CAAC,KAAK,CAAG,CAAC,EAAE,EAAK,EAAE,CAAC,CAC3C,EAAU,OAAO,CAAC,KAAK,CAAC,MAAM,CAAG,CAAC,EAAE,EAAK,EAAE,CAAC,CAC9C,CACF,GAEA,EAAQ,EAAE,CAAC,YAAa,KAClB,EAAU,OAAO,EACnB,CAAA,EAAU,OAAO,CAAC,KAAK,CAAC,OAAO,CAAG,MAAK,EAE3C,GAQA,IAAM,EAAQ,IAAI,cAAW,CAAC,GA+E9B,OA9EA,EAAM,KAAK,CAAG,uBACd,EAAM,KAAK,CAAG,EACd,EAAQ,gBAAgB,CAAG,EAG3B,EAAQ,EAAE,CAAC,eAAgB,MAAO,IAChC,GAAI,CACF,EAAgB,CAAA,GAChB,IAAM,EAAO,EAAI,IAAI,CAIf,EAAa,SAAS,aAAa,CAAC,UAC1C,EAAW,KAAK,CAAG,EAAQ,QAAQ,GACnC,EAAW,MAAM,CAAG,EAAQ,SAAS,GACrC,IAAM,EAAM,EAAW,UAAU,CAAC,MAGlC,EAAI,SAAS,CAAG,QAChB,EAAI,QAAQ,CAAC,EAAG,EAAG,EAAW,KAAK,CAAE,EAAW,MAAM,EAGtD,IAAM,EAAU,EAAQ,SAAS,CAAC,CAAE,OAAQ,MAAO,WAAY,CAAE,GAC3D,EAAM,IAAI,MAChB,EAAI,GAAG,CAAG,EACV,MAAM,IAAI,QAAc,AAAC,IACvB,EAAI,MAAM,CAAG,IAAM,IACrB,GAEA,EAAI,SAAS,CAAC,EAAK,EAAG,GAGtB,IAAM,EAAY,EAAI,YAAY,CAAC,EAAG,EAAG,EAAW,KAAK,CAAE,EAAW,MAAM,EACtE,EAAO,EAAU,IAAI,CAC3B,IAAK,IAAI,EAAI,EAAG,EAAI,EAAK,MAAM,CAAE,GAAK,EAEhC,CAAI,CAAC,EAAE,CAAG,IACZ,CAAI,CAAC,EAAE,CAAG,IACV,CAAI,CAAC,EAAI,EAAE,CAAG,IACd,CAAI,CAAC,EAAI,EAAE,CAAG,MAGd,CAAI,CAAC,EAAE,CAAG,EACV,CAAI,CAAC,EAAI,EAAE,CAAG,EACd,CAAI,CAAC,EAAI,EAAE,CAAG,GACd,CAAI,CAAC,EAAI,EAAE,CAAG,IAMlB,GAHA,EAAI,YAAY,CAAC,EAAW,EAAG,GAG3B,EAAiB,OAAO,CAAE,CAC5B,IAAM,EAAS,MAAM,GACnB,EAAiB,OAAO,CACxB,EACA,EAAc,OAAO,CACrB,EAAW,OAAO,EAId,EAAO,EAAiB,OAAO,CAAC,UAAU,CAAC,MAC7C,GACF,EAAK,SAAS,CAAC,EAAQ,EAAG,GAE9B,CAGA,EAAQ,MAAM,CAAC,GACf,EAAQ,gBAAgB,GAC1B,CAAE,MAAO,EAAG,CACV,QAAQ,KAAK,CAAC,mBAAoB,GACpC,QAAU,CACR,EAAgB,CAAA,GAClB,CACF,GAEA,EAAoB,GAEb,KACL,EAAQ,OAAO,GACjB,EACF,CACF,EAAG,CAAC,EAAS,EAAO,EAGpB,GAAA,WAAS,EAAC,KACJ,GACF,CAAA,EAAiB,gBAAgB,CAAE,KAAK,CAAG,CAAQ,EAEvD,EAAG,CAAC,EAAW,EAAiB,EAoBhC,IAAM,EAAe,UACnB,GAAI,CAAC,EAAkB,MAAM,AAAI,MAAM,kBAUvC,IAAM,EAAa,SAAS,aAAa,CAAC,UAC1C,EAAW,KAAK,CAAG,EAAiB,QAAQ,GAC5C,EAAW,MAAM,CAAG,EAAiB,SAAS,GAC9C,IAAM,EAAM,EAAW,UAAU,CAAC,MAGlC,EAAI,SAAS,CAAG,QAChB,EAAI,QAAQ,CAAC,EAAG,EAAG,EAAW,KAAK,CAAE,EAAW,MAAM,EAOtD,IAAM,EAAU,EAAiB,SAAS,CAAC,CAAE,OAAQ,MAAO,WAAY,CAAE,GAE1E,OAAO,IAAI,QAAQ,AAAC,IAClB,IAAM,EAAM,IAAI,MAChB,EAAI,MAAM,CAAG,KAEX,EAAI,SAAS,CAAC,EAAK,EAAG,GAQtB,IAAM,EAAY,EAAI,YAAY,CAAC,EAAG,EAAG,EAAW,KAAK,CAAE,EAAW,MAAM,EACtE,EAAO,EAAU,IAAI,CAC3B,IAAK,IAAI,EAAI,EAAG,EAAI,EAAK,MAAM,CAAE,GAAK,EAIhC,CAAI,CAAC,EAAE,CAAG,IAEZ,CAAI,CAAC,EAAE,CAAG,IACV,CAAI,CAAC,EAAI,EAAE,CAAG,IACd,CAAI,CAAC,EAAI,EAAE,CAAG,MAGd,CAAI,CAAC,EAAE,CAAG,EACV,CAAI,CAAC,EAAI,EAAE,CAAG,EACd,CAAI,CAAC,EAAI,EAAE,CAAG,GACd,CAAI,CAAC,EAAI,EAAE,CAAG,IAGlB,EAAI,YAAY,CAAC,EAAW,EAAG,GAC/B,EAAQ,GACV,EACA,EAAI,GAAG,CAAG,EACZ,GACF,EAEM,EAAgB,UACpB,GAAI,AAAC,GAAW,EAAiB,OAAO,EACxC,EAAgB,CAAA,GAChB,GAAI,CACF,IAAM,EAAa,MAAM,IACnB,EAAe,EAAiB,OAAO,CAQvC,EAAS,MAAM,GAAkB,EAAc,EAAY,EAAY,GAGvE,EAAM,EAAiB,OAAO,CAAC,UAAU,CAAC,MAC5C,GACF,EAAI,SAAS,CAAC,EAAQ,EAAG,GAE3B,UAAO,CAAC,OAAO,CAAC,qBAClB,CAAE,MAAO,EAAQ,CACf,QAAQ,KAAK,CAAC,GACd,UAAO,CAAC,KAAK,CAAC,mBAAqB,EAAE,OAAO,EAC9C,QAAU,CACR,EAAgB,CAAA,GAClB,EACF,EAEM,EAAc,UAClB,GAAI,AAAC,GAAW,EAAiB,OAAO,EACxC,EAAgB,CAAA,GAChB,GAAI,CAIF,EAAQ,SAAS,GACjB,MAAM,GAAwB,EAAQ,EAAiB,OAAO,CAAE,GAChE,EAAQ,SAAS,GAEjB,UAAO,CAAC,OAAO,CAAC,6BAChB,IACF,CAAE,MAAO,EAAQ,CACf,QAAQ,KAAK,CAAC,GACd,UAAO,CAAC,KAAK,CAAC,iBAAmB,EAAE,OAAO,EAC5C,QAAU,CACR,EAAgB,CAAA,GAClB,EACF,EAEA,MACE,WAAC,UAAK,EACJ,MAAM,aACN,KAAM,EACN,SAAU,EACV,MAAO,IACP,OAAQ,KACR,cAAc,cAEd,WAAC,OAAI,MAAO,CAAE,QAAS,OAAQ,IAAK,EAAG,YAErC,WAAC,OACC,IAAK,EACL,MAAO,CACL,SAAU,WACV,OAAQ,oBACR,MAAO,OAAA,SAAA,EAAQ,QAAQ,KAAM,IAC7B,OAAQ,OAAA,SAAA,EAAQ,SAAS,KAAM,IAC/B,SAAU,QACZ,YAGA,UAAC,UAAO,IAAK,EAAkB,MAAO,CAAE,SAAU,WAAY,IAAK,EAAG,KAAM,CAAE,IAE9E,UAAC,UACC,IAAK,EACL,MAAO,CAAE,SAAU,WAAY,IAAK,EAAG,KAAM,EAAG,QAAS,CAAE,IAE7D,UAAC,OACC,IAAK,EACL,MAAO,CACL,SAAU,WACV,IAAK,EACL,KAAM,EACN,QAAS,OACT,aAAc,MACd,OAAQ,qCACR,UAAW,0BACX,cAAe,OACf,OAAQ,GACV,OAKJ,WAAC,OAAI,MAAO,CAAE,MAAO,IAAK,QAAS,OAAQ,cAAe,SAAU,IAAK,EAAG,YAC1E,WAAC,iBACC,WAAC,IAAK,MAAM,cAAC,eAAa,EAAU,QACpC,UAAC,UAAM,EAAC,IAAK,EAAG,IAAK,IAAK,MAAO,EAAW,SAAU,OAGxD,WAAC,iBACC,WAAC,IAAK,MAAM,cAAC,gBAAc,KAC3B,UAAC,UAAM,EAAC,IAAK,EAAG,IAAK,IAAK,MAAO,EAAY,SAAU,OAGzD,WAAC,iBACC,WAAC,IAAK,MAAM,cAAC,YAAU,EAAQ,QAC/B,UAAC,UAAM,EAAC,IAAK,EAAG,IAAK,GAAI,MAAO,EAAS,SAAU,OAGrD,WAAC,SAAK,YACJ,UAAC,SAAO,EAAC,MAAM,4BACb,UAAC,SAAM,EAAC,KAAM,UAAC,SAAY,KAAK,QA5L3B,KAEf,GAAI,EAAkB,CACpB,IAAM,EAAU,EAAiB,UAAU,GACvC,EAAQ,MAAM,CAAG,GACnB,EAAiB,MAAM,CAAC,CAAO,CAAC,EAAQ,MAAM,CAAG,EAAE,EAEvD,CACF,MAsLU,UAAC,SAAO,EAAC,MAAM,sBACb,UAAC,SAAM,EAAC,KAAM,UAAC,UAAc,KAAK,QAvM5B,KACZ,IACF,EAAiB,KAAK,GACtB,EAAiB,GAAG,CAAC,kBAAmB,iBACxC,EAAiB,SAAS,IAE9B,SAqMQ,WAAC,SAAK,EAAC,UAAU,WAAW,MAAO,CAAE,UAAW,EAAG,YACjD,UAAC,IAAK,MAAM,aAAC,gBACb,WAAC,UAAK,CAAC,KAAK,EAAC,MAAO,EAAW,SAAU,AAAC,GAAM,EAAa,EAAE,MAAM,CAAC,KAAK,YACzE,UAAC,UAAK,EAAC,MAAM,mBAAU,8BACvB,UAAC,UAAK,EAAC,MAAM,mBAAU,8BAI3B,WAAC,OAAI,MAAO,CAAE,UAAW,OAAQ,QAAS,OAAQ,cAAe,SAAU,IAAK,CAAE,YAChF,UAAC,SAAM,EAAC,KAAM,UAAC,UAAW,KAAK,QAAS,EAAe,QAAS,WAAc,mBAG9E,WAAC,SAAK,YACJ,UAAC,SAAM,EAAC,QAAS,WAAU,WAC3B,UAAC,SAAM,EAAC,KAAK,UAAU,QAAS,EAAa,QAAS,WAAc,2BAO5E,UAAC,OAAI,MAAO,CAAE,UAAW,EAAG,MAAO,MAAO,WAAG,gGAKnD,EC/aM,GAAiB,WAEV,GAAS,IACb,IAAI,QAAQ,CAAC,EAAS,KAC3B,IAAM,EAAU,UAAU,IAAI,CANlB,gBACG,GAOf,EAAQ,OAAO,CAAG,KAChB,EAAO,0BACT,EAEA,EAAQ,SAAS,CAAG,AAAC,IACnB,EAAQ,AAAC,EAAM,MAAM,CAAsB,MAAM,EACnD,EAEA,EAAQ,eAAe,CAAG,AAAC,IACzB,IAAM,EAAK,AAAC,EAAM,MAAM,CAAsB,MAAM,CAC/C,EAAG,gBAAgB,CAAC,QAAQ,CAAC,KAChC,EAAG,iBAAiB,CAAC,GAAgB,CAAE,QAAS,IAAK,GAEzD,EACF,GAGW,GAAkB,MAAO,IACpC,IAAM,EAAK,MAAM,KACjB,OAAO,IAAI,QAAQ,CAAC,EAAS,KAG3B,IAAM,EAAU,AADF,AADM,EAAG,WAAW,CAAC,CAAC,GAAe,CAAE,aAC3B,WAAW,CAAC,IAChB,GAAG,CAAC,GAE1B,EAAQ,SAAS,CAAG,IAAM,IAC1B,EAAQ,OAAO,CAAG,IAAM,EAAO,wBACjC,GACF,EAEa,GAAuB,UAClC,IAAM,EAAK,MAAM,KACjB,OAAO,IAAI,QAAQ,CAAC,EAAS,KAG3B,IAAM,EAAU,AADF,AADM,EAAG,WAAW,CAAC,CAAC,GAAe,CAAE,YAC3B,WAAW,CAAC,IAChB,MAAM,GAE5B,EAAQ,SAAS,CAAG,KAClB,IAAM,EAAW,EAAQ,MAAM,CAE/B,EAAS,IAAI,CAAC,CAAC,EAAG,IAAM,EAAE,SAAS,CAAG,EAAE,SAAS,EACjD,EAAQ,GACV,EACA,EAAQ,OAAO,CAAG,IAAM,EAAO,2BACjC,GACF,EAEa,GAAsB,MAAO,IACxC,IAAM,EAAK,MAAM,KACjB,OAAO,IAAI,QAAQ,CAAC,EAAS,KAG3B,IAAM,EAAU,AADF,AADM,EAAG,WAAW,CAAC,CAAC,GAAe,CAAE,aAC3B,WAAW,CAAC,IAChB,MAAM,CAAC,GAE7B,EAAQ,SAAS,CAAG,IAAM,IAC1B,EAAQ,OAAO,CAAG,IAAM,EAAO,0BACjC,GACF,EC7Da,GAAc,KACzB,GAAM,CAAC,EAAe,EAAiB,CAAG,GAAA,UAAQ,EAAiB,EAAE,EAC/D,CAAC,EAAgB,EAAkB,CAAG,GAAA,UAAQ,EAAsB,MAEpE,EAAe,GAAA,aAAW,EAAC,KAC/B,KACG,IAAI,CAAC,GACL,KAAK,CAAC,AAAC,GAAQ,QAAQ,KAAK,CAAC,kCAAmC,IACrE,EAAG,EAAE,EAEL,GAAA,WAAS,EAAC,KACR,IACF,EAAG,CAAC,EAAa,EAEjB,IAAM,EAAc,GAAA,aAAW,EAC7B,MAAO,EAAiB,KACtB,GAAI,CAAC,EAAS,OAEd,IAAM,EAA2B,CAC/B,GAAI,OAAA,SAAA,EAAgB,EAAE,GAAI,KAAK,GAAG,GAAG,QAAQ,GAC7C,KAAM,OAAA,SAAA,EAAgB,IAAI,GAAI,CAAC,QAAQ,EAAE,IAAI,OAAO,cAAc,GAAG,CAAC,CACtE,UAAW,EACX,KAAM,EACN,UAAW,OAAA,SAAA,EAAgB,SAAS,GAAI,KAAK,GAAG,GAChD,UAAW,KAAK,GAAG,EACrB,EAEA,GAAI,CACF,MAAM,GAAgB,GAGtB,EAAiB,AAAC,GAOT,AALS,CAAA,AADD,EAAK,IAAI,CAAC,AAAC,GAAM,EAAE,EAAE,GAAK,EAAW,EAAE,EAElD,EAAK,GAAG,CAAC,AAAC,GAAO,EAAE,EAAE,GAAK,EAAW,EAAE,CAAG,EAAa,GACvD,CAAC,KAAe,EAAK,AAAD,EAGT,IAAI,CAAC,CAAC,EAAG,IAAM,EAAE,SAAS,CAAG,EAAE,SAAS,GAGzD,EAAkB,GAClB,UAAO,CAAC,OAAO,CAAC,+BAClB,CAAE,MAAO,EAAK,CACZ,QAAQ,KAAK,CAAC,GACd,UAAO,CAAC,KAAK,CAAC,0BAChB,CACF,EACA,CAAC,EAAe,EAwBlB,MAAO,CACL,cAAA,EACA,eAAA,EACA,aAAA,EACA,YAAA,EACA,cA1BoB,GAAA,aAAW,EAAC,MAAO,IACvC,GAAI,CACF,MAAM,GAAoB,GAC1B,EAAiB,AAAC,GAAS,EAAK,MAAM,CAAC,AAAC,GAAM,EAAE,EAAE,GAAK,IAEvD,EAAkB,AAAC,GAAS,GAAO,EAAI,EAAE,GAAK,EAAK,KAAO,GAC1D,UAAO,CAAC,OAAO,CAAC,mBAClB,CAAE,MAAO,EAAK,CACZ,QAAQ,KAAK,CAAC,GACd,UAAO,CAAC,KAAK,CAAC,4BAChB,CACF,EAAG,EAAE,EAgBH,sBAd4B,GAAA,aAAW,EAAC,AAAC,IACzC,EAAkB,GACpB,EAAG,EAAE,EAaH,oBAX0B,GAAA,aAAW,EAAC,KACtC,EAAkB,MACpB,EAAG,EAAE,EAUH,kBAAA,CACF,EACF,EC5EM,GAA4B,CAAC,CAAE,KAAA,CAAI,CAAE,OAAA,CAAM,CAAE,GACjD,UAAC,OAAI,UAAU,OAAO,cAAY,OAAO,MAAO,WAC9C,UAAC,OAAI,UAAW,CAAC,CAAC,EAAE,EAAK,CAAC,qJCbvB,IAAM,GAAQ,CAAC,EAAe,EAAM,CAAC,CAAE,EAAM,GAAG,GAC9C,KAAK,GAAG,CAAC,EAAK,KAAK,GAAG,CAAC,EAAK,IAIxB,GAAU,AAAC,GACf,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,EAAG,IAGpB,GAAW,CAAC,EAAW,EAAW,KAK7C,IAAM,EAAM,KAAK,GAAG,CAJpB,GAAK,IACL,GAAK,IACL,GAAK,KAGC,EAAM,KAAK,GAAG,CAAC,EAAG,EAAG,GACvB,EAAI,EACN,EAAI,EACJ,EAAI,AAAC,CAAA,EAAM,CAAE,EAAK,EAEpB,GAAI,IAAQ,EAAK,CACf,IAAM,EAAI,EAAM,EAGhB,OAFA,EAAI,EAAI,GAAM,EAAK,CAAA,EAAI,EAAM,CAAE,EAAK,EAAK,CAAA,EAAM,CAAE,EAEzC,GACN,KAAK,EACH,EAAI,AAAC,CAAA,EAAI,CAAA,EAAK,EAAK,CAAA,EAAI,EAAI,EAAI,CAAA,EAC/B,MACF,KAAK,EACH,EAAI,AAAC,CAAA,EAAI,CAAA,EAAK,EAAI,EAClB,MACF,KAAK,EACH,EAAI,AAAC,CAAA,EAAI,CAAA,EAAK,EAAI,EAEtB,CACA,GAAK,EACP,CAEA,MAAO,CAAC,EAAG,EAAG,EAAE,CAClB,EAEa,GAAW,CAAC,EAAW,EAAW,KAC7C,IAAI,EAAW,EAAW,EAE1B,GAAI,AAAM,IAAN,EACF,EAAI,EAAI,EAAI,MACP,CACL,IAAM,EAAU,CAAC,EAAW,EAAW,IAGrC,CAFI,EAAI,GAAG,CAAA,GAAK,CAAA,EACZ,EAAI,GAAG,CAAA,GAAK,CAAA,EACZ,EAAI,EAAI,GAAU,EAAI,AAAC,CAAA,EAAI,CAAA,EAAK,EAAI,EACpC,EAAI,GAAc,EAClB,EAAI,EAAI,EAAU,EAAI,AAAC,CAAA,EAAI,CAAA,EAAM,CAAA,EAAI,EAAI,CAAA,EAAK,EAC3C,EAGH,EAAI,EAAI,GAAM,EAAK,CAAA,EAAI,CAAA,EAAK,EAAI,EAAI,EAAI,EACxC,EAAI,EAAI,EAAI,EAElB,EAAI,EAAQ,EAAG,EAAG,EAAI,EAAI,GAC1B,EAAI,EAAQ,EAAG,EAAG,GAClB,EAAI,EAAQ,EAAG,EAAG,EAAI,EAAI,GAC5B,CAEA,MAAO,CAAC,KAAK,KAAK,CAAC,AAAI,IAAJ,GAAU,KAAK,KAAK,CAAC,AAAI,IAAJ,GAAU,KAAK,KAAK,CAAC,AAAI,IAAJ,GAAS,CACxE,EAEa,GAAc,CACzB,CAAE,KAAM,MAAO,MAAO,CAAC,IAAK,GAAG,AAAC,EAChC,CAAE,KAAM,SAAU,MAAO,CAAC,GAAI,GAAG,AAAC,EAClC,CAAE,KAAM,SAAU,MAAO,CAAC,GAAI,GAAG,AAAC,EAClC,CAAE,KAAM,QAAS,MAAO,CAAC,GAAI,IAAI,AAAC,EAClC,CAAE,KAAM,OAAQ,MAAO,CAAC,IAAK,IAAI,AAAC,EAClC,CAAE,KAAM,OAAQ,MAAO,CAAC,IAAK,IAAI,AAAC,EAClC,CAAE,KAAM,SAAU,MAAO,CAAC,IAAK,IAAI,AAAC,EACpC,CAAE,KAAM,UAAW,MAAO,CAAC,IAAK,IAAI,AAAC,EACtC,CAEY,GAAsB,AAAC,IAClC,IAAM,EAAM,AAAC,CAAA,AAAC,EAAM,IAAO,GAAE,EAAK,IAC5B,EAAQ,GAAY,IAAI,CAAC,CAAC,CAAE,MAAA,CAAK,CAAE,IACvC,GAAM,CAAC,EAAO,EAAI,CAAG,SACrB,AAAI,GAAS,EACJ,GAAO,GAAS,EAAM,EAExB,GAAO,GAAS,EAAM,EAC/B,GACA,MAAO,OAAA,SAAA,EAAO,IAAI,GAAI,MACxB,EC/Da,GAAkB,AAAC,IAE9B,IAAM,EAAS,IAAI,EAAO,CAAC,IAAI,CAAC,CAAC,EAAG,IAAM,EAAE,CAAC,CAAG,EAAE,CAAC,EAE/C,CAAM,CAAC,EAAE,CAAC,CAAC,CAAG,GAAG,EAAO,OAAO,CAAC,CAAE,EAAG,EAAG,EAAG,CAAM,CAAC,EAAE,CAAC,CAAC,AAAC,GACvD,CAAM,CAAC,EAAO,MAAM,CAAG,EAAE,CAAC,CAAC,CAAG,KAAK,EAAO,IAAI,CAAC,CAAE,EAAG,IAAK,EAAG,CAAM,CAAC,EAAO,MAAM,CAAG,EAAE,CAAC,CAAC,AAAC,GAE5F,IAAM,EAAK,EAAO,GAAG,CAAC,AAAC,GAAM,EAAE,CAAC,EAC1B,EAAK,EAAO,GAAG,CAAC,AAAC,GAAM,EAAE,CAAC,EAC1B,EAAI,EAAG,MAAM,CAGb,EAAgB,EAAE,CAClB,EAAgB,EAAE,CAClB,EAAe,EAAE,CACvB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAI,EAAG,IAAK,CAC9B,IAAM,EAAK,CAAE,CAAC,EAAI,EAAE,CAAG,CAAE,CAAC,EAAE,CACtB,EAAK,CAAE,CAAC,EAAI,EAAE,CAAG,CAAE,CAAC,EAAE,CAC5B,EAAI,IAAI,CAAC,GACT,EAAI,IAAI,CAAC,GACT,EAAG,IAAI,CAAC,EAAK,GACf,CAEA,IAAM,EAAgB,CAAC,CAAE,CAAC,EAAE,CAAC,CAC7B,IAAK,IAAI,EAAI,EAAG,EAAI,EAAI,EAAG,IAAK,CAC9B,IAAM,EAAI,CAAE,CAAC,EAAE,CACT,EAAQ,CAAE,CAAC,EAAI,EAAE,CACvB,GAAI,EAAI,GAAS,EACf,EAAI,IAAI,CAAC,OACJ,CACL,IAAM,EAAK,CAAG,CAAC,EAAE,CACX,EAAS,CAAG,CAAC,EAAI,EAAE,CACnB,EAAS,EAAK,EACpB,EAAI,IAAI,CAAC,AAAC,EAAI,EAAW,CAAA,AAAC,CAAA,EAAS,CAAK,EAAK,EAAI,AAAC,CAAA,EAAS,CAAC,EAAK,CAAI,GACvE,CACF,CACA,EAAI,IAAI,CAAC,CAAE,CAAC,EAAG,MAAM,CAAG,EAAE,EAG1B,IAAM,EAAgB,AAAI,MAAM,KAAK,IAAI,CAAC,GAE1C,IAAK,IAAI,EAAI,EAAG,EAAI,EAAI,EAAG,IAAK,CAC9B,IAAM,EAAS,CAAE,CAAC,EAAE,CACd,EAAO,CAAE,CAAC,EAAI,EAAE,CAChB,EAAS,CAAE,CAAC,EAAE,CACd,EAAO,CAAE,CAAC,EAAI,EAAE,CAChB,EAAK,CAAG,CAAC,EAAE,CACX,EAAK,CAAG,CAAC,EAAI,EAAE,CACf,EAAK,EAAO,EAUlB,IAAK,IAAI,EAAI,EACX,AADmB,GAAK,IACpB,CAAA,GAAK,GAAE,EADmB,IAAK,CAEnC,IAAM,EAAI,AAAC,CAAA,EAAI,CAAK,EAAK,EACnB,EAAK,EAAI,EACT,EAAK,EAAK,EAOV,EAAI,AALE,CAAA,EAAI,EAAK,EAAI,EAAK,CAAA,EAKd,EAAS,AAJb,CAAA,EAAK,EAAI,EAAK,CAAA,EAIK,EAAK,EAAK,AAH7B,CAAA,GAAK,EAAK,EAAI,CAAC,EAGoB,EAAO,AAF1C,CAAA,EAAK,CAAC,EAE0C,EAAK,EACjE,CAAG,CAAC,KAAK,KAAK,CAAC,GAAG,CAAG,GAAM,KAAK,KAAK,CAAC,IACxC,CACF,CACA,OAAO,EACT,EAIa,GAAyB,CAAC,EAAsB,KAC3D,IAAM,EAAO,EAAU,IAAI,CACrB,CAAE,IAAA,CAAG,CAAE,OAAA,CAAM,CAAE,aAAA,CAAY,CAAE,CAAG,EAIhC,EAAY,GAAgB,EAAO,MAAM,EACzC,EAAS,GAAgB,EAAO,GAAG,EACnC,EAAW,GAAgB,EAAO,KAAK,EACvC,EAAU,GAAgB,EAAO,IAAI,EAMzB,GAChB,EAAa,OAAO,CAAC,CAAC,CAAG,IACzB,EAAa,OAAO,CAAC,CAAC,CACtB,AAAyB,EAAzB,EAAa,OAAO,CAAC,CAAC,EAEL,GACjB,EAAa,QAAQ,CAAC,CAAC,CAAG,IAC1B,EAAa,QAAQ,CAAC,CAAC,CACvB,AAA0B,EAA1B,EAAa,QAAQ,CAAC,CAAC,EAEJ,GACnB,EAAa,UAAU,CAAC,CAAC,CAAG,IAC5B,EAAa,UAAU,CAAC,CAAC,CACzB,AAA4B,EAA5B,EAAa,UAAU,CAAC,CAAC,EAM3B,IAAK,IAAI,EAAI,EAAG,EAAI,EAAK,MAAM,CAAE,GAAK,EAAG,CACvC,IAAI,EAAI,CAAI,CAAC,EAAE,CACX,EAAI,CAAI,CAAC,EAAI,EAAE,CACf,EAAI,CAAI,CAAC,EAAI,EAAE,CAInB,EAAI,CAAM,CAAC,EAAE,CACb,EAAI,CAAQ,CAAC,EAAE,CACf,EAAI,CAAO,CAAC,EAAE,CAYd,GAAI,CAAC,EAAG,EAAG,EAAE,CAAG,GAThB,EAAI,CAAS,CAAC,EAAE,CAChB,EAAI,CAAS,CAAC,EAAE,CAChB,EAAI,CAAS,CAAC,EAAE,EAQZ,EAAM,AAAC,CAAA,AAAI,IAAJ,EAAU,GAAE,EAAK,IAItB,EAAQ,GAAY,IAAI,CAAC,CAAC,CAAE,MAAA,CAAK,CAAE,IACvC,GAAM,CAAC,EAAO,EAAI,CAAG,SACrB,AAAI,GAAS,EAAY,GAAO,GAAS,GAAO,EACzC,GAAO,GAAS,GAAO,EAChC,GAEA,GAAI,EAAO,CACT,IAAM,EAAM,CAAG,CAAC,EAAM,IAAI,CAAC,CAC3B,GAAI,EAAK,CACP,GAAM,CAAC,EAAU,EAAO,CAAG,EAAM,KAAK,CAElC,EAAM,EADE,EAEA,GAAK,CAAA,GAAO,GAAE,EAE1B,IAAI,EAAU,EAGd,GAFI,EALQ,GAKS,CAAA,GAAW,GAAE,EAE9B,AAAU,IAAV,EAAI,CAAC,CAAQ,CACf,IAAI,EAAS,EAAU,EAAI,CAAC,CACxB,EATM,GASU,CAAA,EATV,CASuB,EAC7B,EAAS,GAAK,CAAA,EAAS,CAAE,EAE7B,EAAI,AADJ,CAAA,EAAM,AAAC,CAAA,AAAC,EAAS,IAAO,GAAE,EAAK,GAAE,EACvB,IACZ,CACc,IAAV,EAAI,CAAC,EAEP,CAAA,EAAI,GAAQ,EAAK,CAAA,EAAI,AADF,CAAA,AAAmB,GAAnB,KAAK,GAAG,CAAC,EAAI,CAAC,EAAS,AAAQ,IAAR,EAAI,CAAC,CAAS,EAAI,CAAC,AAAD,EAC1B,GAAE,EAAE,EAE1B,IAAV,EAAI,CAAC,EAEP,CAAA,EAAI,GAAQ,EAAK,CAAA,EAAI,AADF,CAAA,AAAmB,GAAnB,KAAK,GAAG,CAAC,EAAI,CAAC,EAAS,AAAQ,IAAR,EAAI,CAAC,CAAS,EAAI,CAAC,AAAD,EAC1B,GAAE,EAAE,EAIxC,CAAC,EAAG,EAAG,EAAE,CAAG,GAAS,EAAG,EAAG,GAC7B,KACE,CAAC,EAAG,EAAG,EAAE,CAAG,GAAS,EAAG,EAAG,GAK/B,CAIA,IAAM,EAAO,AAAS,EAAI,IAAb,KAAoB,AAAS,EAAI,IAAb,KAAoB,AAAS,EAAI,IAAb,KAG/C,EAAS,GAAM,AAA8B,IAA7B,CAAA,EAAa,OAAO,EAAI,CAAA,EAGxC,EAAQ,KAAK,GAAG,CAAC,KAAO,GADhB,CAAA,GAAM,AAAC,CAAA,EAAa,QAAQ,EAAI,CAAA,EAAK,EAAE,GAIjD,EAAe,GAAQ,AAAC,CAAA,EAAS,CAAG,EAAK,GACzC,EAAkB,GAAQ,AAAC,CAAA,EAAO,CAAK,EAAK,GAC5C,EAAgB,KAAK,GAAG,CAAC,EAAG,EAAI,KAAK,GAAG,CAAC,EAAO,GAAU,GAM9D,GAAI,KAAK,GAAG,CAAC,EAAa,OAAO,CAAC,CAAC,EAAI,GAAK,KAAK,GAAG,CAAC,EAAa,OAAO,CAAC,CAAC,EAAI,EAAG,CAChF,GAAM,CAAC,EAAI,EAAI,EAAG,CAAG,GAAS,EAAa,OAAO,CAAC,CAAC,CAAG,IAAK,EAAa,OAAO,CAAC,CAAC,CAAE,IAC9E,EAAS,EAAa,OAAO,CAAC,CAAC,EAAI,EACzC,GAAK,AAAC,CAAA,EAAK,GAAE,EAAK,EANK,EAOvB,GAAK,AAAC,CAAA,EAAK,GAAE,EAAK,EAPK,EAQvB,GAAK,AAAC,CAAA,EAAK,GAAE,EAAK,EARK,EASvB,IAAM,EAAS,AAAS,IAAT,EAAe,EAC9B,GAAK,EACL,GAAK,EACL,GAAK,EACP,CAGA,GAAI,KAAK,GAAG,CAAC,EAAa,UAAU,CAAC,CAAC,EAAI,GAAK,KAAK,GAAG,CAAC,EAAa,UAAU,CAAC,CAAC,EAAI,EAAG,CACtF,GAAM,CAAC,EAAI,EAAI,EAAG,CAAG,GACnB,EAAa,UAAU,CAAC,CAAC,CAAG,IAC5B,EAAa,UAAU,CAAC,CAAC,CACzB,IAEI,EAAS,EAAa,UAAU,CAAC,CAAC,EAAI,EAC5C,GAAK,AAAC,CAAA,EAAK,GAAE,EAAK,EAvBK,EAwBvB,GAAK,AAAC,CAAA,EAAK,GAAE,EAAK,EAxBK,EAyBvB,GAAK,AAAC,CAAA,EAAK,GAAE,EAAK,EAzBK,EA0BvB,IAAM,EAAS,AAAS,IAAT,EAAe,EAC9B,GAAK,EACL,GAAK,EACL,GAAK,EACP,CAGA,GAAI,KAAK,GAAG,CAAC,EAAa,QAAQ,CAAC,CAAC,EAAI,GAAK,KAAK,GAAG,CAAC,EAAa,QAAQ,CAAC,CAAC,EAAI,EAAG,CAClF,GAAM,CAAC,EAAI,EAAI,EAAG,CAAG,GAAS,EAAa,QAAQ,CAAC,CAAC,CAAG,IAAK,EAAa,QAAQ,CAAC,CAAC,CAAE,IAChF,EAAS,EAAa,QAAQ,CAAC,CAAC,EAAI,EAC1C,GAAK,AAAC,CAAA,EAAK,GAAE,EAAK,EApCK,EAqCvB,GAAK,AAAC,CAAA,EAAK,GAAE,EAAK,EArCK,EAsCvB,GAAK,AAAC,CAAA,EAAK,GAAE,EAAK,EAtCK,EAuCvB,IAAM,EAAS,AAAS,IAAT,EAAe,EAC9B,GAAK,EACL,GAAK,EACL,GAAK,EACP,CAKA,IAAM,EAAO,EAAa,WAAW,EAAI,EACnC,EAAO,EAAa,IAAI,EAAI,EAClC,GAAI,AAAS,IAAT,EAAY,CACd,IAAM,EAAa,AAAO,GAAP,EACnB,GAAK,EACL,GAAK,EACP,CACA,GAAI,AAAS,IAAT,EAAY,CACd,IAAM,EAAa,AAAO,GAAP,EACnB,GAAK,EAEL,GAAK,AAAa,IAAb,EACL,GAAK,AAAa,IAAb,EACP,CAEA,CAAI,CAAC,EAAE,CAAG,GAAM,GAChB,CAAI,CAAC,EAAI,EAAE,CAAG,GAAM,GACpB,CAAI,CAAC,EAAI,EAAE,CAAG,GAAM,GACtB,CAEA,OAAO,EACT,ECrRa,GAAe,CAAC,CAC3B,MAAA,CAAK,CACL,MAAA,CAAK,CACL,IAAA,CAAG,CACH,IAAA,CAAG,CACH,KAAA,EAAO,CAAC,CACR,SAAA,CAAQ,CACR,SAAA,CAAQ,CACR,iBAAA,CAAgB,CACE,GAClB,WAAC,OAAI,UAAU,oCACb,WAAC,OACC,MAAO,CACL,MAAO,OACP,QAAS,OACT,eAAgB,gBAChB,WAAY,QACd,YAEA,UAAC,QAAK,UAAU,eAAe,MAAO,CAAE,SAAU,EAAG,WAClD,IAEH,UAAC,UAAW,EACV,IAAK,EACL,IAAK,EACL,KAAM,EACN,MAAO,EACP,SAAU,AAAC,GAAM,EAAS,OAAO,IACjC,OAAQ,UAAM,SAAA,IACd,UAAU,gBACV,KAAK,QACL,MAAO,CAAE,MAAO,GAAI,SAAU,EAAG,OAIrC,UAAC,UAAM,EACL,IAAK,EACL,IAAK,EACL,KAAM,EACN,MAAO,EACP,SAAU,EACV,iBAAkB,EAClB,UAAU,gBACV,MACE,CAAE,2BAA4B,EAAU,OAAQ,cAAe,EAEjE,YAAa,CAAE,QAAS,CAAE,OC9C1B,GAAgB,CACpB,CAAE,KAAM,MAAO,MAAO,SAAU,EAChC,CAAE,KAAM,SAAU,MAAO,SAAU,EACnC,CAAE,KAAM,SAAU,MAAO,SAAU,EACnC,CAAE,KAAM,QAAS,MAAO,SAAU,EAClC,CAAE,KAAM,OAAQ,MAAO,SAAU,EACjC,CAAE,KAAM,OAAQ,MAAO,SAAU,EACjC,CAAE,KAAM,SAAU,MAAO,SAAU,EACnC,CAAE,KAAM,UAAW,MAAO,SAAU,EACrC,CAEK,GAAoB,CAAC,EAAqB,SACjC,EAOA,EACC,EARd,IAAM,EAAO,SAAA,EAAA,GAAc,IAAI,CAAC,AAAC,GAAM,EAAE,IAAI,GAAK,cAArC,SAAA,EAAmD,KAAK,GAAI,UACnE,EAAQ,GAAc,SAAS,CAAC,AAAC,GAAM,EAAE,IAAI,GAAK,GAGxD,GAAI,AAAU,KAAV,EAAc,MAAO,OAEzB,IAAM,EAAU,EAAa,CAAC,EAAM,CAAC,KAAK,CACpC,EAAO,SAAA,EAAA,EAAa,CAAC,EAAQ,EAAE,YAAxB,SAAA,EAA0B,KAAK,GAAI,EAC1C,EAAQ,SAAA,EAAA,EAAa,CAAC,EAAQ,EAAE,YAAxB,SAAA,EAA0B,KAAK,GAAI,EAEjD,OAAQ,GACN,IAAK,IACH,MAAO,CAAC,uBAAuB,EAAE,EAAK,EAAE,EAAE,EAAQ,EAAE,EAAE,EAAM,CAAC,CAAC,CAChE,IAAK,IACH,MAAO,CAAC,6BAA6B,EAAE,EAAK,CAAC,CAAC,CAChD,IAAK,IACH,MAAO,CAAC,8BAA8B,EAAE,EAAK,QAAQ,CAAC,CACxD,QACE,MAAO,OACX,CACF,EAEM,GAAoC,CAAC,CACzC,YAAA,CAAW,CACX,SAAA,CAAQ,CACR,cAAe,CAAiB,CAChC,sBAAA,CAAqB,CACtB,IACC,GAAM,CAAC,EAAoB,EAAsB,CAAG,GAAA,UAAQ,EAAS,OAE/D,EAAgB,AAAsB,KAAA,IAAtB,EAAkC,EAAoB,EAUtE,EAAa,CAAW,CAAC,EAAc,EAAI,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,CAAE,EAE9D,EAAmB,CAAC,EAAwB,KAChD,EAAS,CACP,GAAG,CAAW,CACd,CAAC,EAAc,CAAE,CACf,GAAG,CAAW,CAAC,EAAc,CAC7B,CAAC,EAAM,CAAE,CACX,CACF,GACF,EAEA,MACE,WAAC,iBACC,UAAC,UAAI,EACH,UAAW,EACX,SAxBsB,AAAC,IACvB,EACF,EAAsB,GAEtB,EAAsB,GAE1B,EAmBM,KAAK,OACL,KAAK,QACL,MAAO,GAAY,GAAG,CAAC,AAAC,QAOJ,QAPe,CACjC,MACE,UAAC,QACC,MAAO,CACL,QAAS,eACT,MAAO,GACP,OAAQ,GACR,WAAY,SAAA,EAAA,GAAc,IAAI,CAAC,AAAC,GAAM,EAAE,IAAI,GAAK,EAAM,IAAI,aAA/C,SAAA,EAAkD,KAAK,GAAI,OACvE,aAAc,MACd,YAAa,CACf,EACA,MAAO,EAAM,IAAI,GAGrB,IAAK,EAAM,IAAI,AACjB,KACA,YAAY,MACZ,aAAc,IAEhB,WAAC,OAAI,MAAO,CAAE,UAAW,EAAG,YAC1B,UAAC,UAAU,CAAC,KAAK,EAAC,MAAO,EAAG,MAAO,CAAE,cAAe,YAAa,WAC9D,IAGH,UAAC,OAAI,MAAO,CAAE,aAAc,EAAG,WAC7B,UAAC,IACC,MAAO,CAAC,KAAK,EAAE,EAAW,CAAC,CAAC,KAAE,CAAC,CAC/B,IAAK,KACL,IAAK,IACL,MAAO,EAAW,CAAC,CACnB,SAAU,AAAC,GAAM,EAAiB,IAAK,GACvC,SAAU,GAAkB,EAAe,SAI/C,UAAC,OAAI,MAAO,CAAE,aAAc,EAAG,WAC7B,UAAC,IACC,MAAO,CAAC,YAAY,EAAE,KAAK,KAAK,CAAC,AAAe,IAAf,EAAW,CAAC,EAAQ,EAAE,CAAC,CACxD,IAAK,GACL,IAAK,EACL,KAAM,IACN,MAAO,EAAW,CAAC,CACnB,SAAU,AAAC,GAAM,EAAiB,IAAK,GACvC,SAAU,GAAkB,EAAe,SAI/C,UAAC,OAAI,MAAO,CAAE,aAAc,EAAG,WAC7B,UAAC,IACC,MAAO,CAAC,WAAW,EAAE,KAAK,KAAK,CAAC,AAAe,IAAf,EAAW,CAAC,EAAQ,EAAE,CAAC,CACvD,IAAK,GACL,IAAK,EACL,KAAM,IACN,MAAO,EAAW,CAAC,CACnB,SAAU,AAAC,GAAM,EAAiB,IAAK,GACvC,SAAU,GAAkB,EAAe,SAI/C,WAAC,SAAM,EACL,QAAS,KACP,EAAS,CACP,GAAG,CAAW,CACd,CAAC,EAAc,CAAE,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,CAAE,CACtC,GACF,EACA,KAAK,kBACN,SACQ,WAKjB,ECrJM,GAAyC,CAC7C,OAAQ,UACR,IAAK,UACL,MAAO,UACP,KAAM,SACR,EAEM,GAA0C,CAAC,CAAE,OAAA,CAAM,CAAE,SAAA,CAAQ,CAAE,IACnE,GAAM,CAAC,EAAe,EAAiB,CAAG,GAAA,UAAQ,EAAsC,UAClF,EAAY,GAAA,QAAM,EAAoB,MACtC,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAgB,MAEpD,EAAS,CAAM,CAAC,EAAc,CAGpC,GAAA,WAAS,EAAC,KACR,IAAM,EAAS,EAAU,OAAO,CAChC,GAAI,CAAC,EAAQ,OACb,IAAM,EAAM,EAAO,UAAU,CAAC,MAC9B,GAAI,CAAC,EAAK,OAEV,IAAM,EAAQ,EAAO,KAAK,CACpB,EAAS,EAAO,MAAM,CAG5B,EAAI,SAAS,CAAG,UAChB,EAAI,QAAQ,CAAC,EAAG,EAAG,EAAO,GAG1B,EAAI,WAAW,CAAG,UAClB,EAAI,SAAS,CAAG,EAChB,EAAI,SAAS,GACb,IAAK,IAAI,EAAI,EAAG,EAAI,EAAG,IAAK,CAC1B,IAAM,EAAM,AAAK,EAAQ,EAAb,EACZ,EAAI,MAAM,CAAC,EAAK,GAChB,EAAI,MAAM,CAAC,EAAK,GAChB,EAAI,MAAM,CAAC,EAAG,GACd,EAAI,MAAM,CAAC,EAAO,GACpB,CACA,EAAI,MAAM,GAGV,IAAM,EAAM,GAAgB,GAG5B,EAAI,WAAW,CAAG,EAAc,CAAC,EAAc,CAC/C,EAAI,SAAS,CAAG,EAChB,EAAI,SAAS,GACb,IAAK,IAAI,EAAI,EAAG,EAAI,IAAK,IAAK,CAC5B,IAAM,EAAI,CAAG,CAAC,EAAE,CAIV,EAAK,AAAC,EAAI,IAAO,EACjB,EAAK,EAAS,AAAC,EAAI,IAAO,EAC5B,AAAM,IAAN,EAAS,EAAI,MAAM,CAAC,EAAI,GACvB,EAAI,MAAM,CAAC,EAAI,GACtB,CACA,EAAI,MAAM,GAGV,EAAO,OAAO,CAAC,CAAC,EAAG,KACjB,IAAM,EAAK,AAAC,EAAE,CAAC,CAAG,IAAO,EACnB,EAAK,EAAS,AAAC,EAAE,CAAC,CAAG,IAAO,EAElC,EAAI,SAAS,CAAG,IAAM,EAAY,OAAS,OAC3C,EAAI,SAAS,GACb,EAAI,GAAG,CAAC,EAAI,EAAI,EAAG,EAAG,AAAU,EAAV,KAAK,EAAE,EAC7B,EAAI,IAAI,GACV,GACF,EAAG,CAAC,EAAQ,EAAe,EAAU,EAwErC,IAAM,EAAgB,KACpB,EAAa,MACf,EAsBA,MACE,WAAC,iBACC,WAAC,SAAK,EAAC,MAAO,CAAE,aAAc,EAAG,YAC/B,UAAC,UAAM,EACL,MAAO,EACP,SAAU,EACV,QAAS,CACP,CAAE,MAAO,eAAgB,MAAO,QAAS,EACzC,CAAE,MAAO,MAAO,MAAO,KAAM,EAC7B,CAAE,MAAO,QAAS,MAAO,OAAQ,EACjC,CAAE,MAAO,OAAQ,MAAO,MAAO,EAChC,CACD,MAAO,CAAE,MAAO,GAAI,IAEtB,UAAC,SAAM,EACL,QAAS,IACP,EAAS,CACP,GAAG,CAAM,CACT,CAAC,EAAc,CAAE,CACf,CAAE,EAAG,EAAG,EAAG,CAAE,EACb,CAAE,EAAG,IAAK,EAAG,GAAI,EAClB,AACH,YAEH,qBAKH,UAAC,OACC,UAAU,0BACV,MAAO,CAAE,OAAQ,AAAc,OAAd,EAAqB,WAAa,WAAY,WAE/D,UAAC,UACC,IAAK,EACL,MAAO,IACP,OAAQ,IACR,MAAO,CAAE,MAAO,OAAQ,SAAU,IAAK,WAAY,OAAQ,aAAc,CAAE,EAC3E,YApIgB,AAAC,IACvB,IAAM,EAAS,EAAU,OAAO,CAChC,GAAI,CAAC,EAAQ,OACb,IAAM,EAAO,EAAO,qBAAqB,GACnC,EAAI,AAAE,CAAA,EAAE,OAAO,CAAG,EAAK,IAAI,AAAD,EAAK,EAAK,KAAK,CAAI,IAC7C,EAAI,AAAC,CAAA,EAAI,AAAC,CAAA,EAAE,OAAO,CAAG,EAAK,GAAG,AAAD,EAAK,EAAK,MAAM,AAAD,EAAK,IAGjD,EAAK,KAAK,KAAK,CAAC,GAChB,EAAK,KAAK,KAAK,CAAC,GAIhB,EAAM,EAAO,SAAS,CAC1B,AAAC,GAAM,AAFS,GAET,KAAK,GAAG,CAAC,EAAE,CAAC,CAAG,IAAmB,AAFzB,GAEyB,KAAK,GAAG,CAAC,EAAE,CAAC,CAAG,IAG1D,GAAI,AAAQ,KAAR,EACF,EAAa,OACR,CAEL,IAAM,EAAW,CAAE,EAAG,EAAI,EAAG,CAAG,EAC1B,EAAY,IAAI,EAAQ,EAAS,CAAC,IAAI,CAAC,CAAC,EAAG,IAAM,EAAE,CAAC,CAAG,EAAE,CAAC,EAChE,EAAS,CAAE,GAAG,CAAM,CAAE,CAAC,EAAc,CAAE,CAAU,GAElC,EAAU,OAAO,CAAC,GAInC,CACF,EAuGQ,YArGgB,AAAC,IACvB,GAAI,AAAc,OAAd,EAAoB,OACxB,IAAM,EAAS,EAAU,OAAO,CAChC,GAAI,CAAC,EAAQ,OACb,IAAM,EAAO,EAAO,qBAAqB,GAErC,EAAI,AAAE,CAAA,EAAE,OAAO,CAAG,EAAK,IAAI,AAAD,EAAK,EAAK,KAAK,CAAI,IAC7C,EAAI,AAAC,CAAA,EAAI,AAAC,CAAA,EAAE,OAAO,CAAG,EAAK,GAAG,AAAD,EAAK,EAAK,MAAM,AAAD,EAAK,IAErD,EAAI,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,IAAK,IAC9B,EAAI,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,IAAK,IAE9B,IAAM,EAAY,IAAI,EAAO,CAQvB,EAAU,AAAc,IAAd,EACV,EAAS,IAAc,EAAO,MAAM,CAAG,EAEzC,GAAS,CAAA,EAAI,CAAA,EACb,GAAQ,CAAA,EAAI,GAAE,EAEb,GAAY,GAKf,CAAA,EAAI,KAAK,GAAG,CAAC,AAHC,CAAS,CAAC,EAAY,EAAE,CAAC,CAAC,CAGnB,EAAG,KAAK,GAAG,CAAC,AAFnB,CAAS,CAAC,EAAY,EAAE,CAAC,CAAC,CAEC,EAAG,GAAE,EAGhD,CAAS,CAAC,EAAU,CAAG,CAAE,EAAG,KAAK,KAAK,CAAC,GAAI,EAAG,KAAK,KAAK,CAAC,EAAG,EAC5D,EAAS,CAAE,GAAG,CAAM,CAAE,CAAC,EAAc,CAAE,CAAU,GACnD,EAkEQ,UAAW,EACX,aAAc,EACd,cA9DkB,AAAC,IAEzB,IAAM,EAAS,EAAU,OAAO,CAChC,GAAI,CAAC,EAAQ,OACb,IAAM,EAAO,EAAO,qBAAqB,GACnC,EAAI,AAAE,CAAA,EAAE,OAAO,CAAG,EAAK,IAAI,AAAD,EAAK,EAAK,KAAK,CAAI,IAC7C,EAAI,AAAC,CAAA,EAAI,AAAC,CAAA,EAAE,OAAO,CAAG,EAAK,GAAG,AAAD,EAAK,EAAK,MAAM,AAAD,EAAK,IAGjD,EAAM,EAAO,SAAS,CAC1B,AAAC,GAAM,AAFS,GAET,KAAK,GAAG,CAAC,EAAE,CAAC,CAAG,IAAkB,AAFxB,GAEwB,KAAK,GAAG,CAAC,EAAE,CAAC,CAAG,IAIzD,GAAI,EAAM,GAAK,EAAM,EAAO,MAAM,CAAG,EAAG,CACtC,IAAM,EAAY,EAAO,MAAM,CAAC,CAAC,EAAG,IAAM,IAAM,GAChD,EAAS,CAAE,GAAG,CAAM,CAAE,CAAC,EAAc,CAAE,CAAU,GACnD,CACF,SAiDF,kCCzNA,GAAM,CAAE,MAAA,EAAK,CAAE,CAAG,UAAQ,CAQpB,GAAsD,CAAC,CAAE,SAAA,CAAQ,CAAE,SAAA,CAAQ,CAAE,IACjF,IAAM,EAAa,CACjB,EACA,EACA,KAEA,EAAS,CACP,GAAG,CAAQ,CACX,CAAC,EAAK,CAAE,CACN,GAAG,CAAQ,CAAC,EAAK,CACjB,CAAC,EAAM,CAAE,CACX,CACF,GACF,EAEM,EAAe,CAAC,EAAwD,KAC5E,EAAS,CACP,GAAG,CAAQ,CACX,CAAC,EAAM,CAAE,CACX,GACF,EAIM,EAAwB,AAAC,GAC7B,CAAC,oCAAoC,EAAE,EAAI,aAAa,CAAC,CAE3D,MACE,WAAC,iBACC,WAAC,UAAQ,EAAC,iBAAkB,CAAC,UAAW,WAAY,aAAa,CAAE,KAAK,cACtE,WAAC,IAAM,OAAO,oBACZ,UAAC,IACC,MAAO,CAAC,KAAK,EAAE,KAAK,KAAK,CAAC,EAAS,OAAO,CAAC,CAAC,EAAE,KAAE,CAAC,CACjD,IAAK,EACL,IAAK,IACL,MAAO,EAAS,OAAO,CAAC,CAAC,CACzB,SAAU,AAAC,GAAM,EAAW,UAAW,IAAK,GAC5C,QAAQ,qGAEV,UAAC,IACC,MAAO,CAAC,YAAY,EAAE,KAAK,KAAK,CAAC,AAAqB,IAArB,EAAS,OAAO,CAAC,CAAC,EAAQ,EAAE,CAAC,CAC9D,IAAK,EACL,IAAK,EACL,KAAM,IACN,MAAO,EAAS,OAAO,CAAC,CAAC,CACzB,SAAU,AAAC,GAAM,EAAW,UAAW,IAAK,GAC5C,SAAU,EAAsB,EAAS,OAAO,CAAC,CAAC,IAEpD,UAAC,IACC,MAAO,CAAC,WAAW,EAAE,KAAK,KAAK,CAAC,AAAqB,IAArB,EAAS,OAAO,CAAC,CAAC,EAAQ,EAAE,CAAC,CAC7D,IAAK,GACL,IAAK,EACL,KAAM,IACN,MAAO,EAAS,OAAO,CAAC,CAAC,CACzB,SAAU,AAAC,GAAM,EAAW,UAAW,IAAK,GAC5C,SAAU,kDAzBc,WA8B5B,WAAC,IAAM,OAAO,qBACZ,UAAC,IACC,MAAO,CAAC,KAAK,EAAE,KAAK,KAAK,CAAC,EAAS,QAAQ,CAAC,CAAC,EAAE,KAAE,CAAC,CAClD,IAAK,EACL,IAAK,IACL,MAAO,EAAS,QAAQ,CAAC,CAAC,CAC1B,SAAU,AAAC,GAAM,EAAW,WAAY,IAAK,GAC7C,QAAQ,qGAEV,UAAC,IACC,MAAO,CAAC,YAAY,EAAE,KAAK,KAAK,CAAC,AAAsB,IAAtB,EAAS,QAAQ,CAAC,CAAC,EAAQ,EAAE,CAAC,CAC/D,IAAK,EACL,IAAK,EACL,KAAM,IACN,MAAO,EAAS,QAAQ,CAAC,CAAC,CAC1B,SAAU,AAAC,GAAM,EAAW,WAAY,IAAK,GAC7C,SAAU,EAAsB,EAAS,QAAQ,CAAC,CAAC,IAErD,UAAC,IACC,MAAO,CAAC,WAAW,EAAE,KAAK,KAAK,CAAC,AAAsB,IAAtB,EAAS,QAAQ,CAAC,CAAC,EAAQ,EAAE,CAAC,CAC9D,IAAK,GACL,IAAK,EACL,KAAM,IACN,MAAO,EAAS,QAAQ,CAAC,CAAC,CAC1B,SAAU,AAAC,GAAM,EAAW,WAAY,IAAK,GAC7C,SAAU,kDAzBe,YA6B7B,WAAC,IAAM,OAAO,uBACZ,UAAC,IACC,MAAO,CAAC,KAAK,EAAE,KAAK,KAAK,CAAC,EAAS,UAAU,CAAC,CAAC,EAAE,KAAE,CAAC,CACpD,IAAK,EACL,IAAK,IACL,MAAO,EAAS,UAAU,CAAC,CAAC,CAC5B,SAAU,AAAC,GAAM,EAAW,aAAc,IAAK,GAC/C,QAAQ,qGAEV,UAAC,IACC,MAAO,CAAC,YAAY,EAAE,KAAK,KAAK,CAAC,AAAwB,IAAxB,EAAS,UAAU,CAAC,CAAC,EAAQ,EAAE,CAAC,CACjE,IAAK,EACL,IAAK,EACL,KAAM,IACN,MAAO,EAAS,UAAU,CAAC,CAAC,CAC5B,SAAU,AAAC,GAAM,EAAW,aAAc,IAAK,GAC/C,SAAU,EAAsB,EAAS,UAAU,CAAC,CAAC,IAEvD,UAAC,IACC,MAAO,CAAC,WAAW,EAAE,KAAK,KAAK,CAAC,AAAwB,IAAxB,EAAS,UAAU,CAAC,CAAC,EAAQ,EAAE,CAAC,CAChE,IAAK,GACL,IAAK,EACL,KAAM,IACN,MAAO,EAAS,UAAU,CAAC,CAAC,CAC5B,SAAU,AAAC,GAAM,EAAW,aAAc,IAAK,GAC/C,SAAU,kDAzBiB,iBA8BjC,WAAC,OAAI,MAAO,CAAE,UAAW,EAAG,YAC1B,UAAC,IACC,MAAO,CAAC,UAAU,EAAE,KAAK,KAAK,CAAC,AAAoB,IAApB,EAAS,QAAQ,EAAQ,EAAE,CAAC,CAC3D,IAAK,EACL,IAAK,EACL,KAAM,IACN,MAAO,EAAS,QAAQ,CACxB,SAAU,AAAC,GAAM,EAAa,WAAY,GAC1C,SAAU,gDAEZ,UAAC,IACC,MAAO,CAAC,SAAS,EAAE,KAAK,KAAK,CAAC,AAAmB,IAAnB,EAAS,OAAO,EAAQ,EAAE,CAAC,CACzD,IAAK,GACL,IAAK,EACL,KAAM,IACN,MAAO,EAAS,OAAO,CACvB,SAAU,AAAC,GAAM,EAAa,UAAW,GACzC,SAAU,gDAEZ,UAAC,IACC,MAAO,CAAC,aAAa,EAAE,KAAK,KAAK,CAAC,AAAuB,IAAvB,EAAS,WAAW,EAAQ,EAAE,CAAC,CACjE,IAAK,GACL,IAAK,EACL,KAAM,IACN,MAAO,EAAS,WAAW,CAC3B,SAAU,AAAC,GAAM,EAAa,cAAe,GAC7C,SAAU,sDAEZ,UAAC,IACC,MAAO,CAAC,MAAM,EAAE,KAAK,KAAK,CAAC,AAAgB,IAAhB,EAAS,IAAI,EAAQ,EAAE,CAAC,CACnD,IAAK,GACL,IAAK,EACL,KAAM,IACN,MAAO,EAAS,IAAI,CACpB,SAAU,AAAC,GAAM,EAAa,OAAQ,GACtC,SAAU,yDAWd,UAAC,SAAM,EACL,QAAS,IACP,EAAS,CACP,QAAS,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,CAAE,EAC5B,SAAU,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,CAAE,EAC7B,WAAY,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,CAAE,EAC/B,SAAU,GACV,QAAS,EACT,YAAa,EACb,KAAM,CACR,GAEF,MAAO,CAAE,UAAW,EAAG,WACxB,qBAKP,8DCzLA,IAAM,GAA4C,CAAC,CAAE,UAAA,CAAS,CAAE,QAAA,CAAO,CAAE,UAAA,CAAS,CAAE,SAAA,CAAQ,CAAE,IAC5F,IAAM,EAAU,GAAA,SAAO,EAAC,IACf,CAAA,CACL,MAAO,CACL,gBAAiB,UACjB,OAAQ,IACR,QAAS,CAAC,EAAG,EAAG,EAAG,EAAE,AACvB,EACA,MAAO,CAAE,KAAM,EAAG,EAClB,MAAO,CACL,MAAO,CAAE,KAAM,GAAI,MAAO,CAAE,MAAO,MAAO,CAAE,EAE5C,OAAQ,CAAE,MAAO,CAAE,MAAO,OAAQ,SAAU,KAAM,CAAE,EACpD,cAAe,uBACjB,EACA,MAAO,CACL,MAAO,CAAE,KAAM,GAAI,MAAO,CAAE,MAAO,MAAO,CAAE,EAC5C,OAAQ,CAAE,MAAO,CAAE,MAAO,OAAQ,SAAU,KAAM,CAAE,EACpD,cAAe,uBACjB,EACA,OAAQ,CAAE,QAAS,CAAA,CAAM,EACzB,YAAa,CACX,UAAW,CAAE,SAAU,CAAE,EACzB,OAAQ,CAAE,UAAW,CAAA,EAAO,OAAQ,CAAE,QAAS,CAAA,CAAM,CAAE,CACzD,EACA,OAAQ,CACN,CACE,KAAM,MACN,KAAM,EACN,MAAO,UACP,OAAQ,EACR,UAAW,EACX,OAAQ,CACN,OAAQ,CACV,CACF,EACA,CACE,KAAM,QACN,KAAM,EACN,MAAO,UACP,OAAQ,EACR,UAAW,EACX,OAAQ,CACN,OAAQ,CACV,CACF,EACA,CACE,KAAM,OACN,KAAM,EACN,MAAO,UACP,OAAQ,EACR,UAAW,EACX,OAAQ,CACN,OAAQ,CACV,CACF,EACD,CACD,QAAS,CAAE,QAAS,CAAA,CAAM,EAC1B,QAAS,CAAE,QAAS,CAAA,CAAM,CAC5B,CAAA,EACC,CAAC,EAAS,EAAW,EAAS,EAEjC,MAAO,UAAC,UAAe,EAAC,WAAY,UAAU,CAAE,QAAS,IAC3D,EChEM,CAAE,KAAA,EAAI,CAAE,CAAG,UAAU,CASrB,GAAgD,CAAC,CACrD,QAAA,CAAO,CACP,SAAA,CAAQ,CACR,QAAA,CAAO,CACP,aAAA,CAAY,CACb,IACC,GAAM,CAAC,EAAS,EAAW,CAAG,GAAA,UAAQ,EAAC,CAAA,GACjC,EAAmB,GAAA,QAAM,EAAoB,MAC7C,CAAC,EAAY,EAAc,CAAG,GAAA,UAAQ,EAAC,CAAA,GACvC,CAAC,EAAS,EAAW,CAAG,GAAA,UAAQ,EAAW,AAAI,MAAM,KAAK,IAAI,CAAC,IAC/D,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAW,AAAI,MAAM,KAAK,IAAI,CAAC,IACnE,CAAC,EAAU,EAAY,CAAG,GAAA,UAAQ,EAAW,AAAI,MAAM,KAAK,IAAI,CAAC,IAEjE,EAAqC,GAAA,SAAO,EAAC,KACjD,IAAM,EAAW,CAAC,EAGlB,OAFA,GAAY,OAAO,CAAC,AAAC,GAAO,CAAG,CAAC,EAAE,IAAI,CAAC,CAAG,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,CAAE,GAEtD,CACL,IAAA,EACA,OAAQ,CACN,OAAQ,CACN,CAAE,EAAG,EAAG,EAAG,CAAE,EACb,CAAE,EAAG,IAAK,EAAG,GAAI,EAClB,CACD,IAAK,CACH,CAAE,EAAG,EAAG,EAAG,CAAE,EACb,CAAE,EAAG,IAAK,EAAG,GAAI,EAClB,CACD,MAAO,CACL,CAAE,EAAG,EAAG,EAAG,CAAE,EACb,CAAE,EAAG,IAAK,EAAG,GAAI,EAClB,CACD,KAAM,CACJ,CAAE,EAAG,EAAG,EAAG,CAAE,EACb,CAAE,EAAG,IAAK,EAAG,GAAI,EAClB,AACH,EACA,aAAc,CACZ,QAAS,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,CAAE,EAC5B,SAAU,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,CAAE,EAC7B,WAAY,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,CAAE,EAC/B,SAAU,GACV,QAAS,EACT,YAAa,EACb,KAAM,CACR,CACF,EACF,EAAG,EAAE,EAEC,CAAC,EAAU,EAAY,CAAG,GAAA,UAAQ,EAAoB,GAGtD,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAC,CAAA,GACrC,CAAC,EAAkB,EAAoB,CAAG,GAAA,UAAQ,EAAS,OAC3D,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAC,OACrC,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAkC,MACtE,CAAC,EAAc,EAAgB,CAAG,GAAA,UAAQ,EAC9C,MAIF,GAAA,WAAS,EAAC,KACJ,GACF,EAAY,GAEhB,EAAG,CAAC,EAAS,EAAgB,EAG7B,GAAA,WAAS,EAAC,KACR,GAAI,CAAC,GAAW,CAAC,GAAgB,CAAC,EAAiB,OAAO,CAAE,OAE5D,IAAM,EAAS,EAAiB,OAAO,CAGjC,EAAQ,WAAW,KAEvB,IAAI,EAAe,EAAa,KAAK,CACjC,EAAgB,EAAa,MAAM,CAEvC,GAAI,EAAa,KAAK,CAJG,KAIoB,EAAa,MAAM,CAJvC,IAI4D,CACnF,IAAM,EAAQ,KAAK,GAAG,CACpB,AANqB,IAMF,EAAa,KAAK,CACrC,AAPqB,IAOF,EAAa,MAAM,EAExC,EAAe,KAAK,KAAK,CAAC,EAAa,KAAK,CAAG,GAC/C,EAAgB,KAAK,KAAK,CAAC,EAAa,MAAM,CAAG,GACnD,CAEA,EAAO,KAAK,CAAG,EACf,EAAO,MAAM,CAAG,EAEhB,IAAM,EAAM,EAAO,UAAU,CAAC,MAC9B,GAAI,CAAC,EAAK,OAGV,EAAI,SAAS,CAAC,EAAc,EAAG,EAAG,EAAc,GAGhD,IAAM,EAAY,EAAI,YAAY,CAAC,EAAG,EAAG,EAAc,GAGvD,GAAI,EAAY,CAEd,IAAM,EAAQ,AAAI,MAAM,KAAK,IAAI,CAAC,GAC5B,EAAQ,AAAI,MAAM,KAAK,IAAI,CAAC,GAC5B,EAAQ,AAAI,MAAM,KAAK,IAAI,CAAC,GAC5B,EAAI,EAAU,IAAI,CACxB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAE,MAAM,CAAE,GAAK,EACjC,CAAK,CAAC,CAAC,CAAC,EAAE,CAAC,EAAI,EACf,CAAK,CAAC,CAAC,CAAC,EAAI,EAAE,CAAC,EAAI,EACnB,CAAK,CAAC,CAAC,CAAC,EAAI,EAAE,CAAC,EAAI,EAErB,EAAW,GACX,EAAa,GACb,EAAY,GAGd,KAAO,CAEL,GAAuB,EAAW,GAGlC,IAAM,EAAQ,AAAI,MAAM,KAAK,IAAI,CAAC,GAC5B,EAAQ,AAAI,MAAM,KAAK,IAAI,CAAC,GAC5B,EAAQ,AAAI,MAAM,KAAK,IAAI,CAAC,GAC5B,EAAI,EAAU,IAAI,CACxB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAE,MAAM,CAAE,GAAK,EACjC,CAAK,CAAC,CAAC,CAAC,EAAE,CAAC,EAAI,EACf,CAAK,CAAC,CAAC,CAAC,EAAI,EAAE,CAAC,EAAI,EACnB,CAAK,CAAC,CAAC,CAAC,EAAI,EAAE,CAAC,EAAI,EAErB,EAAW,GACX,EAAa,GACb,EAAY,GAGZ,EAAI,YAAY,CAAC,EAAW,EAAG,GACjC,CACF,EAAG,IAEH,MAAO,IAAM,aAAa,GAC5B,EAAG,CAAC,EAAS,EAAc,EAAU,EAAW,EAEhD,IAAM,EAAc,UACb,IACL,EAAW,CAAA,GAEX,WAAW,KACT,IAAM,EAAa,SAAS,aAAa,CAAC,UAC1C,EAAW,KAAK,CAAG,EAAa,KAAK,CACrC,EAAW,MAAM,CAAG,EAAa,MAAM,CACvC,IAAM,EAAM,EAAW,UAAU,CAAC,MAClC,GAAI,CAAC,EAAK,CACR,EAAW,CAAA,GACX,OACF,CAEA,EAAI,SAAS,CAAC,EAAc,EAAG,GAC/B,IAAM,EAAY,EAAI,YAAY,CAAC,EAAG,EAAG,EAAa,KAAK,CAAE,EAAa,MAAM,EAEhF,GAAuB,EAAW,GAClC,EAAI,YAAY,CAAC,EAAW,EAAG,GAE/B,EAAQ,GACR,EAAW,CAAA,GACb,EAAG,MACL,EAEM,EAAoB,AACxB,QAQI,EAAS,EALb,IAAM,EAAQ,AAAC,EAAuB,MAAM,CAC5C,GAAI,AAAC,CAAC,GAAa,CAAC,GAAU,CAAC,EAAiB,OAAO,CAAE,OAEzD,IAAM,EAAS,EAAiB,OAAO,CACjC,EAAO,EAAO,qBAAqB,GAGrC,YAAa,GACf,EAAU,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,CAC9B,EAAU,EAAE,OAAO,CAAC,EAAE,CAAC,OAAO,GAE9B,EAAU,AAAC,EAAuB,OAAO,CACzC,EAAU,AAAC,EAAuB,OAAO,EAG3C,IAAM,EAAI,EAAU,EAAK,IAAI,CACvB,EAAI,EAAU,EAAK,GAAG,CAEtB,EAAS,EAAO,KAAK,CAAG,EAAK,KAAK,CAClC,EAAS,EAAO,MAAM,CAAG,EAAK,MAAM,CACpC,EAAU,KAAK,KAAK,CAAC,EAAI,GACzB,EAAU,KAAK,KAAK,CAAC,EAAI,GAEzB,EAAM,EAAO,UAAU,CAAC,MAC9B,GAAI,CAAC,EAAK,OASV,IAAM,EAAO,AANK,EAAI,YAAY,CAChC,KAAK,GAAG,CAAC,EAAG,EAAU,GACtB,KAAK,GAAG,CAAC,EAAG,EAAU,GAHX,EAAA,GAOU,IAAI,CAC3B,GAAI,AAAgB,IAAhB,EAAK,MAAM,CAAQ,OAEvB,IAAI,EAAI,EACN,EAAI,EACJ,EAAI,EACA,EAAQ,EAAK,MAAM,CAAG,EAC5B,IAAK,IAAI,EAAI,EAAG,EAAI,EAAK,MAAM,CAAE,GAAK,EACpC,GAAK,CAAI,CAAC,EAAE,CACZ,GAAK,CAAI,CAAC,EAAI,EAAE,CAChB,GAAK,CAAI,CAAC,EAAI,EAAE,CAMlB,GAAM,CAAC,EAAG,EAAG,EAAE,CAAG,GAJlB,EAAI,KAAK,KAAK,CAAC,EAAI,GACnB,EAAI,KAAK,KAAK,CAAC,EAAI,GACnB,EAAI,KAAK,KAAK,CAAC,EAAI,IAGb,EAAS,AAAI,IAAJ,EAIf,EAFgB,GAAoB,IAGpC,EAAa,OACb,EAAgB,CAAE,EAAG,EAAQ,EAAA,EAAG,EAAA,CAAE,GAClC,EAAa,CAAE,EAAA,EAAG,EAAA,CAAE,GACtB,EAEM,EAAY,CAChB,CACE,IAAK,MACL,MAAO,YACP,SACE,UAAC,IACC,YAAa,EAAS,GAAG,CACzB,SAAU,AAAC,GAAQ,EAAY,CAAE,GAAG,CAAQ,CAAE,IAAA,CAAI,GAClD,cAAe,EACf,sBAAuB,GAG7B,EACA,CACE,IAAK,SACL,MAAO,SACP,SACE,UAAC,IACC,OAAQ,EAAS,MAAM,CACvB,SAAU,AAAC,GAAW,EAAY,CAAE,GAAG,CAAQ,CAAE,OAAA,CAAO,IAG9D,EACA,CACE,IAAK,UACL,MAAO,gBACP,SACE,UAAC,IACC,SAAU,EAAS,YAAY,CAC/B,SAAU,AAAC,GAAiB,EAAY,CAAE,GAAG,CAAQ,CAAE,aAAA,CAAa,IAG1E,EACD,CAED,MACE,UAAC,UAAK,EACJ,MAAM,oBACN,KAAM,EACN,SAAU,EACV,MAAO,KACP,KAAM,EACN,eAAgB,EAChB,OAAO,QACP,MAAO,CAAE,IAAK,EAAG,WAEjB,WAAC,UAAG,EAAC,OAAQ,aACX,UAAC,UAAG,EACF,KAAM,GACN,MAAO,CACL,UAAW,SACX,WAAY,UACZ,QAAS,GACT,QAAS,OACT,WAAY,SACZ,eAAgB,SAChB,UAAW,IACX,cAAe,QACjB,WAEA,WAAC,OACC,MAAO,CACL,MAAO,OACP,QAAS,OACT,eAAgB,SAChB,SAAU,UACZ,YAEA,WAAC,OACC,MAAO,CACL,SAAU,WACV,MAAO,GACP,IAAK,GACL,OAAQ,EACR,QAAS,OACT,IAAK,CACP,YAEA,UAAC,SAAO,EAAC,MAAM,4CACb,UAAC,SAAM,EACL,KAAK,QACL,KAAM,EAAY,UAAY,UAC9B,KAAM,UAAC,UAAW,KAClB,QAAS,KACP,EAAa,CAAC,GACd,EAAa,MACf,MAGJ,UAAC,SAAM,EACL,KAAK,QACL,KAAM,EAAa,UAAC,UAAoB,KAAM,UAAC,UAAW,KAC1D,QAAS,IAAM,EAAc,AAAC,GAAM,CAAC,QAGzC,WAAC,OAAI,MAAO,CAAE,SAAU,WAAY,QAAS,cAAe,YAC1D,UAAC,UACC,IAAK,EACL,QAAS,EACT,aAAc,EACd,MAAO,CACL,SAAU,OACV,UAAW,QACX,OAAQ,iBACR,UAAW,6BACX,OAAQ,EAAY,YAAc,UAClC,QAAS,OACX,IAED,GAAa,GAAa,GACzB,WAAC,OACC,MAAO,CACL,SAAU,WACV,KAAM,EAAU,CAAC,CACjB,IAAK,EAAU,CAAC,CAChB,UAAW,wBACX,cAAe,OACf,OAAQ,EACV,YAEA,UAAC,OACC,MAAO,CACL,MAAO,GACP,OAAQ,GACR,OAAQ,kBACR,aAAc,MACd,UAAW,eACb,IAEF,WAAC,OACC,MAAO,CACL,SAAU,WACV,IAAK,GACL,KAAM,EACN,WAAY,kBACZ,MAAO,OACP,QAAS,UACT,aAAc,EACd,SAAU,GACV,WAAY,QACd,YACD,KACI,KAAK,KAAK,CAAC,EAAa,CAAC,EAAE,MAAI,KAAK,KAAK,CAAC,AAAiB,IAAjB,EAAa,CAAC,EAAQ,MAClE,KAAK,KAAK,CAAC,AAAiB,IAAjB,EAAa,CAAC,gBAOtC,WAAC,UAAG,EAAC,KAAM,YACT,UAAC,OAAI,MAAO,CAAE,MAAO,MAAO,WAC1B,UAAC,IACC,UAAW,EACX,QAAS,EACT,UAAW,EACX,SAAU,MAId,UAAC,OAAI,MAAO,CAAE,UAAW,GAAI,aAAc,GAAI,QAAS,OAAQ,WAC9D,WAAC,UAAG,EAAC,OAAQ,CAAC,GAAI,EAAE,WAClB,WAAC,UAAG,EAAC,KAAM,aACT,UAAC,IAAK,KAAK,YAAY,MAAO,CAAE,SAAU,GAAI,QAAS,OAAQ,WAAG,eAGlE,UAAC,IAAK,MAAO,CAAE,SAAU,EAAG,WACzB,EAAe,CAAC,EAAE,EAAa,KAAK,CAAC,MAAG,EAAE,EAAa,MAAM,CAAC,CAAC,CAAG,WAGvE,WAAC,UAAG,EAAC,KAAM,YACT,UAAC,IAAK,KAAK,YAAY,MAAO,CAAE,SAAU,GAAI,QAAS,OAAQ,WAAG,QAGlE,UAAC,IAAK,MAAO,CAAE,SAAU,EAAG,WAAG,UAEjC,WAAC,UAAG,EAAC,KAAM,YACT,UAAC,IAAK,KAAK,YAAY,MAAO,CAAE,SAAU,GAAI,QAAS,OAAQ,WAAG,QAGlE,UAAC,IAAK,MAAO,CAAE,SAAU,EAAG,WAAG,eAKrC,UAAC,UAAI,EAAC,UAAW,EAAW,SAAU,EAAc,MAAO,YAKrE,EC3YM,GAAoB,KACxB,GAAM,CAAE,OAAA,CAAM,CAAE,cAAA,CAAa,CAAE,WAAA,CAAU,CAAE,QAAA,CAAO,CAAE,eAAA,CAAc,CAAE,UAAA,CAAS,CAAE,aAAA,CAAY,CAAE,CAC3F,GAAA,gBAAc,IACV,EAAc,GAAA,QAAM,EAAgB,MACpC,EAAkB,GAAA,QAAM,EAAC,CAAA,GACzB,CAAC,EAAoB,EAAsB,CAAG,GAAA,UAAQ,EAAC,CAAA,GACvD,CAAC,EAAkB,EAAoB,CAAG,GAAA,UAAQ,EAAC,CAAA,GACnD,CAAC,EAAkB,EAAoB,CAAG,GAAA,UAAQ,EAAC,CAAA,GACnD,CAAC,EAAqB,EAAuB,CAAG,GAAA,UAAQ,EAAC,CAAA,GACzD,CAAC,EAAkB,EAAoB,CAAG,GAAA,UAAQ,EAAC,CAAA,GACnD,CAAC,EAAkB,EAAoB,CAAG,GAAA,UAAQ,EAAC,CAAA,GAEnD,CACJ,cAAA,CAAa,CACb,YAAA,CAAW,CACX,cAAA,CAAa,CACb,aAAA,CAAY,CACZ,sBAAA,CAAqB,CACrB,oBAAA,CAAmB,CACpB,CAAG,KAEE,EAAoB,KACxB,GAAI,CAAC,EAAQ,OACb,IAAM,EAAO,EAAO,MAAM,GAE1B,EADgB,EAAO,SAAS,CAAC,CAAE,OAAQ,MAAO,WAAY,EAAI,GAC7C,GACvB,EAaM,EAAa,KACZ,IAEL,EAAO,mBAAmB,GAC1B,EAAO,KAAK,GAEZ,EAAQ,SAAS,GACjB,KACF,EAEM,EAAO,UACX,GAAI,CAAC,EAAQ,OACb,IAAM,EAAe,EAAO,eAAe,GACvC,GAEF,EADe,MAAM,EAAa,KAAK,IAG3C,EAEM,EAAQ,UACZ,GAAI,CAAC,GAAU,CAAC,EAAW,OAC3B,IAAM,EAAY,MAAM,EAAU,KAAK,GACvC,EAAO,mBAAmB,GAE1B,EAAU,GAAG,CAAC,CACZ,KAAM,AAAC,CAAA,EAAU,IAAI,EAAI,CAAA,EAAK,GAC9B,IAAK,AAAC,CAAA,EAAU,GAAG,EAAI,CAAA,EAAK,GAC5B,QAAS,CAAA,CACX,GAEI,aAAqB,kBAAe,EAEtC,EAAU,MAAM,CAAG,EACnB,EAAU,aAAa,CAAC,AAAC,IACvB,EAAO,GAAG,CAAC,GACb,GACA,EAAU,SAAS,IAEnB,EAAO,GAAG,CAAC,GAGb,EAAO,eAAe,CAAC,GACvB,EAAO,gBAAgB,GACvB,EAAQ,SAAS,GACnB,EA6BA,GAAA,WAAS,EAAC,KACR,IAAM,EAAgB,AAAC,IAErB,GACE,AAAsC,UAAtC,AAAC,EAAE,MAAM,CAAiB,OAAO,EACjC,AAAsC,aAAtC,AAAC,EAAE,MAAM,CAAiB,OAAO,EAOjC,CAAA,CAAA,CAAA,OAAA,SAAA,EAAQ,eAAe,cAAc,QAAK,AAAD,IACzC,AAAC,EAAO,eAAe,GAAa,SAAS,AAAD,GAM9C,GAAI,AAAW,UAAX,EAAE,IAAI,CAAc,CACjB,EAAgB,OAAO,GAC1B,EAAgB,OAAO,CAAG,CAAA,EAC1B,EAAY,OAAO,CAAG,EACH,SAAf,GAAuB,EAAc,SAE3C,EAAE,cAAc,GAChB,OACF,CAEI,CAAA,AAAU,MAAV,EAAE,GAAG,EAAY,AAAU,MAAV,EAAE,GAAG,AAAO,GAAG,EAAc,UAC9C,CAAA,AAAU,MAAV,EAAE,GAAG,EAAY,AAAU,MAAV,EAAE,GAAG,AAAO,GAAG,EAAc,QAC9C,CAAA,AAAU,MAAV,EAAE,GAAG,EAAY,AAAU,MAAV,EAAE,GAAG,AAAO,GAAG,EAAc,SACpC,MAAV,EAAE,GAAG,EAAY,AAAU,MAAV,EAAE,GAAG,EAClB,EAAE,OAAO,EAAI,EAAE,OAAO,EAC1B,EAAoB,CAAA,GAGpB,CAAA,AAAU,MAAV,EAAE,GAAG,EAAY,AAAU,MAAV,EAAE,GAAG,AAAO,GAC3B,aAA0B,cAAW,EAAE,EAAoB,CAAA,GAE7D,CAAA,AAAU,MAAV,EAAE,GAAG,EAAY,AAAU,MAAV,EAAE,GAAG,AAAO,GAAG,IAChC,CAAA,AAAU,MAAV,EAAE,GAAG,EAAY,AAAU,MAAV,EAAE,GAAG,AAAO,GAAG,EAAc,QAE9C,CAAA,AAAU,WAAV,EAAE,GAAG,EAAiB,AAAU,cAAV,EAAE,GAAG,AAAe,GAAG,IAE5C,CAAA,EAAE,OAAO,EAAI,EAAE,OAAO,AAAD,GAAO,CAAA,AAAU,MAAV,EAAE,GAAG,EAAY,AAAU,MAAV,EAAE,GAAG,AAAO,IAC5D,EAAE,cAAc,GACZ,EAAE,QAAQ,CACZ,EAAQ,IAAI,GAEZ,EAAQ,IAAI,IAGX,CAAA,EAAE,OAAO,EAAI,EAAE,OAAO,AAAD,GAAM,AAAU,MAAV,EAAE,GAAG,GACnC,EAAE,cAAc,GAChB,EAAQ,IAAI,IAGT,CAAA,EAAE,OAAO,EAAI,EAAE,OAAO,AAAD,GAAM,AAAU,MAAV,EAAE,GAAG,GACnC,EAAE,cAAc,GAChB,KASG,CAAA,EAAE,OAAO,EAAI,EAAE,OAAO,AAAD,GAAM,AAAU,MAAV,EAAE,GAAG,GACnC,EAAE,cAAc,GAChB,KAGG,CAAA,EAAE,OAAO,EAAI,EAAE,OAAO,AAAD,GAAM,EAAE,QAAQ,EAAI,AAAU,MAAV,EAAE,GAAG,GACjD,EAAE,cAAc,GAChB,EAAsB,CAAA,IAGnB,CAAA,EAAE,OAAO,EAAI,EAAE,OAAO,AAAD,GAAM,AAAU,MAAV,EAAE,GAAG,GACnC,EAAE,cAAc,GAChB,MAEJ,EAEM,EAAc,AAAC,IACnB,GAAI,AAAW,UAAX,EAAE,IAAI,EAAgB,EAAgB,OAAO,CAAE,CACjD,EAAgB,OAAO,CAAG,CAAA,EAC1B,IAAM,EAAO,EAAY,OAAO,CAChC,EAAY,OAAO,CAAG,KAClB,GAAQ,AAAS,SAAT,GACV,EAAc,GAEhB,EAAE,cAAc,GAClB,CACF,EAIA,OAFA,OAAO,gBAAgB,CAAC,UAAW,GACnC,OAAO,gBAAgB,CAAC,QAAS,GAC1B,KACL,OAAO,mBAAmB,CAAC,UAAW,GACtC,OAAO,mBAAmB,CAAC,QAAS,GACtC,EACF,EAAG,CAAC,EAAQ,EAAgB,EAAS,EAAY,EAAU,EAG3D,GAAA,WAAS,EAAC,KACR,IAAM,EAAc,AAAC,QAEL,EAAd,IAAM,UAAQ,EAAA,EAAE,aAAa,YAAf,SAAA,EAAiB,KAAK,EACnB,CAAA,GAAS,MAAM,IAAI,CAAC,GAAO,IAAI,CAAC,AAAC,GAAS,EAAK,IAAI,CAAC,QAAQ,CAAC,SAAQ,GAQlF,IACF,EAAE,cAAc,GAChB,KAEJ,EAGA,OADA,OAAO,gBAAgB,CAAC,QAAS,GAC1B,IAAM,OAAO,mBAAmB,CAAC,QAAS,GACnD,EAAG,CAAC,EAAW,EAAQ,EAAQ,EAG/B,GAAA,WAAS,EAAC,KACR,GAAI,CAAC,EAAQ,OAEb,IAAI,EAAY,CAAA,EACZ,EAAQ,EACR,EAAQ,EAEN,EAAW,AAAC,IAChB,GAAI,AAAe,SAAf,EAAuB,OAC3B,EAAY,CAAA,EACZ,IAAM,EAAI,EAAI,CAAC,CACf,EAAQ,EAAE,OAAO,CACjB,EAAQ,EAAE,OAAO,CAEjB,GAAI,CACF,EAAO,mBAAmB,GAC5B,CAAE,MAAO,EAAG,CAEZ,CACA,EAAO,gBAAgB,GACvB,EAAO,aAAa,CAAG,WACvB,SAAS,IAAI,CAAC,KAAK,CAAC,MAAM,CAAG,WAC7B,EAAO,aAAa,CAAC,AAAC,GAAO,EAAE,OAAO,CAAG,CAAA,GAC3C,EAEM,EAAU,AAAC,IACf,GAAI,CAAC,GAAa,AAAe,SAAf,EAAuB,OACzC,IAAM,EAAI,EAAI,CAAC,CACT,EAAK,EAAE,OAAO,CAAG,EACjB,EAAK,EAAE,OAAO,CAAG,EACvB,EAAQ,EAAE,OAAO,CACjB,EAAQ,EAAE,OAAO,CAEjB,EAAO,WAAW,CAAC,IAAI,QAAK,CAAC,EAAI,IACjC,EAAO,gBAAgB,GACzB,EAEM,EAAS,KACR,IACL,EAAY,CAAA,EACZ,EAAO,aAAa,CAAG,UACvB,SAAS,IAAI,CAAC,KAAK,CAAC,MAAM,CAAG,UAC7B,EAAO,aAAa,CAAC,AAAC,GAAO,EAAE,OAAO,CAAG,CAAA,IAC3C,EAOA,OALA,EAAO,EAAE,CAAC,aAAc,GACxB,EAAO,EAAE,CAAC,aAAc,GACxB,EAAO,EAAE,CAAC,WAAY,GAGf,KACL,EAAO,GAAG,CAAC,aAAc,GACzB,EAAO,GAAG,CAAC,aAAc,GACzB,EAAO,GAAG,CAAC,WAAY,GACvB,GAAI,CACF,EAAO,aAAa,CAAC,AAAC,GAAO,EAAE,OAAO,CAAG,CAAA,GAC3C,CAAE,MAAO,EAAG,CAEZ,CACA,EAAO,aAAa,CAAG,UACvB,SAAS,IAAI,CAAC,KAAK,CAAC,MAAM,CAAG,UAC/B,EACF,EAAG,CAAC,EAAQ,EAAW,EAEvB,IAAM,EAAe,KACnB,GAAI,CAAC,EAAQ,OACb,IAAM,EAAO,IAAI,OAAI,CAAC,CACpB,KAAM,IACN,IAAK,IACL,KAAM,UACN,MAAO,IACP,OAAQ,GACV,GACA,EAAO,GAAG,CAAC,GACX,EAAO,eAAe,CAAC,GACvB,EAAQ,SAAS,GACnB,EAgFM,EAAiB,KACrB,GAAI,CAAC,EAAQ,OACb,IAAM,EAAgB,EAAO,gBAAgB,GACzC,EAAc,MAAM,GACtB,EAAO,mBAAmB,GAC1B,EAAc,OAAO,CAAC,AAAC,IACrB,EAAO,MAAM,CAAC,GAChB,GACA,EAAQ,SAAS,IAErB,EA2CM,EAAyB,KAC7B,GAAI,CAAC,GAAkB,CAAE,CAAA,aAA0B,cAAW,AAAD,EAAI,OAAO,KACxE,IAAM,EAAa,EAAe,UAAU,GACtC,EAAa,SAAS,aAAa,CAAC,UAC1C,EAAW,KAAK,CAAG,EAAW,KAAK,CACnC,EAAW,MAAM,CAAG,EAAW,MAAM,CACrC,IAAM,EAAM,EAAW,UAAU,CAAC,MAIlC,OAHI,GACF,EAAI,SAAS,CAAC,EAAY,EAAG,GAExB,EACT,EAEM,EAAkB,aAA0B,cAAW,CAE7D,MACE,WAAC,SAAK,EAAC,UAAU,WAAW,MAAO,CAAE,QAAS,KAAM,YAClD,UAAC,SAAO,EAAC,MAAM,oBACb,UAAC,SAAM,EACL,KAAM,AAAe,SAAf,EAAwB,UAAY,UAC1C,KAAM,UAAC,IAAS,KAAK,WAAW,OAAQ,CAAE,OAAQ,GAAI,MAAO,EAAG,IAChE,QAAS,IAAM,EAAc,YAGjC,UAAC,SAAO,EAAC,MAAM,sBACb,UAAC,SAAM,EACL,KAAM,AAAe,WAAf,EAA0B,UAAY,UAC5C,KAAM,UAAC,SAAY,KACnB,QAAS,IAAM,EAAc,cAGjC,UAAC,SAAO,EAAC,MAAM,qBACb,UAAC,SAAM,EACL,KAAM,AAAe,UAAf,EAAyB,UAAY,UAC3C,KAAM,UAAC,SAAiB,KACxB,QAAS,IAAM,EAAc,aAIjC,UAAC,SAAQ,EACP,QACE,WAAC,SAAI,YACH,UAAC,SAAI,CAAC,IAAI,EAAY,KAAM,UAAC,SAAc,KAAK,QAAS,WAAc,aAAxD,QAGf,UAAC,SAAI,CAAC,IAAI,EAAc,KAAM,UAAC,MAAuB,QAhL9C,KAChB,GAAI,CAAC,EAAQ,OACb,IAAM,EAAS,IAAI,SAAM,CAAC,CACxB,KAAM,IACN,IAAK,IACL,KAAM,UACN,OAAQ,EACV,GACA,EAAO,GAAG,CAAC,GACX,EAAO,eAAe,CAAC,GACvB,EAAQ,SAAS,GACnB,WAqKoF,UAA3D,UAGf,UAAC,SAAI,CAAC,IAAI,EAAgB,KAAM,UAAC,SAAc,KAAK,QAtK1C,KAClB,GAAI,CAAC,EAAQ,OACb,IAAM,EAAW,IAAI,WAAQ,CAAC,CAC5B,KAAM,IACN,IAAK,IACL,KAAM,UACN,MAAO,IACP,OAAQ,GACV,GACA,EAAO,GAAG,CAAC,GACX,EAAO,eAAe,CAAC,GACvB,EAAQ,SAAS,GACnB,WA0JoF,YAA3D,YAGf,UAAC,SAAI,CAAC,IAAI,EAAe,KAAM,UAAC,SAAc,KAAK,QA3J1C,KACjB,GAAI,CAAC,EAAQ,OASb,IAAM,EAAU,IAAI,UAAO,CARZ,CACb,CAAE,EAAG,IAAK,EAAG,GAAI,EACjB,CAAE,EAAG,IAAK,EAAG,GAAI,EACjB,CAAE,EAAG,IAAK,EAAG,GAAI,EACjB,CAAE,EAAG,IAAK,EAAG,GAAI,EACjB,CAAE,EAAG,IAAK,EAAG,GAAI,EACjB,CAAE,EAAG,IAAK,EAAG,GAAI,EAClB,CACmC,CAClC,KAAM,IACN,IAAK,IACL,KAAM,UACN,cAAe,CAAA,CACjB,GACA,EAAO,GAAG,CAAC,GACX,EAAO,eAAe,CAAC,GACvB,EAAQ,SAAS,GACnB,WAwIkF,WAAzD,cAKnB,QAAS,CAAC,QAAQ,UAElB,UAAC,SAAO,EAAC,MAAM,kBACb,UAAC,SAAM,EAAC,KAAM,UAAC,aAInB,UAAC,SAAO,EAAC,MAAM,oBACb,UAAC,SAAM,EACL,KAAM,AAAe,SAAf,EAAwB,UAAY,UAC1C,KAAM,UAAC,SAAgB,KACvB,QAAS,IAAM,EAAc,YAIjC,UAAC,SAAM,KAAK,OAAO,GAAG,eAAe,MAAM,IAAC,OAAO,UAAU,SA7IvC,AAAC,IACzB,GAAI,CAAC,GAAU,CAAC,EAAE,MAAM,CAAC,KAAK,EAAI,CAAC,EAAE,MAAM,CAAC,KAAK,CAAC,EAAE,CAAE,OACtD,IAAM,EAAO,EAAE,MAAM,CAAC,KAAK,CAAC,EAAE,CACxB,EAAS,IAAI,WACnB,EAAO,MAAM,CAAG,AAAC,QACF,EAAb,IAAM,UAAO,EAAA,EAAE,MAAM,YAAR,SAAA,EAAU,MAAM,CAC7B,cAAW,CAAC,OAAO,CAAC,GAAM,IAAI,CAAC,AAAC,IAC9B,EAAI,YAAY,CAAC,KACjB,EAAO,GAAG,CAAC,GACX,EAAO,YAAY,CAAC,GACpB,EAAO,eAAe,CAAC,GACvB,EAAQ,SAAS,GACnB,GACF,EACA,EAAO,aAAa,CAAC,GACvB,IA+HI,UAAC,SACC,KAAK,OACL,GAAG,iBACH,MAAM,IACN,OAAO,0BACP,SA1b0B,AAAC,IAC/B,GAAI,CAAC,EAAQ,OACb,IAAM,EAAO,EAAE,MAAM,CAAC,KAAK,EAAI,EAAE,MAAM,CAAC,KAAK,CAAC,EAAE,CAChD,GAAI,CAAC,EAAM,OAEX,IAAM,EAAS,IAAI,WACnB,EAAO,MAAM,CAAG,AAAC,IACf,GAAI,KACW,EAAb,IAAM,UAAO,EAAA,EAAG,MAAM,YAAT,SAAA,EAAW,MAAM,CACxB,EAAO,KAAK,KAAK,CAAC,GACxB,EAAO,YAAY,CAAC,EAAM,KACxB,EAAO,SAAS,GAChB,EAAQ,SAAS,GACnB,GACF,CAAE,MAAO,EAAK,CAEZ,QAAQ,KAAK,CAAC,gCAAiC,GAG/C,MAAM,wEACR,CACF,EACA,EAAO,UAAU,CAAC,GAElB,EAAE,aAAa,CAAC,KAAK,CAAG,GAC1B,IAoaI,UAAC,SAAO,EAAC,MAAO,CAAE,OAAQ,OAAQ,IAElC,UAAC,SAAO,EAAC,MAAM,oBACb,UAAC,SAAM,EAAC,KAAM,UAAC,OAAwB,QAAS,IAAM,EAAoB,CAAA,OAE5E,UAAC,SAAO,EAAC,MAAM,oBACb,UAAC,SAAM,EACL,KAAM,UAAC,UAAe,KACtB,QAAS,IAAM,EAAoB,CAAA,GACnC,SAAU,CAAC,MAGf,UAAC,SAAO,EAAC,MAAM,6BACb,UAAC,SAAM,EACL,KAAM,UAAC,UAAgB,KACvB,QAAS,IAAM,EAAoB,CAAA,GACnC,SAAU,CAAC,MAGf,UAAC,SAAO,EAAC,MAAM,sBACb,UAAC,SAAM,EAAC,KAAM,UAAC,SAAiB,KAAK,QAAS,IAAM,EAAoB,CAAA,OAG1E,UAAC,SAAO,EAAC,MAAO,CAAE,OAAQ,OAAQ,IAElC,UAAC,SAAO,EAAC,MAAM,yBACb,UAAC,SAAM,EAAC,KAAM,UAAC,SAAY,KAAK,QAAS,EAAQ,IAAI,CAAE,SAAU,CAAC,EAAQ,OAAO,KAEnF,UAAC,SAAO,EAAC,MAAM,yBACb,UAAC,SAAM,EAAC,KAAM,UAAC,SAAY,KAAK,QAAS,EAAQ,IAAI,CAAE,SAAU,CAAC,EAAQ,OAAO,KAGnF,UAAC,SAAO,EAAC,MAAO,CAAE,OAAQ,OAAQ,IAElC,UAAC,SAAQ,EACP,QACE,WAAC,SAAI,YACH,UAAC,SAAI,CAAC,IAAI,EAER,KAAM,UAAC,SAAiB,KACxB,QAAS,SAAM,iBAAA,EAAA,SAAS,cAAc,CAAC,2BAAxB,SAAA,EAAyC,KAAK,cAC9D,gBAHK,UAMN,UAAC,SAAI,CAAC,IAAI,EAAY,KAAM,UAAC,UAAY,KAAK,QAAS,EAAM,SAAU,CAAC,WAAgB,mBAAzE,QAGf,UAAC,SAAI,CAAC,IAAI,EAER,KAAM,UAAC,UAAgB,KACvB,QAAS,EACT,SAAU,CAAC,WACZ,oBAJK,SAON,UAAC,SAAI,CAAC,OAAO,KACb,UAAC,SAAI,CAAC,IAAI,EAAW,KAAM,UAAC,SAAiB,KAAK,QAAS,WAAY,0BAAxD,OAGf,UAAC,SAAI,CAAC,IAAI,EAAY,KAAM,UAAC,UAAY,KAAK,QAAS,WAAmB,2BAA3D,QAGf,UAAC,SAAI,CAAC,IAAI,EAER,KAAM,UAAC,OACP,QAAS,IAAM,EAAuB,CAAA,YACvC,iBAHK,QAMN,UAAC,SAAI,CAAC,IAAI,EAER,KAAM,UAAC,UAAc,KACrB,QAAS,SAAM,iBAAA,EAAA,SAAS,cAAc,CAAC,6BAAxB,SAAA,EAA2C,KAAK,cAChE,yBAHK,UAMN,UAAC,SAAI,CAAC,IAAI,EAER,KAAM,UAAC,SAAc,KACrB,QAAS,IAAM,EAAsB,CAAA,YACtC,6BAHK,aAQV,QAAS,CAAC,QAAQ,UAElB,UAAC,SAAO,EAAC,MAAM,gBACb,UAAC,SAAM,EAAC,KAAM,UAAC,aAInB,UAAC,IACC,QAAS,EACT,SAAU,IAAM,EAAsB,CAAA,GACtC,OAAQ,IAGT,GAAoB,GACnB,UAAC,IACC,KAAM,EACN,SAAU,IAAM,EAAoB,CAAA,GACpC,QA/NgB,AAAC,IAClB,GAAW,IAChB,GAAwB,EAAQ,EAAgB,GAChD,EAAQ,SAAS,GACjB,EAAoB,CAAA,IACtB,EA2NQ,aAAc,IACd,cAAe,OAIlB,GAAoB,GACnB,UAAC,IACC,QAAS,EACT,SAAU,IAAM,EAAoB,CAAA,GACpC,QAlOqB,AAAC,IAC5B,GAAI,CAAC,GAAU,CAAC,GAAkB,CAAE,CAAA,aAA0B,cAAW,AAAD,EAAI,OAE5E,IAAM,EAAS,IAAI,cAAW,CAAC,GAG/B,EAAO,GAAG,CAAC,CACT,KAAM,EAAe,IAAI,CACzB,IAAK,EAAe,GAAG,CACvB,OAAQ,EAAe,MAAM,CAC7B,OAAQ,EAAe,MAAM,CAC7B,MAAO,EAAe,KAAK,CAC3B,MAAO,EAAe,KAAK,CAC3B,MAAO,EAAe,KAAK,CAC3B,MAAO,EAAe,KAAK,CAC3B,MAAO,EAAe,KAAK,CAC3B,QAAS,EAAe,OAAO,CAC/B,QAAS,EAAe,OAAO,CAC/B,QAAS,EAAe,OAAO,AACjC,GAGA,IAAM,EAAQ,EAAO,UAAU,GAAG,OAAO,CAAC,GAC1C,EAAO,mBAAmB,GAC1B,EAAO,MAAM,CAAC,GACd,EAAO,GAAG,CAAC,GACX,EAAO,YAAY,CAAC,EAAQ,GAE5B,EAAO,eAAe,CAAC,GACvB,EAAO,gBAAgB,GACvB,EAAQ,SAAS,GACjB,EAAoB,CAAA,GACtB,EAmMQ,aAAc,MAIlB,UAAC,IACC,QAAS,EACT,SAAU,IAAM,EAAuB,CAAA,GACvC,SAAU,EACV,OA/mBoB,AAAC,IACpB,GACL,EAAO,YAAY,CAAC,EAAQ,IAAI,EAAE,IAAI,CAAC,KACrC,EAAO,SAAS,GAEhB,EAAsB,GACtB,EAAuB,CAAA,GACvB,EAAQ,SAAS,GACnB,GACF,EAumBM,SAAU,IAGX,GACC,UAAC,IACC,QAAS,EACT,SAAU,IAAM,EAAoB,CAAA,GACpC,OAAQ,EACR,QAAS,IAIZ,GACC,UAAC,IACC,QAAS,EACT,SAAU,IAAM,EAAoB,CAAA,GACpC,OAAQ,EACR,QAAS,OAKnB,EC7sBa,GAAuB,AAAC,IACnC,IAAM,EAAY,GAAA,QAAM,EAAsB,MAE9C,GAAA,WAAS,EAAC,KACR,GAAI,CAAC,EAAQ,OAEb,IAAM,EAAgB,MAAO,IAE3B,GAAI,AAAC,CAAA,EAAE,OAAO,EAAI,EAAE,OAAO,AAAD,GAAM,AAAU,MAAV,EAAE,GAAG,CAAU,CAC7C,IAAM,EAAe,EAAO,eAAe,GAC3C,GAAI,EAAc,CAChB,IAAM,EAAS,MAAM,EAAa,KAAK,GACvC,EAAU,OAAO,CAAG,EACtB,CACF,CAGA,GAAI,AAAC,CAAA,EAAE,OAAO,EAAI,EAAE,OAAO,AAAD,GAAM,AAAU,MAAV,EAAE,GAAG,EAC/B,EAAU,OAAO,CAAE,CACrB,IAAM,EAAY,MAAM,EAAU,OAAO,CAAC,KAAK,GAC/C,EAAO,mBAAmB,GAE1B,EAAU,GAAG,CAAC,CACZ,KAAM,AAAC,CAAA,EAAU,IAAI,EAAI,CAAA,EAAK,GAC9B,IAAK,AAAC,CAAA,EAAU,GAAG,EAAI,CAAA,EAAK,GAC5B,QAAS,CAAA,CACX,GAEI,AAAmB,oBAAnB,EAAU,IAAI,EAEhB,EAAU,MAAM,CAAG,EACnB,AAAC,EAAkB,aAAa,CAAC,AAAC,IAChC,EAAO,GAAG,CAAC,GACb,GACA,EAAU,SAAS,IAEnB,EAAO,GAAG,CAAC,GAGb,EAAU,OAAO,CAAG,EACpB,EAAO,eAAe,CAAC,GACvB,EAAO,gBAAgB,GACzB,CAIE,EAAO,aAAa,EAAI,EAAO,gBAAgB,GAC7C,AAAU,MAAV,EAAE,GAAG,CACP,EAAO,gBAAgB,CAAC,KAAK,CAAG,KAAK,GAAG,CAAC,EAAG,EAAO,gBAAgB,CAAC,KAAK,CAAG,GACzD,MAAV,EAAE,GAAG,EACd,CAAA,EAAO,gBAAgB,CAAC,KAAK,EAAI,CAAA,GAGvC,EAGA,OADA,OAAO,gBAAgB,CAAC,UAAW,GAC5B,KACL,OAAO,mBAAmB,CAAC,UAAW,GACxC,EACF,EAAG,CAAC,EAAO,EACb,EC1DM,GAAuB,KAC3B,IAAM,EAAY,GAAA,QAAM,EAAoB,MACtC,EAAe,GAAA,QAAM,EAAiB,MACtC,CACJ,OAAA,CAAM,CACN,UAAA,CAAS,CACT,eAAA,CAAc,CACd,kBAAA,CAAiB,CACjB,QAAA,CAAO,CACP,SAAA,CAAQ,CACR,eAAA,CAAc,CACd,WAAA,CAAU,CACV,UAAA,CAAS,CACT,aAAA,CAAY,CACZ,cAAA,CAAa,CACb,UAAA,CAAS,CACT,aAAA,CAAY,CACZ,WAAA,CAAU,CACV,cAAA,CAAa,CACd,CAAG,GAAA,gBAAc,IAEZ,EAAe,GAAA,QAAM,EAAC,CAAA,GAE5B,GAAqB,GAErB,IAAM,EAAgB,GAAA,QAAM,EAAC,CAAA,GACvB,EAAgB,GAAA,QAAM,EAAwB,MAC9C,EAAkB,GAAA,QAAM,EAAwB,MAChD,EAAqB,GAAA,QAAM,EAAC,CAAA,GAC5B,EAAkB,GAAA,QAAM,EAAC,GACzB,EAAqB,GAAA,QAAM,EAAC,GAC5B,EAAe,GAAA,QAAM,EAAC,GA8b5B,MA5bA,GAAA,WAAS,EAAC,KACR,EAAa,OAAO,CAAG,EACzB,EAAG,CAAC,EAAU,EAEd,GAAA,WAAS,EAAC,KACR,GAAI,CAAC,GAAU,CAAC,EAAW,OAE3B,IAAM,EAAS,IAAI,WACnB,EAAO,MAAM,CAAG,AAAC,QACF,EAAb,IAAM,UAAO,EAAA,EAAE,MAAM,YAAR,SAAA,EAAU,MAAM,CAC7B,cAAW,CAAC,OAAO,CAAC,GAAM,IAAI,CAAC,AAAC,IAC9B,EAAI,YAAY,CAAC,KACjB,EAAO,GAAG,CAAC,GACX,EAAO,YAAY,CAAC,GACpB,EAAO,eAAe,CAAC,GACvB,EAAQ,SAAS,GACb,GAAc,EAAa,MACjC,GACF,EACA,EAAO,aAAa,CAAC,GACvB,EAAG,CAAC,EAAW,EAAO,EAGtB,GAAA,WAAS,EAAC,KACJ,GAAU,EAAO,gBAAgB,EAAI,AAAe,UAAf,IACvC,EAAO,gBAAgB,CAAC,KAAK,CAAG,EAChC,EAAO,gBAAgB,CAAC,KAAK,CAAG,GAEpC,EAAG,CAAC,EAAQ,EAAY,EAAW,EAAW,EAG9C,GAAA,WAAS,EAAC,KACR,GAAI,CAAC,GAAU,CAAC,EAAa,OAAO,CAAE,OAEtC,IAAM,EAAY,EAAa,OAAO,CAChC,EAAQ,AAAC,EAAO,aAAa,EAA0B,KAGvD,EAAU,SAAS,aAAa,CAAC,OACvC,EAAQ,KAAK,CAAC,QAAQ,CAAG,WACzB,EAAQ,KAAK,CAAC,aAAa,CAAG,OAC9B,EAAQ,KAAK,CAAC,KAAK,CAAG,OACtB,EAAQ,KAAK,CAAC,MAAM,CAAG,OACvB,EAAQ,KAAK,CAAC,YAAY,CAAG,MAC7B,EAAQ,KAAK,CAAC,SAAS,CAAG,0BAC1B,EAAQ,KAAK,CAAC,MAAM,CAAG,iBACvB,EAAQ,KAAK,CAAC,SAAS,CAAG,wBAC1B,EAAQ,KAAK,CAAC,OAAO,CAAG,OACxB,EAAQ,KAAK,CAAC,MAAM,CAAG,OACvB,EAAU,WAAW,CAAC,GACtB,EAAc,OAAO,CAAG,EAGxB,IAAM,EAAU,SAAS,aAAa,CAAC,OACvC,EAAQ,KAAK,CAAC,QAAQ,CAAG,WACzB,EAAQ,KAAK,CAAC,aAAa,CAAG,OAC9B,EAAQ,KAAK,CAAC,MAAM,CAAG,4BACvB,EAAQ,KAAK,CAAC,YAAY,CAAG,MAC7B,EAAQ,KAAK,CAAC,SAAS,CAAG,wBAC1B,EAAQ,KAAK,CAAC,OAAO,CAAG,OACxB,EAAQ,KAAK,CAAC,MAAM,CAAG,MACvB,EAAU,WAAW,CAAC,GACtB,EAAgB,OAAO,CAAG,EAE1B,IAAM,EAAyB,CAAC,EAAW,EAAW,KAC/C,EAAgB,OAAO,GAIR,AAAe,UAAf,GAA2B,CAAA,EAAO,IAAM,EAAmB,OAAO,AAAD,GAGnF,EAAgB,OAAO,CAAC,KAAK,CAAC,KAAK,CAAG,CAAC,EAAE,EAAK,EAAE,CAAC,CACjD,EAAgB,OAAO,CAAC,KAAK,CAAC,MAAM,CAAG,CAAC,EAAE,EAAK,EAAE,CAAC,CAClD,EAAgB,OAAO,CAAC,KAAK,CAAC,IAAI,CAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAC7C,EAAgB,OAAO,CAAC,KAAK,CAAC,GAAG,CAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAC5C,EAAgB,OAAO,CAAC,KAAK,CAAC,OAAO,CAAG,QAGX,SAAzB,EAAO,aAAa,GACtB,EAAO,aAAa,CAAG,OACvB,EAAO,WAAW,CAAG,OACrB,EAAO,gBAAgB,MAGzB,EAAgB,OAAO,CAAC,KAAK,CAAC,OAAO,CAAG,OACX,SAAzB,EAAO,aAAa,GACtB,EAAO,aAAa,CAAG,UACvB,EAAO,WAAW,CAAG,OACrB,EAAO,gBAAgB,MAG7B,EAEM,EAAY,AAAC,IACH,QAAV,EAAE,GAAG,GACP,EAAc,OAAO,CAAG,CAAA,EACL,UAAf,GACF,CAAA,EAAO,aAAa,CAAG,CAAA,CAAI,GAGjC,EAEM,EAAU,AAAC,IACD,QAAV,EAAE,GAAG,GACP,EAAc,OAAO,CAAG,CAAA,EACL,UAAf,GAA2B,EAAmB,OAAO,EACvD,CAAA,EAAO,aAAa,CAAG,CAAA,CAAG,EAExB,EAAc,OAAO,EAAE,CAAA,EAAc,OAAO,CAAC,KAAK,CAAC,OAAO,CAAG,MAAK,GAE1E,EAEM,EAAgB,AAAC,IACjB,EAAE,MAAM,EACV,EAAE,cAAc,GAEpB,EAEM,EAAc,AAAC,IACnB,GAAI,AAAe,UAAf,GAGJ,GAAI,EAAE,MAAM,EAAI,AAAa,IAAb,EAAE,MAAM,CAAQ,CAC9B,EAAE,cAAc,GAChB,EAAmB,OAAO,CAAG,CAAA,EAC7B,EAAgB,OAAO,CAAG,EAAE,OAAO,CACnC,EAAmB,OAAO,CAAG,EAAa,OAAO,CACjD,EAAO,aAAa,CAAG,CAAA,EACvB,OACF,CAGA,GAAI,EAAE,MAAM,EAAI,AAAa,IAAb,EAAE,MAAM,CACtB,GAAI,CACF,IAAM,EAAO,EAAU,qBAAqB,GACtC,EAAI,EAAE,OAAO,CAAG,EAAK,IAAI,CACzB,EAAI,EAAE,OAAO,CAAG,EAAK,GAAG,CAE9B,GAAI,CAAC,EAAO,OACZ,IAAM,EAAM,EAAM,UAAU,CAAC,MAC7B,GAAI,CAAC,EAAK,OAEV,IAAM,EAAQ,EAAI,YAAY,CAAC,EAAG,EAAG,EAAG,GAAG,IAAI,CACzC,EACJ,IACA,CAAC,CAAK,CAAC,EAAE,CAAE,CAAK,CAAC,EAAE,CAAE,CAAK,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,AAAC,GAAM,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,EAAG,MAAM,IAAI,CAAC,IAElF,EAAc,GAChB,CAAE,MAAO,EAAK,CAEd,EAEJ,EAEM,EAAc,AAAC,IACnB,GAAI,AAAe,UAAf,EAAwB,CACtB,EAAgB,OAAO,EAAE,CAAA,EAAgB,OAAO,CAAC,KAAK,CAAC,OAAO,CAAG,MAAK,EAC1E,OACF,CAEA,IAAM,EAAO,EAAU,qBAAqB,GACtC,EAAI,EAAE,OAAO,CAAG,EAAK,IAAI,CACzB,EAAI,EAAE,OAAO,CAAG,EAAK,GAAG,CAG9B,GAAI,EAAmB,OAAO,CAAE,CAC9B,IAAM,EAAQ,EAAE,OAAO,CAAG,EAAgB,OAAO,CAG3C,EAAU,KAAK,GAAG,CAAC,EAAG,EAAmB,OAAO,CAAG,GACzD,EAAa,GACb,EAAuB,EAAG,EAAG,GAC7B,OACF,CAMA,GAHA,EAAuB,EAAG,EAAG,EAAa,OAAO,EAG7C,EAAc,OAAO,CACvB,GAAI,CACF,GAAI,CAAC,EAAO,OACZ,IAAM,EAAM,EAAM,UAAU,CAAC,MAC7B,GAAI,CAAC,EAAK,OAGV,GAAI,EAAI,GAAK,EAAI,GAAK,GAAK,EAAM,KAAK,EAAI,GAAK,EAAM,MAAM,CAAE,CACvD,EAAc,OAAO,EAAE,CAAA,EAAc,OAAO,CAAC,KAAK,CAAC,OAAO,CAAG,MAAK,EACtE,OACF,CAEA,IAAM,EAAQ,EAAI,YAAY,CAAC,EAAG,EAAG,EAAG,GAAG,IAAI,CACzC,EACJ,IACA,CAAC,CAAK,CAAC,EAAE,CAAE,CAAK,CAAC,EAAE,CAAE,CAAK,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,AAAC,GAAM,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,EAAG,MAAM,IAAI,CAAC,IAE9E,EAAc,OAAO,GACvB,EAAc,OAAO,CAAC,KAAK,CAAC,UAAU,CAAG,EACzC,EAAc,OAAO,CAAC,KAAK,CAAC,OAAO,CAAG,QACtC,EAAc,OAAO,CAAC,KAAK,CAAC,IAAI,CAAG,EAAI,GAAK,KAC5C,EAAc,OAAO,CAAC,KAAK,CAAC,GAAG,CAAG,EAAI,GAAK,MAE/C,CAAE,MAAO,EAAK,CACR,EAAc,OAAO,EAAE,CAAA,EAAc,OAAO,CAAC,KAAK,CAAC,OAAO,CAAG,MAAK,EACxE,MAEI,EAAc,OAAO,EAAE,CAAA,EAAc,OAAO,CAAC,KAAK,CAAC,OAAO,CAAG,MAAK,EAE1E,EAEM,EAAY,AAAC,IACb,EAAmB,OAAO,GAC5B,EAAmB,OAAO,CAAG,CAAA,EACV,UAAf,GAA2B,EAAc,OAAO,EAClD,CAAA,EAAO,aAAa,CAAG,CAAA,CAAG,GAGhC,EASA,OAPA,OAAO,gBAAgB,CAAC,UAAW,GACnC,OAAO,gBAAgB,CAAC,QAAS,GACjC,EAAU,gBAAgB,CAAC,cAAe,GAC1C,EAAU,gBAAgB,CAAC,YAAa,GACxC,OAAO,gBAAgB,CAAC,YAAa,GACrC,OAAO,gBAAgB,CAAC,UAAW,GAE5B,KAQL,GAPA,OAAO,mBAAmB,CAAC,UAAW,GACtC,OAAO,mBAAmB,CAAC,QAAS,GACpC,EAAU,mBAAmB,CAAC,cAAe,GAC7C,EAAU,mBAAmB,CAAC,YAAa,GAC3C,OAAO,mBAAmB,CAAC,YAAa,GACxC,OAAO,mBAAmB,CAAC,UAAW,GAElC,EAAc,OAAO,CAAE,CACzB,GAAI,CACF,EAAU,WAAW,CAAC,EAAc,OAAO,EAC7C,CAAE,MAAO,EAAG,CAAC,CACb,EAAc,OAAO,CAAG,KAC1B,CACA,GAAI,EAAgB,OAAO,CAAE,CAC3B,GAAI,CACF,EAAU,WAAW,CAAC,EAAgB,OAAO,EAC/C,CAAE,MAAO,EAAG,CAAC,CACb,EAAgB,OAAO,CAAG,KAC5B,CAGI,IACF,EAAO,aAAa,CAAG,UACvB,EAAO,WAAW,CAAG,QAEzB,EACF,EAAG,CAAC,EAAQ,EAAY,EAAc,EAAc,EAEpD,GAAA,WAAS,EAAC,KACR,GAAI,CAAC,EAAU,OAAO,EAAI,CAAC,EAAa,OAAO,CAAE,OAEjD,IAAM,EAAe,IAAI,SAAM,CAAC,EAAU,OAAO,CAAE,CACjD,MAAO,EAAa,OAAO,CAAC,WAAW,CACvC,OAAQ,EAAa,OAAO,CAAC,YAAY,CACzC,gBAAiB,UACjB,uBAAwB,CAAA,EACxB,UAAW,CAAA,CACb,GAEA,EAAU,GAEN,EACF,EAAa,YAAY,CAAC,EAAe,IAAI,EAAE,IAAI,CAAC,KAClD,EAAa,SAAS,GACtB,EAAQ,SAAS,GACnB,GACS,GACT,cAAW,CAAC,OAAO,CAAC,GAAU,IAAI,CAAC,AAAC,IAClC,IAAM,EAAiB,EAAa,OAAO,CAAE,WAAW,CAClD,EAAkB,EAAa,OAAO,CAAE,YAAY,CAEtD,CAAA,EAAI,KAAK,CAAI,GAAkB,EAAI,MAAM,CAAI,CAAc,GAC7D,EAAI,YAAY,CAAC,AAAiB,GAAjB,GAGnB,EAAa,GAAG,CAAC,GACjB,EAAa,YAAY,CAAC,GAC1B,EAAa,eAAe,CAAC,GAC7B,EAAQ,SAAS,GACnB,GAGF,IAAM,EAAkB,KACtB,IAAM,EAAgB,EAAa,gBAAgB,GAC/C,AAAyB,IAAzB,EAAc,MAAM,CACtB,EAAkB,CAAa,CAAC,EAAE,EAElC,EAAkB,MAEtB,EAEA,EAAa,EAAE,CAAC,oBAAqB,GACrC,EAAa,EAAE,CAAC,oBAAqB,GACrC,EAAa,EAAE,CAAC,oBAAqB,IAAM,EAAkB,OAS7D,EAAa,EAAE,CAAC,uBANI,KAClB,EAAa,OAAO,CAAG,CAAA,EACvB,GAAiB,EAAc,QACjC,GAIA,EAAa,EAAE,CAAC,sBAHG,IAAM,GAAiB,EAAc,WAKxD,IAAM,EAAc,KAClB,EAAQ,SAAS,GACnB,EAEA,EAAa,EAAE,CAAC,kBAAmB,GACnC,EAAa,EAAE,CAAC,eAAgB,GAChC,EAAa,EAAE,CAAC,iBAAkB,GAGlC,IAAM,EAAU,AAAC,IAEf,GAAK,EAAG,OAAO,EACf,EAAG,cAAc,GAEjB,GAAI,CACF,IAAM,EAAc,EAAa,OAAO,IAAM,EAExC,EAAQ,EAAG,MAAM,CAGnB,EAAU,EADK,CAAA,EAAQ,EAAI,KAAO,GAAG,EAEzC,EAAU,KAAK,GAAG,CAAC,GAAK,KAAK,GAAG,CAAC,EAAG,IAIpC,IAAM,EAAU,AAAC,EAAqB,UAAU,CAAC,GACjD,GAAI,GAAW,AAAqB,UAArB,OAAO,EAAQ,CAAC,EAAiB,AAAqB,UAArB,OAAO,EAAQ,CAAC,CAC9D,EAAa,WAAW,CAAC,IAAI,QAAK,CAAC,EAAQ,CAAC,CAAE,EAAQ,CAAC,EAAG,OACrD,CAEL,IAAM,EAAO,EAAa,aAAa,CAAC,qBAAqB,GACvD,EAAI,EAAG,OAAO,CAAG,EAAK,IAAI,CAC1B,EAAI,EAAG,OAAO,CAAG,EAAK,GAAG,CAC/B,EAAa,WAAW,CAAC,IAAI,QAAK,CAAC,EAAG,GAAI,GAC5C,CAEA,EAAa,gBAAgB,GAC/B,CAAE,MAAO,EAAG,CAEZ,EACF,EAGA,EAAa,OAAO,CAAC,gBAAgB,CAAC,QAAS,EAAS,CAAE,QAAS,CAAA,CAAM,GAEzE,IAAM,EAAe,KACf,EAAa,OAAO,EACtB,EAAa,aAAa,CAAC,CACzB,MAAO,EAAa,OAAO,CAAC,WAAW,CACvC,OAAQ,EAAa,OAAO,CAAC,YAAY,AAC3C,GAEJ,EAIA,OAFA,OAAO,gBAAgB,CAAC,SAAU,GAE3B,KAGL,GAFA,EAAa,OAAO,GACpB,OAAO,mBAAmB,CAAC,SAAU,GACjC,EAAa,OAAO,CACtB,GAAI,CACF,EAAa,OAAO,CAAC,mBAAmB,CAAC,QAAS,GACpD,CAAE,MAAO,EAAG,CAAC,CAEjB,EACF,EAAG,EAAE,EAGL,GAAA,WAAS,EAAC,KACR,GAAK,EACL,GAAI,CACF,IAAM,EAAU,CAAC,CAAC,AAAC,EAAuB,SAAS,CACnD,EAAa,OAAO,CAAG,EACnB,GACF,GAAiB,EAAc,QAEnC,CAAE,MAAO,EAAG,CAEZ,CACF,EAAG,CAAC,EAAgB,EAAc,EAElC,GAAA,WAAS,EAAC,KACH,IACD,AAAe,UAAf,GACF,EAAO,aAAa,CAAG,CAAA,EAClB,EAAO,gBAAgB,EAC1B,CAAA,EAAO,gBAAgB,CAAG,IAAI,cAAW,CAAC,EAAM,EAElD,EAAO,gBAAgB,CAAC,KAAK,CAAG,EAChC,EAAO,gBAAgB,CAAC,KAAK,CAAG,GAEhC,EAAO,aAAa,CAAG,CAAA,GAE3B,EAAG,CAAC,EAAY,EAAO,EAGvB,GAAA,WAAS,EAAC,KACR,GAAI,CAAC,GACD,AAAe,SAAf,EADS,OAGb,IAAM,EAAkB,AAAC,IACvB,GAAI,CAEF,GAAI,EAAa,OAAO,CAAE,OAE1B,IAAM,EAAU,EAAO,gBAAgB,CAAC,EAAI,CAAC,EACvC,EAAM,IAAI,QAAK,CAAC,OAAQ,CAC5B,KAAM,EAAQ,CAAC,CACf,IAAK,EAAQ,CAAC,CACd,SAAU,EACZ,GACA,EAAO,GAAG,CAAC,GACX,EAAO,eAAe,CAAC,GACvB,GAAqB,EAAkB,GACvC,EAAI,YAAY,EAAI,EAAI,YAAY,GACpC,EAAI,SAAS,EAAI,EAAI,SAAS,GAC9B,EAAO,gBAAgB,GACvB,EAAQ,SAAS,GAEjB,GAAiB,EAAc,UACjC,CAAE,MAAO,EAAK,CAEd,CACF,EAGA,OADA,EAAO,EAAE,CAAC,aAAc,GACjB,KACL,EAAO,GAAG,CAAC,aAAc,GAC3B,EACF,EAAG,CAAC,EAAQ,EAAY,EAAS,EAAmB,EAAc,EAGhE,UAAC,OAAI,IAAK,EAAc,MAAO,CAAE,MAAO,OAAQ,OAAQ,MAAO,WAC7D,UAAC,UAAO,IAAK,MAGnB,qMCxcA,GAAM,CAAE,MAAA,EAAK,CAAE,CAAG,UAAU,CACtB,CAAE,OAAA,EAAM,CAAE,CAAG,UAAM,CASnB,GAA4C,CAAC,CAAE,GAAA,CAAE,CAAE,SAAA,CAAQ,CAAE,WAAA,CAAU,CAAE,QAAA,CAAO,CAAE,IACtF,GAAM,CAAE,WAAA,CAAU,CAAE,UAAA,CAAS,CAAE,WAAA,CAAU,CAAE,oBAAA,CAAmB,CAAE,UAAA,CAAS,CAAE,WAAA,CAAU,CAAE,CACrF,GAAA,cAAW,EAAC,CAAE,GAAA,CAAG,GAEb,EAAQ,CACZ,UAAW,MAAG,CAAC,SAAS,CAAC,QAAQ,CAAC,GAClC,WAAA,EACA,gBAAiB,EAAa,UAAY,cAC1C,aAAc,EACd,OAAQ,oBACR,aAAc,EACd,QAAS,UACT,QAAS,OACT,WAAY,QACd,EAEA,MACE,WAAC,OAAI,IAAK,EAAY,MAAO,YAC3B,UAAC,OACC,IAAK,EACJ,GAAG,CAAU,CACb,GAAG,CAAS,CACb,MAAO,CACL,OAAQ,OACR,YAAa,EACb,QAAS,OACT,WAAY,SACZ,MAAO,MACT,EACA,YAAa,AAAC,GAAM,EAAE,eAAe,YAErC,UAAC,UAAc,OAEjB,UAAC,OAAI,QAAS,AAAC,GAAM,EAAQ,GAAI,MAAO,CAAE,KAAM,EAAG,OAAQ,SAAU,WAClE,OAIT,EAEM,GAAwB,KAC5B,GAAM,CAAE,OAAA,CAAM,CAAE,eAAA,CAAc,CAAE,kBAAA,CAAiB,CAAE,QAAA,CAAO,CAAE,CAAG,GAAA,gBAAc,IACvE,CAAC,EAAS,EAAW,CAAG,GAAA,UAAQ,EAAiB,EAAE,EACnD,CAAC,EAAY,EAAc,CAAG,GAAA,UAAQ,EAAW,EAAE,EACnD,EAAkB,GAAA,QAAM,EAAC,CAAA,GACzB,EAAgB,GAAA,QAAM,EAAgB,MACtC,EAAoB,GAAA,QAAM,EAAS,KACnC,EAAmB,GAAA,QAAM,EAAgB,MAEzC,EAAU,GAAA,aAAU,EACxB,GAAA,YAAS,EAAC,gBAAa,EACvB,GAAA,YAAS,EAAC,iBAAc,CAAE,CACxB,iBAAkB,8BAA2B,AAC/C,IAGI,EAAgB,KACpB,GAAI,CAAC,EAAQ,OACb,IAAM,EAAO,EAAO,UAAU,GAC9B,EAAK,OAAO,CAAC,AAAC,IACP,EAAI,GAAG,EAAE,CAAA,EAAI,GAAG,CAAG,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,EAAG,EAAC,EAChE,GAEA,EAAW,IAAI,EAAK,CAAC,OAAO,IAC9B,EA8EA,GAAA,WAAS,EAAC,SAGJ,EAFJ,GAAI,CAAC,EAAQ,OAGb,IAAM,EAAkB,KACtB,aAAa,GACb,EAAU,WAAW,EAAe,KACtC,EAEM,EAAoB,KACxB,IAAM,EAAO,EAAO,UAAU,GACV,IAAhB,EAAK,MAAM,EAEb,AADY,CAAI,CAAC,EAAE,CACf,GAAG,CAAC,CACN,cAAe,CAAA,EACf,cAAe,CAAA,EACf,aAAc,CAAA,EACd,aAAc,CAAA,EACd,aAAc,CAAA,EACd,WAAY,CAAA,EACZ,YAAa,SACf,GAEF,IACF,EAEA,EAAO,EAAE,CAAC,eAAgB,GAC1B,EAAO,EAAE,CAAC,iBAAkB,GAC5B,EAAO,EAAE,CAAC,kBAAmB,GAG7B,IAAM,EAAkB,KAGtB,EADa,AADE,CAAA,EAAO,gBAAgB,IAAM,EAAE,AAAD,EACzB,GAAG,CAAC,AAAC,GAAW,EAAE,GAAG,EAAE,MAAM,CAAC,UAKlD,EAAkB,AADA,EAAO,eAAe,IACT,MACjC,EAEM,EAAiB,KACrB,EAAc,EAAE,EAChB,EAAkB,MACpB,EAQA,OANA,EAAO,EAAE,CAAC,oBAAqB,GAC/B,EAAO,EAAE,CAAC,oBAAqB,GAC/B,EAAO,EAAE,CAAC,oBAAqB,GAE/B,IAEO,KACL,EAAO,GAAG,CAAC,eAAgB,GAC3B,EAAO,GAAG,CAAC,iBAAkB,GAC7B,EAAO,GAAG,CAAC,kBAAmB,GAC9B,EAAO,GAAG,CAAC,oBAAqB,GAChC,EAAO,GAAG,CAAC,oBAAqB,GAChC,EAAO,GAAG,CAAC,oBAAqB,GAChC,aAAa,GACf,EACF,EAAG,CAAC,EAAO,EAqBX,IAAM,EAAmB,CAAC,EAAmB,KAC3C,EAAE,eAAe,GACjB,EAAI,OAAO,CAAG,CAAC,EAAI,OAAO,CACrB,EAAI,OAAO,QACd,GAAA,EAAQ,mBAAmB,SAE7B,GAAA,EAAQ,gBAAgB,GACxB,EAAQ,SAAS,GACjB,EAAW,IAAK,OAAA,SAAA,EAAQ,UAAU,KAAM,EAAE,CAAE,CAAC,OAAO,IACtD,EAEM,EAAa,CAAC,EAAmB,KACrC,EAAE,eAAe,GACjB,EAAI,aAAa,CAAG,CAAC,EAAI,aAAa,CACtC,EAAI,aAAa,CAAG,CAAC,EAAI,aAAa,CACtC,EAAI,YAAY,CAAG,CAAC,EAAI,YAAY,CACpC,EAAI,YAAY,CAAG,CAAC,EAAI,YAAY,CACpC,EAAI,YAAY,CAAG,CAAC,EAAI,YAAY,CACpC,EAAI,UAAU,CAAG,CAAC,EAAI,aAAa,CAE9B,EAAI,UAAU,QACjB,GAAA,EAAQ,mBAAmB,SAG7B,GAAA,EAAQ,gBAAgB,GACxB,EAAQ,SAAS,GACjB,EAAW,IAAK,OAAA,SAAA,EAAQ,UAAU,KAAM,EAAE,CAAE,CAAC,OAAO,IACtD,EAEM,EAAe,CAAC,EAAmB,KACvC,GAAI,CAAC,GAAU,CAAC,EAAI,OAAO,EAAI,CAAC,EAAI,UAAU,CAAE,OAEhD,IAAM,EAAM,EAAQ,SAAS,CAAC,AAAC,GAAW,IAAM,GAE1C,EAAS,GAAM,CAAA,EAAE,OAAO,EAAI,EAAE,OAAO,AAAD,EACpC,EAAU,GAAK,EAAE,QAAQ,CAE/B,GAAI,EAAQ,CACV,IAAM,EAAS,EAAO,gBAAgB,IAAM,EAAE,CACxC,EAAU,EAAO,QAAQ,CAAC,GAC5B,EAAY,EAAE,CAOlB,GAAI,AAAqB,IAArB,CALF,EADE,EACU,EAAO,MAAM,CAAC,AAAC,GAAW,IAAM,GAEhC,IAAI,EAAQ,EAAI,EAGhB,MAAM,CAClB,EAAO,mBAAmB,GAC1B,EAAkB,WACb,GAAI,AAAqB,IAArB,EAAU,MAAM,CACzB,EAAO,eAAe,CAAC,CAAS,CAAC,EAAE,EACnC,EAAkB,CAAS,CAAC,EAAE,MACzB,CACL,IAAM,EAAM,IAAI,kBAAe,CAAC,EAAW,CAAE,OAAA,CAAO,GACpD,EAAO,eAAe,CAAC,GACvB,EAAkB,CAAS,CAAC,EAAU,MAAM,CAAG,EAAE,EACnD,CACA,EAAO,gBAAgB,GACvB,EAAiB,OAAO,CAAG,EAC3B,OACF,CAEA,GAAI,GAAW,AAA6B,OAA7B,EAAiB,OAAO,CAAW,CAChD,IAAM,EAAQ,KAAK,GAAG,CAAC,EAAiB,OAAO,CAAE,GAC3C,EAAM,KAAK,GAAG,CAAC,EAAiB,OAAO,CAAE,GACzC,EAAQ,EAAQ,KAAK,CAAC,EAAO,EAAM,GAAG,GAAG,CAAC,AAAC,GAAW,GAC5D,GAAI,AAAiB,IAAjB,EAAM,MAAM,CACd,EAAO,eAAe,CAAC,CAAK,CAAC,EAAE,EAC/B,EAAkB,CAAK,CAAC,EAAE,MACrB,CACL,IAAM,EAAM,IAAI,kBAAe,CAAC,EAAO,CAAE,OAAA,CAAO,GAChD,EAAO,eAAe,CAAC,GACvB,EAAkB,CAAK,CAAC,EAAM,MAAM,CAAG,EAAE,EAC3C,CACA,EAAO,gBAAgB,GACvB,OACF,CAGA,EAAO,eAAe,CAAC,GACvB,EAAkB,GAClB,EAAO,gBAAgB,GACvB,EAAiB,OAAO,CAAG,EAC7B,EAEM,EAAe,CAAC,EAAmB,KACvC,EAAE,eAAe,SACjB,GAAA,EAAQ,MAAM,CAAC,SACf,GAAA,EAAQ,gBAAgB,GACxB,EAAQ,SAAS,GACnB,EASM,EAA4B,AAAC,IACjC,GAAI,CAAC,GAAU,CAAC,EAAgB,OAChC,IAAM,EAAQ,OAAO,GAAK,GAC1B,EAAe,GAAG,CAAC,UAAW,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,IAAK,IAAU,KAClE,EAAO,gBAAgB,GACzB,EAqCM,EAA2B,KAC/B,EAAQ,SAAS,GACnB,EASA,MACE,WAAC,OAAI,MAAO,CAAE,QAAS,EAAG,YACxB,UAAC,IAAM,MAAO,WAAG,WACjB,UAAC,OAAI,MAAO,CAAE,aAAc,CAAE,WAC5B,WAAC,SAAK,YACJ,UAAC,SAAM,EACL,KAAM,UAAC,UAAa,KACpB,QA9TU,KAClB,GAAI,CAAC,EAAQ,OACb,IAAM,EAAgB,IAAI,EAAO,gBAAgB,GAAG,CACpD,GAAI,EAAc,MAAM,EAAI,EAAG,OAE/B,EAAO,mBAAmB,GAE1B,IAAM,EAAQ,IAAI,QAAK,CAAC,GACnB,AAAC,EAAc,GAAG,EAAE,CAAA,AAAC,EAAc,GAAG,CAAG,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,EAAG,EAAC,EAEpF,EAAc,OAAO,CAAC,AAAC,GAAQ,EAAO,MAAM,CAAC,IAC7C,EAAO,GAAG,CAAC,GAEX,EAAO,eAAe,CAAC,GACvB,EAAO,gBAAgB,GAEvB,EAAQ,SAAS,GACjB,IAEA,EAAkB,GAClB,EAAc,CAAC,AAAC,EAAc,GAAG,CAAC,EACpC,EA0SU,SAAU,CAAC,EACX,MAAM,iBAER,UAAC,SAAM,EACL,KAAM,UAAC,UAAe,KACtB,QA7SY,KACpB,GAAI,CAAC,EAAQ,OACb,IAAM,EAAe,EAAO,eAAe,GAC3C,GAAK,GAED,CAAA,AAAsB,UAAtB,EAAa,IAAI,EAAgB,aAAwB,QAAK,AAAD,EAAG,CAMlE,IAAM,EAAgB,AAJR,AADA,EACM,UAAU,GAIF,GAAG,CAAC,AAAC,IAC/B,IAAM,EAAS,EAAK,mBAAmB,GACjC,EAAU,OAAI,CAAC,WAAW,CAAC,GAejC,OAZA,EAAK,GAAG,CAAC,CACP,GAAG,CAAO,CACV,KAAM,EAAQ,UAAU,CACxB,IAAK,EAAQ,UAAU,CACvB,MAAO,EAAQ,KAAK,CACpB,OAAQ,EAAQ,MAAM,CACtB,OAAQ,EAAQ,MAAM,CACtB,MAAO,EAAQ,KAAK,CACpB,MAAO,EAAQ,KAAK,AACtB,GAGO,EACT,GAGA,EAAO,MAAM,CA1BC,GA6Bd,EAAc,OAAO,CAAC,AAAC,IACrB,EAAO,GAAG,CAAC,GACb,GAGA,IAAM,EAAkB,IAAI,kBAAe,CAAC,EAAe,CAAE,OAAA,CAAO,GACpE,EAAO,eAAe,CAAC,GAEvB,EAAO,gBAAgB,GACvB,EAAQ,SAAS,GACjB,IAEA,EAAkB,GAElB,EADa,EAAc,GAAG,CAAC,AAAC,GAAW,EAAE,GAAG,GAElD,CACF,EA2PU,SAAU,CAAC,GAAkB,AAAwB,UAAxB,EAAe,IAAI,CAChD,MAAM,wBAKX,GACC,WAAC,OAAI,MAAO,CAAE,aAAc,GAAI,QAAS,EAAG,WAAY,UAAW,aAAc,CAAE,YACjF,UAAC,OAAI,MAAO,CAAE,aAAc,CAAE,WAC5B,WAAC,OACC,MAAO,CACL,QAAS,OACT,WAAY,SACZ,IAAK,EACL,SAAU,GACV,OAAQ,YACR,WAAY,MACd,EACA,YA9EwB,AAAC,IACnC,GAAI,AAAa,IAAb,EAAE,MAAM,CAAQ,OACpB,EAAE,cAAc,GAChB,EAAgB,OAAO,CAAG,CAAA,EAC1B,EAAc,OAAO,CAAG,EAAE,OAAO,CAEjC,EAAkB,OAAO,CAAG,KAAK,KAAK,CAAC,AAAE,CAAA,OAAA,SAAA,EAAgB,OAAO,GAAI,CAAA,EAAgB,KACpF,IAAM,EAAiB,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CACrD,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CAAG,OAEjC,IAAM,EAAc,AAAC,IACnB,GAAI,CAAC,EAAgB,OAAO,EAAI,AAA0B,OAA1B,EAAc,OAAO,CAAW,OAChE,IAAM,EAAQ,EAAG,OAAO,CAAG,EAAc,OAAO,CAE5C,EAAS,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,IAAK,EAAkB,OAAO,CAAG,AAD/C,GAC+C,IAC7D,QAAM,SAAA,EAAQ,eAAe,GAC/B,GAAO,IACT,EAAI,GAAG,CAAC,UAAW,EAAS,KAC5B,EAAO,gBAAgB,IAE3B,EAEM,EAAY,KAChB,EAAgB,OAAO,CAAG,CAAA,EAC1B,EAAc,OAAO,CAAG,KACxB,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CAAG,EACjC,OAAO,mBAAmB,CAAC,YAAa,GACxC,OAAO,mBAAmB,CAAC,UAAW,GACtC,EAAQ,SAAS,GACnB,EAEA,OAAO,gBAAgB,CAAC,YAAa,GACrC,OAAO,gBAAgB,CAAC,UAAW,GACrC,YA+CY,UAAC,OAAI,MAAO,CAAE,YAAa,CAAE,WAAG,aAChC,UAAC,UAAW,EACV,KAAK,QACL,IAAK,EACL,IAAK,IACL,KAAM,EACN,MAAO,KAAK,KAAK,CAAC,AAAC,CAAA,EAAe,OAAO,EAAI,CAAA,EAAK,KAClD,SAAU,AAAC,GAAM,EAA0B,GAC3C,OAAQ,IAAM,IACd,MAAO,CAAE,KAAM,CAAE,SAIvB,UAAC,gBACC,WAAC,OACC,MAAO,CAAE,QAAS,OAAQ,WAAY,SAAU,IAAK,EAAG,SAAU,GAAI,MAAO,MAAO,YAEpF,UAAC,OAAI,MAAO,CAAE,YAAa,CAAE,WAAG,gBAChC,WAAC,UAAM,EACL,KAAK,QACL,MAAO,CAAE,KAAM,CAAE,EACjB,MAAO,EAAe,wBAAwB,EAAI,cAClD,SA/DgB,AAAC,IACxB,GAAW,IAChB,EAAe,GAAG,CAAC,2BAA4B,GAC/C,EAAO,gBAAgB,GACvB,EAAQ,SAAS,IACnB,YA4Dc,UAAC,IAAO,MAAM,uBAAc,WAC5B,UAAC,IAAO,MAAM,oBAAW,aACzB,UAAC,IAAO,MAAM,kBAAS,WACvB,UAAC,IAAO,MAAM,mBAAU,YACxB,UAAC,IAAO,MAAM,kBAAS,WACvB,UAAC,IAAO,MAAM,mBAAU,YACxB,UAAC,IAAO,MAAM,uBAAc,gBAC5B,UAAC,IAAO,MAAM,sBAAa,eAC3B,UAAC,IAAO,MAAM,sBAAa,eAC3B,UAAC,IAAO,MAAM,sBAAa,eAC3B,UAAC,IAAO,MAAM,sBAAa,eAC3B,UAAC,IAAO,MAAM,qBAAY,cAC1B,UAAC,IAAO,MAAM,eAAM,QACpB,UAAC,IAAO,MAAM,sBAAa,eAC3B,UAAC,IAAO,MAAM,iBAAQ,UACtB,UAAC,IAAO,MAAM,sBAAa,0BAOrC,UAAC,aAAU,EAAC,QAAS,EAAS,mBAAoB,gBAAa,CAAE,UA5P/C,AAAC,IACrB,GAAM,CAAE,OAAA,CAAM,CAAE,KAAA,CAAI,CAAE,CAAG,EAEzB,GAAI,GAAQ,EAAO,EAAE,GAAK,EAAK,EAAE,CAAE,CACjC,IAAM,EAAW,EAAQ,SAAS,CAAC,AAAC,GAAa,EAAI,GAAG,GAAK,EAAO,EAAE,EAChE,EAAW,EAAQ,SAAS,CAAC,AAAC,GAAa,EAAI,GAAG,GAAK,EAAK,EAAE,EAEpE,GAAI,AAAa,KAAb,GAAmB,AAAa,KAAb,EAAiB,CACtC,IAAM,EAAiB,EAAQ,MAAM,CAAG,EAAI,EACtC,EAAM,CAAO,CAAC,EAAS,OAE7B,GAAA,EAAQ,YAAY,CAAC,EAAK,SAC1B,GAAA,EAAQ,gBAAgB,GACxB,EAAQ,SAAS,GACjB,IACF,CACF,CACF,WA4OM,UAAC,kBAAe,EACd,MAAO,EAAQ,GAAG,CAAC,AAAC,GAAa,EAAI,GAAG,EACxC,SAAU,8BAA2B,UAErC,UAAC,OACC,MAAO,CAEL,UAAW,OACX,OAAQ,oBACR,aAAc,EACd,QAAS,CACX,WAEC,EAAQ,GAAG,CAAC,CAAC,EAAW,KACvB,IAAM,EAAa,EAAW,QAAQ,CAAC,EAAK,GAAG,EACzC,EAAO,EAAK,IAAI,EAAI,SACpB,EAAO,EAAK,IAAI,EAAI,CAAC,EAAE,EAAK,CAAC,EAAE,EAAQ,MAAM,CAAG,EAAM,CAAC,CAE7D,MACE,UAAC,IAEC,GAAI,EAAK,GAAG,CACZ,WAAY,EACZ,QAAS,AAAC,GAAM,EAAa,EAAM,YAEnC,WAAC,OACC,MAAO,CACL,QAAS,OACT,WAAY,SACZ,MAAO,OACP,eAAgB,eAClB,YAEA,UAAC,QACC,MAAO,CACL,SAAU,SACV,aAAc,WACd,WAAY,SACZ,SAAU,GACZ,WAEC,IAEH,WAAC,SAAK,EAAC,KAAM,YACX,UAAC,SAAM,EACL,KAAK,OACL,KAAK,QACL,KAAM,EAAK,OAAO,CAAG,UAAC,UAAW,KAAM,UAAC,UAAoB,KAC5D,QAAS,AAAC,GAAM,EAAiB,EAAM,GACvC,YAAa,AAAC,GAAM,EAAE,eAAe,KAEvC,UAAC,SAAM,EACL,KAAK,OACL,KAAK,QACL,KAAM,EAAK,aAAa,CAAG,UAAC,UAAY,KAAM,UAAC,UAAc,KAC7D,QAAS,AAAC,GAAM,EAAW,EAAM,GACjC,YAAa,AAAC,GAAM,EAAE,eAAe,KAEvC,UAAC,SAAM,EACL,KAAK,OACL,KAAK,QACL,MAAM,IACN,KAAM,UAAC,UAAc,KACrB,QAAS,AAAC,GAAM,EAAa,EAAM,GACnC,YAAa,AAAC,GAAM,EAAE,eAAe,YA5CtC,EAAK,GAAG,EAkDnB,YAMZ,EC1jBM,CAAE,MAAA,EAAK,CAAE,CAAG,UAAQ,CAEpB,GAAc,CAClB,CAAE,KAAM,YAAa,OAAQ,UAAO,CAAC,SAAS,CAAE,MAAO,CAAE,EACzD,CAAE,KAAM,SAAU,OAAQ,UAAO,CAAC,MAAM,CAAE,MAAO,EAAG,EACpD,CAAE,KAAM,QAAS,OAAQ,UAAO,CAAC,KAAK,CAAE,MAAO,EAAG,EAClD,CAAE,KAAM,cAAe,OAAQ,UAAO,CAAC,UAAU,CAAE,MAAO,EAAG,EAC7D,CAAE,KAAM,UAAW,OAAQ,UAAO,CAAC,OAAO,CAAE,MAAO,EAAG,EACtD,CAAE,KAAM,UAAW,OAAQ,UAAO,CAAC,OAAO,CAAE,MAAO,EAAG,EACtD,CAAE,KAAM,aAAc,OAAQ,UAAO,CAAC,UAAU,CAAE,MAAO,EAAG,EAC5D,CAAE,KAAM,cAAe,OAAQ,UAAO,CAAC,WAAW,CAAE,MAAO,EAAG,EAC9D,CAAE,KAAM,WAAY,OAAQ,UAAO,CAAC,QAAQ,CAAE,MAAO,EAAG,EACzD,CAEK,GAMD,CAAC,CAAE,KAAA,CAAI,CAAE,YAAA,CAAW,CAAE,cAAA,CAAa,CAAE,SAAA,CAAQ,CAAE,QAAA,CAAO,CAAE,IAC3D,IAAM,EAAY,GAAA,QAAM,EAAoB,MAmC5C,MAjCA,GAAA,WAAS,EAAC,KACR,GAAI,CAAC,GAAiB,CAAC,EAAU,OAAO,CAAE,OAE1C,IAAM,EAAS,EAAU,OAAO,CAC1B,EAAM,EAAO,UAAU,CAAC,MAC9B,GAAI,CAAC,EAAK,OAGV,EAAO,KAAK,CADC,GAEb,EAAO,MAAM,CAFA,GAKb,IAAM,EAAO,IAAI,cAAW,CAAC,GAEvB,EAAQ,AAPD,GAOQ,KAAK,GAAG,CAAC,EAAK,KAAK,EAAI,EAAG,EAAK,MAAM,EAAI,GAC9D,EAAK,KAAK,CAAC,GAEX,IAAM,EAAS,IAAI,EACnB,EAAK,OAAO,CAAG,CAAC,EAAO,CACvB,EAAK,YAAY,GAEjB,IAAM,EAAU,EAAK,UAAU,GAE/B,EAAI,SAAS,CAAC,EAAG,EAhBJ,GAAA,IAkBb,IAAM,EAAK,AAAC,CAAA,EAAK,KAAK,EAAI,CAAA,EAAM,CAAA,EAAK,MAAM,EAAI,CAAA,EACzC,EAAK,AAAC,CAAA,EAAK,MAAM,EAAI,CAAA,EAAM,CAAA,EAAK,MAAM,EAAI,CAAA,EAIhD,EAAI,SAAS,CAAC,EAHH,AAAC,CAAA,AApBC,GAoBM,CAAC,EAAK,EACd,AAAC,CAAA,AArBC,GAqBM,CAAC,EAAK,EAEM,EAAI,GACrC,EAAG,CAAC,EAAe,EAAY,EAG7B,WAAC,OACC,QAAS,EACT,MAAO,CACL,OAAQ,UACR,QAAS,OACT,cAAe,SACf,WAAY,SACZ,IAAK,CACP,YAEA,UAAC,OACC,MAAO,CACL,MAAO,GACP,OAAQ,GACR,OAAQ,EAAW,oBAAsB,oBACzC,aAAc,EACd,SAAU,SACV,QAAS,OACT,WAAY,SACZ,eAAgB,SAChB,WAAY,SACd,WAEA,UAAC,UAAO,IAAK,MAEf,UAAC,UAAU,CAAC,IAAI,EAAC,MAAO,CAAE,SAAU,GAAI,UAAW,SAAU,WAAY,GAAI,WAC1E,OAIT,EAEM,GAA4B,KAChC,GAAM,CAAE,OAAA,CAAM,CAAE,eAAA,CAAc,CAAE,QAAA,CAAO,CAAE,CAAG,GAAA,gBAAc,IACpD,CAAC,EAAe,EAAiB,CAAG,GAAA,UAAQ,EAA0B,MAE5E,GAAA,WAAS,EAAC,KACR,GAAI,GAAkB,EAAe,MAAM,CAAC,SAAU,CAEpD,IAAM,EAAM,AADA,EACI,MAAM,GAChB,EAAQ,IAAI,MAClB,EAAM,WAAW,CAAG,YACpB,EAAM,GAAG,CAAG,EACZ,EAAM,MAAM,CAAG,KACb,EAAiB,GACnB,EACF,MACE,EAAiB,MAErB,EAAG,CAAC,EAAe,EAEnB,IAAM,EAAc,CAAC,EAAe,KAC7B,GAAmB,EAAe,MAAM,CAAC,WAE9C,AADY,EACR,OAAO,CAAC,EAAM,CAAG,EACrB,AAFY,EAER,YAAY,SAChB,GAAA,EAAQ,gBAAgB,IAC1B,EA+CM,EAAqB,CAAC,EAAe,EAAkB,KAE3D,EAAY,EADG,EAAA,GAAU,IAAI,GAE7B,EAAQ,SAAS,GACnB,SAEA,AAAI,AAAC,GAAmB,EAAe,MAAM,CAAC,SAK5C,WAAC,OAAI,MAAO,CAAE,QAAS,GAAI,OAAQ,OAAQ,UAAW,MAAO,YAC3D,UAAC,UAAU,CAAC,KAAK,EAAC,MAAO,WAAG,gBAC5B,WAAC,UAAQ,EAAC,iBAAkB,CAAC,IAAK,IAAK,IAAI,CAAE,KAAK,cAChD,UAAC,IAAM,OAAO,iBACZ,WAAC,SAAK,EAAC,UAAU,WAAW,MAAO,CAAE,MAAO,MAAO,YACjD,WAAC,iBACC,UAAC,UAAU,CAAC,IAAI,WAAC,eACjB,UAAC,UAAM,EACL,IAAK,GACL,IAAK,EACL,KAAM,IACN,aAAc,EACd,SApEW,AAAC,IAExB,EAAY,EADG,IAAI,UAAO,CAAC,UAAU,CAAC,CAAE,WAAY,CAAM,IAE5D,EAkEc,iBAAkB,IAAM,EAAQ,SAAS,QAG7C,WAAC,iBACC,UAAC,UAAU,CAAC,IAAI,WAAC,aACjB,UAAC,UAAM,EACL,IAAK,GACL,IAAK,EACL,KAAM,IACN,aAAc,EACd,SA1ES,AAAC,IAEtB,EAAY,EADG,IAAI,UAAO,CAAC,QAAQ,CAAC,CAAE,SAAU,CAAM,IAExD,EAwEc,iBAAkB,IAAM,EAAQ,SAAS,QAG7C,WAAC,iBACC,UAAC,UAAU,CAAC,IAAI,WAAC,eACjB,UAAC,UAAM,EACL,IAAK,GACL,IAAK,EACL,KAAM,IACN,aAAc,EACd,SAhFW,AAAC,IAExB,EAAY,EADG,IAAI,UAAO,CAAC,UAAU,CAAC,CAAE,WAAY,CAAM,IAE5D,EA8Ec,iBAAkB,IAAM,EAAQ,SAAS,QAG7C,WAAC,iBACC,UAAC,UAAU,CAAC,IAAI,WAAC,aACjB,UAAC,UAAM,EACL,IAAK,GACL,IAAK,EACL,KAAM,IACN,aAAc,EACd,SAlES,AAAC,IAEtB,EAAY,EADG,IAAI,UAAO,CAAC,QAAQ,CAAC,CAAE,SAAU,CAAM,IAExD,EAgEc,iBAAkB,IAAM,EAAQ,SAAS,QAG7C,WAAC,iBACC,UAAC,UAAU,CAAC,IAAI,WAAC,UACjB,UAAC,UAAM,EACL,IAAK,GACL,IAAK,IACL,KAAM,GACN,aAAc,EACd,SAlFM,AAAC,IAEnB,EAAY,EADG,IAAI,UAAO,CAAC,KAAK,CAAC,CAAE,MAAO,CAAC,EAAO,EAAO,EAAM,AAAC,IAElE,EAgFc,iBAAkB,IAAM,EAAQ,SAAS,QAG7C,WAAC,iBACC,UAAC,UAAU,CAAC,IAAI,WAAC,iBACjB,UAAC,UAAM,EACL,IAAK,GACL,IAAK,EACL,KAAM,IACN,aAAc,EACd,SAnFY,AAAC,IAEzB,EAAY,EADG,IAAI,UAAO,CAAC,WAAW,CAAC,CAAE,SAAU,CAAM,IAE3D,EAiFc,iBAAkB,IAAM,EAAQ,SAAS,YAjEvB,KAuE1B,UAAC,IAAM,OAAO,mBACZ,WAAC,SAAK,EAAC,UAAU,WAAW,MAAO,CAAE,MAAO,MAAO,YACjD,WAAC,iBACC,UAAC,UAAU,CAAC,IAAI,WAAC,SACjB,UAAC,UAAM,EACL,IAAK,EACL,IAAK,EACL,KAAM,IACN,aAAc,EACd,SAlHK,AAAC,IAElB,EAAY,EADG,IAAI,UAAO,CAAC,IAAI,CAAC,CAAE,KAAM,CAAM,IAEhD,EAgHc,iBAAkB,IAAM,EAAQ,SAAS,QAG7C,WAAC,iBACC,UAAC,UAAU,CAAC,IAAI,WAAC,UACjB,UAAC,UAAM,EACL,IAAK,EACL,IAAK,IACL,aAAc,EACd,SAtIM,AAAC,IAEnB,EAAY,EADG,IAAI,UAAO,CAAC,KAAK,CAAC,CAAE,MAAO,CAAM,IAElD,EAoIc,iBAAkB,IAAM,EAAQ,SAAS,QAG7C,WAAC,iBACC,UAAC,UAAU,CAAC,IAAI,WAAC,aACjB,UAAC,UAAM,EACL,IAAK,EACL,IAAK,GACL,aAAc,EACd,SA3IS,AAAC,IAEtB,EAAY,EADG,EAAQ,GAAI,IAAI,UAAO,CAAC,QAAQ,CAAC,CAAE,UAAW,CAAM,IAErE,EAyIc,iBAAkB,IAAM,EAAQ,SAAS,YA9BrB,KAoC5B,UAAC,IAAM,OAAO,mBACZ,UAAC,OAAI,MAAO,CAAE,QAAS,OAAQ,oBAAqB,iBAAkB,IAAK,EAAG,WAC3E,GAAY,GAAG,CAAC,AAAC,QACG,EAAnB,IAAM,EAAW,CAAC,QAAE,iBAAD,EAAA,AAAC,EAAwB,OAAO,YAAhC,SAAA,CAAkC,CAAC,EAAK,KAAK,CAAC,EACjE,MACE,UAAC,IAEC,KAAM,EAAK,IAAI,CACf,YAAa,EAAK,MAAM,CACxB,cAAe,EACf,SAAU,EACV,QAAS,IAAM,EAAmB,EAAK,KAAK,CAAE,EAAK,MAAM,CAAE,CAAC,IALvD,EAAK,IAAI,EAQpB,MAdwB,WAlHzB,UAAC,OAAI,MAAO,CAAE,QAAS,EAAG,WAAG,8BAsIxC,EC9SM,GAAuB,KAC3B,GAAM,CACJ,OAAA,CAAM,CACN,UAAA,CAAS,CACT,aAAA,CAAY,CACZ,WAAA,CAAU,CACV,cAAA,CAAa,CACb,aAAA,CAAY,CACZ,gBAAA,CAAe,CAChB,CAAG,GAAA,gBAAc,IACZ,CAAC,EAAa,EAAe,CAAG,GAAA,UAAQ,EAAS,GACjD,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAS,UAE7C,EAAgB,GAAA,QAAM,EAAC,CAAA,GACvB,EAAc,GAAA,QAAM,EAAgB,MACpC,EAAkB,GAAA,QAAM,EAAS,GAEjC,EAAiB,GAAA,QAAM,EAAC,CAAA,GACxB,EAAe,GAAA,QAAM,EAAgB,MACrC,EAAmB,GAAA,QAAM,EAAS,GAElC,EAAkB,GAAA,QAAM,EAAC,CAAA,GACzB,EAAgB,GAAA,QAAM,EAAgB,MACtC,EAAoB,GAAA,QAAM,EAAS,SAyFzC,GAAA,WAAS,EAAC,KACR,GAAI,CAAC,EAAQ,OAGR,EAAO,gBAAgB,EAC1B,CAAA,EAAO,gBAAgB,CAAG,IAAI,cAAW,CAAC,EAAM,EAGlD,IAAM,EAAQ,EAAO,gBAAgB,CAK/B,EAAM,EAAW,OAAO,CAAC,IAAK,IAC9B,EAAI,SAAS,EAAI,SAAS,CAAC,EAAG,GAAI,IAClC,EAAI,SAAS,EAAI,SAAS,CAAC,EAAG,GAAI,IAClC,EAAI,SAAS,EAAI,SAAS,CAAC,EAAG,GAAI,IACxC,EAAM,KAAK,CAAG,CAAC,KAAK,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,EAAa,CAAC,CAAC,CACpD,EAAM,KAAK,CAAG,EAEV,EAAc,EAChB,EAAM,MAAM,CAAG,IAAI,SAAM,CAAC,CAAE,KAAM,EAAa,MAAO,EAAM,KAAK,AAAC,GAElE,EAAM,MAAM,CAAG,KAEnB,EAAG,CAAC,EAAQ,EAAY,EAAW,EAAa,EAAa,EA+B3D,WAAC,OAAI,MAAO,CAAE,QAAS,EAAG,YACxB,UAAC,UAAU,CAAC,KAAK,EAAC,MAAO,WAAG,mBAC5B,WAAC,SAAK,EAAC,UAAU,WAAW,MAAO,CAAE,MAAO,MAAO,YACjD,WAAC,iBACC,UAAC,UAAU,CAAC,IAAI,WAAC,SACjB,WAAC,UAAM,EAAC,MAAO,EAAW,MAAO,CAAE,MAAO,MAAO,EAAG,SAlClC,AAAC,QAGrB,EAFJ,GAAI,CAAC,EAAQ,OAGb,OAFA,EAAa,GAEL,GACN,IAAK,SACH,EAAQ,IAAI,cAAW,CAAC,GACxB,MACF,IAAK,QACH,EAAQ,IAAI,aAAU,CAAC,GACvB,MACF,QAEE,EAAQ,IAAI,cAAW,CAAC,GAE5B,CACA,IAAM,EAAM,EAAW,OAAO,CAAC,IAAK,IAC9B,EAAI,SAAS,EAAI,SAAS,CAAC,EAAG,GAAI,IAClC,EAAI,SAAS,EAAI,SAAS,CAAC,EAAG,GAAI,IAClC,EAAI,SAAS,EAAI,SAAS,CAAC,EAAG,GAAI,IACxC,EAAM,KAAK,CAAG,CAAC,KAAK,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,EAAa,CAAC,CAAC,CACpD,EAAM,KAAK,CAAG,EACV,EAAc,GAChB,CAAA,EAAM,MAAM,CAAG,IAAI,SAAM,CAAC,CAAE,KAAM,EAAa,MAAO,EAAM,KAAK,AAAC,EAAC,EAErE,EAAO,gBAAgB,CAAG,EAC5B,YASU,UAAC,UAAM,CAAC,MAAM,EAAC,MAAM,kBAAS,WAC9B,UAAC,UAAM,CAAC,MAAM,EAAC,MAAM,kBAAS,WAC9B,UAAC,UAAM,CAAC,MAAM,EAAC,MAAM,iBAAQ,gBAGjC,WAAC,iBACC,UAAC,UAAU,CAAC,IAAI,WAAC,UACjB,UAAC,SACD,UAAC,UAAW,EACV,MAAO,EACP,SAAU,AAAC,GAAM,EAAc,EAAE,WAAW,IAC5C,QAAQ,SAGZ,WAAC,iBACC,UAAC,UAAU,CAAC,IAAI,EACd,YArKwB,AAAC,IACjC,GAAI,AAAa,IAAb,EAAE,MAAM,CAAQ,OACpB,EAAE,cAAc,GAChB,EAAc,OAAO,CAAG,CAAA,EACxB,EAAY,OAAO,CAAG,EAAE,OAAO,CAC/B,EAAgB,OAAO,CAAG,EAC1B,IAAM,EAAiB,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CACrD,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CAAG,OAEjC,IAAM,EAAc,AAAC,IACnB,GAAI,CAAC,EAAc,OAAO,EAAI,AAAwB,OAAxB,EAAY,OAAO,CAAW,OAC5D,IAAM,EAAQ,EAAG,OAAO,CAAG,EAAY,OAAO,CAG9C,EAAa,OAAO,AADL,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,IAAM,EAAgB,OAAO,CAAG,AADhD,GACgD,IACzC,OAAO,CAAC,KACrC,EAEM,EAAY,KAChB,EAAc,OAAO,CAAG,CAAA,EACxB,EAAY,OAAO,CAAG,KACtB,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CAAG,EACjC,OAAO,mBAAmB,CAAC,YAAa,GACxC,OAAO,mBAAmB,CAAC,UAAW,GACxC,EAEA,OAAO,gBAAgB,CAAC,YAAa,GACrC,OAAO,gBAAgB,CAAC,UAAW,GACrC,EA2IU,MAAO,CAAE,OAAQ,YAAa,WAAY,MAAO,WAClD,UAGD,UAAC,SACD,UAAC,UAAW,EACV,IAAK,EACL,IAAK,IACL,MAAO,EACP,SAAU,AAAC,GAAM,EAAa,OAAO,GAAK,IAC1C,MAAO,CAAE,MAAO,MAAO,OAG3B,WAAC,iBACC,UAAC,UAAU,CAAC,IAAI,EACd,YA3H0B,AAAC,IACnC,GAAI,AAAa,IAAb,EAAE,MAAM,CAAQ,OACpB,EAAE,cAAc,GAChB,EAAgB,OAAO,CAAG,CAAA,EAC1B,EAAc,OAAO,CAAG,EAAE,OAAO,CACjC,EAAkB,OAAO,CAAG,EAC5B,IAAM,EAAiB,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CACrD,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CAAG,OAEjC,IAAM,EAAc,AAAC,IACnB,GAAI,CAAC,EAAgB,OAAO,EAAI,AAA0B,OAA1B,EAAc,OAAO,CAAW,OAChE,IAAM,EAAQ,EAAG,OAAO,CAAG,EAAc,OAAO,CAGhD,EAAgB,OAAO,AADR,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,EAAG,EAAkB,OAAO,CAAG,AAD/C,KAC+C,IACrC,OAAO,CAAC,KACxC,EAEM,EAAY,KAChB,EAAgB,OAAO,CAAG,CAAA,EAC1B,EAAc,OAAO,CAAG,KACxB,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CAAG,EACjC,OAAO,mBAAmB,CAAC,YAAa,GACxC,OAAO,mBAAmB,CAAC,UAAW,GACxC,EAEA,OAAO,gBAAgB,CAAC,YAAa,GACrC,OAAO,gBAAgB,CAAC,UAAW,GACrC,EAiGU,MAAO,CAAE,OAAQ,YAAa,WAAY,MAAO,WAClD,YAGD,UAAC,SACD,UAAC,UAAW,EACV,IAAK,EACL,IAAK,EACL,KAAM,IACN,MAAO,EACP,SAAU,AAAC,GAAM,EAAgB,OAAO,GAAK,IAC7C,MAAO,CAAE,MAAO,MAAO,OAG3B,WAAC,iBACC,UAAC,UAAU,CAAC,IAAI,EACd,YAzKyB,AAAC,IAClC,GAAI,AAAa,IAAb,EAAE,MAAM,CAAQ,OACpB,EAAE,cAAc,GAChB,EAAe,OAAO,CAAG,CAAA,EACzB,EAAa,OAAO,CAAG,EAAE,OAAO,CAChC,EAAiB,OAAO,CAAG,EAC3B,IAAM,EAAiB,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CACrD,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CAAG,OAEjC,IAAM,EAAc,AAAC,IACnB,GAAI,CAAC,EAAe,OAAO,EAAI,AAAyB,OAAzB,EAAa,OAAO,CAAW,OAC9D,IAAM,EAAQ,EAAG,OAAO,CAAG,EAAa,OAAO,CAG/C,EAAe,OAAO,AADP,KAAK,GAAG,CAAC,EAAG,KAAK,GAAG,CAAC,IAAK,EAAiB,OAAO,CAAG,AADhD,GACgD,IACvC,OAAO,CAAC,KACvC,EAEM,EAAY,KAChB,EAAe,OAAO,CAAG,CAAA,EACzB,EAAa,OAAO,CAAG,KACvB,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CAAG,EACjC,OAAO,mBAAmB,CAAC,YAAa,GACxC,OAAO,mBAAmB,CAAC,UAAW,GACxC,EAEA,OAAO,gBAAgB,CAAC,YAAa,GACrC,OAAO,gBAAgB,CAAC,UAAW,GACrC,EA+IU,MAAO,CAAE,OAAQ,YAAa,WAAY,MAAO,WAClD,gBAGD,UAAC,SACD,UAAC,UAAW,EACV,IAAK,EACL,IAAK,IACL,MAAO,EACP,SAAU,AAAC,GAAM,EAAe,OAAO,GAAK,IAC5C,MAAO,CAAE,MAAO,MAAO,aAMnC,ECpPA,IAAI,GAAe,CAAE,KAAQ,CAAE,IAAO,MAAO,MAAS,CAAE,QAAW,gBAAiB,UAAa,OAAQ,EAAG,SAAY,CAAC,CAAE,IAAO,OAAQ,MAAS,CAAE,EAAK,qYAAsY,CAAE,EAAE,AAAC,EAAG,KAAQ,OAAQ,MAAS,UAAW,ECWxkB,GAAuB,EAAM,UAAU,CANxB,SAAsB,CAAK,CAAE,CAAG,EACjD,OAAoB,EAAM,aAAa,CAAC,SAAQ,CAAE,GAAA,SAAa,EAAC,GAAA,SAAa,EAAC,CAAC,EAAG,GAAQ,CAAC,EAAG,CAC5F,IAAK,EACL,KAAM,EACR,IACF,+BCVI,GAAoB,CAAE,KAAQ,CAAE,IAAO,MAAO,MAAS,CAAE,QAAW,gBAAiB,UAAa,OAAQ,EAAG,SAAY,CAAC,CAAE,IAAO,OAAQ,MAAS,CAAE,EAAK,gXAAiX,CAAE,EAAE,AAAC,EAAG,KAAQ,YAAa,MAAS,UAAW,ECW7jB,GAAuB,EAAM,UAAU,CANnB,SAA2B,CAAK,CAAE,CAAG,EAC3D,OAAoB,EAAM,aAAa,CAAC,SAAQ,CAAE,GAAA,SAAa,EAAC,GAAA,SAAa,EAAC,CAAC,EAAG,GAAQ,CAAC,EAAG,CAC5F,IAAK,EACL,KAAM,EACR,IACF,uFCEA,IAAM,GAAQ,CAAC,QAAS,YAAa,kBAAmB,UAAW,cAAe,UAAU,CAEtF,GAA2B,KAC/B,GAAM,CAAE,OAAA,CAAM,CAAE,eAAA,CAAc,CAAE,QAAA,CAAO,CAAE,cAAA,CAAa,CAAE,CAAG,GAAA,gBAAc,IACnE,CAAC,EAAY,EAAc,CAAG,GAAA,UAAQ,EAAS,SAC/C,CAAC,EAAU,EAAY,CAAG,GAAA,UAAQ,EAAS,IAC3C,CAAC,EAAM,EAAQ,CAAG,GAAA,UAAQ,EAAU,CAAA,GACpC,CAAC,EAAQ,EAAU,CAAG,GAAA,UAAQ,EAAU,CAAA,GACxC,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAU,CAAA,GAC9C,CAAC,EAAO,EAAS,CAAG,GAAA,UAAQ,EAA8B,QAC1D,CAAC,EAAO,EAAS,CAAG,GAAA,UAAQ,EAAS,WAE3C,GAAA,WAAS,EAAC,KACJ,GAAkB,AAAmC,WAAnC,AAAC,EAAuB,MAAM,GAElD,EAAc,AAAC,AADH,EACO,UAAU,EAAe,SAC5C,EAAY,AAAC,AAFD,EAEK,QAAQ,EAAe,IACxC,EAAQ,AAAmB,SAAnB,AAHI,EAGA,UAAU,EAAe,AAAmB,MAAnB,AAHzB,EAG6B,UAAU,EACnD,EAAU,AAAkB,WAAlB,AAJE,EAIE,SAAS,EACvB,EAAa,AAAC,AALF,EAKM,SAAS,EAAgB,CAAA,GAC3C,EAAS,AAAC,AANE,EAME,SAAS,EAAY,QACnC,EAAS,AAAC,AAPE,EAOE,IAAI,EAAe,YAErC,EAAG,CAAC,EAAe,EAEnB,IAAM,EAAQ,CAAC,EAA4B,EAAO,CAAA,CAAI,IAC/C,IACL,EAAe,GAAG,CAAC,GACnB,EAAe,SAAS,EAAI,EAAe,SAAS,GACpD,GAAU,EAAO,gBAAgB,GAC7B,GAAQ,GAAS,EAAQ,SAAS,IACxC,EAkDA,MACE,WAAC,OAAI,MAAO,CAAE,QAAS,EAAG,YACxB,UAAC,OAAI,MAAO,CAAE,aAAc,CAAE,WAC5B,UAAC,mBAAO,WAGV,WAAC,SAAK,EAAC,UAAU,WAAW,MAAO,CAAE,MAAO,MAAO,YACjD,UAAC,UAAM,EACL,MAAO,EACP,SAAU,AAAC,IACT,EAAc,GACd,EAAM,CAAE,WAAY,CAAE,GACxB,EACA,MAAO,CAAE,MAAO,MAAO,WAEtB,GAAM,GAAG,CAAC,AAAC,GACV,UAAC,UAAM,CAAC,MAAM,EAAS,MAAO,WAC3B,GADiB,MAMxB,UAAC,UAAW,EACV,IAAK,EACL,IAAK,IACL,MAAO,EACP,SAAU,AAAC,IACT,EAAY,GAAK,IACjB,EAAM,CAAE,SAAU,GAAK,EAAG,GAC5B,EACA,MAAO,CAAE,MAAO,MAAO,IAGzB,UAAC,gBACC,WAAC,SAAK,YACJ,UAAC,SAAM,EACL,KAAM,UAAC,OACP,KAAM,EAAO,UAAY,UACzB,QAAS,KACP,IAAM,EAAS,CAAC,EAChB,EAAQ,GACR,EAAM,CAAE,WAAY,EAAS,OAAS,QAAS,GACjD,IAEF,UAAC,SAAM,EACL,KAAM,UAAC,UAAc,KACrB,KAAM,EAAS,UAAY,UAC3B,QAAS,KACP,IAAM,EAAS,CAAC,EAChB,EAAU,GACV,EAAM,CAAE,UAAW,EAAS,SAAW,QAAS,GAClD,IAEF,UAAC,SAAM,EACL,KAAM,UAAC,OACP,KAAM,EAAY,UAAY,UAC9B,QAAS,KACP,IAAM,EAAS,CAAC,EAChB,EAAa,GACb,EAAM,CAAE,UAAW,CAAO,GAC5B,SAKN,UAAC,SAAO,KAER,WAAC,iBACC,UAAC,mBAAO,iCACR,UAAC,OAAI,MAAO,CAAE,UAAW,CAAE,WACzB,WAAC,SAAK,YACJ,UAAC,SAAM,EACL,KAAM,UAAC,UAAiB,KACxB,KAAM,AAAU,SAAV,EAAmB,UAAY,UACrC,QAAS,KACP,EAAS,QACT,EAAM,CAAE,UAAW,MAAO,GAC5B,IAEF,UAAC,SAAM,EACL,KAAM,UAAC,UAAmB,KAC1B,KAAM,AAAU,WAAV,EAAqB,UAAY,UACvC,QAAS,KACP,EAAS,UACT,EAAM,CAAE,UAAW,QAAS,GAC9B,IAEF,UAAC,SAAM,EACL,KAAM,UAAC,UAAkB,KACzB,KAAM,AAAU,UAAV,EAAoB,UAAY,UACtC,QAAS,KACP,EAAS,SACT,EAAM,CAAE,UAAW,OAAQ,GAC7B,YAMR,UAAC,SAAO,KAER,WAAC,iBACC,UAAC,mBAAO,UACR,UAAC,OAAI,MAAO,CAAE,UAAW,CAAE,WACzB,UAAC,UAAW,EACV,MAAO,EACP,SAAU,AAAC,IACT,IAAM,EAAM,EAAE,WAAW,GACzB,EAAS,GACT,EAAM,CAAE,KAAM,CAAI,GAElB,GAAI,QACG,SAAD,AAAC,EAAwB,SAAS,GACpC,GAAiB,EAAc,QAEnC,CAAE,MAAO,EAAG,CAEZ,CACF,EACA,QAAQ,iBAOtB,ECxNM,GAA0B,KAC9B,GAAM,CAAE,OAAA,CAAM,CAAE,eAAA,CAAc,CAAE,QAAA,CAAO,CAAE,CAAG,GAAA,gBAAc,IAEpD,EAAoB,KACxB,GAAI,CAAC,EAAQ,OAAO,KACpB,IAAM,EAAO,EAAO,UAAU,GAC9B,GAAI,CAAC,GAAQ,AAAgB,IAAhB,EAAK,MAAM,CAAQ,OAAO,KACvC,IAAM,EAAQ,CAAI,CAAC,EAAE,CACrB,GAAI,CACF,OAAO,EAAM,eAAe,GAC9B,CAAE,MAAO,EAAG,CACV,OAAO,KACT,CACF,EAEM,EAAQ,AAAC,IACR,IACL,EAAe,GAAG,CAAC,GACnB,EAAe,SAAS,EAAI,EAAe,SAAS,GACpD,GAAU,EAAO,gBAAgB,GAC7B,GAAS,EAAQ,SAAS,IAChC,EAEM,EAAyB,AAAC,IAC9B,GAAI,CAAC,GAAU,CAAC,EAAgB,OAChC,IAAM,EAAS,IACf,GAAI,CAAC,EAAQ,OACb,IAAM,EAAU,EAAe,eAAe,GAE1C,EAAO,EAAe,IAAI,EAAI,EAC9B,AAAS,SAAT,EACF,EAAO,EAAO,IAAI,CACT,AAAS,WAAT,EACT,EAAO,EAAO,IAAI,CAAG,AAAC,CAAA,EAAO,KAAK,CAAG,EAAQ,KAAK,AAAD,EAAK,EACpC,UAAT,GACT,CAAA,EAAO,EAAO,IAAI,CAAG,EAAO,KAAK,CAAG,EAAQ,KAAK,AAAD,EAGlD,EAAM,CAAE,KAAA,CAAK,GACf,EAEM,EAAuB,AAAC,IAC5B,GAAI,CAAC,GAAU,CAAC,EAAgB,OAChC,IAAM,EAAS,IACf,GAAI,CAAC,EAAQ,OACb,IAAM,EAAU,EAAe,eAAe,GAE1C,EAAM,EAAe,GAAG,EAAI,EAC5B,AAAS,QAAT,EACF,EAAM,EAAO,GAAG,CACP,AAAS,WAAT,EACT,EAAM,EAAO,GAAG,CAAG,AAAC,CAAA,EAAO,MAAM,CAAG,EAAQ,MAAM,AAAD,EAAK,EACpC,WAAT,GACT,CAAA,EAAM,EAAO,GAAG,CAAG,EAAO,MAAM,CAAG,EAAQ,MAAM,AAAD,EAGlD,EAAM,CAAE,IAAA,CAAI,GACd,EAEA,MACE,WAAC,OAAI,MAAO,CAAE,QAAS,EAAG,YACxB,UAAC,OAAI,MAAO,CAAE,aAAc,CAAE,WAC5B,UAAC,mBAAO,2BAEV,UAAC,OAAI,MAAO,CAAE,aAAc,CAAE,WAC5B,WAAC,SAAK,YACJ,UAAC,SAAM,EAAC,QAAS,IAAM,EAAuB,iBAAS,YACvD,UAAC,SAAM,EAAC,QAAS,IAAM,EAAuB,mBAAW,cACzD,UAAC,SAAM,EAAC,QAAS,IAAM,EAAuB,kBAAU,kBAG5D,UAAC,gBACC,WAAC,SAAK,YACJ,UAAC,SAAM,EAAC,QAAS,IAAM,EAAqB,gBAAQ,WACpD,UAAC,SAAM,EAAC,QAAS,IAAM,EAAqB,mBAAW,cACvD,UAAC,SAAM,EAAC,QAAS,IAAM,EAAqB,mBAAW,sBAKjE,EC/EM,CAAE,MAAA,EAAK,CAAE,KAAA,EAAI,CAAE,CAAG,UAAU,CAE5B,GAA4B,KAChC,GAAM,CAAE,OAAA,CAAM,CAAE,eAAA,CAAc,CAAE,QAAA,CAAO,CAAE,CAAG,GAAA,gBAAc,IAE1D,GAAI,CAAC,GAAkB,CAAC,EAAQ,OAAO,KAGvC,IAAM,EAAiB,CAAC,EAAyB,KAC/C,EAAe,GAAG,CAAC,EAAK,GACxB,EAAO,gBAAgB,GACvB,EAAQ,SAAS,GACnB,EAEM,EAAc,EAAe,WAAW,EAAI,EAC5C,EAAc,EAAe,MAAM,EAAI,UACvC,EAAY,EAAe,IAAI,EAAI,cAEzC,MACE,WAAC,OAAI,MAAO,CAAE,QAAS,EAAG,YACxB,UAAC,IAAM,MAAO,WAAG,gBAEjB,WAAC,SAAK,EAAC,UAAU,WAAW,MAAO,CAAE,MAAO,MAAO,EAAG,KAAK,mBAEzD,WAAC,iBACC,UAAC,IAAK,MAAM,aAAC,eACb,UAAC,OAAI,MAAO,CAAE,UAAW,CAAE,WACzB,UAAC,UAAW,EACV,MAAO,EACP,SAAU,AAAC,GAAU,EAAe,OAAQ,EAAM,WAAW,IAC7D,QAAQ,WAMd,WAAC,iBACC,UAAC,IAAK,MAAM,aAAC,iBACb,UAAC,OAAI,MAAO,CAAE,UAAW,CAAE,WACzB,UAAC,UAAW,EACV,MAAO,EACP,SAAU,AAAC,GAAU,EAAe,SAAU,EAAM,WAAW,IAC/D,QAAQ,WAMd,WAAC,iBACC,UAAC,IAAK,MAAM,aAAC,qBACb,WAAC,UAAG,EAAC,OAAQ,GAAI,MAAM,mBACrB,UAAC,UAAG,EAAC,KAAM,YACT,UAAC,UAAM,EACL,IAAK,EACL,IAAK,GACL,MAAO,EACP,SAAU,AAAC,GAAQ,EAAe,cAAe,OAGrD,UAAC,UAAG,EAAC,KAAM,WACT,UAAC,UAAW,EACV,IAAK,EACL,IAAK,GACL,MAAO,EACP,SAAU,AAAC,GAAQ,EAAe,cAAe,OAAO,IACxD,MAAO,CAAE,MAAO,MAAO,kBAQvC,ECrEM,GAA4B,KAChC,GAAM,CAAE,WAAA,CAAU,CAAE,eAAA,CAAc,CAAE,CAAG,GAAA,gBAAc,IAErD,GAAI,AAAe,UAAf,EAAwB,MAAO,UAAC,OAEpC,GAAI,AAAe,SAAf,EAAuB,MAAO,UAAC,OAGnC,GAAI,GAAmB,CAAA,AAAwB,WAAxB,EAAe,IAAI,EAAiB,AAAwB,SAAxB,EAAe,IAAI,AAAU,EACtF,MACE,iCACE,UAAC,OACD,UAAC,OACD,UAAC,UAIP,GAAI,EAAgB,CAClB,IAAM,EAAU,aAA0B,cAAW,EAAI,AAAwB,UAAxB,EAAe,IAAI,CAE5E,MACE,iCACG,EAAU,UAAC,OAAqB,UAAC,OAClC,UAAC,UAGP,CAEA,MAAO,UAAC,OACV,8DC9BA,IAAM,GAAwC,CAAC,CAAE,SAAA,CAAQ,CAAE,GAEvD,WAAC,UAAM,CAAC,OAAO,EACb,aAAc,EACd,eAAgB,CAAA,EAChB,OAAO,kBACP,OAAQ,cAER,UAAC,KAAE,UAAU,gCACX,UAAC,UAAa,OAEhB,UAAC,KAAE,UAAU,2BAAkB,8CAC/B,UAAC,KAAE,UAAU,2BAAkB,gFChBxB,GAAiB,KAC5B,GAAM,CAAC,EAAS,EAAW,CAAG,GAAA,UAAQ,EAAgB,MAChD,CAAC,EAAgB,EAAkB,CAAG,GAAA,UAAQ,EAAsB,MACpE,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAc,MAClD,CAAC,EAAU,EAAY,CAAG,GAAA,UAAQ,EAAC,CAAA,GACnC,EAAc,GAAA,QAAM,EAAC,GAErB,EAAe,GAAA,aAAW,EAC9B,AAAC,IACC,IAAM,EAAS,IAAI,WAYnB,OAXA,EAAO,MAAM,CAAG,AAAC,IACf,GAAI,EACF,EAAa,OACR,KACM,EAAX,UAAW,EAAA,EAAE,MAAM,YAAR,SAAA,EAAU,MAAM,EAC3B,EAAkB,MACpB,CACF,EACA,EAAO,aAAa,CAAC,GACrB,EAAY,CAAA,GACZ,EAAY,OAAO,CAAG,EACf,CAAA,EACT,EACA,CAAC,EAAQ,EAGL,EAAc,GAAA,aAAW,EAAC,AAAC,IAC/B,EAAkB,GAClB,EAAW,EAAQ,SAAS,EAC9B,EAAG,EAAE,EAEC,EAAc,GAAA,aAAW,EAAC,KAC9B,EAAW,MACX,EAAa,MACb,EAAkB,MAClB,UAAO,CAAC,IAAI,CAAC,kBACf,EAAG,EAAE,EAuBL,MApBA,GAAA,WAAS,EAAC,KACR,IAAM,EAAc,AAAC,QACL,EAAd,IAAM,UAAQ,EAAA,EAAE,aAAa,YAAf,SAAA,EAAiB,KAAK,CACpC,GAAI,CAAC,EAAO,OAEZ,IAAM,EAAY,MAAM,IAAI,CAAC,GAAO,IAAI,CAAC,AAAC,GAAS,EAAK,IAAI,CAAC,QAAQ,CAAC,UACtE,GAAI,EAAW,CACb,IAAM,EAAO,EAAU,SAAS,GAC5B,IACF,EAAa,GACb,UAAO,CAAC,OAAO,CAAC,gCAChB,EAAE,cAAc,IAEpB,CACF,EAGA,OADA,OAAO,gBAAgB,CAAC,QAAS,GAC1B,IAAM,OAAO,mBAAmB,CAAC,QAAS,GACnD,EAAG,CAAC,EAAa,EAEV,CACL,QAAA,EACA,WAAA,EACA,UAAA,EACA,aAAA,EACA,SAAA,EACA,YAAA,EACA,YAAA,EACA,aAAA,EACA,YAAA,EACA,YAAA,EACA,eAAA,CACF,EACF,MC1EA,GAAe,CAA2C,gBAAmB,2BAA6P,cAAiB,yBAA6Q,aAAgB,wBAAgE,gBAAmB,0BAAsI,ECej1B,GAAM,CAAE,MAAA,EAAK,CAAE,QAAA,EAAO,CAAE,CAAG,SAAM,CAE3B,GAAwB,KAC5B,GAAM,CACJ,QAAA,CAAO,CACP,SAAA,CAAQ,CACR,YAAA,CAAW,CACX,YAAA,CAAW,CACX,aAAA,CAAY,CACZ,UAAA,CAAS,CACT,aAAA,CAAY,CACZ,YAAA,CAAW,CACX,eAAA,CAAc,CACf,CAAG,KAEE,CAAE,cAAA,CAAa,CAAE,cAAA,CAAa,CAAE,CAAG,KAEzC,MACE,UAAC,eAAa,EACZ,MACE,WAAC,kBAAK,gBACS,UAAC,SAAG,EAAC,MAAM,gBAAO,qBAInC,UAAC,SAAe,EACd,YAAa,EACb,YAAa,EACb,aAAc,WAEd,WAAC,SAAI,EAAC,UAAW,GAAO,eAAe,CAAE,UAAW,CAAE,QAAS,EAAG,OAAQ,MAAO,YAC9E,GAAY,UAAC,SAAW,KAExB,AAAC,EAyBA,UAAC,qBAAmB,EAClB,SAAU,EACV,eAAgB,EAChB,UAAW,EACX,aAAc,WAEd,WAAC,SAAM,EAAC,MAAO,CAAE,OAAQ,MAAO,YAC9B,UAAC,IAAM,MAAM,QAAQ,MAAO,GAAI,UAAW,GAAO,YAAY,UAC5D,UAAC,SAEH,UAAC,IAAQ,UAAW,GAAO,aAAa,UACtC,UAAC,SAEH,WAAC,IAAM,MAAM,QAAQ,MAAO,IAAK,UAAW,GAAO,eAAe,WAChE,UAAC,OACD,UAAC,eAvCP,WAAC,OACC,MAAO,CACL,QAAS,OACT,cAAe,SACf,eAAgB,SAChB,WAAY,SACZ,OAAQ,OACR,QAAS,OACT,UAAW,MACb,YAEA,UAAC,IAAW,SAAU,IACrB,EAAc,MAAM,CAAG,GACtB,WAAC,OAAI,MAAO,CAAE,MAAO,OAAQ,SAAU,QAAS,UAAW,MAAO,YAChE,UAAC,SAAO,WAAC,0BACT,UAAC,IACC,SAAU,EACV,OAAQ,EACR,SAAU,iBA8B9B,mNChGO,IAAM,EAAa,AAAC,IACzB,GAAM,CAAC,EAAS,EAAW,CAAG,GAAA,UAAQ,EAAW,EAAE,EAC7C,CAAC,EAAc,EAAgB,CAAG,GAAA,UAAQ,EAAS,IACnD,CAAC,EAAqB,EAAuB,CAAG,GAAA,UAAQ,EAAU,CAAA,GAElE,EAAY,GAAA,aAAW,EAAC,KAC5B,GAAI,CAAC,GAAU,EAAqB,OAEpC,IAAM,EAAO,KAAK,SAAS,CAAC,EAAO,MAAM,IAGzC,GAAI,EAAQ,MAAM,CAAG,GAAK,GAAgB,GAAK,CAAO,CAAC,EAAa,GAAK,EACvE,OAIF,IAAM,EAAa,EAAQ,KAAK,CAAC,EAAG,EAAe,GACnD,EAAW,IAAI,CAAC,GAGZ,EAAW,MAAM,CAAG,IACtB,EAAW,KAAK,GAGlB,EAAW,GACX,EAAgB,EAAW,MAAM,CAAG,GACtC,EAAG,CAAC,EAAQ,EAAS,EAAc,EAAoB,EAkDvD,MAhDA,GAAA,WAAS,EAAC,KACR,GAAI,CAAC,EAAQ,OAEb,IAAM,EAAa,KACjB,IACF,EAOA,OALA,EAAO,EAAE,CAAC,kBAAmB,GAC7B,EAAO,EAAE,CAAC,eAAgB,GAC1B,EAAO,EAAE,CAAC,iBAAkB,GAC5B,EAAO,EAAE,CAAC,eAAgB,GAEnB,KACL,EAAO,GAAG,CAAC,kBAAmB,GAC9B,EAAO,GAAG,CAAC,eAAgB,GAC3B,EAAO,GAAG,CAAC,iBAAkB,GAC7B,EAAO,GAAG,CAAC,eAAgB,GAC7B,EACF,EAAG,CAAC,EAAQ,EAAU,EA8Bf,CACL,UAAA,EACA,KA9BW,GAAA,aAAW,EAAC,KACvB,GAAI,CAAC,GAAU,GAAgB,GAAK,EAAqB,OAEzD,EAAuB,CAAA,GACvB,IAAM,EAAW,EAAe,EAC1B,EAAO,CAAO,CAAC,EAAS,CAE9B,EAAO,YAAY,CAAC,KAAK,KAAK,CAAC,IAAO,IAAI,CAAC,KACzC,EAAO,SAAS,GAChB,EAAgB,GAChB,EAAuB,CAAA,GACzB,GACF,EAAG,CAAC,EAAQ,EAAS,EAAc,EAAoB,EAmBrD,KAjBW,GAAA,aAAW,EAAC,KACvB,GAAI,CAAC,GAAU,GAAgB,EAAQ,MAAM,CAAG,GAAK,EAAqB,OAE1E,EAAuB,CAAA,GACvB,IAAM,EAAW,EAAe,EAC1B,EAAO,CAAO,CAAC,EAAS,CAE9B,EAAO,YAAY,CAAC,KAAK,KAAK,CAAC,IAAO,IAAI,CAAC,KACzC,EAAO,SAAS,GAChB,EAAgB,GAChB,EAAuB,CAAA,GACzB,GACF,EAAG,CAAC,EAAQ,EAAS,EAAc,EAAoB,EAMrD,QAAS,EAAe,EACxB,QAAS,EAAe,EAAQ,MAAM,CAAG,CAC3C,EACF,ECtDM,EAAqB,GAAA,eAAa,EAAqC,KAAA,GAEhE,EAMR,CAAC,CAAE,SAAA,CAAQ,CAAE,SAAA,CAAQ,CAAE,eAAA,CAAc,CAAE,UAAA,CAAS,CAAE,aAAA,CAAY,CAAE,IACnE,GAAM,CAAC,EAAQ,EAAU,CAAG,GAAA,UAAQ,EAAgB,MAC9C,CAAC,EAAY,EAAc,CAAG,GAAA,UAAQ,EAAS,UAC/C,CAAC,EAAgB,EAAkB,CAAG,GAAA,UAAQ,EAAsB,MACpE,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAsB,MAC1D,CAAC,EAAW,EAAa,CAAG,GAAA,UAAQ,EAAS,GAC7C,CAAC,EAAY,EAAc,CAAG,GAAA,UAAQ,EAAS,WAC/C,CAAC,EAAc,EAAgB,CAAG,GAAA,UAAQ,EAAS,GAEnD,EAAU,EAAW,GAE3B,MACE,UAAC,EAAmB,QAAQ,EAC1B,MAAO,CACL,OAAA,EACA,UAAA,EACA,WAAA,EACA,cAAA,EACA,eAAA,EACA,kBAAA,EACA,QAAA,EACA,UAAA,EACA,aAAA,EACA,SAAA,EACA,eAAA,EACA,UAAA,EACA,aAAA,EACA,UAAA,EACA,aAAA,EACA,WAAA,EACA,cAAA,EACA,aAAA,EACA,gBAAA,CACF,WAEC,IAGP,EACa,EAAiB,KAC5B,IAAM,EAAU,GAAA,YAAU,EAAC,GAC3B,GAAI,CAAC,EACH,MAAM,AAAI,MAAM,4DAElB,OAAO,EACT"}