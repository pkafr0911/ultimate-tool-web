{"version":3,"sources":["src/pages/VectorEditor/hooks/useHistory.ts","src/pages/VectorEditor/context.tsx","node_modules/@ant-design/icons-svg/es/asn/StopOutlined.js","node_modules/@ant-design/icons/es/icons/StopOutlined.js","src/pages/VectorEditor/components/SettingsModal.tsx","src/pages/VectorEditor/components/Toolbar.tsx","src/pages/VectorEditor/hooks/useShortcuts.ts","src/pages/VectorEditor/hooks/usePenTool.ts","src/pages/VectorEditor/utils/pathGeometry.ts","src/pages/VectorEditor/components/CanvasArea.tsx","src/pages/VectorEditor/hooks/usePointEditor.ts","src/pages/VectorEditor/components/PropertiesPanel.tsx","src/pages/VectorEditor/components/LayersPanel.tsx","node_modules/@ant-design/icons-svg/es/asn/VerticalAlignTopOutlined.js","node_modules/@ant-design/icons/es/icons/VerticalAlignTopOutlined.js","node_modules/@ant-design/icons-svg/es/asn/VerticalAlignBottomOutlined.js","node_modules/@ant-design/icons/es/icons/VerticalAlignBottomOutlined.js","src/pages/VectorEditor/components/AlignmentPanel.tsx","src/pages/VectorEditor/index.tsx","/home/thanhnd/Downloads/code/ultimate-tool-web/src/pages/VectorEditor/styles.less?asmodule"],"sourcesContent":["import { useState, useCallback } from 'react';\nimport { Canvas } from 'fabric';\n\nexport const useHistory = (canvas: Canvas | null) => {\n  const [history, setHistory] = useState<string[]>([]);\n  const [historyIndex, setHistoryIndex] = useState<number>(-1);\n  const [isHistoryProcessing, setIsHistoryProcessing] = useState<boolean>(false);\n\n  const saveState = useCallback(() => {\n    if (!canvas || isHistoryProcessing) return;\n\n    const json = JSON.stringify(canvas.toJSON());\n\n    // If we are in the middle of the history, discard the future\n    const newHistory = history.slice(0, historyIndex + 1);\n    newHistory.push(json);\n\n    // Limit history size if needed (e.g., 50)\n    if (newHistory.length > 50) {\n      newHistory.shift();\n    }\n\n    setHistory(newHistory);\n    setHistoryIndex(newHistory.length - 1);\n  }, [canvas, history, historyIndex, isHistoryProcessing]);\n\n  const undo = useCallback(() => {\n    if (!canvas || historyIndex <= 0 || isHistoryProcessing) return;\n\n    setIsHistoryProcessing(true);\n    const newIndex = historyIndex - 1;\n    const json = history[newIndex];\n\n    canvas.loadFromJSON(JSON.parse(json), () => {\n      canvas.renderAll();\n      setHistoryIndex(newIndex);\n      setIsHistoryProcessing(false);\n    });\n  }, [canvas, history, historyIndex, isHistoryProcessing]);\n\n  const redo = useCallback(() => {\n    if (!canvas || historyIndex >= history.length - 1 || isHistoryProcessing) return;\n\n    setIsHistoryProcessing(true);\n    const newIndex = historyIndex + 1;\n    const json = history[newIndex];\n\n    canvas.loadFromJSON(JSON.parse(json), () => {\n      canvas.renderAll();\n      setHistoryIndex(newIndex);\n      setIsHistoryProcessing(false);\n    });\n  }, [canvas, history, historyIndex, isHistoryProcessing]);\n\n  return {\n    saveState,\n    undo,\n    redo,\n    canUndo: historyIndex > 0,\n    canRedo: historyIndex < history.length - 1,\n  };\n};\n","import React, { createContext, useContext, useState } from 'react';\nimport { Canvas, FabricObject } from 'fabric';\nimport { useHistory } from './hooks/useHistory';\n\ninterface VectorEditorContextType {\n  canvas: Canvas | null;\n  setCanvas: (canvas: Canvas) => void;\n  selectedObject: FabricObject | null;\n  setSelectedObject: (object: FabricObject | null) => void;\n  activeTool: string;\n  setActiveTool: (tool: string) => void;\n  history: {\n    saveState: () => void;\n    undo: () => void;\n    redo: () => void;\n    canUndo: boolean;\n    canRedo: boolean;\n  };\n  pointEditor: any;\n  setPointEditor: (editor: any) => void;\n}\n\nconst VectorEditorContext = createContext<VectorEditorContextType | undefined>(undefined);\n\nexport const VectorEditorProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [canvas, setCanvas] = useState<Canvas | null>(null);\n  const [selectedObject, setSelectedObject] = useState<FabricObject | null>(null);\n  const [activeTool, setActiveTool] = useState<string>('select');\n  const [pointEditor, setPointEditor] = useState<any>(null);\n\n  const history = useHistory(canvas);\n\n  return (\n    <VectorEditorContext.Provider\n      value={{\n        canvas,\n        setCanvas,\n        selectedObject,\n        setSelectedObject,\n        activeTool,\n        setActiveTool,\n        history,\n        pointEditor,\n        setPointEditor,\n      }}\n    >\n      {children}\n    </VectorEditorContext.Provider>\n  );\n};\n\nexport const useVectorEditor = () => {\n  const context = useContext(VectorEditorContext);\n  if (!context) {\n    throw new Error('useVectorEditor must be used within a VectorEditorProvider');\n  }\n  return context;\n};\n","// This icon file is generated automatically.\nvar StopOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372 0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884zm288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372 0 89-31.3 170.8-83.5 234.8z\" } }] }, \"name\": \"stop\", \"theme\": \"outlined\" };\nexport default StopOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport StopOutlinedSvg from \"@ant-design/icons-svg/es/asn/StopOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar StopOutlined = function StopOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: StopOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(StopOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'StopOutlined';\n}\nexport default RefIcon;","import React from 'react';\nimport { Modal, Form, ColorPicker, Switch, InputNumber } from 'antd';\nimport { useVectorEditor } from '../context';\n\ninterface SettingsModalProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nconst SettingsModal: React.FC<SettingsModalProps> = ({ open, onClose }) => {\n  const { canvas, history } = useVectorEditor();\n  const [form] = Form.useForm();\n\n  const handleValuesChange = (changedValues: any, allValues: any) => {\n    if (!canvas) return;\n\n    if (changedValues.backgroundColor) {\n      const color =\n        typeof changedValues.backgroundColor === 'string'\n          ? changedValues.backgroundColor\n          : changedValues.backgroundColor.toHexString();\n      canvas.backgroundColor = color;\n      canvas.requestRenderAll();\n      // We might not want to save history on every color drag, but for now it's okay or we can debounce\n    }\n\n    if (changedValues.width || changedValues.height) {\n      canvas.setDimensions({\n        width: allValues.width || canvas.width,\n        height: allValues.height || canvas.height,\n      });\n      canvas.requestRenderAll();\n    }\n  };\n\n  const initialValues = {\n    backgroundColor: canvas?.backgroundColor || '#ffffff',\n    width: canvas?.width,\n    height: canvas?.height,\n  };\n\n  return (\n    <Modal title=\"Canvas Settings\" open={open} onCancel={onClose} footer={null} destroyOnHidden>\n      <Form\n        form={form}\n        layout=\"vertical\"\n        initialValues={initialValues}\n        onValuesChange={handleValuesChange}\n      >\n        <Form.Item label=\"Background Color\" name=\"backgroundColor\">\n          <ColorPicker showText />\n        </Form.Item>\n        <Form.Item label=\"Canvas Width\" name=\"width\">\n          <InputNumber />\n        </Form.Item>\n        <Form.Item label=\"Canvas Height\" name=\"height\">\n          <InputNumber />\n        </Form.Item>\n      </Form>\n    </Modal>\n  );\n};\n\nexport default SettingsModal;\n","import React from 'react';\nimport { Button, Tooltip, Space, Divider } from 'antd';\nimport {\n  DragOutlined,\n  BorderOutlined,\n  StopOutlined,\n  FontSizeOutlined,\n  DeleteOutlined,\n  DownloadOutlined,\n  HighlightOutlined,\n  UndoOutlined,\n  RedoOutlined,\n  ZoomInOutlined,\n  ZoomOutOutlined,\n  ExpandOutlined,\n  EditOutlined,\n  SettingOutlined,\n} from '@ant-design/icons';\nimport { Rect, Circle, IText } from 'fabric';\nimport { useVectorEditor } from '../context';\nimport SettingsModal from './SettingsModal';\n\nconst Toolbar: React.FC = () => {\n  const { canvas, activeTool, setActiveTool, history } = useVectorEditor();\n  const [settingsOpen, setSettingsOpen] = React.useState(false);\n\n  const addRectangle = () => {\n    if (!canvas) return;\n    const rect = new Rect({\n      left: 100,\n      top: 100,\n      fill: '#ff0000',\n      width: 100,\n      height: 100,\n    });\n    canvas.add(rect);\n    canvas.setActiveObject(rect);\n    setActiveTool('select');\n  };\n\n  const addCircle = () => {\n    if (!canvas) return;\n    const circle = new Circle({\n      left: 100,\n      top: 100,\n      fill: '#00ff00',\n      radius: 50,\n    });\n    canvas.add(circle);\n    canvas.setActiveObject(circle);\n    setActiveTool('select');\n  };\n\n  const addText = () => {\n    if (!canvas) return;\n    const text = new IText('Type here', {\n      left: 100,\n      top: 100,\n      fontFamily: 'arial',\n      fill: '#333',\n      fontSize: 20,\n    });\n    canvas.add(text);\n    canvas.setActiveObject(text);\n    setActiveTool('select');\n  };\n\n  const clearCanvas = () => {\n    if (!canvas) return;\n    canvas.clear();\n    canvas.backgroundColor = '#ffffff';\n    canvas.renderAll();\n    history.saveState();\n  };\n\n  const exportSVG = () => {\n    if (!canvas) return;\n\n    // Save current background color\n    const originalBg = canvas.backgroundColor;\n\n    // Set background to transparent for export\n    canvas.backgroundColor = 'transparent';\n\n    // Calculate bounding box of all objects\n    const objects = canvas.getObjects();\n    let svg;\n\n    if (objects.length > 0) {\n      let minX = Infinity,\n        minY = Infinity,\n        maxX = -Infinity,\n        maxY = -Infinity;\n\n      objects.forEach((obj) => {\n        const br = obj.getBoundingRect();\n        if (br.left < minX) minX = br.left;\n        if (br.top < minY) minY = br.top;\n        if (br.left + br.width > maxX) maxX = br.left + br.width;\n        if (br.top + br.height > maxY) maxY = br.top + br.height;\n      });\n\n      // Add some padding\n      const padding = 10;\n      minX -= padding;\n      minY -= padding;\n      maxX += padding;\n      maxY += padding;\n\n      const width = maxX - minX;\n      const height = maxY - minY;\n\n      svg = canvas.toSVG({\n        viewBox: {\n          x: minX,\n          y: minY,\n          width: width,\n          height: height,\n        },\n        width: width.toString(),\n        height: height.toString(),\n      });\n    } else {\n      svg = canvas.toSVG();\n    }\n\n    // Restore background\n    canvas.backgroundColor = originalBg;\n    canvas.requestRenderAll();\n\n    const blob = new Blob([svg], { type: 'image/svg+xml' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = 'design.svg';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  return (\n    <Space direction=\"vertical\" size=\"small\">\n      <Tooltip title=\"Select (V)\">\n        <Button\n          type={activeTool === 'select' ? 'primary' : 'default'}\n          icon={<DragOutlined />}\n          onClick={() => setActiveTool('select')}\n        />\n      </Tooltip>\n\n      <Tooltip title=\"Pan (H / Space)\">\n        <Button\n          type={activeTool === 'pan' ? 'primary' : 'default'}\n          icon={<DragOutlined />}\n          onClick={() => setActiveTool('pan')}\n        />\n      </Tooltip>\n\n      <Divider style={{ margin: '4px 0' }} />\n\n      <Tooltip title=\"Rectangle (R)\">\n        <Button icon={<BorderOutlined />} onClick={addRectangle} />\n      </Tooltip>\n\n      <Tooltip title=\"Circle (C)\">\n        <Button icon={<StopOutlined rotate={45} />} onClick={addCircle} />\n      </Tooltip>\n\n      <Tooltip title=\"Text (T)\">\n        <Button icon={<FontSizeOutlined />} onClick={addText} />\n      </Tooltip>\n\n      <Tooltip title=\"Pen (P)\">\n        <Button\n          type={activeTool === 'pen' ? 'primary' : 'default'}\n          icon={<EditOutlined />}\n          onClick={() => setActiveTool('pen')}\n        />\n      </Tooltip>\n\n      <Divider style={{ margin: '4px 0' }} />\n\n      <Tooltip title=\"Undo (Ctrl+Z)\">\n        <Button icon={<UndoOutlined />} onClick={history.undo} disabled={!history.canUndo} />\n      </Tooltip>\n\n      <Tooltip title=\"Redo (Ctrl+Shift+Z)\">\n        <Button icon={<RedoOutlined />} onClick={history.redo} disabled={!history.canRedo} />\n      </Tooltip>\n\n      <Divider style={{ margin: '4px 0' }} />\n\n      <Tooltip title=\"Clear Canvas\">\n        <Button icon={<DeleteOutlined />} danger onClick={clearCanvas} />\n      </Tooltip>\n\n      <Tooltip title=\"Export SVG\">\n        <Button icon={<DownloadOutlined />} onClick={exportSVG} />\n      </Tooltip>\n\n      <Tooltip title=\"Settings\">\n        <Button icon={<SettingOutlined />} onClick={() => setSettingsOpen(true)} />\n      </Tooltip>\n\n      <SettingsModal open={settingsOpen} onClose={() => setSettingsOpen(false)} />\n    </Space>\n  );\n};\n\nexport default Toolbar;\n","import { useEffect } from 'react';\n\ninterface ShortcutMap {\n  [key: string]: (e: KeyboardEvent) => void;\n}\n\nexport const useShortcuts = (shortcuts: ShortcutMap) => {\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Ignore if typing in an input or textarea\n      if (\n        document.activeElement instanceof HTMLInputElement ||\n        document.activeElement instanceof HTMLTextAreaElement\n      ) {\n        return;\n      }\n\n      const key = e.key.toLowerCase();\n      const ctrl = e.ctrlKey || e.metaKey;\n      const shift = e.shiftKey;\n\n      // Construct key string like 'ctrl+z', 'ctrl+shift+z', 'v', 'delete'\n      let keyString = '';\n      if (ctrl) keyString += 'ctrl+';\n      if (shift) keyString += 'shift+';\n      keyString += key;\n\n      console.log('Key pressed:', { key, ctrl, shift, keyString });\n\n      if (shortcuts[keyString]) {\n        e.preventDefault();\n        shortcuts[keyString](e);\n      } else if (shortcuts[key]) {\n        // Fallback for single keys without modifiers if not explicitly defined with modifiers\n        // But be careful not to trigger 'v' when 'ctrl+v' is pressed if 'ctrl+v' is not defined but 'v' is.\n        // The logic above handles exact matches first.\n        if (!ctrl && !shift) {\n          e.preventDefault();\n          shortcuts[key](e);\n        }\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [shortcuts]);\n};\n","import { useState, useRef, useCallback } from 'react'; // Import React hooks for state and refs\nimport { Canvas, Path, Circle, Line, Object as FabricObject } from 'fabric'; // Import Fabric.js classes\n\ninterface Point {\n  x: number; // X coordinate\n  y: number; // Y coordinate\n  cp1?: { x: number; y: number }; // Incoming control point (Bezier handle)\n  cp2?: { x: number; y: number }; // Outgoing control point (Bezier handle)\n}\n\n// Extend Fabric Object type to include isTemp\ndeclare module 'fabric' {\n  interface Object {\n    isTemp?: boolean; // Flag to identify temporary objects (markers, helpers)\n  }\n}\n\nexport const usePenTool = (canvas: Canvas | null, saveHistory?: () => void) => {\n  const [isDrawing, setIsDrawing] = useState(false); // State to track if drawing is active\n  const activePath = useRef<Path | null>(null); // Ref to store the current path being drawn\n  const points = useRef<Point[]>([]); // Ref to store points of the path\n  const markers = useRef<Circle[]>([]); // Ref to store visual markers (circles) at points\n  const isDragging = useRef(false); // Ref to track if mouse is being dragged (for curves)\n  const dragStartPoint = useRef<{ x: number; y: number } | null>(null); // Ref to store start point of drag\n  const rubberBand = useRef<Path | null>(null); // Ref for the preview line (rubber band)\n  const handleLines = useRef<Line[]>([]); // Ref for visual lines connecting control points\n\n  const generatePathString = (pts: Point[], closed: boolean = false) => {\n    if (pts.length === 0) return ''; // Return empty if no points\n\n    let d = `M ${pts[0].x} ${pts[0].y}`; // Start path command (Move to)\n\n    for (let i = 1; i < pts.length; i++) {\n      const curr = pts[i]; // Current point\n      const prev = pts[i - 1]; // Previous point\n\n      if (prev.cp2 || curr.cp1) {\n        // If control points exist, draw Bezier curve\n        const cp1x = prev.cp2 ? prev.cp2.x : prev.x; // Control point 1 X\n        const cp1y = prev.cp2 ? prev.cp2.y : prev.y; // Control point 1 Y\n        const cp2x = curr.cp1 ? curr.cp1.x : curr.x; // Control point 2 X\n        const cp2y = curr.cp1 ? curr.cp1.y : curr.y; // Control point 2 Y\n\n        d += ` C ${cp1x} ${cp1y} ${cp2x} ${cp2y} ${curr.x} ${curr.y}`; // Cubic Bezier command\n      } else {\n        d += ` L ${curr.x} ${curr.y}`; // Line command\n      }\n    }\n\n    if (closed) {\n      d += ' Z'; // Close path command\n    }\n\n    return d; // Return SVG path data string\n  };\n\n  const updatePath = useCallback(() => {\n    if (!canvas || points.current.length === 0) return; // Exit if no canvas or points\n\n    const d = generatePathString(points.current); // Generate path string\n\n    if (activePath.current) {\n      canvas.remove(activePath.current); // Remove old path instance\n    }\n\n    const newPath = new Path(d, {\n      fill: '', // No fill\n      stroke: 'black', // Black stroke\n      strokeWidth: 2, // Stroke width\n      selectable: false, // Not selectable while drawing\n      evented: false, // No events\n      objectCaching: false, // Disable caching for performance during draw\n    });\n    newPath.isTemp = true; // Mark as temporary\n\n    canvas.add(newPath); // Add to canvas\n    canvas.sendObjectToBack(newPath); // Send to back so markers are on top\n    activePath.current = newPath; // Update ref\n    canvas.requestRenderAll(); // Render canvas\n  }, [canvas]);\n\n  const addMarker = useCallback(\n    (x: number, y: number, isStart: boolean = false) => {\n      if (!canvas) return; // Exit if no canvas\n\n      const marker = new Circle({\n        left: x, // X position\n        top: y, // Y position\n        radius: 4, // Radius\n        fill: isStart ? '#00ff00' : '#ffffff', // Green for start, white for others\n        stroke: '#333', // Dark stroke\n        strokeWidth: 1, // Stroke width\n        originX: 'center', // Center origin\n        originY: 'center', // Center origin\n        selectable: false, // Not selectable\n        evented: true, // Enable events (for clicking start point to close)\n        hasControls: false, // No controls\n        hasBorders: false, // No borders\n      });\n      marker.isTemp = true; // Mark as temporary\n\n      canvas.add(marker); // Add to canvas\n      markers.current.push(marker); // Add to markers array\n      canvas.requestRenderAll(); // Render canvas\n      return marker; // Return marker instance\n    },\n    [canvas],\n  );\n\n  const finishPath = useCallback(\n    (closed: boolean = false) => {\n      if (!canvas || !activePath.current) return; // Exit if no active path\n\n      const d = generatePathString(points.current, closed); // Generate final path string\n\n      if (activePath.current) canvas.remove(activePath.current); // Remove temporary path\n      markers.current.forEach((m) => canvas.remove(m)); // Remove all markers\n      markers.current = []; // Clear markers array\n\n      if (rubberBand.current) {\n        canvas.remove(rubberBand.current); // Remove rubber band\n        rubberBand.current = null; // Clear ref\n      }\n\n      handleLines.current.forEach((l) => canvas.remove(l)); // Remove handle lines\n      handleLines.current = []; // Clear handle lines array\n\n      const finalPath = new Path(d, {\n        fill: closed ? '#cccccc' : '', // Fill if closed\n        stroke: 'black', // Stroke color\n        strokeWidth: 2, // Stroke width\n        selectable: true, // Make selectable\n        evented: true, // Enable events\n        objectCaching: true, // Enable caching\n      });\n\n      canvas.add(finalPath); // Add final path to canvas\n      canvas.setActiveObject(finalPath); // Select the new path\n\n      setIsDrawing(false); // Stop drawing mode\n      activePath.current = null; // Clear active path ref\n      points.current = []; // Clear points\n      isDragging.current = false; // Reset dragging state\n      dragStartPoint.current = null; // Reset drag start point\n\n      if (saveHistory) saveHistory(); // Save to history\n      canvas.requestRenderAll(); // Render canvas\n    },\n    [canvas, saveHistory],\n  );\n\n  const onMouseDown = useCallback(\n    (e: any) => {\n      if (!canvas) return; // Exit if no canvas\n      const pointer = canvas.getPointer(e.e); // Get mouse pointer coordinates\n\n      if (isDrawing && markers.current.length > 0) {\n        const startMarker = markers.current[0]; // Get start marker\n        if (e.target === startMarker) {\n          finishPath(true); // Close path if start marker clicked\n          return;\n        }\n        if (markers.current.includes(e.target)) {\n          return; // Ignore clicks on other markers\n        }\n      }\n\n      if (!isDrawing) {\n        setIsDrawing(true); // Start drawing\n        points.current = [{ x: pointer.x, y: pointer.y }]; // Initialize points\n        addMarker(pointer.x, pointer.y, true); // Add start marker\n        updatePath(); // Draw initial path\n      } else {\n        points.current.push({ x: pointer.x, y: pointer.y }); // Add new point\n        addMarker(pointer.x, pointer.y); // Add marker\n        updatePath(); // Update path\n      }\n\n      isDragging.current = true; // Start dragging (potential curve)\n      dragStartPoint.current = { x: pointer.x, y: pointer.y }; // Record drag start\n    },\n    [canvas, isDrawing, updatePath, addMarker, finishPath],\n  );\n\n  const onMouseMove = useCallback(\n    (e: any) => {\n      if (!canvas || !isDrawing) return; // Exit if not drawing\n\n      const pointer = canvas.getPointer(e.e); // Get pointer coordinates\n\n      if (isDragging.current && points.current.length > 0) {\n        // Dragging to create handles (Bezier curves)\n        const currentPointIndex = points.current.length - 1; // Get last point index\n        const currentPoint = points.current[currentPointIndex]; // Get last point\n\n        const dx = pointer.x - currentPoint.x; // Calculate delta X\n        const dy = pointer.y - currentPoint.y; // Calculate delta Y\n\n        currentPoint.cp2 = { x: currentPoint.x + dx, y: currentPoint.y + dy }; // Set outgoing control point\n        currentPoint.cp1 = { x: currentPoint.x - dx, y: currentPoint.y - dy }; // Set incoming control point (mirrored)\n\n        updatePath(); // Update path with curves\n\n        // Visualize handles\n        handleLines.current.forEach((l) => canvas.remove(l)); // Remove old handle lines\n        handleLines.current = []; // Clear array\n\n        if (currentPoint.cp1) {\n          const l1 = new Line(\n            [currentPoint.x, currentPoint.y, currentPoint.cp1.x, currentPoint.cp1.y],\n            {\n              stroke: '#666', // Gray color\n              strokeWidth: 1, // Thin line\n              selectable: false, // Not selectable\n              evented: false, // No events\n            },\n          );\n          l1.isTemp = true; // Mark as temp\n          canvas.add(l1); // Add to canvas\n          handleLines.current.push(l1); // Store ref\n        }\n        if (currentPoint.cp2) {\n          const l2 = new Line(\n            [currentPoint.x, currentPoint.y, currentPoint.cp2.x, currentPoint.cp2.y],\n            {\n              stroke: '#666', // Gray color\n              strokeWidth: 1, // Thin line\n              selectable: false, // Not selectable\n              evented: false, // No events\n            },\n          );\n          l2.isTemp = true; // Mark as temp\n          canvas.add(l2); // Add to canvas\n          handleLines.current.push(l2); // Store ref\n        }\n\n        // Hide rubber band while dragging handles\n        if (rubberBand.current) {\n          canvas.remove(rubberBand.current);\n          rubberBand.current = null;\n        }\n      } else if (points.current.length > 0) {\n        // Rubber band preview (line to mouse cursor)\n        const lastPoint = points.current[points.current.length - 1]; // Last placed point\n        let d = `M ${lastPoint.x} ${lastPoint.y}`; // Start from last point\n\n        if (lastPoint.cp2) {\n          // Curve to mouse if last point has control point\n          d += ` C ${lastPoint.cp2.x} ${lastPoint.cp2.y} ${pointer.x} ${pointer.y} ${pointer.x} ${pointer.y}`;\n        } else {\n          // Line to mouse otherwise\n          d += ` L ${pointer.x} ${pointer.y}`;\n        }\n\n        if (rubberBand.current) {\n          canvas.remove(rubberBand.current); // Remove old rubber band\n        }\n\n        const rb = new Path(d, {\n          fill: '', // No fill\n          stroke: '#999', // Light gray\n          strokeWidth: 1, // Thin line\n          strokeDashArray: [5, 5], // Dashed line\n          selectable: false, // Not selectable\n          evented: false, // No events\n        });\n        rb.isTemp = true; // Mark as temp\n        canvas.add(rb); // Add to canvas\n        rubberBand.current = rb; // Store ref\n        canvas.requestRenderAll(); // Render canvas\n      }\n    },\n    [canvas, isDrawing, updatePath],\n  );\n\n  const onMouseUp = useCallback(\n    (e: any) => {\n      isDragging.current = false; // Stop dragging\n      dragStartPoint.current = null; // Clear drag start\n      // Clear handle lines on mouse up\n      if (canvas) {\n        handleLines.current.forEach((l) => canvas.remove(l)); // Remove handle lines\n        handleLines.current = []; // Clear array\n        canvas.requestRenderAll(); // Render canvas\n      }\n    },\n    [canvas],\n  );\n\n  const onDoubleClick = useCallback(\n    (e: any) => {\n      finishPath(false); // Finish path (open) on double click\n    },\n    [finishPath],\n  );\n\n  return {\n    isDrawing, // Export drawing state\n    onMouseDown, // Export mouse down handler\n    onMouseMove, // Export mouse move handler\n    onMouseUp, // Export mouse up handler\n    onDoubleClick, // Export double click handler\n    finishPath, // Export finish path function\n  };\n};\n","import { Point, FabricObject } from 'fabric';\n\nexport interface AnchorPoint {\n  x: number;\n  y: number;\n  type: 'corner' | 'smooth' | 'symmetric';\n  cp1?: { x: number; y: number }; // control point before\n  cp2?: { x: number; y: number }; // control point after\n  handlesBroken?: boolean; // true if cp1/cp2 are independent\n}\n\n/**\n * Convert Fabric path commands to anchor points with Bezier handles\n */\nexport function pathToAnchors(pathData: any[]): AnchorPoint[] {\n  if (!pathData || pathData.length === 0) return [];\n\n  const anchors: AnchorPoint[] = [];\n  let currentPoint = { x: 0, y: 0 };\n\n  pathData.forEach((cmd) => {\n    const type = cmd[0];\n\n    switch (type) {\n      case 'M': // Move to\n        currentPoint = { x: cmd[1], y: cmd[2] };\n        anchors.push({ x: cmd[1], y: cmd[2], type: 'corner' });\n        break;\n\n      case 'L': // Line to\n        anchors.push({ x: cmd[1], y: cmd[2], type: 'corner' });\n        currentPoint = { x: cmd[1], y: cmd[2] };\n        break;\n\n      case 'C': // Cubic Bezier\n        const lastAnchor = anchors[anchors.length - 1];\n        if (lastAnchor) {\n          lastAnchor.cp2 = { x: cmd[1], y: cmd[2] };\n          lastAnchor.type = 'smooth';\n        }\n        anchors.push({\n          x: cmd[5],\n          y: cmd[6],\n          type: 'smooth',\n          cp1: { x: cmd[3], y: cmd[4] },\n        });\n        currentPoint = { x: cmd[5], y: cmd[6] };\n        break;\n\n      case 'Q': // Quadratic Bezier - convert to cubic\n        const cp1 = {\n          x: currentPoint.x + (2 / 3) * (cmd[1] - currentPoint.x),\n          y: currentPoint.y + (2 / 3) * (cmd[2] - currentPoint.y),\n        };\n        const cp2 = {\n          x: cmd[3] + (2 / 3) * (cmd[1] - cmd[3]),\n          y: cmd[4] + (2 / 3) * (cmd[2] - cmd[4]),\n        };\n        const lastAnchor2 = anchors[anchors.length - 1];\n        if (lastAnchor2) {\n          lastAnchor2.cp2 = cp1;\n          lastAnchor2.type = 'smooth';\n        }\n        anchors.push({\n          x: cmd[3],\n          y: cmd[4],\n          type: 'smooth',\n          cp1: cp2,\n        });\n        currentPoint = { x: cmd[3], y: cmd[4] };\n        break;\n\n      case 'Z': // Close path\n        break;\n    }\n  });\n\n  return anchors;\n}\n\n/**\n * Convert anchor points to Fabric path commands\n */\nexport function anchorsToPath(anchors: AnchorPoint[]): any[] {\n  if (anchors.length === 0) return [];\n\n  const path: any[] = [];\n\n  // Move to first point\n  path.push(['M', anchors[0].x, anchors[0].y]);\n\n  for (let i = 1; i < anchors.length; i++) {\n    const prev = anchors[i - 1];\n    const curr = anchors[i];\n\n    if (prev.cp2 || curr.cp1) {\n      // Cubic Bezier curve\n      const cp1 = prev.cp2 || { x: prev.x, y: prev.y };\n      const cp2 = curr.cp1 || { x: curr.x, y: curr.y };\n      path.push(['C', cp1.x, cp1.y, cp2.x, cp2.y, curr.x, curr.y]);\n    } else {\n      // Straight line\n      path.push(['L', curr.x, curr.y]);\n    }\n  }\n\n  return path;\n}\n\n/**\n * Update Fabric object from anchors\n */\nexport function updateObjectFromAnchors(object: any, anchors: AnchorPoint[]): void {\n  console.log(\n    'updateObjectFromAnchors called with',\n    anchors.length,\n    'anchors for object type:',\n    object.type,\n  );\n  // Store anchors in object metadata\n  object.set('pointMeta', anchors);\n\n  if (object.type === 'path') {\n    const path = anchorsToPath(anchors);\n    object.set('path', path);\n    object.setCoords();\n  } else if (object.type === 'polyline' || object.type === 'polygon') {\n    object.set(\n      'points',\n      anchors.map((a) => ({ x: a.x, y: a.y })),\n    );\n    object.setCoords();\n  }\n}\n\n/**\n * Find closest segment for point insertion\n */\nexport function findInsertionIndex(\n  anchors: AnchorPoint[],\n  point: { x: number; y: number },\n): number {\n  if (anchors.length < 2) return anchors.length;\n\n  let minDist = Infinity;\n  let bestIndex = 1;\n\n  for (let i = 0; i < anchors.length - 1; i++) {\n    const dist = distanceToSegment(point, anchors[i], anchors[i + 1]);\n    if (dist < minDist) {\n      minDist = dist;\n      bestIndex = i + 1;\n    }\n  }\n\n  return bestIndex;\n}\n\n/**\n * Calculate distance from point to line segment\n */\nfunction distanceToSegment(\n  point: { x: number; y: number },\n  start: { x: number; y: number },\n  end: { x: number; y: number },\n): number {\n  const dx = end.x - start.x;\n  const dy = end.y - start.y;\n  const len2 = dx * dx + dy * dy;\n\n  if (len2 === 0) {\n    return Math.hypot(point.x - start.x, point.y - start.y);\n  }\n\n  let t = ((point.x - start.x) * dx + (point.y - start.y) * dy) / len2;\n  t = Math.max(0, Math.min(1, t));\n\n  const projX = start.x + t * dx;\n  const projY = start.y + t * dy;\n\n  return Math.hypot(point.x - projX, point.y - projY);\n}\n\n/**\n * Create bounding anchors for basic shapes (Rect, Circle, etc.)\n */\nexport function createBoundingAnchors(object: FabricObject): AnchorPoint[] {\n  const type = object.type;\n\n  if (type === 'rect') {\n    const rect = object as any;\n    const w = rect.width || 0;\n    const h = rect.height || 0;\n    return [\n      { x: 0, y: 0, type: 'corner' },\n      { x: w, y: 0, type: 'corner' },\n      { x: w, y: h, type: 'corner' },\n      { x: 0, y: h, type: 'corner' },\n    ];\n  }\n\n  if (type === 'circle' || type === 'ellipse') {\n    const circle = object as any;\n    const r = circle.radius || 0;\n    const cx = r;\n    const cy = r;\n    // Create 4 control points with bezier handles for smooth circle\n    const kappa = 0.5522847498; // Magic number for circle approximation\n    return [\n      {\n        x: cx,\n        y: 0,\n        type: 'smooth',\n        cp1: { x: cx + r * kappa, y: 0 },\n        cp2: { x: cx + r * kappa, y: 0 },\n      },\n      {\n        x: cx + r,\n        y: cy,\n        type: 'smooth',\n        cp1: { x: cx + r, y: cy - r * kappa },\n        cp2: { x: cx + r, y: cy + r * kappa },\n      },\n      {\n        x: cx,\n        y: cy + r,\n        type: 'smooth',\n        cp1: { x: cx + r * kappa, y: cy + r },\n        cp2: { x: cx - r * kappa, y: cy + r },\n      },\n      {\n        x: 0,\n        y: cy,\n        type: 'smooth',\n        cp1: { x: 0, y: cy + r * kappa },\n        cp2: { x: 0, y: cy - r * kappa },\n      },\n    ];\n  }\n\n  // Default: return empty\n  return [];\n}\n\n/**\n * Transform point using matrix (for coordinate conversion)\n */\nexport function transformPoint(\n  point: { x: number; y: number },\n  matrix: number[],\n): { x: number; y: number } {\n  return {\n    x: matrix[0] * point.x + matrix[2] * point.y + matrix[4],\n    y: matrix[1] * point.x + matrix[3] * point.y + matrix[5],\n  };\n}\n\n/**\n * Calculate symmetric control point\n */\nexport function calculateSymmetricCP(\n  anchor: { x: number; y: number },\n  cp: { x: number; y: number },\n): { x: number; y: number } {\n  return {\n    x: 2 * anchor.x - cp.x,\n    y: 2 * anchor.y - cp.y,\n  };\n}\n","import React, { useEffect, useRef } from 'react';\nimport { Canvas, TEvent, Rect, Circle, IText, Point } from 'fabric';\nimport { useVectorEditor } from '../context';\nimport { useShortcuts } from '../hooks/useShortcuts';\nimport { usePenTool } from '../hooks/usePenTool';\nimport { usePointEditor } from '../hooks/usePointEditor';\n\nconst CanvasArea: React.FC = () => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const {\n    setCanvas,\n    setSelectedObject,\n    activeTool,\n    setActiveTool,\n    history,\n    canvas,\n    setPointEditor,\n  } = useVectorEditor();\n\n  const penTool = usePenTool(canvas, history.saveState);\n\n  const pointEditor = usePointEditor(canvas, history, {\n    onChange: (event) => {\n      console.log('Point edit:', event);\n    },\n    onCommit: (object) => {\n      console.log('Committed changes to:', object);\n    },\n  });\n\n  // Expose point editor to context\n  useEffect(() => {\n    if (canvas) {\n      setPointEditor(pointEditor);\n    }\n  }, [canvas, pointEditor, setPointEditor]);\n\n  // Initialize Canvas\n  useEffect(() => {\n    if (!canvasRef.current || !containerRef.current) return;\n\n    const fabricCanvas = new Canvas(canvasRef.current, {\n      width: containerRef.current.clientWidth,\n      height: containerRef.current.clientHeight,\n      backgroundColor: '#ffffff',\n      selection: true,\n    });\n\n    setCanvas(fabricCanvas);\n\n    // Event listeners\n    const updateSelection = () => {\n      const activeObjects = fabricCanvas.getActiveObjects();\n      if (activeObjects.length === 1) {\n        setSelectedObject(activeObjects[0]);\n      } else {\n        setSelectedObject(null);\n      }\n    };\n\n    fabricCanvas.on('selection:created', updateSelection);\n    fabricCanvas.on('selection:updated', updateSelection);\n    fabricCanvas.on('selection:cleared', () => setSelectedObject(null));\n\n    // Save state on modification\n    const saveHistory = (e: any) => {\n      // specific check for temp objects from pen tool\n      if (e.target && e.target.isTemp) return;\n      history.saveState();\n    };\n\n    fabricCanvas.on('object:modified', saveHistory);\n    fabricCanvas.on('object:added', saveHistory);\n    fabricCanvas.on('object:removed', saveHistory);\n\n    // Zoom\n    fabricCanvas.on('mouse:wheel', (opt) => {\n      const delta = opt.e.deltaY;\n      let zoom = fabricCanvas.getZoom();\n      zoom *= 0.999 ** delta;\n      if (zoom > 20) zoom = 20;\n      if (zoom < 0.01) zoom = 0.01;\n      fabricCanvas.zoomToPoint(new Point(opt.e.offsetX, opt.e.offsetY), zoom);\n      opt.e.preventDefault();\n      opt.e.stopPropagation();\n    });\n\n    const handleResize = () => {\n      if (containerRef.current) {\n        fabricCanvas.setDimensions({\n          width: containerRef.current.clientWidth,\n          height: containerRef.current.clientHeight,\n        });\n      }\n    };\n\n    window.addEventListener('resize', handleResize);\n\n    return () => {\n      fabricCanvas.dispose();\n      window.removeEventListener('resize', handleResize);\n    };\n  }, []);\n\n  // Handle Tool Changes\n  useEffect(() => {\n    if (!canvas) return;\n\n    console.log('Active tool changed to:', activeTool);\n\n    canvas.isDrawingMode = false;\n\n    if (activeTool === 'pan') {\n      canvas.defaultCursor = 'grab';\n      canvas.selection = false;\n      canvas.forEachObject((obj) => {\n        obj.selectable = false;\n        obj.evented = false;\n      });\n    } else if (activeTool === 'pen') {\n      canvas.defaultCursor = 'crosshair';\n      canvas.selection = false;\n      canvas.forEachObject((obj) => {\n        obj.selectable = false;\n        obj.evented = false;\n      });\n    } else {\n      canvas.defaultCursor = 'default';\n      canvas.selection = true;\n      canvas.forEachObject((obj) => {\n        obj.selectable = true;\n        obj.evented = true;\n      });\n    }\n\n    canvas.requestRenderAll();\n  }, [activeTool, canvas]);\n\n  // Bind Pen Events\n  useEffect(() => {\n    if (!canvas || activeTool !== 'pen') return;\n\n    const onMouseDown = (opt: any) => penTool.onMouseDown(opt);\n    const onMouseMove = (opt: any) => penTool.onMouseMove(opt);\n    const onMouseUp = (opt: any) => penTool.onMouseUp(opt);\n    const onDoubleClick = (opt: any) => penTool.onDoubleClick(opt);\n\n    canvas.on('mouse:down', onMouseDown);\n    canvas.on('mouse:move', onMouseMove);\n    canvas.on('mouse:up', onMouseUp);\n    canvas.on('mouse:dblclick', onDoubleClick);\n\n    return () => {\n      canvas.off('mouse:down', onMouseDown);\n      canvas.off('mouse:move', onMouseMove);\n      canvas.off('mouse:up', onMouseUp);\n      canvas.off('mouse:dblclick', onDoubleClick);\n    };\n  }, [canvas, activeTool, penTool]);\n\n  // Shortcuts\n  useShortcuts({\n    v: () => {\n      console.log('V key pressed - switching to select tool');\n      // Selection Tool - exit point edit mode if active\n      if (pointEditor.isEditing) {\n        pointEditor.exit(true);\n      }\n      setActiveTool('select');\n    },\n    h: () => {\n      console.log('H key pressed - switching to pan tool');\n      setActiveTool('pan');\n    },\n    ' ': () => {\n      console.log('Space key pressed - switching to pan tool');\n      setActiveTool('pan');\n    }, // Space for pan\n    a: () => {\n      console.log('A key pressed - attempting to enter point edit mode');\n      // Direct Selection Tool - enter point edit mode\n      const activeObj = canvas?.getActiveObject();\n      console.log('Active object:', activeObj);\n      console.log('Point editor is editing:', pointEditor.isEditing);\n      console.log('Canvas exists:', !!canvas);\n\n      if (!canvas) {\n        console.log('No canvas available');\n        return;\n      }\n\n      if (!activeObj) {\n        console.log('No object selected - cannot enter point edit mode');\n        return;\n      }\n\n      if (pointEditor.isEditing) {\n        console.log('Already in point edit mode');\n        return;\n      }\n\n      console.log('Entering point edit mode for object:', activeObj.type);\n      pointEditor.enter(activeObj);\n    },\n    r: () => {\n      if (!canvas) return;\n      const rect = new Rect({\n        left: 100,\n        top: 100,\n        fill: '#ff0000',\n        width: 100,\n        height: 100,\n      });\n      canvas.add(rect);\n      canvas.setActiveObject(rect);\n      setActiveTool('select');\n    },\n    c: () => {\n      if (!canvas) return;\n      const circle = new Circle({\n        left: 100,\n        top: 100,\n        fill: '#00ff00',\n        radius: 50,\n      });\n      canvas.add(circle);\n      canvas.setActiveObject(circle);\n      setActiveTool('select');\n    },\n    t: () => {\n      if (!canvas) return;\n      const text = new IText('Type here', {\n        left: 100,\n        top: 100,\n        fontFamily: 'arial',\n        fill: '#333',\n        fontSize: 20,\n      });\n      canvas.add(text);\n      canvas.setActiveObject(text);\n      setActiveTool('select');\n    },\n    p: () => {\n      console.log('P key pressed - switching to pen tool');\n      setActiveTool('pen');\n    },\n    'shift+c': () => {\n      // Convert anchor type\n      if (pointEditor.isEditing && pointEditor.selectedAnchorIndex !== null) {\n        const current = pointEditor.getAnchors()[pointEditor.selectedAnchorIndex];\n        const newType = current.type === 'smooth' ? 'corner' : 'smooth';\n        pointEditor.convertPointType(pointEditor.selectedAnchorIndex, newType);\n      }\n    },\n    enter: () => {\n      // Commit point edit\n      if (pointEditor.isEditing) {\n        pointEditor.exit(true);\n      }\n    },\n    escape: () => {\n      // Cancel point edit\n      if (pointEditor.isEditing) {\n        pointEditor.exit(false);\n      }\n    },\n    delete: () => {\n      if (!canvas) return;\n\n      // If in point edit mode and anchor selected, delete the anchor\n      if (pointEditor.isEditing && pointEditor.selectedAnchorIndex !== null) {\n        pointEditor.removePoint(pointEditor.selectedAnchorIndex);\n        return;\n      }\n\n      // Otherwise delete selected objects\n      const activeObjects = canvas.getActiveObjects();\n      if (activeObjects.length) {\n        canvas.discardActiveObject();\n        activeObjects.forEach((obj) => {\n          canvas.remove(obj);\n        });\n        canvas.requestRenderAll();\n      }\n    },\n    backspace: () => {\n      if (!canvas) return;\n\n      // If in point edit mode and anchor selected, delete the anchor\n      if (pointEditor.isEditing && pointEditor.selectedAnchorIndex !== null) {\n        pointEditor.removePoint(pointEditor.selectedAnchorIndex);\n        return;\n      }\n\n      // Otherwise delete selected objects\n      const activeObjects = canvas.getActiveObjects();\n      if (activeObjects.length) {\n        canvas.discardActiveObject();\n        activeObjects.forEach((obj) => {\n          canvas.remove(obj);\n        });\n        canvas.requestRenderAll();\n      }\n    },\n    'ctrl+z': () => history.undo(),\n    'ctrl+shift+z': () => history.redo(),\n    'ctrl+=': () => {\n      // Zoom In\n      if (!canvas) return;\n      canvas.setZoom(canvas.getZoom() * 1.1);\n    },\n    'ctrl+-': () => {\n      // Zoom Out\n      if (!canvas) return;\n      canvas.setZoom(canvas.getZoom() * 0.9);\n    },\n    'ctrl+0': () => {\n      // Reset Zoom\n      if (!canvas) return;\n      canvas.setZoom(1);\n      canvas.setViewportTransform([1, 0, 0, 1, 0, 0]);\n    },\n  });\n\n  return (\n    <div ref={containerRef} style={{ width: '100%', height: '100%' }}>\n      <canvas ref={canvasRef} />\n    </div>\n  );\n};\n\nexport default CanvasArea;\n","import { useRef, useState, useCallback, useEffect } from 'react';\nimport { Canvas, Circle, Line, Point, util } from 'fabric';\nimport {\n  AnchorPoint,\n  pathToAnchors,\n  updateObjectFromAnchors,\n  findInsertionIndex,\n  createBoundingAnchors,\n  calculateSymmetricCP,\n} from '../utils/pathGeometry';\n\nexport interface UsePointEditorOptions {\n  handleRadius?: number;\n  anchorRadius?: number;\n  handleStyle?: {\n    fill?: string;\n    stroke?: string;\n    strokeWidth?: number;\n  };\n  lineStyle?: {\n    stroke?: string;\n    strokeWidth?: number;\n    strokeDashArray?: number[];\n  };\n  onChange?: (event: PointEditEvent) => void;\n  onCommit?: (object: any) => void;\n  onCancel?: () => void;\n}\n\nexport interface PointEditEvent {\n  type: 'anchor:move' | 'anchor:add' | 'anchor:remove' | 'handle:move' | 'type:change';\n  objectId?: string;\n  anchorIndex?: number;\n  before?: AnchorPoint;\n  after?: AnchorPoint;\n}\n\ndeclare module 'fabric' {\n  interface FabricObject {\n    isTemp?: boolean;\n    anchorIndex?: number;\n    handleType?: string;\n    pointMeta?: AnchorPoint[];\n  }\n}\n\nexport function usePointEditor(\n  canvas: Canvas | null,\n  history: { saveState: () => void; undo: () => void; redo: () => void },\n  options: UsePointEditorOptions = {},\n) {\n  const [isEditing, setIsEditing] = useState(false);\n  const [activeObject, setActiveObject] = useState<any>(null);\n  const [selectedAnchorIndex, setSelectedAnchorIndex] = useState<number | null>(null);\n  const [mode, setMode] = useState<'anchor' | 'handle' | 'add'>('anchor');\n\n  const handlesRef = useRef<Circle[]>([]);\n  const linesRef = useRef<Line[]>([]);\n  const anchorsRef = useRef<AnchorPoint[]>([]);\n  const snapshotRef = useRef<any>(null);\n  const isDraggingRef = useRef(false);\n\n  // Extract anchors from object\n  const extractAnchors = useCallback((object: any): AnchorPoint[] => {\n    // Check if object has pointMeta\n    if (object.pointMeta) {\n      return object.pointMeta;\n    }\n\n    // Convert from path\n    if (object.type === 'path') {\n      return pathToAnchors(object.path);\n    }\n\n    // Convert from polyline/polygon\n    if (object.type === 'polyline' || object.type === 'polygon') {\n      return object.points.map((p: any) => ({ x: p.x, y: p.y, type: 'corner' as const }));\n    }\n\n    // For other shapes, create anchors from bounding points\n    return createBoundingAnchors(object);\n  }, []);\n\n  // Clear all handles\n  const clearHandles = useCallback(() => {\n    if (!canvas) return;\n    [...handlesRef.current, ...linesRef.current].forEach((obj) => {\n      canvas.remove(obj);\n    });\n    handlesRef.current = [];\n    linesRef.current = [];\n  }, [canvas]);\n\n  // Create handle objects\n  const createHandles = useCallback(\n    (obj?: any) => {\n      const targetObject = obj || activeObject;\n      console.log('createHandles called', { canvas: !!canvas, targetObject: !!targetObject });\n      if (!canvas || !targetObject) return;\n\n      clearHandles();\n\n      const anchors = anchorsRef.current;\n      console.log('Creating handles for', anchors.length, 'anchors:', anchors);\n      const matrix = targetObject.calcTransformMatrix();\n      console.log('Transform matrix:', matrix);\n\n      anchors.forEach((anchor, index) => {\n        // Transform to canvas coordinates\n        const point = new Point(anchor.x, anchor.y).transform(matrix);\n        console.log(\n          `Anchor ${index}: local (${anchor.x}, ${anchor.y}) -> canvas (${point.x}, ${point.y})`,\n        );\n        const anchorHandle = new Circle({\n          left: point.x,\n          top: point.y,\n          radius: options.anchorRadius || 5,\n          fill: selectedAnchorIndex === index ? '#0066ff' : '#fff',\n          stroke: '#0066ff',\n          strokeWidth: 2,\n          originX: 'center',\n          originY: 'center',\n          selectable: true,\n          evented: true,\n          hasControls: false,\n          hasBorders: false,\n          isTemp: true,\n        });\n        (anchorHandle as any).anchorIndex = index;\n        (anchorHandle as any).handleType = 'anchor';\n\n        handlesRef.current.push(anchorHandle);\n        canvas.add(anchorHandle);\n\n        // Create control point handles if anchor has them\n        if (anchor.cp1) {\n          const cp1Point = new Point(anchor.cp1.x, anchor.cp1.y).transform(matrix);\n          const line1 = new Line([point.x, point.y, cp1Point.x, cp1Point.y], {\n            stroke: options.lineStyle?.stroke || '#0066ff',\n            strokeWidth: options.lineStyle?.strokeWidth || 1,\n            strokeDashArray: options.lineStyle?.strokeDashArray || [3, 3],\n            selectable: false,\n            evented: false,\n            isTemp: true,\n          });\n          linesRef.current.push(line1);\n          canvas.add(line1);\n\n          const cp1Handle = new Circle({\n            left: cp1Point.x,\n            top: cp1Point.y,\n            radius: options.handleRadius || 4,\n            fill: options.handleStyle?.fill || '#0066ff',\n            stroke: options.handleStyle?.stroke || '#fff',\n            strokeWidth: options.handleStyle?.strokeWidth || 1,\n            originX: 'center',\n            originY: 'center',\n            selectable: true,\n            evented: true,\n            hasControls: false,\n            hasBorders: false,\n            isTemp: true,\n          });\n          (cp1Handle as any).anchorIndex = index;\n          (cp1Handle as any).handleType = 'cp1';\n\n          handlesRef.current.push(cp1Handle);\n          canvas.add(cp1Handle);\n        }\n\n        if (anchor.cp2) {\n          const cp2Point = new Point(anchor.cp2.x, anchor.cp2.y).transform(matrix);\n          const line2 = new Line([point.x, point.y, cp2Point.x, cp2Point.y], {\n            stroke: options.lineStyle?.stroke || '#0066ff',\n            strokeWidth: options.lineStyle?.strokeWidth || 1,\n            strokeDashArray: options.lineStyle?.strokeDashArray || [3, 3],\n            selectable: false,\n            evented: false,\n            isTemp: true,\n          });\n          linesRef.current.push(line2);\n          canvas.add(line2);\n\n          const cp2Handle = new Circle({\n            left: cp2Point.x,\n            top: cp2Point.y,\n            radius: options.handleRadius || 4,\n            fill: options.handleStyle?.fill || '#0066ff',\n            stroke: options.handleStyle?.stroke || '#fff',\n            strokeWidth: options.handleStyle?.strokeWidth || 1,\n            originX: 'center',\n            originY: 'center',\n            selectable: true,\n            evented: true,\n            hasControls: false,\n            hasBorders: false,\n            isTemp: true,\n          });\n          (cp2Handle as any).anchorIndex = index;\n          (cp2Handle as any).handleType = 'cp2';\n\n          handlesRef.current.push(cp2Handle);\n          canvas.add(cp2Handle);\n        }\n      });\n\n      console.log(\n        'Created',\n        handlesRef.current.length,\n        'handles and',\n        linesRef.current.length,\n        'lines',\n      );\n      canvas.requestRenderAll();\n    },\n    [canvas, activeObject, selectedAnchorIndex, options, clearHandles],\n  );\n\n  // Enter point edit mode\n  const enter = useCallback(\n    (object: any, opts: { mode?: 'anchor' | 'handle' } = {}) => {\n      console.log('Point editor enter called', {\n        canvas: !!canvas,\n        object: !!object,\n        type: object?.type,\n      });\n      if (!canvas || !object) return;\n\n      // Take snapshot for cancel\n      snapshotRef.current = object.toObject(['pointMeta']);\n\n      // Extract anchors\n      const anchors = extractAnchors(object);\n      console.log('Extracted anchors:', anchors);\n      console.log('Object details:', {\n        type: object.type,\n        left: object.left,\n        top: object.top,\n        width: object.width,\n        height: object.height,\n        scaleX: object.scaleX,\n        scaleY: object.scaleY,\n        angle: object.angle,\n      });\n      anchorsRef.current = anchors;\n\n      // Set state\n      setActiveObject(object);\n      setIsEditing(true);\n      setMode(opts.mode || 'anchor');\n\n      // Hide object controls\n      object.set({\n        hasControls: false,\n        hasBorders: false,\n        selectable: false,\n        evented: false,\n      });\n\n      // Disable canvas selection\n      canvas.selection = false;\n\n      // Create handles\n      createHandles(object);\n\n      canvas.requestRenderAll();\n    },\n    [canvas, extractAnchors, createHandles],\n  );\n\n  // Exit point edit mode\n  const exit = useCallback(\n    (commit: boolean = true) => {\n      if (!activeObject || !canvas) return;\n\n      if (commit) {\n        // Update object with new anchors\n        updateObjectFromAnchors(activeObject, anchorsRef.current);\n\n        // Save to history\n        history.saveState();\n\n        // Trigger onChange\n        options.onCommit?.(activeObject);\n      } else {\n        // Restore from snapshot\n        activeObject.set(snapshotRef.current);\n        options.onCancel?.();\n      }\n\n      // Restore object controls\n      activeObject.set({\n        hasControls: true,\n        hasBorders: true,\n        selectable: true,\n        evented: true,\n      });\n\n      // Clear handles\n      clearHandles();\n\n      // Re-enable canvas selection\n      canvas.selection = true;\n\n      // Reset state\n      setActiveObject(null);\n      setIsEditing(false);\n      setSelectedAnchorIndex(null);\n      anchorsRef.current = [];\n      snapshotRef.current = null;\n\n      canvas.requestRenderAll();\n    },\n    [activeObject, canvas, history, clearHandles, options],\n  );\n\n  // Move point\n  const movePoint = useCallback(\n    (index: number, localPoint: { x: number; y: number }) => {\n      if (index < 0 || index >= anchorsRef.current.length || !activeObject) return;\n\n      anchorsRef.current[index] = {\n        ...anchorsRef.current[index],\n        x: localPoint.x,\n        y: localPoint.y,\n      };\n\n      updateObjectFromAnchors(activeObject, anchorsRef.current);\n      createHandles(activeObject);\n\n      options.onChange?.({\n        type: 'anchor:move',\n        objectId: activeObject.id,\n        anchorIndex: index,\n        after: anchorsRef.current[index],\n      });\n    },\n    [activeObject, createHandles, options],\n  );\n\n  // Move handle (control point)\n  const moveHandle = useCallback(\n    (\n      anchorIndex: number,\n      handleType: 'cp1' | 'cp2',\n      localPoint: { x: number; y: number },\n      breakSymmetry: boolean = false,\n    ) => {\n      if (anchorIndex < 0 || anchorIndex >= anchorsRef.current.length || !activeObject) return;\n\n      const anchor = anchorsRef.current[anchorIndex];\n\n      // Update the control point\n      if (handleType === 'cp1') {\n        anchor.cp1 = localPoint;\n      } else {\n        anchor.cp2 = localPoint;\n      }\n\n      // Handle symmetry for smooth points\n      if (anchor.type === 'smooth' && !breakSymmetry && !anchor.handlesBroken) {\n        const otherHandle = handleType === 'cp1' ? 'cp2' : 'cp1';\n        const symmetric = calculateSymmetricCP(anchor, localPoint);\n        (anchor as any)[otherHandle] = symmetric;\n      } else if (breakSymmetry) {\n        anchor.handlesBroken = true;\n      }\n\n      updateObjectFromAnchors(activeObject, anchorsRef.current);\n      createHandles(activeObject);\n\n      options.onChange?.({\n        type: 'handle:move',\n        objectId: activeObject.id,\n        anchorIndex,\n        after: anchor,\n      });\n    },\n    [activeObject, createHandles, options],\n  );\n\n  // Add point\n  const addPoint = useCallback(\n    (canvasPoint: { x: number; y: number }) => {\n      if (!activeObject || !canvas) return null;\n\n      // Convert to local coordinates\n      const matrix = activeObject.calcTransformMatrix();\n      const invMatrix = util.invertTransform(matrix);\n      const localPoint = new Point(canvasPoint.x, canvasPoint.y).transform(invMatrix);\n\n      // Find insertion position on path\n      const insertIndex = findInsertionIndex(anchorsRef.current, localPoint);\n\n      // Insert new anchor\n      const newAnchor: AnchorPoint = {\n        x: localPoint.x,\n        y: localPoint.y,\n        type: 'smooth',\n      };\n\n      anchorsRef.current.splice(insertIndex, 0, newAnchor);\n\n      updateObjectFromAnchors(activeObject, anchorsRef.current);\n      createHandles(activeObject);\n\n      options.onChange?.({\n        type: 'anchor:add',\n        objectId: activeObject.id,\n        anchorIndex: insertIndex,\n        after: newAnchor,\n      });\n\n      return { index: insertIndex };\n    },\n    [activeObject, canvas, createHandles, options],\n  );\n\n  // Remove point\n  const removePoint = useCallback(\n    (index: number) => {\n      if (index < 0 || index >= anchorsRef.current.length || !activeObject) return;\n      if (anchorsRef.current.length <= 2) return; // Keep minimum 2 points\n\n      const removed = anchorsRef.current[index];\n      anchorsRef.current.splice(index, 1);\n\n      updateObjectFromAnchors(activeObject, anchorsRef.current);\n      createHandles(activeObject);\n\n      if (selectedAnchorIndex === index) {\n        setSelectedAnchorIndex(null);\n      }\n\n      options.onChange?.({\n        type: 'anchor:remove',\n        objectId: activeObject.id,\n        anchorIndex: index,\n        before: removed,\n      });\n    },\n    [activeObject, selectedAnchorIndex, createHandles, options],\n  );\n\n  // Convert point type\n  const convertPointType = useCallback(\n    (index: number, type: 'corner' | 'smooth' | 'symmetric') => {\n      if (index < 0 || index >= anchorsRef.current.length || !activeObject) return;\n\n      const anchor = anchorsRef.current[index];\n      const before = { ...anchor };\n      anchor.type = type;\n\n      if (type === 'corner') {\n        // Remove control points for corner\n        delete anchor.cp1;\n        delete anchor.cp2;\n        anchor.handlesBroken = false;\n      } else if (type === 'smooth' && !anchor.cp1 && !anchor.cp2) {\n        // Add default control points for smooth\n        const offset = 20;\n        anchor.cp1 = { x: anchor.x - offset, y: anchor.y };\n        anchor.cp2 = { x: anchor.x + offset, y: anchor.y };\n        anchor.handlesBroken = false;\n      }\n\n      updateObjectFromAnchors(activeObject, anchorsRef.current);\n      createHandles(activeObject);\n\n      options.onChange?.({\n        type: 'type:change',\n        objectId: activeObject.id,\n        anchorIndex: index,\n        before,\n        after: anchor,\n      });\n    },\n    [activeObject, createHandles, options],\n  );\n\n  // Handle dragging\n  useEffect(() => {\n    if (!canvas || !isEditing) return;\n\n    let draggedHandle: any = null;\n\n    const onMouseDown = (e: any) => {\n      if (!e.target || !e.target.isTemp) return;\n\n      draggedHandle = e.target;\n      isDraggingRef.current = true;\n\n      const anchorIndex = draggedHandle.anchorIndex;\n      if (draggedHandle.handleType === 'anchor') {\n        setSelectedAnchorIndex(anchorIndex);\n      }\n    };\n\n    const onMouseMove = (e: any) => {\n      if (!isDraggingRef.current || !draggedHandle || !activeObject) return;\n\n      const pointer = canvas.getPointer(e.e);\n      draggedHandle.set({ left: pointer.x, top: pointer.y });\n\n      // Update anchor/handle in local coordinates\n      const matrix = activeObject.calcTransformMatrix();\n      const invMatrix = util.invertTransform(matrix);\n      const localPoint = new Point(pointer.x, pointer.y).transform(invMatrix);\n\n      const anchorIndex = draggedHandle.anchorIndex;\n      const handleType = draggedHandle.handleType;\n\n      if (handleType === 'anchor') {\n        movePoint(anchorIndex, localPoint);\n      } else if (handleType === 'cp1' || handleType === 'cp2') {\n        moveHandle(anchorIndex, handleType, localPoint, e.e.altKey);\n      }\n\n      canvas.requestRenderAll();\n    };\n\n    const onMouseUp = () => {\n      if (isDraggingRef.current) {\n        isDraggingRef.current = false;\n        draggedHandle = null;\n      }\n    };\n\n    canvas.on('mouse:down', onMouseDown);\n    canvas.on('mouse:move', onMouseMove);\n    canvas.on('mouse:up', onMouseUp);\n\n    return () => {\n      canvas.off('mouse:down', onMouseDown);\n      canvas.off('mouse:move', onMouseMove);\n      canvas.off('mouse:up', onMouseUp);\n    };\n  }, [canvas, isEditing, activeObject, movePoint, moveHandle]);\n\n  return {\n    isEditing,\n    activeObject,\n    selectedAnchorIndex,\n    mode,\n    enter,\n    exit,\n    addPoint,\n    removePoint,\n    movePoint,\n    selectPoint: setSelectedAnchorIndex,\n    convertPointType,\n    setMode,\n    getAnchors: () => anchorsRef.current,\n    dispose: clearHandles,\n  };\n}\n","import React, { useEffect, useState } from 'react';\nimport { Form, InputNumber, ColorPicker, Slider, Typography, Empty } from 'antd';\nimport { useVectorEditor } from '../context';\n\nconst { Title } = Typography;\n\nconst PropertiesPanel: React.FC = () => {\n  const { canvas, selectedObject } = useVectorEditor();\n  const [form] = Form.useForm();\n\n  // Local state to force re-render when object properties change externally (e.g. dragging)\n  const [, forceUpdate] = useState({});\n\n  useEffect(() => {\n    if (selectedObject) {\n      const updateForm = () => {\n        // Helper to safely get color string\n        const getColor = (val: any) => {\n          if (typeof val === 'string') return val;\n          if (val && typeof val === 'object' && 'colorStops' in val) return '#000000'; // Fallback for gradients\n          return val ? val.toString() : 'transparent';\n        };\n\n        form.setFieldsValue({\n          fill: getColor(selectedObject.fill),\n          stroke: getColor(selectedObject.stroke),\n          strokeWidth: selectedObject.strokeWidth,\n          opacity: selectedObject.opacity,\n          left: Math.round(selectedObject.left || 0),\n          top: Math.round(selectedObject.top || 0),\n          width: Math.round((selectedObject.width || 0) * (selectedObject.scaleX || 1)),\n          height: Math.round((selectedObject.height || 0) * (selectedObject.scaleY || 1)),\n          angle: Math.round(selectedObject.angle || 0),\n        });\n        forceUpdate({});\n      };\n\n      updateForm();\n\n      // Listen for object modification events on canvas to update form\n      if (canvas) {\n        const handleModified = () => updateForm();\n        canvas.on('object:modified', handleModified);\n        return () => {\n          canvas.off('object:modified', handleModified);\n        };\n      }\n    }\n  }, [selectedObject, canvas, form]);\n\n  if (!selectedObject) {\n    return <Empty description=\"No object selected\" image={Empty.PRESENTED_IMAGE_SIMPLE} />;\n  }\n\n  const handleValuesChange = (changedValues: any, allValues: any) => {\n    if (!selectedObject || !canvas) return;\n\n    if ('fill' in changedValues) {\n      // Antd ColorPicker returns an object, we need hex string or rgba\n      const color =\n        typeof changedValues.fill === 'string'\n          ? changedValues.fill\n          : changedValues.fill?.toHexString?.() || '#000000';\n      selectedObject.set('fill', color);\n    }\n    if ('stroke' in changedValues) {\n      const color =\n        typeof changedValues.stroke === 'string'\n          ? changedValues.stroke\n          : changedValues.stroke?.toHexString?.() || '#000000';\n      selectedObject.set('stroke', color);\n    }\n    if ('strokeWidth' in changedValues) {\n      selectedObject.set('strokeWidth', changedValues.strokeWidth);\n    }\n    if ('opacity' in changedValues) {\n      selectedObject.set('opacity', changedValues.opacity);\n    }\n    if ('left' in changedValues) {\n      selectedObject.set('left', changedValues.left);\n    }\n    if ('top' in changedValues) {\n      selectedObject.set('top', changedValues.top);\n    }\n    if ('angle' in changedValues) {\n      selectedObject.set('angle', changedValues.angle);\n    }\n\n    // Handling width/height changes usually requires adjusting scale for fabric objects\n    if ('width' in changedValues) {\n      const newWidth = changedValues.width;\n      if (selectedObject.width) {\n        selectedObject.scaleToWidth(newWidth);\n      }\n    }\n    if ('height' in changedValues) {\n      const newHeight = changedValues.height;\n      if (selectedObject.height) {\n        selectedObject.scaleToHeight(newHeight);\n      }\n    }\n\n    selectedObject.setCoords();\n    canvas.requestRenderAll();\n  };\n\n  return (\n    <div>\n      <Title level={5}>Properties</Title>\n      <Form form={form} layout=\"vertical\" onValuesChange={handleValuesChange} size=\"small\">\n        <Form.Item name=\"fill\" label=\"Fill Color\">\n          <ColorPicker showText />\n        </Form.Item>\n\n        <Form.Item name=\"stroke\" label=\"Stroke Color\">\n          <ColorPicker showText />\n        </Form.Item>\n\n        <Form.Item name=\"strokeWidth\" label=\"Stroke Width\">\n          <InputNumber min={0} />\n        </Form.Item>\n\n        <Form.Item name=\"opacity\" label=\"Opacity\">\n          <Slider min={0} max={1} step={0.1} />\n        </Form.Item>\n\n        <div style={{ display: 'flex', gap: 8 }}>\n          <Form.Item name=\"left\" label=\"X\">\n            <InputNumber />\n          </Form.Item>\n          <Form.Item name=\"top\" label=\"Y\">\n            <InputNumber />\n          </Form.Item>\n        </div>\n\n        <div style={{ display: 'flex', gap: 8 }}>\n          <Form.Item name=\"width\" label=\"Width\">\n            <InputNumber min={1} />\n          </Form.Item>\n          <Form.Item name=\"height\" label=\"Height\">\n            <InputNumber min={1} />\n          </Form.Item>\n        </div>\n\n        <Form.Item name=\"angle\" label=\"Rotation\">\n          <Slider min={0} max={360} />\n        </Form.Item>\n      </Form>\n    </div>\n  );\n};\n\nexport default PropertiesPanel;\n","import React, { useEffect, useState } from 'react'; // Import React hooks\nimport { List, Button, Typography, Space } from 'antd'; // Import Ant Design components\nimport {\n  EyeOutlined, // Icon for visible layer\n  EyeInvisibleOutlined, // Icon for hidden layer\n  LockOutlined, // Icon for locked layer\n  UnlockOutlined, // Icon for unlocked layer\n  DeleteOutlined, // Icon for delete action\n  HolderOutlined, // Icon for drag handle\n} from '@ant-design/icons'; // Import icons from Ant Design\nimport { useVectorEditor } from '../context'; // Import custom hook for editor context\nimport { FabricObject } from 'fabric'; // Import Fabric.js object type\nimport {\n  DndContext, // Context provider for drag and drop\n  closestCenter, // Collision detection algorithm\n  KeyboardSensor, // Sensor for keyboard interactions\n  PointerSensor, // Sensor for pointer (mouse/touch) interactions\n  useSensor, // Hook to use a specific sensor\n  useSensors, // Hook to combine multiple sensors\n  DragEndEvent, // Type for drag end event\n} from '@dnd-kit/core'; // Import core DnD Kit functionalities\nimport {\n  arrayMove, // Utility to move items in an array\n  SortableContext, // Context for sortable items\n  sortableKeyboardCoordinates, // Keyboard coordinates for sorting\n  verticalListSortingStrategy, // Sorting strategy for vertical lists\n  useSortable, // Hook to make an item sortable\n} from '@dnd-kit/sortable'; // Import sortable functionalities\nimport { CSS } from '@dnd-kit/utilities'; // Import CSS utilities for transforms\n\nconst { Title } = Typography; // Destructure Title from Typography\n\ninterface SortableItemProps {\n  id: string; // Unique identifier for the sortable item\n  children: React.ReactNode; // Content of the item\n  isSelected: boolean; // Whether the item is currently selected\n  onClick: () => void; // Click handler for the item\n}\n\nconst SortableItem: React.FC<SortableItemProps> = ({ id, children, isSelected, onClick }) => {\n  const { attributes, listeners, setNodeRef, setActivatorNodeRef, transform, transition } =\n    useSortable({ id }); // Initialize sortable hook\n\n  const style = {\n    transform: CSS.Transform.toString(transform), // Apply transform for dragging\n    transition, // Apply transition for smooth movement\n    backgroundColor: isSelected ? '#e6f7ff' : 'transparent', // Highlight if selected\n    marginBottom: 4, // Spacing between items\n    border: '1px solid #f0f0f0', // Border for the item\n    borderRadius: 4, // Rounded corners\n    padding: '4px 8px', // Padding inside the item\n    display: 'flex', // Flexbox layout\n    alignItems: 'center', // Center items vertically\n  };\n\n  return (\n    <div ref={setNodeRef} style={style}>\n      {' '}\n      {/* Main container for the sortable item */}\n      <div\n        ref={setActivatorNodeRef} // Set this element as the drag handle\n        {...attributes} // Spread accessibility attributes\n        {...listeners} // Spread event listeners\n        style={{\n          cursor: 'grab', // Cursor style for grabbing\n          marginRight: 8, // Spacing to the right\n          display: 'flex', // Flexbox layout\n          alignItems: 'center', // Center items vertically\n          color: '#999', // Color for the handle icon\n        }}\n      >\n        <HolderOutlined /> {/* Drag handle icon */}\n      </div>\n      <div onClick={onClick} style={{ flex: 1, cursor: 'pointer' }}>\n        {' '}\n        {/* Clickable area for selection */}\n        {children} {/* Render children content */}\n      </div>\n    </div>\n  );\n};\n\nconst LayersPanel: React.FC = () => {\n  const { canvas, selectedObject, setSelectedObject, history } = useVectorEditor(); // Access editor context\n  const [objects, setObjects] = useState<FabricObject[]>([]); // State to store canvas objects\n\n  const sensors = useSensors(\n    useSensor(PointerSensor), // Use pointer sensor for mouse/touch\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates, // Use keyboard coordinates for accessibility\n    }),\n  );\n\n  const updateObjects = () => {\n    if (!canvas) return; // Exit if canvas is not available\n    const objs = canvas.getObjects(); // Get all objects from canvas\n    objs.forEach((obj: any) => {\n      if (!obj.uid) obj.uid = Math.random().toString(36).substr(2, 9); // Assign unique ID if missing\n    });\n    // Reverse to show top layers first (Fabric stores bottom-up)\n    setObjects([...objs].reverse()); // Update state with reversed objects\n  };\n\n  useEffect(() => {\n    if (!canvas) return; // Exit if canvas is not available\n\n    let timeout: NodeJS.Timeout; // Variable for debounce timeout\n    const debouncedUpdate = () => {\n      clearTimeout(timeout); // Clear previous timeout\n      timeout = setTimeout(updateObjects, 100); // Set new timeout for update\n    };\n\n    canvas.on('object:added', debouncedUpdate); // Listen for object addition\n    canvas.on('object:removed', debouncedUpdate); // Listen for object removal\n    canvas.on('object:modified', debouncedUpdate); // Listen for object modification\n\n    updateObjects(); // Initial update\n\n    return () => {\n      canvas.off('object:added', debouncedUpdate); // Cleanup listener\n      canvas.off('object:removed', debouncedUpdate); // Cleanup listener\n      canvas.off('object:modified', debouncedUpdate); // Cleanup listener\n      clearTimeout(timeout); // Clear timeout\n    };\n  }, [canvas]); // Re-run effect when canvas changes\n\n  const handleDragEnd = (event: DragEndEvent) => {\n    const { active, over } = event; // Destructure active and over items\n\n    if (over && active.id !== over.id) {\n      // Check if dropped on a different item\n      const oldIndex = objects.findIndex((obj: any) => obj.uid === active.id); // Find index of dragged item\n      const newIndex = objects.findIndex((obj: any) => obj.uid === over.id); // Find index of target item\n\n      if (oldIndex !== -1 && newIndex !== -1) {\n        // Ensure both indices are valid\n        // Calculate fabric indices (reversed)\n        // objects[0] is Top (Fabric index N-1)\n        // objects[N-1] is Bottom (Fabric index 0)\n\n        // We want to move the object at oldIndex to newIndex in the UI list.\n        // In Fabric, we need to calculate the target index.\n\n        // Example: [A, B, C] (UI) -> [C, B, A] (Fabric)\n        // Move A (0) to 1. Result: [B, A, C] (UI) -> [C, A, B] (Fabric)\n\n        // The target index in Fabric corresponds to the new position in the UI list.\n        // If we move to UI index `newIndex`, it means it should be at `objects.length - 1 - newIndex` in Fabric?\n        // Let's verify.\n        // If newIndex is 0 (Top), fabric index should be length-1.\n        // If newIndex is length-1 (Bottom), fabric index should be 0.\n        // So yes, fabricNewIndex = objects.length - 1 - newIndex.\n\n        const fabricNewIndex = objects.length - 1 - newIndex; // Calculate new index for Fabric\n        const obj = objects[oldIndex]; // Get the object being moved\n\n        canvas?.moveObjectTo(obj, fabricNewIndex); // Move object in Fabric canvas\n        canvas?.requestRenderAll(); // Request re-render\n        history.saveState(); // Save state to history\n        updateObjects(); // Update local state\n      }\n    }\n  };\n\n  const toggleVisibility = (obj: FabricObject, e: React.MouseEvent) => {\n    e.stopPropagation(); // Prevent event bubbling\n    obj.visible = !obj.visible; // Toggle visibility property\n    if (!obj.visible) {\n      canvas?.discardActiveObject(); // Deselect if hidden\n    }\n    canvas?.requestRenderAll(); // Request re-render\n    history.saveState(); // Save state to history\n    // Force update\n    setObjects([...(canvas?.getObjects() || [])].reverse()); // Update local state\n  };\n\n  const toggleLock = (obj: FabricObject, e: React.MouseEvent) => {\n    e.stopPropagation(); // Prevent event bubbling\n    obj.lockMovementX = !obj.lockMovementX; // Toggle X movement lock\n    obj.lockMovementY = !obj.lockMovementY; // Toggle Y movement lock\n    obj.lockRotation = !obj.lockRotation; // Toggle rotation lock\n    obj.lockScalingX = !obj.lockScalingX; // Toggle X scaling lock\n    obj.lockScalingY = !obj.lockScalingY; // Toggle Y scaling lock\n    obj.selectable = !obj.lockMovementX; // If locked, not selectable\n\n    if (!obj.selectable) {\n      canvas?.discardActiveObject(); // Deselect if not selectable\n    }\n\n    canvas?.requestRenderAll(); // Request re-render\n    history.saveState(); // Save state to history\n    setObjects([...(canvas?.getObjects() || [])].reverse()); // Update local state\n  };\n\n  const selectObject = (obj: FabricObject) => {\n    if (!canvas || !obj.visible || !obj.selectable) return; // Exit if not selectable\n    canvas.setActiveObject(obj); // Set active object in canvas\n    canvas.requestRenderAll(); // Request re-render\n  };\n\n  const deleteObject = (obj: FabricObject, e: React.MouseEvent) => {\n    e.stopPropagation(); // Prevent event bubbling\n    canvas?.remove(obj); // Remove object from canvas\n    canvas?.requestRenderAll(); // Request re-render\n    history.saveState(); // Save state to history\n  };\n\n  return (\n    <div style={{ marginTop: 16 }}>\n      {' '}\n      {/* Container with top margin */}\n      <Title level={5}>Layers</Title> {/* Panel title */}\n      <DndContext sensors={sensors} collisionDetection={closestCenter} onDragEnd={handleDragEnd}>\n        {' '}\n        {/* DnD Context */}\n        <SortableContext\n          items={objects.map((obj: any) => obj.uid)} // Items to be sorted\n          strategy={verticalListSortingStrategy} // Sorting strategy\n        >\n          <div\n            style={{\n              maxHeight: 300, // Maximum height\n              overflowY: 'auto', // Vertical scroll if needed\n              border: '1px solid #d9d9d9', // Border style\n              borderRadius: 4, // Rounded corners\n              padding: 4, // Padding\n            }}\n          >\n            {objects.map((item: any, index) => {\n              // Iterate over objects\n              const isSelected = selectedObject === item; // Check if selected\n              const type = item.type || 'Object'; // Get object type\n              const name = item.name || `${type} ${objects.length - index}`; // Generate name\n\n              return (\n                <SortableItem\n                  key={item.uid} // Unique key\n                  id={item.uid} // Sortable ID\n                  isSelected={isSelected} // Selection state\n                  onClick={() => selectObject(item)} // Click handler\n                >\n                  <div\n                    style={{\n                      display: 'flex', // Flexbox layout\n                      alignItems: 'center', // Center items vertically\n                      width: '100%', // Full width\n                      justifyContent: 'space-between', // Space between content\n                    }}\n                  >\n                    <span\n                      style={{\n                        overflow: 'hidden', // Hide overflow\n                        textOverflow: 'ellipsis', // Show ellipsis\n                        whiteSpace: 'nowrap', // No wrap\n                        maxWidth: 120, // Max width for text\n                      }}\n                    >\n                      {name} {/* Display name */}\n                    </span>\n                    <Space size={4}>\n                      {' '}\n                      {/* Space between buttons */}\n                      <Button\n                        type=\"text\" // Text button style\n                        size=\"small\" // Small size\n                        icon={item.visible ? <EyeOutlined /> : <EyeInvisibleOutlined />} // Visibility icon\n                        onClick={(e) => toggleVisibility(item, e)} // Toggle visibility handler\n                        onMouseDown={(e) => e.stopPropagation()} // Prevent drag start\n                      />\n                      <Button\n                        type=\"text\" // Text button style\n                        size=\"small\" // Small size\n                        icon={item.lockMovementX ? <LockOutlined /> : <UnlockOutlined />} // Lock icon\n                        onClick={(e) => toggleLock(item, e)} // Toggle lock handler\n                        onMouseDown={(e) => e.stopPropagation()} // Prevent drag start\n                      />\n                      <Button\n                        type=\"text\" // Text button style\n                        size=\"small\" // Small size\n                        danger // Danger style (red)\n                        icon={<DeleteOutlined />} // Delete icon\n                        onClick={(e) => deleteObject(item, e)} // Delete handler\n                        onMouseDown={(e) => e.stopPropagation()} // Prevent drag start\n                      />\n                    </Space>\n                  </div>\n                </SortableItem>\n              );\n            })}\n          </div>\n        </SortableContext>\n      </DndContext>\n    </div>\n  );\n};\n\nexport default LayersPanel; // Export component\n","// This icon file is generated automatically.\nvar VerticalAlignTopOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M859.9 168H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM518.3 355a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V848c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V509.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 355z\" } }] }, \"name\": \"vertical-align-top\", \"theme\": \"outlined\" };\nexport default VerticalAlignTopOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport VerticalAlignTopOutlinedSvg from \"@ant-design/icons-svg/es/asn/VerticalAlignTopOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar VerticalAlignTopOutlined = function VerticalAlignTopOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: VerticalAlignTopOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(VerticalAlignTopOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'VerticalAlignTopOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar VerticalAlignBottomOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M859.9 780H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM505.7 669a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V176c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8z\" } }] }, \"name\": \"vertical-align-bottom\", \"theme\": \"outlined\" };\nexport default VerticalAlignBottomOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport VerticalAlignBottomOutlinedSvg from \"@ant-design/icons-svg/es/asn/VerticalAlignBottomOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar VerticalAlignBottomOutlined = function VerticalAlignBottomOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: VerticalAlignBottomOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(VerticalAlignBottomOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'VerticalAlignBottomOutlined';\n}\nexport default RefIcon;","import React from 'react';\nimport { Button, Space, Tooltip, Typography } from 'antd';\nimport {\n  AlignLeftOutlined,\n  AlignCenterOutlined,\n  AlignRightOutlined,\n  VerticalAlignTopOutlined,\n  VerticalAlignMiddleOutlined,\n  VerticalAlignBottomOutlined,\n  GroupOutlined,\n  UngroupOutlined,\n} from '@ant-design/icons';\nimport { useVectorEditor } from '../context';\nimport { ActiveSelection, Group } from 'fabric';\n\nconst { Title } = Typography;\n\nconst AlignmentPanel: React.FC = () => {\n  const { canvas, selectedObject, history } = useVectorEditor();\n\n  const align = (position: string) => {\n    if (!canvas || !selectedObject) return;\n\n    const activeObj = selectedObject;\n    const canvasWidth = canvas.width || 0;\n    const canvasHeight = canvas.height || 0;\n\n    switch (position) {\n      case 'left':\n        activeObj.set({ left: 0 });\n        break;\n      case 'center':\n        canvas.centerObjectH(activeObj);\n        break;\n      case 'right':\n        activeObj.set({ left: canvasWidth - (activeObj.width || 0) * (activeObj.scaleX || 1) });\n        break;\n      case 'top':\n        activeObj.set({ top: 0 });\n        break;\n      case 'middle':\n        canvas.centerObjectV(activeObj);\n        break;\n      case 'bottom':\n        activeObj.set({ top: canvasHeight - (activeObj.height || 0) * (activeObj.scaleY || 1) });\n        break;\n    }\n\n    activeObj.setCoords();\n    canvas.requestRenderAll();\n    history.saveState();\n  };\n\n  const groupObjects = () => {\n    if (!canvas) return;\n    const activeObj = canvas.getActiveObject();\n    if (!activeObj || activeObj.type !== 'activeSelection') return;\n\n    (activeObj as any).toGroup();\n    canvas.requestRenderAll();\n    history.saveState();\n  };\n\n  const ungroupObjects = () => {\n    if (!canvas) return;\n    const activeObj = canvas.getActiveObject();\n    if (!activeObj || activeObj.type !== 'group') return;\n\n    (activeObj as any).toActiveSelection();\n    canvas.requestRenderAll();\n    history.saveState();\n  };\n\n  if (!selectedObject) return null;\n\n  return (\n    <div style={{ marginBottom: 16 }}>\n      <Title level={5}>Alignment & Grouping</Title>\n      <Space wrap>\n        <Tooltip title=\"Align Left\">\n          <Button size=\"small\" icon={<AlignLeftOutlined />} onClick={() => align('left')} />\n        </Tooltip>\n        <Tooltip title=\"Align Center\">\n          <Button size=\"small\" icon={<AlignCenterOutlined />} onClick={() => align('center')} />\n        </Tooltip>\n        <Tooltip title=\"Align Right\">\n          <Button size=\"small\" icon={<AlignRightOutlined />} onClick={() => align('right')} />\n        </Tooltip>\n        <Tooltip title=\"Align Top\">\n          <Button size=\"small\" icon={<VerticalAlignTopOutlined />} onClick={() => align('top')} />\n        </Tooltip>\n        <Tooltip title=\"Align Middle\">\n          <Button\n            size=\"small\"\n            icon={<VerticalAlignMiddleOutlined />}\n            onClick={() => align('middle')}\n          />\n        </Tooltip>\n        <Tooltip title=\"Align Bottom\">\n          <Button\n            size=\"small\"\n            icon={<VerticalAlignBottomOutlined />}\n            onClick={() => align('bottom')}\n          />\n        </Tooltip>\n      </Space>\n      <div style={{ marginTop: 8 }}>\n        <Space>\n          <Tooltip title=\"Group\">\n            <Button size=\"small\" icon={<GroupOutlined />} onClick={groupObjects} />\n          </Tooltip>\n          <Tooltip title=\"Ungroup\">\n            <Button size=\"small\" icon={<UngroupOutlined />} onClick={ungroupObjects} />\n          </Tooltip>\n        </Space>\n      </div>\n    </div>\n  );\n};\n\nexport default AlignmentPanel;\n","import React from 'react';\nimport { PageContainer } from '@ant-design/pro-components';\nimport { Card, Layout } from 'antd';\nimport { VectorEditorProvider } from './context';\nimport Toolbar from './components/Toolbar';\nimport CanvasArea from './components/CanvasArea';\nimport PropertiesPanel from './components/PropertiesPanel';\nimport LayersPanel from './components/LayersPanel';\nimport AlignmentPanel from './components/AlignmentPanel';\nimport styles from './styles.less';\n\nconst { Sider, Content } = Layout;\n\nconst VectorEditor: React.FC = () => {\n  return (\n    <PageContainer title=\"Vector Editor\">\n      <VectorEditorProvider>\n        <Card className={styles.editorContainer} bodyStyle={{ padding: 0, height: '100%' }}>\n          <Layout style={{ height: '80vh' }}>\n            <Sider theme=\"light\" width={60} className={styles.toolbarSider}>\n              <Toolbar />\n            </Sider>\n            <Content className={styles.canvasContent}>\n              <CanvasArea />\n            </Content>\n            <Sider theme=\"light\" width={300} className={styles.propertiesSider}>\n              <AlignmentPanel />\n              <PropertiesPanel />\n              <LayersPanel />\n            </Sider>\n          </Layout>\n        </Card>\n      </VectorEditorProvider>\n    </PageContainer>\n  );\n};\n\nexport default VectorEditor;\n","\nimport \"/home/thanhnd/Downloads/code/ultimate-tool-web/src/pages/VectorEditor/styles.less?modules\";\nexport default {\"toolbarSider\": `toolbarSider-WrdEPO3N`,\"propertiesSider\": `propertiesSider-2RCO5zZs`,\"editorContainer\": `editorContainer-K_31rsCt`,\"canvasContent\": `canvasContent-l3CEHf1z`}\n"],"names":[],"mappings":"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"}