{"version":3,"sources":["src/pages/PNGJPEG/utils/ImageEditorEngine.tsx","src/pages/PNGJPEG/utils/transformHelpers.ts","src/pages/PNGJPEG/utils/layerHelpers.ts","src/pages/PNGJPEG/utils/overlayHelpers.ts","src/pages/PNGJPEG/utils/perspectiveHelpers.ts","src/pages/PNGJPEG/utils/upscaleHelpers.ts","src/pages/PNGJPEG/utils/effectsHelpers.ts","src/pages/PNGJPEG/components/ImageEditor/ImageCanvas.tsx","src/pages/PNGJPEG/components/ImageEditor/ColorRemovalModal.tsx","node_modules/@ant-design/icons/es/icons/RotateLeftOutlined.js","node_modules/@ant-design/icons-svg/es/asn/ScissorOutlined.js","node_modules/@ant-design/icons/es/icons/ScissorOutlined.js","node_modules/@ant-design/icons-svg/es/asn/ExportOutlined.js","node_modules/@ant-design/icons/es/icons/ExportOutlined.js","node_modules/@ant-design/icons-svg/es/asn/BorderInnerOutlined.js","node_modules/@ant-design/icons/es/icons/BorderInnerOutlined.js","node_modules/@ant-design/icons-svg/es/asn/SignatureOutlined.js","node_modules/@ant-design/icons/es/icons/SignatureOutlined.js","node_modules/@ant-design/icons-svg/es/asn/RetweetOutlined.js","node_modules/@ant-design/icons/es/icons/RetweetOutlined.js","src/pages/PNGJPEG/components/ImageEditor/CustomSlider.tsx","src/pages/PNGJPEG/components/ImageEditor/RGBHistogram.tsx","src/pages/PNGJPEG/components/ImageEditor/UpscaleModal.tsx","node_modules/@ant-design/icons-svg/es/asn/InfoCircleOutlined.js","node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js","node_modules/@ant-design/icons/es/icons/LoadingOutlined.js","src/pages/PNGJPEG/components/ImageEditor/ExportModal.tsx","src/pages/PNGJPEG/components/ImageEditor/SideEditorToolbar.tsx","node_modules/@ant-design/icons-svg/es/asn/MergeCellsOutlined.js","node_modules/@ant-design/icons/es/icons/MergeCellsOutlined.js","node_modules/@ant-design/icons/es/icons/UpOutlined.js","node_modules/@ant-design/icons/es/icons/DownOutlined.js","node_modules/@ant-design/icons-svg/es/asn/ItalicOutlined.js","node_modules/@ant-design/icons/es/icons/ItalicOutlined.js","node_modules/@ant-design/icons-svg/es/asn/AlignLeftOutlined.js","node_modules/@ant-design/icons/es/icons/AlignLeftOutlined.js","node_modules/@ant-design/icons-svg/es/asn/AlignCenterOutlined.js","node_modules/@ant-design/icons/es/icons/AlignCenterOutlined.js","node_modules/@ant-design/icons-svg/es/asn/AlignRightOutlined.js","node_modules/@ant-design/icons/es/icons/AlignRightOutlined.js","src/pages/PNGJPEG/components/ImageEditor/TopEditorToolbar.tsx","src/pages/PNGJPEG/components/ImageEditor/index.tsx","src/pages/PNGJPEG/hooks/useCanvas.tsx","src/pages/PNGJPEG/hooks/useHistory.tsx","src/pages/PNGJPEG/index.tsx"],"sourcesContent":["export type ImageDataLike = ImageData;\n\nexport function createCanvas(w: number, h: number) {\n  const c = document.createElement('canvas');\n  c.width = w;\n  c.height = h;\n  return c;\n}\n\nexport function drawImageToCanvasFromUrl(url: string): Promise<HTMLCanvasElement> {\n  return new Promise((res, rej) => {\n    const img = new Image();\n    img.crossOrigin = 'anonymous';\n    img.onload = () => {\n      const c = createCanvas(img.naturalWidth, img.naturalHeight);\n      const ctx = c.getContext('2d')!;\n      ctx.drawImage(img, 0, 0);\n      res(c);\n    };\n    img.onerror = rej;\n    img.src = url;\n  });\n}\n\nexport function cloneImageData(src: ImageDataLike): ImageData {\n  const out = new ImageData(src.width, src.height);\n  out.data.set(new Uint8ClampedArray(src.data));\n  return out;\n}\n\nexport function applyBrightnessContrast(data: ImageData, brightness = 0, contrast = 0) {\n  // brightness in [-255,255], contrast in [-100,100]\n  const d = data.data;\n  const c = contrast / 100 + 1;\n  const intercept = 128 * (1 - c);\n  for (let i = 0; i < d.length; i += 4) {\n    d[i] = Math.min(255, Math.max(0, d[i] * c + intercept + brightness));\n    d[i + 1] = Math.min(255, Math.max(0, d[i + 1] * c + intercept + brightness));\n    d[i + 2] = Math.min(255, Math.max(0, d[i + 2] * c + intercept + brightness));\n  }\n  return data;\n}\n\nexport function applyConvolution(data: ImageData, kernel: number[], kernelSize: number) {\n  const w = data.width;\n  const h = data.height;\n  const src = data.data;\n  const out = new Uint8ClampedArray(src.length);\n  const half = Math.floor(kernelSize / 2);\n\n  for (let y = 0; y < h; y++) {\n    for (let x = 0; x < w; x++) {\n      let r = 0,\n        g = 0,\n        b = 0,\n        a = 0;\n      for (let ky = 0; ky < kernelSize; ky++) {\n        for (let kx = 0; kx < kernelSize; kx++) {\n          const px = x + kx - half;\n          const py = y + ky - half;\n          if (px < 0 || px >= w || py < 0 || py >= h) continue;\n          const idx = (py * w + px) * 4;\n          const kval = kernel[ky * kernelSize + kx];\n          r += src[idx] * kval;\n          g += src[idx + 1] * kval;\n          b += src[idx + 2] * kval;\n          a += src[idx + 3] * kval;\n        }\n      }\n      const idx = (y * w + x) * 4;\n      out[idx] = Math.min(255, Math.max(0, r));\n      out[idx + 1] = Math.min(255, Math.max(0, g));\n      out[idx + 2] = Math.min(255, Math.max(0, b));\n      out[idx + 3] = Math.min(255, Math.max(0, a || src[idx + 3]));\n    }\n  }\n\n  data.data.set(out);\n  return data;\n}\n\nexport const Kernels = {\n  sharpen: [0, -1, 0, -1, 5, -1, 0, -1, 0],\n  blur3: [1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9],\n  gaussian5: [\n    1 / 273,\n    4 / 273,\n    7 / 273,\n    4 / 273,\n    1 / 273,\n    4 / 273,\n    16 / 273,\n    26 / 273,\n    16 / 273,\n    4 / 273,\n    7 / 273,\n    26 / 273,\n    41 / 273,\n    26 / 273,\n    7 / 273,\n    4 / 273,\n    16 / 273,\n    26 / 273,\n    16 / 273,\n    4 / 273,\n    1 / 273,\n    4 / 273,\n    7 / 273,\n    4 / 273,\n    1 / 273,\n  ],\n  // -------- New dynamic blur kernel generators --------\n  generateBoxBlurKernel(size: number) {\n    const s = size | 0;\n    const count = s * s;\n    return Array(count).fill(1 / count);\n  },\n\n  generateGaussianKernel(radius: number) {\n    const r = radius | 0;\n    const size = r * 2 + 1;\n    const sigma = r / 2;\n    const twoSigmaSq = 2 * sigma * sigma;\n\n    let kernel: number[] = [];\n    let sum = 0;\n\n    for (let y = -r; y <= r; y++) {\n      for (let x = -r; x <= r; x++) {\n        const v = Math.exp(-(x * x + y * y) / twoSigmaSq);\n        kernel.push(v);\n        sum += v;\n      }\n    }\n\n    // normalize Gaussian kernel\n    return kernel.map((v) => v / sum);\n  },\n};\n\nexport function applyThresholdAlpha(data: ImageData, threshold = 0) {\n  threshold = 255 - threshold;\n  // If pixel is near-white (all channels > threshold), set alpha = 0\n  const d = data.data;\n  for (let i = 0; i < d.length; i += 4) {\n    if (d[i] > threshold && d[i + 1] > threshold && d[i + 2] > threshold) {\n      d[i + 3] = 0;\n    }\n  }\n  return data;\n}\n\nexport function applyThresholdAlphaBlack(data: ImageData, threshold = 0) {\n  // If pixel is near-black (all RGB channels < threshold), set alpha = 0\n  const d = data.data;\n  for (let i = 0; i < d.length; i += 4) {\n    if (d[i] < threshold && d[i + 1] < threshold && d[i + 2] < threshold) {\n      d[i + 3] = 0;\n    }\n  }\n  return data;\n}\n\nexport function flipHorizontal(canvas: HTMLCanvasElement) {\n  const ctx = canvas.getContext('2d')!;\n  ctx.save();\n  ctx.translate(canvas.width, 0);\n  ctx.scale(-1, 1);\n  const img = ctx.getImageData(0, 0, canvas.width, canvas.height);\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.putImageData(img, 0, 0);\n  ctx.restore();\n}\n\nexport function flipVertical(canvas: HTMLCanvasElement) {\n  const ctx = canvas.getContext('2d')!;\n  ctx.save();\n  ctx.translate(0, canvas.height);\n  ctx.scale(1, -1);\n  const img = ctx.getImageData(0, 0, canvas.width, canvas.height);\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.putImageData(img, 0, 0);\n  ctx.restore();\n}\n\nexport function rotateCanvas(canvas: HTMLCanvasElement, degrees: number) {\n  const radians = (degrees * Math.PI) / 180;\n  const w = canvas.width;\n  const h = canvas.height;\n  const c2 = createCanvas(h, w); // Swap dims if 90/270\n  const ctx2 = c2.getContext('2d')!;\n  ctx2.translate(c2.width / 2, c2.height / 2);\n  ctx2.rotate(radians);\n  ctx2.drawImage(canvas, -w / 2, -h / 2);\n  // resize original\n  canvas.width = c2.width;\n  canvas.height = c2.height;\n  const ctx = canvas.getContext('2d')!;\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n  ctx.drawImage(c2, 0, 0);\n}\n\nexport function exportCanvasToBlob(\n  canvas: HTMLCanvasElement,\n  type = 'image/png',\n  quality = 0.92,\n): Promise<Blob> {\n  return new Promise((res) => canvas.toBlob((b) => res(b as Blob), type, quality));\n}\n\n// Compute 3x3 homography H such that dst = H * src\nexport function computeHomography(src: [number, number][], dst: [number, number][]): number[][] {\n  if (src.length !== 4 || dst.length !== 4) {\n    throw new Error('computeHomography requires exactly 4 points for src and dst');\n  }\n\n  const A: number[][] = [];\n\n  for (let i = 0; i < 4; i++) {\n    const [x, y] = src[i];\n    const [u, v] = dst[i];\n\n    A.push([-x, -y, -1, 0, 0, 0, x * u, y * u, u]);\n    A.push([0, 0, 0, -x, -y, -1, x * v, y * v, v]);\n  }\n\n  // Solve Ah = 0 using Gaussian elimination for 8x8\n  const M: number[][] = [];\n  const b: number[] = [];\n  for (let i = 0; i < 8; i++) {\n    M.push(A[i].slice(0, 8));\n    b.push(-A[i][8]);\n  }\n\n  const h8 = solveLinearSystem(M, b); // returns 8 elements\n  const h = [...h8, 1]; // last element = 1\n\n  return [\n    [h[0], h[1], h[2]],\n    [h[3], h[4], h[5]],\n    [h[6], h[7], h[8]],\n  ];\n}\n\n// Simple Gaussian elimination solver for 8x8\nfunction solveLinearSystem(A: number[][], b: number[]): number[] {\n  const n = b.length;\n  const M = A.map((row, i) => [...row, b[i]]); // augmented matrix\n\n  for (let i = 0; i < n; i++) {\n    // find pivot\n    let maxRow = i;\n    for (let k = i + 1; k < n; k++) {\n      if (Math.abs(M[k][i]) > Math.abs(M[maxRow][i])) maxRow = k;\n    }\n    [M[i], M[maxRow]] = [M[maxRow], M[i]];\n\n    // eliminate column\n    for (let k = i + 1; k < n; k++) {\n      const factor = M[k][i] / M[i][i];\n      for (let j = i; j <= n; j++) M[k][j] -= factor * M[i][j];\n    }\n  }\n\n  // back substitution\n  const x = new Array(n).fill(0);\n  for (let i = n - 1; i >= 0; i--) {\n    let sum = M[i][n];\n    for (let j = i + 1; j < n; j++) sum -= M[i][j] * x[j];\n    x[i] = sum / M[i][i];\n  }\n  return x;\n}\n\n// Map a destination point (x, y) back to source coordinates using inverse of H\nfunction applyHomographyInverse(H: number[][], x: number, y: number): [number, number] {\n  const [[h00, h01, h02], [h10, h11, h12], [h20, h21, h22]] = H;\n\n  const det =\n    h00 * (h11 * h22 - h12 * h21) - h01 * (h10 * h22 - h12 * h20) + h02 * (h10 * h21 - h11 * h20);\n  if (Math.abs(det) < 1e-10) return [0, 0];\n\n  const inv = [\n    [(h11 * h22 - h12 * h21) / det, (h02 * h21 - h01 * h22) / det, (h01 * h12 - h02 * h11) / det],\n    [(h12 * h20 - h10 * h22) / det, (h00 * h22 - h02 * h20) / det, (h02 * h10 - h00 * h12) / det],\n    [(h10 * h21 - h11 * h20) / det, (h01 * h20 - h00 * h21) / det, (h00 * h11 - h01 * h10) / det],\n  ];\n\n  const sx = inv[0][0] * x + inv[0][1] * y + inv[0][2];\n  const sy = inv[1][0] * x + inv[1][1] * y + inv[1][2];\n  const w = inv[2][0] * x + inv[2][1] * y + inv[2][2];\n\n  return [sx / w, sy / w];\n}\n\n// Perspective transform using homography\nexport function perspectiveTransform(\n  srcCanvas: HTMLCanvasElement,\n  srcQuad: [number, number, number, number, number, number, number, number],\n  destW: number,\n  destH: number,\n): HTMLCanvasElement {\n  const dest = createCanvas(destW, destH);\n  const dctx = dest.getContext('2d')!;\n  const src = srcCanvas.getContext('2d')!.getImageData(0, 0, srcCanvas.width, srcCanvas.height);\n  const destData = dctx.createImageData(destW, destH);\n\n  const srcPts: [number, number][] = [\n    [srcQuad[0], srcQuad[1]],\n    [srcQuad[2], srcQuad[3]],\n    [srcQuad[4], srcQuad[5]],\n    [srcQuad[6], srcQuad[7]],\n  ];\n  const dstPts: [number, number][] = [\n    [0, 0],\n    [destW, 0],\n    [destW, destH],\n    [0, destH],\n  ];\n\n  const H = computeHomography(srcPts, dstPts);\n\n  for (let y = 0; y < destH; y++) {\n    for (let x = 0; x < destW; x++) {\n      const [sx, sy] = applyHomographyInverse(H, x, y);\n      if (sx >= 0 && sx < srcCanvas.width && sy >= 0 && sy < srcCanvas.height) {\n        const ix = Math.floor(sx);\n        const iy = Math.floor(sy);\n        const srcIndex = (iy * srcCanvas.width + ix) * 4;\n        const dstIndex = (y * destW + x) * 4;\n        destData.data[dstIndex] = src.data[srcIndex];\n        destData.data[dstIndex + 1] = src.data[srcIndex + 1];\n        destData.data[dstIndex + 2] = src.data[srcIndex + 2];\n        destData.data[dstIndex + 3] = src.data[srcIndex + 3];\n      }\n    }\n  }\n\n  dctx.putImageData(destData, 0, 0);\n  return dest;\n}\n\nconst clamp = (value: number, min = 0, max = 255) => {\n  return Math.min(max, Math.max(min, value));\n};\n\n// For 0..1 ranges\nconst clamp01 = (value: number) => {\n  return Math.min(1, Math.max(0, value));\n};\n\nconst rgbToHsl = (r: number, g: number, b: number): [number, number, number] => {\n  r /= 255;\n  g /= 255;\n  b /= 255;\n\n  const max = Math.max(r, g, b);\n  const min = Math.min(r, g, b);\n  let h = 0,\n    s = 0,\n    l = (max + min) / 2;\n\n  if (max !== min) {\n    const d = max - min;\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\n    switch (max) {\n      case r:\n        h = (g - b) / d + (g < b ? 6 : 0);\n        break;\n      case g:\n        h = (b - r) / d + 2;\n        break;\n      case b:\n        h = (r - g) / d + 4;\n        break;\n    }\n    h /= 6;\n  }\n\n  return [h, s, l];\n};\n\nconst hslToRgb = (h: number, s: number, l: number): [number, number, number] => {\n  let r: number, g: number, b: number;\n\n  if (s === 0) {\n    r = g = b = l; // achromatic\n  } else {\n    const hue2rgb = (p: number, q: number, t: number) => {\n      if (t < 0) t += 1;\n      if (t > 1) t -= 1;\n      if (t < 1 / 6) return p + (q - p) * 6 * t;\n      if (t < 1 / 2) return q;\n      if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\n      return p;\n    };\n\n    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n    const p = 2 * l - q;\n\n    r = hue2rgb(p, q, h + 1 / 3);\n    g = hue2rgb(p, q, h);\n    b = hue2rgb(p, q, h - 1 / 3);\n  }\n\n  return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];\n};\n\nexport const applyToneAdjustments = (\n  data: ImageData,\n  {\n    highlights = 0,\n    shadows = 0,\n    whites = 0,\n    blacks = 0,\n    vibrance = 0,\n    saturation = 0,\n    clarity = 0, // local contrast\n    dehaze = 0, // remove fog\n  }: {\n    highlights?: number;\n    shadows?: number;\n    whites?: number;\n    blacks?: number;\n    vibrance?: number;\n    saturation?: number;\n    clarity?: number;\n    dehaze?: number;\n  },\n) => {\n  const d = data.data;\n\n  // If clarity is applied, create a shallow copy for local contrast reference\n  const originalData = clarity !== 0 ? new Uint8ClampedArray(d) : null;\n\n  for (let i = 0; i < d.length; i += 4) {\n    let r = d[i];\n    let g = d[i + 1];\n    let b = d[i + 2];\n\n    /** ------------------------ 1️⃣ HIGHLIGHTS / SHADOWS ------------------------ **/\n    const luma = 0.299 * r + 0.587 * g + 0.114 * b;\n    if (luma > 192 && highlights !== 0) {\n      const hFactor = (luma - 192) / (255 - 192);\n      r = clamp(r + highlights * hFactor);\n      g = clamp(g + highlights * hFactor);\n      b = clamp(b + highlights * hFactor);\n    }\n    if (luma < 64 && shadows !== 0) {\n      const sFactor = 1 - luma / 64;\n      r = clamp(r + shadows * sFactor);\n      g = clamp(g + shadows * sFactor);\n      b = clamp(b + shadows * sFactor);\n    }\n\n    /** ------------------------ 2️⃣ WHITES / BLACKS ------------------------ **/\n    r = clamp(r + whites - blacks);\n    g = clamp(g + whites - blacks);\n    b = clamp(b + whites - blacks);\n\n    /** ------------------------ 3️⃣ DEHAZE ------------------------ **/\n    if (dehaze !== 0) {\n      const factor = 1 + dehaze / 100;\n      r = clamp(r * factor);\n      g = clamp(g * (1 - dehaze / 200)); // reduce green & blue to reduce 'fog'\n      b = clamp(b * (1 - dehaze / 200));\n    }\n\n    /** ------------------------ 4️⃣ VIBRANCE / SATURATION (HSL) ------------------------ **/\n    if (vibrance !== 0 || saturation !== 0) {\n      const tmp = [r, g, b];\n      applyVibranceSaturation(tmp as any, 0, { vibrance, saturation });\n      [r, g, b] = tmp;\n    }\n\n    /** ------------------------ 5️⃣ CLARITY (Local contrast) ------------------------ **/\n    if (clarity !== 0 && originalData) {\n      // baseline luma before enhancements\n      const baseLuma =\n        0.299 * originalData[i] + 0.587 * originalData[i + 1] + 0.114 * originalData[i + 2];\n\n      // Clarity: enhance mid-range contrast only\n      const contrastFactor = clarity / 100;\n      const lumaDiff = (luma - baseLuma) * contrastFactor;\n\n      r = clamp(r + lumaDiff);\n      g = clamp(g + lumaDiff);\n      b = clamp(b + lumaDiff);\n    }\n\n    /** ------------------------ WRITE BACK ------------------------ **/\n    d[i] = r;\n    d[i + 1] = g;\n    d[i + 2] = b;\n    // alpha unchanged\n  }\n\n  return data;\n};\n\nexport const applyDehaze = (p: Uint8ClampedArray | number[], i: number, dehaze: number) => {\n  // Lightroom-style dehaze: increases contrast and clarity, removes atmospheric haze\n  // Positive values: remove haze (increase contrast, saturation)\n  // Negative values: add haze (decrease contrast, saturation)\n\n  let r = p[i];\n  let g = p[i + 1];\n  let b = p[i + 2];\n\n  // Convert to HSL for saturation control\n  let [h, s, l] = rgbToHsl(r, g, b);\n\n  // Apply contrast enhancement/reduction around midtones\n  // Positive dehaze increases contrast, negative reduces it\n  const contrastFactor = 1 + (dehaze / 100) * 1.5;\n  const pivot = 128;\n\n  r = clamp(pivot + (r - pivot) * contrastFactor);\n  g = clamp(pivot + (g - pivot) * contrastFactor);\n  b = clamp(pivot + (b - pivot) * contrastFactor);\n\n  // Update HSL after contrast adjustment\n  [h, s, l] = rgbToHsl(r, g, b);\n\n  // Adjust saturation based on dehaze value\n  // Positive: increase saturation (remove haze)\n  // Negative: decrease saturation (add haze)\n  const satFactor = 1 + (dehaze / 100) * 0.6;\n  s = clamp01(s * satFactor);\n\n  // Adjust luminance slightly to maintain brightness\n  // Positive dehaze: slight brightness boost\n  // Negative dehaze: slight darkening\n  const lumFactor = 1 + (dehaze / 100) * 0.15;\n  l = clamp01(l * lumFactor);\n\n  // Convert back to RGB\n  [r, g, b] = hslToRgb(h, s, l);\n\n  p[i] = r;\n  p[i + 1] = g;\n  p[i + 2] = b;\n};\n\nexport const applyVibranceSaturation = (\n  p: Uint8ClampedArray | number[],\n  i: number,\n  { vibrance = 0, saturation = 0 }: { vibrance?: number; saturation?: number },\n) => {\n  let [h, s, l] = rgbToHsl(p[i], p[i + 1], p[i + 2]);\n\n  // --- 1️⃣ Saturation (multiplicative, more natural) ---\n  // Example: saturation = 20 → s *= 1.2 ; saturation = -10 → s *= 0.9\n  if (saturation !== 0) {\n    s = clamp01(s * (1 + saturation / 100));\n  }\n\n  // --- 2️⃣ Vibrance (only boosts low-saturated areas) ---\n  if (vibrance !== 0) {\n    const factor = vibrance / 100;\n    s = clamp01(s + (1 - s) * factor * (1 - s)); // nonlinear → strong effect only if s < 0.5\n  }\n\n  const [r, g, b] = hslToRgb(h, s, l);\n  p[i] = r;\n  p[i + 1] = g;\n  p[i + 2] = b;\n};\n\nexport const colorRanges = [\n  { name: 'red', range: [345, 15] },\n  { name: 'orange', range: [15, 45] },\n  { name: 'yellow', range: [45, 75] },\n  { name: 'green', range: [75, 165] },\n  { name: 'aqua', range: [165, 195] },\n  { name: 'blue', range: [195, 255] },\n  { name: 'purple', range: [255, 285] },\n  { name: 'magenta', range: [285, 345] },\n];\n\nexport const applyHslAdjustments = (\n  data: ImageData,\n  adjustments: Record<string, { h?: number; s?: number; l?: number }>, // h: degrees, s/l: percent or fractional\n) => {\n  const d = data.data;\n\n  for (let i = 0; i < d.length; i += 4) {\n    // Loop through each pixel (step 4: R,G,B,A)\n    let [r, g, b] = [d[i], d[i + 1], d[i + 2]]; // Extract RGB\n    let [h, s, l] = rgbToHsl(r, g, b); // Convert to HSL (h: 0–1)\n    let deg = (h * 360 + 360) % 360; // Convert hue to 0–360° safely\n\n    // find color range (handles wrap ranges like [345,15])\n    const entry = colorRanges.find(({ range }) => {\n      const [start, end] = range;\n      if (start <= end) {\n        return deg >= start && deg <= end;\n      } else {\n        // wrapped range (e.g. 345 -> 15)\n        return deg >= start || deg <= end;\n      }\n    });\n\n    if (!entry) {\n      // no matching range — write back unchanged\n      [d[i], d[i + 1], d[i + 2]] = hslToRgb(h, s, l);\n      continue;\n    }\n\n    const adj = adjustments[entry.name];\n    if (!adj) {\n      [d[i], d[i + 1], d[i + 2]] = hslToRgb(h, s, l);\n      continue;\n    }\n\n    const [startRaw, endRaw] = entry.range;\n    // Normalize start/end so start <= end (for clamping). If wrapped, push end +360.\n    let start = startRaw;\n    let end = endRaw;\n    if (start > end) end += 360; // e.g., 345..15 => 345..375\n\n    // Normalize deg into the same space as start..end\n    let degNorm = deg;\n    if (degNorm < start) degNorm += 360;\n\n    // ----- HUE: apply degree shift but clamp within the color's range -----\n    if (typeof adj.h === 'number' && adj.h !== 0) {\n      let newDeg = degNorm + adj.h; // tentative\n      // clamp to the range boundaries so it cannot jump outside the color band\n      if (newDeg < start) newDeg = start;\n      if (newDeg > end) newDeg = end;\n      // bring back to 0..360\n      deg = ((newDeg % 360) + 360) % 360; // Normalize back to 0–360°\n      h = deg / 360; // Convert back to 0–1 for HSL\n    }\n\n    // ----- SATURATION: flexible input handling -----\n    if (typeof adj.s === 'number' && adj.s !== 0) {\n      // interpret 0.2 as +20% for backward compatibility\n      const satPercent = Math.abs(adj.s) <= 1 ? adj.s * 100 : adj.s; // Allow 0.2 or 20 → both = +20%\n      s = clamp01(s * (1 + satPercent / 100)); // Apply proportionally\n    }\n\n    // ----- LUMINANCE: same handling as saturation -----\n    if (typeof adj.l === 'number' && adj.l !== 0) {\n      const lumPercent = Math.abs(adj.l) <= 1 ? adj.l * 100 : adj.l; // e.g. 0.1 → +10%\n      l = clamp01(l * (1 + lumPercent / 100)); // Apply multiplicatively\n    }\n\n    // Write final adjusted color back to RGBA buffer\n    [d[i], d[i + 1], d[i + 2]] = hslToRgb(h, s, l);\n  }\n\n  return data;\n};\n","import { message } from 'antd';\nimport { createCanvas } from './ImageEditorEngine';\n\n// #region Rotate / Transform Helpers\n// rotate\nexport const rotate = (deg: number, canvasRef, overlayRef, history) => {\n  if (!canvasRef.current) return;\n  // create temp canvas and rotate\n  const src = canvasRef.current;\n  const tmp = createCanvas(src.width, src.height);\n  const tctx = tmp.getContext('2d')!;\n  tctx.drawImage(src, 0, 0);\n  const dest = createCanvas(src.height, src.width);\n  const dctx = dest.getContext('2d')!;\n  dctx.translate(dest.width / 2, dest.height / 2);\n  dctx.rotate((deg * Math.PI) / 180);\n  dctx.drawImage(tmp, -tmp.width / 2, -tmp.height / 2);\n  // replace\n  canvasRef.current.width = dest.width;\n  canvasRef.current.height = dest.height;\n  overlayRef.current!.width = dest.width;\n  overlayRef.current!.height = dest.height;\n  const wctx = canvasRef.current.getContext('2d')!;\n  wctx.clearRect(0, 0, dest.width, dest.height);\n  wctx.drawImage(dest, 0, 0);\n  history.push(canvasRef.current.toDataURL(), `Rotate ${deg}`);\n};\n\n// flip\nexport const flipH = (canvasRef, history) => {\n  if (!canvasRef.current) return;\n  const ctx = canvasRef.current.getContext('2d')!;\n  const tmp = createCanvas(canvasRef.current.width, canvasRef.current.height);\n  tmp.getContext('2d')!.drawImage(canvasRef.current, 0, 0);\n  ctx.save();\n  ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n  ctx.scale(-1, 1);\n  ctx.drawImage(tmp, -canvasRef.current.width, 0);\n  ctx.restore();\n  history.push(canvasRef.current.toDataURL(), 'Flip horizontal');\n};\n\nexport const flipV = (canvasRef, history) => {\n  if (!canvasRef.current) return;\n  const ctx = canvasRef.current.getContext('2d')!;\n  const tmp = createCanvas(canvasRef.current.width, canvasRef.current.height);\n  tmp.getContext('2d')!.drawImage(canvasRef.current, 0, 0);\n  ctx.save();\n  ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n  ctx.scale(1, -1);\n  ctx.drawImage(tmp, 0, -canvasRef.current.height);\n  ctx.restore();\n  history.push(canvasRef.current.toDataURL(), 'Flip vertical');\n};\n\n// #region Crop\n// Crop: apply cropRect to canvas\nexport const applyCrop = (canvasRef, overlayRef, cropRect, setCropRect, history) => {\n  if (!canvasRef.current || !cropRect) return;\n  const c = createCanvas(Math.max(1, Math.round(cropRect.w)), Math.max(1, Math.round(cropRect.h)));\n  const ctx = c.getContext('2d')!;\n  ctx.drawImage(\n    canvasRef.current,\n    cropRect.x,\n    cropRect.y,\n    cropRect.w,\n    cropRect.h,\n    0,\n    0,\n    cropRect.w,\n    cropRect.h,\n  );\n  // replace current canvas\n  canvasRef.current.width = c.width;\n  canvasRef.current.height = c.height;\n  overlayRef.current!.width = c.width;\n  overlayRef.current!.height = c.height;\n  const wctx = canvasRef.current.getContext('2d')!;\n  wctx.clearRect(0, 0, c.width, c.height);\n  wctx.drawImage(c, 0, 0);\n  setCropRect(null);\n  history.push(canvasRef.current.toDataURL(), 'Cropped');\n};\n// #endregion\n\n// #region Export / Clipboard\n// exportImage\nexport const exportImage = async (asJpeg = false, canvasRef, onExport) => {\n  if (!canvasRef.current) return;\n  const blob = await new Promise<Blob | null>((res) =>\n    canvasRef.current!.toBlob((b) => res(b), asJpeg ? 'image/jpeg' : 'image/png', 0.92),\n  );\n  if (!blob) return;\n  if (onExport) onExport(blob);\n  // auto download\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = asJpeg ? 'edited.jpg' : 'edited.png';\n  a.click();\n  URL.revokeObjectURL(url);\n  message.success('Exported image');\n};\n\n// copy to clipboard (image)\nexport const copyToClipboard = async (canvasRef) => {\n  if (!canvasRef.current) return;\n  try {\n    const blob = await new Promise<Blob | null>((res) =>\n      canvasRef.current!.toBlob((b) => res(b), 'image/png'),\n    );\n    if (!blob) return;\n    // @ts-ignore navigator.clipboard\n    await (navigator.clipboard as any).write([new ClipboardItem({ 'image/png': blob })]);\n    message.success('Image copied to clipboard');\n  } catch (err) {\n    console.warn('clipboard failed', err);\n    message.error('Copy failed (browser may not support)');\n  }\n};\n// #endregion\n\n// #region Color Picker\n/** --- COLOR PICKER --- */\nexport const samplePixel = (e: MouseEvent, canvasRef, zoom) => {\n  const canvas = canvasRef.current;\n  if (!canvas) return null;\n\n  const rect = canvas.getBoundingClientRect();\n  const x = Math.floor((e.clientX - rect.left) / zoom);\n  const y = Math.floor((e.clientY - rect.top) / zoom);\n  if (x < 0 || y < 0 || x >= canvas.width || y >= canvas.height) return null;\n\n  const ctx = canvas.getContext('2d', { willReadFrequently: true });\n  if (!ctx) return null;\n  const p = ctx.getImageData(x, y, 1, 1).data;\n  return `#${[p[0], p[1], p[2]].map((v) => v.toString(16).padStart(2, '0')).join('')}`;\n};\n// #endregion\n","import { message } from 'antd';\nimport { createCanvas } from './ImageEditorEngine';\nimport { Tool } from '../components/ImageEditor';\n\nexport const addOverlayImage = (\n  file: File,\n  canvasRef: React.RefObject<HTMLCanvasElement>,\n  setLayers: React.Dispatch<any>,\n  setActiveLayerId: (id: string | null) => void,\n  setOverlaySelected: (v: boolean) => void,\n  drawOverlay: () => void,\n  setTool: React.Dispatch<React.SetStateAction<Tool>>,\n) => {\n  const img = new Image();\n  img.onload = () => {\n    const cw = canvasRef.current?.width || img.naturalWidth;\n    const ch = canvasRef.current?.height || img.naturalHeight;\n    let w = img.naturalWidth;\n    let h = img.naturalHeight;\n    const scale = Math.min(1, Math.min(cw / (w * 1.2), ch / (h * 1.2)));\n    w = Math.round(w * scale);\n    h = Math.round(h * scale);\n    const x = Math.round((cw - w) / 2);\n    const y = Math.round((ch - h) / 2);\n    const id = `${Date.now()}_${Math.round(Math.random() * 10000)}`;\n    const newLayer = {\n      id,\n      type: 'image' as const,\n      img,\n      rect: { x, y, w, h },\n      opacity: 1,\n      blend: 'source-over' as const,\n    } as any;\n    setLayers((prev: any) => [...prev, newLayer]);\n    setActiveLayerId(id);\n    setOverlaySelected(true);\n    drawOverlay();\n\n    message.success('Overlay image added');\n  };\n  img.onerror = () => message.error('Failed to load overlay image');\n  img.src = URL.createObjectURL(file);\n  setTool('layer');\n};\n\nexport const exportWithOverlay = async (\n  asJpeg: boolean,\n  canvasRefArg: React.RefObject<HTMLCanvasElement>,\n  layers: any[],\n  callback?: (blob: Blob) => void,\n) => {\n  if (!canvasRefArg.current) return;\n  const base = canvasRefArg.current;\n  const tmp = createCanvas(base.width, base.height);\n  const tctx = tmp.getContext('2d')!;\n  tctx.clearRect(0, 0, tmp.width, tmp.height);\n  tctx.drawImage(base, 0, 0);\n  for (const L of layers) {\n    try {\n      tctx.globalAlpha = L.opacity;\n      tctx.globalCompositeOperation = L.blend || 'source-over';\n\n      // Apply rotation if layer is rotated\n      if (L.rotation && L.rotation !== 0) {\n        const centerX = L.rect.x + L.rect.w / 2;\n        const centerY = L.rect.y + L.rect.h / 2;\n        tctx.translate(centerX, centerY);\n        tctx.rotate((L.rotation * Math.PI) / 180);\n        tctx.translate(-centerX, -centerY);\n      }\n\n      if (L.type === 'image' && L.img) {\n        tctx.drawImage(L.img, L.rect.x, L.rect.y, L.rect.w, L.rect.h);\n      } else if (L.type === 'text') {\n        // Render text layer\n        const fontStyle = L.fontItalic ? 'italic' : 'normal';\n        const fontWeight = L.fontWeight || 'normal';\n        const fontSize = L.fontSize || 16;\n        tctx.font = `${fontStyle} ${fontWeight} ${fontSize}px ${L.font || 'Arial'}`;\n        tctx.fillStyle = L.textColor || '#000000';\n        tctx.textAlign = L.textAlign || 'left';\n        tctx.textBaseline = 'top';\n\n        // Draw text\n        const lines = (L.text || '').split('\\n');\n        const lineHeight = fontSize * 1.2;\n        let currentY = L.rect.y;\n        for (const line of lines) {\n          let xPos = L.rect.x;\n          if (L.textAlign === 'center') xPos += L.rect.w / 2;\n          else if (L.textAlign === 'right') xPos += L.rect.w;\n\n          tctx.fillText(line, xPos, currentY);\n\n          // Draw decoration\n          if (L.textDecoration === 'underline') {\n            const metrics = tctx.measureText(line);\n            tctx.strokeStyle = L.textColor || '#000000';\n            tctx.lineWidth = 1;\n            tctx.beginPath();\n            tctx.moveTo(xPos, currentY + fontSize);\n            tctx.lineTo(xPos + metrics.width, currentY + fontSize);\n            tctx.stroke();\n          } else if (L.textDecoration === 'line-through') {\n            const metrics = tctx.measureText(line);\n            tctx.strokeStyle = L.textColor || '#000000';\n            tctx.lineWidth = 1;\n            tctx.beginPath();\n            tctx.moveTo(xPos, currentY + fontSize / 2);\n            tctx.lineTo(xPos + metrics.width, currentY + fontSize / 2);\n            tctx.stroke();\n          }\n          currentY += lineHeight;\n        }\n      }\n\n      // Reset transformation\n      if (L.rotation && L.rotation !== 0) {\n        tctx.setTransform(1, 0, 0, 1, 0, 0);\n      }\n    } catch (err) {\n      // ignore\n    }\n  }\n  tctx.globalAlpha = 1;\n  tctx.globalCompositeOperation = 'source-over';\n  const blob = await new Promise<Blob | null>((res) =>\n    tmp.toBlob((b) => res(b), asJpeg ? 'image/jpeg' : 'image/png', 0.92),\n  );\n  if (blob) {\n    if (callback) callback(blob);\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = asJpeg ? 'edited.jpg' : 'edited.png';\n    a.click();\n    URL.revokeObjectURL(url);\n    message.success('Exported image (with overlays)');\n  }\n};\n\nexport const mergeLayerIntoBase = (\n  canvasRef: React.RefObject<HTMLCanvasElement>,\n  layers: any[],\n  setLayers: React.Dispatch<any>,\n  history: { push: (s: string, label: string) => void },\n  id?: string,\n) => {\n  if (!canvasRef.current) return;\n  const toMerge = id ? layers.filter((l) => l.id === id && !l.locked) : layers.slice();\n  if (toMerge.length === 0) return;\n\n  const ctx = canvasRef.current.getContext('2d')!;\n  for (const L of toMerge) {\n    try {\n      ctx.save();\n      ctx.globalAlpha = L.opacity;\n      ctx.globalCompositeOperation = L.blend || 'source-over';\n\n      // Apply rotation if layer is rotated\n      if (L.rotation && L.rotation !== 0) {\n        const centerX = L.rect.x + L.rect.w / 2;\n        const centerY = L.rect.y + L.rect.h / 2;\n        ctx.translate(centerX, centerY);\n        ctx.rotate((L.rotation * Math.PI) / 180);\n        ctx.translate(-centerX, -centerY);\n      }\n\n      if (L.type === 'image' && L.img) {\n        ctx.drawImage(L.img, L.rect.x, L.rect.y, L.rect.w, L.rect.h);\n      } else if (L.type === 'text') {\n        // Render text layer\n        const fontStyle = L.fontItalic ? 'italic' : 'normal';\n        const fontWeight = L.fontWeight || 'normal';\n        const fontSize = L.fontSize || 16;\n        ctx.font = `${fontStyle} ${fontWeight} ${fontSize}px ${L.font || 'Arial'}`;\n        ctx.fillStyle = L.textColor || '#000000';\n        ctx.textAlign = L.textAlign || 'left';\n        ctx.textBaseline = 'top';\n\n        const lines = (L.text || '').split('\\n');\n        const lineHeight = fontSize * 1.2;\n        let currentY = L.rect.y;\n        for (const line of lines) {\n          let xPos = L.rect.x;\n          if (L.textAlign === 'center') xPos += L.rect.w / 2;\n          else if (L.textAlign === 'right') xPos += L.rect.w;\n\n          ctx.fillText(line, xPos, currentY);\n\n          // Draw decoration\n          if (L.textDecoration === 'underline') {\n            const metrics = ctx.measureText(line);\n            ctx.strokeStyle = L.textColor || '#000000';\n            ctx.lineWidth = 1;\n            ctx.beginPath();\n            ctx.moveTo(xPos, currentY + fontSize);\n            ctx.lineTo(xPos + metrics.width, currentY + fontSize);\n            ctx.stroke();\n          } else if (L.textDecoration === 'line-through') {\n            const metrics = ctx.measureText(line);\n            ctx.strokeStyle = L.textColor || '#000000';\n            ctx.lineWidth = 1;\n            ctx.beginPath();\n            ctx.moveTo(xPos, currentY + fontSize / 2);\n            ctx.lineTo(xPos + metrics.width, currentY + fontSize / 2);\n            ctx.stroke();\n          }\n          currentY += lineHeight;\n        }\n      }\n      ctx.restore();\n    } catch (err) {\n      // ignore\n    }\n  }\n  setLayers((prev) => prev.filter((l: any) => !toMerge.find((m: any) => m.id === l.id)));\n  history.push(canvasRef.current.toDataURL(), id ? 'Merge layer' : 'Merge layers');\n  message.success('Layer(s) merged into base');\n};\n\nexport const setLayerOpacity = (setLayers: React.Dispatch<any>, id: string, opacity: number) =>\n  setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, opacity } : L)));\n\nexport const setLayerBlend = (\n  setLayers: React.Dispatch<any>,\n  id: string,\n  blend: GlobalCompositeOperation,\n) => setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, blend } : L)));\n\nexport const moveLayerUp = (setLayers: React.Dispatch<any>, id: string) =>\n  setLayers((prev: any) => {\n    const idx = prev.findIndex((p: any) => p.id === id);\n    if (idx === -1 || idx === prev.length - 1) return prev;\n    const copy = prev.slice();\n    const tmp = copy[idx + 1];\n    copy[idx + 1] = copy[idx];\n    copy[idx] = tmp;\n    return copy;\n  });\n\nexport const moveLayerDown = (setLayers: React.Dispatch<any>, id: string) =>\n  setLayers((prev: any) => {\n    const idx = prev.findIndex((p: any) => p.id === id);\n    if (idx <= 0) return prev;\n    const copy = prev.slice();\n    const tmp = copy[idx - 1];\n    copy[idx - 1] = copy[idx];\n    copy[idx] = tmp;\n    return copy;\n  });\n\nexport const deleteLayer = (\n  setLayers: React.Dispatch<any>,\n  id: string,\n  setActiveLayerId?: (id: string | null) => void,\n) =>\n  setLayers((prev: any) => {\n    const copy = prev.filter((p: any) => p.id !== id || p.locked);\n    if (setActiveLayerId) setActiveLayerId(copy.length ? copy[copy.length - 1].id : null);\n    return copy;\n  });\n\nexport const selectLayer = (setActiveLayerId: (id: string | null) => void, id: string) => {\n  setActiveLayerId(id);\n};\n\n// Text layer helpers\nexport const addTextLayer = (\n  canvasRef: React.RefObject<HTMLCanvasElement>,\n  setLayers: React.Dispatch<any>,\n  setActiveLayerId: (id: string | null) => void,\n  setOverlaySelected: (v: boolean) => void,\n  drawOverlay: () => void,\n  textProps: {\n    text: string;\n    font: string;\n    fontSize: number;\n    fontWeight: any;\n    fontItalic: boolean;\n    textDecoration: 'none' | 'underline' | 'line-through';\n    textColor: string;\n    textAlign: 'left' | 'center' | 'right';\n  },\n  pos?: { x: number; y: number },\n) => {\n  if (!textProps.text.trim()) {\n    message.warning('Please enter text first');\n    return;\n  }\n\n  const cw = canvasRef.current?.width || 400;\n  const ch = canvasRef.current?.height || 300;\n  const x = pos ? Math.round(pos.x) : Math.round(cw / 4);\n  const y = pos ? Math.round(pos.y) : Math.round(ch / 4);\n  const id = `text_${Date.now()}_${Math.round(Math.random() * 10000)}`;\n\n  const newLayer = {\n    id,\n    type: 'text' as const,\n    rect: { x, y, w: Math.min(300, cw / 2), h: textProps.fontSize + 20 },\n    opacity: 1,\n    blend: 'source-over' as const,\n    text: textProps.text,\n    font: textProps.font,\n    fontSize: textProps.fontSize,\n    fontWeight: textProps.fontWeight,\n    fontItalic: textProps.fontItalic,\n    textDecoration: textProps.textDecoration,\n    textColor: textProps.textColor,\n    textAlign: textProps.textAlign,\n  } as any;\n\n  setLayers((prev: any) => [...prev, newLayer]);\n  setActiveLayerId(id);\n  setOverlaySelected(true);\n  drawOverlay();\n  message.success('Text layer added');\n};\n\nexport const setLayerText = (setLayers: React.Dispatch<any>, id: string, text: string) =>\n  setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, text } : L)));\n\nexport const setLayerFont = (setLayers: React.Dispatch<any>, id: string, font: string) =>\n  setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, font } : L)));\n\nexport const setLayerFontSize = (setLayers: React.Dispatch<any>, id: string, fontSize: number) =>\n  setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, fontSize } : L)));\n\nexport const setLayerFontWeight = (setLayers: React.Dispatch<any>, id: string, fontWeight: any) =>\n  setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, fontWeight } : L)));\n\nexport const setLayerFontItalic = (\n  setLayers: React.Dispatch<any>,\n  id: string,\n  fontItalic: boolean,\n) => setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, fontItalic } : L)));\n\nexport const setLayerTextDecoration = (\n  setLayers: React.Dispatch<any>,\n  id: string,\n  textDecoration: 'none' | 'underline' | 'line-through',\n) => setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, textDecoration } : L)));\n\nexport const setLayerTextColor = (setLayers: React.Dispatch<any>, id: string, textColor: string) =>\n  setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, textColor } : L)));\n\nexport const setLayerTextAlign = (\n  setLayers: React.Dispatch<any>,\n  id: string,\n  textAlign: 'left' | 'center' | 'right',\n) => setLayers((prev: any) => prev.map((L: any) => (L.id === id ? { ...L, textAlign } : L)));\n","export const drawOverlayHelper = (\n  overlayRef: React.RefObject<HTMLCanvasElement>,\n  canvasRef: React.RefObject<HTMLCanvasElement>,\n  params: {\n    zoom: number;\n    cropRect: { x: number; y: number; w: number; h: number } | null;\n    rulerPoints: { x1: number; y1: number; x2: number; y2: number } | null;\n    perspectivePoints: number[] | null;\n    hoverColor: { x: number; y: number; color: string } | null;\n    tool: any;\n    drawColor: string;\n    drawLineWidth: number;\n    layers: any[];\n    overlaySelected: boolean;\n    activeLayerId?: string | null;\n  },\n) => {\n  if (!overlayRef.current || !canvasRef.current) return;\n  const {\n    zoom,\n    cropRect,\n    rulerPoints,\n    perspectivePoints,\n    hoverColor,\n    tool,\n    drawColor,\n    drawLineWidth,\n    layers,\n    overlaySelected,\n    activeLayerId,\n  } = params;\n\n  const ctx = overlayRef.current.getContext('2d')!;\n  ctx.clearRect(0, 0, overlayRef.current.width, overlayRef.current.height);\n\n  // Crop rectangle\n  if (cropRect) {\n    ctx.save();\n    ctx.strokeStyle = '#00aaff';\n    ctx.lineWidth = 2;\n    ctx.setLineDash([6, 4]);\n    ctx.strokeRect(cropRect.x, cropRect.y, cropRect.w, cropRect.h);\n    ctx.restore();\n  }\n\n  // Ruler\n  if (rulerPoints) {\n    ctx.save();\n    ctx.strokeStyle = '#ffcc00';\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(rulerPoints.x1, rulerPoints.y1);\n    ctx.lineTo(rulerPoints.x2, rulerPoints.y2);\n    ctx.stroke();\n    ctx.restore();\n  }\n\n  // Perspective points\n  if (perspectivePoints) {\n    const p = perspectivePoints;\n    ctx.save();\n    const validPoints: { x: number; y: number }[] = [];\n    for (let i = 0; i < 8; i += 2) {\n      const px = p[i];\n      const py = p[i + 1];\n      if (!isNaN(px) && !isNaN(py)) validPoints.push({ x: px, y: py });\n    }\n\n    if (validPoints.length >= 2) {\n      ctx.strokeStyle = 'rgba(0,255,0,0.9)';\n      ctx.lineWidth = 2;\n      ctx.setLineDash([4, 4]);\n      ctx.beginPath();\n      ctx.moveTo(validPoints[0].x, validPoints[0].y);\n      for (let i = 1; i < validPoints.length; i++) ctx.lineTo(validPoints[i].x, validPoints[i].y);\n      if (validPoints.length === 4) ctx.closePath();\n      ctx.stroke();\n    }\n\n    ctx.fillStyle = 'rgba(0,255,0,0.9)';\n    for (let i = 0; i < 8; i += 2) {\n      const x = p[i];\n      const y = p[i + 1];\n      if (!isNaN(x) && !isNaN(y)) ctx.fillRect(x - 5, y - 5, 10, 10);\n    }\n    ctx.restore();\n  }\n\n  // Color hover\n  if (hoverColor && (tool === 'color' || tool === 'removeColor')) {\n    const rect = canvasRef.current.getBoundingClientRect();\n    const canvasX = (hoverColor.x - rect.left) / zoom;\n    const canvasY = (hoverColor.y - rect.top) / zoom;\n    ctx.save();\n    ctx.strokeStyle = hoverColor.color;\n    ctx.lineWidth = 2 / zoom;\n    ctx.beginPath();\n    ctx.arc(canvasX, canvasY, 8 / zoom, 0, Math.PI * 2);\n    ctx.stroke();\n    ctx.restore();\n  }\n\n  // draw layers\n  for (const L of layers) {\n    try {\n      ctx.save();\n      ctx.globalAlpha = L.opacity;\n      ctx.globalCompositeOperation = L.blend || 'source-over';\n\n      // Apply rotation if specified\n      if (L.rotation && L.rotation !== 0) {\n        const centerX = L.rect.x + L.rect.w / 2;\n        const centerY = L.rect.y + L.rect.h / 2;\n        ctx.translate(centerX, centerY);\n        ctx.rotate((L.rotation * Math.PI) / 180);\n        ctx.translate(-centerX, -centerY);\n      }\n\n      if (L.type === 'image' && L.img) {\n        ctx.drawImage(L.img, L.rect.x, L.rect.y, L.rect.w, L.rect.h);\n      } else if (L.type === 'text') {\n        // Render text layer in overlay\n        const fontStyle = L.fontItalic ? 'italic' : 'normal';\n        const fontWeight = L.fontWeight || 'normal';\n        const fontSize = L.fontSize || 16;\n        ctx.font = `${fontStyle} ${fontWeight} ${fontSize}px ${L.font || 'Arial'}`;\n        ctx.fillStyle = L.textColor || '#000000';\n        ctx.textAlign = L.textAlign || 'left';\n        ctx.textBaseline = 'top';\n\n        const lines = (L.text || '').split('\\n');\n        const lineHeight = fontSize * 1.2;\n        let currentY = L.rect.y;\n        for (const line of lines) {\n          let xPos = L.rect.x;\n          if (L.textAlign === 'center') xPos += L.rect.w / 2;\n          else if (L.textAlign === 'right') xPos += L.rect.w;\n\n          ctx.fillText(line, xPos, currentY);\n\n          // Draw decoration\n          if (L.textDecoration === 'underline') {\n            const metrics = ctx.measureText(line);\n            ctx.strokeStyle = L.textColor || '#000000';\n            ctx.lineWidth = 1;\n            ctx.beginPath();\n            ctx.moveTo(xPos, currentY + fontSize);\n            ctx.lineTo(xPos + metrics.width, currentY + fontSize);\n            ctx.stroke();\n          } else if (L.textDecoration === 'line-through') {\n            const metrics = ctx.measureText(line);\n            ctx.strokeStyle = L.textColor || '#000000';\n            ctx.lineWidth = 1;\n            ctx.beginPath();\n            ctx.moveTo(xPos, currentY + fontSize / 2);\n            ctx.lineTo(xPos + metrics.width, currentY + fontSize / 2);\n            ctx.stroke();\n          }\n          currentY += lineHeight;\n        }\n      }\n      ctx.restore();\n    } catch (err) {\n      // ignore draw errors per layer\n    }\n  }\n\n  // draw selection for active layer on top\n  if (overlaySelected && activeLayerId) {\n    const L = layers.find((x: any) => x.id === activeLayerId);\n    if (L) {\n      const r = L.rect;\n      ctx.save();\n      ctx.globalAlpha = 1;\n      ctx.globalCompositeOperation = 'source-over';\n\n      // Apply rotation to selection outline if layer is rotated\n      if (L.rotation && L.rotation !== 0) {\n        const centerX = r.x + r.w / 2;\n        const centerY = r.y + r.h / 2;\n        ctx.translate(centerX, centerY);\n        ctx.rotate((L.rotation * Math.PI) / 180);\n        ctx.translate(-centerX, -centerY);\n      }\n\n      ctx.strokeStyle = 'rgba(255,165,0,0.95)';\n      ctx.lineWidth = 2;\n      ctx.setLineDash([6, 3]);\n      ctx.strokeRect(r.x, r.y, r.w, r.h);\n      ctx.setLineDash([]);\n      ctx.fillStyle = 'rgba(255,165,0,0.95)';\n      const size = Math.max(6 / Math.max(1, zoom), 6);\n      const half = size / 2;\n\n      // Draw corner handles\n      const corners = [\n        [r.x, r.y],\n        [r.x + r.w, r.y],\n        [r.x, r.y + r.h],\n        [r.x + r.w, r.y + r.h],\n      ];\n      corners.forEach(([cx, cy]) => ctx.fillRect(cx - half, cy - half, size, size));\n\n      // Draw midpoint handles (new feature)\n      ctx.fillStyle = 'rgba(0,180,255,0.95)'; // Different color for midpoints\n      const midpoints = [\n        [r.x + r.w / 2, r.y], // top\n        [r.x + r.w / 2, r.y + r.h], // bottom\n        [r.x, r.y + r.h / 2], // left\n        [r.x + r.w, r.y + r.h / 2], // right\n      ];\n      midpoints.forEach(([mx, my]) => {\n        ctx.fillRect(mx - half, my - half, size, size);\n      });\n\n      ctx.restore();\n    }\n  }\n\n  // draw brush hover\n  if (hoverColor && tool === 'draw') {\n    const rect = canvasRef.current.getBoundingClientRect();\n    const canvasX = (hoverColor.x - rect.left) / zoom;\n    const canvasY = (hoverColor.y - rect.top) / zoom;\n    ctx.save();\n    ctx.strokeStyle = drawColor;\n    ctx.lineWidth = 2 / zoom;\n    ctx.beginPath();\n    ctx.arc(canvasX, canvasY, drawLineWidth / 2, 0, Math.PI * 2);\n    ctx.stroke();\n    ctx.restore();\n  }\n};\n\n// Text editor overlay creation helper\ntype CreateTextEditorParams = {\n  canvasX: number;\n  canvasY: number;\n  canvasRect: DOMRect;\n  containerRef: React.RefObject<HTMLDivElement>;\n  inlineEditorRef: React.MutableRefObject<HTMLTextAreaElement | null>;\n  zoom: number;\n  initial?: string;\n  layerId?: string;\n  layer?: any;\n  textColor?: string;\n  textFont?: string;\n  textFontSize?: number;\n  textWeight?: any;\n  textItalic?: boolean;\n  onCommit: (value: string) => void;\n  onCancel?: () => void;\n};\n\nexport const createTextEditorOverlay = (params: CreateTextEditorParams) => {\n  const {\n    canvasX,\n    canvasY,\n    canvasRect,\n    containerRef,\n    inlineEditorRef,\n    zoom,\n    initial = '',\n    layerId,\n    layer,\n    textColor = '#000',\n    textFont = 'Arial',\n    textFontSize = 16,\n    textWeight = 'normal',\n    textItalic = false,\n    onCommit,\n    onCancel,\n  } = params;\n\n  // remove any existing editor\n  if (inlineEditorRef.current) {\n    inlineEditorRef.current.remove();\n    inlineEditorRef.current = null;\n  }\n\n  const cont = containerRef.current;\n  const contRect = cont ? cont.getBoundingClientRect() : { left: 0, top: 0 };\n  const clientLeft = canvasRect.left + canvasX * zoom;\n  const clientTop = canvasRect.top + canvasY * zoom;\n  const left = clientLeft - contRect.left;\n  const top = clientTop - contRect.top;\n\n  const ta = document.createElement('textarea');\n  ta.value = initial;\n  ta.style.position = 'absolute';\n  ta.style.left = `${left}px`;\n  ta.style.top = `${top}px`;\n  ta.style.zIndex = '10000';\n  ta.style.minWidth = '60px';\n  ta.style.minHeight = '24px';\n  ta.style.background = 'transparent';\n  ta.style.border = '1px dashed rgba(0,0,0,0.4)';\n  ta.style.color = (layer && layer.textColor) || textColor || '#000';\n  ta.style.fontFamily = (layer && layer.font) || textFont || 'Arial';\n  const fontSizeValue = (layer && layer.fontSize) || textFontSize || 16;\n  ta.style.fontSize = `${fontSizeValue * zoom}px`;\n  ta.style.fontWeight = String((layer && layer.fontWeight) || textWeight || 'normal');\n  ta.style.fontStyle = (layer && layer.fontItalic) || textItalic ? 'italic' : 'normal';\n  ta.style.resize = 'both';\n  ta.style.outline = 'none';\n  ta.style.padding = '4px';\n  ta.placeholder = 'Type text and press Enter';\n\n  let commited = false;\n  const doCommit = () => {\n    if (commited) return;\n    commited = Boolean(ta.value) && !Boolean(initial);\n    onCommit(ta.value || '');\n    ta.remove();\n    inlineEditorRef.current = null;\n  };\n\n  const doCancel = () => {\n    ta.remove();\n    inlineEditorRef.current = null;\n    if (onCancel) onCancel();\n  };\n\n  ta.addEventListener('keydown', (ev) => {\n    if (ev.shiftKey && ev.key === 'Enter') return;\n    if (ev.key === 'Enter' && !ev.shiftKey) {\n      ev.preventDefault();\n      doCommit();\n    } else if (ev.key === 'Escape') {\n      ev.preventDefault();\n      doCancel();\n    }\n  });\n\n  ta.addEventListener('blur', () => {\n    doCommit();\n  });\n\n  const appendToContainer = () => {\n    try {\n      if (cont) cont.appendChild(ta);\n      else throw new Error('no container');\n    } catch (err) {\n      console.warn('[DEBUG] append to container failed, will fallback to body', err);\n      appendToBody();\n      return;\n    }\n    inlineEditorRef.current = ta;\n    ta.focus();\n    ta.selectionStart = ta.selectionEnd = ta.value.length;\n    // quick sanity check: if element seems invisible, fallback\n    requestAnimationFrame(() => {\n      try {\n        const r = ta.getBoundingClientRect();\n        if (r.width === 0 && r.height === 0) {\n          console.warn('[DEBUG] appended editor has zero size; falling back to body');\n          ta.remove();\n          appendToBody();\n        }\n      } catch (e) {\n        // ignore\n      }\n    });\n  };\n\n  const appendToBody = () => {\n    const fixedLeft = clientLeft;\n    const fixedTop = clientTop;\n    ta.style.position = 'fixed';\n    ta.style.left = `${fixedLeft}px`;\n    ta.style.top = `${fixedTop}px`;\n    ta.style.zIndex = '200000';\n    document.body.appendChild(ta);\n    inlineEditorRef.current = ta;\n    ta.focus();\n    ta.selectionStart = ta.selectionEnd = ta.value.length;\n    console.log('[DEBUG] appended editor to document.body at', { fixedLeft, fixedTop });\n  };\n\n  // Try append to container first; fallback to body when necessary\n  if (cont) appendToContainer();\n  else appendToBody();\n};\n","import { message } from 'antd';\nimport { perspectiveTransform, createCanvas } from './ImageEditorEngine';\n\nexport const perspectiveApplyHelper = async (\n  canvasRef: React.RefObject<HTMLCanvasElement>,\n  overlayRef: React.RefObject<HTMLCanvasElement>,\n  perspectivePointsRef: React.MutableRefObject<number[] | null>,\n  history: { push: (img: string, label: string) => void },\n  setShowPerspectiveModal: (v: boolean) => void,\n  drawOverlay: () => void,\n) => {\n  if (!canvasRef.current || !perspectivePointsRef.current) {\n    message.warning('No perspective points defined.');\n    return;\n  }\n\n  const p = perspectivePointsRef.current;\n  const srcPoints: [number, number][] = [];\n  for (let i = 0; i < 8; i += 2) {\n    const x = p[i];\n    const y = p[i + 1];\n    if (!isNaN(x) && !isNaN(y)) srcPoints.push([x, y]);\n  }\n\n  if (srcPoints.length !== 4) {\n    message.error('Please select 4 corner points before applying perspective correction.');\n    return;\n  }\n\n  const orderPointsClockwise = (pts: [number, number][]) => {\n    const cx = pts.reduce((s, r) => s + r[0], 0) / pts.length;\n    const cy = pts.reduce((s, r) => s + r[1], 0) / pts.length;\n\n    const sorted = pts\n      .map((pt) => ({ pt, angle: Math.atan2(pt[1] - cy, pt[0] - cx) }))\n      .sort((a, b) => a.angle - b.angle)\n      .map((o) => o.pt as [number, number]);\n\n    let area = 0;\n    for (let i = 0; i < sorted.length; i++) {\n      const [x1, y1] = sorted[i];\n      const [x2, y2] = sorted[(i + 1) % sorted.length];\n      area += x1 * y2 - x2 * y1;\n    }\n    if (area > 0) sorted.reverse();\n\n    let tlIndex = 0;\n    for (let i = 1; i < sorted.length; i++) {\n      if (\n        sorted[i][1] < sorted[tlIndex][1] ||\n        (sorted[i][1] === sorted[tlIndex][1] && sorted[i][0] < sorted[tlIndex][0])\n      ) {\n        tlIndex = i;\n      }\n    }\n    return Array.from(\n      { length: sorted.length },\n      (_, i) => sorted[(tlIndex + i) % sorted.length],\n    ) as any;\n  };\n\n  try {\n    const ordered = orderPointsClockwise(srcPoints);\n    const srcFlat: [number, number, number, number, number, number, number, number] = [\n      Math.round(ordered[0][0]),\n      Math.round(ordered[0][1]),\n      Math.round(ordered[1][0]),\n      Math.round(ordered[1][1]),\n      Math.round(ordered[2][0]),\n      Math.round(ordered[2][1]),\n      Math.round(ordered[3][0]),\n      Math.round(ordered[3][1]),\n    ];\n\n    const destCanvas = perspectiveTransform(\n      canvasRef.current!,\n      srcFlat,\n      canvasRef.current!.width,\n      canvasRef.current!.height,\n    );\n\n    canvasRef.current.width = destCanvas.width;\n    canvasRef.current.height = destCanvas.height;\n    overlayRef.current!.width = destCanvas.width;\n    overlayRef.current!.height = destCanvas.height;\n\n    const ctx = canvasRef.current.getContext('2d')!;\n    ctx.clearRect(0, 0, destCanvas.width, destCanvas.height);\n    ctx.drawImage(destCanvas, 0, 0);\n\n    history.push(canvasRef.current.toDataURL(), 'Perspective corrected');\n\n    perspectivePointsRef.current = null;\n    setShowPerspectiveModal(false);\n    drawOverlay();\n    message.success('Perspective correction applied.');\n  } catch (err) {\n    console.error('Perspective transform failed', err);\n    message.error('Failed to apply perspective correction.');\n  }\n};\n","import { message } from 'antd';\nimport { applyConvolution, Kernels, createCanvas } from './ImageEditorEngine';\n\nexport type UpscaleQualityOptions = {\n  sharpen?: number; // 0-100\n  edgeEnhancement?: number; // 0-100\n  denoise?: number; // 0-100\n};\n\n/**\n * Upscale a canvas progressively and optionally apply quality enhancements.\n * - `scale` can be a number >= 1 (e.g. 2, 3, 4 or 1.5)\n * - `preset` controls imageSmoothingQuality ('low' | 'medium' | 'high')\n * - `qualityOptions` controls post-upscale enhancements (sharpen, edge, denoise)\n */\nexport const upscaleCanvas = async (\n  srcCanvas: HTMLCanvasElement,\n  scale: number,\n  preset?: 'low' | 'medium' | 'high',\n  qualityOptions?: UpscaleQualityOptions,\n) => {\n  if (!srcCanvas || scale <= 1) return srcCanvas;\n\n  // progressive upscaling in steps (max 2x per step) to reduce artifacts\n  let tmp: HTMLCanvasElement = srcCanvas;\n  const targetScale = scale;\n  let currentScale = 1;\n\n  while (currentScale < targetScale) {\n    const step = Math.min(2, targetScale / currentScale);\n    const nextW = Math.max(1, Math.round(tmp.width * step));\n    const nextH = Math.max(1, Math.round(tmp.height * step));\n    const dest = createCanvas(nextW, nextH);\n    const dctx = dest.getContext('2d')!;\n    dctx.imageSmoothingEnabled = true;\n    // @ts-ignore - lib.dom types allow 'low'|'medium'|'high' but be defensive\n    dctx.imageSmoothingQuality = preset;\n    dctx.clearRect(0, 0, nextW, nextH);\n    dctx.drawImage(tmp, 0, 0, tmp.width, tmp.height, 0, 0, nextW, nextH);\n    tmp = dest;\n    currentScale *= step;\n    // yield to event loop to keep UI responsive for large upscales\n    // eslint-disable-next-line no-await-in-loop\n    await new Promise((r) => setTimeout(r, 0));\n  }\n\n  // Apply quality enhancements if specified\n  if (\n    qualityOptions &&\n    (qualityOptions.sharpen || qualityOptions.edgeEnhancement || qualityOptions.denoise)\n  ) {\n    const ctx = tmp.getContext('2d')!;\n    const imageData = ctx.getImageData(0, 0, tmp.width, tmp.height);\n\n    // Apply denoise first (blur to reduce noise)\n    if (qualityOptions.denoise && qualityOptions.denoise > 0) {\n      const denoiseStrength = qualityOptions.denoise / 100;\n      const blurKernel = Kernels.gaussian5;\n      const iterations = Math.ceil(denoiseStrength * 2);\n      for (let i = 0; i < iterations; i++) {\n        applyConvolution(imageData, blurKernel, 5);\n      }\n    }\n\n    // Apply edge enhancement (unsharp mask variation)\n    if (qualityOptions.edgeEnhancement && qualityOptions.edgeEnhancement > 0) {\n      const edgeStrength = qualityOptions.edgeEnhancement / 100;\n      const edgeKernel = [\n        0,\n        -1 * edgeStrength,\n        0,\n        -1 * edgeStrength,\n        1 + 4 * edgeStrength,\n        -1 * edgeStrength,\n        0,\n        -1 * edgeStrength,\n        0,\n      ];\n      applyConvolution(imageData, edgeKernel, 3);\n    }\n\n    // Apply sharpening\n    if (qualityOptions.sharpen && qualityOptions.sharpen > 0) {\n      const sharpenStrength = qualityOptions.sharpen / 100;\n      const iterations = Math.ceil(sharpenStrength * 3);\n      for (let i = 0; i < iterations; i++) {\n        applyConvolution(imageData, Kernels.sharpen, 3);\n      }\n    }\n\n    ctx.putImageData(imageData, 0, 0);\n  }\n\n  return tmp;\n};\n\n/**\n * High-level helper: upscale the visible canvas, replace working canvas and baseCanvas,\n * update base overlay layer, and enable upscaledMode.\n * This encapsulates the safe Image.onload swap used by the editor.\n */\nexport const applyUpscale = async (\n  canvasRef: React.RefObject<HTMLCanvasElement>,\n  overlayRef: React.RefObject<HTMLCanvasElement>,\n  history: any,\n  setBaseCanvas: (c: HTMLCanvasElement) => void,\n  setLayers: React.Dispatch<any>,\n  drawOverlay: () => void,\n  factor: number,\n  preset?: 'low' | 'medium' | 'high',\n  qualityOptions?: UpscaleQualityOptions,\n) => {\n  if (!canvasRef.current) return;\n  try {\n    const newCanvas = await upscaleCanvas(canvasRef.current, factor, preset, qualityOptions);\n    if (!newCanvas) return;\n\n    const dataUrl = newCanvas.toDataURL();\n    const img = new Image();\n    // temporarily hide overlay while swapping to avoid covering canvas with an unloaded image\n    const prevDisplay = overlayRef.current ? overlayRef.current.style.display : '';\n    if (overlayRef.current) overlayRef.current.style.display = 'none';\n\n    img.onload = () => {\n      try {\n        const c2 = document.createElement('canvas');\n        c2.width = img.naturalWidth;\n        c2.height = img.naturalHeight;\n        const c2ctx = c2.getContext('2d')!;\n        c2ctx.drawImage(img, 0, 0);\n        try {\n          setBaseCanvas(c2);\n        } catch (_e) {}\n\n        // replace working canvas\n        canvasRef.current!.width = c2.width;\n        canvasRef.current!.height = c2.height;\n        if (overlayRef.current) {\n          overlayRef.current.width = c2.width;\n          overlayRef.current.height = c2.height;\n        }\n        const ctx = canvasRef.current!.getContext('2d')!;\n        ctx.clearRect(0, 0, c2.width, c2.height);\n        ctx.drawImage(img, 0, 0);\n\n        // push history after successful draw\n        history.push(canvasRef.current!.toDataURL(), `Upscaled ${factor}x`);\n\n        // set base overlay opacity to 1 and enable syncing mode, and update base overlay image src\n        setLayers((prev) => {\n          if (!prev[0]) return prev;\n          const copy = prev.slice();\n          const base = { ...(copy[0] as any) } as any;\n          // base.opacity = 1;\n          if (base.img) base.img.src = dataUrl;\n          base.rect = { x: 0, y: 0, w: c2.width, h: c2.height };\n          copy[0] = base;\n          return copy;\n        });\n\n        // restore overlay display and redraw\n        if (overlayRef.current) overlayRef.current.style.display = prevDisplay || '';\n        drawOverlay();\n        message.success(`Upscaled ${factor}x`);\n      } catch (err) {\n        console.error('Failed to finalize upscale draw', err);\n        if (overlayRef.current) overlayRef.current.style.display = prevDisplay || '';\n        message.error('Upscale failed to render');\n      }\n    };\n    img.onerror = (e) => {\n      if (overlayRef.current) overlayRef.current.style.display = prevDisplay || '';\n      console.error('Upscaled image failed to load', e);\n      message.error('Upscaled image failed to load');\n    };\n    img.src = dataUrl;\n  } catch (err) {\n    console.error('Upscale failed', err);\n    message.error('Upscale failed');\n  }\n};\n","import {\n  applyBrightnessContrast,\n  applyConvolution,\n  applyDehaze,\n  applyHslAdjustments,\n  applyThresholdAlpha,\n  applyThresholdAlphaBlack,\n  applyToneAdjustments,\n  applyVibranceSaturation,\n  cloneImageData,\n  Kernels,\n} from './ImageEditorEngine';\n\n// Store previous effects to detect changes\nlet previousEffects = {\n  // Convolution / blur effects\n  blur: 0,\n  gaussian: 0,\n  sharpen: 0,\n  texture: 0,\n  clarity: 0,\n\n  // Threshold\n  bgThreshold: 0,\n  bgThresholdBlack: 0,\n\n  // Brightness / contrast\n  brightness: 0,\n  contrast: 0,\n\n  // Tone adjustments\n  highlights: 0,\n  shadows: 0,\n  whites: 0,\n  blacks: 0,\n  vibrance: 0,\n  saturation: 0,\n  dehaze: 0,\n\n  // HSL adjustments (per-color)\n  hslAdjustments: {} as Record<string, { h?: number; s?: number; l?: number }>,\n};\n\n//cache the base image once\nlet cachedBaseImageData: ImageData | null = null;\n\nexport const applyEffects = (\n  canvasRef: React.RefObject<HTMLCanvasElement>,\n  baseCanvas: HTMLCanvasElement | null | undefined,\n  {\n    blur = 0,\n    gaussian = 0,\n    sharpen = 0,\n    bgThreshold = 0,\n    bgThresholdBlack = 0,\n    brightness = 0,\n    contrast = 0,\n    texture = 0,\n    clarity = 0,\n    highlights = 0,\n    shadows = 0,\n    whites = 0,\n    blacks = 0,\n    vibrance = 0,\n    saturation = 0,\n    dehaze = 0,\n    hslAdjustments = {} as Record<string, { h?: number; s?: number; l?: number }>,\n  },\n  history: { push: (img: string, label: string, isSetBase: boolean) => void },\n  setHistogramData,\n) => {\n  if (!canvasRef.current || !baseCanvas) return;\n\n  const ctx = canvasRef.current.getContext('2d')!;\n  const baseCtx = baseCanvas.getContext('2d')!;\n\n  const BaseImageData = baseCtx.getImageData(0, 0, baseCanvas.width, baseCanvas.height);\n\n  // cache original image data once\n  if (!cachedBaseImageData) cachedBaseImageData = BaseImageData;\n  if (!cachedBaseImageData) return;\n\n  let cloned = cloneImageData(BaseImageData);\n\n  // Early exit if no effects\n  if (\n    blur === 0 &&\n    gaussian === 0 &&\n    sharpen === 0 &&\n    texture === 0 &&\n    clarity === 0 &&\n    bgThreshold === 0 &&\n    bgThresholdBlack === 0 &&\n    brightness === 0 &&\n    contrast === 0 &&\n    highlights === 0 &&\n    shadows === 0 &&\n    whites === 0 &&\n    blacks === 0 &&\n    vibrance === 0 &&\n    saturation === 0 &&\n    dehaze === 0 &&\n    Object.keys(hslAdjustments).length === 0\n  ) {\n    ctx.putImageData(cloned, 0, 0);\n\n    if (canvasRef.current) {\n      const extracted = extractRGBHistogram(canvasRef.current);\n      setHistogramData(extracted);\n    }\n    return;\n  }\n\n  // Apply convolution effects\n  if (blur > 0) {\n    const size = blur % 2 === 0 ? blur + 1 : blur;\n    applyConvolution(cloned, Kernels.generateBoxBlurKernel(size), size);\n  }\n  if (gaussian > 0) {\n    const r = gaussian;\n    applyConvolution(cloned, Kernels.generateGaussianKernel(r), r * 2 + 1);\n  }\n  if (sharpen > 0) {\n    const kernel = Kernels.sharpen.map((v) =>\n      v === 5 ? 1 + sharpen * 4 : v === -1 ? -sharpen : v,\n    );\n    applyConvolution(cloned, kernel, 3);\n  }\n  if (texture !== 0) {\n    // Texture: -100 = extreme blur, 0 = no effect, +100 = extreme sharpening\n    // At 0, no effect should be visible\n    const strength = texture / 100; // -1 to +1\n    const center = 1 + strength * 8; // -7 to 9\n    const edge = -strength * 2; // 2 to -2\n    const detailKernel = [0, edge, 0, edge, center, edge, 0, edge, 0];\n    applyConvolution(cloned, detailKernel, 3);\n  }\n  if (clarity !== 0) {\n    // Clarity: -100 = soft/blurry, 0 = no effect, +100 = clear/sharp\n    const strength = clarity / 100; // -1 to +1\n    const center = 1 + strength * 10; // -9 to 11\n    const edge = -strength * 2.5; // 2.5 to -2.5\n    const midtoneKernel = [0, edge, 0, edge, center, edge, 0, edge, 0];\n    applyConvolution(cloned, midtoneKernel, 3);\n  }\n\n  // Threshold effects\n  if (bgThreshold > 0) applyThresholdAlpha(cloned, bgThreshold);\n  if (bgThresholdBlack > 0) applyThresholdAlphaBlack(cloned, bgThresholdBlack);\n\n  // Brightness/Contrast\n  if (brightness !== 0 || contrast !== 0) applyBrightnessContrast(cloned, brightness, contrast);\n\n  // Tone adjustments (highlights, shadows, whites, blacks, vibrance, saturation, dehaze)\n  if (\n    highlights !== 0 ||\n    shadows !== 0 ||\n    whites !== 0 ||\n    blacks !== 0 ||\n    vibrance !== 0 ||\n    saturation !== 0 ||\n    dehaze !== 0\n  ) {\n    const d = cloned.data;\n    for (let i = 0; i < d.length; i += 4) {\n      if (dehaze) applyDehaze(d, i, dehaze);\n      if (vibrance || saturation) applyVibranceSaturation(d, i, { vibrance, saturation });\n    }\n    applyToneAdjustments(cloned, {\n      highlights,\n      shadows,\n      whites,\n      blacks,\n      vibrance,\n      saturation,\n      clarity,\n      dehaze,\n    });\n  }\n\n  // HSL / Color mixer\n  if (Object.keys(hslAdjustments).length > 0) applyHslAdjustments(cloned, hslAdjustments);\n\n  // Draw final image\n  ctx.putImageData(cloned, 0, 0);\n\n  // Detect changes for history\n  const changedEffects = Object.entries({\n    blur,\n    gaussian,\n    sharpen,\n    texture,\n    clarity,\n    bgThreshold,\n    bgThresholdBlack,\n    brightness,\n    contrast,\n    highlights,\n    shadows,\n    whites,\n    blacks,\n    vibrance,\n    saturation,\n    dehaze,\n    hslAdjustments,\n  }).filter(([key, value]) => previousEffects[key] !== value);\n\n  if (changedEffects.length > 0) {\n    const historyLabel = changedEffects\n      .map(([key, value]) => `${key}=${JSON.stringify(value)}`)\n      .join(', ');\n    history.push(canvasRef.current.toDataURL(), `${historyLabel}`, false);\n    previousEffects = {\n      blur,\n      gaussian,\n      sharpen,\n      texture,\n      clarity,\n      bgThreshold,\n      bgThresholdBlack,\n      brightness,\n      contrast,\n      highlights,\n      shadows,\n      whites,\n      blacks,\n      vibrance,\n      saturation,\n      dehaze,\n      hslAdjustments,\n    };\n  }\n\n  if (canvasRef.current) {\n    const extracted = extractRGBHistogram(canvasRef.current);\n    setHistogramData(extracted);\n  }\n};\n\nexport const resetEffectsToBase = (\n  canvasRef: React.RefObject<HTMLCanvasElement>,\n  baseCanvas: HTMLCanvasElement | null | undefined,\n  history: { push: (img: string, label: string) => void },\n) => {\n  if (!canvasRef.current || !baseCanvas || !cachedBaseImageData) return;\n\n  const ctx = canvasRef.current.getContext('2d')!;\n  ctx.putImageData(cachedBaseImageData, 0, 0);\n\n  // Reset previous effects so history won't re-detect old ones\n  previousEffects = {\n    blur: 0,\n    gaussian: 0,\n    sharpen: 0,\n    texture: 0,\n    clarity: 0,\n    bgThreshold: 0,\n    bgThresholdBlack: 0,\n    brightness: 0,\n    contrast: 0,\n    highlights: 0,\n    shadows: 0,\n    whites: 0,\n    blacks: 0,\n    vibrance: 0,\n    saturation: 0,\n    dehaze: 0,\n    hslAdjustments: {},\n  };\n\n  // Add to history\n  history.push(canvasRef.current.toDataURL(), 'Reset to base image');\n};\n\nexport const extractRGBHistogram = (canvas: HTMLCanvasElement | null) => {\n  if (!canvas)\n    return { red: Array(256).fill(0), green: Array(256).fill(0), blue: Array(256).fill(0) };\n\n  const ctx = canvas.getContext('2d');\n  if (!ctx) return { red: Array(256).fill(0), green: Array(256).fill(0), blue: Array(256).fill(0) };\n\n  const { width, height } = canvas;\n  const { data } = ctx.getImageData(0, 0, width, height);\n\n  const red = Array(256).fill(0);\n  const green = Array(256).fill(0);\n  const blue = Array(256).fill(0);\n\n  for (let i = 0; i < data.length; i += 4) {\n    red[data[i]]++; // count R value\n    green[data[i + 1]]++; // count G value\n    blue[data[i + 2]]++; // count B value\n  }\n\n  return { red, green, blue };\n};\n\nexport const applyInvertColors = (\n  canvasRef: React.RefObject<HTMLCanvasElement>,\n  history: { push: (img: string, label: string, isSetBase: boolean) => void },\n) => {\n  if (!canvasRef.current) return;\n\n  const canvas = canvasRef.current;\n  const ctx = canvas.getContext('2d')!;\n  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n  const data = imageData.data;\n\n  // Invert each RGB channel (keep alpha unchanged)\n  for (let i = 0; i < data.length; i += 4) {\n    data[i] = 255 - data[i]; // Red\n    data[i + 1] = 255 - data[i + 1]; // Green\n    data[i + 2] = 255 - data[i + 2]; // Blue\n    // data[i + 3] stays the same (Alpha)\n  }\n\n  ctx.putImageData(imageData, 0, 0);\n  history.push(canvas.toDataURL(), 'Invert colors', false);\n};\n\nexport const applyColorRemoval = (\n  canvasRef: React.RefObject<HTMLCanvasElement>,\n  targetColor: string,\n  tolerance: number,\n  history: { push: (img: string, label: string, isSetBase: boolean) => void },\n  invert: boolean = false,\n  feather: number = 0,\n) => {\n  if (!canvasRef.current) return;\n\n  const canvas = canvasRef.current;\n  const ctx = canvas.getContext('2d')!;\n  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n  const data = imageData.data;\n\n  // Parse target color\n  const hex = targetColor.replace('#', '');\n  const targetR = parseInt(hex.substring(0, 2), 16);\n  const targetG = parseInt(hex.substring(2, 4), 16);\n  const targetB = parseInt(hex.substring(4, 6), 16);\n\n  // First pass: calculate alpha values based on color distance\n  const alphaMap = new Uint8Array(data.length / 4);\n  for (let i = 0; i < data.length; i += 4) {\n    const r = data[i];\n    const g = data[i + 1];\n    const b = data[i + 2];\n\n    // Calculate color distance\n    const distance = Math.sqrt(\n      Math.pow(r - targetR, 2) + Math.pow(g - targetG, 2) + Math.pow(b - targetB, 2),\n    );\n\n    const maxDistance = Math.sqrt(255 * 255 * 3);\n    const normalizedDistance = distance / maxDistance;\n    const threshold = tolerance / 100;\n\n    // Calculate base alpha (0 = remove, 1 = keep)\n    let baseAlpha;\n\n    if (feather === 0) {\n      // No feathering - hard edge\n      baseAlpha = normalizedDistance <= threshold ? 0 : 1;\n    } else {\n      // Apply feathering - create gradient around the threshold boundary\n      // Higher feather = wider gradient range around the edge\n      const featherRange = feather / 100;\n      const distanceFromThreshold = normalizedDistance - threshold;\n\n      if (distanceFromThreshold < -featherRange) {\n        // Far inside selection - fully removed (black in mask)\n        baseAlpha = 0;\n      } else if (distanceFromThreshold > featherRange) {\n        // Far outside selection - fully kept (white in mask)\n        baseAlpha = 1;\n      } else {\n        // In feather zone - smooth gradient from 0 to 1\n        baseAlpha = (distanceFromThreshold + featherRange) / (featherRange * 2);\n      }\n    }\n\n    // Apply invert\n    if (invert) {\n      baseAlpha = 1 - baseAlpha;\n    }\n\n    alphaMap[i / 4] = Math.round(baseAlpha * 255);\n  }\n\n  // Second pass: apply alpha values\n  for (let i = 0; i < data.length; i += 4) {\n    data[i + 3] = alphaMap[i / 4];\n  }\n\n  ctx.putImageData(imageData, 0, 0);\n  const label = invert\n    ? `Keep color ${targetColor} (tolerance: ${tolerance}%, feather: ${feather}%)`\n    : `Remove color ${targetColor} (tolerance: ${tolerance}%, feather: ${feather}%)`;\n  history.push(canvas.toDataURL(), label, false);\n};\n","// src/components/ImageCanvas.tsx\nimport React from 'react';\n\ntype HoverColor = {\n  x: number;\n  y: number;\n  color: string;\n};\n\ntype ImageCanvasProps = {\n  canvasRef: React.RefObject<HTMLCanvasElement>;\n  overlayRef: React.RefObject<HTMLCanvasElement>;\n  containerRef: React.RefObject<HTMLDivElement>;\n  offset: { x: number; y: number };\n  zoom: number;\n  tool: string;\n  currentCursor: string;\n  hoverColor: HoverColor | null;\n  resolution?: string | null;\n  onMouseDown: (e: React.MouseEvent) => void;\n  onMouseMove: (e: React.MouseEvent) => void;\n  onMouseUp: () => void;\n};\n\nconst ImageCanvas: React.FC<ImageCanvasProps> = ({\n  canvasRef,\n  overlayRef,\n  containerRef,\n  offset,\n  zoom,\n  tool,\n  currentCursor,\n  hoverColor,\n  resolution,\n  onMouseDown,\n  onMouseMove,\n  onMouseUp,\n}) => {\n  return (\n    <div\n      ref={containerRef}\n      onMouseDown={onMouseDown}\n      onMouseMove={onMouseMove}\n      onMouseUp={onMouseUp}\n      style={{\n        width: '100%',\n        height: '100vh',\n        overflow: 'hidden',\n        border: '1px solid #eee',\n        position: 'relative',\n        background: '#fafafa',\n        cursor: currentCursor,\n      }}\n    >\n      {resolution && (\n        <div\n          style={{\n            position: 'absolute',\n            right: 12,\n            top: 12,\n            background: 'rgba(0,0,0,0.6)',\n            color: '#fff',\n            padding: '4px 8px',\n            borderRadius: 4,\n            fontSize: 12,\n            zIndex: 99999,\n            pointerEvents: 'none',\n          }}\n        >\n          {resolution}\n        </div>\n      )}\n      <div\n        style={{\n          position: 'absolute',\n          top: 0,\n          left: 0,\n          width: '100%',\n          height: '100%',\n          overflow: 'hidden',\n        }}\n      >\n        <canvas\n          ref={canvasRef}\n          style={{\n            transform: `translate(${offset.x}px, ${offset.y}px) scale(${zoom})`,\n            transformOrigin: 'top left',\n            display: 'block',\n          }}\n        />\n        <canvas\n          ref={overlayRef}\n          style={{\n            position: 'absolute',\n            left: 0,\n            top: 0,\n            pointerEvents: 'none',\n            transform: `translate(${offset.x}px, ${offset.y}px) scale(${zoom})`,\n            transformOrigin: 'top left',\n          }}\n        />\n      </div>\n      {/* Drag & drop support: dropped images become overlay images (onAddImage) */}\n      {hoverColor && tool === 'color' && (\n        <div\n          style={{\n            position: 'fixed', // use fixed to position relative to viewport\n            left: hoverColor.x + 12,\n            top: hoverColor.y + 12,\n            background: '#fff',\n            padding: '4px 8px',\n            borderRadius: 4,\n            boxShadow: '0 0 6px rgba(0,0,0,0.2)',\n            fontSize: 12,\n            zIndex: 999999,\n            pointerEvents: 'none',\n            display: 'flex',\n            alignItems: 'center',\n            gap: 6,\n          }}\n        >\n          <span\n            style={{\n              display: 'inline-block',\n              width: 12,\n              height: 12,\n              background: hoverColor.color,\n              border: '1px solid #ccc',\n            }}\n          />\n          {hoverColor.color}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ImageCanvas;\n","import React, { useEffect, useState, useRef } from 'react';\nimport { Modal, Slider, Radio, Space, Button } from 'antd';\n\ntype ColorRemovalModalProps = {\n  open: boolean;\n  onCancel: () => void;\n  onApply: (tolerance: number, invert: boolean, feather: number) => void;\n  selectedColor: string | null;\n  canvasRef: React.RefObject<HTMLCanvasElement>;\n};\n\nconst ColorRemovalModal: React.FC<ColorRemovalModalProps> = ({\n  open,\n  onCancel,\n  onApply,\n  selectedColor,\n  canvasRef,\n}) => {\n  const [tolerance, setTolerance] = useState(30);\n  const [previewMode, setPreviewMode] = useState<'normal' | 'mask'>('normal');\n  const [invert, setInvert] = useState(false);\n  const [feather, setFeather] = useState(0);\n  const previewCanvasRef = useRef<HTMLCanvasElement>(null);\n\n  // Update preview when tolerance or mode changes\n  useEffect(() => {\n    if (!open || !canvasRef.current || !selectedColor || !previewCanvasRef.current) return;\n\n    const sourceCanvas = canvasRef.current;\n    const previewCanvas = previewCanvasRef.current;\n    const ctx = previewCanvas.getContext('2d')!;\n\n    // Set preview canvas size to match source\n    previewCanvas.width = sourceCanvas.width;\n    previewCanvas.height = sourceCanvas.height;\n\n    // Get source image data\n    const sourceCtx = sourceCanvas.getContext('2d')!;\n    const imageData = sourceCtx.getImageData(0, 0, sourceCanvas.width, sourceCanvas.height);\n    const data = imageData.data;\n\n    // Parse selected color\n    const hex = selectedColor.replace('#', '');\n    const targetR = parseInt(hex.substring(0, 2), 16);\n    const targetG = parseInt(hex.substring(2, 4), 16);\n    const targetB = parseInt(hex.substring(4, 6), 16);\n\n    // First pass: calculate alpha values based on color distance\n    const alphaMap = new Uint8Array(data.length / 4);\n    for (let i = 0; i < data.length; i += 4) {\n      const r = data[i];\n      const g = data[i + 1];\n      const b = data[i + 2];\n\n      // Calculate color distance\n      const distance = Math.sqrt(\n        Math.pow(r - targetR, 2) + Math.pow(g - targetG, 2) + Math.pow(b - targetB, 2),\n      );\n\n      const maxDistance = Math.sqrt(255 * 255 * 3);\n      const normalizedDistance = distance / maxDistance;\n      const threshold = tolerance / 100;\n\n      // Calculate base alpha (0 = remove, 1 = keep)\n      let baseAlpha;\n\n      if (feather === 0) {\n        // No feathering - hard edge\n        baseAlpha = normalizedDistance <= threshold ? 0 : 1;\n      } else {\n        // Apply feathering - create gradient around the threshold boundary\n        // Higher feather = wider gradient range around the edge\n        const featherRange = feather / 100;\n        const distanceFromThreshold = normalizedDistance - threshold;\n\n        if (distanceFromThreshold < -featherRange) {\n          // Far inside selection - fully removed (black in mask)\n          baseAlpha = 0;\n        } else if (distanceFromThreshold > featherRange) {\n          // Far outside selection - fully kept (white in mask)\n          baseAlpha = 1;\n        } else {\n          // In feather zone - smooth gradient from 0 to 1\n          baseAlpha = (distanceFromThreshold + featherRange) / (featherRange * 2);\n        }\n      }\n\n      // Apply invert\n      if (invert) {\n        baseAlpha = 1 - baseAlpha;\n      }\n\n      alphaMap[i / 4] = Math.round(baseAlpha * 255);\n    }\n\n    // Second pass: apply visual effects\n    for (let i = 0; i < data.length; i += 4) {\n      const pixelAlpha = alphaMap[i / 4];\n\n      if (previewMode === 'mask') {\n        // Black and white preview\n        if (pixelAlpha === 0) {\n          // Will be removed - show black\n          data[i] = 0;\n          data[i + 1] = 0;\n          data[i + 2] = 0;\n          data[i + 3] = 255;\n        } else if (pixelAlpha === 255) {\n          // Will be kept - show white\n          data[i] = 255;\n          data[i + 1] = 255;\n          data[i + 2] = 255;\n          data[i + 3] = 255;\n        } else {\n          // Feather zone - show gray\n          data[i] = pixelAlpha;\n          data[i + 1] = pixelAlpha;\n          data[i + 2] = pixelAlpha;\n          data[i + 3] = 255;\n        }\n      } else {\n        // Normal preview: apply calculated alpha\n        data[i + 3] = pixelAlpha;\n      }\n    }\n\n    ctx.putImageData(imageData, 0, 0);\n  }, [open, tolerance, previewMode, selectedColor, canvasRef, invert, feather]);\n\n  const handleApply = () => {\n    onApply(tolerance, invert, feather);\n  };\n\n  return (\n    <Modal\n      title=\"Remove Color\"\n      open={open}\n      onCancel={onCancel}\n      onOk={handleApply}\n      width={Math.min(\n        canvasRef.current?.width ? canvasRef.current.width + 100 : 800,\n        window.innerWidth * 0.9,\n      )}\n      okText=\"Apply\"\n      cancelText=\"Cancel\"\n    >\n      <Space direction=\"vertical\" style={{ width: '100%' }} size=\"large\">\n        <div>\n          <div style={{ marginBottom: 8 }}>\n            <strong>Selected Color:</strong>{' '}\n            <span\n              style={{\n                display: 'inline-block',\n                width: 24,\n                height: 24,\n                background: selectedColor || '#000',\n                border: '1px solid #ccc',\n                verticalAlign: 'middle',\n                marginLeft: 8,\n              }}\n            />\n            <span style={{ marginLeft: 8 }}>{selectedColor}</span>\n          </div>\n        </div>\n\n        <div>\n          <div style={{ marginBottom: 8 }}>\n            <strong>Tolerance:</strong> {tolerance}%\n          </div>\n          <Slider\n            min={0}\n            max={100}\n            value={tolerance}\n            onChange={setTolerance}\n            tooltip={{ formatter: (value) => `${value}%` }}\n          />\n          <div style={{ fontSize: 12, color: '#666', marginTop: 4 }}>\n            Adjust how similar colors will be removed (0 = exact match, 100 = all colors)\n          </div>\n        </div>\n\n        <div>\n          <div style={{ marginBottom: 8 }}>\n            <strong>Feather:</strong> {feather}%\n          </div>\n          <Slider\n            min={0}\n            max={50}\n            value={feather}\n            onChange={setFeather}\n            tooltip={{ formatter: (value) => `${value}%` }}\n          />\n          <div style={{ fontSize: 12, color: '#666', marginTop: 4 }}>\n            Soften the edge transition (0 = hard edge, 50 = very soft)\n          </div>\n        </div>\n\n        <div>\n          <div style={{ marginBottom: 8 }}>\n            <strong>Invert Selection:</strong>\n          </div>\n          <Radio.Group value={invert} onChange={(e) => setInvert(e.target.value)}>\n            <Radio.Button value={false}>Normal</Radio.Button>\n            <Radio.Button value={true}>Inverted</Radio.Button>\n          </Radio.Group>\n          <div style={{ fontSize: 12, color: '#666', marginTop: 4 }}>\n            {invert ? 'Remove everything EXCEPT the selected color' : 'Remove the selected color'}\n          </div>\n        </div>\n\n        <div>\n          <div style={{ marginBottom: 8 }}>\n            <strong>Preview Mode:</strong>\n          </div>\n          <Radio.Group value={previewMode} onChange={(e) => setPreviewMode(e.target.value)}>\n            <Radio.Button value=\"normal\">Normal</Radio.Button>\n            <Radio.Button value=\"mask\">Black & White Mask</Radio.Button>\n          </Radio.Group>\n          <div style={{ fontSize: 12, color: '#666', marginTop: 4 }}>\n            {previewMode === 'normal'\n              ? 'Shows how the final image will look'\n              : 'Black = removed area, White = kept area'}\n          </div>\n        </div>\n\n        <div\n          style={{\n            maxHeight: '60vh',\n            overflow: 'auto',\n            border: '1px solid #d9d9d9',\n            borderRadius: 4,\n            padding: 8,\n            backgroundImage:\n              previewMode === 'normal'\n                ? `linear-gradient(45deg, #ccc 25%, transparent 25%),\n                   linear-gradient(-45deg, #ccc 25%, transparent 25%),\n                   linear-gradient(45deg, transparent 75%, #ccc 75%),\n                   linear-gradient(-45deg, transparent 75%, #ccc 75%)`\n                : 'none',\n            backgroundSize: previewMode === 'normal' ? '20px 20px' : 'auto',\n            backgroundPosition:\n              previewMode === 'normal' ? '0 0, 0 10px, 10px -10px, -10px 0px' : 'auto',\n            backgroundColor: previewMode === 'normal' ? '#fff' : '#fff',\n          }}\n        >\n          <canvas\n            ref={previewCanvasRef}\n            style={{\n              maxWidth: '100%',\n              height: 'auto',\n              display: 'block',\n              imageRendering: 'pixelated',\n            }}\n          />\n        </div>\n      </Space>\n    </Modal>\n  );\n};\n\nexport default ColorRemovalModal;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport RotateLeftOutlinedSvg from \"@ant-design/icons-svg/es/asn/RotateLeftOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar RotateLeftOutlined = function RotateLeftOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: RotateLeftOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(RotateLeftOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'RotateLeftOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar ScissorOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M567.1 512l318.5-319.3c5-5 1.5-13.7-5.6-13.7h-90.5c-2.1 0-4.2.8-5.6 2.3l-273.3 274-90.2-90.5c12.5-22.1 19.7-47.6 19.7-74.8 0-83.9-68.1-152-152-152s-152 68.1-152 152 68.1 152 152 152c27.7 0 53.6-7.4 75.9-20.3l90 90.3-90.1 90.3A151.04 151.04 0 00288 582c-83.9 0-152 68.1-152 152s68.1 152 152 152 152-68.1 152-152c0-27.2-7.2-52.7-19.7-74.8l90.2-90.5 273.3 274c1.5 1.5 3.5 2.3 5.6 2.3H880c7.1 0 10.7-8.6 5.6-13.7L567.1 512zM288 370c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80zm0 444c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z\" } }] }, \"name\": \"scissor\", \"theme\": \"outlined\" };\nexport default ScissorOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport ScissorOutlinedSvg from \"@ant-design/icons-svg/es/asn/ScissorOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar ScissorOutlined = function ScissorOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: ScissorOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(ScissorOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'ScissorOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar ExportOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"fill-rule\": \"evenodd\", \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z\" } }] }, \"name\": \"export\", \"theme\": \"outlined\" };\nexport default ExportOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport ExportOutlinedSvg from \"@ant-design/icons-svg/es/asn/ExportOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar ExportOutlined = function ExportOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: ExportOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(ExportOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'ExportOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar BorderInnerOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M872 476H548V144h-72v332H152c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h324v332h72V548h324c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-166h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 498h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-664h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 498h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM650 216h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm56 592h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-332 0h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-56-592h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-166 0h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm56 592h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-56-426h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm56 260h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"border-inner\", \"theme\": \"outlined\" };\nexport default BorderInnerOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport BorderInnerOutlinedSvg from \"@ant-design/icons-svg/es/asn/BorderInnerOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar BorderInnerOutlined = function BorderInnerOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: BorderInnerOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(BorderInnerOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'BorderInnerOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar SignatureOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"fill-rule\": \"evenodd\", \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M145.71 752c2 0 4-.2 5.98-.5L319.9 722c1.99-.4 3.88-1.3 5.28-2.8l423.91-423.87a9.93 9.93 0 000-14.06L582.88 114.9C581 113 578.5 112 575.82 112s-5.18 1-7.08 2.9L144.82 538.76c-1.5 1.5-2.4 3.29-2.8 5.28l-29.5 168.17a33.59 33.59 0 009.37 29.81c6.58 6.48 14.95 9.97 23.82 9.97m51.75-85.43l15.65-88.92 362.7-362.67 73.28 73.27-362.7 362.67zm401.37-98.64c27.69-14.81 57.29-20.85 85.54-15.52 32.37 6.1 59.72 26.53 78.96 59.4 29.97 51.22 21.64 102.34-18.48 144.26-17.58 18.36-41.07 35.01-70 50.3l-.3.15.86.26a147.88 147.88 0 0041.54 6.2l1.17.01c61.07 0 100.98-22.1 125.28-67.87a36 36 0 0163.6 33.76C869.7 849.1 804.9 885 718.12 885c-47.69 0-91.94-15.03-128.19-41.36l-1.05-.78-1.36.47c-46.18 16-98.74 29.95-155.37 41.94l-2.24.47a1931.1 1931.1 0 01-139.16 23.96 36 36 0 11-9.5-71.38 1860.1 1860.1 0 00133.84-23.04c42.8-9 83-19.13 119.35-30.34l.24-.08-.44-.69c-16.46-26.45-25.86-55.43-26.14-83.24v-1.3c0-49.9 39.55-104.32 90.73-131.7M671 623.17c-10.74-2.03-24.1.7-38.22 8.26-29.55 15.8-52.7 47.64-52.7 68.2 0 18.2 8.9 40.14 24.71 59.73l.24.3 1.22-.52c39.17-16.58 68.49-34.27 85.93-52.18l.64-.67c18.74-19.57 21.39-35.84 8.36-58.1-9.06-15.47-19.03-22.92-30.18-25.02\" } }] }, \"name\": \"signature\", \"theme\": \"outlined\" };\nexport default SignatureOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport SignatureOutlinedSvg from \"@ant-design/icons-svg/es/asn/SignatureOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar SignatureOutlined = function SignatureOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: SignatureOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(SignatureOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'SignatureOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar RetweetOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"0 0 1024 1024\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M136 552h63.6c4.4 0 8-3.6 8-8V288.7h528.6v72.6c0 1.9.6 3.7 1.8 5.2a8.3 8.3 0 0011.7 1.4L893 255.4c4.3-5 3.6-10.3 0-13.2L749.7 129.8a8.22 8.22 0 00-5.2-1.8c-4.6 0-8.4 3.8-8.4 8.4V209H199.7c-39.5 0-71.7 32.2-71.7 71.8V544c0 4.4 3.6 8 8 8zm752-80h-63.6c-4.4 0-8 3.6-8 8v255.3H287.8v-72.6c0-1.9-.6-3.7-1.8-5.2a8.3 8.3 0 00-11.7-1.4L131 768.6c-4.3 5-3.6 10.3 0 13.2l143.3 112.4c1.5 1.2 3.3 1.8 5.2 1.8 4.6 0 8.4-3.8 8.4-8.4V815h536.6c39.5 0 71.7-32.2 71.7-71.8V480c-.2-4.4-3.8-8-8.2-8z\" } }] }, \"name\": \"retweet\", \"theme\": \"outlined\" };\nexport default RetweetOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport RetweetOutlinedSvg from \"@ant-design/icons-svg/es/asn/RetweetOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar RetweetOutlined = function RetweetOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: RetweetOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(RetweetOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'RetweetOutlined';\n}\nexport default RefIcon;","import { InputNumber, Slider, Space } from 'antd';\n\ntype CustomSliderProps = {\n  label: string;\n  value: number;\n  min: number;\n  max: number;\n  onChange: (v: number) => void;\n  onChangeComplete?: () => void;\n  gradient?: string; // 👈 dynamic CSS gradient for track\n};\n\nexport const CustomSlider = ({\n  label,\n  value,\n  min,\n  max,\n  gradient,\n  onChange,\n  onChangeComplete,\n}: CustomSliderProps) => (\n  <div className=\"custom-slider-container\">\n    <div style={{ width: '100%' }}>\n      <span className=\"custom-label\">{label}</span>\n      <InputNumber\n        min={min}\n        max={max}\n        value={value}\n        onChange={(v) => onChange(Number(v))}\n        onBlur={() => onChangeComplete?.()}\n        className=\"custom-number\"\n        size=\"small\"\n      />\n    </div>\n\n    <Slider\n      min={min}\n      max={max}\n      value={value}\n      onChange={onChange}\n      onChangeComplete={onChangeComplete}\n      className=\"custom-slider\"\n      style={{ '--custom-slider-gradient': gradient } as React.CSSProperties}\n      handleStyle={{ opacity: 1 }}\n    />\n  </div>\n);\n","import React, { RefObject, useMemo } from 'react';\nimport Highcharts from 'highcharts';\nimport HighchartsReact from 'highcharts-react-official';\n\ntype RGBHistogramProps = {\n  canvasRef: RefObject<HTMLCanvasElement>;\n  redData: number[];\n  greenData: number[];\n  blueData: number[];\n};\n\nconst RGBHistogram: React.FC<RGBHistogramProps> = ({ canvasRef, redData, greenData, blueData }) => {\n  const options = useMemo(() => {\n    return {\n      chart: {\n        backgroundColor: '#2b2b2b',\n        height: 120,\n        spacing: [5, 5, 5, 5],\n      },\n      title: { text: '' },\n      xAxis: {\n        title: { text: '', style: { color: '#fff' } },\n\n        labels: { style: { color: '#fff', fontSize: '5px' } },\n        gridLineColor: 'rgba(255,255,255,0.1)',\n      },\n      yAxis: {\n        title: { text: '', style: { color: '#fff' } },\n        labels: { style: { color: '#fff', fontSize: '5px' } },\n        gridLineColor: 'rgba(255,255,255,0.1)',\n      },\n      legend: { enabled: false },\n      plotOptions: {\n        histogram: { binWidth: 4 },\n        series: { animation: false, marker: { enabled: false } },\n      },\n      series: [\n        {\n          name: 'Red',\n          data: redData,\n          color: '#ff4444',\n          zIndex: 3,\n          lineWidth: 1,\n          marker: {\n            radius: 1,\n          },\n        },\n        {\n          name: 'Green',\n          data: greenData,\n          color: '#44ff44',\n          zIndex: 2,\n          lineWidth: 1,\n          marker: {\n            radius: 1,\n          },\n        },\n        {\n          name: 'Blue',\n          data: blueData,\n          color: '#4444ff',\n          zIndex: 1,\n          lineWidth: 1,\n          marker: {\n            radius: 1,\n          },\n        },\n      ],\n      credits: { enabled: false },\n      tooltip: { enabled: false },\n    };\n  }, [redData, greenData, blueData]);\n\n  return <HighchartsReact highcharts={Highcharts} options={options} />;\n};\n\nexport default RGBHistogram;\n","import React from 'react';\nimport { Modal, InputNumber, Radio, Slider } from 'antd';\n\ntype Props = {\n  open: boolean;\n  onCancel: () => void;\n  onOk: () => void;\n  upscaleFactor: number;\n  setUpscaleFactor: (v: number) => void;\n  presetLocal: 'low' | 'medium' | 'high';\n  setPresetLocal: (v: 'low' | 'medium' | 'high') => void;\n  sharpenAmount: number;\n  setSharpenAmount: (v: number) => void;\n  edgeEnhancement: number;\n  setEdgeEnhancement: (v: number) => void;\n  denoiseAmount: number;\n  setDenoiseAmount: (v: number) => void;\n};\n\nconst UpscaleModal: React.FC<Props> = ({\n  open,\n  onCancel,\n  onOk,\n  upscaleFactor,\n  setUpscaleFactor,\n  presetLocal,\n  setPresetLocal,\n  sharpenAmount,\n  setSharpenAmount,\n  edgeEnhancement,\n  setEdgeEnhancement,\n  denoiseAmount,\n  setDenoiseAmount,\n}) => {\n  return (\n    <Modal\n      title=\"Custom Upscale\"\n      open={open}\n      onCancel={onCancel}\n      onOk={onOk}\n      okText=\"Upscale\"\n      width={500}\n    >\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>\n        <div style={{ display: 'flex', gap: 12, alignItems: 'center' }}>\n          <div style={{ minWidth: 120 }}>\n            <div>Multiplier</div>\n            <InputNumber\n              min={1}\n              max={8}\n              step={0.1}\n              value={upscaleFactor}\n              onChange={(v) => setUpscaleFactor(Number(v || 1))}\n            />\n          </div>\n          <div style={{ flex: 1 }}>\n            <div>Smoothing Quality</div>\n            <div style={{ marginTop: 8 }}>\n              <Radio.Group\n                value={presetLocal}\n                onChange={(e) => setPresetLocal(e.target.value)}\n                options={[\n                  { label: 'Low', value: 'low' },\n                  { label: 'Medium', value: 'medium' },\n                  { label: 'High', value: 'high' },\n                ]}\n                optionType=\"button\"\n                buttonStyle=\"solid\"\n              />\n            </div>\n          </div>\n        </div>\n\n        <div style={{ borderTop: '1px solid #f0f0f0', paddingTop: 12 }}>\n          <div style={{ marginBottom: 8, fontWeight: 500 }}>Quality Enhancements</div>\n\n          <div style={{ marginBottom: 12 }}>\n            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>\n              <span>Sharpen</span>\n              <span>{sharpenAmount}%</span>\n            </div>\n            <Slider\n              min={0}\n              max={100}\n              value={sharpenAmount}\n              onChange={setSharpenAmount}\n              tooltip={{ formatter: (v) => `${v}%` }}\n            />\n          </div>\n\n          <div style={{ marginBottom: 12 }}>\n            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>\n              <span>Edge Enhancement</span>\n              <span>{edgeEnhancement}%</span>\n            </div>\n            <Slider\n              min={0}\n              max={100}\n              value={edgeEnhancement}\n              onChange={setEdgeEnhancement}\n              tooltip={{ formatter: (v) => `${v}%` }}\n            />\n          </div>\n\n          <div style={{ marginBottom: 12 }}>\n            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>\n              <span>Denoise</span>\n              <span>{denoiseAmount}%</span>\n            </div>\n            <Slider\n              min={0}\n              max={100}\n              value={denoiseAmount}\n              onChange={setDenoiseAmount}\n              tooltip={{ formatter: (v) => `${v}%` }}\n            />\n          </div>\n        </div>\n      </div>\n    </Modal>\n  );\n};\n\nexport default UpscaleModal;\n","// This icon file is generated automatically.\nvar InfoCircleOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z\" } }, { \"tag\": \"path\", \"attrs\": { \"d\": \"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"info-circle\", \"theme\": \"outlined\" };\nexport default InfoCircleOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport InfoCircleOutlinedSvg from \"@ant-design/icons-svg/es/asn/InfoCircleOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar InfoCircleOutlined = function InfoCircleOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: InfoCircleOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(InfoCircleOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'InfoCircleOutlined';\n}\nexport default RefIcon;","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport LoadingOutlinedSvg from \"@ant-design/icons-svg/es/asn/LoadingOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar LoadingOutlined = function LoadingOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: LoadingOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(LoadingOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'LoadingOutlined';\n}\nexport default RefIcon;","import React, { useState } from 'react';\nimport {\n  Modal,\n  Checkbox,\n  Radio,\n  Space,\n  Tooltip,\n  InputNumber,\n  Button,\n  Tabs,\n  Spin,\n  Divider,\n} from 'antd';\nimport {\n  InfoCircleOutlined,\n  DownloadOutlined,\n  LoadingOutlined,\n  CopyOutlined,\n} from '@ant-design/icons';\nimport { handleCopy } from '@/helpers';\n\ntype Props = {\n  open: boolean;\n  onCancel: () => void;\n  onExportImage: (format: 'png' | 'jpg', includeOverlays: boolean) => void;\n  onExportSvg: () => void;\n  canvasRef: React.RefObject<HTMLCanvasElement>;\n  processing: boolean;\n  svgContent: string | null;\n  scale: number;\n  setScale: (v: number) => void;\n  ltres: number;\n  setLtres: (v: number) => void;\n  qtres: number;\n  setQtres: (v: number) => void;\n  pathomit: number;\n  setPathomit: (v: number) => void;\n  colorsampling: number;\n  setColorsampling: (v: number) => void;\n  strokewidth: number;\n  setStrokewidth: (v: number) => void;\n  onDownload: (content: string, filename: string) => void;\n  getSvgModalWidth: () => number;\n  getSvgModalHeight: () => number | undefined;\n};\n\nconst ExportModal: React.FC<Props> = ({\n  open,\n  onCancel,\n  onExportImage,\n  onExportSvg,\n  canvasRef,\n  processing,\n  svgContent,\n  scale,\n  setScale,\n  ltres,\n  setLtres,\n  qtres,\n  setQtres,\n  pathomit,\n  setPathomit,\n  colorsampling,\n  setColorsampling,\n  strokewidth,\n  setStrokewidth,\n  onDownload,\n  getSvgModalWidth,\n  getSvgModalHeight,\n}) => {\n  const [exportType, setExportType] = useState<'image' | 'svg'>('image');\n  const [imageFormat, setImageFormat] = useState<'png' | 'jpg'>('png');\n  const [includeOverlays, setIncludeOverlays] = useState(true);\n\n  const svgBase64 = svgContent ? btoa(unescape(encodeURIComponent(svgContent))) : '';\n  const svgDataURI = svgContent ? `data:image/svg+xml;base64,${svgBase64}` : '';\n\n  const handleExport = () => {\n    if (exportType === 'image') {\n      onExportImage(imageFormat, includeOverlays);\n      onCancel();\n    } else {\n      onExportSvg();\n    }\n  };\n\n  return (\n    <Modal\n      title=\"Export Options\"\n      open={open}\n      onCancel={onCancel}\n      onOk={handleExport}\n      okText={exportType === 'image' ? 'Export' : 'Convert to SVG'}\n      okButtonProps={{ loading: processing && exportType === 'svg' }}\n      width={exportType === 'svg' && svgContent ? getSvgModalWidth() : 500}\n      style={exportType === 'svg' && svgContent ? { height: getSvgModalHeight() } : undefined}\n    >\n      <Space direction=\"vertical\" style={{ width: '100%' }} size=\"large\">\n        {/* Export Type Selection */}\n        <div>\n          <div style={{ marginBottom: 12, fontWeight: 500 }}>Export Format</div>\n          <Radio.Group\n            value={exportType}\n            onChange={(e) => setExportType(e.target.value)}\n            buttonStyle=\"solid\"\n          >\n            <Radio.Button value=\"image\">Image (PNG/JPG)</Radio.Button>\n            <Radio.Button value=\"svg\">SVG</Radio.Button>\n          </Radio.Group>\n        </div>\n\n        <Divider style={{ margin: '8px 0' }} />\n\n        {/* Image Export Options */}\n        {exportType === 'image' && (\n          <div>\n            <div style={{ marginBottom: 12, fontWeight: 500 }}>Image Options</div>\n            <Space direction=\"vertical\" style={{ width: '100%' }}>\n              <Radio.Group\n                value={imageFormat}\n                onChange={(e) => setImageFormat(e.target.value)}\n                buttonStyle=\"solid\"\n              >\n                <Radio.Button value=\"png\">PNG</Radio.Button>\n                <Radio.Button value=\"jpg\">JPG</Radio.Button>\n              </Radio.Group>\n\n              <Checkbox\n                checked={includeOverlays}\n                onChange={(e) => setIncludeOverlays(e.target.checked)}\n              >\n                Include overlay layers\n              </Checkbox>\n              <div style={{ fontSize: 12, color: '#666', marginLeft: 24, marginTop: -8 }}>\n                {includeOverlays\n                  ? 'Export will include all visible layers and text overlays'\n                  : 'Export will only include the base image without layers'}\n              </div>\n            </Space>\n          </div>\n        )}\n\n        {/* SVG Export Options */}\n        {exportType === 'svg' && (\n          <div>\n            <div style={{ marginBottom: 12, fontWeight: 500 }}>SVG Tracing Options</div>\n            <Space wrap size=\"small\">\n              <Tooltip title=\"Scale factor for the SVG output. Higher = larger SVG.\">\n                <Space size={4}>\n                  <label>Scale</label>\n                  <InfoCircleOutlined style={{ fontSize: 12, color: '#999' }} />\n                  <InputNumber\n                    size=\"small\"\n                    min={0.1}\n                    step={0.1}\n                    value={scale}\n                    onChange={(val) => setScale(val || 1)}\n                    style={{ width: 70 }}\n                  />\n                </Space>\n              </Tooltip>\n              <Tooltip title=\"Error threshold for line detection. Lower = more precise lines.\">\n                <Space size={4}>\n                  <label>ltres</label>\n                  <InfoCircleOutlined style={{ fontSize: 12, color: '#999' }} />\n                  <InputNumber\n                    size=\"small\"\n                    min={0}\n                    value={ltres}\n                    onChange={(val) => setLtres(val || 1)}\n                    style={{ width: 70 }}\n                  />\n                </Space>\n              </Tooltip>\n              <Tooltip title=\"Error threshold for curve detection. Lower = more precise curves.\">\n                <Space size={4}>\n                  <label>qtres</label>\n                  <InfoCircleOutlined style={{ fontSize: 12, color: '#999' }} />\n                  <InputNumber\n                    size=\"small\"\n                    min={0}\n                    value={qtres}\n                    onChange={(val) => setQtres(val || 1)}\n                    style={{ width: 70 }}\n                  />\n                </Space>\n              </Tooltip>\n              <Tooltip title=\"Minimum path length to keep. Higher = simpler SVG with fewer tiny paths.\">\n                <Space size={4}>\n                  <label>Pathomit</label>\n                  <InfoCircleOutlined style={{ fontSize: 12, color: '#999' }} />\n                  <InputNumber\n                    size=\"small\"\n                    min={0}\n                    value={pathomit}\n                    onChange={(val) => setPathomit(val || 0)}\n                    style={{ width: 70 }}\n                  />\n                </Space>\n              </Tooltip>\n              <Tooltip title=\"Pixel sampling interval for colors. 1 = every pixel, higher = faster but less accurate colors.\">\n                <Space size={4}>\n                  <label>ColorSampling</label>\n                  <InfoCircleOutlined style={{ fontSize: 12, color: '#999' }} />\n                  <InputNumber\n                    size=\"small\"\n                    min={1}\n                    value={colorsampling}\n                    onChange={(val) => setColorsampling(val || 1)}\n                    style={{ width: 70 }}\n                  />\n                </Space>\n              </Tooltip>\n              <Tooltip title=\"Stroke width in the output SVG.\">\n                <Space size={4}>\n                  <label>StrokeWidth</label>\n                  <InfoCircleOutlined style={{ fontSize: 12, color: '#999' }} />\n                  <InputNumber\n                    size=\"small\"\n                    min={0}\n                    value={strokewidth}\n                    onChange={(val) => setStrokewidth(val || 1)}\n                    style={{ width: 70 }}\n                  />\n                </Space>\n              </Tooltip>\n            </Space>\n\n            {/* SVG Results */}\n            {svgContent && (\n              <>\n                <Divider style={{ margin: '16px 0' }} />\n                <div style={{ marginBottom: 12, fontWeight: 500 }}>SVG Results</div>\n                <Tabs defaultActiveKey=\"svg\" type=\"card\" size=\"small\">\n                  <Tabs.TabPane tab=\"Preview\" key=\"svg\">\n                    <Space style={{ marginBottom: 8 }}>\n                      <Button\n                        size=\"small\"\n                        onClick={() => onDownload(svgContent, 'image.svg')}\n                        icon={<DownloadOutlined />}\n                      >\n                        Download\n                      </Button>\n                      <Button\n                        size=\"small\"\n                        onClick={() => handleCopy(svgContent, 'SVG copied!')}\n                        icon={<CopyOutlined />}\n                      >\n                        Copy\n                      </Button>\n                    </Space>\n                    <div\n                      style={{\n                        border: '1px solid #eee',\n                        borderRadius: 6,\n                        padding: 12,\n                        overflow: 'auto',\n                        maxHeight: canvasRef.current ? canvasRef.current.height : 400,\n                      }}\n                    >\n                      <div dangerouslySetInnerHTML={{ __html: svgContent }} />\n                    </div>\n                  </Tabs.TabPane>\n\n                  <Tabs.TabPane tab=\"Base64\" key=\"base64\">\n                    <Space style={{ marginBottom: 8 }}>\n                      <Button\n                        size=\"small\"\n                        onClick={() => handleCopy(svgBase64, 'Base64 copied!')}\n                        icon={<CopyOutlined />}\n                      >\n                        Copy\n                      </Button>\n                      <Button\n                        size=\"small\"\n                        onClick={() => onDownload(svgBase64, 'image-base64.txt')}\n                        icon={<DownloadOutlined />}\n                      >\n                        Download\n                      </Button>\n                    </Space>\n                    <pre\n                      style={{\n                        background: '#f7f7f7',\n                        padding: 12,\n                        borderRadius: 6,\n                        whiteSpace: 'pre-wrap',\n                        wordBreak: 'break-word',\n                        maxHeight: 300,\n                        overflow: 'auto',\n                        fontSize: 12,\n                      }}\n                    >\n                      {svgBase64}\n                    </pre>\n                  </Tabs.TabPane>\n\n                  <Tabs.TabPane tab=\"Data URI\" key=\"datauri\">\n                    <Space style={{ marginBottom: 8 }}>\n                      <Button\n                        size=\"small\"\n                        onClick={() => handleCopy(svgDataURI, 'Data URI copied!')}\n                        icon={<CopyOutlined />}\n                      >\n                        Copy\n                      </Button>\n                      <Button\n                        size=\"small\"\n                        onClick={() => onDownload(svgDataURI, 'image-datauri.txt')}\n                        icon={<DownloadOutlined />}\n                      >\n                        Download\n                      </Button>\n                    </Space>\n                    <pre\n                      style={{\n                        background: '#f7f7f7',\n                        padding: 12,\n                        borderRadius: 6,\n                        whiteSpace: 'pre-wrap',\n                        wordBreak: 'break-word',\n                        maxHeight: 300,\n                        overflow: 'auto',\n                        fontSize: 12,\n                      }}\n                    >\n                      {svgDataURI}\n                    </pre>\n                  </Tabs.TabPane>\n                </Tabs>\n              </>\n            )}\n\n            {processing && (\n              <div style={{ textAlign: 'center', padding: 24 }}>\n                <Spin\n                  indicator={<LoadingOutlined style={{ fontSize: 32 }} spin />}\n                  tip=\"Converting to SVG...\"\n                />\n              </div>\n            )}\n          </div>\n        )}\n      </Space>\n    </Modal>\n  );\n};\n\nexport default ExportModal;\n","import React, { useEffect, useState } from 'react';\nimport { Button, Space, Tooltip, message, Collapse } from 'antd';\nimport {\n  UndoOutlined,\n  RedoOutlined,\n  RotateLeftOutlined,\n  RotateRightOutlined,\n  SwapOutlined,\n  ScissorOutlined,\n  ExportOutlined,\n  CopyOutlined,\n  EditOutlined,\n  DragOutlined,\n  FontColorsOutlined,\n  BorderInnerOutlined,\n  SignatureOutlined,\n  RetweetOutlined,\n  BgColorsOutlined,\n} from '@ant-design/icons';\nimport ImageTracer from 'imagetracerjs';\nimport {\n  applyEffects,\n  copyToClipboard,\n  extractRGBHistogram,\n  flipH,\n  flipV,\n  rotate,\n  applyInvertColors,\n} from '../../utils/helpers';\nimport { CustomSlider } from './CustomSlider';\nimport { HistoryController } from '../../hooks/useHistory';\nimport RGBHistogram from './RGBHistogram';\nimport { Tool } from '.';\nimport UpscaleModal from './UpscaleModal';\nimport ExportModal from './ExportModal';\n\nconst { Panel } = Collapse;\n\ntype Props = {\n  canvasRef: React.RefObject<HTMLCanvasElement>;\n  baseCanvas?: HTMLCanvasElement | null;\n  history: HistoryController;\n  setTool: (value: React.SetStateAction<Tool>) => void;\n  brightness: number;\n  setBrightness: (v: number) => void;\n  contrast: number;\n  setContrast: (v: number) => void;\n  blur: number;\n  setBlur: (v: number) => void;\n  gaussian: number;\n  setGaussian: (v: number) => void;\n  sharpen: number;\n  setSharpen: (v: number) => void;\n  bgThreshold: number;\n  setBgThreshold: (v: number) => void;\n  bgThresholdBlack: number;\n  setBgThresholdBlack: (v: number) => void;\n  setShowPerspectiveModal: (show: boolean) => void;\n  dpiMeasured?: number | null;\n  setDpiMeasured?: (v: number | null) => void;\n  exportImage: (\n    jpg: boolean,\n    canvasRef: React.RefObject<HTMLCanvasElement>,\n    callback?: (blob: Blob) => void,\n    includeOverlays?: boolean,\n  ) => void;\n  onExport?: (blob: Blob) => void;\n  overlayRef: React.RefObject<HTMLCanvasElement>;\n  texture: number;\n  setTexture: (v: number) => void;\n  clarity: number;\n  setClarity: (v: number) => void;\n  highlights: number;\n  setHighlights: (v: number) => void;\n  shadows: number;\n  setShadows: (v: number) => void;\n  whites: number;\n  setWhites: (v: number) => void;\n  blacks: number;\n  setBlacks: (v: number) => void;\n  vibrance: number;\n  setVibrance: (v: number) => void;\n  saturation: number;\n  setSaturation: (v: number) => void;\n  dehaze: number;\n  setDehaze: (v: number) => void;\n  hslAdjustments: Record<string, { h?: number; s?: number; l?: number }>;\n  setHslAdjustments: (name: string, values: Partial<{ h: number; s: number; l: number }>) => void;\n  upscaleImage?: (\n    factor: number,\n    preset?: 'low' | 'medium' | 'high',\n    qualityOptions?: { sharpen?: number; edgeEnhancement?: number; denoise?: number },\n  ) => void;\n  onColorRemovalToolClick?: () => void;\n};\n\nconst ImageEditorToolbar: React.FC<Props> = ({\n  canvasRef,\n  baseCanvas,\n  history,\n\n  setTool,\n  brightness,\n  setBrightness,\n  contrast,\n  setContrast,\n  blur,\n  setBlur,\n  gaussian,\n  setGaussian,\n  sharpen,\n  setSharpen,\n  bgThreshold,\n  setBgThreshold,\n  bgThresholdBlack,\n  setBgThresholdBlack,\n  setShowPerspectiveModal,\n  dpiMeasured,\n  setDpiMeasured,\n  exportImage,\n  onExport,\n  overlayRef,\n  texture,\n  setTexture,\n  clarity,\n  setClarity,\n  highlights,\n  setHighlights,\n  shadows,\n  setShadows,\n  whites,\n  setWhites,\n  blacks,\n  setBlacks,\n  vibrance,\n  setVibrance,\n  saturation,\n  setSaturation,\n  dehaze,\n  setDehaze,\n  hslAdjustments,\n  setHslAdjustments,\n  upscaleImage,\n  onColorRemovalToolClick,\n}) => {\n  const [activeColor, setActiveColor] = useState('red');\n  const [showUpscaleModal, setShowUpscaleModal] = useState(false);\n  const [showExportModal, setShowExportModal] = useState(false);\n  const [upscaleFactor, setUpscaleFactor] = useState<number>(2);\n  const [presetLocal, setPresetLocal] = useState<'low' | 'medium' | 'high'>('medium');\n  const [sharpenAmount, setSharpenAmount] = useState<number>(0);\n  const [edgeEnhancement, setEdgeEnhancement] = useState<number>(0);\n  const [denoiseAmount, setDenoiseAmount] = useState<number>(0);\n\n  // SVG conversion states\n  const [svgContent, setSvgContent] = useState<string | null>(null);\n  const [processing, setProcessing] = useState(false);\n  const [scale, setScale] = useState(1);\n  const [ltres, setLtres] = useState(1);\n  const [qtres, setQtres] = useState(1);\n  const [pathomit, setPathomit] = useState(8);\n  const [colorsampling, setColorsampling] = useState(2);\n  const [strokewidth, setStrokewidth] = useState(1);\n  const [histogramData, setHistogramData] = useState<{\n    red: number[];\n    green: number[];\n    blue: number[];\n  }>({\n    red: [],\n    green: [],\n    blue: [],\n  });\n\n  useEffect(() => {\n    if (canvasRef.current) {\n      const extracted = extractRGBHistogram(canvasRef.current);\n      setHistogramData(extracted);\n    }\n  }, [canvasRef.current]);\n\n  const colorSwatches = [\n    { name: 'red', color: '#ff4d4d' },\n    { name: 'orange', color: '#ffa500' },\n    { name: 'yellow', color: '#ffd700' },\n    { name: 'green', color: '#00c853' },\n    { name: 'aqua', color: '#00e5ff' },\n    { name: 'blue', color: '#2979ff' },\n    { name: 'purple', color: '#9c27b0' },\n    { name: 'magenta', color: '#ff00aa' },\n  ];\n\n  const getSliderGradient = (activeColor: string, type: 'h' | 's' | 'l') => {\n    const base = colorSwatches.find((c) => c.name === activeColor)?.color || '#ffffff';\n\n    const index = colorSwatches.findIndex((c) => c.name === activeColor);\n\n    // If not found, default to grayscale\n    if (index === -1) return '#555';\n\n    const current = colorSwatches[index].color;\n    const left = colorSwatches[index - 1]?.color || current; // If first, use itself\n    const right = colorSwatches[index + 1]?.color || current; // If last, use itself\n\n    switch (type) {\n      case 'h':\n        return `linear-gradient(90deg, ${left}, ${current}, ${right})`;\n      case 's':\n        return `linear-gradient(90deg, gray, ${base})`;\n      case 'l':\n        return `linear-gradient(90deg, black, ${base}, white)`;\n      default:\n        return '#555';\n    }\n  };\n\n  const toneSliders = [\n    { key: 'texture', label: 'Texture', value: texture, setter: setTexture },\n    { key: 'clarity', label: 'Clarity', value: clarity, setter: setClarity },\n    { key: 'highlights', label: 'Highlights', value: highlights, setter: setHighlights },\n    { key: 'shadows', label: 'Shadows', value: shadows, setter: setShadows },\n    { key: 'whites', label: 'Whites', value: whites, setter: setWhites },\n    { key: 'blacks', label: 'Blacks', value: blacks, setter: setBlacks },\n  ];\n\n  const effectSliders = [\n    { key: 'blur', label: 'Box Blur', min: 0, max: 25, value: blur, setter: setBlur },\n    { key: 'gaussian', label: 'Gaussian', min: 0, max: 20, value: gaussian, setter: setGaussian },\n    { key: 'sharpen', label: 'Sharpen', min: 0, max: 5, value: sharpen, setter: setSharpen },\n    {\n      key: 'bgThreshold',\n      label: 'Remove White',\n      min: 0,\n      max: 255,\n      value: bgThreshold,\n      setter: setBgThreshold,\n    },\n    {\n      key: 'bgThresholdBlack',\n      label: 'Remove Black',\n      min: 0,\n      max: 255,\n      value: bgThresholdBlack,\n      setter: setBgThresholdBlack,\n    },\n  ];\n\n  const apply = () =>\n    applyEffects(\n      canvasRef,\n      baseCanvas,\n      {\n        blur,\n        gaussian,\n        sharpen,\n        texture,\n        clarity,\n        bgThreshold,\n        bgThresholdBlack,\n        brightness,\n        contrast,\n        highlights,\n        shadows,\n        whites,\n        blacks,\n        vibrance,\n        saturation,\n        dehaze,\n        hslAdjustments,\n      },\n      history,\n      setHistogramData,\n    );\n\n  const handleCustomUpscale = () => {\n    setTool('upscale');\n    const qualityOptions = {\n      sharpen: sharpenAmount,\n      edgeEnhancement: edgeEnhancement,\n      denoise: denoiseAmount,\n    };\n    upscaleImage?.(upscaleFactor, presetLocal, qualityOptions);\n    setShowUpscaleModal(false);\n  };\n\n  const handleExportClick = () => {\n    setShowExportModal(true);\n  };\n\n  const handleExportImage = (format: 'png' | 'jpg', includeOverlays: boolean) => {\n    exportImage(format === 'jpg', canvasRef, onExport, includeOverlays);\n  };\n\n  const handleConvertToSvg = () => {\n    if (!canvasRef.current) {\n      message.error('No image to convert');\n      return;\n    }\n\n    setProcessing(true);\n    const dataUrl = canvasRef.current.toDataURL();\n\n    try {\n      ImageTracer.imageToSVG(\n        dataUrl,\n        (svgString) => {\n          setSvgContent(svgString);\n          setProcessing(false);\n          message.success('Image converted to SVG successfully!');\n        },\n        { scale, ltres, qtres, pathomit, colorsampling, strokewidth },\n      );\n    } catch (err: any) {\n      console.error(err);\n      setProcessing(false);\n      message.error('Error converting image to SVG.');\n    }\n  };\n\n  const getSvgModalWidth = () => {\n    if (!canvasRef.current) return 700;\n    const canvasWidth = canvasRef.current.width;\n    const minWidth = 500;\n    const maxWidth = window.innerWidth * 0.9;\n    return Math.min(Math.max(canvasWidth + 100, minWidth), maxWidth);\n  };\n\n  const getSvgModalHeight = () => {\n    if (!canvasRef.current) return undefined;\n    const canvasHeight = canvasRef.current.height;\n    const maxHeight = window.innerHeight * 0.85;\n    return Math.min(canvasHeight + 300, maxHeight);\n  };\n\n  const handleDownloadSvg = (content: string, filename: string) => {\n    const blob = new Blob([content], { type: 'image/svg+xml' });\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = filename;\n    link.click();\n  };\n\n  return (\n    <div style={{ width: 260 }}>\n      <Collapse\n        defaultActiveKey={['histogram', 'basic', 'lights', 'effects']}\n        ghost\n        expandIconPosition=\"end\"\n      >\n        <Panel header=\"Histogram\" key=\"histogram\">\n          <RGBHistogram\n            canvasRef={canvasRef}\n            redData={histogramData.red}\n            greenData={histogramData.green}\n            blueData={histogramData.blue}\n          />\n        </Panel>\n\n        {/* 🔧 Basic Tools */}\n        <Panel header=\"🛠 Basic\" key=\"basic\">\n          <Space wrap>\n            <Tooltip title=\"Undo (Ctrl+Z)\">\n              <Button icon={<UndoOutlined />} onClick={history.undo} />\n            </Tooltip>\n            <Tooltip title=\"Redo (Ctrl+Shift+Z)\">\n              <Button icon={<RedoOutlined />} onClick={history.redo} />\n            </Tooltip>\n            <Tooltip title=\"Rotate left\">\n              <Button\n                icon={<RotateLeftOutlined />}\n                onClick={() => rotate(-90, canvasRef, overlayRef, history)}\n              />\n            </Tooltip>\n            <Tooltip title=\"Rotate right (R)\">\n              <Button\n                icon={<RotateRightOutlined />}\n                onClick={() => rotate(90, canvasRef, overlayRef, history)}\n              />\n            </Tooltip>\n            <Tooltip title=\"Flip horizontal\">\n              <Button icon={<SwapOutlined />} onClick={() => flipH(canvasRef, history)} />\n            </Tooltip>\n            <Tooltip title=\"Flip vertical\">\n              <Button\n                icon={<SwapOutlined rotate={90} />}\n                onClick={() => flipV(canvasRef, history)}\n              />\n            </Tooltip>\n\n            <Tooltip title=\"Crop (C)\">\n              <Button icon={<ScissorOutlined />} onClick={() => setTool('crop')} />\n            </Tooltip>\n            <Tooltip title=\"Perspective\">\n              <Button\n                icon={<BorderInnerOutlined />}\n                onClick={() => {\n                  setShowPerspectiveModal(true);\n                  setTool('perspective');\n                }}\n              />\n            </Tooltip>\n            <Tooltip title=\"Brush (B)\">\n              <Button icon={<SignatureOutlined />} onClick={() => setTool('draw')} />\n            </Tooltip>\n            <Tooltip title=\"Text (T)\">\n              <Button icon={<FontColorsOutlined />} onClick={() => setTool('text')} />\n            </Tooltip>\n            <Tooltip title=\"Layer (V)\">\n              <Button icon={<DragOutlined />} onClick={() => setTool('layer')} />\n            </Tooltip>\n            <Tooltip title=\"Invert Colors (Ctrl+I)\">\n              <Button\n                icon={<RetweetOutlined />}\n                onClick={() => applyInvertColors(canvasRef, history)}\n              />\n            </Tooltip>\n            <Tooltip title=\"Remove color\">\n              <Button icon={<BgColorsOutlined />} onClick={onColorRemovalToolClick} />\n            </Tooltip>\n          </Space>\n        </Panel>\n\n        {/* 🔆 Light */}\n        <Panel header=\"🔆 Light\" key=\"lights\">\n          <CustomSlider\n            key={'brightness'}\n            label={'Brightness'}\n            value={brightness}\n            min={-150}\n            max={150}\n            onChange={setBrightness}\n            onChangeComplete={apply}\n          />\n          <CustomSlider\n            key={'contrast'}\n            label={'Contrast'}\n            value={contrast}\n            min={-100}\n            max={100}\n            onChange={setContrast}\n            onChangeComplete={apply}\n          />\n        </Panel>\n\n        {/* 🎨 Color & HSL */}\n        <Panel header=\"🎨 Color\" key=\"color\">\n          <CustomSlider\n            key={'vibrance'}\n            label={'Vibrance'}\n            value={vibrance}\n            min={-100}\n            max={100}\n            onChange={setVibrance}\n            onChangeComplete={apply}\n          />\n\n          <CustomSlider\n            key={'saturation'}\n            label={'Saturation'}\n            value={saturation}\n            min={-100}\n            max={100}\n            onChange={setSaturation}\n            onChangeComplete={apply}\n          />\n\n          <CustomSlider\n            key={'dehaze'}\n            label={'Dehaze'}\n            value={dehaze}\n            min={-100}\n            max={100}\n            onChange={setDehaze}\n            onChangeComplete={apply}\n          />\n\n          {/* HSL Picker */}\n          <div style={{ marginTop: 10 }}>HSL Mixer</div>\n          <div style={{ display: 'flex', gap: 8, marginBottom: 10 }}>\n            {colorSwatches.map(({ name, color }) => (\n              <Tooltip title={name.toUpperCase()}>\n                <div\n                  key={name}\n                  onClick={() => setActiveColor(name)}\n                  style={{\n                    width: 20,\n                    height: 20,\n                    borderRadius: '50%',\n                    background: color,\n                    border: activeColor === name ? '2px solid white' : '1px solid #555',\n                    boxShadow: activeColor === name ? '0 0 6px rgba(255,255,255,0.8)' : '',\n                    cursor: 'pointer',\n                  }}\n                />\n              </Tooltip>\n            ))}\n          </div>\n          {/* <div>{activeColor.toUpperCase()}</div> */}\n\n          {['Hue', 'Saturation', 'Luminance'].map((label) => {\n            const key = label[0].toLowerCase(); // h/s/l\n            return (\n              <CustomSlider\n                key={label}\n                label={label}\n                value={hslAdjustments[activeColor]?.[key] ?? 0}\n                min={label === 'Hue' ? -180 : -100}\n                max={label === 'Hue' ? 180 : 100}\n                onChange={(v) => setHslAdjustments(activeColor, { [key]: v })}\n                onChangeComplete={apply}\n                gradient={getSliderGradient(activeColor, key as 'h' | 's' | 'l')}\n              />\n            );\n          })}\n\n          <Button size=\"small\" onClick={() => setHslAdjustments(activeColor, { h: 0, s: 0, l: 0 })}>\n            Reset\n          </Button>\n        </Panel>\n\n        {/* ✨ Effects */}\n        <Panel header=\"✨ Effects\" key=\"effects\">\n          {toneSliders.map(({ key, label, value, setter }) => (\n            <CustomSlider\n              key={key}\n              label={label}\n              value={value}\n              min={-100}\n              max={100}\n              onChange={setter}\n              onChangeComplete={apply}\n            />\n          ))}\n        </Panel>\n\n        {/* 🎭 Filters */}\n        <Panel header=\"🎭 Filters\" key=\"filters\">\n          {effectSliders.map(({ key, label, min, max, value, setter }) => (\n            <CustomSlider\n              key={key}\n              label={label}\n              value={value}\n              min={min}\n              max={max}\n              onChange={setter}\n              onChangeComplete={apply}\n            />\n          ))}\n        </Panel>\n\n        {/* 📐 Crop / Ruler */}\n        <Panel header=\"📐 Crop & Ruler\" key=\"crop\">\n          <Space>\n            <Button icon={<ScissorOutlined />} onClick={() => setTool('crop')}>\n              Crop\n            </Button>\n            <Button\n              onClick={() => {\n                setShowPerspectiveModal(true);\n                setTool('perspective');\n              }}\n            >\n              Perspective\n            </Button>\n          </Space>\n\n          <div style={{ marginTop: 10 }}>Ruler</div>\n          <Space>\n            <Button onClick={() => setTool('ruler')}>📏 Ruler</Button>\n            <Button\n              onClick={() => {\n                setDpiMeasured?.(null);\n                message.info('Ruler cleared');\n              }}\n            >\n              Clear\n            </Button>\n          </Space>\n          {dpiMeasured && <div>Estimated DPI: {dpiMeasured}</div>}\n        </Panel>\n\n        {/* Custom Upscale Modal launcher */}\n        <Panel header=\"🔼 Upscale Options\" key=\"upscaleOptions\">\n          <Button\n            onClick={() => {\n              setShowUpscaleModal(true);\n            }}\n          >\n            Custom Upscale...\n          </Button>\n        </Panel>\n\n        {/* 📤 Export */}\n        <Panel header=\"📤 Export\" key=\"export\">\n          <Space direction=\"vertical\" style={{ width: '100%' }}>\n            <Button icon={<ExportOutlined />} onClick={handleExportClick} type=\"primary\" block>\n              Export Image / SVG\n            </Button>\n            <Button icon={<CopyOutlined />} onClick={() => copyToClipboard(canvasRef)} block>\n              Copy to Clipboard\n            </Button>\n          </Space>\n        </Panel>\n      </Collapse>\n\n      <UpscaleModal\n        open={showUpscaleModal}\n        onCancel={() => setShowUpscaleModal(false)}\n        onOk={handleCustomUpscale}\n        upscaleFactor={upscaleFactor}\n        setUpscaleFactor={setUpscaleFactor}\n        presetLocal={presetLocal}\n        setPresetLocal={setPresetLocal}\n        sharpenAmount={sharpenAmount}\n        setSharpenAmount={setSharpenAmount}\n        edgeEnhancement={edgeEnhancement}\n        setEdgeEnhancement={setEdgeEnhancement}\n        denoiseAmount={denoiseAmount}\n        setDenoiseAmount={setDenoiseAmount}\n      />\n\n      <ExportModal\n        open={showExportModal}\n        onCancel={() => {\n          setShowExportModal(false);\n          setSvgContent(null);\n        }}\n        onExportImage={handleExportImage}\n        onExportSvg={handleConvertToSvg}\n        canvasRef={canvasRef}\n        processing={processing}\n        svgContent={svgContent}\n        scale={scale}\n        setScale={setScale}\n        ltres={ltres}\n        setLtres={setLtres}\n        qtres={qtres}\n        setQtres={setQtres}\n        pathomit={pathomit}\n        setPathomit={setPathomit}\n        colorsampling={colorsampling}\n        setColorsampling={setColorsampling}\n        strokewidth={strokewidth}\n        setStrokewidth={setStrokewidth}\n        onDownload={handleDownloadSvg}\n        getSvgModalWidth={getSvgModalWidth}\n        getSvgModalHeight={getSvgModalHeight}\n      />\n    </div>\n  );\n};\n\nexport default ImageEditorToolbar;\n","// This icon file is generated automatically.\nvar MergeCellsOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"defs\", \"attrs\": {}, \"children\": [{ \"tag\": \"style\", \"attrs\": {} }] }, { \"tag\": \"path\", \"attrs\": { \"d\": \"M482.2 508.4L331.3 389c-3-2.4-7.3-.2-7.3 3.6V478H184V184h204v128c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V144c0-15.5-12.5-28-28-28H144c-15.5 0-28 12.5-28 28v736c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v128H184V546h140v85.4c0 3.8 4.4 6 7.3 3.6l150.9-119.4a4.5 4.5 0 000-7.2zM880 116H596c-15.5 0-28 12.5-28 28v168c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V184h204v294H700v-85.4c0-3.8-4.3-6-7.3-3.6l-151 119.4a4.52 4.52 0 000 7.1l151 119.5c2.9 2.3 7.3.2 7.3-3.6V546h140v294H636V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v168c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V144c0-15.5-12.5-28-28-28z\" } }] }, \"name\": \"merge-cells\", \"theme\": \"outlined\" };\nexport default MergeCellsOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport MergeCellsOutlinedSvg from \"@ant-design/icons-svg/es/asn/MergeCellsOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar MergeCellsOutlined = function MergeCellsOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: MergeCellsOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(MergeCellsOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'MergeCellsOutlined';\n}\nexport default RefIcon;","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport UpOutlinedSvg from \"@ant-design/icons-svg/es/asn/UpOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar UpOutlined = function UpOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: UpOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(UpOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'UpOutlined';\n}\nexport default RefIcon;","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport DownOutlinedSvg from \"@ant-design/icons-svg/es/asn/DownOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar DownOutlined = function DownOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: DownOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(DownOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'DownOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar ItalicOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M798 160H366c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h181.2l-156 544H229c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h432c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8H474.4l156-544H798c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"italic\", \"theme\": \"outlined\" };\nexport default ItalicOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport ItalicOutlinedSvg from \"@ant-design/icons-svg/es/asn/ItalicOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar ItalicOutlined = function ItalicOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: ItalicOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(ItalicOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'ItalicOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar AlignLeftOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M120 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm0 424h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm784 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"align-left\", \"theme\": \"outlined\" };\nexport default AlignLeftOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport AlignLeftOutlinedSvg from \"@ant-design/icons-svg/es/asn/AlignLeftOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar AlignLeftOutlined = function AlignLeftOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: AlignLeftOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(AlignLeftOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'AlignLeftOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar AlignCenterOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M264 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H264c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm496 424c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H264c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496zm144 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"align-center\", \"theme\": \"outlined\" };\nexport default AlignCenterOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport AlignCenterOutlinedSvg from \"@ant-design/icons-svg/es/asn/AlignCenterOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar AlignCenterOutlined = function AlignCenterOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: AlignCenterOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(AlignCenterOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'AlignCenterOutlined';\n}\nexport default RefIcon;","// This icon file is generated automatically.\nvar AlignRightOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M904 158H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 424H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 212H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"align-right\", \"theme\": \"outlined\" };\nexport default AlignRightOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport AlignRightOutlinedSvg from \"@ant-design/icons-svg/es/asn/AlignRightOutlined\";\nimport AntdIcon from '../components/AntdIcon';\nvar AlignRightOutlined = function AlignRightOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: AlignRightOutlinedSvg\n  }));\n};\nvar RefIcon = /*#__PURE__*/React.forwardRef(AlignRightOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'AlignRightOutlined';\n}\nexport default RefIcon;","import React, { useRef } from 'react';\nimport { Button, Space, Tooltip, Select, InputNumber, ColorPicker } from 'antd';\nimport {\n  ZoomInOutlined,\n  ZoomOutOutlined,\n  MergeCellsOutlined,\n  UpOutlined,\n  DownOutlined,\n  DeleteOutlined,\n  ItalicOutlined,\n  AlignLeftOutlined,\n  AlignCenterOutlined,\n  AlignRightOutlined,\n  FontColorsOutlined,\n} from '@ant-design/icons';\nimport { HistoryController } from '../../hooks/useHistory';\nimport { Tool } from '.';\n\nconst { Option } = Select;\n\ntype TopEditorToolbarProps = {\n  history: HistoryController;\n  setZoom: React.Dispatch<React.SetStateAction<number>>;\n  tool: Tool;\n  setTool: (v: Tool) => void;\n  brushType: 'hard' | 'soft';\n  setBrushType: (v: 'hard' | 'soft') => void;\n  drawColor: string;\n  setDrawColor: (v: string) => void;\n  drawLineWidth: number;\n  setDrawLineWidth: (v: number) => void;\n  brushOpacity: number;\n  setBrushOpacity: (v: number) => void;\n  brushFlow: number;\n  setBrushFlow: (v: number) => void;\n  // layer controls (optional)\n  layers?: Array<{\n    id: string;\n    type?: 'image' | 'text';\n    img?: HTMLImageElement;\n    rect?: { x: number; y: number; w: number; h: number };\n    opacity: number;\n    blend?: GlobalCompositeOperation;\n    text?: string;\n    font?: string;\n    fontSize?: number;\n    fontWeight?: any;\n    fontItalic?: boolean;\n    textDecoration?: 'none' | 'underline' | 'line-through';\n    textColor?: string;\n    textAlign?: 'left' | 'center' | 'right';\n  }>;\n  activeLayerId?: string | null;\n  setLayerOpacity?: (id: string, v: number) => void;\n  setLayerBlend?: (id: string, v: GlobalCompositeOperation) => void;\n  // full layer actions\n  moveLayerUp?: (id: string) => void;\n  moveLayerDown?: (id: string) => void;\n  deleteLayer?: (id: string) => void;\n  selectLayer?: (id: string) => void;\n  mergeLayer?: (id?: string) => void;\n  // text tool controls\n  textContent?: string;\n  setTextContent?: (v: string) => void;\n  textFont?: string;\n  setTextFont?: (v: string) => void;\n  textFontSize?: number;\n  setTextFontSize?: (v: number) => void;\n  textColor?: string;\n  setTextColor?: (v: string) => void;\n  textWeight?: 'normal' | 'bold' | 'lighter' | string;\n  setTextWeight?: (v: any) => void;\n  textItalic?: boolean;\n  setTextItalic?: (v: boolean) => void;\n  textDecoration?: 'none' | 'underline' | 'line-through';\n  setTextDecoration?: (v: 'none' | 'underline' | 'line-through') => void;\n  textAlign?: 'left' | 'center' | 'right';\n  setTextAlign?: (v: 'left' | 'center' | 'right') => void;\n  onAddTextLayer?: () => void;\n  isAddingText?: boolean;\n  setIsAddingText?: (v: boolean) => void;\n};\n\nconst TopEditorToolbar: React.FC<TopEditorToolbarProps> = ({\n  history,\n  setZoom,\n  tool,\n  setTool,\n  brushType,\n  setBrushType,\n  drawColor,\n  setDrawColor,\n  drawLineWidth,\n  setDrawLineWidth,\n  brushOpacity,\n  setBrushOpacity,\n  brushFlow,\n  setBrushFlow,\n  layers,\n  activeLayerId,\n  setLayerOpacity,\n  setLayerBlend,\n  moveLayerUp,\n  moveLayerDown,\n  deleteLayer,\n  selectLayer,\n  mergeLayer,\n  textContent,\n  setTextContent,\n  textFont,\n  setTextFont,\n  textFontSize,\n  setTextFontSize,\n  textColor,\n  setTextColor,\n  textWeight,\n  setTextWeight,\n  textItalic,\n  setTextItalic,\n  textDecoration,\n  setTextDecoration,\n  textAlign,\n  setTextAlign,\n  onAddTextLayer,\n  isAddingText,\n  setIsAddingText,\n}) => {\n  // Drag-to-adjust opacity refs\n  const draggingOpacity = useRef(false);\n  const opacityDragStartX = useRef<number | null>(null);\n  const opacityStartValue = useRef<number>(brushOpacity);\n  // Drag-to-adjust flow refs\n  const draggingFlow = useRef(false);\n  const flowDragStartX = useRef<number | null>(null);\n  const flowStartValue = useRef<number>(brushFlow);\n\n  const handleOpacityLabelMouseDown = (e: React.MouseEvent) => {\n    if (e.button !== 0) return;\n    e.preventDefault();\n\n    draggingOpacity.current = true;\n    opacityDragStartX.current = e.clientX;\n\n    const prevUserSelect = document.body.style.userSelect;\n    document.body.style.userSelect = 'none';\n\n    // === TRANSFORMERS ===\n    const getStartValue = () => {\n      if (tool === 'draw') return brushOpacity;\n      if (tool === 'layer' && layers) {\n        const active = layers.find((l) => l.id === activeLayerId);\n        return active?.opacity ?? brushOpacity;\n      }\n      return brushOpacity;\n    };\n\n    const applyValue = (value: number) => {\n      const val = Number(value.toFixed(2));\n      if (tool === 'draw') {\n        setBrushOpacity(val);\n        return;\n      }\n\n      if (tool === 'layer' && layers) {\n        const active = layers.find((l) => l.id === activeLayerId);\n        if (active && setLayerOpacity) setLayerOpacity(active.id, val);\n      }\n    };\n\n    opacityStartValue.current = getStartValue();\n\n    const onMouseMove = (ev: MouseEvent) => {\n      if (!draggingOpacity.current || opacityDragStartX.current === null) return;\n      const delta = ev.clientX - opacityDragStartX.current;\n      const sensitivity = 0.005;\n      const newVal = Math.min(1, Math.max(0, opacityStartValue.current + delta * sensitivity));\n      applyValue(newVal);\n    };\n\n    const onMouseUp = () => {\n      draggingOpacity.current = false;\n      opacityDragStartX.current = null;\n      document.body.style.userSelect = prevUserSelect;\n      window.removeEventListener('mousemove', onMouseMove);\n      window.removeEventListener('mouseup', onMouseUp);\n    };\n\n    window.addEventListener('mousemove', onMouseMove);\n    window.addEventListener('mouseup', onMouseUp);\n  };\n\n  const handleFlowLabelMouseDown = (e: React.MouseEvent) => {\n    if (e.button !== 0) return; // only left button\n    e.preventDefault();\n    draggingFlow.current = true;\n    flowDragStartX.current = e.clientX;\n    flowStartValue.current = brushFlow;\n\n    // prevent text selection while dragging\n    const prevUserSelect = document.body.style.userSelect;\n    document.body.style.userSelect = 'none';\n\n    const onMouseMove = (ev: MouseEvent) => {\n      if (!draggingFlow.current || flowDragStartX.current === null) return;\n      const delta = ev.clientX - flowDragStartX.current;\n      // sensitivity: 0.005 per pixel = 0.05 change per 10px\n      const sensitivity = 0.005;\n      let newVal = flowStartValue.current + delta * sensitivity;\n      newVal = Math.max(0, Math.min(1, newVal));\n      setBrushFlow(Number(newVal.toFixed(2)));\n    };\n\n    const onMouseUp = () => {\n      draggingFlow.current = false;\n      flowDragStartX.current = null;\n      flowStartValue.current = brushFlow;\n      document.body.style.userSelect = prevUserSelect;\n      window.removeEventListener('mousemove', onMouseMove);\n      window.removeEventListener('mouseup', onMouseUp);\n    };\n\n    window.addEventListener('mousemove', onMouseMove);\n    window.addEventListener('mouseup', onMouseUp);\n  };\n  return (\n    <div style={{ marginBottom: 8 }}>\n      <Space>\n        {/* History selector */}\n        <Select\n          style={{ width: 150 }}\n          placeholder=\"History\"\n          value={history.index}\n          onChange={(idx) => history.applyHistory(idx)}\n          optionLabelProp=\"label\"\n        >\n          {history.history.map((item, idx) => (\n            <Select.Option key={idx} value={idx} label={item.label || `Step ${idx + 1}`}>\n              <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                <img\n                  src={item.url}\n                  alt=\"\"\n                  style={{\n                    width: 40,\n                    height: 30,\n                    objectFit: 'contain',\n                    border: '1px solid #ddd',\n                  }}\n                />\n                <span>{item.label || `Step ${idx + 1}`}</span>\n              </div>\n            </Select.Option>\n          ))}\n        </Select>\n\n        {/* Zoom controls */}\n        <Tooltip title=\"Zoom In\">\n          <Button icon={<ZoomInOutlined />} onClick={() => setZoom((z) => Math.min(z * 1.2, 8))} />\n        </Tooltip>\n        <Tooltip title=\"Zoom Out\">\n          <Button\n            icon={<ZoomOutOutlined />}\n            onClick={() => setZoom((z) => Math.max(z / 1.2, 0.1))}\n          />\n        </Tooltip>\n\n        {/* Tool selector */}\n        <Select value={tool} onChange={(v) => setTool(v as Tool)} style={{ width: 140 }}>\n          <Option value=\"pan\">Pan</Option>\n          <Option value=\"move\">Move</Option>\n          <Option value=\"color\">Color Picker</Option>\n          <Option value=\"crop\">Crop</Option>\n          <Option value=\"ruler\">Ruler</Option>\n          <Option value=\"perspective\">Perspective</Option>\n          <Option value=\"draw\">Brush</Option>\n          <Option value=\"text\">Text</Option>\n        </Select>\n\n        <Space style={{ width: '100%' }} wrap>\n          {tool === 'color' ? (\n            <ColorPicker value={drawColor} onChange={(c) => setDrawColor(c.toHexString())} />\n          ) : null}\n          {tool === 'draw' ? (\n            <>\n              {/* Brush Type */}\n              <Select\n                value={brushType}\n                onChange={(v) => setBrushType(v as 'hard' | 'soft')}\n                style={{ width: 80 }}\n              >\n                <Option value=\"hard\">Hard</Option>\n                <Option value=\"soft\">Soft</Option>\n              </Select>\n\n              {/* Color Picker */}\n              <ColorPicker value={drawColor} onChange={(c) => setDrawColor(c.toHexString())} />\n\n              {/* Brush Size */}\n              <InputNumber\n                style={{ width: 100 }}\n                min={1}\n                max={500}\n                value={drawLineWidth}\n                onChange={(v) => setDrawLineWidth(v || 1)}\n                addonAfter=\"px\"\n              />\n\n              {/* Opacity */}\n              <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                <span\n                  onMouseDown={handleOpacityLabelMouseDown}\n                  style={{ cursor: 'ew-resize', userSelect: 'none' }}\n                  title=\"Drag left/right to change opacity\"\n                >\n                  Opacity:\n                </span>\n                <InputNumber\n                  min={0}\n                  max={1}\n                  step={0.01}\n                  style={{ width: 60 }}\n                  value={brushOpacity}\n                  onChange={(v) => setBrushOpacity(v || 0)}\n                />\n              </div>\n\n              {/* Flow */}\n              <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                <span\n                  onMouseDown={handleFlowLabelMouseDown}\n                  style={{ cursor: 'ew-resize', userSelect: 'none' }}\n                  title=\"Drag left/right to change flow\"\n                >\n                  Flow:\n                </span>\n                <InputNumber\n                  min={0}\n                  max={1}\n                  step={0.01}\n                  style={{ width: 60 }}\n                  value={brushFlow}\n                  onChange={(v) => setBrushFlow(v || 0)}\n                />\n              </div>\n            </>\n          ) : null}\n\n          {tool === 'text' ? (\n            <>\n              {/* Text tool controls */}\n              {/* Text placement and editing handled on-canvas; toolbar shows controls only */}\n\n              <Select\n                value={textFont || 'Arial'}\n                onChange={(v) => setTextFont && setTextFont(v)}\n                style={{ width: 100 }}\n              >\n                <Option value=\"Arial\">Arial</Option>\n                <Option value=\"Helvetica\">Helvetica</Option>\n                <Option value=\"Times New Roman\">Times New Roman</Option>\n                <Option value=\"Courier New\">Courier New</Option>\n                <Option value=\"Georgia\">Georgia</Option>\n                <Option value=\"Verdana\">Verdana</Option>\n              </Select>\n\n              <InputNumber\n                min={8}\n                max={200}\n                value={textFontSize || 32}\n                onChange={(v) => setTextFontSize && setTextFontSize(v || 32)}\n                addonAfter=\"px\"\n                style={{ width: 90 }}\n              />\n\n              <ColorPicker\n                value={textColor || '#000000'}\n                onChange={(c) => setTextColor && setTextColor(c.toHexString())}\n              />\n\n              <Select\n                value={textWeight || 'normal'}\n                onChange={(v) => setTextWeight && setTextWeight(v)}\n                style={{ width: 80 }}\n              >\n                <Option value=\"lighter\">Lighter</Option>\n                <Option value=\"normal\">Normal</Option>\n                <Option value=\"bold\">Bold</Option>\n                <Option value=\"900\">900</Option>\n              </Select>\n\n              <Tooltip title=\"Italic\">\n                <Button\n                  size=\"small\"\n                  icon={<ItalicOutlined />}\n                  type={textItalic ? 'primary' : 'default'}\n                  onClick={() => setTextItalic && setTextItalic(!textItalic)}\n                />\n              </Tooltip>\n\n              <Select\n                value={textDecoration || 'none'}\n                onChange={(v) => setTextDecoration && setTextDecoration(v as any)}\n                style={{ width: 100 }}\n              >\n                <Option value=\"none\">No decoration</Option>\n                <Option value=\"underline\">Underline</Option>\n                <Option value=\"line-through\">Strike</Option>\n              </Select>\n\n              <Tooltip title=\"Align\">\n                <Space size=\"small\">\n                  <Button\n                    size=\"small\"\n                    icon={<AlignLeftOutlined />}\n                    type={textAlign === 'left' ? 'primary' : 'default'}\n                    onClick={() => setTextAlign && setTextAlign('left')}\n                  />\n                  <Button\n                    size=\"small\"\n                    icon={<AlignCenterOutlined />}\n                    type={textAlign === 'center' ? 'primary' : 'default'}\n                    onClick={() => setTextAlign && setTextAlign('center')}\n                  />\n                  <Button\n                    size=\"small\"\n                    icon={<AlignRightOutlined />}\n                    type={textAlign === 'right' ? 'primary' : 'default'}\n                    onClick={() => setTextAlign && setTextAlign('right')}\n                  />\n                </Space>\n              </Tooltip>\n\n              {/* add button removed — placement via canvas click */}\n            </>\n          ) : null}\n\n          {tool === 'layer' ? (\n            <>\n              {/* Layer controls (select + actions + opacity/blend for active) */}\n              {layers && layers.length > 0 && (\n                <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                    <span style={{ fontSize: 12, fontWeight: 600 }}>Layers</span>\n                    <Select\n                      value={activeLayerId || undefined}\n                      placeholder=\"Select layer\"\n                      onChange={(v) => selectLayer && selectLayer(v as string)}\n                      style={{ width: 180 }}\n                      showSearch\n                    >\n                      {layers\n                        .slice()\n                        .reverse()\n                        .map((L) => (\n                          <Option key={L.id} value={L.id} label={`Layer ${L.id}`}>\n                            <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                              {L.img && (\n                                <img\n                                  src={L.img?.src}\n                                  alt=\"\"\n                                  style={{ width: 40, height: 28, objectFit: 'cover' }}\n                                />\n                              )}\n                              {L.text && <FontColorsOutlined />}\n                              <span style={{ fontSize: 12 }}>{L.id}</span>\n                            </div>\n                          </Option>\n                        ))}\n                    </Select>\n                  </div>\n\n                  <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\n                    <Button\n                      size=\"small\"\n                      icon={<MergeCellsOutlined />}\n                      onClick={() => mergeLayer && mergeLayer()}\n                    >\n                      Merge All\n                    </Button>\n                  </div>\n\n                  {/* per-active-layer actions */}\n                  {activeLayerId &&\n                    (() => {\n                      const active = layers.find((l) => l.id === activeLayerId);\n                      if (!active) return null;\n                      return (\n                        <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\n                          <Button\n                            size=\"small\"\n                            icon={<MergeCellsOutlined />}\n                            onClick={() => mergeLayer && mergeLayer(active.id)}\n                          >\n                            Merge\n                          </Button>\n                          <Button\n                            size=\"small\"\n                            icon={<UpOutlined />}\n                            onClick={() => moveLayerUp && moveLayerUp(active.id)}\n                          />\n                          <Button\n                            size=\"small\"\n                            icon={<DownOutlined />}\n                            onClick={() => moveLayerDown && moveLayerDown(active.id)}\n                          />\n                          <Button\n                            size=\"small\"\n                            danger\n                            icon={<DeleteOutlined />}\n                            onClick={() => deleteLayer && deleteLayer(active.id)}\n                          />\n\n                          {/* opacity & blend controls */}\n                          <div\n                            style={{ display: 'flex', alignItems: 'center', gap: 8, marginLeft: 8 }}\n                          >\n                            <span\n                              onMouseDown={handleOpacityLabelMouseDown}\n                              style={{ cursor: 'ew-resize', userSelect: 'none' }}\n                              title=\"Drag left/right to change opacity\"\n                            >\n                              Opacity:\n                            </span>\n                            <InputNumber\n                              min={0}\n                              max={1}\n                              step={0.01}\n                              style={{ width: 80 }}\n                              value={Number(active.opacity.toFixed(2))}\n                              onChange={(v) =>\n                                setLayerOpacity && setLayerOpacity(active.id, Number(v || 0))\n                              }\n                            />\n                          </div>\n\n                          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                            <span style={{ userSelect: 'none' }}>Blend:</span>\n                            <Select\n                              value={active.blend || 'source-over'}\n                              onChange={(v) =>\n                                setLayerBlend &&\n                                setLayerBlend(active.id, v as GlobalCompositeOperation)\n                              }\n                              style={{ width: 140 }}\n                            >\n                              <Option value=\"source-over\">Normal</Option>\n                              <Option value=\"multiply\">Multiply</Option>\n                              <Option value=\"screen\">Screen</Option>\n                              <Option value=\"overlay\">Overlay</Option>\n                              <Option value=\"lighter\">Lighten</Option>\n                              <Option value=\"darken\">Darken</Option>\n                            </Select>\n                          </div>\n                        </div>\n                      );\n                    })()}\n                </div>\n              )}\n            </>\n          ) : null}\n        </Space>\n      </Space>\n    </div>\n  );\n};\n\nexport default TopEditorToolbar;\n","//#region Imports\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\nimport { Modal, message } from 'antd';\n\nimport useCanvas from '../../hooks/useCanvas';\nimport useHistory from '../../hooks/useHistory';\nimport {\n  applyCrop,\n  rotate,\n  samplePixel,\n  addOverlayImage,\n  drawOverlayHelper,\n  exportWithOverlay as helperExportWithOverlay,\n  mergeLayerIntoBase as helperMergeLayerIntoBase,\n  setLayerOpacity as helperSetLayerOpacity,\n  setLayerBlend as helperSetLayerBlend,\n  moveLayerUp as helperMoveLayerUp,\n  moveLayerDown as helperMoveLayerDown,\n  deleteLayer as helperDeleteLayer,\n  selectLayer as helperSelectLayer,\n  perspectiveApplyHelper,\n  addTextLayer as helperAddTextLayer,\n  setLayerText as helperSetLayerText,\n  setLayerFont as helperSetLayerFont,\n  setLayerFontSize as helperSetLayerFontSize,\n  setLayerFontWeight as helperSetLayerFontWeight,\n  setLayerFontItalic as helperSetLayerFontItalic,\n  setLayerTextDecoration as helperSetLayerTextDecoration,\n  setLayerTextColor as helperSetLayerTextColor,\n  setLayerTextAlign as helperSetLayerTextAlign,\n  createTextEditorOverlay,\n  applyUpscale,\n  applyInvertColors,\n  applyColorRemoval,\n} from '../../utils/helpers';\nimport ImageCanvas from './ImageCanvas';\nimport ColorRemovalModal from './ColorRemovalModal';\nimport ImageEditorToolbar from './SideEditorToolbar';\nimport TopEditorToolbar from './TopEditorToolbar';\n//#endregion\n\n//#region Types\nexport type Tool =\n  | 'pan'\n  | 'crop'\n  | 'color'\n  | 'ruler'\n  | 'perspective'\n  | 'select'\n  | 'draw'\n  | 'layer'\n  | 'upscale'\n  | 'text'\n  | 'removeColor';\n\ntype Props = {\n  imageUrl: string;\n  addOnFile?: File | null;\n  setAddOnFile: React.Dispatch<React.SetStateAction<File | null>>;\n  onExport?: (blob: Blob) => void;\n};\n//#endregion\n\nconst ImageEditor: React.FC<Props> = ({ imageUrl, addOnFile, setAddOnFile, onExport }) => {\n  //#region Canvas Setup\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const onLoad = (dataUrl: string) => history.push(dataUrl, 'Initial load');\n  const { canvasRef, overlayRef, baseCanvas, setBaseCanvas, syncCanvasSize } = useCanvas(\n    imageUrl,\n    onLoad,\n  );\n  const history = useHistory(canvasRef, overlayRef);\n  //#endregion\n\n  //#region Viewer State (pan/zoom)\n  const [zoom, setZoom] = useState(1);\n  const [offset, setOffset] = useState({ x: 0, y: 0 });\n  const [isPanning, setIsPanning] = useState(false);\n  const panStart = useRef<{ x: number; y: number } | null>(null);\n  //#endregion\n\n  //#region Active Tool\n  const [tool, setTool] = useState<Tool>('pan');\n  //#endregion\n\n  //#region Image Adjustments\n  const [brightness, setBrightness] = useState(0);\n  const [contrast, setContrast] = useState(0);\n\n  const [highlights, setHighlights] = useState(0);\n  const [shadows, setShadows] = useState(0);\n  const [whites, setWhites] = useState(0);\n  const [blacks, setBlacks] = useState(0);\n\n  const [vibrance, setVibrance] = useState(0);\n  const [saturation, setSaturation] = useState(0);\n\n  const [dehaze, setDehaze] = useState(0);\n  //#endregion\n\n  //#region Crop Tool\n  const [cropRect, setCropRect] = useState<{ x: number; y: number; w: number; h: number } | null>(\n    null,\n  );\n  const cropStart = useRef<{ x: number; y: number } | null>(null);\n  //#endregion\n\n  //#region Perspective Tool\n  const [showPerspectiveModal, setShowPerspectiveModal] = useState(false);\n\n  // initialize to NaN pairs so we can detect \"empty\" slots\n  const perspectivePoints = useRef<\n    [number, number, number, number, number, number, number, number] | null\n  >(null);\n\n  // helper: ensure we have an array of 8 numbers (NaNs if empty)\n  const ensurePerspectiveInit = () => {\n    if (!perspectivePoints.current) {\n      perspectivePoints.current = [NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN];\n    }\n  };\n\n  // helper: find index of a \"near\" point (within tolerance), else -1\n  const findNearPointIndex = (x: number, y: number, tol = 12) => {\n    if (!perspectivePoints.current) return -1;\n    const p = perspectivePoints.current;\n    for (let i = 0; i < 8; i += 2) {\n      const px = p[i];\n      const py = p[i + 1];\n      if (!isNaN(px) && !isNaN(py)) {\n        const dx = px - x;\n        const dy = py - y;\n        if (Math.sqrt(dx * dx + dy * dy) <= tol) return i;\n      }\n    }\n    return -1;\n  };\n  //#endregion\n\n  //#region Hotkey States\n  const [toolBefore, setToolBefore] = useState<Tool | null>(null);\n  const [isSpaceDown, setIsSpaceDown] = useState(false);\n  const [isAltDown, setIsAltDown] = useState(false);\n  const [isShiftDown, setIsShiftDown] = useState(false);\n  //#endregion\n\n  //#region Color Picker\n  const [hoverColor, setHoverColor] = useState<{ x: number; y: number; color: string } | null>(\n    null,\n  );\n  const [pickedColor, setPickedColor] = useState<string | null>(null);\n  //#endregion\n\n  //#region Color Removal Tool\n  const [showColorRemovalModal, setShowColorRemovalModal] = useState(false);\n  const [selectedColorForRemoval, setSelectedColorForRemoval] = useState<string | null>(null);\n  //#endregion\n\n  //#region Ruler Tool\n  const rulerPoints = useRef<{ x1: number; y1: number; x2: number; y2: number } | null>(null);\n  const [dpiMeasured, setDpiMeasured] = useState<number | null>(null);\n  //#endregion\n\n  //#region Overlay Image & Text (added)\n  type Layer = {\n    id: string;\n    type: 'image' | 'text'; // distinguish between image and text layers\n    img?: HTMLImageElement; // for image layers\n    rect: { x: number; y: number; w: number; h: number };\n    opacity: number;\n    blend: GlobalCompositeOperation;\n    rotation?: number; // rotation angle in degrees\n    // Text layer properties\n    text?: string;\n    font?: string; // e.g., 'Arial', 'Helvetica'\n    fontSize?: number; // in pixels\n    fontWeight?:\n      | 'normal'\n      | 'bold'\n      | 'lighter'\n      | '100'\n      | '200'\n      | '300'\n      | '400'\n      | '500'\n      | '600'\n      | '700'\n      | '800'\n      | '900';\n    fontItalic?: boolean;\n    textDecoration?: 'none' | 'underline' | 'line-through';\n    textColor?: string; // hex or rgb color\n    textAlign?: 'left' | 'center' | 'right';\n    locked?: boolean;\n  };\n\n  const [layers, setLayers] = useState<Layer[]>([]);\n  const [activeLayerId, setActiveLayerId] = useState<string | null>(null);\n  const [overlaySelected, setOverlaySelected] = useState(false);\n\n  // Text tool controls\n  const [textContent, setTextContent] = useState('');\n  const [textFont, setTextFont] = useState('Arial');\n  const [textFontSize, setTextFontSize] = useState(32);\n  const [textColor, setTextColor] = useState('#000000');\n  const [textWeight, setTextWeight] = useState<Layer['fontWeight']>('normal');\n  const [textItalic, setTextItalic] = useState(false);\n  const [textDecoration, setTextDecoration] = useState<'none' | 'underline' | 'line-through'>(\n    'none',\n  );\n  const [textAlign, setTextAlign] = useState<'left' | 'center' | 'right'>('left');\n  const [isAddingText, setIsAddingText] = useState(false); // track if user clicked to place text\n  const overlayDrag = useRef<null | {\n    layerId: string;\n    startX: number;\n    startY: number;\n    origX: number;\n    origY: number;\n  }>(null);\n  const inlineEditorRef = useRef<HTMLTextAreaElement | null>(null);\n  const overlayResize = useRef<null | {\n    layerId: string;\n    handle: 'tl' | 'tr' | 'bl' | 'br' | 't' | 'b' | 'l' | 'r';\n    startX: number;\n    startY: number;\n    orig: { x: number; y: number; w: number; h: number };\n  }>(null);\n  const overlayRotate = useRef<null | {\n    layerId: string;\n    startX: number;\n    startY: number;\n    centerX: number;\n    centerY: number;\n    startAngle: number;\n    originalRotation: number;\n  }>(null);\n  //#endregion\n  //#endregion\n\n  // --- overlay image handlers (delegated to helpers) ---\n  useEffect(() => {\n    if (addOnFile) {\n      onAddImage(addOnFile);\n      setAddOnFile(null);\n    }\n  }, [addOnFile]);\n\n  // Ensure base overlay layer exists (locked, opacity 0) so overlay tools can reference it\n  useEffect(() => {\n    if (!baseCanvas) return;\n    setLayers((prev) => {\n      if (prev[0] && prev[0].locked) return prev;\n      const img = new Image();\n      img.src = baseCanvas.toDataURL();\n      const id = `base_overlay_${Date.now()}`;\n      const baseLayer = {\n        id,\n        type: 'image' as const,\n        img,\n        rect: { x: 0, y: 0, w: baseCanvas.width, h: baseCanvas.height },\n        opacity: 0,\n        blend: 'source-over' as const,\n        locked: true,\n      } as any;\n      return [baseLayer, ...prev];\n    });\n    // redraw overlay and sync sizes\n    setTimeout(() => {\n      try {\n        syncCanvasSize();\n        drawOverlay();\n      } catch (_) {}\n    }, 50);\n  }, [baseCanvas]);\n\n  const onAddImage = (file: File) =>\n    addOverlayImage(\n      file,\n      canvasRef,\n      setLayers,\n      setActiveLayerId,\n      setOverlaySelected,\n      drawOverlay,\n      setTool,\n    );\n\n  const exportWithOverlay = async (\n    asJpeg: boolean,\n    canvasRefArg: React.RefObject<HTMLCanvasElement>,\n    callback?: (blob: Blob) => void,\n    includeOverlays: boolean = true,\n  ) => helperExportWithOverlay(asJpeg, canvasRefArg, includeOverlays ? layers : [], callback);\n\n  // Merge active layer into base canvas and record history\n  const mergeLayerIntoBase = (id?: string) =>\n    helperMergeLayerIntoBase(canvasRef, layers, setLayers, history, id);\n\n  // Layer controls\n  const setLayerOpacity = (id: string, opacity: number) =>\n    helperSetLayerOpacity(setLayers, id, opacity);\n  const setLayerBlend = (id: string, blend: GlobalCompositeOperation) =>\n    helperSetLayerBlend(setLayers, id, blend);\n  const moveLayerUp = (id: string) => helperMoveLayerUp(setLayers, id);\n  const moveLayerDown = (id: string) => helperMoveLayerDown(setLayers, id);\n  const deleteLayer = (id: string) => helperDeleteLayer(setLayers, id, setActiveLayerId);\n  const selectLayer = (id: string) => {\n    helperSelectLayer(setActiveLayerId, id);\n    setOverlaySelected(true);\n    // when selecting a text layer, populate toolbar globals so controls reflect the layer\n    const layer = layers.find((l) => l.id === id);\n    if (layer && layer.type === 'text') {\n      setTextContent(layer.text || '');\n      setTextFont(layer.font || 'Arial');\n      setTextFontSize(layer.fontSize || 32);\n      setTextColor(layer.textColor || '#000000');\n      setTextWeight(layer.fontWeight || 'normal');\n      setTextItalic(Boolean(layer.fontItalic));\n      setTextDecoration((layer.textDecoration as any) || 'none');\n      setTextAlign((layer.textAlign as any) || 'left');\n    }\n  };\n\n  // Text tool callbacks\n  // Start placement mode; actual layer will be created when user clicks canvas\n  const onAddTextLayer = () => {\n    setIsAddingText(true);\n    message.info('Click on the image to place the text');\n  };\n\n  const updateTextContent = (id: string, text: string) => helperSetLayerText(setLayers, id, text);\n  const updateTextFont = (id: string, font: string) => helperSetLayerFont(setLayers, id, font);\n  const updateTextFontSize = (id: string, size: number) =>\n    helperSetLayerFontSize(setLayers, id, size);\n  const updateTextWeight = (id: string, weight: any) =>\n    helperSetLayerFontWeight(setLayers, id, weight);\n  const updateTextItalic = (id: string, italic: boolean) =>\n    helperSetLayerFontItalic(setLayers, id, italic);\n  const updateTextDecoration = (id: string, decoration: 'none' | 'underline' | 'line-through') =>\n    helperSetLayerTextDecoration(setLayers, id, decoration);\n  const updateTextColor = (id: string, color: string) =>\n    helperSetLayerTextColor(setLayers, id, color);\n  const updateTextAlign = (id: string, align: 'left' | 'center' | 'right') =>\n    helperSetLayerTextAlign(setLayers, id, align);\n\n  // wrapper setters: if an active layer (text) exists, update that layer; otherwise modify global defaults\n  const handleSetTextContent = (v: string) => {\n    const active = layers.find((l) => l.id === activeLayerId);\n    if (active && active.type === 'text') updateTextContent(active.id, v);\n    else setTextContent(v);\n  };\n  const handleSetTextFont = (v: string) => {\n    const active = layers.find((l) => l.id === activeLayerId);\n    if (active && active.type === 'text') updateTextFont(active.id, v);\n    else setTextFont(v);\n  };\n  const handleSetTextFontSize = (v: number) => {\n    const active = layers.find((l) => l.id === activeLayerId);\n    if (active && active.type === 'text') updateTextFontSize(active.id, v);\n    else setTextFontSize(v);\n  };\n  const handleSetTextWeight = (v: any) => {\n    const active = layers.find((l) => l.id === activeLayerId);\n    if (active && active.type === 'text') updateTextWeight(active.id, v);\n    else setTextWeight(v);\n  };\n  const handleSetTextItalic = (v: boolean) => {\n    const active = layers.find((l) => l.id === activeLayerId);\n    if (active && active.type === 'text') updateTextItalic(active.id, v);\n    else setTextItalic(v);\n  };\n  const handleSetTextDecoration = (v: 'none' | 'underline' | 'line-through') => {\n    const active = layers.find((l) => l.id === activeLayerId);\n    if (active && active.type === 'text') updateTextDecoration(active.id, v);\n    else setTextDecoration(v);\n  };\n  const handleSetTextColor = (v: string) => {\n    const active = layers.find((l) => l.id === activeLayerId);\n    if (active && active.type === 'text') updateTextColor(active.id, v);\n    else setTextColor(v);\n  };\n  const handleSetTextAlign = (v: 'left' | 'center' | 'right') => {\n    const active = layers.find((l) => l.id === activeLayerId);\n    if (active && active.type === 'text') updateTextAlign(active.id, v);\n    else setTextAlign(v);\n  };\n\n  //#region Upscale\n  // Upscale whole image: delegated to helpers.applyUpscale\n  const upscaleImage = (\n    factor: number,\n    preset?: 'low' | 'medium' | 'high',\n    qualityOptions?: { sharpen?: number; edgeEnhancement?: number; denoise?: number },\n  ) =>\n    applyUpscale(\n      canvasRef,\n      overlayRef,\n      history,\n      setBaseCanvas,\n      setLayers,\n      drawOverlay,\n      factor,\n      preset,\n      qualityOptions,\n    );\n  //#endregion\n\n  //#region Sync base canvas when in upscaled mode\n  useEffect(() => {\n    if (!canvasRef.current) return;\n\n    if (!history.history[history.index]?.isSetBase) return;\n\n    const src = canvasRef.current;\n    const c = document.createElement('canvas');\n    c.width = src.width;\n    c.height = src.height;\n    c.getContext('2d')!.drawImage(src, 0, 0);\n\n    setBaseCanvas(c);\n    setLayers((prev) => {\n      if (!prev[0]) return prev;\n      const base = { ...prev[0] };\n      if (base.img) base.img.src = c.toDataURL();\n      base.rect = { x: 0, y: 0, w: c.width, h: c.height };\n      // base.opacity = 1;\n      return [base, ...prev.slice(1)];\n    });\n\n    if (overlayRef.current) {\n      overlayRef.current.width = c.width;\n      overlayRef.current.height = c.height;\n    }\n\n    drawOverlay();\n  }, [history.index]);\n  //#endregion\n\n  //#region Drawing Tool\n  const [drawColor, setDrawColor] = useState('#ff0000');\n  const [drawLineWidth, setDrawLineWidth] = useState(2);\n  const [brushType, setBrushType] = useState<'hard' | 'soft'>('hard');\n  const [brushOpacity, setBrushOpacity] = useState(1); // 0 - 1\n  const [brushFlow, setBrushFlow] = useState(1); // 0 - 1\n  const [isDrawing, setIsDrawing] = useState(false);\n  const drawPoints = useRef<{ x: number; y: number }[]>([]);\n  const resizingBrush = useRef(false);\n  const resizeStartX = useRef<number | null>(null);\n  const initialLineWidth = useRef(drawLineWidth);\n\n  //#endregion\n\n  //#region Filters\n  const [blur, setBlur] = useState(0);\n  const [gaussian, setGaussian] = useState(0);\n  const [sharpen, setSharpen] = useState(0);\n  const [texture, setTexture] = useState(0);\n  const [clarity, setClarity] = useState(0);\n\n  const [bgThreshold, setBgThreshold] = useState(0);\n  const [bgThresholdBlack, setBgThresholdBlack] = useState(0);\n\n  const [hslAdjustments, setHslAdjustmentsState] = useState<\n    Record<string, { h?: number; s?: number; l?: number }>\n  >({});\n  const setHslAdjustments = (\n    name: string,\n    values: Partial<{ h: number; s: number; l: number }>,\n  ) => {\n    setHslAdjustmentsState((prev) => ({\n      ...prev,\n      [name]: { ...(prev[name] || {}), ...values },\n    }));\n  };\n\n  //#endregion\n\n  //#region Event Effects & Handlers\n  // #region 🖱️ Disable Right-Click Context Menu\n  useEffect(() => {\n    const canvas = containerRef.current;\n    if (!canvas) return;\n    const handleContextMenu = (e: MouseEvent) => e.preventDefault();\n    canvas.addEventListener('contextmenu', handleContextMenu);\n    return () => canvas.removeEventListener('contextmenu', handleContextMenu);\n  }, []);\n  //#endregion\n\n  // #region 🔍 Ctrl + Wheel Zoom Handler\n  useEffect(() => {\n    const container = containerRef.current;\n    const canvas = canvasRef.current;\n    if (!container || !canvas) return;\n\n    const handleWheel = (e: WheelEvent) => {\n      if (!e.ctrlKey) return;\n      e.preventDefault();\n\n      const rect = canvas.getBoundingClientRect();\n      const mouseX = e.clientX - rect.left;\n      const mouseY = e.clientY - rect.top;\n\n      setZoom((prev) => {\n        const zoomFactor = e.deltaY < 0 ? 1.1 : 0.9;\n        const newZoom = Math.min(Math.max(prev * zoomFactor, 0.1), 12);\n\n        const scaleChange = newZoom / prev;\n        setOffset((prevOffset) => ({\n          x: mouseX - (mouseX - prevOffset.x) * scaleChange,\n          y: mouseY - (mouseY - prevOffset.y) * scaleChange,\n        }));\n\n        return newZoom;\n      });\n    };\n\n    container.addEventListener('wheel', handleWheel, { passive: false });\n    return () => container.removeEventListener('wheel', handleWheel);\n  }, []);\n  //#endregion\n\n  //#region 🖲️ Mouse Events (Down/Move/Up for Tools)\n  const handleMouseDownViewer = (e: React.MouseEvent) => {\n    const rect = canvasRef.current!.getBoundingClientRect();\n    const x = (e.clientX - rect.left) / zoom;\n    const y = (e.clientY - rect.top) / zoom;\n    const canvasRect = rect;\n    // helper: create inline textarea overlay at canvas coords\n    const createEditorAt = (\n      canvasX: number,\n      canvasY: number,\n      initial = '',\n      opts?: { layerId?: string; layer?: any },\n    ) => {\n      createTextEditorOverlay({\n        canvasX,\n        canvasY,\n        canvasRect,\n        containerRef,\n        inlineEditorRef,\n        zoom,\n        initial,\n        layerId: opts?.layerId,\n        layer: opts?.layer,\n        textColor,\n        textFont,\n        textFontSize,\n        textWeight,\n        textItalic,\n        onCommit: (val) => {\n          if (opts && opts.layerId) {\n            // editing existing layer\n            helperSetLayerText(setLayers, opts.layerId, val);\n            drawOverlay();\n          } else {\n            // add layer with position in canvas coords\n            helperAddTextLayer(\n              canvasRef,\n              setLayers,\n              setActiveLayerId,\n              setOverlaySelected,\n              drawOverlay,\n              {\n                text: val,\n                font: textFont,\n                fontSize: textFontSize,\n                fontWeight: textWeight,\n                fontItalic: textItalic,\n                textDecoration: textDecoration,\n                textColor: textColor,\n                textAlign: textAlign,\n              },\n              { x: canvasX, y: canvasY },\n            );\n          }\n          setIsAddingText(false);\n        },\n        onCancel: () => {\n          setIsAddingText(false);\n        },\n      });\n    };\n\n    // Helper to transform point by rotation around center\n    const rotatePoint = (px: number, py: number, cx: number, cy: number, angle: number) => {\n      const rad = (angle * Math.PI) / 180;\n      const cos = Math.cos(rad);\n      const sin = Math.sin(rad);\n      const dx = px - cx;\n      const dy = py - cy;\n      return {\n        x: cx + dx * cos - dy * sin,\n        y: cy + dx * sin + dy * cos,\n      };\n    };\n\n    // overlay hit-test (priority: if clicking overlay and not using pan tool)\n    // overlay hit-test (topmost first)\n    if (layers.length > 0) {\n      for (let i = layers.length - 1; i >= 0; i--) {\n        const L = layers[i];\n        const r = L.rect;\n        const rotation = L.rotation || 0;\n        const centerX = r.x + r.w / 2;\n        const centerY = r.y + r.h / 2;\n\n        // Transform mouse position by inverse rotation to check against unrotated rect\n        const inverseMouse = rotatePoint(x, y, centerX, centerY, -rotation);\n\n        // detect inside area with tolerance\n        const hitTol = 6 / Math.max(1, zoom);\n        const inside =\n          inverseMouse.x >= r.x - hitTol &&\n          inverseMouse.y >= r.y - hitTol &&\n          inverseMouse.x <= r.x + r.w + hitTol &&\n          inverseMouse.y <= r.y + r.h + hitTol;\n        if (!inside) continue;\n\n        // detect corner handles - transform corners to rotated positions\n        const tol = 8 / Math.max(1, zoom);\n        const corners = {\n          tl: rotatePoint(r.x, r.y, centerX, centerY, rotation),\n          tr: rotatePoint(r.x + r.w, r.y, centerX, centerY, rotation),\n          bl: rotatePoint(r.x, r.y + r.h, centerX, centerY, rotation),\n          br: rotatePoint(r.x + r.w, r.y + r.h, centerX, centerY, rotation),\n        };\n        const midpoints = {\n          t: rotatePoint(r.x + r.w / 2, r.y, centerX, centerY, rotation),\n          b: rotatePoint(r.x + r.w / 2, r.y + r.h, centerX, centerY, rotation),\n          l: rotatePoint(r.x, r.y + r.h / 2, centerX, centerY, rotation),\n          r: rotatePoint(r.x + r.w, r.y + r.h / 2, centerX, centerY, rotation),\n        };\n\n        const near = (px: number, py: number) => Math.abs(x - px) <= tol && Math.abs(y - py) <= tol;\n        const tl = near(corners.tl.x, corners.tl.y);\n        const tr = near(corners.tr.x, corners.tr.y);\n        const bl = near(corners.bl.x, corners.bl.y);\n        const br = near(corners.br.x, corners.br.y);\n\n        // If double-clicking a text layer while in text tool, open inline editor for editing\n        if (tool === 'text' && L.type === 'text' && e.detail === 2) {\n          setActiveLayerId(L.id);\n          setOverlaySelected(true);\n          // open editor via helper (edit existing layer)\n          createEditorAt(x, y, L.text || '', { layerId: L.id, layer: L });\n          return;\n        }\n\n        // Allow moving/resizing for layers when tool is 'move', or when tool is 'text' and the layer is a text layer\n        if (tool === 'layer' || (tool === 'text' && L.type === 'text')) {\n          setActiveLayerId(L.id);\n          setOverlaySelected(true);\n\n          // Check for midpoint handles (using rotated positions)\n          const midT = near(midpoints.t.x, midpoints.t.y);\n          const midB = near(midpoints.b.x, midpoints.b.y);\n          const midL = near(midpoints.l.x, midpoints.l.y);\n          const midR = near(midpoints.r.x, midpoints.r.y);\n\n          if (midT || midB || midL || midR) {\n            const handle = midT ? 't' : midB ? 'b' : midL ? 'l' : 'r';\n            overlayResize.current = {\n              layerId: L.id,\n              handle,\n              startX: x,\n              startY: y,\n              orig: { ...r },\n            } as any;\n            return;\n          }\n\n          if (tl || tr || bl || br) {\n            // Check if holding Shift for rotation in corners\n            if (e.shiftKey) {\n              const startAngle = Math.atan2(y - centerY, x - centerX);\n              overlayRotate.current = {\n                layerId: L.id,\n                startX: x,\n                startY: y,\n                centerX,\n                centerY,\n                startAngle,\n                originalRotation: L.rotation || 0,\n              };\n              return;\n            }\n\n            const handle = tl ? 'tl' : tr ? 'tr' : bl ? 'bl' : 'br';\n            overlayResize.current = {\n              layerId: L.id,\n              handle,\n              startX: x,\n              startY: y,\n              orig: { ...r },\n            } as any;\n            return;\n          }\n          overlayDrag.current = {\n            layerId: L.id,\n            startX: x,\n            startY: y,\n            origX: r.x,\n            origY: r.y,\n          } as any;\n          return;\n        }\n        // if pan tool, ignore overlay so pan will take effect\n        break;\n      }\n      // if clicked outside any layer\n      setOverlaySelected(false);\n    }\n\n    if (tool === 'color' && e.altKey && e.button === 2) setTool('draw');\n    // ALT + right button for brush resize\n    if ((tool === 'draw' || tool === 'color') && e.altKey && e.button === 2) {\n      e.preventDefault();\n      resizingBrush.current = true;\n      resizeStartX.current = e.clientX;\n      initialLineWidth.current = drawLineWidth;\n      return;\n    }\n\n    if (tool === 'pan' || tool === 'select') {\n      setIsPanning(true);\n      panStart.current = { x: e.clientX - offset.x, y: e.clientY - offset.y };\n    } else if (tool === 'crop') {\n      cropStart.current = { x, y };\n      setCropRect({ x, y, w: 1, h: 1 });\n    } else if (tool === 'ruler') {\n      if (!rulerPoints.current) {\n        rulerPoints.current = { x1: x, y1: y, x2: x, y2: y };\n      } else {\n        rulerPoints.current.x2 = x;\n        rulerPoints.current.y2 = y;\n        const dx = x - rulerPoints.current.x1;\n        const dy = y - rulerPoints.current.y1;\n        const px = Math.sqrt(dx * dx + dy * dy);\n        const dpi = Math.round(\n          (px / (canvasRef.current!.width / (window.devicePixelRatio || 1))) * 96,\n        );\n        setDpiMeasured(dpi);\n        message.info(`Distance: ${Math.round(px)} px, estimated DPI: ${dpi}`);\n        rulerPoints.current = null;\n      }\n    } else if (tool === 'perspective') {\n      // initialize if needed\n      ensurePerspectiveInit();\n\n      // if click near an existing point, replace/move it\n      const nearIdx = findNearPointIndex(x, y);\n      if (nearIdx >= 0) {\n        // move existing point\n        perspectivePoints.current![nearIdx] = x;\n        perspectivePoints.current![nearIdx + 1] = y;\n        drawOverlay();\n        return;\n      }\n\n      // otherwise, fill first empty (NaN) slot\n      const p = perspectivePoints.current!;\n      let placed = false;\n      for (let i = 0; i < 8; i += 2) {\n        if (isNaN(p[i]) || isNaN(p[i + 1])) {\n          p[i] = x;\n          p[i + 1] = y;\n          placed = true;\n          break;\n        }\n      }\n      // if all filled and user clicks again, cycle replace the nearest point\n      if (!placed) {\n        const nearest = findNearPointIndex(x, y, 200); // large tol to find nearest\n        if (nearest >= 0) {\n          perspectivePoints.current![nearest] = x;\n          perspectivePoints.current![nearest + 1] = y;\n        } else {\n          // replace index 0 (wrap) if nothing better\n          perspectivePoints.current![0] = x;\n          perspectivePoints.current![1] = y;\n        }\n      }\n\n      drawOverlay();\n    } else if (tool === 'draw') {\n      setIsDrawing(true);\n      drawPoints.current = [{ x, y }];\n    } else if (tool === 'text') {\n      // If text tool is active and user clicked empty canvas, open inline editor to place new text\n      createEditorAt(x, y, textContent || '');\n      return;\n    }\n  };\n\n  const handleMouseMoveViewer = (e: React.MouseEvent) => {\n    if (resizingBrush.current && resizeStartX.current !== null) {\n      const deltaX = e.clientX - resizeStartX.current;\n      const newWidth = Math.max(\n        1,\n        Math.round(Math.min(500, initialLineWidth.current + deltaX / 2) * 10) / 10,\n      );\n      setDrawLineWidth(newWidth);\n      drawOverlay();\n      return;\n    }\n\n    if ((tool === 'pan' || tool === 'select') && isPanning && panStart.current) {\n      setOffset({ x: e.clientX - panStart.current.x, y: e.clientY - panStart.current.y });\n      return;\n    }\n\n    // pointer / handle hover cursors\n    try {\n      const rect = canvasRef.current!.getBoundingClientRect();\n      const cx = (e.clientX - rect.left) / zoom;\n      const cy = (e.clientY - rect.top) / zoom;\n      let foundHandle: 'tl' | 'tr' | 'bl' | 'br' | 't' | 'b' | 'l' | 'r' | 'move' | null = null;\n\n      // Helper to transform point by rotation\n      const rotatePoint = (\n        px: number,\n        py: number,\n        centerX: number,\n        centerY: number,\n        angle: number,\n      ) => {\n        const rad = (angle * Math.PI) / 180;\n        const cos = Math.cos(rad);\n        const sin = Math.sin(rad);\n        const dx = px - centerX;\n        const dy = py - centerY;\n        return {\n          x: centerX + dx * cos - dy * sin,\n          y: centerY + dx * sin + dy * cos,\n        };\n      };\n\n      for (let i = layers.length - 1; i >= 0; i--) {\n        const L = layers[i];\n        const r = L.rect;\n        const rotation = L.rotation || 0;\n        const centerX = r.x + r.w / 2;\n        const centerY = r.y + r.h / 2;\n\n        if (L.locked || (tool !== 'layer' && tool !== 'text')) {\n          foundHandle = null;\n          break;\n        }\n\n        // Transform mouse position by inverse rotation\n        const inverseMouse = rotatePoint(cx, cy, centerX, centerY, -rotation);\n        const inside =\n          inverseMouse.x >= r.x &&\n          inverseMouse.y >= r.y &&\n          inverseMouse.x <= r.x + r.w &&\n          inverseMouse.y <= r.y + r.h;\n\n        const tol = 8 / Math.max(1, zoom);\n\n        // Transform corners and midpoints to rotated positions\n        const corners = {\n          tl: rotatePoint(r.x, r.y, centerX, centerY, rotation),\n          tr: rotatePoint(r.x + r.w, r.y, centerX, centerY, rotation),\n          bl: rotatePoint(r.x, r.y + r.h, centerX, centerY, rotation),\n          br: rotatePoint(r.x + r.w, r.y + r.h, centerX, centerY, rotation),\n        };\n        const midpoints = {\n          t: rotatePoint(r.x + r.w / 2, r.y, centerX, centerY, rotation),\n          b: rotatePoint(r.x + r.w / 2, r.y + r.h, centerX, centerY, rotation),\n          l: rotatePoint(r.x, r.y + r.h / 2, centerX, centerY, rotation),\n          r: rotatePoint(r.x + r.w, r.y + r.h / 2, centerX, centerY, rotation),\n        };\n\n        const near = (px: number, py: number) =>\n          Math.abs(cx - px) <= tol && Math.abs(cy - py) <= tol;\n\n        // Check corners\n        if (near(corners.tl.x, corners.tl.y)) {\n          foundHandle = 'tl';\n          break;\n        }\n        if (near(corners.tr.x, corners.tr.y)) {\n          foundHandle = 'tr';\n          break;\n        }\n        if (near(corners.bl.x, corners.bl.y)) {\n          foundHandle = 'bl';\n          break;\n        }\n        if (near(corners.br.x, corners.br.y)) {\n          foundHandle = 'br';\n          break;\n        }\n\n        // Check midpoints\n        if (near(midpoints.t.x, midpoints.t.y)) {\n          foundHandle = 't';\n          break;\n        }\n        if (near(midpoints.b.x, midpoints.b.y)) {\n          foundHandle = 'b';\n          break;\n        }\n        if (near(midpoints.l.x, midpoints.l.y)) {\n          foundHandle = 'l';\n          break;\n        }\n        if (near(midpoints.r.x, midpoints.r.y)) {\n          foundHandle = 'r';\n          break;\n        }\n\n        if (inside) {\n          foundHandle = 'move';\n          break;\n        }\n      }\n\n      if (containerRef.current) {\n        if (!foundHandle) {\n          containerRef.current.style.cursor = currentCursor;\n        } else if (foundHandle === 'move') {\n          containerRef.current.style.cursor = 'move';\n        } else if (foundHandle === 't' || foundHandle === 'b') {\n          containerRef.current.style.cursor = 'ns-resize';\n        } else if (foundHandle === 'l' || foundHandle === 'r') {\n          containerRef.current.style.cursor = 'ew-resize';\n        } else if (\n          e.shiftKey &&\n          (foundHandle === 'tl' ||\n            foundHandle === 'tr' ||\n            foundHandle === 'bl' ||\n            foundHandle === 'br')\n        ) {\n          // Show rotation cursor when shift is held over corners\n          containerRef.current.style.cursor = 'crosshair';\n        } else if (foundHandle === 'tl' || foundHandle === 'br') {\n          containerRef.current.style.cursor = 'nwse-resize';\n        } else {\n          containerRef.current.style.cursor = 'nesw-resize';\n        }\n      }\n    } catch (err) {\n      // ignore\n    }\n\n    // overlay dragging\n    const od = overlayDrag.current;\n    if (od) {\n      const rect = canvasRef.current!.getBoundingClientRect();\n      const cx = (e.clientX - rect.left) / zoom;\n      const cy = (e.clientY - rect.top) / zoom;\n      const dx = cx - od.startX;\n      const dy = cy - od.startY;\n      setLayers((prev) =>\n        prev.map((L) =>\n          L.id === od.layerId && !L.locked\n            ? { ...L, rect: { x: od.origX + dx, y: od.origY + dy, w: L.rect.w, h: L.rect.h } }\n            : L,\n        ),\n      );\n      drawOverlay();\n      return;\n    } else if (tool === 'crop' && cropStart.current) {\n      const rect = canvasRef.current!.getBoundingClientRect();\n      const cur = { x: (e.clientX - rect.left) / zoom, y: (e.clientY - rect.top) / zoom };\n      setCropRect({\n        x: Math.min(cropStart.current.x, cur.x),\n        y: Math.min(cropStart.current.y, cur.y),\n        w: Math.abs(cur.x - cropStart.current.x),\n        h: Math.abs(cur.y - cropStart.current.y),\n      });\n      drawOverlay();\n    } else if (tool === 'draw' && isDrawing && canvasRef.current) {\n      const rect = canvasRef.current.getBoundingClientRect();\n      const x = (e.clientX - rect.left) / zoom;\n      const y = (e.clientY - rect.top) / zoom;\n\n      drawPoints.current.push({ x, y });\n\n      const ctx = canvasRef.current.getContext('2d')!;\n      ctx.save();\n      // Set stroke color with opacity & flow\n      ctx.globalAlpha = brushOpacity * brushFlow;\n\n      // For soft brushes, use shadow blur\n      if (brushType === 'soft') {\n        ctx.shadowColor = drawColor;\n        ctx.shadowBlur = drawLineWidth * 0.5;\n        ctx.lineWidth = drawLineWidth * 0.5;\n      } else {\n        ctx.shadowBlur = 0;\n        ctx.lineWidth = drawLineWidth;\n      }\n\n      ctx.strokeStyle = drawColor;\n      ctx.lineCap = 'round';\n      ctx.lineJoin = 'round';\n\n      ctx.beginPath();\n      const points = drawPoints.current;\n      ctx.moveTo(points[points.length - 2].x, points[points.length - 2].y);\n      ctx.lineTo(points[points.length - 1].x, points[points.length - 1].y);\n      ctx.stroke();\n      ctx.restore();\n      drawOverlay();\n    } else {\n      // overlay rotation handling\n      const orot = overlayRotate.current;\n      if (orot) {\n        const rect = canvasRef.current!.getBoundingClientRect();\n        const cx = (e.clientX - rect.left) / zoom;\n        const cy = (e.clientY - rect.top) / zoom;\n        const { layerId, centerX, centerY, startAngle, originalRotation } = orot;\n        const currentAngle = Math.atan2(cy - centerY, cx - centerX);\n        const angleDelta = (currentAngle - startAngle) * (180 / Math.PI);\n\n        setLayers((prev) =>\n          prev.map((L) => {\n            if (L.id !== layerId || L.locked) return L;\n            return { ...L, rotation: originalRotation + angleDelta };\n          }),\n        );\n        drawOverlay();\n        return;\n      }\n\n      // overlay resize handling (mouse move without active drag)\n      const or = overlayResize.current;\n      if (or) {\n        const rect = canvasRef.current!.getBoundingClientRect();\n        const cx = (e.clientX - rect.left) / zoom;\n        const cy = (e.clientY - rect.top) / zoom;\n        const { layerId, handle, startX, startY, orig } = or;\n        // compute new rect depending on handle\n        let nx = orig.x;\n        let ny = orig.y;\n        let nw = orig.w;\n        let nh = orig.h;\n\n        // Handle midpoint resizing (new feature)\n        if (handle === 't') {\n          // Top midpoint - only move top edge\n          ny = cy;\n          nh = orig.h + (orig.y - ny);\n        } else if (handle === 'b') {\n          // Bottom midpoint - only move bottom edge\n          nh = cy - orig.y;\n        } else if (handle === 'l') {\n          // Left midpoint - only move left edge\n          nx = cx;\n          nw = orig.w + (orig.x - nx);\n        } else if (handle === 'r') {\n          // Right midpoint - only move right edge\n          nw = cx - orig.x;\n        } else if (handle === 'tl') {\n          nx = cx;\n          ny = cy;\n          nw = orig.w + (orig.x - nx);\n          nh = orig.h + (orig.y - ny);\n        } else if (handle === 'tr') {\n          ny = cy;\n          nw = cx - orig.x;\n          nh = orig.h + (orig.y - ny);\n        } else if (handle === 'bl') {\n          nx = cx;\n          nw = orig.w + (orig.x - nx);\n          nh = cy - orig.y;\n        } else if (handle === 'br') {\n          nw = cx - orig.x;\n          nh = cy - orig.y;\n        }\n        // aspect ratio lock when Shift pressed (only for corner handles)\n        if (\n          e.shiftKey &&\n          (handle === 'tl' || handle === 'tr' || handle === 'bl' || handle === 'br')\n        ) {\n          const aspect = orig.w / Math.max(1, orig.h);\n          // derive size by larger delta\n          const signW = nw < 0 ? -1 : 1;\n          const signH = nh < 0 ? -1 : 1;\n          const absW = Math.abs(nw);\n          const absH = Math.abs(nh);\n          if (absW / Math.max(1, absH) > aspect) {\n            // width changed more -> adjust height\n            nh = (absW / aspect) * signH;\n          } else {\n            nw = absH * aspect * signW;\n          }\n          // when changing top handles, adjust nx/ny to keep corner anchored\n          if (handle === 'tl') {\n            nx = orig.x + (orig.w - nw);\n            ny = orig.y + (orig.h - nh);\n          } else if (handle === 'tr') {\n            ny = orig.y + (orig.h - nh);\n          } else if (handle === 'bl') {\n            nx = orig.x + (orig.w - nw);\n          }\n        }\n        // enforce min size\n        nw = Math.max(4 / zoom, nw);\n        nh = Math.max(4 / zoom, nh);\n        setLayers((prev) =>\n          prev.map((L) => {\n            if (L.id !== layerId) return L;\n            if (L.locked) return L;\n            // if text layer, also adjust fontSize to roughly match new height\n            if (L.type === 'text') {\n              const padding = 10; // small padding inside rect\n              const newFontSize = Math.max(8, Math.round(Math.max(1, nh) - padding));\n              return { ...L, rect: { x: nx, y: ny, w: nw, h: nh }, fontSize: newFontSize };\n            }\n            return { ...L, rect: { x: nx, y: ny, w: nw, h: nh } };\n          }),\n        );\n        drawOverlay();\n        return;\n      }\n\n      drawOverlay();\n    }\n  };\n\n  const handleMouseUpViewer = () => {\n    if (resizingBrush.current) {\n      resizingBrush.current = false;\n      resizeStartX.current = null;\n      initialLineWidth.current = drawLineWidth;\n      return;\n    }\n    // finalize overlay drag/resize/rotate\n    if (overlayDrag.current || overlayResize.current || overlayRotate.current) {\n      overlayDrag.current = null;\n      overlayResize.current = null;\n      overlayRotate.current = null;\n      // leave overlaySelected true\n      // do not push to history for now (overlay is non-destructive until user exports)\n      drawOverlay();\n      return;\n    }\n\n    setIsPanning(false);\n    panStart.current = null;\n    if (tool === 'crop' && cropRect)\n      applyCrop(canvasRef, overlayRef, cropRect, setCropRect, history);\n    if (tool === 'draw' && isDrawing) {\n      setIsDrawing(false);\n      history.push(canvasRef.current!.toDataURL(), 'Draw');\n    }\n  };\n  //#endregion\n\n  //#region 🎨 Draw Overlay Layer (Crop / Ruler / Perspective / Hover Preview)\n  const drawOverlay = () => {\n    drawOverlayHelper(overlayRef, canvasRef, {\n      zoom,\n      cropRect,\n      rulerPoints: rulerPoints.current,\n      perspectivePoints: perspectivePoints.current,\n      hoverColor,\n      tool,\n      drawColor,\n      drawLineWidth,\n      layers,\n      overlaySelected,\n      activeLayerId,\n    });\n  };\n  //#region 🎯 Color Picker & Hover Preview\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const handleMove = (e: MouseEvent) => {\n      if (tool === 'color' || tool === 'removeColor') {\n        const color = samplePixel(e, canvasRef, zoom);\n        setHoverColor(color ? { x: e.clientX, y: e.clientY, color } : null);\n        drawOverlay();\n      } else if (tool === 'draw') {\n        setHoverColor(drawColor ? { x: e.clientX, y: e.clientY, color: drawColor } : null);\n        drawOverlay();\n      }\n    };\n\n    const handleClick = (e: MouseEvent) => {\n      if (tool === 'color') {\n        const color = samplePixel(e, canvasRef, zoom);\n        if (color) {\n          setPickedColor(color);\n          setDrawColor(color);\n          navigator.clipboard.writeText(color).catch(() => {});\n          message.success(`Picked color ${color}`);\n        }\n      } else if (tool === 'removeColor') {\n        const color = samplePixel(e, canvasRef, zoom);\n        if (color) {\n          setSelectedColorForRemoval(color);\n          setShowColorRemovalModal(true);\n          setTool('pan'); // Switch back to pan after picking color\n        }\n      }\n    };\n\n    const handleLeave = () => {\n      if (tool === 'color' || tool === 'removeColor') setHoverColor(null);\n    };\n\n    canvas.addEventListener('mousemove', handleMove);\n    canvas.addEventListener('click', handleClick);\n    canvas.addEventListener('mouseleave', handleLeave);\n\n    return () => {\n      canvas.removeEventListener('mousemove', handleMove);\n      canvas.removeEventListener('click', handleClick);\n      canvas.removeEventListener('mouseleave', handleLeave);\n    };\n  }, [tool, zoom, offset]);\n  //#endregion\n\n  //#region ⌨ Keyboard Shortcuts (key down)\n  useEffect(() => {\n    const handler = (e: KeyboardEvent) => {\n      // disable global shortcuts while inline editor is focused\n      if (inlineEditorRef.current && document.activeElement === inlineEditorRef.current) return;\n      if (e.ctrlKey && e.key === 'z') history.undo();\n      if (e.ctrlKey && e.shiftKey && e.key === 'Z') history.redo();\n      if (e.key === 'c') setTool('crop');\n      if (e.key === 'h') setTool('pan');\n      if (e.key === 'v') setTool('layer');\n      if (e.key === 't') setTool('text');\n      if (e.key === 'r') rotate(90, canvasRef, overlayRef, history.history);\n      if (e.key === 'p') setTool('color');\n      if (e.key === 'b') setTool('draw');\n\n      // action\n      if (e.key === 'Delete' && (tool === 'layer' || tool === 'text') && activeLayerId)\n        deleteLayer(activeLayerId);\n      if (e.ctrlKey && e.key === 's' && (tool === 'layer' || tool === 'text')) {\n        e.preventDefault();\n        mergeLayerIntoBase(activeLayerId as string | undefined);\n      }\n      if (e.ctrlKey && e.key === 'i') {\n        e.preventDefault();\n        applyInvertColors(canvasRef, history);\n      }\n    };\n    window.addEventListener('keydown', handler);\n    return () => window.removeEventListener('keydown', handler);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [history.index, history.history, tool, activeLayerId, layers]);\n  //#endregion\n\n  // Quick hand tool when holding\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      const triggerTool = (key: 'Space' | 'AltLeft', newTool: Tool, condition = true) => {\n        if (e.code === key && condition) {\n          e.preventDefault();\n          setToolBefore((prev) => prev ?? tool);\n          setTool(newTool);\n          return true;\n        }\n        return false;\n      };\n\n      if (e.key === 'Shift') {\n        setIsShiftDown(true);\n      } else if (triggerTool('Space', 'pan')) {\n        setIsSpaceDown(true);\n      } else if (triggerTool('AltLeft', 'color', tool === 'draw')) {\n        setIsAltDown(true);\n      }\n    };\n\n    const handleKeyUp = (e: KeyboardEvent) => {\n      const resetTool = (\n        key: 'Space' | 'AltLeft',\n        setter: React.Dispatch<React.SetStateAction<boolean>>,\n      ) => {\n        if (e.code === key) {\n          setter(false);\n          setToolBefore((prev) => {\n            if (prev) setTool(prev);\n            return null;\n          });\n        }\n      };\n\n      if (e.key === 'Shift') {\n        setIsShiftDown(false);\n      }\n      resetTool('Space', setIsSpaceDown);\n      resetTool('AltLeft', setIsAltDown);\n    };\n\n    window.addEventListener('keydown', handleKeyDown, { passive: false });\n    window.addEventListener('keyup', handleKeyUp);\n\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n      window.removeEventListener('keyup', handleKeyUp);\n    };\n  }, [tool]);\n\n  //#endregion\n\n  // #region 📐 Perspective Transform Apply\n  const perspectiveApply = async () =>\n    await perspectiveApplyHelper(\n      canvasRef,\n      overlayRef,\n      perspectivePoints,\n      history,\n      setShowPerspectiveModal,\n      drawOverlay,\n    );\n\n  //#endregion\n  //#endregion\n\n  //#region Cursor Style\n  const currentCursor = useMemo(() => {\n    if ((tool === 'pan' || tool === 'select') && isPanning) return 'grabbing';\n    switch (tool) {\n      case 'pan':\n        return 'grab';\n      // case 'move':\n      //   return 'move';\n      case 'crop':\n      case 'ruler':\n      case 'perspective':\n        return 'crosshair';\n      case 'color':\n        return 'copy';\n      case 'removeColor':\n        return 'crosshair';\n      case 'draw':\n        return 'pointer';\n      case 'text':\n        return 'text';\n      default:\n        return 'default';\n    }\n  }, [tool, isPanning]);\n  //#endregion\n\n  const resolution = useMemo(() => {\n    const c = canvasRef.current;\n    if (c) return `${c.width} × ${c.height}`;\n    if (baseCanvas) return `${baseCanvas.width} × ${baseCanvas.height}`;\n    return null;\n  }, [canvasRef.current, baseCanvas]);\n\n  return (\n    <div style={{ display: 'flex', gap: 12 }}>\n      <ImageEditorToolbar\n        canvasRef={canvasRef}\n        overlayRef={overlayRef}\n        baseCanvas={baseCanvas}\n        upscaleImage={upscaleImage}\n        history={history}\n        setTool={setTool}\n        // Exposure & Color\n        brightness={brightness}\n        setBrightness={setBrightness}\n        contrast={contrast}\n        setContrast={setContrast}\n        highlights={highlights}\n        setHighlights={setHighlights}\n        shadows={shadows}\n        setShadows={setShadows}\n        whites={whites}\n        setWhites={setWhites}\n        blacks={blacks}\n        setBlacks={setBlacks}\n        vibrance={vibrance}\n        setVibrance={setVibrance}\n        saturation={saturation}\n        setSaturation={setSaturation}\n        dehaze={dehaze}\n        setDehaze={setDehaze}\n        // Blur / Convolution\n        blur={blur}\n        setBlur={setBlur}\n        gaussian={gaussian}\n        setGaussian={setGaussian}\n        sharpen={sharpen}\n        setSharpen={setSharpen}\n        texture={texture}\n        setTexture={setTexture}\n        clarity={clarity}\n        setClarity={setClarity}\n        // Background removal\n        bgThreshold={bgThreshold}\n        setBgThreshold={setBgThreshold}\n        bgThresholdBlack={bgThresholdBlack}\n        setBgThresholdBlack={setBgThresholdBlack}\n        // Color mix (HSL)\n        hslAdjustments={hslAdjustments}\n        setHslAdjustments={setHslAdjustments}\n        setShowPerspectiveModal={setShowPerspectiveModal}\n        dpiMeasured={dpiMeasured}\n        setDpiMeasured={setDpiMeasured}\n        exportImage={exportWithOverlay}\n        onExport={onExport}\n        onColorRemovalToolClick={() => setTool('removeColor')}\n      />\n\n      <div style={{ flex: 1 }}>\n        <TopEditorToolbar\n          history={history}\n          setZoom={setZoom}\n          tool={tool}\n          setTool={setTool}\n          brushType={brushType}\n          setBrushType={setBrushType}\n          drawColor={drawColor}\n          setDrawColor={setDrawColor}\n          drawLineWidth={drawLineWidth}\n          setDrawLineWidth={setDrawLineWidth}\n          brushOpacity={brushOpacity}\n          setBrushOpacity={setBrushOpacity}\n          brushFlow={brushFlow}\n          setBrushFlow={setBrushFlow}\n          layers={layers}\n          activeLayerId={activeLayerId}\n          setLayerOpacity={setLayerOpacity}\n          setLayerBlend={setLayerBlend}\n          moveLayerUp={moveLayerUp}\n          moveLayerDown={moveLayerDown}\n          deleteLayer={deleteLayer}\n          selectLayer={selectLayer}\n          mergeLayer={mergeLayerIntoBase}\n          textContent={textContent}\n          setTextContent={handleSetTextContent}\n          textFont={textFont}\n          setTextFont={handleSetTextFont}\n          textFontSize={textFontSize}\n          setTextFontSize={handleSetTextFontSize}\n          textColor={textColor}\n          setTextColor={handleSetTextColor}\n          textWeight={textWeight}\n          setTextWeight={handleSetTextWeight}\n          textItalic={textItalic}\n          setTextItalic={handleSetTextItalic}\n          textDecoration={textDecoration}\n          setTextDecoration={handleSetTextDecoration}\n          textAlign={textAlign}\n          setTextAlign={handleSetTextAlign}\n          onAddTextLayer={onAddTextLayer}\n          isAddingText={isAddingText}\n          setIsAddingText={setIsAddingText}\n        />\n\n        <ImageCanvas\n          canvasRef={canvasRef}\n          overlayRef={overlayRef}\n          containerRef={containerRef}\n          offset={offset}\n          zoom={zoom}\n          tool={tool}\n          currentCursor={currentCursor}\n          resolution={resolution}\n          hoverColor={hoverColor}\n          onMouseDown={handleMouseDownViewer}\n          onMouseMove={handleMouseMoveViewer}\n          onMouseUp={handleMouseUpViewer}\n        />\n      </div>\n\n      <Modal\n        title=\"Perspective correction\"\n        open={showPerspectiveModal}\n        onOk={() => perspectiveApply()}\n        onCancel={() => setShowPerspectiveModal(false)}\n        okText=\"Apply\"\n      >\n        <p>Click four points on the image (clockwise) to define the corners, then Apply.</p>\n        <p style={{ marginTop: 8 }}>\n          Tip: click a corner again to move it (or click near a point to reposition).\n        </p>\n      </Modal>\n\n      <ColorRemovalModal\n        open={showColorRemovalModal}\n        onCancel={() => {\n          setShowColorRemovalModal(false);\n          setSelectedColorForRemoval(null);\n        }}\n        onApply={(tolerance, invert, feather) => {\n          if (selectedColorForRemoval) {\n            applyColorRemoval(\n              canvasRef,\n              selectedColorForRemoval,\n              tolerance,\n              history,\n              invert,\n              feather,\n            );\n            setShowColorRemovalModal(false);\n            setSelectedColorForRemoval(null);\n          }\n        }}\n        selectedColor={selectedColorForRemoval}\n        canvasRef={canvasRef}\n      />\n    </div>\n  );\n};\n\nexport default ImageEditor;\n","import { useEffect, useRef, useState } from 'react';\nimport { createCanvas, drawImageToCanvasFromUrl } from '../utils/ImageEditorEngine';\nimport { message } from 'antd';\n\nexport default function useCanvas(imageUrl: string, onLoad?: (dataUrl: string) => void) {\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\n  const overlayRef = useRef<HTMLCanvasElement | null>(null);\n\n  const [baseCanvas, setBaseCanvas] = useState<HTMLCanvasElement | null>(null);\n\n  // Load image once\n  useEffect(() => {\n    (async () => {\n      try {\n        const c = await drawImageToCanvasFromUrl(imageUrl);\n        setBaseCanvas(c);\n\n        const working = createCanvas(c.width, c.height);\n        working.getContext('2d')!.drawImage(c, 0, 0);\n\n        if (canvasRef.current) {\n          canvasRef.current.width = working.width;\n          canvasRef.current.height = working.height;\n          const ctx = canvasRef.current.getContext('2d')!;\n          ctx.clearRect(0, 0, working.width, working.height);\n          ctx.drawImage(working, 0, 0);\n        }\n\n        if (onLoad) onLoad(canvasToDataUrl(working));\n      } catch (err) {\n        console.error('Failed to load image', err);\n        message.error('Failed to load image');\n      }\n    })();\n  }, [imageUrl]);\n\n  // Resize overlay when baseCanvas is ready\n  useEffect(() => {\n    syncCanvasSize();\n  }, [baseCanvas]);\n\n  /** Convert canvas → dataURL */\n  const canvasToDataUrl = (c: HTMLCanvasElement) => c.toDataURL('image/png');\n\n  /** Sync canvas & overlay sizes */\n  const syncCanvasSize = () => {\n    if (!canvasRef.current || !baseCanvas) return;\n\n    canvasRef.current.width = baseCanvas.width;\n    canvasRef.current.height = baseCanvas.height;\n    overlayRef.current!.width = baseCanvas.width;\n    overlayRef.current!.height = baseCanvas.height;\n\n    const ctx = canvasRef.current.getContext('2d')!;\n    ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    ctx.drawImage(baseCanvas, 0, 0);\n  };\n\n  return { canvasRef, overlayRef, baseCanvas, setBaseCanvas, syncCanvasSize };\n}\n","import { MutableRefObject, useEffect, useState } from 'react';\n\ntype HistoryItem = {\n  url: string;\n  label?: string;\n  isSetBase: boolean;\n};\n\nexport type HistoryController = {\n  history: HistoryItem[];\n  index: number;\n  current: HistoryItem;\n  push: (url: string, label?: string) => void;\n  undo: () => void;\n  redo: () => void;\n  applyHistory: (idx: number) => void;\n};\n\nexport default function useHistory(\n  canvasRef: MutableRefObject<HTMLCanvasElement | null>,\n  overlayRef: MutableRefObject<HTMLCanvasElement | null>,\n) {\n  const [history, setHistory] = useState<HistoryItem[]>([]);\n  const [index, setIndex] = useState(-1);\n\n  const current = history[index];\n\n  //\n  /** History management */\n  const push = (url: string, label = '', isSetBase = true) => {\n    const next = history.slice(0, index + 1);\n    next.push({ url, label, isSetBase });\n    setHistory(next);\n    setIndex(next.length - 1);\n  };\n  const undo = () => {\n    if (index <= 0) return;\n    applyHistory(index - 1);\n  };\n  const redo = () => {\n    if (index >= history.length - 1) return;\n    applyHistory(index + 1);\n  };\n\n  const applyHistory = (idx: number) => {\n    const item = history[idx];\n    if (!item) return;\n\n    const img = new Image();\n    img.onload = () => {\n      const ctx = canvasRef.current!.getContext('2d')!;\n      canvasRef.current!.width = img.naturalWidth;\n      canvasRef.current!.height = img.naturalHeight;\n      overlayRef.current!.width = img.naturalWidth;\n      overlayRef.current!.height = img.naturalHeight;\n\n      ctx.clearRect(0, 0, canvasRef.current!.width, canvasRef.current!.height);\n      ctx.drawImage(img, 0, 0);\n      setIndex(idx);\n    };\n    img.src = item.url;\n  };\n\n  return { history, index, current, push, undo, redo, applyHistory };\n}\n","import DragDropWrapper from '@/components/DragDropWrapper';\nimport DragOverlay from '@/components/DragOverlay';\nimport { handleCopy } from '@/helpers';\nimport {\n  CopyOutlined,\n  DownloadOutlined,\n  InfoCircleOutlined,\n  LoadingOutlined,\n  UploadOutlined,\n} from '@ant-design/icons';\nimport {\n  Button,\n  Card,\n  InputNumber,\n  Space,\n  Spin,\n  Tabs,\n  Tag,\n  Tooltip,\n  Typography,\n  Upload,\n  message,\n} from 'antd';\nimport ImageTracer from 'imagetracerjs';\nimport React, { useEffect, useRef, useState } from 'react';\nimport ImageEditor from './components/ImageEditor';\nimport './styles.less';\n\nconst { Title } = Typography;\nconst { TabPane } = Tabs;\n\nconst PNGJPEG: React.FC = () => {\n  const [preview, setPreview] = useState<string | null>(null);\n  const [svgContent, setSvgContent] = useState<string | null>(null);\n  const [dragging, setDragging] = useState(false);\n\n  const [addOnFile, setAddOnFile] = useState<File | null>(null);\n\n  const dragCounter = useRef(0);\n\n  // --- Clipboard paste support ---\n  useEffect(() => {\n    const handlePaste = (e: ClipboardEvent) => {\n      const items = e.clipboardData?.items;\n      if (!items) return;\n\n      const imageItem = Array.from(items).find((item) => item.type.includes('image'));\n      if (imageItem) {\n        const blob = imageItem.getAsFile();\n        if (blob) {\n          handleUpload(blob);\n          message.success('Image pasted from clipboard!');\n          e.preventDefault();\n        }\n      }\n    };\n\n    window.addEventListener('paste', handlePaste);\n    return () => window.removeEventListener('paste', handlePaste);\n  }, [preview]);\n\n  const handleUpload = (file: File) => {\n    const reader = new FileReader();\n    reader.onload = (e) => (preview ? setAddOnFile(file) : setPreview(e.target?.result as string));\n    reader.readAsDataURL(file);\n    setDragging(false);\n    dragCounter.current = 0;\n    return false;\n  };\n\n  const handleClear = () => {\n    setPreview(null);\n    setSvgContent(null);\n    setAddOnFile(null);\n    message.info('Image and SVG cleared.');\n  };\n\n  return (\n    <DragDropWrapper\n      setDragging={setDragging}\n      dragCounter={dragCounter}\n      handleUpload={handleUpload}\n    >\n      <Card\n        title={\n          <>\n            🖼️ PNG / JPEG Viewer <Tag color=\"cyan\">Beta</Tag>\n          </>\n        }\n        variant={'borderless'}\n      >\n        <Space direction=\"vertical\" style={{ width: '100%' }} size=\"large\">\n          {!dragging && (\n            <Upload beforeUpload={handleUpload} showUploadList={false} accept=\".png,.jpg,.jpeg\">\n              <Button icon={<UploadOutlined />}>Upload Image (PNG/JPG)</Button>\n            </Upload>\n          )}\n\n          {dragging && <DragOverlay />}\n\n          {/* Preview */}\n          {preview && (\n            <div>\n              <Title level={5}>Preview & Editor:</Title>\n              <ImageEditor\n                addOnFile={addOnFile}\n                setAddOnFile={setAddOnFile}\n                imageUrl={preview}\n                onExport={(blob) => {\n                  // optional: show download link or handle upload\n                  console.log('exported blob', blob);\n                }}\n              />\n            </div>\n          )}\n          <Button onClick={handleClear} danger disabled={!preview}>\n            Clear Image\n          </Button>\n        </Space>\n      </Card>\n    </DragDropWrapper>\n  );\n};\n\nexport default PNGJPEG;\n"],"names":[],"mappings":"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"}