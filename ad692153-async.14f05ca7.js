(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]||[]).push([["ad692153"],{"183d4b64":function(e,t,l){l.d(t,"__esModule",{value:!0}),l.e(t,{default:function(){return lz;}});var n=l("777fffbe"),r=l("852bbaa9"),a=l("1a7c85b4"),i=l("d322be42"),s=r._(i),d=l("28c7d19c"),o=l("e9bcd22d"),c=n._(o),u=l("b091b25f"),h=n._(u),f=l("e23084de"),g=n._(f),x=l("1353d6cc"),m=n._(x),v=l("13dfe186"),p=n._(v),j=l("85d53cee"),y=n._(j),w=l("743075ef"),b=l("b2a1469e"),C=n._(b),S=l("d4a32650"),k=n._(S),M=l("ea21718c"),A=n._(M),E=l("d70e0f0a"),R=n._(E),I=l("1c8d1214"),D=n._(I),O=l("f2806aec"),B=n._(O),T=l("81108cbb"),P=n._(T),L=l("d2d0b3b6"),z=n._(L),_={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},H=l("85c4e0d9"),N=n._(H),Y=s.forwardRef(function(e,t){return s.createElement(N.default,(0,z.default)((0,z.default)({},e),{},{ref:t,icon:_}));}),X=l("0a08762b"),F=n._(X),W=l("36ede29e"),$=n._(W),V=l("34f8e1c9"),K=n._(V),U=l("076b2e3c"),q=n._(U),G=l("918eb6e0"),J=n._(G),Q=l("702fd995"),Z=n._(Q),ee=l("c63de1ad"),et=n._(ee),el=l("15cf394c"),en=n._(el),er=l("1ee4d6ad"),ea=n._(er),ei=l("e2b6eb70"),es=n._(ei),ed=l("62318dd7"),eo=n._(ed),ec=l("d7a2efa2"),eu=n._(ec),eh=s.forwardRef(function(e,t){return s.createElement(N.default,(0,z.default)((0,z.default)({},e),{},{ref:t,icon:eu.default}));}),ef={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},eg=s.forwardRef(function(e,t){return s.createElement(N.default,(0,z.default)((0,z.default)({},e),{},{ref:t,icon:ef}));}),ex={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zm52 132H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200zM424 712H296V584c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v128H104c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h128v128c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V776h128c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"appstore-add",theme:"outlined"},em=s.forwardRef(function(e,t){return s.createElement(N.default,(0,z.default)((0,z.default)({},e),{},{ref:t,icon:ex}));}),ev=l("70bd2056"),ep=n._(ev),ej={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656zM484 366h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zM302 548h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm364 0h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-182 0h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm0 182h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8z"}}]},name:"border-outer",theme:"outlined"},ey=s.forwardRef(function(e,t){return s.createElement(N.default,(0,z.default)((0,z.default)({},e),{},{ref:t,icon:ej}));}),ew=l("4e1dc2f8"),eb=l("dfa4ac87"),eC=n._(eb),eS=l("d5daf11a"),ek=n._(eS),eM=l("3eb6f542"),eA=n._(eM),eE=l("2aa4d12e"),eR=n._(eE),eI=l("c9d8dc0b"),eD=n._(eI),eO=l("9f0970b1"),eB=n._(eO);let eT=({visible:e,onCancel:t,canvas:l})=>{let[n,r]=(0,s.useState)("png"),[i,d]=(0,s.useState)(1),[o,c]=(0,s.useState)(1),[u,h]=(0,s.useState)(!0),f=(e,t)=>{let l=document.createElement("a");l.href=URL.createObjectURL(e),l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l);};return(0,a.jsx)(eC.default,{title:"Export Image",open:e,onCancel:t,footer:[(0,a.jsx)(C.default,{onClick:t,children:"Cancel"},"cancel"),(0,a.jsx)(C.default,{type:"primary",onClick:()=>{if(l){if("json"===n)f(new Blob([JSON.stringify(l.toJSON())],{type:"application/json"}),"project.json");else if("svg"===n)f(new Blob([l.toSVG()],{type:"image/svg+xml"}),"image.svg");else{let e={format:n,quality:i,multiplier:o},t=null,r=null;if(u){let n=l.getObjects();if(n.length>0){let a=1/0,i=1/0,s=-1/0,d=-1/0;n.forEach(e=>{let t=e.getBoundingRect();t.left<a&&(a=t.left),t.top<i&&(i=t.top),t.left+t.width>s&&(s=t.left+t.width),t.top+t.height>d&&(d=t.top+t.height);}),e={...e,left:a,top:i,width:s-a,height:d-i},t=l.backgroundColor,r=l.backgroundImage,l.backgroundColor=null,l.backgroundImage=null;}}let a=l.toDataURL(e);u&&(l.backgroundColor=t,l.backgroundImage=r);let s=document.createElement("a");s.download=`image.${n}`,s.href=a,document.body.appendChild(s),s.click(),document.body.removeChild(s);}eD.default.success("Export successful"),t();}},children:"Export"},"export")],children:(0,a.jsxs)(ek.default,{layout:"vertical",children:[(0,a.jsx)(ek.default.Item,{label:"Format",children:(0,a.jsxs)(eA.default,{value:n,onChange:e=>r(e),children:[(0,a.jsx)(eA.default.Option,{value:"png",children:"PNG"}),(0,a.jsx)(eA.default.Option,{value:"jpeg",children:"JPEG"}),(0,a.jsx)(eA.default.Option,{value:"svg",children:"SVG"}),(0,a.jsx)(eA.default.Option,{value:"json",children:"JSON (Project)"})]})}),"json"!==n&&"svg"!==n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ek.default.Item,{label:"Quality (0.1 - 1)",children:(0,a.jsx)(eR.default,{min:.1,max:1,step:.1,value:i,onChange:e=>d(e||1),style:{width:"100%"}})}),(0,a.jsx)(ek.default.Item,{label:"Multiplier (Scale)",children:(0,a.jsx)(eR.default,{min:.1,max:5,step:.1,value:o,onChange:e=>c(e||1),style:{width:"100%"}})}),(0,a.jsx)(ek.default.Item,{children:(0,a.jsx)(eB.default,{checked:u,onChange:e=>h(e.target.checked),children:"Trim Whitespace (Export content only)"})})]})]})});};var eP=l("8e6ac0a6"),eL=n._(eP),ez=l("7b738819"),e_=n._(ez),eH=l("97125d22"),eN=n._(eH);let eY=(e,t,l)=>{if(0!==t.length){if(e.save(),e.globalAlpha=l.opacity*l.flow,"soft"===l.type?(e.shadowColor=l.color,e.shadowBlur=.5*l.lineWidth,e.lineWidth=.5*l.lineWidth):(e.shadowBlur=0,e.lineWidth=l.lineWidth),e.strokeStyle=l.color,e.fillStyle=l.color,e.lineCap="round",e.lineJoin="round",e.beginPath(),1===t.length)e.arc(t[0].x,t[0].y,e.lineWidth/2,0,2*Math.PI),e.fill();else{e.moveTo(t[0].x,t[0].y);for(let l=1;l<t.length;l++)e.lineTo(t[l].x,t[l].y);e.stroke();}e.restore();}},eX=(e,t,l,n,r,a=1)=>{e.save(),e.strokeStyle=r,e.lineWidth=2/a,e.beginPath(),e.arc(t,l,n/2,0,2*Math.PI),e.stroke(),e.restore();},eF=(e,t,l=1,n={x:0,y:0})=>{if(!t.current)return null;let r=t.current.getBoundingClientRect();return{x:(e.clientX-r.left-n.x)/l,y:(e.clientY-r.top-n.y)/l};},eW=(e,t,l,n=!1,r=0)=>{let a=t.replace("#",""),i=parseInt(a.substring(0,2),16),s=parseInt(a.substring(2,4),16),d=parseInt(a.substring(4,6),16),o=new Uint8Array(e.length/4),c=Math.sqrt(195075),u=l/100,h=r/100;for(let t=0;t<e.length;t+=4){let l;let a=Math.sqrt(Math.pow(e[t]-i,2)+Math.pow(e[t+1]-s,2)+Math.pow(e[t+2]-d,2))/c;if(0===r)l=a<=u?0:1;else{let e=a-u;l=e<-h?0:e>h?1:(e+h)/(2*h);}n&&(l=1-l),o[t/4]=Math.round(255*l);}return o;},e$=(e,t,l)=>{if(!(t instanceof ew.FabricImage))return;let n=t.getElement(),r=n.width,a=n.height,i=document.createElement("canvas");i.width=r,i.height=a;let s=i.getContext("2d");s.drawImage(n,0,0,r,a);let d=s.getImageData(0,0,r,a),o=d.data;l.getContext("2d");let c=document.createElement("canvas");c.width=r,c.height=a;let u=c.getContext("2d");u.drawImage(l,0,0,r,a);let h=u.getImageData(0,0,r,a).data;for(let e=0;e<o.length;e+=4){let t=h[e];o[e+3]=t;}s.putImageData(d,0,0);let f=new ew.FabricImage(i);f.set({left:t.left,top:t.top,scaleX:t.scaleX,scaleY:t.scaleY,angle:t.angle,skewX:t.skewX,skewY:t.skewY,flipX:t.flipX,flipY:t.flipY,originX:t.originX,originY:t.originY,opacity:t.opacity});let g=e.getObjects().indexOf(t);e.remove(t),e.add(f),e.moveObjectTo(f,g),e.setActiveObject(f),e.requestRenderAll();},eV=async(e,t,l="overlay")=>{let n=new ew.FabricImage(t);"flatten"===l?(e.clear(),n.set({left:0,top:0,originX:"left",originY:"top",selectable:!0,evented:!0})):n.set({left:0,top:0,originX:"left",originY:"top",selectable:!1,evented:!1,opacity:1}),e.add(n),e.requestRenderAll();},eK=({open:e,onCancel:t,onApply:l,selectedColor:n,sourceCanvas:r})=>{let[i,d]=(0,s.useState)(30),[o,c]=(0,s.useState)("normal"),[u,h]=(0,s.useState)(!1),[f,g]=(0,s.useState)(0),[x,m]=(0,s.useState)(n||"#000000"),[v,p]=(0,s.useState)(!1);(0,s.useEffect)(()=>{n&&m(n);},[n]),(0,s.useEffect)(()=>{let e=e=>{"Alt"===e.key&&p(!0);},t=e=>{"Alt"===e.key&&p(!1);};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t);};},[]);let[j,y]=(0,s.useState)("remove"),[w,b]=(0,s.useState)(20),[S,k]=(0,s.useState)(1),[M,E]=(0,s.useState)("hard"),[R,I]=(0,s.useState)(!1),[D,O]=(0,s.useState)(null),[B,T]=(0,s.useState)(null),[P,L]=(0,s.useState)({scale:1,x:0,y:0}),z=(0,s.useRef)(null),_=(0,s.useRef)(null),H=(0,s.useRef)(null),N=(0,s.useRef)(null),Y=(0,s.useRef)([]),X=(0,s.useRef)(null),[F,W]=(0,s.useState)([]),[$,V]=(0,s.useState)(-1);(0,s.useEffect)(()=>{if(e&&r&&_.current&&H.current&&N.current&&z.current){let e=r.width,t=r.height,{clientWidth:l,clientHeight:n}=z.current,a=Math.min(l/e,n/t),i=e*a,s=t*a;L({scale:a,x:(l-i)/2,y:(n-s)/2}),_.current.width=e,_.current.height=t,H.current.width=e,H.current.height=t,N.current.width=l,N.current.height=n,_.current.getContext("2d").drawImage(r,0,0);let d=H.current.getContext("2d");d.fillStyle="white",d.fillRect(0,0,e,t),U();}},[e,r]);let U=()=>{if(!H.current)return;let e=H.current.getContext("2d").getImageData(0,0,H.current.width,H.current.height),t=F.slice(0,$+1);t.push(e),W(t),V(t.length-1);},G=()=>{if(!r||!_.current||!H.current)return;let e=r.width,t=r.height,l=_.current.getContext("2d"),n=H.current.getContext("2d");l.clearRect(0,0,e,t),l.drawImage(r,0,0);let a=l.getImageData(0,0,e,t),s=eW(a.data,x,i,u,f),d=n.getImageData(0,0,e,t),c=l.createImageData(e,t);for(let l=0;l<e*t;l++){let e=a.data[4*l],t=a.data[4*l+1],n=a.data[4*l+2],r=a.data[4*l+3],i=s[l]/255*r*(d.data[4*l]/255);c.data[4*l]=e,c.data[4*l+1]=t,c.data[4*l+2]=n,c.data[4*l+3]=i;}if("mask"===o)for(let l=0;l<e*t;l++){let e=c.data[4*l+3];c.data[4*l]=e,c.data[4*l+1]=e,c.data[4*l+2]=e,c.data[4*l+3]=255;}l.putImageData(c,0,0);};(0,s.useEffect)(()=>{G();},[i,u,f,x,o,$]);let J=e=>{if(!r||!N.current)return;let t=eF(e,N,P.scale,{x:P.x,y:P.y});if(t){let e=r.getContext("2d");if(!e)return;let l=Math.max(0,Math.min(t.x,r.width-1)),n=Math.max(0,Math.min(t.y,r.height-1)),a=e.getImageData(l,n,1,1).data;m("#"+[a[0],a[1],a[2]].map(e=>e.toString(16).padStart(2,"0")).join(""));}},Q=()=>{R&&(I(!1),Y.current=[],X.current=null,U(),G());},Z=e=>{H.current&&(eY(H.current.getContext("2d"),e,{color:"remove"===j?"#000000":"#ffffff",lineWidth:w,opacity:S,flow:1,type:M}),G());};return(0,s.useEffect)(()=>{if(!N.current||!D)return;let e=N.current.getContext("2d");e.clearRect(0,0,N.current.width,N.current.height);let t=D.x*P.scale+P.x,l=D.y*P.scale+P.y,n=w*P.scale;if(eX(e,t,l,n,"#fff"),eX(e,t,l,n,"#000"),v&&B){let n=Math.min(N.current.width-9-4,Math.max(13,t+12)),r=Math.min(N.current.height-9-4,Math.max(13,l+12));e.beginPath(),e.arc(n,r,11,0,2*Math.PI),e.fillStyle="#00000088",e.fill(),e.beginPath(),e.arc(n,r,9,0,2*Math.PI),e.fillStyle=B,e.fill(),e.font="12px sans-serif",e.fillStyle="#fff",e.textAlign="center",e.fillText(B.toUpperCase(),n,r+9+14);}},[D,w,P,v,B]),(0,a.jsx)(eC.default,{title:"Mask",open:e,onCancel:t,onOk:()=>{_.current&&l(_.current);},width:1e3,style:{top:20},maskClosable:!1,children:(0,a.jsxs)("div",{style:{display:"flex",gap:16},children:[(0,a.jsx)("div",{style:{width:300},children:(0,a.jsxs)(A.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"Target Color:"}),(0,a.jsx)(eN.default,{value:x,onChange:e=>m(e.toHexString()),showText:!0}),(0,a.jsx)("div",{style:{fontSize:12,color:"#999",marginTop:4},children:"Hold Alt + Click on image to pick color"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{children:["Tolerance: ",i,"%"]}),(0,a.jsx)(eL.default,{value:i,onChange:d})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{children:["Feather: ",f,"%"]}),(0,a.jsx)(eL.default,{value:f,onChange:g})]}),(0,a.jsx)("div",{children:(0,a.jsxs)(A.default,{children:[(0,a.jsx)("span",{children:"Invert:"}),(0,a.jsx)(C.default,{onClick:()=>h(!u),type:u?"primary":"default",children:u?"Yes":"No"})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"Preview Mode:"}),(0,a.jsxs)(e_.default.Group,{value:o,onChange:e=>c(e.target.value),children:[(0,a.jsx)(e_.default.Button,{value:"normal",children:"Normal"}),(0,a.jsx)(e_.default.Button,{value:"mask",children:"Mask"})]})]}),(0,a.jsxs)("div",{style:{borderTop:"1px solid #eee",paddingTop:16,marginTop:16},children:[(0,a.jsx)("h4",{children:"Manual Adjustments"}),(0,a.jsxs)(A.default,{children:[(0,a.jsx)(C.default,{type:"remove"===j?"primary":"default",onClick:()=>y("remove"),children:"Remove"}),(0,a.jsx)(C.default,{type:"keep"===j?"primary":"default",onClick:()=>y("keep"),children:"Keep"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{children:["Size: ",w]}),(0,a.jsx)(eL.default,{min:1,max:100,value:w,onChange:b})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{children:["Opacity: ",S]}),(0,a.jsx)(eL.default,{min:0,max:1,step:.1,value:S,onChange:k})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"Hardness:"}),(0,a.jsxs)(e_.default.Group,{value:M,onChange:e=>E(e.target.value),children:[(0,a.jsx)(e_.default.Button,{value:"hard",children:"Hard"}),(0,a.jsx)(e_.default.Button,{value:"soft",children:"Soft"})]})]})]}),(0,a.jsxs)(A.default,{children:[(0,a.jsx)(C.default,{icon:(0,a.jsx)(K.default,{}),onClick:()=>{if($>0){let e=$-1,t=F[e];H.current.getContext("2d").putImageData(t,0,0),V(e),G();}},disabled:$<=0}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(q.default,{}),onClick:()=>{if($<F.length-1){let e=$+1,t=F[e];H.current.getContext("2d").putImageData(t,0,0),V(e),G();}},disabled:$>=F.length-1})]})]})}),(0,a.jsxs)("div",{ref:z,style:{flex:1,position:"relative",border:"1px solid #ccc",height:500,overflow:"hidden",background:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==)"},children:[(0,a.jsx)("canvas",{ref:_,style:{position:"absolute",top:P.y,left:P.x,width:P.scale*((null==r?void 0:r.width)||0),height:P.scale*((null==r?void 0:r.height)||0)}}),(0,a.jsx)("canvas",{ref:N,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",cursor:v?"crosshair":"none"},onMouseDown:e=>{if(v){J(e);return;}I(!0);let t=eF(e,N,P.scale,{x:P.x,y:P.y});t&&(Y.current=[t],X.current=t,Z([t]));},onMouseMove:e=>{let t=eF(e,N,P.scale,{x:P.x,y:P.y});if(O(t),v&&t&&r)try{let e=r.getContext("2d");if(e){let l=Math.max(0,Math.min(t.x,r.width-1)),n=Math.max(0,Math.min(t.y,r.height-1)),a=e.getImageData(l,n,1,1).data,i="#"+[a[0],a[1],a[2]].map(e=>e.toString(16).padStart(2,"0")).join("");T(i);}}catch(e){T(null);}else T(null);!v&&R&&t&&X.current&&(Y.current.push(t),Z([X.current,t]),X.current=t);},onMouseUp:Q,onMouseLeave:Q}),(0,a.jsx)("canvas",{ref:H,style:{display:"none"}})]})]})});};var eU=l("95eb3634"),eq=n._(eU),eG=l("bb755443"),eJ=n._(eG),eQ=l("1ffd224b"),eZ=n._(eQ),e0=l("6effc0fd"),e1=n._(e0),e2=l("84cd549f"),e6=n._(e2);let e5=({projects:e,onLoad:t,onDelete:l})=>0===e.length?(0,a.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,a.jsx)(e1.default.Text,{type:"secondary",children:"No saved projects found."})}):(0,a.jsx)(eq.default,{grid:{gutter:16,column:3},dataSource:e,renderItem:e=>(0,a.jsx)(eq.default.Item,{children:(0,a.jsx)(c.default,{hoverable:!0,cover:(0,a.jsx)("div",{style:{height:150,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f0f0f0"},children:(0,a.jsx)(eZ.default,{src:e.thumbnail,preview:!1,style:{maxHeight:"100%",maxWidth:"100%",objectFit:"contain"}})}),onClick:()=>t(e),actions:[(0,a.jsx)(eJ.default,{title:"Delete project?",onConfirm:()=>{l(e.id);},okText:"Yes",cancelText:"No",children:(0,a.jsx)(C.default,{type:"text",danger:!0,icon:(0,a.jsx)(e6.default,{}),onClick:e=>e.stopPropagation(),children:"Delete"})})],children:(0,a.jsx)(c.default.Meta,{title:e.name,description:new Date(e.updatedAt).toLocaleString()})})})}),e4=({visible:e,onCancel:t,projects:l,onLoad:n,onDelete:r})=>(0,a.jsx)(eC.default,{title:"Saved Projects",open:e,onCancel:t,footer:null,width:800,children:(0,a.jsx)(e5,{projects:l,onLoad:n,onDelete:r})}),{Option:e8}=eA.default,e3=({visible:e,onCancel:t,canvas:l,history:n})=>{let r=(0,s.useRef)(null),[i,d]=(0,s.useState)({x:0,y:0,width:0,height:0}),[o,c]=(0,s.useState)(!1),[u,h]=(0,s.useState)({x:0,y:0}),[f,g]=(0,s.useState)(null),[x,m]=(0,s.useState)(null),[v,p]=(0,s.useState)(!1);(0,s.useEffect)(()=>{e&&l&&(d({x:0,y:0,width:l.getWidth(),height:l.getHeight()}),m(null),p(!1));},[e,l]),(0,s.useEffect)(()=>{if(!e||!l||!r.current)return;let t=r.current,n=t.getContext("2d");if(!n)return;let a=l.getWidth(),s=l.getHeight();t.width=a,t.height=s;let d=l.getElement();n.drawImage(d,0,0),n.fillStyle="rgba(0, 0, 0, 0.5)",n.fillRect(0,0,a,s),n.clearRect(i.x,i.y,i.width,i.height),n.drawImage(d,i.x,i.y,i.width,i.height,i.x,i.y,i.width,i.height),n.strokeStyle="#1890ff",n.lineWidth=2,n.strokeRect(i.x,i.y,i.width,i.height),n.fillStyle="#1890ff",[{x:i.x,y:i.y},{x:i.x+i.width,y:i.y},{x:i.x,y:i.y+i.height},{x:i.x+i.width,y:i.y+i.height},{x:i.x+i.width/2,y:i.y},{x:i.x+i.width/2,y:i.y+i.height},{x:i.x,y:i.y+i.height/2},{x:i.x+i.width,y:i.y+i.height/2}].forEach(e=>{n.fillRect(e.x-4,e.y-4,8,8);});},[e,l,i]);let j=(e,t)=>{let{x:l,y:n,width:r,height:a}=i;return 10>Math.abs(e-l)&&10>Math.abs(t-n)?"tl":10>Math.abs(e-(l+r))&&10>Math.abs(t-n)?"tr":10>Math.abs(e-l)&&10>Math.abs(t-(n+a))?"bl":10>Math.abs(e-(l+r))&&10>Math.abs(t-(n+a))?"br":10>Math.abs(e-(l+r/2))&&10>Math.abs(t-n)?"t":10>Math.abs(e-(l+r/2))&&10>Math.abs(t-(n+a))?"b":10>Math.abs(e-l)&&10>Math.abs(t-(n+a/2))?"l":10>Math.abs(e-(l+r))&&10>Math.abs(t-(n+a/2))?"r":null;},y=(e,t)=>e>=i.x&&e<=i.x+i.width&&t>=i.y&&t<=i.y+i.height,w=()=>{c(!1),g(null);};return(0,a.jsxs)(eC.default,{title:"Crop Canvas",open:e,onCancel:t,width:Math.min((null==l?void 0:l.getWidth())||800,1200)+100,footer:[(0,a.jsx)(C.default,{onClick:t,children:"Cancel"},"cancel"),(0,a.jsx)(C.default,{type:"primary",onClick:()=>{if(!l){eD.default.error("Canvas not available");return;}if(i.width<1||i.height<1){eD.default.error("Crop area is too small");return;}n.saveState();try{let e=l.toJSON(),r=e.objects||[],a=l.backgroundColor||"#ffffff";l.clear(),l.setDimensions({width:i.width,height:i.height}),l.set("backgroundColor",a),r.forEach(e=>{void 0!==e.left&&(e.left-=i.x),void 0!==e.top&&(e.top-=i.y),e.objects&&Array.isArray(e.objects)&&e.objects.forEach(e=>{void 0!==e.left&&(e.left-=i.x),void 0!==e.top&&(e.top-=i.y);});}),l.loadFromJSON({version:e.version||"5.3.0",objects:r},()=>{l.renderAll(),n.saveState(),eD.default.success("Canvas cropped successfully"),t();});}catch(e){console.error("Crop error:",e),eD.default.error("Failed to crop canvas");}},children:"Confirm Crop"},"confirm")],children:[(0,a.jsx)("div",{style:{marginBottom:16},children:(0,a.jsxs)(A.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)(A.default,{children:[(0,a.jsx)("span",{children:"Aspect Ratio:"}),(0,a.jsxs)(eA.default,{style:{width:120},value:v?x===16/9?"16:9":x===4/3?"4:3":1.5===x?"3:2":1===x?"1:1":x===9/16?"9:16":x===3/4?"3:4":x===2/3?"2:3":"free":"free",onChange:e=>{if("free"===e)m(null),p(!1);else{let t;switch(e){case"16:9":t=16/9;break;case"4:3":t=4/3;break;case"3:2":t=1.5;break;case"1:1":default:t=1;break;case"9:16":t=9/16;break;case"3:4":t=3/4;break;case"2:3":t=2/3;}m(t),p(!0);let n=i.width/t;if(n<=((null==l?void 0:l.getHeight())||0))d({...i,height:n});else{let e=i.height*t;d({...i,width:e});}}},children:[(0,a.jsx)(e8,{value:"free",children:"Free"}),(0,a.jsx)(e8,{value:"16:9",children:"16:9 (Landscape)"}),(0,a.jsx)(e8,{value:"4:3",children:"4:3 (Landscape)"}),(0,a.jsx)(e8,{value:"3:2",children:"3:2 (Landscape)"}),(0,a.jsx)(e8,{value:"1:1",children:"1:1 (Square)"}),(0,a.jsx)(e8,{value:"9:16",children:"9:16 (Portrait)"}),(0,a.jsx)(e8,{value:"3:4",children:"3:4 (Portrait)"}),(0,a.jsx)(e8,{value:"2:3",children:"2:3 (Portrait)"})]}),(0,a.jsx)(eB.default,{checked:v,onChange:e=>p(e.target.checked),children:"Lock"})]}),(0,a.jsxs)(A.default,{children:[(0,a.jsx)("span",{children:"X:"}),(0,a.jsx)(eR.default,{min:0,max:(null==l?void 0:l.getWidth())||0,value:Math.round(i.x),onChange:e=>d({...i,x:e||0})}),(0,a.jsx)("span",{children:"Y:"}),(0,a.jsx)(eR.default,{min:0,max:(null==l?void 0:l.getHeight())||0,value:Math.round(i.y),onChange:e=>d({...i,y:e||0})}),(0,a.jsx)("span",{children:"Width:"}),(0,a.jsx)(eR.default,{min:1,max:(null==l?void 0:l.getWidth())||0,value:Math.round(i.width),onChange:e=>{let t=e||1;v&&x?d({...i,width:t,height:t/x}):d({...i,width:t});}}),(0,a.jsx)("span",{children:"Height:"}),(0,a.jsx)(eR.default,{min:1,max:(null==l?void 0:l.getHeight())||0,value:Math.round(i.height),onChange:e=>{let t=e||1;v&&x?d({...i,width:t*x,height:t}):d({...i,height:t});}})]})]})}),(0,a.jsx)("div",{style:{overflow:"auto",maxHeight:"600px",border:"1px solid #d9d9d9",borderRadius:"4px"},children:(0,a.jsx)("canvas",{ref:r,style:{display:"block",cursor:o?"move":"crosshair"},onMouseDown:e=>{var t;let l=null===(t=r.current)||void 0===t?void 0:t.getBoundingClientRect();if(!l)return;let n=e.clientX-l.left,a=e.clientY-l.top,i=j(n,a);i?(g(i),h({x:n,y:a})):y(n,a)&&(c(!0),h({x:n,y:a}));},onMouseMove:e=>{var t;if(!l)return;let n=null===(t=r.current)||void 0===t?void 0:t.getBoundingClientRect();if(!n)return;let a=e.clientX-n.left,s=e.clientY-n.top;if(f){let e=a-u.x,t=s-u.y,n={...i};switch(f){case"tl":n.x+=e,n.y+=t,n.width-=e,n.height-=t;break;case"tr":n.y+=t,n.width+=e,n.height-=t;break;case"bl":n.x+=e,n.width-=e,n.height+=t;break;case"br":n.width+=e,n.height+=t;break;case"t":n.y+=t,n.height-=t;break;case"b":n.height+=t;break;case"l":n.x+=e,n.width-=e;break;case"r":n.width+=e;}v&&x&&(f.includes("r")||f.includes("l")?n.height=n.width/x:f.includes("t")||f.includes("b")?n.width=n.height*x:n.height=n.width/x),n.width>10&&n.height>10&&(n.x=Math.max(0,Math.min(n.x,l.getWidth()-n.width)),n.y=Math.max(0,Math.min(n.y,l.getHeight()-n.height)),n.x+n.width>l.getWidth()&&(n.width=l.getWidth()-n.x,v&&x&&(n.height=n.width/x)),n.y+n.height>l.getHeight()&&(n.height=l.getHeight()-n.y,v&&x&&(n.width=n.height*x)),d(n),h({x:a,y:s}));}else if(o){let e=a-u.x,t=s-u.y,n=i.x+e,r=i.y+t;n=Math.max(0,Math.min(n,l.getWidth()-i.width)),r=Math.max(0,Math.min(r,l.getHeight()-i.height)),d({...i,x:n,y:r}),h({x:a,y:s});}},onMouseUp:w,onMouseLeave:w})}),(0,a.jsx)("div",{style:{marginTop:12,fontSize:12,color:"#666"},children:'\u{1F4A1} Drag to move crop area, drag handles to resize, or use inputs above. Select an aspect ratio preset or lock custom ratio. Click "Confirm Crop" to apply changes to all layers.'})]});};var e7=l("f6c9c5f6"),e9=n._(e7),te=l("84de98ed"),tt=n._(te);"undefined"==typeof window||window.cv||(window.cv=tt.default);let tl=()=>new Promise(e=>{tt.default.getBuildInformation?e():tt.default.onRuntimeInitialized=()=>{e();};}),tn=async(e,t,l=15,n=7)=>{if(!tt.default||!tt.default.imread)throw Error("OpenCV.js not loaded");if(e.width!==t.width||e.height!==t.height){let l=document.createElement("canvas");l.width=e.width,l.height=e.height;let n=l.getContext("2d");n&&n.drawImage(t,0,0,e.width,e.height),t=l;}let r=tt.default.imread(e),a=tt.default.imread(t),i=new tt.default.Mat;if(tt.default.cvtColor(a,i,tt.default.COLOR_RGBA2GRAY),tt.default.threshold(i,i,10,255,tt.default.THRESH_BINARY),n&&n>1){let e=Math.round(n);e%2==0&&(e+=1);let t=new tt.default.Size(e,e);tt.default.GaussianBlur(i,i,t,0);}let s=Math.max(1,Math.floor(l));s%2==0&&(s+=1);let d=new tt.default.Size(s,s),o=new tt.default.Mat;tt.default.GaussianBlur(r,o,d,0);let c=r.clone();o.copyTo(c,i);let u=document.createElement("canvas");return u.width=c.cols,u.height=c.rows,tt.default.imshow(u,c),r.delete(),a.delete(),i.delete(),o.delete(),c.delete(),u;},{Text:tr}=e1.default,ta=({visible:e,onCancel:t,canvas:l,history:n})=>{let r=(0,s.useRef)(null),i=(0,s.useRef)(null),d=(0,s.useRef)(null),o=(0,s.useRef)(null),[c,u]=(0,s.useState)(null),[h,f]=(0,s.useState)(30),[g,x]=(0,s.useState)(15),[m,v]=(0,s.useState)(5),[p,j]=(0,s.useState)(!1),[y,w]=(0,s.useState)("overlay"),b=(0,s.useRef)(g),S=(0,s.useRef)(m);(0,s.useEffect)(()=>{b.current=g;},[g]),(0,s.useEffect)(()=>{S.current=m;},[m]),(0,s.useEffect)(()=>{e&&tl().catch(e=>{eD.default.error("Failed to load OpenCV libraries: "+e.message);});},[e]),(0,s.useEffect)(()=>{if(e&&l&&i.current&&d.current&&r.current){let e=l.getWidth(),t=l.getHeight(),n=d.current.getContext("2d");if(n){d.current.width=e,d.current.height=t;let r=l.toDataURL({format:"png",multiplier:1}),a=new Image;a.onload=()=>{n.drawImage(a,0,0,e,t);},a.src=r;}c&&c.dispose();let r=new ew.Canvas(i.current,{isDrawingMode:!0,width:e,height:t,backgroundColor:"rgba(0,0,0,0)",selection:!1});r.on("mouse:move",e=>{if(o.current){var t;let l=r.getScenePoint(e.e),n=(null===(t=r.freeDrawingBrush)||void 0===t?void 0:t.width)||30;o.current.style.display="block",o.current.style.transform=`translate(${l.x-n/2}px, ${l.y-n/2}px)`,o.current.style.width=`${n}px`,o.current.style.height=`${n}px`;}}),r.on("mouse:out",()=>{o.current&&(o.current.style.display="none");});let a=new ew.PencilBrush(r);return a.color="rgba(255, 0, 0, 0.5)",a.width=h,r.freeDrawingBrush=a,r.on("path:created",async e=>{try{j(!0);let t=e.path,l=document.createElement("canvas");l.width=r.getWidth(),l.height=r.getHeight();let n=l.getContext("2d");n.fillStyle="black",n.fillRect(0,0,l.width,l.height);let a=r.toDataURL({format:"png",multiplier:1}),i=new Image;i.src=a,await new Promise(e=>{i.onload=()=>e();}),n.drawImage(i,0,0);let s=n.getImageData(0,0,l.width,l.height),o=s.data;for(let e=0;e<o.length;e+=4)o[e]>20?(o[e]=255,o[e+1]=255,o[e+2]=255):(o[e]=0,o[e+1]=0,o[e+2]=0),o[e+3]=255;if(n.putImageData(s,0,0),d.current){let e=await tn(d.current,l,b.current,S.current),t=d.current.getContext("2d");t&&t.drawImage(e,0,0);}r.remove(t),r.requestRenderAll();}catch(e){console.error("Auto blur failed",e);}finally{j(!1);}}),u(r),()=>{r.dispose();};}},[e,l]),(0,s.useEffect)(()=>{c&&(c.freeDrawingBrush.width=h);},[h,c]);let M=async()=>{if(!c)throw Error("No mask canvas");let e=document.createElement("canvas");e.width=c.getWidth(),e.height=c.getHeight();let t=e.getContext("2d");t.fillStyle="black",t.fillRect(0,0,e.width,e.height);let l=c.toDataURL({format:"png",multiplier:1});return new Promise(n=>{let r=new Image;r.onload=()=>{t.drawImage(r,0,0);let l=t.getImageData(0,0,e.width,e.height),a=l.data;for(let e=0;e<a.length;e+=4)a[e]>20?(a[e]=255,a[e+1]=255,a[e+2]=255):(a[e]=0,a[e+1]=0,a[e+2]=0),a[e+3]=255;t.putImageData(l,0,0),n(e);},r.src=l;});},E=async()=>{if(l&&d.current){j(!0);try{let e=await M(),t=d.current,l=await tn(t,e,g,m),n=d.current.getContext("2d");n&&n.drawImage(l,0,0),eD.default.success("Preview generated");}catch(e){console.error(e),eD.default.error("Preview failed: "+e.message);}finally{j(!1);}}},R=async()=>{if(l&&d.current){j(!0);try{n.saveState(),await eV(l,d.current,y),n.saveState(),eD.default.success("Blur applied successfully"),t();}catch(e){console.error(e),eD.default.error("Apply failed: "+e.message);}finally{j(!1);}}};return(0,a.jsxs)(eC.default,{title:"Blur Brush",open:e,onCancel:t,width:1e3,footer:null,destroyOnClose:!0,children:[(0,a.jsxs)("div",{style:{display:"flex",gap:16},children:[(0,a.jsxs)("div",{ref:r,style:{position:"relative",border:"1px solid #d9d9d9",width:(null==l?void 0:l.getWidth())||800,height:(null==l?void 0:l.getHeight())||600,overflow:"hidden"},children:[(0,a.jsx)("canvas",{ref:d,style:{position:"absolute",top:0,left:0}}),(0,a.jsx)("canvas",{ref:i,style:{position:"absolute",top:0,left:0,opacity:1}}),(0,a.jsx)("div",{ref:o,style:{position:"absolute",top:0,left:0,display:"none",borderRadius:"50%",border:"2px solid rgba(255, 255, 255, 0.8)",boxShadow:"0 0 4px rgba(0,0,0,0.8)",pointerEvents:"none",zIndex:1e3}})]}),(0,a.jsxs)("div",{style:{width:300,display:"flex",flexDirection:"column",gap:16},children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(tr,{strong:!0,children:["Brush Size: ",h,"px"]}),(0,a.jsx)(eL.default,{min:5,max:200,value:h,onChange:f})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(tr,{strong:!0,children:["Blur Amount: ",g]}),(0,a.jsx)(eL.default,{min:1,max:100,value:g,onChange:x})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(tr,{strong:!0,children:["Feather: ",m,"px"]}),(0,a.jsx)(eL.default,{min:0,max:50,value:m,onChange:v})]}),(0,a.jsxs)(A.default,{children:[(0,a.jsx)(k.default,{title:"Undo Mask Stroke",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(K.default,{}),onClick:()=>{if(c){let e=c.getObjects();e.length>0&&c.remove(e[e.length-1]);}}})}),(0,a.jsx)(k.default,{title:"Clear Mask",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(e6.default,{}),onClick:()=>{c&&(c.clear(),c.set("backgroundColor","rgba(0,0,0,0)"),c.renderAll());}})})]}),(0,a.jsxs)(A.default,{direction:"vertical",style:{marginTop:16},children:[(0,a.jsx)(tr,{strong:!0,children:"Apply Mode:"}),(0,a.jsxs)(e_.default.Group,{value:y,onChange:e=>w(e.target.value),children:[(0,a.jsx)(e_.default,{value:"overlay",children:"Overlay (Non-destructive)"}),(0,a.jsx)(e_.default,{value:"flatten",children:"Flatten (Permanent)"})]})]}),(0,a.jsxs)("div",{style:{marginTop:"auto",display:"flex",flexDirection:"column",gap:8},children:[(0,a.jsx)(C.default,{icon:(0,a.jsx)(e9.default,{}),onClick:E,loading:p,children:"Update Preview"}),(0,a.jsxs)(A.default,{children:[(0,a.jsx)(C.default,{onClick:t,children:"Cancel"}),(0,a.jsx)(C.default,{type:"primary",onClick:R,loading:p,children:"Apply Blur"})]})]})]})]}),(0,a.jsx)("div",{style:{marginTop:8,color:"#666"},children:"Paint over areas to blur. Red overlay shows masked area. Click Preview to test settings."})]});},ti="projects",ts=()=>new Promise((e,t)=>{let l=indexedDB.open("PhotoEditorDB",1);l.onerror=()=>{t("Error opening database");},l.onsuccess=t=>{e(t.target.result);},l.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(ti)||t.createObjectStore(ti,{keyPath:"id"});};}),td=async e=>{let t=await ts();return new Promise((l,n)=>{let r=t.transaction([ti],"readwrite").objectStore(ti).put(e);r.onsuccess=()=>l(),r.onerror=()=>n("Error saving project");});},to=async()=>{let e=await ts();return new Promise((t,l)=>{let n=e.transaction([ti],"readonly").objectStore(ti).getAll();n.onsuccess=()=>{let e=n.result;e.sort((e,t)=>t.updatedAt-e.updatedAt),t(e);},n.onerror=()=>l("Error fetching projects");});},tc=async e=>{let t=await ts();return new Promise((l,n)=>{let r=t.transaction([ti],"readwrite").objectStore(ti).delete(e);r.onsuccess=()=>l(),r.onerror=()=>n("Error deleting project");});},tu=()=>{let[e,t]=(0,s.useState)([]),[l,n]=(0,s.useState)(null),r=(0,s.useCallback)(()=>{to().then(t).catch(e=>console.error("Failed to load projects from DB",e));},[]);(0,s.useEffect)(()=>{r();},[r]);let a=(0,s.useCallback)(async(e,r)=>{if(!e)return;let a={id:(null==l?void 0:l.id)||Date.now().toString(),name:(null==l?void 0:l.name)||`Project ${new Date().toLocaleString()}`,thumbnail:e,json:r,createdAt:(null==l?void 0:l.createdAt)||Date.now(),updatedAt:Date.now()};try{await td(a),t(e=>(e.some(e=>e.id===a.id)?e.map(e=>e.id===a.id?a:e):[a,...e]).sort((e,t)=>t.updatedAt-e.updatedAt)),n(a),eD.default.success("Project saved successfully!");}catch(e){console.error(e),eD.default.error("Failed to save project");}},[l]);return{savedProjects:e,currentProject:l,loadProjects:r,saveProject:a,deleteProject:(0,s.useCallback)(async e=>{try{await tc(e),t(t=>t.filter(t=>t.id!==e)),n(t=>t&&t.id===e?null:t),eD.default.success("Project deleted");}catch(e){console.error(e),eD.default.error("Failed to delete project");}},[]),loadProjectIntoEditor:(0,s.useCallback)(e=>{n(e);},[]),clearCurrentProject:(0,s.useCallback)(()=>{n(null);},[]),setCurrentProject:n};},th=({name:e,styles:t})=>(0,a.jsx)("svg",{className:"icon","aria-hidden":"true",style:t,children:(0,a.jsx)("use",{xlinkHref:`#${e}`})});var tf=l("92be0fc5"),tg=n._(tf),tx=l("a5512054"),tm=n._(tx),tv=l("e2967699"),tp=n._(tv),tj=l("54c23ac9"),ty=n._(tj),tw=l("93cff216"),tb=n._(tw);let tC=(e,t=0,l=255)=>Math.min(l,Math.max(t,e)),tS=e=>Math.min(1,Math.max(0,e)),tk=(e,t,l)=>{let n=Math.max(e/=255,t/=255,l/=255),r=Math.min(e,t,l),a=0,i=0,s=(n+r)/2;if(n!==r){let d=n-r;switch(i=s>.5?d/(2-n-r):d/(n+r),n){case e:a=(t-l)/d+(t<l?6:0);break;case t:a=(l-e)/d+2;break;case l:a=(e-t)/d+4;}a/=6;}return[a,i,s];},tM=(e,t,l)=>{let n,r,a;if(0===t)n=r=a=l;else{let i=(e,t,l)=>(l<0&&(l+=1),l>1&&(l-=1),l<1/6)?e+(t-e)*6*l:l<.5?t:l<2/3?e+(t-e)*(2/3-l)*6:e,s=l<.5?l*(1+t):l+t-l*t,d=2*l-s;n=i(d,s,e+1/3),r=i(d,s,e),a=i(d,s,e-1/3);}return[Math.round(255*n),Math.round(255*r),Math.round(255*a)];},tA=[{name:"red",range:[345,15]},{name:"orange",range:[15,45]},{name:"yellow",range:[45,75]},{name:"green",range:[75,165]},{name:"aqua",range:[165,195]},{name:"blue",range:[195,255]},{name:"purple",range:[255,285]},{name:"magenta",range:[285,345]}],tE=e=>{let t=(e%360+360)%360,l=tA.find(({range:e})=>{let[l,n]=e;return l<=n?t>=l&&t<n:t>=l||t<n;});return(null==l?void 0:l.name)||"red";},tR=e=>{let t=[...e].sort((e,t)=>e.x-t.x);t[0].x>0&&t.unshift({x:0,y:t[0].y}),t[t.length-1].x<255&&t.push({x:255,y:t[t.length-1].y});let l=t.map(e=>e.x),n=t.map(e=>e.y),r=l.length,a=[],i=[],s=[];for(let e=0;e<r-1;e++){let t=l[e+1]-l[e],r=n[e+1]-n[e];i.push(t),a.push(r),s.push(r/t);}let d=[s[0]];for(let e=0;e<r-2;e++){let t=s[e],l=s[e+1];if(t*l<=0)d.push(0);else{let n=i[e],r=i[e+1],a=n+r;d.push(3*a/((a+r)/t+(a+n)/l));}}d.push(s[s.length-1]);let o=Array(256).fill(0);for(let e=0;e<r-1;e++){let t=l[e],r=l[e+1],a=n[e],i=n[e+1],s=d[e],c=d[e+1],u=r-t;for(let e=t;e<=r&&!(e>=256);e++){let l=(e-t)/u,n=l*l,r=n*l,d=(2*r-3*n+1)*a+(r-2*n+l)*u*s+(-2*r+3*n)*i+(r-n)*u*c;o[Math.round(e)]=tC(Math.round(d));}}return o;},tI=(e,t)=>{let l=e.data,{hsl:n,curves:r,colorGrading:a}=t,i=tR(r.master),s=tR(r.red),d=tR(r.green),o=tR(r.blue);tM(a.shadows.h/360,a.shadows.s,2*a.shadows.l),tM(a.midtones.h/360,a.midtones.s,2*a.midtones.l),tM(a.highlights.h/360,a.highlights.s,2*a.highlights.l);for(let e=0;e<l.length;e+=4){let t=l[e],r=l[e+1],c=l[e+2];t=s[t],r=d[r],c=o[c];let[u,h,f]=tk(t=i[t],r=i[r],c=i[c]),g=(360*u+360)%360,x=tA.find(({range:e})=>{let[t,l]=e;return t<=l?g>=t&&g<=l:g>=t||g<=l;});if(x){let e=n[x.name];if(e){let[l,n]=x.range,a=n;l>a&&(a+=360);let i=g;if(i<l&&(i+=360),0!==e.h){let t=i+e.h;t<l&&(t=l),t>a&&(t=a),u=(g=(t%360+360)%360)/360;}0!==e.s&&(h=tS(h*(1+(1>=Math.abs(e.s)?100*e.s:e.s)/100))),0!==e.l&&(f=tS(f*(1+(1>=Math.abs(e.l)?100*e.l:e.l)/100))),[t,r,c]=tM(u,h,f);}else[t,r,c]=tM(u,h,f);}let m=t/255*.299+r/255*.587+c/255*.114,v=.5+.25*(a.balance||0),p=Math.max(.001,.5*(.5+(a.blending??0)*.5)),j=tS((v-m)/p),y=tS((m-v)/p),w=Math.max(0,1-Math.abs(m-v)/p);if(Math.abs(a.shadows.s)>0||Math.abs(a.shadows.l)>0){let[e,l,n]=tM(a.shadows.h/360,a.shadows.s,.5),i=a.shadows.l||0;t+=(e-128)*j*2,r+=(l-128)*j*2,c+=(n-128)*j*2;let s=255*i*j;t+=s,r+=s,c+=s;}if(Math.abs(a.highlights.s)>0||Math.abs(a.highlights.l)>0){let[e,l,n]=tM(a.highlights.h/360,a.highlights.s,.5),i=a.highlights.l||0;t+=(e-128)*y*2,r+=(l-128)*y*2,c+=(n-128)*y*2;let s=255*i*y;t+=s,r+=s,c+=s;}if(Math.abs(a.midtones.s)>0||Math.abs(a.midtones.l)>0){let[e,l,n]=tM(a.midtones.h/360,a.midtones.s,.5),i=a.midtones.l||0;t+=(e-128)*w*2,r+=(l-128)*w*2,c+=(n-128)*w*2;let s=255*i*w;t+=s,r+=s,c+=s;}let b=a.temperature||0,C=a.tint||0;if(0!==b){let e=40*b;t+=e,c-=e;}if(0!==C){let e=30*C;r+=e,t-=.35*e,c-=.35*e;}l[e]=tC(t),l[e+1]=tC(r),l[e+2]=tC(c);}return e;},tD=({label:e,value:t,min:l,max:n,step:r=1,gradient:i,onChange:s,onChangeComplete:d})=>(0,a.jsxs)("div",{className:"custom-slider-container",children:[(0,a.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)("span",{className:"custom-label",style:{fontSize:12},children:e}),(0,a.jsx)(eR.default,{min:l,max:n,step:r,value:t,onChange:e=>s(Number(e)),onBlur:()=>null==d?void 0:d(),className:"custom-number",size:"small",style:{width:50,fontSize:12}})]}),(0,a.jsx)(eL.default,{min:l,max:n,step:r,value:t,onChange:s,onChangeComplete:d,className:"custom-slider",style:{"--custom-slider-gradient":i,margin:"6px 0 16px 0"},handleStyle:{opacity:1}})]}),tO=[{name:"red",color:"#ff4d4d"},{name:"orange",color:"#ffa500"},{name:"yellow",color:"#ffd700"},{name:"green",color:"#00c853"},{name:"aqua",color:"#00e5ff"},{name:"blue",color:"#2979ff"},{name:"purple",color:"#9c27b0"},{name:"magenta",color:"#ff00aa"}],tB=(e,t)=>{var l,n,r;let a=(null===(l=tO.find(t=>t.name===e))||void 0===l?void 0:l.color)||"#ffffff",i=tO.findIndex(t=>t.name===e);if(-1===i)return"#555";let s=tO[i].color,d=(null===(n=tO[i-1])||void 0===n?void 0:n.color)||s,o=(null===(r=tO[i+1])||void 0===r?void 0:r.color)||s;switch(t){case"h":return`linear-gradient(90deg, ${d}, ${s}, ${o})`;case"s":return`linear-gradient(90deg, gray, ${a})`;case"l":return`linear-gradient(90deg, black, ${a}, white)`;default:return"#555";}},tT=({adjustments:e,onChange:t,activeChannel:l,onActiveChannelChange:n})=>{let[r,i]=(0,s.useState)("red"),d=void 0!==l?l:r,o=e[d]||{h:0,s:0,l:0},c=(l,n)=>{t({...e,[d]:{...e[d],[l]:n}});};return(0,a.jsxs)("div",{children:[(0,a.jsx)(tg.default,{activeKey:d,onChange:e=>{n?n(e):i(e);},type:"card",size:"small",items:tA.map(e=>{var t;return{label:(0,a.jsx)("span",{style:{display:"inline-block",width:12,height:12,background:(null===(t=tO.find(t=>t.name===e.name))||void 0===t?void 0:t.color)||"#eee",borderRadius:"50%",marginRight:4},title:e.name}),key:e.name};}),tabPosition:"top",tabBarGutter:4}),(0,a.jsxs)("div",{style:{marginTop:16},children:[(0,a.jsx)(e1.default.Title,{level:5,style:{textTransform:"capitalize"},children:d}),(0,a.jsx)("div",{style:{marginBottom:16},children:(0,a.jsx)(tD,{label:`Hue (${o.h}\xb0)`,min:-180,max:180,value:o.h,onChange:e=>c("h",e),gradient:tB(d,"h")})}),(0,a.jsx)("div",{style:{marginBottom:16},children:(0,a.jsx)(tD,{label:`Saturation (${Math.round(100*o.s)}%)`,min:-1,max:1,step:.01,value:o.s,onChange:e=>c("s",e),gradient:tB(d,"s")})}),(0,a.jsx)("div",{style:{marginBottom:16},children:(0,a.jsx)(tD,{label:`Luminance (${Math.round(100*o.l)}%)`,min:-1,max:1,step:.01,value:o.l,onChange:e=>c("l",e),gradient:tB(d,"l")})}),(0,a.jsxs)(C.default,{onClick:()=>{t({...e,[d]:{h:0,s:0,l:0}});},size:"small",children:["Reset ",d]})]})]});},tP={master:"#ffffff",red:"#ff4d4f",green:"#52c41a",blue:"#1890ff"},tL=({curves:e,onChange:t})=>{let[l,n]=(0,s.useState)("master"),r=(0,s.useRef)(null),[i,d]=(0,s.useState)(null),o=e[l];(0,s.useEffect)(()=>{let e=r.current;if(!e)return;let t=e.getContext("2d");if(!t)return;let n=e.width,a=e.height;t.fillStyle="#262626",t.fillRect(0,0,n,a),t.strokeStyle="#434343",t.lineWidth=1,t.beginPath();for(let e=1;e<4;e++){let l=n/4*e;t.moveTo(l,0),t.lineTo(l,a),t.moveTo(0,l),t.lineTo(n,l);}t.stroke();let s=tR(o);t.strokeStyle=tP[l],t.lineWidth=2,t.beginPath();for(let e=0;e<256;e++){let l=s[e],r=e/255*n,i=a-l/255*a;0===e?t.moveTo(r,i):t.lineTo(r,i);}t.stroke(),o.forEach((e,l)=>{let r=e.x/255*n,s=a-e.y/255*a;t.fillStyle=l===i?"#fff":"#aaa",t.beginPath(),t.arc(r,s,4,0,2*Math.PI),t.fill();});},[o,l,i]);let c=()=>{d(null);};return(0,a.jsxs)("div",{children:[(0,a.jsxs)(A.default,{style:{marginBottom:16},children:[(0,a.jsx)(eA.default,{value:l,onChange:n,options:[{label:"RGB (Master)",value:"master"},{label:"Red",value:"red"},{label:"Green",value:"green"},{label:"Blue",value:"blue"}],style:{width:120}}),(0,a.jsx)(C.default,{onClick:()=>t({...e,[l]:[{x:0,y:0},{x:255,y:255}]}),children:"Reset Channel"})]}),(0,a.jsx)("div",{className:"curves-canvas-container",style:{cursor:null!==i?"grabbing":"crosshair"},children:(0,a.jsx)("canvas",{ref:r,width:256,height:256,style:{width:"100%",maxWidth:256,background:"#222",borderRadius:4},onMouseDown:n=>{let a=r.current;if(!a)return;let i=a.getBoundingClientRect(),s=(n.clientX-i.left)/i.width*255,c=(1-(n.clientY-i.top)/i.height)*255,u=Math.round(s),h=Math.round(c),f=o.findIndex(e=>10>Math.abs(e.x-u)&&10>Math.abs(e.y-h));if(-1!==f)d(f);else{let n={x:u,y:h},r=[...o,n].sort((e,t)=>e.x-t.x);t({...e,[l]:r}),r.indexOf(n);}},onMouseMove:n=>{if(null===i)return;let a=r.current;if(!a)return;let s=a.getBoundingClientRect(),d=(n.clientX-s.left)/s.width*255,c=(1-(n.clientY-s.top)/s.height)*255;d=Math.max(0,Math.min(255,d)),c=Math.max(0,Math.min(255,c));let u=[...o],h=0===i,f=i===o.length-1;h&&(d=0),f&&(d=255),h||f||(d=Math.max(u[i-1].x+1,Math.min(u[i+1].x-1,d))),u[i]={x:Math.round(d),y:Math.round(c)},t({...e,[l]:u});},onMouseUp:c,onMouseLeave:c,onDoubleClick:n=>{let a=r.current;if(!a)return;let i=a.getBoundingClientRect(),s=(n.clientX-i.left)/i.width*255,d=(1-(n.clientY-i.top)/i.height)*255,c=o.findIndex(e=>10>Math.abs(e.x-s)&&10>Math.abs(e.y-d));if(c>0&&c<o.length-1){let n=o.filter((e,t)=>t!==c);t({...e,[l]:n});}}})})]});};var tz=l("764a8673"),t_=n._(tz);let{Panel:tH}=t_.default,tN=({settings:e,onChange:t})=>{let l=(l,n,r)=>{t({...e,[l]:{...e[l],[n]:r}});},n=(l,n)=>{t({...e,[l]:n});},r=e=>`linear-gradient(to right, #888, hsl(${e}, 100%, 50%))`;return(0,a.jsxs)("div",{children:[(0,a.jsxs)(t_.default,{defaultActiveKey:["shadows","midtones","highlights"],ghost:!0,children:[(0,a.jsxs)(tH,{header:"Shadows",children:[(0,a.jsx)(tD,{label:`Hue (${Math.round(e.shadows.h)}\xb0)`,min:0,max:360,value:e.shadows.h,onChange:e=>l("shadows","h",e),gradient:"linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%)"}),(0,a.jsx)(tD,{label:`Saturation (${Math.round(100*e.shadows.s)}%)`,min:0,max:1,step:.01,value:e.shadows.s,onChange:e=>l("shadows","s",e),gradient:r(e.shadows.h)}),(0,a.jsx)(tD,{label:`Luminance (${Math.round(100*e.shadows.l)}%)`,min:-1,max:1,step:.01,value:e.shadows.l,onChange:e=>l("shadows","l",e),gradient:"linear-gradient(to right, #000, #888, #fff)"})]},"shadows"),(0,a.jsxs)(tH,{header:"Midtones",children:[(0,a.jsx)(tD,{label:`Hue (${Math.round(e.midtones.h)}\xb0)`,min:0,max:360,value:e.midtones.h,onChange:e=>l("midtones","h",e),gradient:"linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%)"}),(0,a.jsx)(tD,{label:`Saturation (${Math.round(100*e.midtones.s)}%)`,min:0,max:1,step:.01,value:e.midtones.s,onChange:e=>l("midtones","s",e),gradient:r(e.midtones.h)}),(0,a.jsx)(tD,{label:`Luminance (${Math.round(100*e.midtones.l)}%)`,min:-1,max:1,step:.01,value:e.midtones.l,onChange:e=>l("midtones","l",e),gradient:"linear-gradient(to right, #000, #888, #fff)"})]},"midtones"),(0,a.jsxs)(tH,{header:"Highlights",children:[(0,a.jsx)(tD,{label:`Hue (${Math.round(e.highlights.h)}\xb0)`,min:0,max:360,value:e.highlights.h,onChange:e=>l("highlights","h",e),gradient:"linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%)"}),(0,a.jsx)(tD,{label:`Saturation (${Math.round(100*e.highlights.s)}%)`,min:0,max:1,step:.01,value:e.highlights.s,onChange:e=>l("highlights","s",e),gradient:r(e.highlights.h)}),(0,a.jsx)(tD,{label:`Luminance (${Math.round(100*e.highlights.l)}%)`,min:-1,max:1,step:.01,value:e.highlights.l,onChange:e=>l("highlights","l",e),gradient:"linear-gradient(to right, #000, #888, #fff)"})]},"highlights")]}),(0,a.jsxs)("div",{style:{marginTop:12},children:[(0,a.jsx)(tD,{label:`Blending (${Math.round(100*e.blending)}%)`,min:0,max:1,step:.01,value:e.blending,onChange:e=>n("blending",e),gradient:"linear-gradient(to right, #444, #888, #ccc)"}),(0,a.jsx)(tD,{label:`Balance (${Math.round(100*e.balance)}%)`,min:-1,max:1,step:.01,value:e.balance,onChange:e=>n("balance",e),gradient:"linear-gradient(to right, #f00, #888, #00f)"}),(0,a.jsx)(tD,{label:`Temperature (${Math.round(100*e.temperature)}%)`,min:-1,max:1,step:.01,value:e.temperature,onChange:e=>n("temperature",e),gradient:"linear-gradient(to right, #001f3f, #888, #ffdd99)"}),(0,a.jsx)(tD,{label:`Tint (${Math.round(100*e.tint)}%)`,min:-1,max:1,step:.01,value:e.tint,onChange:e=>n("tint",e),gradient:"linear-gradient(to right, #ff88ff, #888, #88ff88)"})]}),(0,a.jsx)(C.default,{onClick:()=>t({shadows:{h:0,s:0,l:0},midtones:{h:0,s:0,l:0},highlights:{h:0,s:0,l:0},blending:.5,balance:0,temperature:0,tint:0}),style:{marginTop:16},children:"Reset Grading"})]});};var tY=l("10314b7a"),tX=n._(tY),tF=l("027e0896"),tW=n._(tF);let t$=({canvasRef:e,redData:t,greenData:l,blueData:n})=>{let r=(0,s.useMemo)(()=>({chart:{backgroundColor:"#2b2b2b",height:120,spacing:[5,5,5,5]},title:{text:""},xAxis:{title:{text:"",style:{color:"#fff"}},labels:{style:{color:"#fff",fontSize:"5px"}},gridLineColor:"rgba(255,255,255,0.1)"},yAxis:{title:{text:"",style:{color:"#fff"}},labels:{style:{color:"#fff",fontSize:"5px"}},gridLineColor:"rgba(255,255,255,0.1)"},legend:{enabled:!1},plotOptions:{histogram:{binWidth:4},series:{animation:!1,marker:{enabled:!1}}},series:[{name:"Red",data:t,color:"#ff4444",zIndex:3,lineWidth:1,marker:{radius:1}},{name:"Green",data:l,color:"#44ff44",zIndex:2,lineWidth:1,marker:{radius:1}},{name:"Blue",data:n,color:"#4444ff",zIndex:1,lineWidth:1,marker:{radius:1}}],credits:{enabled:!1},tooltip:{enabled:!1}}),[t,l,n]);return(0,a.jsx)(tW.default,{highcharts:tX.default,options:r});},{Text:tV}=e1.default,tK=({visible:e,onCancel:t,onApply:l,sourceCanvas:n})=>{let[r,i]=(0,s.useState)(!1),d=(0,s.useRef)(null),[o,c]=(0,s.useState)(!1),[u,h]=(0,s.useState)(Array(256).fill(0)),[f,g]=(0,s.useState)(Array(256).fill(0)),[x,m]=(0,s.useState)(Array(256).fill(0)),v=(0,s.useMemo)(()=>{let e={};return tA.forEach(t=>e[t.name]={h:0,s:0,l:0}),{hsl:e,curves:{master:[{x:0,y:0},{x:255,y:255}],red:[{x:0,y:0},{x:255,y:255}],green:[{x:0,y:0},{x:255,y:255}],blue:[{x:0,y:0},{x:255,y:255}]},colorGrading:{shadows:{h:0,s:0,l:0},midtones:{h:0,s:0,l:0},highlights:{h:0,s:0,l:0},blending:.5,balance:0,temperature:0,tint:0}};},[]),[p,j]=(0,s.useState)(v),[y,w]=(0,s.useState)(!1),[b,S]=(0,s.useState)("red"),[M,A]=(0,s.useState)("hsl"),[E,R]=(0,s.useState)(null),[I,D]=(0,s.useState)(null);(0,s.useEffect)(()=>{e&&j(v);},[e,v]),(0,s.useEffect)(()=>{if(!e||!n||!d.current)return;let t=d.current,l=setTimeout(()=>{let e=n.width,l=n.height;if(n.width>600||n.height>600){let t=Math.min(600/n.width,600/n.height);e=Math.floor(n.width*t),l=Math.floor(n.height*t);}t.width=e,t.height=l;let r=t.getContext("2d");if(!r)return;r.drawImage(n,0,0,e,l);let a=r.getImageData(0,0,e,l);if(o){let e=Array(256).fill(0),t=Array(256).fill(0),l=Array(256).fill(0),n=a.data;for(let r=0;r<n.length;r+=4)e[n[r]]+=1,t[n[r+1]]+=1,l[n[r+2]]+=1;h(e),g(t),m(l);}else{tI(a,p);let e=Array(256).fill(0),t=Array(256).fill(0),l=Array(256).fill(0),n=a.data;for(let r=0;r<n.length;r+=4)e[n[r]]+=1,t[n[r+1]]+=1,l[n[r+2]]+=1;h(e),g(t),m(l),r.putImageData(a,0,0);}},50);return()=>clearTimeout(l);},[e,n,p,o]);let O=async()=>{n&&(i(!0),setTimeout(()=>{let e=document.createElement("canvas");e.width=n.width,e.height=n.height;let t=e.getContext("2d");if(!t){i(!1);return;}t.drawImage(n,0,0);let r=t.getImageData(0,0,n.width,n.height);tI(r,p),t.putImageData(r,0,0),l(e),i(!1);},100));},B=e=>{let t,l;let n=e.altKey;if(!y&&!n||!d.current)return;let r=d.current,a=r.getBoundingClientRect();"touches"in e?(t=e.touches[0].clientX,l=e.touches[0].clientY):(t=e.clientX,l=e.clientY);let i=t-a.left,s=l-a.top,o=r.width/a.width,c=r.height/a.height,u=Math.floor(i*o),h=Math.floor(s*c),f=r.getContext("2d");if(!f)return;let g=f.getImageData(Math.max(0,u-1),Math.max(0,h-1),3,3).data;if(0===g.length)return;let x=0,m=0,v=0,p=g.length/4;for(let e=0;e<g.length;e+=4)x+=g[e],m+=g[e+1],v+=g[e+2];let[j,w,b]=tk(x=Math.round(x/p),m=Math.round(m/p),v=Math.round(v/p)),C=360*j;S(tE(C)),A("hsl"),D({h:C,s:w,l:b}),R({x:i,y:s});},T=[{key:"hsl",label:"HSL Mixer",children:(0,a.jsx)(tT,{adjustments:p.hsl,onChange:e=>j({...p,hsl:e}),activeChannel:b,onActiveChannelChange:S})},{key:"curves",label:"Curves",children:(0,a.jsx)(tL,{curves:p.curves,onChange:e=>j({...p,curves:e})})},{key:"grading",label:"Color Grading",children:(0,a.jsx)(tN,{settings:p.colorGrading,onChange:e=>j({...p,colorGrading:e})})}];return(0,a.jsx)(eC.default,{title:"Camera Raw Filter",open:e,onCancel:t,width:1200,onOk:O,confirmLoading:r,okText:"Apply",style:{top:20},children:(0,a.jsxs)(tm.default,{gutter:24,children:[(0,a.jsx)(tp.default,{span:16,style:{textAlign:"center",background:"#f0f0f0",padding:16,display:"flex",alignItems:"center",justifyContent:"center",minHeight:400,flexDirection:"column"},children:(0,a.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"center",position:"relative"},children:[(0,a.jsxs)("div",{style:{position:"absolute",right:12,top:12,zIndex:3,display:"flex",gap:8},children:[(0,a.jsx)(k.default,{title:"Pick color to select HSL channel",children:(0,a.jsx)(C.default,{size:"small",type:y?"primary":"default",icon:(0,a.jsx)(tb.default,{}),onClick:()=>{w(!y),R(null);}})}),(0,a.jsx)(C.default,{size:"small",icon:o?(0,a.jsx)(ty.default,{}):(0,a.jsx)(e9.default,{}),onClick:()=>c(e=>!e)})]}),(0,a.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,a.jsx)("canvas",{ref:d,onClick:B,onTouchStart:B,style:{maxWidth:"100%",maxHeight:"550px",border:"1px solid #ccc",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",cursor:y?"crosshair":"default",display:"block"}}),y&&E&&I&&(0,a.jsxs)("div",{style:{position:"absolute",left:E.x,top:E.y,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:10},children:[(0,a.jsx)("div",{style:{width:20,height:20,border:"2px solid white",borderRadius:"50%",boxShadow:"0 0 2px black"}}),(0,a.jsxs)("div",{style:{position:"absolute",top:24,left:0,background:"rgba(0,0,0,0.8)",color:"#fff",padding:"2px 6px",borderRadius:4,fontSize:10,whiteSpace:"nowrap"},children:["H:",Math.round(I.h)," S:",Math.round(100*I.s)," L:",Math.round(100*I.l)]})]})]})]})}),(0,a.jsxs)(tp.default,{span:8,children:[(0,a.jsx)("div",{style:{width:"100%"},children:(0,a.jsx)(t$,{canvasRef:d,redData:u,greenData:f,blueData:x})}),(0,a.jsx)("div",{style:{marginTop:12,marginBottom:16,padding:"0 8px"},children:(0,a.jsxs)(tm.default,{gutter:[12,8],children:[(0,a.jsxs)(tp.default,{span:12,children:[(0,a.jsx)(tV,{type:"secondary",style:{fontSize:12,display:"block"},children:"Resolution"}),(0,a.jsx)(tV,{style:{fontSize:13},children:n?`${n.width} \xd7 ${n.height}`:"N/A"})]}),(0,a.jsxs)(tp.default,{span:6,children:[(0,a.jsx)(tV,{type:"secondary",style:{fontSize:12,display:"block"},children:"ISO"}),(0,a.jsx)(tV,{style:{fontSize:13},children:"--"})]}),(0,a.jsxs)(tp.default,{span:6,children:[(0,a.jsx)(tV,{type:"secondary",style:{fontSize:12,display:"block"},children:"Exp"}),(0,a.jsx)(tV,{style:{fontSize:13},children:"--"})]})]})}),(0,a.jsx)(tg.default,{activeKey:M,onChange:A,items:T})]})]})});},tU=()=>{let{canvas:e,setActiveTool:t,activeTool:l,history:n,selectedObject:r,clipboard:i,setClipboard:d}=(0,w.usePhotoEditor)(),o=(0,s.useRef)(null),c=(0,s.useRef)(!1),[u,h]=(0,s.useState)(!1),[f,g]=(0,s.useState)(!1),[x,v]=(0,s.useState)(!1),[p,j]=(0,s.useState)(!1),[y,b]=(0,s.useState)(!1),[S,M]=(0,s.useState)(!1),{savedProjects:E,saveProject:I,deleteProject:O,loadProjects:T,loadProjectIntoEditor:L,clearCurrentProject:z}=tu(),_=()=>{if(!e)return;let t=e.toJSON();I(e.toDataURL({format:"png",multiplier:.5}),t);},H=()=>{e&&(e.discardActiveObject(),e.clear(),n.saveState(),z());},N=async()=>{if(!e)return;let t=e.getActiveObject();t&&d(await t.clone());},X=async()=>{if(!e||!i)return;let t=await i.clone();e.discardActiveObject(),t.set({left:(t.left||0)+10,top:(t.top||0)+10,evented:!0}),t instanceof ew.ActiveSelection?(t.canvas=e,t.forEachObject(t=>{e.add(t);}),t.setCoords()):e.add(t),e.setActiveObject(t),e.requestRenderAll(),n.saveState();};(0,s.useEffect)(()=>{let a=a=>{if("INPUT"!==a.target.tagName&&"TEXTAREA"!==a.target.tagName&&(!((null==e?void 0:e.getActiveObject())instanceof ew.IText)||!e.getActiveObject().isEditing)){if("Space"===a.code){c.current||(c.current=!0,o.current=l,"hand"!==l&&t("hand")),a.preventDefault();return;}("v"===a.key||"V"===a.key)&&t("select"),("h"===a.key||"H"===a.key)&&t("hand"),("b"===a.key||"B"===a.key)&&t("brush"),"c"!==a.key&&"C"!==a.key||a.ctrlKey||a.metaKey||b(!0),("m"===a.key||"M"===a.key)&&r instanceof ew.FabricImage&&g(!0),("r"===a.key||"R"===a.key)&&W(),("t"===a.key||"T"===a.key)&&t("text"),("Delete"===a.key||"Backspace"===a.key)&&V(),(a.ctrlKey||a.metaKey)&&("z"===a.key||"Z"===a.key)&&(a.preventDefault(),a.shiftKey?n.redo():n.undo()),(a.ctrlKey||a.metaKey)&&"y"===a.key&&(a.preventDefault(),n.redo()),(a.ctrlKey||a.metaKey)&&"c"===a.key&&(a.preventDefault(),N()),(a.ctrlKey||a.metaKey)&&"s"===a.key&&(a.preventDefault(),_()),(a.ctrlKey||a.metaKey)&&a.shiftKey&&"S"===a.key&&(a.preventDefault(),h(!0)),(a.ctrlKey||a.metaKey)&&"n"===a.key&&(a.preventDefault(),H());}},i=e=>{if("Space"===e.code&&c.current){c.current=!1;let l=o.current;o.current=null,l&&"hand"!==l&&t(l),e.preventDefault();}};return window.addEventListener("keydown",a),window.addEventListener("keyup",i),()=>{window.removeEventListener("keydown",a),window.removeEventListener("keyup",i);};},[e,r,n,l,i]),(0,s.useEffect)(()=>{let e=e=>{var t;let l=null===(t=e.clipboardData)||void 0===t?void 0:t.items;!(l&&Array.from(l).some(e=>e.type.includes("image")))&&i&&(e.preventDefault(),X());};return window.addEventListener("paste",e),()=>window.removeEventListener("paste",e);},[i,e,n]),(0,s.useEffect)(()=>{if(!e)return;let t=!1,n=0,r=0,a=a=>{if("hand"!==l)return;t=!0;let i=a.e;n=i.clientX,r=i.clientY;try{e.discardActiveObject();}catch(e){}e.requestRenderAll(),e.defaultCursor="grabbing",document.body.style.cursor="grabbing",e.forEachObject(e=>e.evented=!1);},i=a=>{if(!t||"hand"!==l)return;let i=a.e,s=i.clientX-n,d=i.clientY-r;n=i.clientX,r=i.clientY,e.relativePan(new ew.Point(s,d)),e.requestRenderAll();},s=()=>{t&&(t=!1,e.defaultCursor="default",document.body.style.cursor="default",e.forEachObject(e=>e.evented=!0));};return e.on("mouse:down",a),e.on("mouse:move",i),e.on("mouse:up",s),()=>{e.off("mouse:down",a),e.off("mouse:move",i),e.off("mouse:up",s);try{e.forEachObject(e=>e.evented=!0);}catch(e){}e.defaultCursor="default",document.body.style.cursor="default";};},[e,l]);let W=()=>{if(!e)return;let t=new ew.Rect({left:100,top:100,fill:"#ff0000",width:100,height:100});e.add(t),e.setActiveObject(t),n.saveState();},V=()=>{if(!e)return;let t=e.getActiveObjects();t.length&&(e.discardActiveObject(),t.forEach(t=>{e.remove(t);}),n.saveState());},U=()=>{if(!r||!(r instanceof ew.FabricImage))return null;let e=r.getElement(),t=document.createElement("canvas");t.width=e.width,t.height=e.height;let l=t.getContext("2d");return l&&l.drawImage(e,0,0),t;},G=r instanceof ew.FabricImage;return(0,a.jsxs)(A.default,{direction:"vertical",style:{padding:"8px"},children:[(0,a.jsx)(k.default,{title:"Hand (H)",children:(0,a.jsx)(C.default,{type:"hand"===l?"primary":"default",icon:(0,a.jsx)(th,{name:"iconhand",styles:{height:16,width:16}}),onClick:()=>t("hand")})}),(0,a.jsx)(k.default,{title:"Select (V)",children:(0,a.jsx)(C.default,{type:"select"===l?"primary":"default",icon:(0,a.jsx)(B.default,{}),onClick:()=>t("select")})}),(0,a.jsx)(k.default,{title:"Brush (B)",children:(0,a.jsx)(C.default,{type:"brush"===l?"primary":"default",icon:(0,a.jsx)(J.default,{}),onClick:()=>t("brush")})}),(0,a.jsx)(R.default,{overlay:(0,a.jsxs)(D.default,{children:[(0,a.jsx)(D.default.Item,{icon:(0,a.jsx)(P.default,{}),onClick:W,children:"Rectangle"},"rect"),(0,a.jsx)(D.default.Item,{icon:(0,a.jsx)(Y,{}),onClick:()=>{if(!e)return;let t=new ew.Circle({left:100,top:100,fill:"#00ff00",radius:50});e.add(t),e.setActiveObject(t),n.saveState();},children:"Circle"},"circle"),(0,a.jsx)(D.default.Item,{icon:(0,a.jsx)(P.default,{}),onClick:()=>{if(!e)return;let t=new ew.Triangle({left:100,top:100,fill:"#0000ff",width:100,height:100});e.add(t),e.setActiveObject(t),n.saveState();},children:"Triangle"},"triangle"),(0,a.jsx)(D.default.Item,{icon:(0,a.jsx)(P.default,{}),onClick:()=>{if(!e)return;let t=new ew.Polygon([{x:200,y:100},{x:250,y:125},{x:250,y:175},{x:200,y:200},{x:150,y:175},{x:150,y:125}],{left:100,top:100,fill:"#ffff00",objectCaching:!1});e.add(t),e.setActiveObject(t),n.saveState();},children:"Polygon"},"polygon")]}),trigger:["click"],children:(0,a.jsx)(k.default,{title:"Shapes",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(em,{})})})}),(0,a.jsx)(k.default,{title:"Text (T)",children:(0,a.jsx)(C.default,{type:"text"===l?"primary":"default",icon:(0,a.jsx)(F.default,{}),onClick:()=>t("text")})}),(0,a.jsx)("input",{type:"file",id:"image-upload",hidden:!0,accept:"image/*",onChange:t=>{if(!e||!t.target.files||!t.target.files[0])return;let l=t.target.files[0],r=new FileReader;r.onload=t=>{var l;let r=null===(l=t.target)||void 0===l?void 0:l.result;ew.FabricImage.fromURL(r).then(t=>{t.scaleToWidth(200),e.add(t),e.centerObject(t),e.setActiveObject(t),n.saveState();});},r.readAsDataURL(l);}}),(0,a.jsx)("input",{type:"file",id:"project-import",hidden:!0,accept:"application/json, .json",onChange:t=>{if(!e)return;let l=t.target.files&&t.target.files[0];if(!l)return;let r=new FileReader;r.onload=t=>{try{var l;let r=null===(l=t.target)||void 0===l?void 0:l.result,a=JSON.parse(r);e.loadFromJSON(a,()=>{e.renderAll(),n.saveState();});}catch(e){console.error("Failed to import project JSON",e),alert("Failed to import project file. Make sure it is a valid project JSON.");}},r.readAsText(l),t.currentTarget.value="";}}),(0,a.jsx)(m.default,{style:{margin:"8px 0"}}),(0,a.jsx)(k.default,{title:"Crop (C)",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(ey,{}),onClick:()=>b(!0)})}),(0,a.jsx)(k.default,{title:"Mask (M)",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(et.default,{}),onClick:()=>g(!0),disabled:!G})}),(0,a.jsx)(k.default,{title:"Camera Raw Filter",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(en.default,{}),onClick:()=>v(!0),disabled:!G})}),(0,a.jsx)(k.default,{title:"Blur Brush",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(J.default,{}),onClick:()=>M(!0)})}),(0,a.jsx)(m.default,{style:{margin:"8px 0"}}),(0,a.jsx)(k.default,{title:"Undo (Ctrl+Z)",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(K.default,{}),onClick:n.undo,disabled:!n.canUndo})}),(0,a.jsx)(k.default,{title:"Redo (Ctrl+Y)",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(q.default,{}),onClick:n.redo,disabled:!n.canRedo})}),(0,a.jsx)(m.default,{style:{margin:"8px 0"}}),(0,a.jsx)(R.default,{overlay:(0,a.jsxs)(D.default,{children:[(0,a.jsx)(D.default.Item,{icon:(0,a.jsx)($.default,{}),onClick:()=>{var e;return null===(e=document.getElementById("image-upload"))||void 0===e?void 0:e.click();},children:"Upload Image"},"upload"),(0,a.jsx)(D.default.Item,{icon:(0,a.jsx)(ea.default,{}),onClick:N,disabled:!r,children:"Copy (Ctrl + C)"},"copy"),(0,a.jsx)(D.default.Item,{icon:(0,a.jsx)(es.default,{}),onClick:X,disabled:!i,children:"Paste (Ctrl + V)"},"paste"),(0,a.jsx)(D.default.Divider,{}),(0,a.jsx)(D.default.Item,{icon:(0,a.jsx)($.default,{}),onClick:H,children:"New Project (Ctrl + N)"},"new"),(0,a.jsx)(D.default.Item,{icon:(0,a.jsx)(eo.default,{}),onClick:_,children:"Save Project (Ctrl + S)"},"save"),(0,a.jsx)(D.default.Item,{icon:(0,a.jsx)(eh,{}),onClick:()=>j(!0),children:"Open Projects"},"open"),(0,a.jsx)(D.default.Item,{icon:(0,a.jsx)(ep.default,{}),onClick:()=>{var e;return null===(e=document.getElementById("project-import"))||void 0===e?void 0:e.click();},children:"Import Project (JSON)"},"import"),(0,a.jsx)(D.default.Item,{icon:(0,a.jsx)(Z.default,{}),onClick:()=>h(!0),children:"Export (Ctrl + Shift + S)"},"export")]}),trigger:["click"],children:(0,a.jsx)(k.default,{title:"More",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(eg,{})})})}),(0,a.jsx)(eT,{visible:u,onCancel:()=>h(!1),canvas:e}),f&&G&&(0,a.jsx)(eK,{open:f,onCancel:()=>g(!1),onApply:t=>{e&&r&&(e$(e,r,t),n.saveState(),g(!1));},sourceCanvas:U(),selectedColor:null}),x&&G&&(0,a.jsx)(tK,{visible:x,onCancel:()=>v(!1),onApply:t=>{if(!e||!r||!(r instanceof ew.FabricImage))return;let l=new ew.FabricImage(t);l.set({left:r.left,top:r.top,scaleX:r.scaleX,scaleY:r.scaleY,angle:r.angle,skewX:r.skewX,skewY:r.skewY,flipX:r.flipX,flipY:r.flipY,originX:r.originX,originY:r.originY,opacity:r.opacity});let a=e.getObjects().indexOf(r);e.discardActiveObject(),e.remove(r),e.add(l),e.moveObjectTo(l,a),e.setActiveObject(l),e.requestRenderAll(),n.saveState(),v(!1);},sourceCanvas:U()}),(0,a.jsx)(e4,{visible:p,onCancel:()=>j(!1),projects:E,onLoad:t=>{e&&e.loadFromJSON(t.json).then(()=>{e.renderAll(),L(t),j(!1),n.saveState();});},onDelete:O}),y&&(0,a.jsx)(e3,{visible:y,onCancel:()=>b(!1),canvas:e,history:n}),S&&(0,a.jsx)(ta,{visible:S,onCancel:()=>M(!1),canvas:e,history:n})]});},tq=e=>{let t=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!e)return;let l=async l=>{if((l.ctrlKey||l.metaKey)&&"c"===l.key){let l=e.getActiveObject();if(l){let e=await l.clone();t.current=e;}}if((l.ctrlKey||l.metaKey)&&"v"===l.key&&t.current){let l=await t.current.clone();e.discardActiveObject(),l.set({left:(l.left||0)+10,top:(l.top||0)+10,evented:!0}),"activeSelection"===l.type?(l.canvas=e,l.forEachObject(t=>{e.add(t);}),l.setCoords()):e.add(l),t.current=l,e.setActiveObject(l),e.requestRenderAll();}e.isDrawingMode&&e.freeDrawingBrush&&("["===l.key?e.freeDrawingBrush.width=Math.max(1,e.freeDrawingBrush.width-5):"]"===l.key&&(e.freeDrawingBrush.width+=5));};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l);};},[e]);},tG=()=>{let e=(0,s.useRef)(null),t=(0,s.useRef)(null),{canvas:l,setCanvas:n,selectedObject:r,setSelectedObject:i,history:d,imageUrl:o,initialProject:c,activeTool:u,addOnFile:h,setAddOnFile:f,setActiveTool:g,brushSize:x,setBrushSize:m,brushColor:v,setBrushColor:p}=(0,w.usePhotoEditor)(),j=(0,s.useRef)(!1);tq(l);let y=(0,s.useRef)(!1),b=(0,s.useRef)(null),C=(0,s.useRef)(null),S=(0,s.useRef)(!1),k=(0,s.useRef)(0),M=(0,s.useRef)(0),A=(0,s.useRef)(x);return(0,s.useEffect)(()=>{A.current=x;},[x]),(0,s.useEffect)(()=>{if(!l||!h)return;let e=new FileReader;e.onload=e=>{var t;let n=null===(t=e.target)||void 0===t?void 0:t.result;ew.FabricImage.fromURL(n).then(e=>{e.scaleToWidth(200),l.add(e),l.centerObject(e),l.setActiveObject(e),d.saveState(),f&&f(null);});},e.readAsDataURL(h);},[h,l]),(0,s.useEffect)(()=>{l&&l.freeDrawingBrush&&"brush"===u&&(l.freeDrawingBrush.width=x,l.freeDrawingBrush.color=v);},[l,u,x,v]),(0,s.useEffect)(()=>{if(!l||!t.current)return;let e=t.current,n=l.lowerCanvasEl||null,r=document.createElement("div");r.style.position="absolute",r.style.pointerEvents="none",r.style.width="28px",r.style.height="28px",r.style.borderRadius="50%",r.style.boxShadow="0 0 4px rgba(0,0,0,0.5)",r.style.border="2px solid #fff",r.style.transform="translate(-50%, -50%)",r.style.display="none",r.style.zIndex="1000",e.appendChild(r),b.current=r;let a=document.createElement("div");a.style.position="absolute",a.style.pointerEvents="none",a.style.border="1px solid rgba(0,0,0,0.5)",a.style.borderRadius="50%",a.style.transform="translate(-50%, -50%)",a.style.display="none",a.style.zIndex="999",e.appendChild(a),C.current=a;let i=(e,t,n)=>{C.current&&("brush"===u&&(n>10||S.current)?(C.current.style.width=`${n}px`,C.current.style.height=`${n}px`,C.current.style.left=`${e}px`,C.current.style.top=`${t}px`,C.current.style.display="block","none"!==l.defaultCursor&&(l.defaultCursor="none",l.hoverCursor="none",l.requestRenderAll())):(C.current.style.display="none","none"===l.defaultCursor&&(l.defaultCursor="default",l.hoverCursor="move",l.requestRenderAll())));},s=e=>{"Alt"===e.key&&(y.current=!0,"brush"===u&&(l.isDrawingMode=!1));},d=e=>{"Alt"===e.key&&(y.current=!1,"brush"!==u||S.current||(l.isDrawingMode=!0),b.current&&(b.current.style.display="none"));},o=e=>{e.altKey&&e.preventDefault();},c=t=>{if("brush"===u){if(t.altKey&&2===t.button){t.preventDefault(),S.current=!0,k.current=t.clientX,M.current=A.current,l.isDrawingMode=!1;return;}if(t.altKey&&0===t.button)try{let l=e.getBoundingClientRect(),r=t.clientX-l.left,a=t.clientY-l.top;if(!n)return;let i=n.getContext("2d");if(!i)return;let s=i.getImageData(r,a,1,1).data,d="#"+[s[0],s[1],s[2]].map(e=>e.toString(16).padStart(2,"0")).join("");p(d);}catch(e){}}},h=t=>{if("brush"!==u){C.current&&(C.current.style.display="none");return;}let l=e.getBoundingClientRect(),r=t.clientX-l.left,a=t.clientY-l.top;if(S.current){let e=t.clientX-k.current,l=Math.max(1,M.current+e);m(l),i(r,a,l);return;}if(i(r,a,A.current),y.current)try{if(!n)return;let e=n.getContext("2d");if(!e)return;if(r<0||a<0||r>=n.width||a>=n.height){b.current&&(b.current.style.display="none");return;}let t=e.getImageData(r,a,1,1).data,l="#"+[t[0],t[1],t[2]].map(e=>e.toString(16).padStart(2,"0")).join("");b.current&&(b.current.style.background=l,b.current.style.display="block",b.current.style.left=r+24+"px",b.current.style.top=a+24+"px");}catch(e){b.current&&(b.current.style.display="none");}else b.current&&(b.current.style.display="none");},f=e=>{S.current&&(S.current=!1,"brush"!==u||y.current||(l.isDrawingMode=!0));};return window.addEventListener("keydown",s),window.addEventListener("keyup",d),e.addEventListener("contextmenu",o),e.addEventListener("mousedown",c),window.addEventListener("mousemove",h),window.addEventListener("mouseup",f),()=>{if(window.removeEventListener("keydown",s),window.removeEventListener("keyup",d),e.removeEventListener("contextmenu",o),e.removeEventListener("mousedown",c),window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",f),b.current){try{e.removeChild(b.current);}catch(e){}b.current=null;}if(C.current){try{e.removeChild(C.current);}catch(e){}C.current=null;}l&&(l.defaultCursor="default",l.hoverCursor="move");};},[l,u,m,p]),(0,s.useEffect)(()=>{if(!e.current||!t.current)return;let l=new ew.Canvas(e.current,{width:t.current.clientWidth,height:t.current.clientHeight,backgroundColor:"#ffffff",preserveObjectStacking:!0,selection:!0});n(l),c?l.loadFromJSON(c.json).then(()=>{l.renderAll(),d.saveState();}):o&&ew.FabricImage.fromURL(o).then(e=>{let n=t.current.clientWidth,r=t.current.clientHeight;(e.width>n||e.height>r)&&e.scaleToWidth(.8*n),l.add(e),l.centerObject(e),l.setActiveObject(e),d.saveState();});let r=()=>{let e=l.getActiveObjects();1===e.length?i(e[0]):i(null);};l.on("selection:created",r),l.on("selection:updated",r),l.on("selection:cleared",()=>i(null)),l.on("text:editing:entered",()=>{j.current=!0,g&&g("text");}),l.on("text:editing:exited",()=>g&&g("select"));let a=()=>{d.saveState();};l.on("object:modified",a),l.on("object:added",a),l.on("object:removed",a);let s=e=>{if(e.ctrlKey){e.preventDefault();try{let t=l.getZoom()||1,n=e.deltaY,r=t*(n<0?1.12:.88);r=Math.max(.1,Math.min(5,r));let a=l.getPointer(e);if(a&&"number"==typeof a.x&&"number"==typeof a.y)l.zoomToPoint(new ew.Point(a.x,a.y),r);else{let t=l.lowerCanvasEl.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top;l.zoomToPoint(new ew.Point(n,a),r);}l.requestRenderAll();}catch(e){}}};t.current.addEventListener("wheel",s,{passive:!1});let u=()=>{t.current&&l.setDimensions({width:t.current.clientWidth,height:t.current.clientHeight});};return window.addEventListener("resize",u),()=>{if(l.dispose(),window.removeEventListener("resize",u),t.current)try{t.current.removeEventListener("wheel",s);}catch(e){}};},[]),(0,s.useEffect)(()=>{if(r)try{let e=!!r.isEditing;j.current=e,e&&g&&g("text");}catch(e){}},[r,g]),(0,s.useEffect)(()=>{l&&("brush"===u?(l.isDrawingMode=!0,l.freeDrawingBrush||(l.freeDrawingBrush=new ew.PencilBrush(l)),l.freeDrawingBrush.width=x,l.freeDrawingBrush.color=v):l.isDrawingMode=!1);},[u,l]),(0,s.useEffect)(()=>{if(!l||"text"!==u)return;let e=e=>{try{if(j.current)return;let t=l.getViewportPoint(e.e),n=new ew.IText("Text",{left:t.x,top:t.y,fontSize:24});l.add(n),l.setActiveObject(n),i&&i(n),n.enterEditing&&n.enterEditing(),n.selectAll&&n.selectAll(),l.requestRenderAll(),d.saveState(),g&&g("select");}catch(e){}};return l.on("mouse:down",e),()=>{l.off("mouse:down",e);};},[l,u,d,i,g]),(0,a.jsx)("div",{ref:t,style:{width:"100%",height:"100%"},children:(0,a.jsx)("canvas",{ref:e})});};var tJ=l("7502124f"),tQ=n._(tJ),tZ=l("5a5a4642"),t0=n._(tZ),t1=l("6e3683a5"),t2=n._(t1),t6=l("acdcfa21"),t5=n._(t6),t4=l("e36949ef"),t8=n._(t4),t3=l("0d6a818e"),t7=l("4989c16f"),t9=l("039e4dd6");let{Title:le}=e1.default,{Option:lt}=eA.default,ll=({id:e,children:t,isSelected:l,onClick:n})=>{let{attributes:r,listeners:i,setNodeRef:s,setActivatorNodeRef:d,transform:o,transition:c}=(0,t7.useSortable)({id:e}),u={transform:t9.CSS.Transform.toString(o),transition:c,backgroundColor:l?"#e6f7ff":"transparent",marginBottom:4,border:"1px solid #f0f0f0",borderRadius:4,padding:"4px 8px",display:"flex",alignItems:"center"};return(0,a.jsxs)("div",{ref:s,style:u,children:[(0,a.jsx)("div",{ref:d,...r,...i,style:{cursor:"grab",marginRight:8,display:"flex",alignItems:"center",color:"#999"},onMouseDown:e=>e.stopPropagation(),children:(0,a.jsx)(t2.default,{})}),(0,a.jsx)("div",{onClick:e=>n(e),style:{flex:1,cursor:"pointer"},children:t})]});},ln=()=>{let{canvas:e,selectedObject:t,setSelectedObject:l,history:n}=(0,w.usePhotoEditor)(),[r,i]=(0,s.useState)([]),[d,o]=(0,s.useState)([]),c=(0,s.useRef)(!1),u=(0,s.useRef)(null),h=(0,s.useRef)(100),f=(0,s.useRef)(null),g=(0,t3.useSensors)((0,t3.useSensor)(t3.PointerSensor),(0,t3.useSensor)(t3.KeyboardSensor,{coordinateGetter:t7.sortableKeyboardCoordinates})),x=()=>{if(!e)return;let t=e.getObjects();t.forEach(e=>{e.uid||(e.uid=Math.random().toString(36).substr(2,9));}),i([...t].reverse());};(0,s.useEffect)(()=>{let t;if(!e)return;let n=()=>{clearTimeout(t),t=setTimeout(x,100);},r=()=>{let t=e.getObjects();1===t.length&&t[0].set({lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,selectable:!1,hoverCursor:"default"}),n();};e.on("object:added",r),e.on("object:removed",n),e.on("object:modified",n);let a=()=>{o((e.getActiveObjects()||[]).map(e=>e.uid).filter(Boolean)),l(e.getActiveObject()??null);},i=()=>{o([]),l(null);};return e.on("selection:created",a),e.on("selection:updated",a),e.on("selection:cleared",i),x(),()=>{e.off("object:added",r),e.off("object:removed",n),e.off("object:modified",n),e.off("selection:created",a),e.off("selection:updated",a),e.off("selection:cleared",i),clearTimeout(t);};},[e]);let m=(t,l)=>{l.stopPropagation(),t.visible=!t.visible,t.visible||null==e||e.discardActiveObject(),null==e||e.requestRenderAll(),n.saveState(),i([...(null==e?void 0:e.getObjects())||[]].reverse());},v=(t,l)=>{l.stopPropagation(),t.lockMovementX=!t.lockMovementX,t.lockMovementY=!t.lockMovementY,t.lockRotation=!t.lockRotation,t.lockScalingX=!t.lockScalingX,t.lockScalingY=!t.lockScalingY,t.selectable=!t.lockMovementX,t.selectable||null==e||e.discardActiveObject(),null==e||e.requestRenderAll(),n.saveState(),i([...(null==e?void 0:e.getObjects())||[]].reverse());},p=(t,n)=>{if(!e||!t.visible||!t.selectable)return;let a=r.findIndex(e=>e===t),i=n&&(n.ctrlKey||n.metaKey),s=n&&n.shiftKey;if(i){let n=e.getActiveObjects()||[],r=n.includes(t),i=[];if(0===(i=r?n.filter(e=>e!==t):[...n,t]).length)e.discardActiveObject(),l(null);else if(1===i.length)e.setActiveObject(i[0]),l(i[0]);else{let t=new ew.ActiveSelection(i,{canvas:e});e.setActiveObject(t),l(i[i.length-1]);}e.requestRenderAll(),f.current=a;return;}if(s&&null!==f.current){let t=Math.min(f.current,a),n=Math.max(f.current,a),i=r.slice(t,n+1).map(e=>e);if(1===i.length)e.setActiveObject(i[0]),l(i[0]);else{let t=new ew.ActiveSelection(i,{canvas:e});e.setActiveObject(t),l(i[i.length-1]);}e.requestRenderAll();return;}e.setActiveObject(t),l(t),e.requestRenderAll(),f.current=a;},j=(t,l)=>{l.stopPropagation(),null==e||e.remove(t),null==e||e.requestRenderAll(),n.saveState();},y=l=>{if(!e||!t)return;let n=Number(l||0);t.set("opacity",Math.max(0,Math.min(100,n))/100),e.requestRenderAll();},b=()=>{n.saveState();};return(0,a.jsxs)("div",{style:{padding:10},children:[(0,a.jsx)(le,{level:5,children:"Layers"}),(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsxs)(A.default,{children:[(0,a.jsx)(C.default,{icon:(0,a.jsx)(t5.default,{}),onClick:()=>{if(!e)return;let t=[...e.getActiveObjects()];if(t.length<=1)return;e.discardActiveObject();let r=new ew.Group(t);r.uid||(r.uid=Math.random().toString(36).substr(2,9)),t.forEach(t=>e.remove(t)),e.add(r),e.setActiveObject(r),e.requestRenderAll(),n.saveState(),x(),l(r),o([r.uid]);},disabled:!t,title:"Merge Layers"}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(t8.default,{}),onClick:()=>{if(!e)return;let t=e.getActiveObject();if(t&&("group"===t.type||t instanceof ew.Group)){let r=t.getObjects().map(e=>{let t=e.calcTransformMatrix(),l=ew.util.qrDecompose(t);return e.set({...l,left:l.translateX,top:l.translateY,angle:l.angle,scaleX:l.scaleX,scaleY:l.scaleY,skewX:l.skewX,skewY:l.skewY}),e;});e.remove(t),r.forEach(t=>{e.add(t);});let a=new ew.ActiveSelection(r,{canvas:e});e.setActiveObject(a),e.requestRenderAll(),n.saveState(),x(),l(a),o(r.map(e=>e.uid));}},disabled:!t||"group"!==t.type,title:"Ungroup Layers"})]})}),t&&(0,a.jsxs)("div",{style:{marginBottom:16,padding:8,background:"#fafafa",borderRadius:4},children:[(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,cursor:"ew-resize",userSelect:"none"},onMouseDown:l=>{if(0!==l.button)return;l.preventDefault(),c.current=!0,u.current=l.clientX,h.current=Math.round(((null==t?void 0:t.opacity)??1)*100);let r=document.body.style.userSelect;document.body.style.userSelect="none";let a=t=>{if(!c.current||null===u.current)return;let l=t.clientX-u.current,n=Math.max(0,Math.min(100,h.current+.2*l)),r=null==e?void 0:e.getActiveObject();r&&e&&(r.set("opacity",n/100),e.requestRenderAll());},i=()=>{c.current=!1,u.current=null,document.body.style.userSelect=r,window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",i),n.saveState();};window.addEventListener("mousemove",a),window.addEventListener("mouseup",i);},children:[(0,a.jsx)("div",{style:{marginRight:8},children:"Opacity:"}),(0,a.jsx)(eR.default,{size:"small",min:0,max:100,step:1,value:Math.round((t.opacity??1)*100),onChange:e=>y(e),onBlur:()=>b(),style:{flex:1}})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,width:"100%"},children:[(0,a.jsx)("div",{style:{marginRight:8},children:"Blend Mode:"}),(0,a.jsxs)(eA.default,{size:"small",style:{flex:1},value:t.globalCompositeOperation||"source-over",onChange:l=>{e&&t&&(t.set("globalCompositeOperation",l),e.requestRenderAll(),n.saveState());},children:[(0,a.jsx)(lt,{value:"source-over",children:"Normal"}),(0,a.jsx)(lt,{value:"multiply",children:"Multiply"}),(0,a.jsx)(lt,{value:"screen",children:"Screen"}),(0,a.jsx)(lt,{value:"overlay",children:"Overlay"}),(0,a.jsx)(lt,{value:"darken",children:"Darken"}),(0,a.jsx)(lt,{value:"lighten",children:"Lighten"}),(0,a.jsx)(lt,{value:"color-dodge",children:"Color Dodge"}),(0,a.jsx)(lt,{value:"color-burn",children:"Color Burn"}),(0,a.jsx)(lt,{value:"hard-light",children:"Hard Light"}),(0,a.jsx)(lt,{value:"soft-light",children:"Soft Light"}),(0,a.jsx)(lt,{value:"difference",children:"Difference"}),(0,a.jsx)(lt,{value:"exclusion",children:"Exclusion"}),(0,a.jsx)(lt,{value:"hue",children:"Hue"}),(0,a.jsx)(lt,{value:"saturation",children:"Saturation"}),(0,a.jsx)(lt,{value:"color",children:"Color"}),(0,a.jsx)(lt,{value:"luminosity",children:"Luminosity"})]})]})})]}),(0,a.jsx)(t3.DndContext,{sensors:g,collisionDetection:t3.closestCenter,onDragEnd:t=>{let{active:l,over:a}=t;if(a&&l.id!==a.id){let t=r.findIndex(e=>e.uid===l.id),i=r.findIndex(e=>e.uid===a.id);if(-1!==t&&-1!==i){let l=r.length-1-i,a=r[t];null==e||e.moveObjectTo(a,l),null==e||e.requestRenderAll(),n.saveState(),x();}}},children:(0,a.jsx)(t7.SortableContext,{items:r.map(e=>e.uid),strategy:t7.verticalListSortingStrategy,children:(0,a.jsx)("div",{style:{overflowY:"auto",border:"1px solid #d9d9d9",borderRadius:4,padding:4},children:r.map((e,t)=>{let l=d.includes(e.uid),n=e.type||"Object",i=e.name||`${n} ${r.length-t}`;return(0,a.jsx)(ll,{id:e.uid,isSelected:l,onClick:t=>p(e,t),children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},children:[(0,a.jsx)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:120},children:i}),(0,a.jsxs)(A.default,{size:4,children:[(0,a.jsx)(C.default,{type:"text",size:"small",icon:e.visible?(0,a.jsx)(e9.default,{}):(0,a.jsx)(ty.default,{}),onClick:t=>m(e,t),onMouseDown:e=>e.stopPropagation()}),(0,a.jsx)(C.default,{type:"text",size:"small",icon:e.lockMovementX?(0,a.jsx)(tQ.default,{}):(0,a.jsx)(t0.default,{}),onClick:t=>v(e,t),onMouseDown:e=>e.stopPropagation()}),(0,a.jsx)(C.default,{type:"text",size:"small",danger:!0,icon:(0,a.jsx)(e6.default,{}),onClick:t=>j(e,t),onMouseDown:e=>e.stopPropagation()})]})]})},e.uid);})})})})]});},{Panel:lr}=t_.default,la=[{name:"Grayscale",filter:ew.filters.Grayscale,index:9},{name:"Invert",filter:ew.filters.Invert,index:10},{name:"Sepia",filter:ew.filters.Sepia,index:11},{name:"Black&White",filter:ew.filters.BlackWhite,index:12},{name:"Brownie",filter:ew.filters.Brownie,index:13},{name:"Vintage",filter:ew.filters.Vintage,index:14},{name:"Kodachrome",filter:ew.filters.Kodachrome,index:15},{name:"Technicolor",filter:ew.filters.Technicolor,index:16},{name:"Polaroid",filter:ew.filters.Polaroid,index:17}],li=({name:e,filterClass:t,originalImage:l,isActive:n,onClick:r})=>{let i=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!l||!i.current)return;let e=i.current,n=e.getContext("2d");if(!n)return;e.width=60,e.height=60;let r=new ew.FabricImage(l),a=60/Math.max(r.width||1,r.height||1);r.scale(a);let s=new t;r.filters=[s],r.applyFilters();let d=r.getElement();n.clearRect(0,0,60,60);let o=(r.width||0)*(r.scaleX||1),c=(r.height||0)*(r.scaleY||1);n.drawImage(d,(60-o)/2,(60-c)/2,o,c);},[l,t]),(0,a.jsxs)("div",{onClick:r,style:{cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[(0,a.jsx)("div",{style:{width:64,height:64,border:n?"2px solid #1890ff":"1px solid #f0f0f0",borderRadius:4,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f5f5f5"},children:(0,a.jsx)("canvas",{ref:i})}),(0,a.jsx)(e1.default.Text,{style:{fontSize:10,textAlign:"center",lineHeight:1.2},children:e})]});},ls=()=>{let{canvas:e,selectedObject:t,history:l}=(0,w.usePhotoEditor)(),[n,r]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(t&&t.isType("image")){let e=t.getSrc(),l=new Image;l.crossOrigin="anonymous",l.src=e,l.onload=()=>{r(l);};}else r(null);},[t]);let i=(l,n)=>{t&&t.isType("image")&&(t.filters[l]=n,t.applyFilters(),null==e||e.requestRenderAll());},d=(e,t,n)=>{i(e,!!n&&new t),l.saveState();};return t&&t.isType("image")?(0,a.jsxs)("div",{style:{padding:10,height:"100%",overflowY:"auto"},children:[(0,a.jsx)(e1.default.Title,{level:5,children:"Adjustments"}),(0,a.jsxs)(t_.default,{defaultActiveKey:["1","2","3"],ghost:!0,children:[(0,a.jsx)(lr,{header:"Basic",children:(0,a.jsxs)(A.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(e1.default.Text,{children:"Brightness"}),(0,a.jsx)(eL.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:e=>{i(0,new ew.filters.Brightness({brightness:e}));},onChangeComplete:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(e1.default.Text,{children:"Contrast"}),(0,a.jsx)(eL.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:e=>{i(1,new ew.filters.Contrast({contrast:e}));},onChangeComplete:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(e1.default.Text,{children:"Saturation"}),(0,a.jsx)(eL.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:e=>{i(2,new ew.filters.Saturation({saturation:e}));},onChangeComplete:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(e1.default.Text,{children:"Vibrance"}),(0,a.jsx)(eL.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:e=>{i(7,new ew.filters.Vibrance({vibrance:e}));},onChangeComplete:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(e1.default.Text,{children:"Gamma"}),(0,a.jsx)(eL.default,{min:.1,max:2.2,step:.1,defaultValue:1,onChange:e=>{i(6,new ew.filters.Gamma({gamma:[e,e,e]}));},onChangeComplete:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(e1.default.Text,{children:"Hue Rotation"}),(0,a.jsx)(eL.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:e=>{i(8,new ew.filters.HueRotation({rotation:e}));},onChangeComplete:()=>l.saveState()})]})]})},"1"),(0,a.jsx)(lr,{header:"Effects",children:(0,a.jsxs)(A.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(e1.default.Text,{children:"Blur"}),(0,a.jsx)(eL.default,{min:0,max:1,step:.01,defaultValue:0,onChange:e=>{i(5,new ew.filters.Blur({blur:e}));},onChangeComplete:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(e1.default.Text,{children:"Noise"}),(0,a.jsx)(eL.default,{min:0,max:1e3,defaultValue:0,onChange:e=>{i(3,new ew.filters.Noise({noise:e}));},onChangeComplete:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(e1.default.Text,{children:"Pixelate"}),(0,a.jsx)(eL.default,{min:1,max:20,defaultValue:1,onChange:e=>{i(4,e>1&&new ew.filters.Pixelate({blocksize:e}));},onChangeComplete:()=>l.saveState()})]})]})},"2"),(0,a.jsx)(lr,{header:"Filters",children:(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12},children:la.map(e=>{var l;let r=!!(null==t?void 0:null===(l=t.filters)||void 0===l?void 0:l[e.index]);return(0,a.jsx)(li,{name:e.name,filterClass:e.filter,originalImage:n,isActive:r,onClick:()=>d(e.index,e.filter,!r)},e.name);})})},"3")]})]}):(0,a.jsx)("div",{style:{padding:10},children:"Select an image to adjust"});},ld=()=>{let{canvas:e,brushSize:t,setBrushSize:l,brushColor:n,setBrushColor:r,brushOpacity:i,setBrushOpacity:d}=(0,w.usePhotoEditor)(),[o,c]=(0,s.useState)(0),[u,h]=(0,s.useState)("Pencil"),f=(0,s.useRef)(!1),g=(0,s.useRef)(null),x=(0,s.useRef)(t),m=(0,s.useRef)(!1),v=(0,s.useRef)(null),p=(0,s.useRef)(o),j=(0,s.useRef)(!1),y=(0,s.useRef)(null),b=(0,s.useRef)(i);return(0,s.useEffect)(()=>{if(!e)return;e.freeDrawingBrush||(e.freeDrawingBrush=new ew.PencilBrush(e));let l=e.freeDrawingBrush,r=n.replace("#",""),a=parseInt(r.substring(0,2),16),s=parseInt(r.substring(2,4),16),d=parseInt(r.substring(4,6),16);l.color=`rgba(${a},${s},${d},${i})`,l.width=t,o>0?l.shadow=new ew.Shadow({blur:o,color:l.color}):l.shadow=null;},[e,n,t,o,i]),(0,a.jsxs)("div",{style:{padding:10},children:[(0,a.jsx)(e1.default.Title,{level:5,children:"Brush Settings"}),(0,a.jsxs)(A.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(e1.default.Text,{children:"Type"}),(0,a.jsxs)(eA.default,{value:u,style:{width:"100%"},onChange:l=>{let r;if(!e)return;switch(h(l),l){case"Circle":r=new ew.CircleBrush(e);break;case"Spray":r=new ew.SprayBrush(e);break;default:r=new ew.PencilBrush(e);}let a=n.replace("#",""),s=parseInt(a.substring(0,2),16),d=parseInt(a.substring(2,4),16),c=parseInt(a.substring(4,6),16);r.color=`rgba(${s},${d},${c},${i})`,r.width=t,o>0&&(r.shadow=new ew.Shadow({blur:o,color:r.color})),e.freeDrawingBrush=r;},children:[(0,a.jsx)(eA.default.Option,{value:"Pencil",children:"Pencil"}),(0,a.jsx)(eA.default.Option,{value:"Circle",children:"Circle"}),(0,a.jsx)(eA.default.Option,{value:"Spray",children:"Spray"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(e1.default.Text,{children:"Color"}),(0,a.jsx)("br",{}),(0,a.jsx)(eN.default,{value:n,onChange:e=>r(e.toHexString()),showText:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(e1.default.Text,{onMouseDown:e=>{if(0!==e.button)return;e.preventDefault(),f.current=!0,g.current=e.clientX,x.current=t;let n=document.body.style.userSelect;document.body.style.userSelect="none";let r=e=>{if(!f.current||null===g.current)return;let t=e.clientX-g.current;l(Number(Math.max(1,Math.min(2e3,x.current+.2*t)).toFixed(0)));},a=()=>{f.current=!1,g.current=null,document.body.style.userSelect=n,window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",a);};window.addEventListener("mousemove",r),window.addEventListener("mouseup",a);},style:{cursor:"ew-resize",userSelect:"none"},children:"Width"}),(0,a.jsx)("br",{}),(0,a.jsx)(eR.default,{min:1,max:2e3,value:t,onChange:e=>l(Number(e||1)),style:{width:"100%"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(e1.default.Text,{onMouseDown:e=>{if(0!==e.button)return;e.preventDefault(),j.current=!0,y.current=e.clientX,b.current=i;let t=document.body.style.userSelect;document.body.style.userSelect="none";let l=e=>{if(!j.current||null===y.current)return;let t=e.clientX-y.current;d(Number(Math.max(0,Math.min(1,b.current+.002*t)).toFixed(2)));},n=()=>{j.current=!1,y.current=null,document.body.style.userSelect=t,window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",n);};window.addEventListener("mousemove",l),window.addEventListener("mouseup",n);},style:{cursor:"ew-resize",userSelect:"none"},children:"Opacity"}),(0,a.jsx)("br",{}),(0,a.jsx)(eR.default,{min:0,max:1,step:.01,value:i,onChange:e=>d(Number(e||1)),style:{width:"100%"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(e1.default.Text,{onMouseDown:e=>{if(0!==e.button)return;e.preventDefault(),m.current=!0,v.current=e.clientX,p.current=o;let t=document.body.style.userSelect;document.body.style.userSelect="none";let l=e=>{if(!m.current||null===v.current)return;let t=e.clientX-v.current;c(Number(Math.max(0,Math.min(200,p.current+.2*t)).toFixed(0)));},n=()=>{m.current=!1,v.current=null,document.body.style.userSelect=t,window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",n);};window.addEventListener("mousemove",l),window.addEventListener("mouseup",n);},style:{cursor:"ew-resize",userSelect:"none"},children:"Shadow Blur"}),(0,a.jsx)("br",{}),(0,a.jsx)(eR.default,{min:0,max:500,value:o,onChange:e=>c(Number(e||0)),style:{width:"100%"}})]})]})]});};var lo={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M697.8 481.4c33.6-35 54.2-82.3 54.2-134.3v-10.2C752 229.3 663.9 142 555.3 142H259.4c-15.1 0-27.4 12.3-27.4 27.4v679.1c0 16.3 13.2 29.5 29.5 29.5h318.7c117 0 211.8-94.2 211.8-210.5v-11c0-73-37.4-137.3-94.2-175.1zM328 238h224.7c57.1 0 103.3 44.4 103.3 99.3v9.5c0 54.8-46.3 99.3-103.3 99.3H328V238zm366.6 429.4c0 62.9-51.7 113.9-115.5 113.9H328V542.7h251.1c63.8 0 115.5 51 115.5 113.9v10.8z"}}]},name:"bold",theme:"outlined"},lc=s.forwardRef(function(e,t){return s.createElement(N.default,(0,z.default)((0,z.default)({},e),{},{ref:t,icon:lo}));}),lu=l("83ea51ed"),lh=n._(lu),lf={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M824 804H200c-4.4 0-8 3.4-8 7.6v60.8c0 4.2 3.6 7.6 8 7.6h624c4.4 0 8-3.4 8-7.6v-60.8c0-4.2-3.6-7.6-8-7.6zm-312-76c69.4 0 134.6-27.1 183.8-76.2C745 602.7 772 537.4 772 468V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 97-79 176-176 176s-176-79-176-176V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 69.4 27.1 134.6 76.2 183.8C377.3 701 442.6 728 512 728z"}}]},name:"underline",theme:"outlined"},lg=s.forwardRef(function(e,t){return s.createElement(N.default,(0,z.default)((0,z.default)({},e),{},{ref:t,icon:lf}));}),lx=l("711e1aa9"),lm=n._(lx),lv=l("16d526ba"),lp=n._(lv),lj=l("1872ef2e"),ly=n._(lj);let lw=["Arial","Helvetica","Times New Roman","Georgia","Courier New","Verdana"],lb=()=>{let{canvas:e,selectedObject:t,history:l,setActiveTool:n}=(0,w.usePhotoEditor)(),[r,i]=(0,s.useState)("Arial"),[d,o]=(0,s.useState)(24),[c,u]=(0,s.useState)(!1),[h,f]=(0,s.useState)(!1),[g,x]=(0,s.useState)(!1),[v,p]=(0,s.useState)("left"),[j,y]=(0,s.useState)("#000000");(0,s.useEffect)(()=>{t&&"i-text"===t.isType&&(i(t.fontFamily||"Arial"),o(t.fontSize||24),u("bold"===t.fontWeight||700===t.fontWeight),f("italic"===t.fontStyle),x(t.underline||!1),p(t.textAlign||"left"),y(t.fill||"#000000"));},[t]);let b=(n,r=!0)=>{t&&(t.set(n),t.setCoords&&t.setCoords(),e&&e.requestRenderAll(),r&&l&&l.saveState());};return(0,a.jsxs)("div",{style:{padding:12},children:[(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsx)("strong",{children:"Font"})}),(0,a.jsxs)(A.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsx)(eA.default,{value:r,onChange:e=>{i(e),b({fontFamily:e});},style:{width:"100%"},children:lw.map(e=>(0,a.jsx)(eA.default.Option,{value:e,children:e},e))}),(0,a.jsx)(eR.default,{min:8,max:200,value:d,onChange:e=>{o(e||24),b({fontSize:e||24});},style:{width:"100%"}}),(0,a.jsx)("div",{children:(0,a.jsxs)(A.default,{children:[(0,a.jsx)(C.default,{icon:(0,a.jsx)(lc,{}),type:c?"primary":"default",onClick:()=>{let e=!c;u(e),b({fontWeight:e?"bold":"normal"});}}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(lh.default,{}),type:h?"primary":"default",onClick:()=>{let e=!h;f(e),b({fontStyle:e?"italic":"normal"});}}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(lg,{}),type:g?"primary":"default",onClick:()=>{let e=!g;x(e),b({underline:e});}})]})}),(0,a.jsx)(m.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Horizontal Align (textAlign)"}),(0,a.jsx)("div",{style:{marginTop:8},children:(0,a.jsxs)(A.default,{children:[(0,a.jsx)(C.default,{icon:(0,a.jsx)(lm.default,{}),type:"left"===v?"primary":"default",onClick:()=>{p("left"),b({textAlign:"left"});}}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(lp.default,{}),type:"center"===v?"primary":"default",onClick:()=>{p("center"),b({textAlign:"center"});}}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(ly.default,{}),type:"right"===v?"primary":"default",onClick:()=>{p("right"),b({textAlign:"right"});}})]})})]}),(0,a.jsx)(m.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Color"}),(0,a.jsx)("div",{style:{marginTop:8},children:(0,a.jsx)(eN.default,{value:j,onChange:e=>{let l=e.toHexString();y(l),b({fill:l});try{(null==t?void 0:t.isEditing)&&n&&n("text");}catch(e){}},showText:!0})})]})]})]});},lC=()=>{let{canvas:e,selectedObject:t,history:l}=(0,w.usePhotoEditor)(),n=()=>{if(!e)return null;let t=e.getObjects();if(!t||0===t.length)return null;let l=t[0];try{return l.getBoundingRect();}catch(e){return null;}},r=n=>{t&&(t.set(n),t.setCoords&&t.setCoords(),e&&e.requestRenderAll(),l&&l.saveState());},i=l=>{if(!e||!t)return;let a=n();if(!a)return;let i=t.getBoundingRect(),s=t.left||0;"left"===l?s=a.left:"center"===l?s=a.left+(a.width-i.width)/2:"right"===l&&(s=a.left+a.width-i.width),r({left:s});},s=l=>{if(!e||!t)return;let a=n();if(!a)return;let i=t.getBoundingRect(),s=t.top||0;"top"===l?s=a.top:"middle"===l?s=a.top+(a.height-i.height)/2:"bottom"===l&&(s=a.top+a.height-i.height),r({top:s});};return(0,a.jsxs)("div",{style:{padding:12},children:[(0,a.jsx)("div",{style:{marginBottom:6},children:(0,a.jsx)("strong",{children:"Align to First Layer"})}),(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsxs)(A.default,{children:[(0,a.jsx)(C.default,{onClick:()=>i("left"),children:"H: Left"}),(0,a.jsx)(C.default,{onClick:()=>i("center"),children:"H: Center"}),(0,a.jsx)(C.default,{onClick:()=>i("right"),children:"H: Right"})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)(A.default,{children:[(0,a.jsx)(C.default,{onClick:()=>s("top"),children:"V: Top"}),(0,a.jsx)(C.default,{onClick:()=>s("middle"),children:"V: Middle"}),(0,a.jsx)(C.default,{onClick:()=>s("bottom"),children:"V: Bottom"})]})})]});},{Title:lS,Text:lk}=e1.default,lM=()=>{let{canvas:e,selectedObject:t,history:l}=(0,w.usePhotoEditor)();if(!t||!e)return null;let n=(n,r)=>{t.set(n,r),e.requestRenderAll(),l.saveState();},r=t.strokeWidth||0,i=t.stroke||"#000000",s=t.fill||"transparent";return(0,a.jsxs)("div",{style:{padding:16},children:[(0,a.jsx)(lS,{level:5,children:"Layer Style"}),(0,a.jsxs)(A.default,{direction:"vertical",style:{width:"100%"},size:"middle",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(lk,{strong:!0,children:"Fill Color"}),(0,a.jsx)("div",{style:{marginTop:8},children:(0,a.jsx)(eN.default,{value:s,onChange:e=>n("fill",e.toHexString()),showText:!0})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(lk,{strong:!0,children:"Border Color"}),(0,a.jsx)("div",{style:{marginTop:8},children:(0,a.jsx)(eN.default,{value:i,onChange:e=>n("stroke",e.toHexString()),showText:!0})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(lk,{strong:!0,children:"Border Thickness"}),(0,a.jsxs)(tm.default,{gutter:16,align:"middle",children:[(0,a.jsx)(tp.default,{span:16,children:(0,a.jsx)(eL.default,{min:0,max:50,value:r,onChange:e=>n("strokeWidth",e)})}),(0,a.jsx)(tp.default,{span:8,children:(0,a.jsx)(eR.default,{min:0,max:50,value:r,onChange:e=>n("strokeWidth",Number(e)),style:{width:"100%"}})})]})]})]})]});},lA=()=>{let{activeTool:e,selectedObject:t}=(0,w.usePhotoEditor)();if("brush"===e)return(0,a.jsx)(ld,{});if("text"===e)return(0,a.jsx)(lb,{});if(t&&("i-text"===t.type||"text"===t.type))return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(lb,{}),(0,a.jsx)(lM,{}),(0,a.jsx)(lC,{})]});if(t){let e=t instanceof ew.FabricImage||"image"===t.type;return(0,a.jsxs)(a.Fragment,{children:[e?(0,a.jsx)(ls,{}):(0,a.jsx)(lM,{}),(0,a.jsx)(lC,{})]});}return(0,a.jsx)(ls,{});};var lE=l("34f06567"),lR=n._(lE),lI=l("e21451ef"),lD=n._(lI);let lO=({onUpload:e})=>(0,a.jsxs)(lR.default.Dragger,{beforeUpload:e,showUploadList:!1,accept:".png,.jpg,.jpeg",height:200,children:[(0,a.jsx)("p",{className:"ant-upload-drag-icon",children:(0,a.jsx)(lD.default,{})}),(0,a.jsx)("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),(0,a.jsx)("p",{className:"ant-upload-hint",children:"Support for a single upload. You can also paste an image from clipboard."})]}),lB=()=>{let[e,t]=(0,s.useState)(null),[l,n]=(0,s.useState)(null),[r,a]=(0,s.useState)(null),[i,d]=(0,s.useState)(!1),o=(0,s.useRef)(0),c=(0,s.useCallback)(l=>{let r=new FileReader;return r.onload=r=>{if(e)a(l);else{var i;t(null===(i=r.target)||void 0===i?void 0:i.result),n(null);}},r.readAsDataURL(l),d(!1),o.current=0,!1;},[e]),u=(0,s.useCallback)(e=>{n(e),t(e.thumbnail);},[]),h=(0,s.useCallback)(()=>{t(null),a(null),n(null),eD.default.info("Image cleared.");},[]);return(0,s.useEffect)(()=>{let e=e=>{var t;let l=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!l)return;let n=Array.from(l).find(e=>e.type.includes("image"));if(n){let t=n.getAsFile();t&&(c(t),eD.default.success("Image pasted from clipboard!"),e.preventDefault());}};return window.addEventListener("paste",e),()=>window.removeEventListener("paste",e);},[c]),{preview:e,setPreview:t,addOnFile:r,setAddOnFile:a,dragging:i,setDragging:d,dragCounter:o,handleUpload:c,handleClear:h,loadProject:u,initialProject:l};};var lT={propertiesSider:"propertiesSider-YRVduwgD",canvasContent:"canvasContent-Lj9buPhs",toolbarSider:"toolbarSider-ECMIrGgY",editorContainer:"editorContainer-SPg3koCD"};let{Sider:lP,Content:lL}=h.default,lz=()=>{let{preview:e,dragging:t,setDragging:l,dragCounter:n,handleUpload:r,addOnFile:i,setAddOnFile:s,loadProject:o,initialProject:u}=lB(),{savedProjects:f,deleteProject:x}=tu();return(0,a.jsx)(d.PageContainer,{title:(0,a.jsxs)("span",{children:["Photo Editor ",(0,a.jsx)(g.default,{color:"cyan",children:"Beta"})]}),children:(0,a.jsx)(p.default,{setDragging:l,dragCounter:n,handleUpload:r,children:(0,a.jsxs)(c.default,{className:lT.editorContainer,bodyStyle:{padding:0,height:"100%"},children:[t&&(0,a.jsx)(y.default,{}),e?(0,a.jsx)(w.PhotoEditorProvider,{imageUrl:e,initialProject:u,addOnFile:i,setAddOnFile:s,children:(0,a.jsxs)(h.default,{style:{height:"100%"},children:[(0,a.jsx)(lP,{theme:"light",width:60,className:lT.toolbarSider,children:(0,a.jsx)(tU,{})}),(0,a.jsx)(lL,{className:lT.canvasContent,children:(0,a.jsx)(tG,{})}),(0,a.jsxs)(lP,{theme:"light",width:300,className:lT.propertiesSider,children:[(0,a.jsx)(lA,{}),(0,a.jsx)(ln,{})]})]})}):(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%",padding:"20px",overflowY:"auto"},children:[(0,a.jsx)(lO,{onUpload:r}),f.length>0&&(0,a.jsxs)("div",{style:{width:"100%",maxWidth:"800px",marginTop:"40px"},children:[(0,a.jsx)(m.default,{children:"Or Open Saved Project"}),(0,a.jsx)(e5,{projects:f,onLoad:o,onDelete:x})]})]})]})})});};},"743075ef":function(e,t,l){l.d(t,"__esModule",{value:!0}),l.e(t,{PhotoEditorProvider:function(){return o;},usePhotoEditor:function(){return c;}});var n=l("852bbaa9"),r=l("1a7c85b4"),a=l("d322be42"),i=n._(a);let s=e=>{let[t,l]=(0,i.useState)([]),[n,r]=(0,i.useState)(-1),[a,s]=(0,i.useState)(!1),d=(0,i.useCallback)(()=>{if(!e||a)return;let i=JSON.stringify(e.toJSON());if(t.length>0&&n>=0&&t[n]===i)return;let s=t.slice(0,n+1);s.push(i),s.length>50&&s.shift(),l(s),r(s.length-1);},[e,t,n,a]);return(0,i.useEffect)(()=>{if(!e)return;let t=()=>{d();};return e.on("object:modified",t),e.on("object:added",t),e.on("object:removed",t),e.on("path:created",t),()=>{e.off("object:modified",t),e.off("object:added",t),e.off("object:removed",t),e.off("path:created",t);};},[e,d]),{saveState:d,undo:(0,i.useCallback)(()=>{if(!e||n<=0||a)return;s(!0);let l=n-1,i=t[l];e.loadFromJSON(JSON.parse(i)).then(()=>{e.renderAll(),r(l),s(!1);});},[e,t,n,a]),redo:(0,i.useCallback)(()=>{if(!e||n>=t.length-1||a)return;s(!0);let l=n+1,i=t[l];e.loadFromJSON(JSON.parse(i)).then(()=>{e.renderAll(),r(l),s(!1);});},[e,t,n,a]),canUndo:n>0,canRedo:n<t.length-1};},d=(0,i.createContext)(void 0),o=({children:e,imageUrl:t,initialProject:l,addOnFile:n,setAddOnFile:a})=>{let[o,c]=(0,i.useState)(null),[u,h]=(0,i.useState)("select"),[f,g]=(0,i.useState)(null),[x,m]=(0,i.useState)(null),[v,p]=(0,i.useState)(5),[j,y]=(0,i.useState)("#000000"),[w,b]=(0,i.useState)(1),C=s(o);return(0,r.jsx)(d.Provider,{value:{canvas:o,setCanvas:c,activeTool:u,setActiveTool:h,selectedObject:f,setSelectedObject:g,history:C,clipboard:x,setClipboard:m,imageUrl:t,initialProject:l,addOnFile:n,setAddOnFile:a,brushSize:v,setBrushSize:p,brushColor:j,setBrushColor:y,brushOpacity:w,setBrushOpacity:b},children:e});},c=()=>{let e=(0,i.useContext)(d);if(!e)throw Error("usePhotoEditor must be used within a PhotoEditorProvider");return e;};}}]);
//# sourceMappingURL=ad692153-async.14f05ca7.js.map