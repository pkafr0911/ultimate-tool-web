(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]||[]).push([["ad692153"],{"183d4b64":function(t,e,i){i.d(e,"__esModule",{value:!0}),i.e(e,{default:function(){return rl;}});var r=i("777fffbe"),s=i("852bbaa9"),n=i("1a7c85b4"),a=i("d322be42"),o=s._(a),l=i("28c7d19c"),h=i("e9bcd22d"),c=r._(h),d=i("e23084de"),u=r._(d),g=i("1353d6cc"),f=r._(g),p=i("13dfe186"),m=r._(p),v=i("85d53cee"),x=r._(v),y=i("743075ef"),b=i("b091b25f"),w=r._(b),C=i("764a8673"),_=r._(C),S=i("ea21718c"),j=r._(S),T=i("4e1dc2f8"),k=i("c9d8dc0b"),O=r._(k);let M="projects",D=()=>new Promise((t,e)=>{let i=indexedDB.open("PhotoEditorDB",1);i.onerror=()=>{e("Error opening database");},i.onsuccess=e=>{t(e.target.result);},i.onupgradeneeded=t=>{let e=t.target.result;e.objectStoreNames.contains(M)||e.createObjectStore(M,{keyPath:"id"});};}),E=async t=>{let e=await D();return new Promise((i,r)=>{let s=e.transaction([M],"readwrite").objectStore(M).put(t);s.onsuccess=()=>i(),s.onerror=()=>r("Error saving project");});},A=async()=>{let t=await D();return new Promise((e,i)=>{let r=t.transaction([M],"readonly").objectStore(M).getAll();r.onsuccess=()=>{let t=r.result;t.sort((t,e)=>e.updatedAt-t.updatedAt),e(t);},r.onerror=()=>i("Error fetching projects");});},P=async t=>{let e=await D();return new Promise((i,r)=>{let s=e.transaction([M],"readwrite").objectStore(M).delete(t);s.onsuccess=()=>i(),s.onerror=()=>r("Error deleting project");});},F=()=>{let[t,e]=(0,o.useState)([]),[i,r]=(0,o.useState)(null),s=(0,o.useCallback)(()=>{A().then(e).catch(t=>console.error("Failed to load projects from DB",t));},[]);(0,o.useEffect)(()=>{s();},[s]);let n=(0,o.useCallback)(async(t,s)=>{if(!t)return;let n={id:(null==i?void 0:i.id)||Date.now().toString(),name:(null==i?void 0:i.name)||`Project ${new Date().toLocaleString()}`,thumbnail:t,json:s,createdAt:(null==i?void 0:i.createdAt)||Date.now(),updatedAt:Date.now()};try{await E(n),e(t=>(t.some(t=>t.id===n.id)?t.map(t=>t.id===n.id?n:t):[n,...t]).sort((t,e)=>e.updatedAt-t.updatedAt)),r(n),O.default.success("Project saved successfully!");}catch(t){console.error(t),O.default.error("Failed to save project");}},[i]);return{savedProjects:t,currentProject:i,loadProjects:s,saveProject:n,deleteProject:(0,o.useCallback)(async t=>{try{await P(t),e(e=>e.filter(e=>e.id!==t)),r(e=>e&&e.id===t?null:e),O.default.success("Project deleted");}catch(t){console.error(t),O.default.error("Failed to delete project");}},[]),loadProjectIntoEditor:(0,o.useCallback)(t=>{r(t);},[]),clearCurrentProject:(0,o.useCallback)(()=>{r(null);},[]),setCurrentProject:r};};var R=i("dc6d1542"),L=i("b2a1469e"),I=r._(L),B=i("d4a32650"),W=r._(B),X=i("f2806aec"),Y=r._(X),z=i("918eb6e0"),V=r._(z);let N=({name:t,styles:e})=>(0,n.jsx)("svg",{className:"icon","aria-hidden":"true",style:e,children:(0,n.jsx)("use",{xlinkHref:`#${t}`})}),H=({activeTool:t,setActiveTool:e})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(W.default,{title:"Hand (H)",children:(0,n.jsx)(I.default,{type:"hand"===t?"primary":"default",icon:(0,n.jsx)(N,{name:"iconhand",styles:{height:16,width:16}}),onClick:()=>e("hand")})}),(0,n.jsx)(W.default,{title:"Select (V)",children:(0,n.jsx)(I.default,{type:"select"===t?"primary":"default",icon:(0,n.jsx)(Y.default,{}),onClick:()=>e("select")})}),(0,n.jsx)(W.default,{title:"Brush (B)",children:(0,n.jsx)(I.default,{type:"brush"===t?"primary":"default",icon:(0,n.jsx)(V.default,{}),onClick:()=>e("brush")})})]});var G=i("d70e0f0a"),U=r._(G),$=i("1c8d1214"),q=r._($),K=i("81108cbb"),J=r._(K),Z=i("d2d0b3b6"),Q=r._(Z),tt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},te=i("85c4e0d9"),ti=r._(te),tr=o.forwardRef(function(t,e){return o.createElement(ti.default,(0,Q.default)((0,Q.default)({},t),{},{ref:e,icon:tt}));}),ts={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zm52 132H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200zM424 712H296V584c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v128H104c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h128v128c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V776h128c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"appstore-add",theme:"outlined"},tn=o.forwardRef(function(t,e){return o.createElement(ti.default,(0,Q.default)((0,Q.default)({},t),{},{ref:e,icon:ts}));}),ta=i("0a08762b"),to=r._(ta);let tl=({canvas:t,activeTool:e,setActiveTool:i,saveState:r})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(U.default,{overlay:(0,n.jsxs)(q.default,{children:[(0,n.jsx)(q.default.Item,{icon:(0,n.jsx)(J.default,{}),onClick:()=>{if(!t)return;let e=new T.Rect({left:100,top:100,fill:"#ff0000",width:100,height:100});t.add(e),t.setActiveObject(e),r();},children:"Rectangle (R)"},"rect"),(0,n.jsx)(q.default.Item,{icon:(0,n.jsx)(tr,{}),onClick:()=>{if(!t)return;let e=new T.Circle({left:100,top:100,fill:"#00ff00",radius:50});t.add(e),t.setActiveObject(e),r();},children:"Circle"},"circle"),(0,n.jsx)(q.default.Item,{icon:(0,n.jsx)(J.default,{}),onClick:()=>{if(!t)return;let e=new T.Triangle({left:100,top:100,fill:"#0000ff",width:100,height:100});t.add(e),t.setActiveObject(e),r();},children:"Triangle"},"triangle"),(0,n.jsx)(q.default.Item,{icon:(0,n.jsx)(J.default,{}),onClick:()=>{if(!t)return;let e=new T.Polygon([{x:200,y:100},{x:250,y:125},{x:250,y:175},{x:200,y:200},{x:150,y:175},{x:150,y:125}],{left:100,top:100,fill:"#ffff00",objectCaching:!1});t.add(e),t.setActiveObject(e),r();},children:"Polygon"},"polygon")]}),trigger:["click"],children:(0,n.jsx)(W.default,{title:"Shapes",children:(0,n.jsx)(I.default,{icon:(0,n.jsx)(tn,{})})})}),(0,n.jsx)(W.default,{title:"Text (T)",children:(0,n.jsx)(I.default,{type:"text"===e?"primary":"default",icon:(0,n.jsx)(to.default,{}),onClick:()=>i("text")})})]});var th=i("c63de1ad"),tc=r._(th),td=i("15cf394c"),tu=r._(td),tg={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656zM484 366h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zM302 548h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm364 0h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-182 0h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm0 182h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8z"}}]},name:"border-outer",theme:"outlined"},tf=o.forwardRef(function(t,e){return o.createElement(ti.default,(0,Q.default)((0,Q.default)({},t),{},{ref:e,icon:tg}));}),tp=i("dfa4ac87"),tm=r._(tp),tv=i("8e6ac0a6"),tx=r._(tv),ty=i("7b738819"),tb=r._(ty),tw=i("3eb6f542"),tC=r._(tw),t_=i("97125d22"),tS=r._(t_),tj=i("34f8e1c9"),tT=r._(tj),tk=i("076b2e3c"),tO=r._(tk);let tM=(t,e,i)=>{if(0!==e.length){if(t.save(),t.globalAlpha=i.opacity*i.flow,"soft"===i.type?(t.shadowColor=i.color,t.shadowBlur=.5*i.lineWidth,t.lineWidth=.5*i.lineWidth):(t.shadowBlur=0,t.lineWidth=i.lineWidth),t.strokeStyle=i.color,t.fillStyle=i.color,t.lineCap="round",t.lineJoin="round",t.beginPath(),1===e.length)t.arc(e[0].x,e[0].y,t.lineWidth/2,0,2*Math.PI),t.fill();else{t.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.stroke();}t.restore();}},tD=(t,e,i,r,s,n=1)=>{t.save(),t.strokeStyle=s,t.lineWidth=2/n,t.beginPath(),t.arc(e,i,r/2,0,2*Math.PI),t.stroke(),t.restore();},tE=(t,e,i=1,r={x:0,y:0})=>{if(!e.current)return null;let s=e.current.getBoundingClientRect();return{x:(t.clientX-s.left-r.x)/i,y:(t.clientY-s.top-r.y)/i};},tA=(t,e,i,r=!1,s=0)=>{let n=e.replace("#",""),a=parseInt(n.substring(0,2),16),o=parseInt(n.substring(2,4),16),l=parseInt(n.substring(4,6),16),h=new Uint8Array(t.length/4),c=Math.sqrt(195075),d=i/100,u=s/100;for(let e=0;e<t.length;e+=4){let i;let n=Math.sqrt(Math.pow(t[e]-a,2)+Math.pow(t[e+1]-o,2)+Math.pow(t[e+2]-l,2))/c;if(0===s)i=n<=d?0:1;else{let t=n-d;i=t<-u?0:t>u?1:(t+u)/(2*u);}r&&(i=1-i),h[e/4]=Math.round(255*i);}return h;},tP=(t,e,i)=>{if(!(e instanceof T.FabricImage))return;let r=e.getElement(),s=r.width,n=r.height,a=document.createElement("canvas");a.width=s,a.height=n;let o=a.getContext("2d");o.drawImage(r,0,0,s,n);let l=o.getImageData(0,0,s,n),h=l.data;i.getContext("2d");let c=document.createElement("canvas");c.width=s,c.height=n;let d=c.getContext("2d");d.drawImage(i,0,0,s,n);let u=d.getImageData(0,0,s,n).data;for(let t=0;t<h.length;t+=4){let e=u[t];h[t+3]=e;}o.putImageData(l,0,0);let g=new T.FabricImage(a);g.set({left:e.left,top:e.top,scaleX:e.scaleX,scaleY:e.scaleY,angle:e.angle,skewX:e.skewX,skewY:e.skewY,flipX:e.flipX,flipY:e.flipY,originX:e.originX,originY:e.originY,opacity:e.opacity});let f=t.getObjects().indexOf(e);t.remove(e),t.add(g),t.moveObjectTo(g,f),t.setActiveObject(g),t.requestRenderAll();},tF=async(t,e,i="overlay")=>{let r=new T.FabricImage(e);"flatten"===i?(t.clear(),r.set({left:0,top:0,originX:"left",originY:"top",selectable:!0,evented:!0})):r.set({left:0,top:0,originX:"left",originY:"top",selectable:!1,evented:!1,opacity:1}),t.add(r),t.requestRenderAll();},tR=({open:t,onCancel:e,onApply:i,selectedColor:r,sourceCanvas:s})=>{let[a,l]=(0,o.useState)(30),[h,c]=(0,o.useState)("normal"),[d,u]=(0,o.useState)(!1),[g,f]=(0,o.useState)(0),[p,m]=(0,o.useState)(r||"#000000"),[v,x]=(0,o.useState)(!1);(0,o.useEffect)(()=>{r&&m(r);},[r]),(0,o.useEffect)(()=>{let t=t=>{"Alt"===t.key&&x(!0);},e=t=>{"Alt"===t.key&&x(!1);};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e);};},[]);let[y,b]=(0,o.useState)("remove"),[w,C]=(0,o.useState)(20),[_,S]=(0,o.useState)(1),[T,k]=(0,o.useState)("hard"),[O,M]=(0,o.useState)(!1),[D,E]=(0,o.useState)(null),[A,P]=(0,o.useState)(null),[F,R]=(0,o.useState)({scale:1,x:0,y:0}),L=(0,o.useRef)(null),B=(0,o.useRef)(null),W=(0,o.useRef)(null),X=(0,o.useRef)(null),Y=(0,o.useRef)([]),z=(0,o.useRef)(null),[V,N]=(0,o.useState)([]),[H,G]=(0,o.useState)(-1);(0,o.useEffect)(()=>{if(t&&s&&B.current&&W.current&&X.current&&L.current){let t=s.width,e=s.height,{clientWidth:i,clientHeight:r}=L.current,n=Math.min(i/t,r/e),a=t*n,o=e*n;R({scale:n,x:(i-a)/2,y:(r-o)/2}),B.current.width=t,B.current.height=e,W.current.width=t,W.current.height=e,X.current.width=i,X.current.height=r,B.current.getContext("2d").drawImage(s,0,0);let l=W.current.getContext("2d");l.fillStyle="white",l.fillRect(0,0,t,e),U();}},[t,s]);let U=()=>{if(!W.current)return;let t=W.current.getContext("2d").getImageData(0,0,W.current.width,W.current.height),e=V.slice(0,H+1);e.push(t),N(e),G(e.length-1);},$=()=>{if(!s||!B.current||!W.current)return;let t=s.width,e=s.height,i=B.current.getContext("2d"),r=W.current.getContext("2d");i.clearRect(0,0,t,e),i.drawImage(s,0,0);let n=i.getImageData(0,0,t,e),o=tA(n.data,p,a,d,g),l=r.getImageData(0,0,t,e),c=i.createImageData(t,e);for(let i=0;i<t*e;i++){let t=n.data[4*i],e=n.data[4*i+1],r=n.data[4*i+2],s=n.data[4*i+3],a=o[i]/255*s*(l.data[4*i]/255);c.data[4*i]=t,c.data[4*i+1]=e,c.data[4*i+2]=r,c.data[4*i+3]=a;}if("mask"===h)for(let i=0;i<t*e;i++){let t=c.data[4*i+3];c.data[4*i]=t,c.data[4*i+1]=t,c.data[4*i+2]=t,c.data[4*i+3]=255;}i.putImageData(c,0,0);};(0,o.useEffect)(()=>{$();},[a,d,g,p,h,H]);let q=t=>{if(!s||!X.current)return;let e=tE(t,X,F.scale,{x:F.x,y:F.y});if(e){let t=s.getContext("2d");if(!t)return;let i=Math.max(0,Math.min(e.x,s.width-1)),r=Math.max(0,Math.min(e.y,s.height-1)),n=t.getImageData(i,r,1,1).data;m("#"+[n[0],n[1],n[2]].map(t=>t.toString(16).padStart(2,"0")).join(""));}},K=()=>{O&&(M(!1),Y.current=[],z.current=null,U(),$());},J=t=>{W.current&&(tM(W.current.getContext("2d"),t,{color:"remove"===y?"#000000":"#ffffff",lineWidth:w,opacity:_,flow:1,type:T}),$());};return(0,o.useEffect)(()=>{if(!X.current||!D)return;let t=X.current.getContext("2d");t.clearRect(0,0,X.current.width,X.current.height);let e=D.x*F.scale+F.x,i=D.y*F.scale+F.y,r=w*F.scale;if(tD(t,e,i,r,"#fff"),tD(t,e,i,r,"#000"),v&&A){let r=Math.min(X.current.width-9-4,Math.max(13,e+12)),s=Math.min(X.current.height-9-4,Math.max(13,i+12));t.beginPath(),t.arc(r,s,11,0,2*Math.PI),t.fillStyle="#00000088",t.fill(),t.beginPath(),t.arc(r,s,9,0,2*Math.PI),t.fillStyle=A,t.fill(),t.font="12px sans-serif",t.fillStyle="#fff",t.textAlign="center",t.fillText(A.toUpperCase(),r,s+9+14);}},[D,w,F,v,A]),(0,n.jsx)(tm.default,{title:"Mask",open:t,onCancel:e,onOk:()=>{if(!s||!B.current||!W.current)return;let t=s.width,e=s.height,r=document.createElement("canvas");r.width=t,r.height=e;let n=r.getContext("2d");n.drawImage(s,0,0);let o=n.getImageData(0,0,t,e),l=tA(o.data,p,a,d,g),h=W.current.getContext("2d").getImageData(0,0,t,e),c=n.createImageData(t,e);for(let i=0;i<t*e;i++){let t=o.data[4*i+3],e=Math.round(l[i]/255*t*(h.data[4*i]/255));c.data[4*i]=e,c.data[4*i+1]=e,c.data[4*i+2]=e,c.data[4*i+3]=255;}n.putImageData(c,0,0),i(r);},width:1e3,style:{top:20},maskClosable:!1,children:(0,n.jsxs)("div",{style:{display:"flex",gap:16},children:[(0,n.jsx)("div",{style:{width:300},children:(0,n.jsxs)(j.default,{direction:"vertical",style:{width:"100%"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{children:"Target Color:"}),(0,n.jsx)(tS.default,{value:p,onChange:t=>m(t.toHexString()),showText:!0}),(0,n.jsx)("div",{style:{fontSize:12,color:"#999",marginTop:4},children:"Hold Alt + Click on image to pick color"})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("span",{children:["Tolerance: ",a,"%"]}),(0,n.jsx)(tx.default,{value:a,onChange:l})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("span",{children:["Feather: ",g,"%"]}),(0,n.jsx)(tx.default,{value:g,onChange:f})]}),(0,n.jsx)("div",{children:(0,n.jsxs)(j.default,{children:[(0,n.jsx)("span",{children:"Invert:"}),(0,n.jsx)(I.default,{onClick:()=>u(!d),type:d?"primary":"default",children:d?"Yes":"No"})]})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{children:"Preview Mode:"}),(0,n.jsxs)(tb.default.Group,{value:h,onChange:t=>c(t.target.value),children:[(0,n.jsx)(tb.default.Button,{value:"normal",children:"Normal"}),(0,n.jsx)(tb.default.Button,{value:"mask",children:"Mask"})]})]}),(0,n.jsxs)("div",{style:{borderTop:"1px solid #eee",paddingTop:16,marginTop:16},children:[(0,n.jsx)("h4",{children:"Manual Adjustments"}),(0,n.jsxs)(j.default,{children:[(0,n.jsx)(I.default,{type:"remove"===y?"primary":"default",onClick:()=>b("remove"),children:"Remove"}),(0,n.jsx)(I.default,{type:"keep"===y?"primary":"default",onClick:()=>b("keep"),children:"Keep"})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("span",{children:["Size: ",w]}),(0,n.jsx)(tx.default,{min:1,max:100,value:w,onChange:C})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("span",{children:["Opacity: ",_]}),(0,n.jsx)(tx.default,{min:0,max:1,step:.1,value:_,onChange:S})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{children:"Hardness:"}),(0,n.jsxs)(tb.default.Group,{value:T,onChange:t=>k(t.target.value),children:[(0,n.jsx)(tb.default.Button,{value:"hard",children:"Hard"}),(0,n.jsx)(tb.default.Button,{value:"soft",children:"Soft"})]})]})]}),(0,n.jsxs)(j.default,{children:[(0,n.jsx)(I.default,{icon:(0,n.jsx)(tT.default,{}),onClick:()=>{if(H>0){let t=H-1,e=V[t];W.current.getContext("2d").putImageData(e,0,0),G(t),$();}},disabled:H<=0}),(0,n.jsx)(I.default,{icon:(0,n.jsx)(tO.default,{}),onClick:()=>{if(H<V.length-1){let t=H+1,e=V[t];W.current.getContext("2d").putImageData(e,0,0),G(t),$();}},disabled:H>=V.length-1})]})]})}),(0,n.jsxs)("div",{ref:L,style:{flex:1,position:"relative",border:"1px solid #ccc",height:500,overflow:"hidden",background:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==)"},children:[(0,n.jsx)("canvas",{ref:B,style:{position:"absolute",top:F.y,left:F.x,width:F.scale*((null==s?void 0:s.width)||0),height:F.scale*((null==s?void 0:s.height)||0)}}),(0,n.jsx)("canvas",{ref:X,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",cursor:v?"crosshair":"none"},onMouseDown:t=>{if(v){q(t);return;}M(!0);let e=tE(t,X,F.scale,{x:F.x,y:F.y});e&&(Y.current=[e],z.current=e,J([e]));},onMouseMove:t=>{let e=tE(t,X,F.scale,{x:F.x,y:F.y});if(E(e),v&&e&&s)try{let t=s.getContext("2d");if(t){let i=Math.max(0,Math.min(e.x,s.width-1)),r=Math.max(0,Math.min(e.y,s.height-1)),n=t.getImageData(i,r,1,1).data,a="#"+[n[0],n[1],n[2]].map(t=>t.toString(16).padStart(2,"0")).join("");P(a);}}catch(t){P(null);}else P(null);!v&&O&&e&&z.current&&(Y.current.push(e),J([z.current,e]),z.current=e);},onMouseUp:K,onMouseLeave:K}),(0,n.jsx)("canvas",{ref:W,style:{display:"none"}})]})]})});};var tL=i("2aa4d12e"),tI=r._(tL),tB=i("9f0970b1"),tW=r._(tB);let{Option:tX}=tC.default,tY=({visible:t,onCancel:e,canvas:i,history:r})=>{let s=(0,o.useRef)(null),[a,l]=(0,o.useState)({x:0,y:0,width:0,height:0}),[h,c]=(0,o.useState)(!1),[d,u]=(0,o.useState)({x:0,y:0}),[g,f]=(0,o.useState)(null),[p,m]=(0,o.useState)(null),[v,x]=(0,o.useState)(!1);(0,o.useEffect)(()=>{t&&i&&(l({x:0,y:0,width:i.getWidth(),height:i.getHeight()}),m(null),x(!1));},[t,i]),(0,o.useEffect)(()=>{if(!t||!i||!s.current)return;let e=s.current,r=e.getContext("2d");if(!r)return;let n=i.getWidth(),o=i.getHeight();e.width=n,e.height=o;let l=i.lowerCanvasEl;r.drawImage(l,0,0),r.fillStyle="rgba(0, 0, 0, 0.5)",r.fillRect(0,0,n,o),r.clearRect(a.x,a.y,a.width,a.height),r.drawImage(l,a.x,a.y,a.width,a.height,a.x,a.y,a.width,a.height),r.strokeStyle="#1890ff",r.lineWidth=2,r.strokeRect(a.x,a.y,a.width,a.height),r.fillStyle="#1890ff",[{x:a.x,y:a.y},{x:a.x+a.width,y:a.y},{x:a.x,y:a.y+a.height},{x:a.x+a.width,y:a.y+a.height},{x:a.x+a.width/2,y:a.y},{x:a.x+a.width/2,y:a.y+a.height},{x:a.x,y:a.y+a.height/2},{x:a.x+a.width,y:a.y+a.height/2}].forEach(t=>{r.fillRect(t.x-4,t.y-4,8,8);});},[t,i,a]);let y=(t,e)=>{let{x:i,y:r,width:s,height:n}=a;return 10>Math.abs(t-i)&&10>Math.abs(e-r)?"tl":10>Math.abs(t-(i+s))&&10>Math.abs(e-r)?"tr":10>Math.abs(t-i)&&10>Math.abs(e-(r+n))?"bl":10>Math.abs(t-(i+s))&&10>Math.abs(e-(r+n))?"br":10>Math.abs(t-(i+s/2))&&10>Math.abs(e-r)?"t":10>Math.abs(t-(i+s/2))&&10>Math.abs(e-(r+n))?"b":10>Math.abs(t-i)&&10>Math.abs(e-(r+n/2))?"l":10>Math.abs(t-(i+s))&&10>Math.abs(e-(r+n/2))?"r":null;},b=(t,e)=>t>=a.x&&t<=a.x+a.width&&e>=a.y&&e<=a.y+a.height,w=()=>{c(!1),f(null);};return(0,n.jsxs)(tm.default,{title:"Crop Canvas",open:t,onCancel:e,width:Math.min((null==i?void 0:i.getWidth())||800,1200)+100,footer:[(0,n.jsx)(I.default,{onClick:e,children:"Cancel"},"cancel"),(0,n.jsx)(I.default,{type:"primary",onClick:()=>{if(!i){R.photoEditorMessages.genericError("Canvas not available");return;}if(a.width<1||a.height<1){R.photoEditorMessages.genericError("Crop area is too small");return;}r.saveState();try{let t=i.toJSON(),s=t.objects||[],n=i.backgroundColor||"#ffffff";i.clear(),i.setDimensions({width:a.width,height:a.height}),i.set("backgroundColor",n),s.forEach(t=>{void 0!==t.left&&(t.left-=a.x),void 0!==t.top&&(t.top-=a.y),t.objects&&Array.isArray(t.objects)&&t.objects.forEach(t=>{void 0!==t.left&&(t.left-=a.x),void 0!==t.top&&(t.top-=a.y);});}),i.loadFromJSON({version:t.version||"5.3.0",objects:s},()=>{i.renderAll(),r.saveState(),O.default.success("Canvas cropped successfully"),e();});}catch(t){console.error("Crop error:",t),R.photoEditorMessages.operationFailed("Crop");}},children:"Confirm Crop"},"confirm")],children:[(0,n.jsx)("div",{style:{marginBottom:16},children:(0,n.jsxs)(j.default,{direction:"vertical",style:{width:"100%"},children:[(0,n.jsxs)(j.default,{children:[(0,n.jsx)("span",{children:"Aspect Ratio:"}),(0,n.jsxs)(tC.default,{style:{width:120},value:v?p===16/9?"16:9":p===4/3?"4:3":1.5===p?"3:2":1===p?"1:1":p===9/16?"9:16":p===3/4?"3:4":p===2/3?"2:3":"free":"free",onChange:t=>{if("free"===t)m(null),x(!1);else{let e;switch(t){case"16:9":e=16/9;break;case"4:3":e=4/3;break;case"3:2":e=1.5;break;case"1:1":default:e=1;break;case"9:16":e=9/16;break;case"3:4":e=3/4;break;case"2:3":e=2/3;}m(e),x(!0);let r=a.width/e;if(r<=((null==i?void 0:i.getHeight())||0))l({...a,height:r});else{let t=a.height*e;l({...a,width:t});}}},children:[(0,n.jsx)(tX,{value:"free",children:"Free"}),(0,n.jsx)(tX,{value:"16:9",children:"16:9 (Landscape)"}),(0,n.jsx)(tX,{value:"4:3",children:"4:3 (Landscape)"}),(0,n.jsx)(tX,{value:"3:2",children:"3:2 (Landscape)"}),(0,n.jsx)(tX,{value:"1:1",children:"1:1 (Square)"}),(0,n.jsx)(tX,{value:"9:16",children:"9:16 (Portrait)"}),(0,n.jsx)(tX,{value:"3:4",children:"3:4 (Portrait)"}),(0,n.jsx)(tX,{value:"2:3",children:"2:3 (Portrait)"})]}),(0,n.jsx)(tW.default,{checked:v,onChange:t=>x(t.target.checked),children:"Lock"})]}),(0,n.jsxs)(j.default,{children:[(0,n.jsx)("span",{children:"X:"}),(0,n.jsx)(tI.default,{min:0,max:(null==i?void 0:i.getWidth())||0,value:Math.round(a.x),onChange:t=>l({...a,x:t||0})}),(0,n.jsx)("span",{children:"Y:"}),(0,n.jsx)(tI.default,{min:0,max:(null==i?void 0:i.getHeight())||0,value:Math.round(a.y),onChange:t=>l({...a,y:t||0})}),(0,n.jsx)("span",{children:"Width:"}),(0,n.jsx)(tI.default,{min:1,max:(null==i?void 0:i.getWidth())||0,value:Math.round(a.width),onChange:t=>{let e=t||1;v&&p?l({...a,width:e,height:e/p}):l({...a,width:e});}}),(0,n.jsx)("span",{children:"Height:"}),(0,n.jsx)(tI.default,{min:1,max:(null==i?void 0:i.getHeight())||0,value:Math.round(a.height),onChange:t=>{let e=t||1;v&&p?l({...a,width:e*p,height:e}):l({...a,height:e});}})]})]})}),(0,n.jsx)("div",{style:{overflow:"auto",maxHeight:"600px",border:"1px solid #d9d9d9",borderRadius:"4px"},children:(0,n.jsx)("canvas",{ref:s,style:{display:"block",cursor:h?"move":"crosshair"},onMouseDown:t=>{var e;let i=null===(e=s.current)||void 0===e?void 0:e.getBoundingClientRect();if(!i)return;let r=t.clientX-i.left,n=t.clientY-i.top,a=y(r,n);a?(f(a),u({x:r,y:n})):b(r,n)&&(c(!0),u({x:r,y:n}));},onMouseMove:t=>{var e;if(!i)return;let r=null===(e=s.current)||void 0===e?void 0:e.getBoundingClientRect();if(!r)return;let n=t.clientX-r.left,o=t.clientY-r.top;if(g){let t=n-d.x,e=o-d.y,r={...a};switch(g){case"tl":r.x+=t,r.y+=e,r.width-=t,r.height-=e;break;case"tr":r.y+=e,r.width+=t,r.height-=e;break;case"bl":r.x+=t,r.width-=t,r.height+=e;break;case"br":r.width+=t,r.height+=e;break;case"t":r.y+=e,r.height-=e;break;case"b":r.height+=e;break;case"l":r.x+=t,r.width-=t;break;case"r":r.width+=t;}v&&p&&(g.includes("r")||g.includes("l")?r.height=r.width/p:g.includes("t")||g.includes("b")?r.width=r.height*p:r.height=r.width/p),r.width>10&&r.height>10&&(r.x=Math.max(0,Math.min(r.x,i.getWidth()-r.width)),r.y=Math.max(0,Math.min(r.y,i.getHeight()-r.height)),r.x+r.width>i.getWidth()&&(r.width=i.getWidth()-r.x,v&&p&&(r.height=r.width/p)),r.y+r.height>i.getHeight()&&(r.height=i.getHeight()-r.y,v&&p&&(r.width=r.height*p)),l(r),u({x:n,y:o}));}else if(h){let t=n-d.x,e=o-d.y,r=a.x+t,s=a.y+e;r=Math.max(0,Math.min(r,i.getWidth()-a.width)),s=Math.max(0,Math.min(s,i.getHeight()-a.height)),l({...a,x:r,y:s}),u({x:n,y:o});}},onMouseUp:w,onMouseLeave:w})}),(0,n.jsx)("div",{style:{marginTop:12,fontSize:12,color:"#666"},children:'\u{1F4A1} Drag to move crop area, drag handles to resize, or use inputs above. Select an aspect ratio preset or lock custom ratio. Click "Confirm Crop" to apply changes to all layers.'})]});};var tz=i("6effc0fd"),tV=r._(tz),tN=i("84cd549f"),tH=r._(tN),tG=i("f6c9c5f6"),tU=r._(tG),t$=i("84de98ed"),tq=r._(t$),tK=i("cd7c2b80");"undefined"==typeof window||window.cv||(window.cv=tq.default);let tJ=!1,tZ=()=>new Promise((t,e)=>{tq.default.getBuildInformation?(tJ=!0,t()):(tq.default.onRuntimeInitialized=()=>{tJ=!0,t();},setTimeout(()=>{tJ||(console.warn("OpenCV initialization timed out, using WebWorker fallback"),t());},5e3));}),tQ=async(t,e,i=15,r=7)=>{if(!tJ||!tq.default||!tq.default.imread)return console.log("Using WebWorker for blur processing"),tK.imageProcessingService.applyBlurWithMask(t,e,i,r);if(t.width!==e.width||t.height!==e.height){let i=document.createElement("canvas");i.width=t.width,i.height=t.height;let r=i.getContext("2d");r&&r.drawImage(e,0,0,t.width,t.height),e=i;}let s=tq.default.imread(t),n=tq.default.imread(e),a=new tq.default.Mat;if(tq.default.cvtColor(n,a,tq.default.COLOR_RGBA2GRAY),tq.default.threshold(a,a,10,255,tq.default.THRESH_BINARY),r&&r>1){let t=Math.round(r);t%2==0&&(t+=1);let e=new tq.default.Size(t,t);tq.default.GaussianBlur(a,a,e,0);}let o=Math.max(1,Math.floor(i));o%2==0&&(o+=1);let l=new tq.default.Size(o,o),h=new tq.default.Mat;tq.default.GaussianBlur(s,h,l,0);let c=s.clone();h.copyTo(c,a);let d=document.createElement("canvas");return d.width=c.cols,d.height=c.rows,tq.default.imshow(d,c),s.delete(),n.delete(),a.delete(),h.delete(),c.delete(),d;},{Text:t0}=tV.default,t1=({visible:t,onCancel:e,canvas:i,history:r})=>{let s=(0,o.useRef)(null),a=(0,o.useRef)(null),l=(0,o.useRef)(null),h=(0,o.useRef)(null),[c,d]=(0,o.useState)(null),[u,g]=(0,o.useState)(30),[f,p]=(0,o.useState)(15),[m,v]=(0,o.useState)(5),[x,y]=(0,o.useState)(!1),[b,w]=(0,o.useState)("overlay"),C=(0,o.useRef)(f),_=(0,o.useRef)(m);(0,o.useEffect)(()=>{C.current=f;},[f]),(0,o.useEffect)(()=>{_.current=m;},[m]),(0,o.useEffect)(()=>{t&&tZ().catch(t=>{R.photoEditorMessages.genericError("Failed to load OpenCV: "+t.message);});},[t]),(0,o.useEffect)(()=>{if(t&&i&&a.current&&l.current&&s.current){let t=i.getWidth(),e=i.getHeight(),r=l.current.getContext("2d");if(r){l.current.width=t,l.current.height=e;let s=i.toDataURL({format:"png",multiplier:1}),n=new Image;n.onload=()=>{r.drawImage(n,0,0,t,e);},n.src=s;}c&&c.dispose();let s=new T.Canvas(a.current,{isDrawingMode:!0,width:t,height:e,backgroundColor:"rgba(0,0,0,0)",selection:!1});s.on("mouse:move",t=>{if(h.current){var e;let i=s.getScenePoint(t.e),r=(null===(e=s.freeDrawingBrush)||void 0===e?void 0:e.width)||30;h.current.style.display="block",h.current.style.transform=`translate(${i.x-r/2}px, ${i.y-r/2}px)`,h.current.style.width=`${r}px`,h.current.style.height=`${r}px`;}}),s.on("mouse:out",()=>{h.current&&(h.current.style.display="none");});let n=new T.PencilBrush(s);return n.color="rgba(255, 0, 0, 0.5)",n.width=u,s.freeDrawingBrush=n,s.on("path:created",async t=>{try{y(!0);let e=t.path,i=document.createElement("canvas");i.width=s.getWidth(),i.height=s.getHeight();let r=i.getContext("2d");r.fillStyle="black",r.fillRect(0,0,i.width,i.height);let n=s.toDataURL({format:"png",multiplier:1}),a=new Image;a.src=n,await new Promise(t=>{a.onload=()=>t();}),r.drawImage(a,0,0);let o=r.getImageData(0,0,i.width,i.height),h=o.data;for(let t=0;t<h.length;t+=4)h[t]>20?(h[t]=255,h[t+1]=255,h[t+2]=255):(h[t]=0,h[t+1]=0,h[t+2]=0),h[t+3]=255;if(r.putImageData(o,0,0),l.current){let t=await tQ(l.current,i,C.current,_.current),e=l.current.getContext("2d");e&&e.drawImage(t,0,0);}s.remove(e),s.requestRenderAll();}catch(t){console.error("Auto blur failed",t);}finally{y(!1);}}),d(s),()=>{s.dispose();};}},[t,i]),(0,o.useEffect)(()=>{c&&(c.freeDrawingBrush.width=u);},[u,c]);let S=async()=>{if(!c)throw Error("No mask canvas");let t=document.createElement("canvas");t.width=c.getWidth(),t.height=c.getHeight();let e=t.getContext("2d");e.fillStyle="black",e.fillRect(0,0,t.width,t.height);let i=c.toDataURL({format:"png",multiplier:1});return new Promise(r=>{let s=new Image;s.onload=()=>{e.drawImage(s,0,0);let i=e.getImageData(0,0,t.width,t.height),n=i.data;for(let t=0;t<n.length;t+=4)n[t]>20?(n[t]=255,n[t+1]=255,n[t+2]=255):(n[t]=0,n[t+1]=0,n[t+2]=0),n[t+3]=255;e.putImageData(i,0,0),r(t);},s.src=i;});},k=async()=>{if(i&&l.current){y(!0);try{let t=await S(),e=l.current,i=await tQ(e,t,f,m),r=l.current.getContext("2d");r&&r.drawImage(i,0,0),R.photoEditorMessages.filterApplied("Blur preview");}catch(t){console.error(t),R.photoEditorMessages.filterFailed("Blur preview");}finally{y(!1);}}},O=async()=>{if(i&&l.current){y(!0);try{r.saveState(),await tF(i,l.current,b),r.saveState(),R.photoEditorMessages.filterApplied("Blur"),e();}catch(t){console.error(t),R.photoEditorMessages.filterFailed("Blur");}finally{y(!1);}}};return(0,n.jsxs)(tm.default,{title:"Blur Brush",open:t,onCancel:e,width:1e3,footer:null,destroyOnClose:!0,children:[(0,n.jsxs)("div",{style:{display:"flex",gap:16},children:[(0,n.jsxs)("div",{ref:s,style:{position:"relative",border:"1px solid #d9d9d9",width:(null==i?void 0:i.getWidth())||800,height:(null==i?void 0:i.getHeight())||600,overflow:"hidden"},children:[(0,n.jsx)("canvas",{ref:l,style:{position:"absolute",top:0,left:0}}),(0,n.jsx)("canvas",{ref:a,style:{position:"absolute",top:0,left:0,opacity:1}}),(0,n.jsx)("div",{ref:h,style:{position:"absolute",top:0,left:0,display:"none",borderRadius:"50%",border:"2px solid rgba(255, 255, 255, 0.8)",boxShadow:"0 0 4px rgba(0,0,0,0.8)",pointerEvents:"none",zIndex:1e3}})]}),(0,n.jsxs)("div",{style:{width:300,display:"flex",flexDirection:"column",gap:16},children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)(t0,{strong:!0,children:["Brush Size: ",u,"px"]}),(0,n.jsx)(tx.default,{min:5,max:200,value:u,onChange:g})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)(t0,{strong:!0,children:["Blur Amount: ",f]}),(0,n.jsx)(tx.default,{min:1,max:100,value:f,onChange:p})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)(t0,{strong:!0,children:["Feather: ",m,"px"]}),(0,n.jsx)(tx.default,{min:0,max:50,value:m,onChange:v})]}),(0,n.jsxs)(j.default,{children:[(0,n.jsx)(W.default,{title:"Undo Mask Stroke",children:(0,n.jsx)(I.default,{icon:(0,n.jsx)(tT.default,{}),onClick:()=>{if(c){let t=c.getObjects();t.length>0&&c.remove(t[t.length-1]);}}})}),(0,n.jsx)(W.default,{title:"Clear Mask",children:(0,n.jsx)(I.default,{icon:(0,n.jsx)(tH.default,{}),onClick:()=>{c&&(c.clear(),c.set("backgroundColor","rgba(0,0,0,0)"),c.renderAll());}})})]}),(0,n.jsxs)(j.default,{direction:"vertical",style:{marginTop:16},children:[(0,n.jsx)(t0,{strong:!0,children:"Apply Mode:"}),(0,n.jsxs)(tb.default.Group,{value:b,onChange:t=>w(t.target.value),children:[(0,n.jsx)(tb.default,{value:"overlay",children:"Overlay (Non-destructive)"}),(0,n.jsx)(tb.default,{value:"flatten",children:"Flatten (Permanent)"})]})]}),(0,n.jsxs)("div",{style:{marginTop:"auto",display:"flex",flexDirection:"column",gap:8},children:[(0,n.jsx)(I.default,{icon:(0,n.jsx)(tU.default,{}),onClick:k,loading:x,children:"Update Preview"}),(0,n.jsxs)(j.default,{children:[(0,n.jsx)(I.default,{onClick:e,children:"Cancel"}),(0,n.jsx)(I.default,{type:"primary",onClick:O,loading:x,children:"Apply Blur"})]})]})]})]}),(0,n.jsx)("div",{style:{marginTop:8,color:"#666"},children:"Paint over areas to blur. Red overlay shows masked area. Click Preview to test settings."})]});};var t2=i("92be0fc5"),t5=r._(t2),t4=i("a5512054"),t3=r._(t4),t6=i("e2967699"),t8=r._(t6),t7=i("54c23ac9"),t9=r._(t7),et=i("93cff216"),ee=r._(et);let ei=(t,e=0,i=255)=>Math.min(i,Math.max(e,t)),er=t=>Math.min(1,Math.max(0,t)),es=(t,e,i)=>{let r=Math.max(t/=255,e/=255,i/=255),s=Math.min(t,e,i),n=0,a=0,o=(r+s)/2;if(r!==s){let l=r-s;switch(a=o>.5?l/(2-r-s):l/(r+s),r){case t:n=(e-i)/l+(e<i?6:0);break;case e:n=(i-t)/l+2;break;case i:n=(t-e)/l+4;}n/=6;}return[n,a,o];},en=(t,e,i)=>{let r,s,n;if(0===e)r=s=n=i;else{let a=(t,e,i)=>(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?t+(e-t)*6*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t,o=i<.5?i*(1+e):i+e-i*e,l=2*i-o;r=a(l,o,t+1/3),s=a(l,o,t),n=a(l,o,t-1/3);}return[Math.round(255*r),Math.round(255*s),Math.round(255*n)];},ea=[{name:"red",range:[345,15]},{name:"orange",range:[15,45]},{name:"yellow",range:[45,75]},{name:"green",range:[75,165]},{name:"aqua",range:[165,195]},{name:"blue",range:[195,255]},{name:"purple",range:[255,285]},{name:"magenta",range:[285,345]}],eo=t=>{let e=(t%360+360)%360,i=ea.find(({range:t})=>{let[i,r]=t;return i<=r?e>=i&&e<r:e>=i||e<r;});return(null==i?void 0:i.name)||"red";},el=t=>{let e=[...t].sort((t,e)=>t.x-e.x);e[0].x>0&&e.unshift({x:0,y:e[0].y}),e[e.length-1].x<255&&e.push({x:255,y:e[e.length-1].y});let i=e.map(t=>t.x),r=e.map(t=>t.y),s=i.length,n=[],a=[],o=[];for(let t=0;t<s-1;t++){let e=i[t+1]-i[t],s=r[t+1]-r[t];a.push(e),n.push(s),o.push(s/e);}let l=[o[0]];for(let t=0;t<s-2;t++){let e=o[t],i=o[t+1];if(e*i<=0)l.push(0);else{let r=a[t],s=a[t+1],n=r+s;l.push(3*n/((n+s)/e+(n+r)/i));}}l.push(o[o.length-1]);let h=Array(256).fill(0);for(let t=0;t<s-1;t++){let e=i[t],s=i[t+1],n=r[t],a=r[t+1],o=l[t],c=l[t+1],d=s-e;for(let t=e;t<=s&&!(t>=256);t++){let i=(t-e)/d,r=i*i,s=r*i,l=(2*s-3*r+1)*n+(s-2*r+i)*d*o+(-2*s+3*r)*a+(s-r)*d*c;h[Math.round(t)]=ei(Math.round(l));}}return h;},eh=(t,e)=>{let i=t.data,{hsl:r,curves:s,colorGrading:n}=e,a=el(s.master),o=el(s.red),l=el(s.green),h=el(s.blue);en(n.shadows.h/360,n.shadows.s,2*n.shadows.l),en(n.midtones.h/360,n.midtones.s,2*n.midtones.l),en(n.highlights.h/360,n.highlights.s,2*n.highlights.l);for(let t=0;t<i.length;t+=4){let e=i[t],s=i[t+1],c=i[t+2];e=o[e],s=l[s],c=h[c];let[d,u,g]=es(e=a[e],s=a[s],c=a[c]),f=(360*d+360)%360,p=ea.find(({range:t})=>{let[e,i]=t;return e<=i?f>=e&&f<=i:f>=e||f<=i;});if(p){let t=r[p.name];if(t){let[i,r]=p.range,n=r;i>n&&(n+=360);let a=f;if(a<i&&(a+=360),0!==t.h){let e=a+t.h;e<i&&(e=i),e>n&&(e=n),d=(f=(e%360+360)%360)/360;}0!==t.s&&(u=er(u*(1+(1>=Math.abs(t.s)?100*t.s:t.s)/100))),0!==t.l&&(g=er(g*(1+(1>=Math.abs(t.l)?100*t.l:t.l)/100))),[e,s,c]=en(d,u,g);}else[e,s,c]=en(d,u,g);}let m=e/255*.299+s/255*.587+c/255*.114,v=.5+.25*(n.balance||0),x=Math.max(.001,.5*(.5+(n.blending??0)*.5)),y=er((v-m)/x),b=er((m-v)/x),w=Math.max(0,1-Math.abs(m-v)/x);if(Math.abs(n.shadows.s)>0||Math.abs(n.shadows.l)>0){let[t,i,r]=en(n.shadows.h/360,n.shadows.s,.5),a=n.shadows.l||0;e+=(t-128)*y*2,s+=(i-128)*y*2,c+=(r-128)*y*2;let o=255*a*y;e+=o,s+=o,c+=o;}if(Math.abs(n.highlights.s)>0||Math.abs(n.highlights.l)>0){let[t,i,r]=en(n.highlights.h/360,n.highlights.s,.5),a=n.highlights.l||0;e+=(t-128)*b*2,s+=(i-128)*b*2,c+=(r-128)*b*2;let o=255*a*b;e+=o,s+=o,c+=o;}if(Math.abs(n.midtones.s)>0||Math.abs(n.midtones.l)>0){let[t,i,r]=en(n.midtones.h/360,n.midtones.s,.5),a=n.midtones.l||0;e+=(t-128)*w*2,s+=(i-128)*w*2,c+=(r-128)*w*2;let o=255*a*w;e+=o,s+=o,c+=o;}let C=n.temperature||0,_=n.tint||0;if(0!==C){let t=40*C;e+=t,c-=t;}if(0!==_){let t=30*_;s+=t,e-=.35*t,c-=.35*t;}i[t]=ei(e),i[t+1]=ei(s),i[t+2]=ei(c);}return t;},ec=({label:t,value:e,min:i,max:r,step:s=1,gradient:a,onChange:o,onChangeComplete:l})=>(0,n.jsxs)("div",{className:"custom-slider-container",children:[(0,n.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)("span",{className:"custom-label",style:{fontSize:12},children:t}),(0,n.jsx)(tI.default,{min:i,max:r,step:s,value:e,onChange:t=>o(Number(t)),onBlur:()=>null==l?void 0:l(),className:"custom-number",size:"small",style:{width:50,fontSize:12}})]}),(0,n.jsx)(tx.default,{min:i,max:r,step:s,value:e,onChange:o,onChangeComplete:l,className:"custom-slider",style:{"--custom-slider-gradient":a,margin:"6px 0 16px 0"},handleStyle:{opacity:1}})]}),ed=[{name:"red",color:"#ff4d4d"},{name:"orange",color:"#ffa500"},{name:"yellow",color:"#ffd700"},{name:"green",color:"#00c853"},{name:"aqua",color:"#00e5ff"},{name:"blue",color:"#2979ff"},{name:"purple",color:"#9c27b0"},{name:"magenta",color:"#ff00aa"}],eu=(t,e)=>{var i,r,s;let n=(null===(i=ed.find(e=>e.name===t))||void 0===i?void 0:i.color)||"#ffffff",a=ed.findIndex(e=>e.name===t);if(-1===a)return"#555";let o=ed[a].color,l=(null===(r=ed[a-1])||void 0===r?void 0:r.color)||o,h=(null===(s=ed[a+1])||void 0===s?void 0:s.color)||o;switch(e){case"h":return`linear-gradient(90deg, ${l}, ${o}, ${h})`;case"s":return`linear-gradient(90deg, gray, ${n})`;case"l":return`linear-gradient(90deg, black, ${n}, white)`;default:return"#555";}},eg=({adjustments:t,onChange:e,activeChannel:i,onActiveChannelChange:r})=>{let[s,a]=(0,o.useState)("red"),l=void 0!==i?i:s,h=t[l]||{h:0,s:0,l:0},c=(i,r)=>{e({...t,[l]:{...t[l],[i]:r}});};return(0,n.jsxs)("div",{children:[(0,n.jsx)(t5.default,{activeKey:l,onChange:t=>{r?r(t):a(t);},type:"card",size:"small",items:ea.map(t=>{var e;return{label:(0,n.jsx)("span",{style:{display:"inline-block",width:12,height:12,background:(null===(e=ed.find(e=>e.name===t.name))||void 0===e?void 0:e.color)||"#eee",borderRadius:"50%",marginRight:4},title:t.name}),key:t.name};}),tabPosition:"top",tabBarGutter:4}),(0,n.jsxs)("div",{style:{marginTop:16},children:[(0,n.jsx)(tV.default.Title,{level:5,style:{textTransform:"capitalize"},children:l}),(0,n.jsx)("div",{style:{marginBottom:16},children:(0,n.jsx)(ec,{label:`Hue (${h.h}\xb0)`,min:-180,max:180,value:h.h,onChange:t=>c("h",t),gradient:eu(l,"h")})}),(0,n.jsx)("div",{style:{marginBottom:16},children:(0,n.jsx)(ec,{label:`Saturation (${Math.round(100*h.s)}%)`,min:-1,max:1,step:.01,value:h.s,onChange:t=>c("s",t),gradient:eu(l,"s")})}),(0,n.jsx)("div",{style:{marginBottom:16},children:(0,n.jsx)(ec,{label:`Luminance (${Math.round(100*h.l)}%)`,min:-1,max:1,step:.01,value:h.l,onChange:t=>c("l",t),gradient:eu(l,"l")})}),(0,n.jsxs)(I.default,{onClick:()=>{e({...t,[l]:{h:0,s:0,l:0}});},size:"small",children:["Reset ",l]})]})]});},ef={master:"#ffffff",red:"#ff4d4f",green:"#52c41a",blue:"#1890ff"},ep=({curves:t,onChange:e})=>{let[i,r]=(0,o.useState)("master"),s=(0,o.useRef)(null),[a,l]=(0,o.useState)(null),h=t[i];(0,o.useEffect)(()=>{let t=s.current;if(!t)return;let e=t.getContext("2d");if(!e)return;let r=t.width,n=t.height;e.fillStyle="#262626",e.fillRect(0,0,r,n),e.strokeStyle="#434343",e.lineWidth=1,e.beginPath();for(let t=1;t<4;t++){let i=r/4*t;e.moveTo(i,0),e.lineTo(i,n),e.moveTo(0,i),e.lineTo(r,i);}e.stroke();let o=el(h);e.strokeStyle=ef[i],e.lineWidth=2,e.beginPath();for(let t=0;t<256;t++){let i=o[t],s=t/255*r,a=n-i/255*n;0===t?e.moveTo(s,a):e.lineTo(s,a);}e.stroke(),h.forEach((t,i)=>{let s=t.x/255*r,o=n-t.y/255*n;e.fillStyle=i===a?"#fff":"#aaa",e.beginPath(),e.arc(s,o,4,0,2*Math.PI),e.fill();});},[h,i,a]);let c=()=>{l(null);};return(0,n.jsxs)("div",{children:[(0,n.jsxs)(j.default,{style:{marginBottom:16},children:[(0,n.jsx)(tC.default,{value:i,onChange:r,options:[{label:"RGB (Master)",value:"master"},{label:"Red",value:"red"},{label:"Green",value:"green"},{label:"Blue",value:"blue"}],style:{width:120}}),(0,n.jsx)(I.default,{onClick:()=>e({...t,[i]:[{x:0,y:0},{x:255,y:255}]}),children:"Reset Channel"})]}),(0,n.jsx)("div",{className:"curves-canvas-container",style:{cursor:null!==a?"grabbing":"crosshair"},children:(0,n.jsx)("canvas",{ref:s,width:256,height:256,style:{width:"100%",maxWidth:256,background:"#222",borderRadius:4},onMouseDown:r=>{let n=s.current;if(!n)return;let a=n.getBoundingClientRect(),o=(r.clientX-a.left)/a.width*255,c=(1-(r.clientY-a.top)/a.height)*255,d=Math.round(o),u=Math.round(c),g=h.findIndex(t=>10>Math.abs(t.x-d)&&10>Math.abs(t.y-u));if(-1!==g)l(g);else{let r={x:d,y:u},s=[...h,r].sort((t,e)=>t.x-e.x);e({...t,[i]:s}),s.indexOf(r);}},onMouseMove:r=>{if(null===a)return;let n=s.current;if(!n)return;let o=n.getBoundingClientRect(),l=(r.clientX-o.left)/o.width*255,c=(1-(r.clientY-o.top)/o.height)*255;l=Math.max(0,Math.min(255,l)),c=Math.max(0,Math.min(255,c));let d=[...h],u=0===a,g=a===h.length-1;u&&(l=0),g&&(l=255),u||g||(l=Math.max(d[a-1].x+1,Math.min(d[a+1].x-1,l))),d[a]={x:Math.round(l),y:Math.round(c)},e({...t,[i]:d});},onMouseUp:c,onMouseLeave:c,onDoubleClick:r=>{let n=s.current;if(!n)return;let a=n.getBoundingClientRect(),o=(r.clientX-a.left)/a.width*255,l=(1-(r.clientY-a.top)/a.height)*255,c=h.findIndex(t=>10>Math.abs(t.x-o)&&10>Math.abs(t.y-l));if(c>0&&c<h.length-1){let r=h.filter((t,e)=>e!==c);e({...t,[i]:r});}}})})]});},{Panel:em}=_.default,ev=({settings:t,onChange:e})=>{let i=(i,r,s)=>{e({...t,[i]:{...t[i],[r]:s}});},r=(i,r)=>{e({...t,[i]:r});},s=t=>`linear-gradient(to right, #888, hsl(${t}, 100%, 50%))`;return(0,n.jsxs)("div",{children:[(0,n.jsxs)(_.default,{defaultActiveKey:["shadows","midtones","highlights"],ghost:!0,children:[(0,n.jsxs)(em,{header:"Shadows",children:[(0,n.jsx)(ec,{label:`Hue (${Math.round(t.shadows.h)}\xb0)`,min:0,max:360,value:t.shadows.h,onChange:t=>i("shadows","h",t),gradient:"linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%)"}),(0,n.jsx)(ec,{label:`Saturation (${Math.round(100*t.shadows.s)}%)`,min:0,max:1,step:.01,value:t.shadows.s,onChange:t=>i("shadows","s",t),gradient:s(t.shadows.h)}),(0,n.jsx)(ec,{label:`Luminance (${Math.round(100*t.shadows.l)}%)`,min:-1,max:1,step:.01,value:t.shadows.l,onChange:t=>i("shadows","l",t),gradient:"linear-gradient(to right, #000, #888, #fff)"})]},"shadows"),(0,n.jsxs)(em,{header:"Midtones",children:[(0,n.jsx)(ec,{label:`Hue (${Math.round(t.midtones.h)}\xb0)`,min:0,max:360,value:t.midtones.h,onChange:t=>i("midtones","h",t),gradient:"linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%)"}),(0,n.jsx)(ec,{label:`Saturation (${Math.round(100*t.midtones.s)}%)`,min:0,max:1,step:.01,value:t.midtones.s,onChange:t=>i("midtones","s",t),gradient:s(t.midtones.h)}),(0,n.jsx)(ec,{label:`Luminance (${Math.round(100*t.midtones.l)}%)`,min:-1,max:1,step:.01,value:t.midtones.l,onChange:t=>i("midtones","l",t),gradient:"linear-gradient(to right, #000, #888, #fff)"})]},"midtones"),(0,n.jsxs)(em,{header:"Highlights",children:[(0,n.jsx)(ec,{label:`Hue (${Math.round(t.highlights.h)}\xb0)`,min:0,max:360,value:t.highlights.h,onChange:t=>i("highlights","h",t),gradient:"linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%)"}),(0,n.jsx)(ec,{label:`Saturation (${Math.round(100*t.highlights.s)}%)`,min:0,max:1,step:.01,value:t.highlights.s,onChange:t=>i("highlights","s",t),gradient:s(t.highlights.h)}),(0,n.jsx)(ec,{label:`Luminance (${Math.round(100*t.highlights.l)}%)`,min:-1,max:1,step:.01,value:t.highlights.l,onChange:t=>i("highlights","l",t),gradient:"linear-gradient(to right, #000, #888, #fff)"})]},"highlights")]}),(0,n.jsxs)("div",{style:{marginTop:12},children:[(0,n.jsx)(ec,{label:`Blending (${Math.round(100*t.blending)}%)`,min:0,max:1,step:.01,value:t.blending,onChange:t=>r("blending",t),gradient:"linear-gradient(to right, #444, #888, #ccc)"}),(0,n.jsx)(ec,{label:`Balance (${Math.round(100*t.balance)}%)`,min:-1,max:1,step:.01,value:t.balance,onChange:t=>r("balance",t),gradient:"linear-gradient(to right, #f00, #888, #00f)"}),(0,n.jsx)(ec,{label:`Temperature (${Math.round(100*t.temperature)}%)`,min:-1,max:1,step:.01,value:t.temperature,onChange:t=>r("temperature",t),gradient:"linear-gradient(to right, #001f3f, #888, #ffdd99)"}),(0,n.jsx)(ec,{label:`Tint (${Math.round(100*t.tint)}%)`,min:-1,max:1,step:.01,value:t.tint,onChange:t=>r("tint",t),gradient:"linear-gradient(to right, #ff88ff, #888, #88ff88)"})]}),(0,n.jsx)(I.default,{onClick:()=>e({shadows:{h:0,s:0,l:0},midtones:{h:0,s:0,l:0},highlights:{h:0,s:0,l:0},blending:.5,balance:0,temperature:0,tint:0}),style:{marginTop:16},children:"Reset Grading"})]});};var ex=i("10314b7a"),ey=r._(ex),eb=i("027e0896"),ew=r._(eb);let eC=({canvasRef:t,redData:e,greenData:i,blueData:r})=>{let s=(0,o.useMemo)(()=>({chart:{backgroundColor:"#2b2b2b",height:120,spacing:[5,5,5,5]},title:{text:""},xAxis:{title:{text:"",style:{color:"#fff"}},labels:{style:{color:"#fff",fontSize:"5px"}},gridLineColor:"rgba(255,255,255,0.1)"},yAxis:{title:{text:"",style:{color:"#fff"}},labels:{style:{color:"#fff",fontSize:"5px"}},gridLineColor:"rgba(255,255,255,0.1)"},legend:{enabled:!1},plotOptions:{histogram:{binWidth:4},series:{animation:!1,marker:{enabled:!1}}},series:[{name:"Red",data:e,color:"#ff4444",zIndex:3,lineWidth:1,marker:{radius:1}},{name:"Green",data:i,color:"#44ff44",zIndex:2,lineWidth:1,marker:{radius:1}},{name:"Blue",data:r,color:"#4444ff",zIndex:1,lineWidth:1,marker:{radius:1}}],credits:{enabled:!1},tooltip:{enabled:!1}}),[e,i,r]);return(0,n.jsx)(ew.default,{highcharts:ey.default,options:s});},e_=(t={})=>{let{maxPreviewSize:e=1920,qualityThreshold:i=4194304}=t,r=(0,o.useRef)(new Map),s=(0,o.useCallback)((t,s)=>{let n=`${t}x${s}`;if(r.current.has(n))return r.current.get(n);if(t*s<=i)return r.current.set(n,1),1;let a=Math.min(1,e/Math.max(t,s));return r.current.set(n,a),a;},[e,i]),n=(0,o.useCallback)((t,e)=>t*e>i,[i]),a=(0,o.useCallback)(t=>{let e=s(t.width,t.height);if(e>=1){let e=document.createElement("canvas");e.width=t.width,e.height=t.height;let i=e.getContext("2d");return i&&i.drawImage(t,0,0),e;}let i=Math.round(t.width*e),r=Math.round(t.height*e),n=document.createElement("canvas");n.width=i,n.height=r;let a=n.getContext("2d");return a&&(a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(t,0,0,i,r)),n;},[s]),l=(0,o.useCallback)((t,e,i)=>{if(t.width===e&&t.height===i)return t;let r=document.createElement("canvas");r.width=e,r.height=i;let s=r.getContext("2d");return s&&(s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high",s.drawImage(t,0,0,e,i)),r;},[]),h=(0,o.useCallback)(async(t,e,i=!1)=>{let r;let s=t.width,o=t.height,h=i&&n(s,o);if(h)r=a(t);else{(r=document.createElement("canvas")).width=s,r.height=o;let e=r.getContext("2d");e&&e.drawImage(t,0,0);}return{result:await e(r),canvas:h&&!i?l(r,s,o):r};},[n,a,l]);return{createPreviewCanvas:a,scaleToOriginal:l,shouldUseProgressivePreview:n,getPreviewScale:s,applyWithPreview:h};},{Text:eS}=tV.default,ej=({visible:t,onCancel:e,onApply:i,sourceCanvas:r})=>{let[s,a]=(0,o.useState)(!1),l=(0,o.useRef)(null),[h,c]=(0,o.useState)(!1),[d,u]=(0,o.useState)(Array(256).fill(0)),[g,f]=(0,o.useState)(Array(256).fill(0)),[p,m]=(0,o.useState)(Array(256).fill(0)),v=(0,o.useMemo)(()=>{let t={};return ea.forEach(e=>t[e.name]={h:0,s:0,l:0}),{hsl:t,curves:{master:[{x:0,y:0},{x:255,y:255}],red:[{x:0,y:0},{x:255,y:255}],green:[{x:0,y:0},{x:255,y:255}],blue:[{x:0,y:0},{x:255,y:255}]},colorGrading:{shadows:{h:0,s:0,l:0},midtones:{h:0,s:0,l:0},highlights:{h:0,s:0,l:0},blending:.5,balance:0,temperature:0,tint:0}};},[]),[x,y]=(0,o.useState)(v),[b,w]=(0,o.useState)(!1),[C,_]=(0,o.useState)("red"),[S,j]=(0,o.useState)("hsl"),[T,k]=(0,o.useState)(null),[O,M]=(0,o.useState)(null),{createPreviewCanvas:D,shouldUseProgressivePreview:E}=e_({maxPreviewSize:600,qualityThreshold:36e4});(0,o.useEffect)(()=>{t&&y(v);},[t,v]),(0,o.useEffect)(()=>{if(!t||!r||!l.current)return;let e=l.current,i=setTimeout(()=>{let t=D(r),i=t.width,s=t.height;e.width=i,e.height=s;let n=e.getContext("2d");if(!n)return;n.drawImage(t,0,0);let a=n.getImageData(0,0,i,s);if(h){let t=Array(256).fill(0),e=Array(256).fill(0),i=Array(256).fill(0),r=a.data;for(let s=0;s<r.length;s+=4)t[r[s]]+=1,e[r[s+1]]+=1,i[r[s+2]]+=1;u(t),f(e),m(i);}else{eh(a,x);let t=Array(256).fill(0),e=Array(256).fill(0),i=Array(256).fill(0),r=a.data;for(let s=0;s<r.length;s+=4)t[r[s]]+=1,e[r[s+1]]+=1,i[r[s+2]]+=1;u(t),f(e),m(i),n.putImageData(a,0,0);}},50);return()=>clearTimeout(i);},[t,r,x,h]);let A=async()=>{r&&(a(!0),setTimeout(()=>{let t=document.createElement("canvas");t.width=r.width,t.height=r.height;let e=t.getContext("2d");if(!e){a(!1);return;}e.drawImage(r,0,0);let s=e.getImageData(0,0,r.width,r.height);eh(s,x),e.putImageData(s,0,0),i(t),a(!1);},100));},P=t=>{let e,i;let r=t.altKey;if(!b&&!r||!l.current)return;let s=l.current,n=s.getBoundingClientRect();"touches"in t?(e=t.touches[0].clientX,i=t.touches[0].clientY):(e=t.clientX,i=t.clientY);let a=e-n.left,o=i-n.top,h=s.width/n.width,c=s.height/n.height,d=Math.floor(a*h),u=Math.floor(o*c),g=s.getContext("2d");if(!g)return;let f=g.getImageData(Math.max(0,d-1),Math.max(0,u-1),3,3).data;if(0===f.length)return;let p=0,m=0,v=0,x=f.length/4;for(let t=0;t<f.length;t+=4)p+=f[t],m+=f[t+1],v+=f[t+2];let[y,w,C]=es(p=Math.round(p/x),m=Math.round(m/x),v=Math.round(v/x)),S=360*y;_(eo(S)),j("hsl"),M({h:S,s:w,l:C}),k({x:a,y:o});},F=[{key:"hsl",label:"HSL Mixer",children:(0,n.jsx)(eg,{adjustments:x.hsl,onChange:t=>y({...x,hsl:t}),activeChannel:C,onActiveChannelChange:_})},{key:"curves",label:"Curves",children:(0,n.jsx)(ep,{curves:x.curves,onChange:t=>y({...x,curves:t})})},{key:"grading",label:"Color Grading",children:(0,n.jsx)(ev,{settings:x.colorGrading,onChange:t=>y({...x,colorGrading:t})})}];return(0,n.jsx)(tm.default,{title:"Camera Raw Filter",open:t,onCancel:e,width:1200,onOk:A,confirmLoading:s,okText:"Apply",style:{top:20},children:(0,n.jsxs)(t3.default,{gutter:24,children:[(0,n.jsx)(t8.default,{span:16,style:{textAlign:"center",background:"#f0f0f0",padding:16,display:"flex",alignItems:"center",justifyContent:"center",minHeight:400,flexDirection:"column"},children:(0,n.jsxs)("div",{style:{width:"100%",display:"flex",justifyContent:"center",position:"relative"},children:[(0,n.jsxs)("div",{style:{position:"absolute",right:12,top:12,zIndex:3,display:"flex",gap:8},children:[(0,n.jsx)(W.default,{title:"Pick color to select HSL channel",children:(0,n.jsx)(I.default,{size:"small",type:b?"primary":"default",icon:(0,n.jsx)(ee.default,{}),onClick:()=>{w(!b),k(null);}})}),(0,n.jsx)(I.default,{size:"small",icon:h?(0,n.jsx)(t9.default,{}):(0,n.jsx)(tU.default,{}),onClick:()=>c(t=>!t)})]}),(0,n.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,n.jsx)("canvas",{ref:l,onClick:P,onTouchStart:P,style:{maxWidth:"100%",maxHeight:"550px",border:"1px solid #ccc",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",cursor:b?"crosshair":"default",display:"block"}}),b&&T&&O&&(0,n.jsxs)("div",{style:{position:"absolute",left:T.x,top:T.y,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:10},children:[(0,n.jsx)("div",{style:{width:20,height:20,border:"2px solid white",borderRadius:"50%",boxShadow:"0 0 2px black"}}),(0,n.jsxs)("div",{style:{position:"absolute",top:24,left:0,background:"rgba(0,0,0,0.8)",color:"#fff",padding:"2px 6px",borderRadius:4,fontSize:10,whiteSpace:"nowrap"},children:["H:",Math.round(O.h)," S:",Math.round(100*O.s)," L:",Math.round(100*O.l)]})]})]})]})}),(0,n.jsxs)(t8.default,{span:8,children:[(0,n.jsx)("div",{style:{width:"100%"},children:(0,n.jsx)(eC,{canvasRef:l,redData:d,greenData:g,blueData:p})}),(0,n.jsx)("div",{style:{marginTop:12,marginBottom:16,padding:"0 8px"},children:(0,n.jsxs)(t3.default,{gutter:[12,8],children:[(0,n.jsxs)(t8.default,{span:12,children:[(0,n.jsx)(eS,{type:"secondary",style:{fontSize:12,display:"block"},children:"Resolution"}),(0,n.jsx)(eS,{style:{fontSize:13},children:r?`${r.width} \xd7 ${r.height}`:"N/A"})]}),(0,n.jsxs)(t8.default,{span:6,children:[(0,n.jsx)(eS,{type:"secondary",style:{fontSize:12,display:"block"},children:"ISO"}),(0,n.jsx)(eS,{style:{fontSize:13},children:"--"})]}),(0,n.jsxs)(t8.default,{span:6,children:[(0,n.jsx)(eS,{type:"secondary",style:{fontSize:12,display:"block"},children:"Exp"}),(0,n.jsx)(eS,{style:{fontSize:13},children:"--"})]})]})}),(0,n.jsx)(t5.default,{activeKey:S,onChange:j,items:F})]})]})});},eT=({canvas:t,selectedObject:e,saveState:i,history:r,maskModalVisible:s,setMaskModalVisible:a,cameraRawVisible:o,setCameraRawVisible:l,cropModalVisible:h,setCropModalVisible:c,blurBrushVisible:d,setBlurBrushVisible:u})=>{let g=e instanceof T.FabricImage,p=()=>{if(!e||!(e instanceof T.FabricImage))return null;let t=e.getElement(),i=document.createElement("canvas");i.width=t.width,i.height=t.height;let r=i.getContext("2d");return r&&r.drawImage(t,0,0),i;};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.default,{style:{margin:"8px 0"}}),(0,n.jsx)(W.default,{title:"Crop (C)",children:(0,n.jsx)(I.default,{icon:(0,n.jsx)(tf,{}),onClick:()=>c(!0)})}),(0,n.jsx)(W.default,{title:"Mask (M)",children:(0,n.jsx)(I.default,{icon:(0,n.jsx)(tc.default,{}),onClick:()=>a(!0),disabled:!g})}),(0,n.jsx)(W.default,{title:"Camera Raw Filter",children:(0,n.jsx)(I.default,{icon:(0,n.jsx)(tu.default,{}),onClick:()=>l(!0),disabled:!g})}),(0,n.jsx)(W.default,{title:"Blur Brush",children:(0,n.jsx)(I.default,{icon:(0,n.jsx)(V.default,{}),onClick:()=>u(!0)})}),s&&g&&(0,n.jsx)(tR,{open:s,onCancel:()=>a(!1),onApply:r=>{t&&e&&(tP(t,e,r),i(),a(!1));},sourceCanvas:p(),selectedColor:null}),o&&g&&(0,n.jsx)(ej,{visible:o,onCancel:()=>l(!1),onApply:r=>{if(!t||!e||!(e instanceof T.FabricImage))return;let s=new T.FabricImage(r);s.set({left:e.left,top:e.top,scaleX:e.scaleX,scaleY:e.scaleY,angle:e.angle,skewX:e.skewX,skewY:e.skewY,flipX:e.flipX,flipY:e.flipY,originX:e.originX,originY:e.originY,opacity:e.opacity});let n=t.getObjects().indexOf(e);t.discardActiveObject(),t.remove(e),t.add(s),t.moveObjectTo(s,n),t.setActiveObject(s),t.requestRenderAll(),i(),l(!1);},sourceCanvas:p()}),h&&(0,n.jsx)(tY,{visible:h,onCancel:()=>c(!1),canvas:t,history:r}),d&&(0,n.jsx)(t1,{visible:d,onCancel:()=>u(!1),canvas:t,history:r})]});},ek=({history:t})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.default,{style:{margin:"8px 0"}}),(0,n.jsx)(W.default,{title:"Undo (Ctrl+Z)",children:(0,n.jsx)(I.default,{icon:(0,n.jsx)(tT.default,{}),onClick:t.undo,disabled:!t.canUndo})}),(0,n.jsx)(W.default,{title:"Redo (Ctrl+Y)",children:(0,n.jsx)(I.default,{icon:(0,n.jsx)(tO.default,{}),onClick:t.redo,disabled:!t.canRedo})})]});var eO=i("73fccb4c"),eM=r._(eO);let eD=()=>{let{canvas:t,setActiveTool:e,activeTool:i,history:r,selectedObject:s,clipboard:a,setClipboard:l}=(0,y.usePhotoEditor)(),h=(0,o.useRef)(null),c=(0,o.useRef)(!1),[d,u]=(0,o.useState)(!1),[g,p]=(0,o.useState)(!1),[m,v]=(0,o.useState)(!1),[x,b]=(0,o.useState)(!1),[w,C]=(0,o.useState)(!1),[_,S]=(0,o.useState)(!1),{savedProjects:k,saveProject:O,deleteProject:M,loadProjectIntoEditor:D,clearCurrentProject:E}=F(),A=()=>{if(!t)return;let e=t.toJSON();O(t.toDataURL({format:"png",multiplier:.5}),e),R.photoEditorMessages.projectSaved();},P=()=>{t&&(t.discardActiveObject(),t.clear(),r.saveState(),E(),R.photoEditorMessages.canvasCleared());};return(0,o.useEffect)(()=>{let n=n=>{if("INPUT"!==n.target.tagName&&"TEXTAREA"!==n.target.tagName&&(!((null==t?void 0:t.getActiveObject())instanceof T.IText)||!t.getActiveObject().isEditing)){if("Space"===n.code){c.current||(c.current=!0,h.current=i,"hand"!==i&&e("hand")),n.preventDefault();return;}if(("v"===n.key||"V"===n.key)&&e("select"),("h"===n.key||"H"===n.key)&&e("hand"),("b"===n.key||"B"===n.key)&&e("brush"),"c"!==n.key&&"C"!==n.key||n.ctrlKey||n.metaKey||C(!0),("m"===n.key||"M"===n.key)&&s instanceof T.FabricImage&&p(!0),("t"===n.key||"T"===n.key)&&e("text"),"Delete"===n.key||"Backspace"===n.key){if(!t)return;let e=t.getActiveObjects();e.length&&(t.discardActiveObject(),e.forEach(e=>{t.remove(e);}),r.saveState());}(n.ctrlKey||n.metaKey)&&("z"===n.key||"Z"===n.key)&&(n.preventDefault(),n.shiftKey?r.redo():r.undo()),(n.ctrlKey||n.metaKey)&&"y"===n.key&&(n.preventDefault(),r.redo()),(n.ctrlKey||n.metaKey)&&"s"===n.key&&(n.preventDefault(),A()),(n.ctrlKey||n.metaKey)&&n.shiftKey&&"S"===n.key&&(n.preventDefault(),u(!0)),(n.ctrlKey||n.metaKey)&&"n"===n.key&&(n.preventDefault(),P());}},a=t=>{if("Space"===t.code&&c.current){c.current=!1;let i=h.current;h.current=null,i&&"hand"!==i&&e(i),t.preventDefault();}};return window.addEventListener("keydown",n),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",a);};},[t,s,r,i,a]),(0,o.useEffect)(()=>{if(!t)return;let e=!1,r=0,s=0,n=n=>{if("hand"!==i)return;e=!0;let a=n.e;r=a.clientX,s=a.clientY;try{t.discardActiveObject();}catch(t){}t.requestRenderAll(),t.defaultCursor="grabbing",document.body.style.cursor="grabbing",t.forEachObject(t=>t.evented=!1);},a=n=>{if(!e||"hand"!==i)return;let a=n.e,o=a.clientX-r,l=a.clientY-s;r=a.clientX,s=a.clientY,t.relativePan(new T.Point(o,l)),t.requestRenderAll();},o=()=>{e&&(e=!1,t.defaultCursor="default",document.body.style.cursor="default",t.forEachObject(t=>t.evented=!0));};return t.on("mouse:down",n),t.on("mouse:move",a),t.on("mouse:up",o),()=>{t.off("mouse:down",n),t.off("mouse:move",a),t.off("mouse:up",o);try{t.forEachObject(t=>t.evented=!0);}catch(t){}t.defaultCursor="default",document.body.style.cursor="default";};},[t,i]),(0,n.jsxs)(j.default,{direction:"vertical",style:{padding:"8px"},children:[(0,n.jsx)(H,{activeTool:i,setActiveTool:e}),(0,n.jsx)(tl,{canvas:t,activeTool:i,setActiveTool:e,saveState:r.saveState}),(0,n.jsx)(eT,{canvas:t,selectedObject:s,saveState:r.saveState,history:r,maskModalVisible:g,setMaskModalVisible:p,cameraRawVisible:m,setCameraRawVisible:v,cropModalVisible:w,setCropModalVisible:C,blurBrushVisible:_,setBlurBrushVisible:S}),(0,n.jsx)(ek,{history:r}),(0,n.jsx)(f.default,{style:{margin:"8px 0"}}),(0,n.jsx)(eM.default,{canvas:t,selectedObject:s,clipboard:a,setClipboard:l,saveState:r.saveState,savedProjects:k,onSaveProject:A,onDeleteProject:M,onLoadProject:e=>{t&&t.loadFromJSON(e.json).then(()=>{t.renderAll(),D(e),b(!1),r.saveState(),R.photoEditorMessages.projectLoaded();});},onNewProject:P,exportModalVisible:d,setExportModalVisible:u,projectModalVisible:x,setProjectModalVisible:b})]});},eE=t=>{let e=(0,o.useRef)(null);(0,o.useEffect)(()=>{if(!t)return;let i=async i=>{if((i.ctrlKey||i.metaKey)&&"c"===i.key){let i=t.getActiveObject();if(i){let t=await i.clone();e.current=t;}}if((i.ctrlKey||i.metaKey)&&"v"===i.key&&e.current){let i=await e.current.clone();t.discardActiveObject(),i.set({left:(i.left||0)+10,top:(i.top||0)+10,evented:!0}),"activeSelection"===i.type?(i.canvas=t,i.forEachObject(e=>{t.add(e);}),i.setCoords()):t.add(i),e.current=i,t.setActiveObject(i),t.requestRenderAll();}t.isDrawingMode&&t.freeDrawingBrush&&("["===i.key?t.freeDrawingBrush.width=Math.max(1,t.freeDrawingBrush.width-5):"]"===i.key&&(t.freeDrawingBrush.width+=5));};return window.addEventListener("keydown",i),()=>{window.removeEventListener("keydown",i);};},[t]);},eA=()=>{let t=(0,o.useRef)(null),e=(0,o.useRef)(null),{canvas:i,setCanvas:r,selectedObject:s,setSelectedObject:a,history:l,imageUrl:h,initialProject:c,activeTool:d,addOnFile:u,setAddOnFile:g,setActiveTool:f,brushSize:p,setBrushSize:m,brushColor:v,setBrushColor:x}=(0,y.usePhotoEditor)(),b=(0,o.useRef)(!1);eE(i);let w=(0,o.useRef)(!1),C=(0,o.useRef)(null),_=(0,o.useRef)(null),S=(0,o.useRef)(!1),j=(0,o.useRef)(0),k=(0,o.useRef)(0),O=(0,o.useRef)(p);return(0,o.useEffect)(()=>{O.current=p;},[p]),(0,o.useEffect)(()=>{if(!i||!u)return;let t=new FileReader;t.onload=t=>{var e;let r=null===(e=t.target)||void 0===e?void 0:e.result;T.FabricImage.fromURL(r).then(t=>{t.scaleToWidth(200),i.add(t),i.centerObject(t),i.setActiveObject(t),l.saveState(),g&&g(null);});},t.readAsDataURL(u);},[u,i]),(0,o.useEffect)(()=>{i&&i.freeDrawingBrush&&"brush"===d&&(i.freeDrawingBrush.width=p,i.freeDrawingBrush.color=v);},[i,d,p,v]),(0,o.useEffect)(()=>{if(!i||!e.current)return;let t=e.current,r=i.lowerCanvasEl||null,s=document.createElement("div");s.style.position="absolute",s.style.pointerEvents="none",s.style.width="28px",s.style.height="28px",s.style.borderRadius="50%",s.style.boxShadow="0 0 4px rgba(0,0,0,0.5)",s.style.border="2px solid #fff",s.style.transform="translate(-50%, -50%)",s.style.display="none",s.style.zIndex="1000",t.appendChild(s),C.current=s;let n=document.createElement("div");n.style.position="absolute",n.style.pointerEvents="none",n.style.border="1px solid rgba(0,0,0,0.5)",n.style.borderRadius="50%",n.style.transform="translate(-50%, -50%)",n.style.display="none",n.style.zIndex="999",t.appendChild(n),_.current=n;let a=(t,e,r)=>{_.current&&("brush"===d&&(r>10||S.current)?(_.current.style.width=`${r}px`,_.current.style.height=`${r}px`,_.current.style.left=`${t}px`,_.current.style.top=`${e}px`,_.current.style.display="block","none"!==i.defaultCursor&&(i.defaultCursor="none",i.hoverCursor="none",i.requestRenderAll())):(_.current.style.display="none","none"===i.defaultCursor&&(i.defaultCursor="default",i.hoverCursor="move",i.requestRenderAll())));},o=t=>{"Alt"===t.key&&(w.current=!0,"brush"===d&&(i.isDrawingMode=!1));},l=t=>{"Alt"===t.key&&(w.current=!1,"brush"!==d||S.current||(i.isDrawingMode=!0),C.current&&(C.current.style.display="none"));},h=t=>{t.altKey&&t.preventDefault();},c=e=>{if("brush"===d){if(e.altKey&&2===e.button){e.preventDefault(),S.current=!0,j.current=e.clientX,k.current=O.current,i.isDrawingMode=!1;return;}if(e.altKey&&0===e.button)try{let i=t.getBoundingClientRect(),s=e.clientX-i.left,n=e.clientY-i.top;if(!r)return;let a=r.getContext("2d");if(!a)return;let o=a.getImageData(s,n,1,1).data,l="#"+[o[0],o[1],o[2]].map(t=>t.toString(16).padStart(2,"0")).join("");x(l);}catch(t){}}},u=e=>{if("brush"!==d){_.current&&(_.current.style.display="none");return;}let i=t.getBoundingClientRect(),s=e.clientX-i.left,n=e.clientY-i.top;if(S.current){let t=e.clientX-j.current,i=Math.max(1,k.current+t);m(i),a(s,n,i);return;}if(a(s,n,O.current),w.current)try{if(!r)return;let t=r.getContext("2d");if(!t)return;if(s<0||n<0||s>=r.width||n>=r.height){C.current&&(C.current.style.display="none");return;}let e=t.getImageData(s,n,1,1).data,i="#"+[e[0],e[1],e[2]].map(t=>t.toString(16).padStart(2,"0")).join("");C.current&&(C.current.style.background=i,C.current.style.display="block",C.current.style.left=s+24+"px",C.current.style.top=n+24+"px");}catch(t){C.current&&(C.current.style.display="none");}else C.current&&(C.current.style.display="none");},g=t=>{S.current&&(S.current=!1,"brush"!==d||w.current||(i.isDrawingMode=!0));};return window.addEventListener("keydown",o),window.addEventListener("keyup",l),t.addEventListener("contextmenu",h),t.addEventListener("mousedown",c),window.addEventListener("mousemove",u),window.addEventListener("mouseup",g),()=>{if(window.removeEventListener("keydown",o),window.removeEventListener("keyup",l),t.removeEventListener("contextmenu",h),t.removeEventListener("mousedown",c),window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",g),C.current){try{t.removeChild(C.current);}catch(t){}C.current=null;}if(_.current){try{t.removeChild(_.current);}catch(t){}_.current=null;}i&&(i.defaultCursor="default",i.hoverCursor="move");};},[i,d,m,x]),(0,o.useEffect)(()=>{if(!t.current||!e.current)return;let i=new T.Canvas(t.current,{width:e.current.clientWidth,height:e.current.clientHeight,backgroundColor:"#ffffff",preserveObjectStacking:!0,selection:!0});r(i),c?i.loadFromJSON(c.json).then(()=>{i.renderAll(),l.saveState();}):h&&T.FabricImage.fromURL(h).then(t=>{let r=e.current.clientWidth,s=e.current.clientHeight;(t.width>r||t.height>s)&&t.scaleToWidth(.8*r),i.add(t),i.centerObject(t),i.setActiveObject(t),l.saveState();});let s=()=>{let t=i.getActiveObjects();1===t.length?a(t[0]):a(null);};i.on("selection:created",s),i.on("selection:updated",s),i.on("selection:cleared",()=>a(null)),i.on("text:editing:entered",()=>{b.current=!0,f&&f("text");}),i.on("text:editing:exited",()=>f&&f("select"));let n=()=>{l.saveState();};i.on("object:modified",n),i.on("object:added",n),i.on("object:removed",n);let o=t=>{if(t.ctrlKey){t.preventDefault();try{let e=i.getZoom()||1,r=t.deltaY,s=e*(r<0?1.12:.88);s=Math.max(.1,Math.min(5,s));let n=i.getPointer(t);if(n&&"number"==typeof n.x&&"number"==typeof n.y)i.zoomToPoint(new T.Point(n.x,n.y),s);else{let e=i.lowerCanvasEl.getBoundingClientRect(),r=t.clientX-e.left,n=t.clientY-e.top;i.zoomToPoint(new T.Point(r,n),s);}i.requestRenderAll();}catch(t){}}};e.current.addEventListener("wheel",o,{passive:!1});let d=()=>{e.current&&i.setDimensions({width:e.current.clientWidth,height:e.current.clientHeight});};return window.addEventListener("resize",d),()=>{if(i.dispose(),window.removeEventListener("resize",d),e.current)try{e.current.removeEventListener("wheel",o);}catch(t){}};},[]),(0,o.useEffect)(()=>{if(s)try{let t=!!s.isEditing;b.current=t,t&&f&&f("text");}catch(t){}},[s,f]),(0,o.useEffect)(()=>{i&&("brush"===d?(i.isDrawingMode=!0,i.freeDrawingBrush||(i.freeDrawingBrush=new T.PencilBrush(i)),i.freeDrawingBrush.width=p,i.freeDrawingBrush.color=v):i.isDrawingMode=!1);},[d,i]),(0,o.useEffect)(()=>{if(!i||"text"!==d)return;let t=t=>{try{if(b.current)return;let e=i.getViewportPoint(t.e),r=new T.IText("Text",{left:e.x,top:e.y,fontSize:24});i.add(r),i.setActiveObject(r),a&&a(r),r.enterEditing&&r.enterEditing(),r.selectAll&&r.selectAll(),i.requestRenderAll(),l.saveState(),f&&f("select");}catch(t){}};return i.on("mouse:down",t),()=>{i.off("mouse:down",t);};},[i,d,l,a,f]),(0,n.jsx)("div",{ref:e,style:{width:"100%",height:"100%"},children:(0,n.jsx)("canvas",{ref:t})});};var eP=i("7502124f"),eF=r._(eP),eR=i("5a5a4642"),eL=r._(eR),eI=i("6e3683a5"),eB=r._(eI),eW=i("acdcfa21"),eX=r._(eW),eY=i("e36949ef"),ez=r._(eY),eV=i("0d6a818e"),eN=i("4989c16f"),eH=i("039e4dd6");let{Title:eG}=tV.default,{Option:eU}=tC.default,e$=({id:t,children:e,isSelected:i,onClick:r})=>{let{attributes:s,listeners:a,setNodeRef:o,setActivatorNodeRef:l,transform:h,transition:c}=(0,eN.useSortable)({id:t}),d={transform:eH.CSS.Transform.toString(h),transition:c,backgroundColor:i?"#e6f7ff":"transparent",marginBottom:4,border:"1px solid #f0f0f0",borderRadius:4,padding:"4px 8px",display:"flex",alignItems:"center"};return(0,n.jsxs)("div",{ref:o,style:d,children:[(0,n.jsx)("div",{ref:l,...s,...a,style:{cursor:"grab",marginRight:8,display:"flex",alignItems:"center",color:"#999"},onMouseDown:t=>t.stopPropagation(),children:(0,n.jsx)(eB.default,{})}),(0,n.jsx)("div",{onClick:t=>r(t),style:{flex:1,cursor:"pointer"},children:e})]});},eq=()=>{let{canvas:t,selectedObject:e,setSelectedObject:i,history:r}=(0,y.usePhotoEditor)(),[s,a]=(0,o.useState)([]),[l,h]=(0,o.useState)([]),c=(0,o.useRef)(!1),d=(0,o.useRef)(null),u=(0,o.useRef)(100),g=(0,o.useRef)(null),f=(0,eV.useSensors)((0,eV.useSensor)(eV.PointerSensor),(0,eV.useSensor)(eV.KeyboardSensor,{coordinateGetter:eN.sortableKeyboardCoordinates})),p=()=>{if(!t)return;let e=t.getObjects();e.forEach(t=>{t.uid||(t.uid=Math.random().toString(36).substr(2,9));}),a([...e].reverse());};(0,o.useEffect)(()=>{let e;if(!t)return;let r=()=>{clearTimeout(e),e=setTimeout(p,100);},s=()=>{let e=t.getObjects();1===e.length&&e[0].set({lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,selectable:!1,hoverCursor:"default"}),r();};t.on("object:added",s),t.on("object:removed",r),t.on("object:modified",r);let n=()=>{h((t.getActiveObjects()||[]).map(t=>t.uid).filter(Boolean)),i(t.getActiveObject()??null);},a=()=>{h([]),i(null);};return t.on("selection:created",n),t.on("selection:updated",n),t.on("selection:cleared",a),p(),()=>{t.off("object:added",s),t.off("object:removed",r),t.off("object:modified",r),t.off("selection:created",n),t.off("selection:updated",n),t.off("selection:cleared",a),clearTimeout(e);};},[t]);let m=(e,i)=>{i.stopPropagation(),e.visible=!e.visible,e.visible||null==t||t.discardActiveObject(),null==t||t.requestRenderAll(),r.saveState(),a([...(null==t?void 0:t.getObjects())||[]].reverse());},v=(e,i)=>{i.stopPropagation(),e.lockMovementX=!e.lockMovementX,e.lockMovementY=!e.lockMovementY,e.lockRotation=!e.lockRotation,e.lockScalingX=!e.lockScalingX,e.lockScalingY=!e.lockScalingY,e.selectable=!e.lockMovementX,e.selectable||null==t||t.discardActiveObject(),null==t||t.requestRenderAll(),r.saveState(),a([...(null==t?void 0:t.getObjects())||[]].reverse());},x=(e,r)=>{if(!t||!e.visible||!e.selectable)return;let n=s.findIndex(t=>t===e),a=r&&(r.ctrlKey||r.metaKey),o=r&&r.shiftKey;if(a){let r=t.getActiveObjects()||[],s=r.includes(e),a=[];if(0===(a=s?r.filter(t=>t!==e):[...r,e]).length)t.discardActiveObject(),i(null);else if(1===a.length)t.setActiveObject(a[0]),i(a[0]);else{let e=new T.ActiveSelection(a,{canvas:t});t.setActiveObject(e),i(a[a.length-1]);}t.requestRenderAll(),g.current=n;return;}if(o&&null!==g.current){let e=Math.min(g.current,n),r=Math.max(g.current,n),a=s.slice(e,r+1).map(t=>t);if(1===a.length)t.setActiveObject(a[0]),i(a[0]);else{let e=new T.ActiveSelection(a,{canvas:t});t.setActiveObject(e),i(a[a.length-1]);}t.requestRenderAll();return;}t.setActiveObject(e),i(e),t.requestRenderAll(),g.current=n;},b=(e,i)=>{i.stopPropagation(),null==t||t.remove(e),null==t||t.requestRenderAll(),r.saveState();},w=i=>{if(!t||!e)return;let r=Number(i||0);e.set("opacity",Math.max(0,Math.min(100,r))/100),t.requestRenderAll();},C=()=>{r.saveState();};return(0,n.jsxs)("div",{style:{padding:10},children:[(0,n.jsx)(eG,{level:5,children:"Layers"}),(0,n.jsx)("div",{style:{marginBottom:8},children:(0,n.jsxs)(j.default,{children:[(0,n.jsx)(I.default,{icon:(0,n.jsx)(eX.default,{}),onClick:()=>{if(!t)return;let e=[...t.getActiveObjects()];if(e.length<=1)return;t.discardActiveObject();let s=new T.Group(e);s.uid||(s.uid=Math.random().toString(36).substr(2,9)),e.forEach(e=>t.remove(e)),t.add(s),t.setActiveObject(s),t.requestRenderAll(),r.saveState(),p(),i(s),h([s.uid]);},disabled:!e,title:"Merge Layers"}),(0,n.jsx)(I.default,{icon:(0,n.jsx)(ez.default,{}),onClick:()=>{if(!t)return;let e=t.getActiveObject();if(e&&("group"===e.type||e instanceof T.Group)){let s=e.getObjects().map(t=>{let e=t.calcTransformMatrix(),i=T.util.qrDecompose(e);return t.set({...i,left:i.translateX,top:i.translateY,angle:i.angle,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY}),t;});t.remove(e),s.forEach(e=>{t.add(e);});let n=new T.ActiveSelection(s,{canvas:t});t.setActiveObject(n),t.requestRenderAll(),r.saveState(),p(),i(n),h(s.map(t=>t.uid));}},disabled:!e||"group"!==e.type,title:"Ungroup Layers"})]})}),e&&(0,n.jsxs)("div",{style:{marginBottom:16,padding:8,background:"#fafafa",borderRadius:4},children:[(0,n.jsx)("div",{style:{marginBottom:8},children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,cursor:"ew-resize",userSelect:"none"},onMouseDown:i=>{if(0!==i.button)return;i.preventDefault(),c.current=!0,d.current=i.clientX,u.current=Math.round(((null==e?void 0:e.opacity)??1)*100);let s=document.body.style.userSelect;document.body.style.userSelect="none";let n=e=>{if(!c.current||null===d.current)return;let i=e.clientX-d.current,r=Math.max(0,Math.min(100,u.current+.2*i)),s=null==t?void 0:t.getActiveObject();s&&t&&(s.set("opacity",r/100),t.requestRenderAll());},a=()=>{c.current=!1,d.current=null,document.body.style.userSelect=s,window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",a),r.saveState();};window.addEventListener("mousemove",n),window.addEventListener("mouseup",a);},children:[(0,n.jsx)("div",{style:{marginRight:8},children:"Opacity:"}),(0,n.jsx)(tI.default,{size:"small",min:0,max:100,step:1,value:Math.round((e.opacity??1)*100),onChange:t=>w(t),onBlur:()=>C(),style:{flex:1}})]})}),(0,n.jsx)("div",{children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,width:"100%"},children:[(0,n.jsx)("div",{style:{marginRight:8},children:"Blend Mode:"}),(0,n.jsxs)(tC.default,{size:"small",style:{flex:1},value:e.globalCompositeOperation||"source-over",onChange:i=>{t&&e&&(e.set("globalCompositeOperation",i),t.requestRenderAll(),r.saveState());},children:[(0,n.jsx)(eU,{value:"source-over",children:"Normal"}),(0,n.jsx)(eU,{value:"multiply",children:"Multiply"}),(0,n.jsx)(eU,{value:"screen",children:"Screen"}),(0,n.jsx)(eU,{value:"overlay",children:"Overlay"}),(0,n.jsx)(eU,{value:"darken",children:"Darken"}),(0,n.jsx)(eU,{value:"lighten",children:"Lighten"}),(0,n.jsx)(eU,{value:"color-dodge",children:"Color Dodge"}),(0,n.jsx)(eU,{value:"color-burn",children:"Color Burn"}),(0,n.jsx)(eU,{value:"hard-light",children:"Hard Light"}),(0,n.jsx)(eU,{value:"soft-light",children:"Soft Light"}),(0,n.jsx)(eU,{value:"difference",children:"Difference"}),(0,n.jsx)(eU,{value:"exclusion",children:"Exclusion"}),(0,n.jsx)(eU,{value:"hue",children:"Hue"}),(0,n.jsx)(eU,{value:"saturation",children:"Saturation"}),(0,n.jsx)(eU,{value:"color",children:"Color"}),(0,n.jsx)(eU,{value:"luminosity",children:"Luminosity"})]})]})})]}),(0,n.jsx)(eV.DndContext,{sensors:f,collisionDetection:eV.closestCenter,onDragEnd:e=>{let{active:i,over:n}=e;if(n&&i.id!==n.id){let e=s.findIndex(t=>t.uid===i.id),a=s.findIndex(t=>t.uid===n.id);if(-1!==e&&-1!==a){let i=s.length-1-a,n=s[e];null==t||t.moveObjectTo(n,i),null==t||t.requestRenderAll(),r.saveState(),p();}}},children:(0,n.jsx)(eN.SortableContext,{items:s.map(t=>t.uid),strategy:eN.verticalListSortingStrategy,children:(0,n.jsx)("div",{style:{overflowY:"auto",border:"1px solid #d9d9d9",borderRadius:4,padding:4},children:s.map((t,e)=>{let i=l.includes(t.uid),r=t.type||"Object",a=t.name||`${r} ${s.length-e}`;return(0,n.jsx)(e$,{id:t.uid,isSelected:i,onClick:e=>x(t,e),children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},children:[(0,n.jsx)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:120},children:a}),(0,n.jsxs)(j.default,{size:4,children:[(0,n.jsx)(I.default,{type:"text",size:"small",icon:t.visible?(0,n.jsx)(tU.default,{}):(0,n.jsx)(t9.default,{}),onClick:e=>m(t,e),onMouseDown:t=>t.stopPropagation()}),(0,n.jsx)(I.default,{type:"text",size:"small",icon:t.lockMovementX?(0,n.jsx)(eF.default,{}):(0,n.jsx)(eL.default,{}),onClick:e=>v(t,e),onMouseDown:t=>t.stopPropagation()}),(0,n.jsx)(I.default,{type:"text",size:"small",danger:!0,icon:(0,n.jsx)(tH.default,{}),onClick:e=>b(t,e),onMouseDown:t=>t.stopPropagation()})]})]})},t.uid);})})})})]});},{Panel:eK}=_.default,eJ=[{name:"Grayscale",filter:T.filters.Grayscale,index:9},{name:"Invert",filter:T.filters.Invert,index:10},{name:"Sepia",filter:T.filters.Sepia,index:11},{name:"Black&White",filter:T.filters.BlackWhite,index:12},{name:"Brownie",filter:T.filters.Brownie,index:13},{name:"Vintage",filter:T.filters.Vintage,index:14},{name:"Kodachrome",filter:T.filters.Kodachrome,index:15},{name:"Technicolor",filter:T.filters.Technicolor,index:16},{name:"Polaroid",filter:T.filters.Polaroid,index:17}],eZ=({name:t,filterClass:e,originalImage:i,isActive:r,onClick:s})=>{let a=(0,o.useRef)(null);return(0,o.useEffect)(()=>{if(!i||!a.current)return;let t=a.current,r=t.getContext("2d");if(!r)return;t.width=60,t.height=60;let s=new T.FabricImage(i),n=60/Math.max(s.width||1,s.height||1);s.scale(n);let o=new e;s.filters=[o],s.applyFilters();let l=s.getElement();r.clearRect(0,0,60,60);let h=(s.width||0)*(s.scaleX||1),c=(s.height||0)*(s.scaleY||1);r.drawImage(l,(60-h)/2,(60-c)/2,h,c);},[i,e]),(0,n.jsxs)("div",{onClick:s,style:{cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[(0,n.jsx)("div",{style:{width:64,height:64,border:r?"2px solid #1890ff":"1px solid #f0f0f0",borderRadius:4,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f5f5f5"},children:(0,n.jsx)("canvas",{ref:a})}),(0,n.jsx)(tV.default.Text,{style:{fontSize:10,textAlign:"center",lineHeight:1.2},children:t})]});},eQ=()=>{let{canvas:t,selectedObject:e,history:i}=(0,y.usePhotoEditor)(),[r,s]=(0,o.useState)(null);(0,o.useEffect)(()=>{if(e&&e.isType("image")){let t=e.getSrc(),i=new Image;i.crossOrigin="anonymous",i.src=t,i.onload=()=>{s(i);};}else s(null);},[e]);let a=(i,r)=>{e&&e.isType("image")&&(e.filters[i]=r,e.applyFilters(),null==t||t.requestRenderAll());},l=(t,e,r)=>{a(t,!!r&&new e),i.saveState();};return e&&e.isType("image")?(0,n.jsxs)("div",{style:{padding:10,height:"100%",overflowY:"auto"},children:[(0,n.jsx)(tV.default.Title,{level:5,children:"Adjustments"}),(0,n.jsxs)(_.default,{defaultActiveKey:["1","2","3"],ghost:!0,children:[(0,n.jsx)(eK,{header:"Basic",children:(0,n.jsxs)(j.default,{direction:"vertical",style:{width:"100%"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(tV.default.Text,{children:"Brightness"}),(0,n.jsx)(tx.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:t=>{a(0,new T.filters.Brightness({brightness:t}));},onChangeComplete:()=>i.saveState()})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(tV.default.Text,{children:"Contrast"}),(0,n.jsx)(tx.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:t=>{a(1,new T.filters.Contrast({contrast:t}));},onChangeComplete:()=>i.saveState()})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(tV.default.Text,{children:"Saturation"}),(0,n.jsx)(tx.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:t=>{a(2,new T.filters.Saturation({saturation:t}));},onChangeComplete:()=>i.saveState()})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(tV.default.Text,{children:"Vibrance"}),(0,n.jsx)(tx.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:t=>{a(7,new T.filters.Vibrance({vibrance:t}));},onChangeComplete:()=>i.saveState()})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(tV.default.Text,{children:"Gamma"}),(0,n.jsx)(tx.default,{min:.1,max:2.2,step:.1,defaultValue:1,onChange:t=>{a(6,new T.filters.Gamma({gamma:[t,t,t]}));},onChangeComplete:()=>i.saveState()})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(tV.default.Text,{children:"Hue Rotation"}),(0,n.jsx)(tx.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:t=>{a(8,new T.filters.HueRotation({rotation:t}));},onChangeComplete:()=>i.saveState()})]})]})},"1"),(0,n.jsx)(eK,{header:"Effects",children:(0,n.jsxs)(j.default,{direction:"vertical",style:{width:"100%"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(tV.default.Text,{children:"Blur"}),(0,n.jsx)(tx.default,{min:0,max:1,step:.01,defaultValue:0,onChange:t=>{a(5,new T.filters.Blur({blur:t}));},onChangeComplete:()=>i.saveState()})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(tV.default.Text,{children:"Noise"}),(0,n.jsx)(tx.default,{min:0,max:1e3,defaultValue:0,onChange:t=>{a(3,new T.filters.Noise({noise:t}));},onChangeComplete:()=>i.saveState()})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(tV.default.Text,{children:"Pixelate"}),(0,n.jsx)(tx.default,{min:1,max:20,defaultValue:1,onChange:t=>{a(4,t>1&&new T.filters.Pixelate({blocksize:t}));},onChangeComplete:()=>i.saveState()})]})]})},"2"),(0,n.jsx)(eK,{header:"Filters",children:(0,n.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12},children:eJ.map(t=>{var i;let s=!!(null==e?void 0:null===(i=e.filters)||void 0===i?void 0:i[t.index]);return(0,n.jsx)(eZ,{name:t.name,filterClass:t.filter,originalImage:r,isActive:s,onClick:()=>l(t.index,t.filter,!s)},t.name);})})},"3")]})]}):(0,n.jsx)("div",{style:{padding:10},children:"Select an image to adjust"});},e0=()=>{let{canvas:t,brushSize:e,setBrushSize:i,brushColor:r,setBrushColor:s,brushOpacity:a,setBrushOpacity:l}=(0,y.usePhotoEditor)(),[h,c]=(0,o.useState)(0),[d,u]=(0,o.useState)("Pencil"),g=(0,o.useRef)(!1),f=(0,o.useRef)(null),p=(0,o.useRef)(e),m=(0,o.useRef)(!1),v=(0,o.useRef)(null),x=(0,o.useRef)(h),b=(0,o.useRef)(!1),w=(0,o.useRef)(null),C=(0,o.useRef)(a);return(0,o.useEffect)(()=>{if(!t)return;t.freeDrawingBrush||(t.freeDrawingBrush=new T.PencilBrush(t));let i=t.freeDrawingBrush,s=r.replace("#",""),n=parseInt(s.substring(0,2),16),o=parseInt(s.substring(2,4),16),l=parseInt(s.substring(4,6),16);i.color=`rgba(${n},${o},${l},${a})`,i.width=e,h>0?i.shadow=new T.Shadow({blur:h,color:i.color}):i.shadow=null;},[t,r,e,h,a]),(0,n.jsxs)("div",{style:{padding:10},children:[(0,n.jsx)(tV.default.Title,{level:5,children:"Brush Settings"}),(0,n.jsxs)(j.default,{direction:"vertical",style:{width:"100%"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(tV.default.Text,{children:"Type"}),(0,n.jsxs)(tC.default,{value:d,style:{width:"100%"},onChange:i=>{let s;if(!t)return;switch(u(i),i){case"Circle":s=new T.CircleBrush(t);break;case"Spray":s=new T.SprayBrush(t);break;default:s=new T.PencilBrush(t);}let n=r.replace("#",""),o=parseInt(n.substring(0,2),16),l=parseInt(n.substring(2,4),16),c=parseInt(n.substring(4,6),16);s.color=`rgba(${o},${l},${c},${a})`,s.width=e,h>0&&(s.shadow=new T.Shadow({blur:h,color:s.color})),t.freeDrawingBrush=s;},children:[(0,n.jsx)(tC.default.Option,{value:"Pencil",children:"Pencil"}),(0,n.jsx)(tC.default.Option,{value:"Circle",children:"Circle"}),(0,n.jsx)(tC.default.Option,{value:"Spray",children:"Spray"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(tV.default.Text,{children:"Color"}),(0,n.jsx)("br",{}),(0,n.jsx)(tS.default,{value:r,onChange:t=>s(t.toHexString()),showText:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(tV.default.Text,{onMouseDown:t=>{if(0!==t.button)return;t.preventDefault(),g.current=!0,f.current=t.clientX,p.current=e;let r=document.body.style.userSelect;document.body.style.userSelect="none";let s=t=>{if(!g.current||null===f.current)return;let e=t.clientX-f.current;i(Number(Math.max(1,Math.min(2e3,p.current+.2*e)).toFixed(0)));},n=()=>{g.current=!1,f.current=null,document.body.style.userSelect=r,window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",n);};window.addEventListener("mousemove",s),window.addEventListener("mouseup",n);},style:{cursor:"ew-resize",userSelect:"none"},children:"Width"}),(0,n.jsx)("br",{}),(0,n.jsx)(tI.default,{min:1,max:2e3,value:e,onChange:t=>i(Number(t||1)),style:{width:"100%"}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(tV.default.Text,{onMouseDown:t=>{if(0!==t.button)return;t.preventDefault(),b.current=!0,w.current=t.clientX,C.current=a;let e=document.body.style.userSelect;document.body.style.userSelect="none";let i=t=>{if(!b.current||null===w.current)return;let e=t.clientX-w.current;l(Number(Math.max(0,Math.min(1,C.current+.002*e)).toFixed(2)));},r=()=>{b.current=!1,w.current=null,document.body.style.userSelect=e,window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",r);};window.addEventListener("mousemove",i),window.addEventListener("mouseup",r);},style:{cursor:"ew-resize",userSelect:"none"},children:"Opacity"}),(0,n.jsx)("br",{}),(0,n.jsx)(tI.default,{min:0,max:1,step:.01,value:a,onChange:t=>l(Number(t||1)),style:{width:"100%"}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(tV.default.Text,{onMouseDown:t=>{if(0!==t.button)return;t.preventDefault(),m.current=!0,v.current=t.clientX,x.current=h;let e=document.body.style.userSelect;document.body.style.userSelect="none";let i=t=>{if(!m.current||null===v.current)return;let e=t.clientX-v.current;c(Number(Math.max(0,Math.min(200,x.current+.2*e)).toFixed(0)));},r=()=>{m.current=!1,v.current=null,document.body.style.userSelect=e,window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",r);};window.addEventListener("mousemove",i),window.addEventListener("mouseup",r);},style:{cursor:"ew-resize",userSelect:"none"},children:"Shadow Blur"}),(0,n.jsx)("br",{}),(0,n.jsx)(tI.default,{min:0,max:500,value:h,onChange:t=>c(Number(t||0)),style:{width:"100%"}})]})]})]});};var e1={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M697.8 481.4c33.6-35 54.2-82.3 54.2-134.3v-10.2C752 229.3 663.9 142 555.3 142H259.4c-15.1 0-27.4 12.3-27.4 27.4v679.1c0 16.3 13.2 29.5 29.5 29.5h318.7c117 0 211.8-94.2 211.8-210.5v-11c0-73-37.4-137.3-94.2-175.1zM328 238h224.7c57.1 0 103.3 44.4 103.3 99.3v9.5c0 54.8-46.3 99.3-103.3 99.3H328V238zm366.6 429.4c0 62.9-51.7 113.9-115.5 113.9H328V542.7h251.1c63.8 0 115.5 51 115.5 113.9v10.8z"}}]},name:"bold",theme:"outlined"},e2=o.forwardRef(function(t,e){return o.createElement(ti.default,(0,Q.default)((0,Q.default)({},t),{},{ref:e,icon:e1}));}),e5=i("83ea51ed"),e4=r._(e5),e3={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M824 804H200c-4.4 0-8 3.4-8 7.6v60.8c0 4.2 3.6 7.6 8 7.6h624c4.4 0 8-3.4 8-7.6v-60.8c0-4.2-3.6-7.6-8-7.6zm-312-76c69.4 0 134.6-27.1 183.8-76.2C745 602.7 772 537.4 772 468V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 97-79 176-176 176s-176-79-176-176V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 69.4 27.1 134.6 76.2 183.8C377.3 701 442.6 728 512 728z"}}]},name:"underline",theme:"outlined"},e6=o.forwardRef(function(t,e){return o.createElement(ti.default,(0,Q.default)((0,Q.default)({},t),{},{ref:e,icon:e3}));}),e8=i("711e1aa9"),e7=r._(e8),e9=i("16d526ba"),it=r._(e9),ie=i("1872ef2e"),ii=r._(ie);let ir=["Arial","Helvetica","Times New Roman","Georgia","Courier New","Verdana"],is=()=>{let{canvas:t,selectedObject:e,history:i,setActiveTool:r}=(0,y.usePhotoEditor)(),[s,a]=(0,o.useState)("Arial"),[l,h]=(0,o.useState)(24),[c,d]=(0,o.useState)(!1),[u,g]=(0,o.useState)(!1),[p,m]=(0,o.useState)(!1),[v,x]=(0,o.useState)("left"),[b,w]=(0,o.useState)("#000000");(0,o.useEffect)(()=>{e&&"i-text"===e.isType&&(a(e.fontFamily||"Arial"),h(e.fontSize||24),d("bold"===e.fontWeight||700===e.fontWeight),g("italic"===e.fontStyle),m(e.underline||!1),x(e.textAlign||"left"),w(e.fill||"#000000"));},[e]);let C=(r,s=!0)=>{e&&(e.set(r),e.setCoords&&e.setCoords(),t&&t.requestRenderAll(),s&&i&&i.saveState());};return(0,n.jsxs)("div",{style:{padding:12},children:[(0,n.jsx)("div",{style:{marginBottom:8},children:(0,n.jsx)("strong",{children:"Font"})}),(0,n.jsxs)(j.default,{direction:"vertical",style:{width:"100%"},children:[(0,n.jsx)(tC.default,{value:s,onChange:t=>{a(t),C({fontFamily:t});},style:{width:"100%"},children:ir.map(t=>(0,n.jsx)(tC.default.Option,{value:t,children:t},t))}),(0,n.jsx)(tI.default,{min:8,max:200,value:l,onChange:t=>{h(t||24),C({fontSize:t||24});},style:{width:"100%"}}),(0,n.jsx)("div",{children:(0,n.jsxs)(j.default,{children:[(0,n.jsx)(I.default,{icon:(0,n.jsx)(e2,{}),type:c?"primary":"default",onClick:()=>{let t=!c;d(t),C({fontWeight:t?"bold":"normal"});}}),(0,n.jsx)(I.default,{icon:(0,n.jsx)(e4.default,{}),type:u?"primary":"default",onClick:()=>{let t=!u;g(t),C({fontStyle:t?"italic":"normal"});}}),(0,n.jsx)(I.default,{icon:(0,n.jsx)(e6,{}),type:p?"primary":"default",onClick:()=>{let t=!p;m(t),C({underline:t});}})]})}),(0,n.jsx)(f.default,{}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Horizontal Align (textAlign)"}),(0,n.jsx)("div",{style:{marginTop:8},children:(0,n.jsxs)(j.default,{children:[(0,n.jsx)(I.default,{icon:(0,n.jsx)(e7.default,{}),type:"left"===v?"primary":"default",onClick:()=>{x("left"),C({textAlign:"left"});}}),(0,n.jsx)(I.default,{icon:(0,n.jsx)(it.default,{}),type:"center"===v?"primary":"default",onClick:()=>{x("center"),C({textAlign:"center"});}}),(0,n.jsx)(I.default,{icon:(0,n.jsx)(ii.default,{}),type:"right"===v?"primary":"default",onClick:()=>{x("right"),C({textAlign:"right"});}})]})})]}),(0,n.jsx)(f.default,{}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Color"}),(0,n.jsx)("div",{style:{marginTop:8},children:(0,n.jsx)(tS.default,{value:b,onChange:t=>{let i=t.toHexString();w(i),C({fill:i});try{(null==e?void 0:e.isEditing)&&r&&r("text");}catch(t){}},showText:!0})})]})]})]});},ia=()=>{let{canvas:t,selectedObject:e,history:i}=(0,y.usePhotoEditor)(),r=()=>{if(!t)return null;let e=t.getObjects();if(!e||0===e.length)return null;let i=e[0];try{return i.getBoundingRect();}catch(t){return null;}},s=r=>{e&&(e.set(r),e.setCoords&&e.setCoords(),t&&t.requestRenderAll(),i&&i.saveState());},a=i=>{if(!t||!e)return;let n=r();if(!n)return;let a=e.getBoundingRect(),o=e.left||0;"left"===i?o=n.left:"center"===i?o=n.left+(n.width-a.width)/2:"right"===i&&(o=n.left+n.width-a.width),s({left:o});},o=i=>{if(!t||!e)return;let n=r();if(!n)return;let a=e.getBoundingRect(),o=e.top||0;"top"===i?o=n.top:"middle"===i?o=n.top+(n.height-a.height)/2:"bottom"===i&&(o=n.top+n.height-a.height),s({top:o});};return(0,n.jsxs)("div",{style:{padding:12},children:[(0,n.jsx)("div",{style:{marginBottom:6},children:(0,n.jsx)("strong",{children:"Align to First Layer"})}),(0,n.jsx)("div",{style:{marginBottom:8},children:(0,n.jsxs)(j.default,{children:[(0,n.jsx)(I.default,{onClick:()=>a("left"),children:"H: Left"}),(0,n.jsx)(I.default,{onClick:()=>a("center"),children:"H: Center"}),(0,n.jsx)(I.default,{onClick:()=>a("right"),children:"H: Right"})]})}),(0,n.jsx)("div",{children:(0,n.jsxs)(j.default,{children:[(0,n.jsx)(I.default,{onClick:()=>o("top"),children:"V: Top"}),(0,n.jsx)(I.default,{onClick:()=>o("middle"),children:"V: Middle"}),(0,n.jsx)(I.default,{onClick:()=>o("bottom"),children:"V: Bottom"})]})})]});},{Title:io,Text:il}=tV.default,ih=()=>{let{canvas:t,selectedObject:e,history:i}=(0,y.usePhotoEditor)();if(!e||!t)return null;let r=(r,s)=>{e.set(r,s),t.requestRenderAll(),i.saveState();},s=e.strokeWidth||0,a=e.stroke||"#000000",o=e.fill||"transparent";return(0,n.jsxs)("div",{style:{padding:16},children:[(0,n.jsx)(io,{level:5,children:"Layer Style"}),(0,n.jsxs)(j.default,{direction:"vertical",style:{width:"100%"},size:"middle",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(il,{strong:!0,children:"Fill Color"}),(0,n.jsx)("div",{style:{marginTop:8},children:(0,n.jsx)(tS.default,{value:o,onChange:t=>r("fill",t.toHexString()),showText:!0})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(il,{strong:!0,children:"Border Color"}),(0,n.jsx)("div",{style:{marginTop:8},children:(0,n.jsx)(tS.default,{value:a,onChange:t=>r("stroke",t.toHexString()),showText:!0})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(il,{strong:!0,children:"Border Thickness"}),(0,n.jsxs)(t3.default,{gutter:16,align:"middle",children:[(0,n.jsx)(t8.default,{span:16,children:(0,n.jsx)(tx.default,{min:0,max:50,value:s,onChange:t=>r("strokeWidth",t)})}),(0,n.jsx)(t8.default,{span:8,children:(0,n.jsx)(tI.default,{min:0,max:50,value:s,onChange:t=>r("strokeWidth",Number(t)),style:{width:"100%"}})})]})]})]})]});},ic=()=>{let{activeTool:t,selectedObject:e}=(0,y.usePhotoEditor)();if("brush"===t)return(0,n.jsx)(e0,{});if("text"===t)return(0,n.jsx)(is,{});if(e&&("i-text"===e.type||"text"===e.type))return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(is,{}),(0,n.jsx)(ih,{}),(0,n.jsx)(ia,{})]});if(e){let t=e instanceof T.FabricImage||"image"===e.type;return(0,n.jsxs)(n.Fragment,{children:[t?(0,n.jsx)(eQ,{}):(0,n.jsx)(ih,{}),(0,n.jsx)(ia,{})]});}return(0,n.jsx)(eQ,{});};var id=i("95eb3634"),iu=r._(id),ig=i("4bff2451"),ip=r._(ig),im=i("f1001040"),iv=r._(im),ix=i("fc55d314"),iy=r._(ix),ib=i("43c5e36e"),iw=i("fbdbe203"),iC=i("3cc4ef99"),i_=i("44c4ae54"),iS=i("cc400268");i("15d1258b"),i("c7686553");var ij=i("6cab69b9");let iT=new i_.Keyframes("antStatusProcessing",{"0%":{transform:"scale(0.8)",opacity:.5},"100%":{transform:"scale(2.4)",opacity:0}}),ik=new i_.Keyframes("antZoomBadgeIn",{"0%":{transform:"scale(0) translate(50%, -50%)",opacity:0},"100%":{transform:"scale(1) translate(50%, -50%)"}}),iO=new i_.Keyframes("antZoomBadgeOut",{"0%":{transform:"scale(1) translate(50%, -50%)"},"100%":{transform:"scale(0) translate(50%, -50%)",opacity:0}}),iM=new i_.Keyframes("antNoWrapperZoomBadgeIn",{"0%":{transform:"scale(0)",opacity:0},"100%":{transform:"scale(1)"}}),iD=new i_.Keyframes("antNoWrapperZoomBadgeOut",{"0%":{transform:"scale(1)"},"100%":{transform:"scale(0)",opacity:0}}),iE=new i_.Keyframes("antBadgeLoadingCircle",{"0%":{transformOrigin:"50%"},"100%":{transform:"translate(50%, -50%) rotate(360deg)",transformOrigin:"50%"}}),iA=t=>{let{componentCls:e,iconCls:i,antCls:r,badgeShadowSize:s,textFontSize:n,textFontSizeSM:a,statusSize:o,dotSize:l,textFontWeight:h,indicatorHeight:c,indicatorHeightSM:d,marginXS:u,calc:g}=t,f=`${r}-scroll-number`,p=(0,ij.genPresetColor)(t,(t,{darkColor:i})=>({[`&${e} ${e}-color-${t}`]:{background:i,[`&:not(${e}-count)`]:{color:i},"a:hover &":{background:i}}}));return{[e]:Object.assign(Object.assign(Object.assign(Object.assign({},(0,iS.resetComponent)(t)),{position:"relative",display:"inline-block",width:"fit-content",lineHeight:1,[`${e}-count`]:{display:"inline-flex",justifyContent:"center",zIndex:t.indicatorZIndex,minWidth:c,height:c,color:t.badgeTextColor,fontWeight:h,fontSize:n,lineHeight:(0,i_.unit)(c),whiteSpace:"nowrap",textAlign:"center",background:t.badgeColor,borderRadius:g(c).div(2).equal(),boxShadow:`0 0 0 ${(0,i_.unit)(s)} ${t.badgeShadowColor}`,transition:`background ${t.motionDurationMid}`,a:{color:t.badgeTextColor},"a:hover":{color:t.badgeTextColor},"a:hover &":{background:t.badgeColorHover}},[`${e}-count-sm`]:{minWidth:d,height:d,fontSize:a,lineHeight:(0,i_.unit)(d),borderRadius:g(d).div(2).equal()},[`${e}-multiple-words`]:{padding:`0 ${(0,i_.unit)(t.paddingXS)}`,bdi:{unicodeBidi:"plaintext"}},[`${e}-dot`]:{zIndex:t.indicatorZIndex,width:l,minWidth:l,height:l,background:t.badgeColor,borderRadius:"100%",boxShadow:`0 0 0 ${(0,i_.unit)(s)} ${t.badgeShadowColor}`},[`${e}-count, ${e}-dot, ${f}-custom-component`]:{position:"absolute",top:0,insetInlineEnd:0,transform:"translate(50%, -50%)",transformOrigin:"100% 0%",[`&${i}-spin`]:{animationName:iE,animationDuration:"1s",animationIterationCount:"infinite",animationTimingFunction:"linear"}},[`&${e}-status`]:{lineHeight:"inherit",verticalAlign:"baseline",[`${e}-status-dot`]:{position:"relative",top:-1,display:"inline-block",width:o,height:o,verticalAlign:"middle",borderRadius:"50%"},[`${e}-status-success`]:{backgroundColor:t.colorSuccess},[`${e}-status-processing`]:{overflow:"visible",color:t.colorInfo,backgroundColor:t.colorInfo,borderColor:"currentcolor","&::after":{position:"absolute",top:0,insetInlineStart:0,width:"100%",height:"100%",borderWidth:s,borderStyle:"solid",borderColor:"inherit",borderRadius:"50%",animationName:iT,animationDuration:t.badgeProcessingDuration,animationIterationCount:"infinite",animationTimingFunction:"ease-in-out",content:'""'}},[`${e}-status-default`]:{backgroundColor:t.colorTextPlaceholder},[`${e}-status-error`]:{backgroundColor:t.colorError},[`${e}-status-warning`]:{backgroundColor:t.colorWarning},[`${e}-status-text`]:{marginInlineStart:u,color:t.colorText,fontSize:t.fontSize}}}),p),{[`${e}-zoom-appear, ${e}-zoom-enter`]:{animationName:ik,animationDuration:t.motionDurationSlow,animationTimingFunction:t.motionEaseOutBack,animationFillMode:"both"},[`${e}-zoom-leave`]:{animationName:iO,animationDuration:t.motionDurationSlow,animationTimingFunction:t.motionEaseOutBack,animationFillMode:"both"},[`&${e}-not-a-wrapper`]:{[`${e}-zoom-appear, ${e}-zoom-enter`]:{animationName:iM,animationDuration:t.motionDurationSlow,animationTimingFunction:t.motionEaseOutBack},[`${e}-zoom-leave`]:{animationName:iD,animationDuration:t.motionDurationSlow,animationTimingFunction:t.motionEaseOutBack},[`&:not(${e}-status)`]:{verticalAlign:"middle"},[`${f}-custom-component, ${e}-count`]:{transform:"none"},[`${f}-custom-component, ${f}`]:{position:"relative",top:"auto",display:"block",transformOrigin:"50% 50%"}},[f]:{overflow:"hidden",transition:`all ${t.motionDurationMid} ${t.motionEaseOutBack}`,[`${f}-only`]:{position:"relative",display:"inline-block",height:c,transition:`all ${t.motionDurationSlow} ${t.motionEaseOutBack}`,WebkitTransformStyle:"preserve-3d",WebkitBackfaceVisibility:"hidden",[`> p${f}-only-unit`]:{height:c,margin:0,WebkitTransformStyle:"preserve-3d",WebkitBackfaceVisibility:"hidden"}},[`${f}-symbol`]:{verticalAlign:"top"}},"&-rtl":{direction:"rtl",[`${e}-count, ${e}-dot, ${f}-custom-component`]:{transform:"translate(-50%, -50%)"}}})};},iP=t=>{let{fontHeight:e,lineWidth:i,marginXS:r,colorBorderBg:s}=t,n=t.colorTextLightSolid,a=t.colorError,o=t.colorErrorHover;return(0,ij.mergeToken)(t,{badgeFontHeight:e,badgeShadowSize:i,badgeTextColor:n,badgeColor:a,badgeColorHover:o,badgeShadowColor:s,badgeProcessingDuration:"1.2s",badgeRibbonOffset:r,badgeRibbonCornerTransform:"scaleY(0.75)",badgeRibbonCornerFilter:"brightness(75%)"});},iF=t=>{let{fontSize:e,lineHeight:i,fontSizeSM:r,lineWidth:s}=t;return{indicatorZIndex:"auto",indicatorHeight:Math.round(e*i)-2*s,indicatorHeightSM:e,dotSize:r/2,textFontSize:r,textFontSizeSM:r,textFontWeight:"normal",statusSize:r/2};};var iR=(0,ij.genStyleHooks)("Badge",t=>iA(iP(t)),iF);let iL=t=>{let{antCls:e,badgeFontHeight:i,marginXS:r,badgeRibbonOffset:s,calc:n}=t,a=`${e}-ribbon`,o=`${e}-ribbon-wrapper`,l=(0,ij.genPresetColor)(t,(t,{darkColor:e})=>({[`&${a}-color-${t}`]:{background:e,color:e}}));return{[o]:{position:"relative"},[a]:Object.assign(Object.assign(Object.assign(Object.assign({},(0,iS.resetComponent)(t)),{position:"absolute",top:r,padding:`0 ${(0,i_.unit)(t.paddingXS)}`,color:t.colorPrimary,lineHeight:(0,i_.unit)(i),whiteSpace:"nowrap",backgroundColor:t.colorPrimary,borderRadius:t.borderRadiusSM,[`${a}-text`]:{color:t.badgeTextColor},[`${a}-corner`]:{position:"absolute",top:"100%",width:s,height:s,color:"currentcolor",border:`${(0,i_.unit)(n(s).div(2).equal())} solid`,transform:t.badgeRibbonCornerTransform,transformOrigin:"top",filter:t.badgeRibbonCornerFilter}}),l),{[`&${a}-placement-end`]:{insetInlineEnd:n(s).mul(-1).equal(),borderEndEndRadius:0,[`${a}-corner`]:{insetInlineEnd:0,borderInlineEndColor:"transparent",borderBlockEndColor:"transparent"}},[`&${a}-placement-start`]:{insetInlineStart:n(s).mul(-1).equal(),borderEndStartRadius:0,[`${a}-corner`]:{insetInlineStart:0,borderBlockEndColor:"transparent",borderInlineStartColor:"transparent"}},"&-rtl":{direction:"rtl"}})};};var iI=(0,ij.genStyleHooks)(["Badge","Ribbon"],t=>iL(iP(t)),iF);let iB=t=>{let e;let{prefixCls:i,value:r,current:s,offset:n=0}=t;return n&&(e={position:"absolute",top:`${n}00%`,left:0}),o.createElement("span",{style:e,className:(0,iv.default)(`${i}-only-unit`,{current:s})},r);},iW=t=>{let e,i;let{prefixCls:r,count:s,value:n}=t,a=Number(n),l=Math.abs(s),[h,c]=o.useState(a),[d,u]=o.useState(l),g=()=>{c(a),u(l);};if(o.useEffect(()=>{let t=setTimeout(g,1e3);return()=>clearTimeout(t);},[a]),h===a||Number.isNaN(a)||Number.isNaN(h))e=[o.createElement(iB,Object.assign({},t,{key:a,current:!0}))],i={transition:"none"};else{e=[];let r=a+10,s=[];for(let t=a;t<=r;t+=1)s.push(t);let n=d<l?1:-1,c=s.findIndex(t=>t%10===h);e=(n<0?s.slice(0,c+1):s.slice(c)).map((e,i)=>o.createElement(iB,Object.assign({},t,{key:e,value:e%10,offset:n<0?i-c:i,current:i===c}))),i={transform:`translateY(${-function(t,e,i){let r=t,s=0;for(;(r+10)%10!==e;)r+=i,s+=i;return s;}(h,a,n)}00%)`};}return o.createElement("span",{className:`${r}-only`,style:i,onTransitionEnd:g},e);};var iX=this&&this.__rest||function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&0>e.indexOf(r)&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)0>e.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(i[r[s]]=t[r[s]]);return i;};let iY=o.forwardRef((t,e)=>{let{prefixCls:i,count:r,className:s,motionClassName:n,style:a,title:l,show:h,component:c="sup",children:d}=t,u=iX(t,["prefixCls","count","className","motionClassName","style","title","show","component","children"]),{getPrefixCls:g}=o.useContext(iC.ConfigContext),f=g("scroll-number",i),p=Object.assign(Object.assign({},u),{"data-show":h,style:a,className:(0,iv.default)(f,s,n),title:l}),m=r;if(r&&Number(r)%1==0){let t=String(r).split("");m=o.createElement("bdi",null,t.map((e,i)=>o.createElement(iW,{prefixCls:f,count:Number(r),value:e,key:t.length-i})));}return((null==a?void 0:a.borderColor)&&(p.style=Object.assign(Object.assign({},a),{boxShadow:`0 0 0 1px ${a.borderColor} inset`})),d)?(0,iw.cloneElement)(d,t=>({className:(0,iv.default)(`${f}-custom-component`,null==t?void 0:t.className,n)})):o.createElement(c,Object.assign({},p,{ref:e}),m);});var iz=this&&this.__rest||function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&0>e.indexOf(r)&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)0>e.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(i[r[s]]=t[r[s]]);return i;};let iV=o.forwardRef((t,e)=>{var i,r,s,n,a;let{prefixCls:l,scrollNumberPrefixCls:h,children:c,status:d,text:u,color:g,count:f=null,overflowCount:p=99,dot:m=!1,size:v="default",title:x,offset:y,style:b,className:w,rootClassName:C,classNames:_,styles:S,showZero:j=!1}=t,T=iz(t,["prefixCls","scrollNumberPrefixCls","children","status","text","color","count","overflowCount","dot","size","title","offset","style","className","rootClassName","classNames","styles","showZero"]),{getPrefixCls:k,direction:O,badge:M}=o.useContext(iC.ConfigContext),D=k("badge",l),[E,A,P]=iR(D),F=f>p?`${p}+`:f,R="0"===F||0===F||"0"===u||0===u,L=null===f||R&&!j,I=(null!=d||null!=g)&&L,B=null!=d||!R,W=m&&!R,X=W?"":F,Y=(0,o.useMemo)(()=>((null==X||""===X)&&(null==u||""===u)||R&&!j)&&!W,[X,R,j,W,u]),z=(0,o.useRef)(f);Y||(z.current=f);let V=z.current,N=(0,o.useRef)(X);Y||(N.current=X);let H=N.current,G=(0,o.useRef)(W);Y||(G.current=W);let U=(0,o.useMemo)(()=>{if(!y)return Object.assign(Object.assign({},null==M?void 0:M.style),b);let t={marginTop:y[1]};return"rtl"===O?t.left=Number.parseInt(y[0],10):t.right=-Number.parseInt(y[0],10),Object.assign(Object.assign(Object.assign({},t),null==M?void 0:M.style),b);},[O,y,b,null==M?void 0:M.style]),$=null!=x?x:"string"==typeof V||"number"==typeof V?V:void 0,q=!Y&&(0===u?j:!!u&&!0!==u),K=q?o.createElement("span",{className:`${D}-status-text`},u):null,J=V&&"object"==typeof V?(0,iw.cloneElement)(V,t=>({style:Object.assign(Object.assign({},U),t.style)})):void 0,Z=(0,ib.isPresetColor)(g,!1),Q=(0,iv.default)(null==_?void 0:_.indicator,null===(i=null==M?void 0:M.classNames)||void 0===i?void 0:i.indicator,{[`${D}-status-dot`]:I,[`${D}-status-${d}`]:!!d,[`${D}-color-${g}`]:Z}),tt={};g&&!Z&&(tt.color=g,tt.background=g);let te=(0,iv.default)(D,{[`${D}-status`]:I,[`${D}-not-a-wrapper`]:!c,[`${D}-rtl`]:"rtl"===O},w,C,null==M?void 0:M.className,null===(r=null==M?void 0:M.classNames)||void 0===r?void 0:r.root,null==_?void 0:_.root,A,P);if(!c&&I&&(u||B||!L)){let t=U.color;return E(o.createElement("span",Object.assign({},T,{className:te,style:Object.assign(Object.assign(Object.assign({},null==S?void 0:S.root),null===(s=null==M?void 0:M.styles)||void 0===s?void 0:s.root),U)}),o.createElement("span",{className:Q,style:Object.assign(Object.assign(Object.assign({},null==S?void 0:S.indicator),null===(n=null==M?void 0:M.styles)||void 0===n?void 0:n.indicator),tt)}),q&&o.createElement("span",{style:{color:t},className:`${D}-status-text`},u)));}return E(o.createElement("span",Object.assign({ref:e},T,{className:te,style:Object.assign(Object.assign({},null===(a=null==M?void 0:M.styles)||void 0===a?void 0:a.root),null==S?void 0:S.root)}),c,o.createElement(iy.default,{visible:!Y,motionName:`${D}-zoom`,motionAppear:!1,motionDeadline:1e3},({className:t})=>{var e,i;let r=k("scroll-number",h),s=G.current,n=(0,iv.default)(null==_?void 0:_.indicator,null===(e=null==M?void 0:M.classNames)||void 0===e?void 0:e.indicator,{[`${D}-dot`]:s,[`${D}-count`]:!s,[`${D}-count-sm`]:"small"===v,[`${D}-multiple-words`]:!s&&H&&H.toString().length>1,[`${D}-status-${d}`]:!!d,[`${D}-color-${g}`]:Z}),a=Object.assign(Object.assign(Object.assign({},null==S?void 0:S.indicator),null===(i=null==M?void 0:M.styles)||void 0===i?void 0:i.indicator),U);return g&&!Z&&((a=a||{}).background=g),o.createElement(iY,{prefixCls:r,show:!Y,motionClassName:t,className:n,count:H,title:$,style:a,key:"scrollNumber"},J);}),K));});iV.Ribbon=t=>{let{className:e,prefixCls:i,style:r,color:s,children:n,text:a,placement:l="end",rootClassName:h}=t,{getPrefixCls:c,direction:d}=o.useContext(iC.ConfigContext),u=c("ribbon",i),g=`${u}-wrapper`,[f,p,m]=iI(u,g),v=(0,ib.isPresetColor)(s,!1),x=(0,iv.default)(u,`${u}-placement-${l}`,{[`${u}-rtl`]:"rtl"===d,[`${u}-color-${s}`]:v},e),y={},b={};return s&&!v&&(y.background=s,b.color=s),f(o.createElement("div",{className:(0,iv.default)(g,h,p,m)},n,o.createElement("div",{className:(0,iv.default)(x,p),style:Object.assign(Object.assign({},y),r)},o.createElement("span",{className:`${u}-text`},a),o.createElement("div",{className:`${u}-corner`,style:b}))));};var iN=i("9b568971"),iH=r._(iN),iG=i("307bc145"),iU=r._(iG),i$=o.forwardRef(function(t,e){return o.createElement(ti.default,(0,Q.default)((0,Q.default)({},t),{},{ref:e,icon:iU.default}));});let{Text:iq}=tV.default,iK=({entries:t,currentIndex:e,onGoToEntry:i,onUndo:r,onRedo:s,canUndo:a,canRedo:l,isProcessing:h})=>{let c=t=>new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),d=(t,e)=>t.description?t.description:0===e?"Initial state":t.snapshot?"Snapshot":"Change",u=(0,o.useMemo)(()=>t.map((t,e)=>({entry:t,originalIndex:e})).reverse(),[t]);return(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%",background:"#fff",borderRadius:8,overflow:"hidden"},children:[(0,n.jsxs)("div",{style:{padding:"12px 16px",borderBottom:"1px solid #f0f0f0",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)(iH.default,{}),(0,n.jsx)(iq,{strong:!0,children:"History"}),(0,n.jsx)(iV,{count:t.length,size:"small",style:{backgroundColor:"#1890ff"}})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:4},children:[(0,n.jsx)(W.default,{title:"Undo (Ctrl+Z)",children:(0,n.jsx)(I.default,{size:"small",icon:(0,n.jsx)(tT.default,{}),onClick:r,disabled:!a||h})}),(0,n.jsx)(W.default,{title:"Redo (Ctrl+Y)",children:(0,n.jsx)(I.default,{size:"small",icon:(0,n.jsx)(tO.default,{}),onClick:s,disabled:!l||h})})]})]}),(0,n.jsx)("div",{style:{flex:1,overflow:"auto",padding:"8px 0"},children:0===t.length?(0,n.jsx)(ip.default,{image:ip.default.PRESENTED_IMAGE_SIMPLE,description:"No history yet",style:{margin:"40px 0"}}):(0,n.jsx)(iu.default,{size:"small",dataSource:u,renderItem:({entry:t,originalIndex:r})=>{let s=r===e,a=r<e;return(0,n.jsx)(iu.default.Item,{onClick:()=>!h&&i(t.id),style:{cursor:h?"not-allowed":"pointer",padding:"8px 16px",background:s?"#e6f7ff":a?"#fafafa":"transparent",borderLeft:s?"3px solid #1890ff":"3px solid transparent",opacity:h?.5:1,transition:"all 0.2s"},onMouseEnter:t=>{s||h||(t.currentTarget.style.background="#f5f5f5");},onMouseLeave:t=>{s||(t.currentTarget.style.background=a?"#fafafa":"transparent");},children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,width:"100%"},children:[t.thumbnail?(0,n.jsx)("img",{src:t.thumbnail,alt:"",style:{width:40,height:40,objectFit:"cover",borderRadius:4,border:"1px solid #d9d9d9"}}):(0,n.jsx)("div",{style:{width:40,height:40,background:"#f0f0f0",borderRadius:4,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,n.jsx)(iH.default,{style:{color:"#999"}})}),(0,n.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,n.jsx)(iq,{strong:s,style:{fontSize:12,color:a&&!s?"#999":"inherit"},ellipsis:!0,children:d(t,r)}),s&&(0,n.jsx)(i$,{style:{color:"#1890ff",fontSize:12}})]}),(0,n.jsx)(iq,{type:"secondary",style:{fontSize:11},children:c(t.timestamp)})]}),(0,n.jsxs)(iq,{type:"secondary",style:{fontSize:10,background:"#f0f0f0",padding:"2px 6px",borderRadius:10},children:["#",r+1]})]})});}})}),(0,n.jsx)("div",{style:{padding:"8px 16px",borderTop:"1px solid #f0f0f0",background:"#fafafa"},children:(0,n.jsxs)(iq,{type:"secondary",style:{fontSize:11},children:[e+1," / ",t.length," states"]})})]});};var iJ=i("ad84e91c"),iZ=r._(iJ),iQ=i("3655eb30"),i0=r._(iQ),i1=i("9b2b4ad9"),i2=r._(i1);let{Paragraph:i5,Text:i4}=tV.default;class i3 extends o.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null};}static getDerivedStateFromError(t){return{hasError:!0,error:t};}componentDidCatch(t,e){var i,r;this.setState({errorInfo:e}),console.error("PhotoEditor Error:",t),console.error("Component Stack:",e.componentStack),null===(i=(r=this.props).onError)||void 0===i||i.call(r,t,e);}handleReset=()=>{var t,e;this.setState({hasError:!1,error:null,errorInfo:null}),null===(t=(e=this.props).onReset)||void 0===t||t.call(e);};handleReload=()=>{window.location.reload();};render(){if(this.state.hasError){var t;return this.props.fallback?this.props.fallback:(0,n.jsx)(iZ.default,{status:"error",title:"Something went wrong",subTitle:"An error occurred in the Photo Editor. You can try to recover or reload the page.",icon:(0,n.jsx)(i0.default,{style:{color:"#ff4d4f"}}),extra:[(0,n.jsx)(I.default,{type:"primary",onClick:this.handleReset,children:"Try Again"},"retry"),(0,n.jsx)(I.default,{icon:(0,n.jsx)(i2.default,{}),onClick:this.handleReload,children:"Reload Page"},"reload")],children:(0,n.jsxs)("div",{style:{textAlign:"left"},children:[(0,n.jsx)(i5,{children:(0,n.jsx)(i4,{strong:!0,style:{fontSize:16},children:"Error Details:"})}),(0,n.jsx)(i5,{children:(0,n.jsx)(i4,{code:!0,children:(null===(t=this.state.error)||void 0===t?void 0:t.message)||"Unknown error"})}),!1]})});}return this.props.children;}}let{Sider:i6,Content:i8}=w.default,{Panel:i7}=_.default,i9=()=>{let{history:t}=(0,y.usePhotoEditor)();return(0,n.jsx)(i3,{children:(0,n.jsxs)(w.default,{style:{height:"100%"},children:[(0,n.jsx)(i6,{theme:"light",width:60,className:"toolbarSider-ECMIrGgY",children:(0,n.jsx)(eD,{})}),(0,n.jsx)(i8,{className:"canvasContent-Lj9buPhs",children:(0,n.jsx)(eA,{})}),(0,n.jsxs)(i6,{theme:"light",width:300,className:"propertiesSider-YRVduwgD",children:[(0,n.jsx)(ic,{}),(0,n.jsxs)(_.default,{defaultActiveKey:["layers"],bordered:!1,style:{background:"transparent"},children:[(0,n.jsx)(i7,{header:"Layers",style:{padding:0},children:(0,n.jsx)(eq,{})},"layers"),(0,n.jsx)(i7,{header:"History",style:{padding:0},children:(0,n.jsx)("div",{style:{overflow:"hidden"},children:(0,n.jsx)(iK,{entries:t.entries,currentIndex:t.currentIndex,onGoToEntry:t.goToEntry,onUndo:t.undo,onRedo:t.redo,canUndo:t.canUndo,canRedo:t.canRedo,isProcessing:t.isProcessing})})},"history")]})]})]})});};var rt=i("34f06567"),re=r._(rt),ri=i("e21451ef"),rr=r._(ri);let rs=({onUpload:t})=>(0,n.jsxs)(re.default.Dragger,{beforeUpload:t,showUploadList:!1,accept:".png,.jpg,.jpeg",height:200,children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(rr.default,{})}),(0,n.jsx)("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),(0,n.jsx)("p",{className:"ant-upload-hint",children:"Support for a single upload. You can also paste an image from clipboard."})]});var rn=i("d7b66386"),ra=r._(rn);let ro=()=>{let[t,e]=(0,o.useState)(null),[i,r]=(0,o.useState)(null),[s,n]=(0,o.useState)(null),[a,l]=(0,o.useState)(!1),h=(0,o.useRef)(0),c=(0,o.useCallback)(i=>{let s=new FileReader;return s.onload=s=>{if(t)n(i);else{var a;e(null===(a=s.target)||void 0===a?void 0:a.result),r(null);}},s.readAsDataURL(i),l(!1),h.current=0,!1;},[t]),d=(0,o.useCallback)(t=>{r(t),e(t.thumbnail);},[]),u=(0,o.useCallback)(()=>{e(null),n(null),r(null),O.default.info("Image cleared.");},[]);return(0,o.useEffect)(()=>{let t=t=>{var e;let i=null===(e=t.clipboardData)||void 0===e?void 0:e.items;if(!i)return;let r=Array.from(i).find(t=>t.type.includes("image"));if(r){let e=r.getAsFile();e&&(c(e),O.default.success("Image pasted from clipboard!"),t.preventDefault());}};return window.addEventListener("paste",t),()=>window.removeEventListener("paste",t);},[c]),{preview:t,setPreview:e,addOnFile:s,setAddOnFile:n,dragging:a,setDragging:l,dragCounter:h,handleUpload:c,handleClear:u,loadProject:d,initialProject:i};},rl=()=>{let{preview:t,dragging:e,setDragging:i,dragCounter:r,handleUpload:s,addOnFile:a,setAddOnFile:o,loadProject:h,initialProject:d}=ro(),{savedProjects:g,deleteProject:p}=F();return(0,n.jsx)(l.PageContainer,{title:(0,n.jsxs)("span",{children:["Photo Editor ",(0,n.jsx)(u.default,{color:"cyan",children:"Beta"})]}),children:(0,n.jsx)(m.default,{setDragging:i,dragCounter:r,handleUpload:s,children:(0,n.jsxs)(c.default,{className:"editorContainer-SPg3koCD",bodyStyle:{padding:0,height:"100%"},children:[e&&(0,n.jsx)(x.default,{}),t?(0,n.jsx)(y.PhotoEditorProvider,{imageUrl:t,initialProject:d,addOnFile:a,setAddOnFile:o,children:(0,n.jsx)(i9,{})}):(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%",padding:"20px",overflowY:"auto"},children:[(0,n.jsx)(rs,{onUpload:s}),g.length>0&&(0,n.jsxs)("div",{style:{width:"100%",maxWidth:"800px",marginTop:"40px"},children:[(0,n.jsx)(f.default,{children:"Or Open Saved Project"}),(0,n.jsx)(ra.default,{projects:g,onLoad:h,onDelete:p})]})]})]})})});};},"4e1dc2f8":function(t,e,i){"use strict";let r,s,n,a;function o(t,e,i){var r;return(e="symbol"==typeof(r=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.");}return("string"===e?String:Number)(t);}(e,"string"))?r:r+"")in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t;}function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable;})),i.push.apply(i,r);}return i;}function h(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach(function(e){o(t,e,i[e]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e));});}return t;}function c(t,e){if(null==t)return{};var i,r,s=function(t,e){if(null==t)return{};var i={};for(var r in t)if(({}).hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;i[r]=t[r];}return i;}(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(r=0;r<n.length;r++)i=n[r],e.indexOf(i)>=0||({}).propertyIsEnumerable.call(t,i)&&(s[i]=t[i]);}return s;}function d(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}));}i.d(e,"__esModule",{value:!0}),i.e(e,{ActiveSelection:function(){return nN;},BaseBrush:function(){return s8;},BaseFabricObject:function(){return iz;},Canvas:function(){return sU;},Canvas2dFilterBackend:function(){return nH;},CanvasDOMManager:function(){return sB;},Circle:function(){return ns;},CircleBrush:function(){return nn;},ClipPathLayout:function(){return nY;},Color:function(){return ek;},Control:function(){return i$;},Ellipse:function(){return nf;},FabricImage:function(){return nZ;},FabricObject:function(){return ru;},FabricText:function(){return nj;},FitContentLayout:function(){return r3;},FixedLayout:function(){return nz;},Gradient:function(){return s4;},Group:function(){return si;},IText:function(){return nW;},Image:function(){return nZ;},InteractiveFabricObject:function(){return rc;},Intersection:function(){return iB;},LayoutManager:function(){return r9;},LayoutStrategy:function(){return r4;},Line:function(){return nd;},Object:function(){return ru;},Observable:function(){return tr;},Path:function(){return nt;},Pattern:function(){return s6;},PatternBrush:function(){return no;},PencilBrush:function(){return ne;},Point:function(){return to;},Polygon:function(){return ny;},Polyline:function(){return nx;},Rect:function(){return rZ;},Shadow:function(){return is;},SprayBrush:function(){return na;},StaticCanvas:function(){return t4;},StaticCanvasDOMManager:function(){return t1;},Text:function(){return nj;},Textbox:function(){return nX;},Triangle:function(){return nu;},WebGLFilterBackend:function(){return nG;},cache:function(){return j;},classRegistry:function(){return te;},config:function(){return g;},controlsUtils:function(){return af;},createCollectionMixin:function(){return tc;},filters:function(){return a5;},getCSSRules:function(){return n6;},getEnv:function(){return w;},getFabricDocument:function(){return C;},getFabricWindow:function(){return _;},getFilterBackend:function(){return n$;},iMatrix:function(){return E;},initFilterBackend:function(){return nU;},isPutImageFaster:function(){return am;},isWebGLPipelineState:function(){return ap;},loadSVGFromString:function(){return ai;},loadSVGFromURL:function(){return ar;},parseAttributes:function(){return rq;},parseFontDeclaration:function(){return rH;},parsePointsAttribute:function(){return np;},parseSVGDocument:function(){return ae;},parseStyleAttribute:function(){return rU;},parseTransformAttribute:function(){return rN;},runningAnimations:function(){return ti;},setEnv:function(){return b;},setFilterBackend:function(){return nq;},util:function(){return sI;},version:function(){return T;}});class u{constructor(){o(this,"browserShadowBlurConstant",1),o(this,"DPI",96),o(this,"devicePixelRatio","undefined"!=typeof window?window.devicePixelRatio:1),o(this,"perfLimitSizeTotal",2097152),o(this,"maxCacheSideLimit",4096),o(this,"minCacheSideLimit",256),o(this,"disableStyleCopyPaste",!1),o(this,"enableGLFiltering",!0),o(this,"textureSize",4096),o(this,"forceGLPutImageData",!1),o(this,"cachesBoundsOfCurve",!1),o(this,"fontPaths",{}),o(this,"NUM_FRACTION_DIGITS",4);}}let g=new class extends u{constructor(t){super(),this.configure(t);}configure(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,t);}addFonts(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fontPaths=h(h({},this.fontPaths),t);}removeFonts(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(t=>{delete this.fontPaths[t];});}clearFonts(){this.fontPaths={};}restoreDefaults(t){let e=new u,i=(null==t?void 0:t.reduce((t,i)=>(t[i]=e[i],t),{}))||e;this.configure(i);}},f=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return console[t]("fabric",...i);};class p extends Error{constructor(t,e){super("fabric: ".concat(t),e);}}class m extends p{constructor(t){super("".concat(t," 'options.signal' is in 'aborted' state"));}}class v{}class x extends v{testPrecision(t,e){let i=t.createShader(t.FRAGMENT_SHADER);return!!i&&(t.shaderSource(i,"precision ".concat(e," float;\nvoid main(){}")),t.compileShader(i),!!t.getShaderParameter(i,t.COMPILE_STATUS));}queryWebGL(t){let e=t.getContext("webgl");e&&(this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find(t=>this.testPrecision(e,t)),e.getExtension("WEBGL_lose_context").loseContext(),f("log","WebGL: max texture size ".concat(this.maxTextureSize)));}isSupported(t){return!!this.maxTextureSize&&this.maxTextureSize>=t;}}let y={},b=t=>{r=t;},w=()=>r||(r={document:document,window:window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new x,dispose(){},copyPasteData:y}),C=()=>w().document,_=()=>w().window,S=()=>{var t;return Math.max(null!==(t=g.devicePixelRatio)&&void 0!==t?t:_().devicePixelRatio,1);},j=new class{constructor(){o(this,"boundsOfCurveCache",{}),this.charWidthsCache=new Map;}getFontCache(t){let{fontFamily:e,fontStyle:i,fontWeight:r}=t;e=e.toLowerCase();let s=this.charWidthsCache;s.has(e)||s.set(e,new Map);let n=s.get(e),a="".concat(i.toLowerCase(),"_").concat((r+"").toLowerCase());return n.has(a)||n.set(a,new Map),n.get(a);}clearFontCache(t){t?this.charWidthsCache.delete((t||"").toLowerCase()):this.charWidthsCache=new Map;}limitDimsByArea(t){let{perfLimitSizeTotal:e}=g,i=Math.sqrt(e*t);return[Math.floor(i),Math.floor(e/i)];}},T="6.9.1";function k(){}let O=Math.PI/2,M=2*Math.PI,D=Math.PI/180,E=Object.freeze([1,0,0,1,0,0]),A="center",P="left",F="bottom",R="right",L="none",I=/\r?\n/,B="moving",W="scaling",X="rotating",Y="rotate",z="skewing",V="resizing",N="modifyPoly",H="changed",G="scale",U="scaleX",$="scaleY",q="skewX",K="skewY",J="fill",Z="stroke",Q="modified",tt="json",te=new class{constructor(){this[tt]=new Map,this.svg=new Map;}has(t){return this[tt].has(t);}getClass(t){let e=this[tt].get(t);if(!e)throw new p("No class registered for ".concat(t));return e;}setClass(t,e){e?this[tt].set(e,t):(this[tt].set(t.type,t),this[tt].set(t.type.toLowerCase(),t));}getSVGClass(t){return this.svg.get(t);}setSVGClass(t,e){this.svg.set(null!=e?e:t.type.toLowerCase(),t);}},ti=new class extends Array{remove(t){let e=this.indexOf(t);e>-1&&this.splice(e,1);}cancelAll(){let t=this.splice(0);return t.forEach(t=>t.abort()),t;}cancelByCanvas(t){if(!t)return[];let e=this.filter(e=>{var i;return e.target===t||"object"==typeof e.target&&(null===(i=e.target)||void 0===i?void 0:i.canvas)===t;});return e.forEach(t=>t.abort()),e;}cancelByTarget(t){if(!t)return[];let e=this.filter(e=>e.target===t);return e.forEach(t=>t.abort()),e;}};class tr{constructor(){o(this,"__eventListeners",{});}on(t,e){return(this.__eventListeners||(this.__eventListeners={}),"object"==typeof t)?(Object.entries(t).forEach(t=>{let[e,i]=t;this.on(e,i);}),()=>this.off(t)):e?(this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e),()=>this.off(t,e)):()=>!1;}once(t,e){if("object"==typeof t){let e=[];return Object.entries(t).forEach(t=>{let[i,r]=t;e.push(this.once(i,r));}),()=>e.forEach(t=>t());}if(e){let i=this.on(t,function(){for(var t=arguments.length,r=Array(t),s=0;s<t;s++)r[s]=arguments[s];e.call(this,...r),i();});return i;}return()=>!1;}_removeEventListener(t,e){if(this.__eventListeners[t]){if(e){let i=this.__eventListeners[t],r=i.indexOf(e);r>-1&&i.splice(r,1);}else this.__eventListeners[t]=[];}}off(t,e){if(this.__eventListeners){if(void 0===t)for(let t in this.__eventListeners)this._removeEventListener(t);else"object"==typeof t?Object.entries(t).forEach(t=>{let[e,i]=t;this._removeEventListener(e,i);}):this._removeEventListener(t,e);}}fire(t,e){var i;if(!this.__eventListeners)return;let r=null===(i=this.__eventListeners[t])||void 0===i?void 0:i.concat();if(r)for(let t=0;t<r.length;t++)r[t].call(this,e||{});}}let ts=(t,e)=>{let i=t.indexOf(e);return -1!==i&&t.splice(i,1),t;},tn=t=>{if(0===t)return 1;switch(Math.abs(t)/O){case 1:case 3:return 0;case 2:return -1;}return Math.cos(t);},ta=t=>{if(0===t)return 0;let e=Math.sign(t);switch(t/O){case 1:return e;case 2:return 0;case 3:return-e;}return Math.sin(t);};class to{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e);}add(t){return new to(this.x+t.x,this.y+t.y);}addEquals(t){return this.x+=t.x,this.y+=t.y,this;}scalarAdd(t){return new to(this.x+t,this.y+t);}scalarAddEquals(t){return this.x+=t,this.y+=t,this;}subtract(t){return new to(this.x-t.x,this.y-t.y);}subtractEquals(t){return this.x-=t.x,this.y-=t.y,this;}scalarSubtract(t){return new to(this.x-t,this.y-t);}scalarSubtractEquals(t){return this.x-=t,this.y-=t,this;}multiply(t){return new to(this.x*t.x,this.y*t.y);}scalarMultiply(t){return new to(this.x*t,this.y*t);}scalarMultiplyEquals(t){return this.x*=t,this.y*=t,this;}divide(t){return new to(this.x/t.x,this.y/t.y);}scalarDivide(t){return new to(this.x/t,this.y/t);}scalarDivideEquals(t){return this.x/=t,this.y/=t,this;}eq(t){return this.x===t.x&&this.y===t.y;}lt(t){return this.x<t.x&&this.y<t.y;}lte(t){return this.x<=t.x&&this.y<=t.y;}gt(t){return this.x>t.x&&this.y>t.y;}gte(t){return this.x>=t.x&&this.y>=t.y;}lerp(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return e=Math.max(Math.min(1,e),0),new to(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e);}distanceFrom(t){let e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i);}midPointFrom(t){return this.lerp(t);}min(t){return new to(Math.min(this.x,t.x),Math.min(this.y,t.y));}max(t){return new to(Math.max(this.x,t.x),Math.max(this.y,t.y));}toString(){return"".concat(this.x,",").concat(this.y);}setXY(t,e){return this.x=t,this.y=e,this;}setX(t){return this.x=t,this;}setY(t){return this.y=t,this;}setFromPoint(t){return this.x=t.x,this.y=t.y,this;}swap(t){let e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i;}clone(){return new to(this.x,this.y);}rotate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tl,i=ta(t),r=tn(t),s=this.subtract(e);return new to(s.x*r-s.y*i,s.x*i+s.y*r).add(e);}transform(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new to(t[0]*this.x+t[2]*this.y+(e?0:t[4]),t[1]*this.x+t[3]*this.y+(e?0:t[5]));}}let tl=new to(0,0),th=t=>!!t&&Array.isArray(t._objects);function tc(t){class e extends t{constructor(){super(...arguments),o(this,"_objects",[]);}_onObjectAdded(t){}_onObjectRemoved(t){}_onStackOrderChanged(t){}add(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];let r=this._objects.push(...e);return e.forEach(t=>this._onObjectAdded(t)),r;}insertAt(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return this._objects.splice(t,0,...i),i.forEach(t=>this._onObjectAdded(t)),this._objects.length;}remove(){let t=this._objects,e=[];for(var i=arguments.length,r=Array(i),s=0;s<i;s++)r[s]=arguments[s];return r.forEach(i=>{let r=t.indexOf(i);-1!==r&&(t.splice(r,1),e.push(i),this._onObjectRemoved(i));}),e;}forEachObject(t){this.getObjects().forEach((e,i,r)=>t(e,i,r));}getObjects(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return 0===e.length?[...this._objects]:this._objects.filter(t=>t.isType(...e));}item(t){return this._objects[t];}isEmpty(){return 0===this._objects.length;}size(){return this._objects.length;}contains(t,i){return!!this._objects.includes(t)||!!i&&this._objects.some(i=>i instanceof e&&i.contains(t,!0));}complexity(){return this._objects.reduce((t,e)=>t+=e.complexity?e.complexity():0,0);}sendObjectToBack(t){return!(!t||t===this._objects[0])&&(ts(this._objects,t),this._objects.unshift(t),this._onStackOrderChanged(t),!0);}bringObjectToFront(t){return!(!t||t===this._objects[this._objects.length-1])&&(ts(this._objects,t),this._objects.push(t),this._onStackOrderChanged(t),!0);}sendObjectBackwards(t,e){if(!t)return!1;let i=this._objects.indexOf(t);if(0!==i){let r=this.findNewLowerIndex(t,i,e);return ts(this._objects,t),this._objects.splice(r,0,t),this._onStackOrderChanged(t),!0;}return!1;}bringObjectForward(t,e){if(!t)return!1;let i=this._objects.indexOf(t);if(i!==this._objects.length-1){let r=this.findNewUpperIndex(t,i,e);return ts(this._objects,t),this._objects.splice(r,0,t),this._onStackOrderChanged(t),!0;}return!1;}moveObjectTo(t,e){return t!==this._objects[e]&&(ts(this._objects,t),this._objects.splice(e,0,t),this._onStackOrderChanged(t),!0);}findNewLowerIndex(t,e,i){let r;if(i){r=e;for(let i=e-1;i>=0;--i)if(t.isOverlapping(this._objects[i])){r=i;break;}}else r=e-1;return r;}findNewUpperIndex(t,e,i){let r;if(i){r=e;for(let i=e+1;i<this._objects.length;++i)if(t.isOverlapping(this._objects[i])){r=i;break;}}else r=e+1;return r;}collectObjects(t){let{left:e,top:i,width:r,height:s}=t,{includeIntersecting:n=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=[],o=new to(e,i),l=o.add(new to(r,s));for(let t=this._objects.length-1;t>=0;t--){let e=this._objects[t];e.selectable&&e.visible&&(n&&e.intersectsWithRect(o,l)||e.isContainedWithinRect(o,l)||n&&e.containsPoint(o)||n&&e.containsPoint(l))&&a.push(e);}return a;}}return e;}class td extends tr{_setOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(let e in t)this.set(e,t[e]);}_setObject(t){for(let e in t)this._set(e,t[e]);}set(t,e){return"object"==typeof t?this._setObject(t):this._set(t,e),this;}_set(t,e){this[t]=e;}toggle(t){let e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this;}get(t){return this[t];}}function tu(t){return _().requestAnimationFrame(t);}function tg(t){return _().cancelAnimationFrame(t);}let tf=0,tp=()=>tf++,tm=()=>{let t=C().createElement("canvas");if(!t||void 0===t.getContext)throw new p("Failed to create `canvas` element");return t;},tv=()=>C().createElement("img"),tx=t=>{let e=tm();return e.width=t.width,e.height=t.height,e;},ty=(t,e,i)=>t.toDataURL("image/".concat(e),i),tb=(t,e,i)=>new Promise((r,s)=>{t.toBlob(r,"image/".concat(e),i);}),tw=t=>t*D,tC=t=>t/D,t_=t=>t.every((t,e)=>t===E[e]),tS=(t,e,i)=>new to(t).transform(e,i),tj=t=>{let e=1/(t[0]*t[3]-t[1]*t[2]),i=[e*t[3],-e*t[1],-e*t[2],e*t[0],0,0],{x:r,y:s}=new to(t[4],t[5]).transform(i,!0);return i[4]=-r,i[5]=-s,i;},tT=(t,e,i)=>[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]],tk=(t,e)=>t.reduceRight((t,i)=>i&&t?tT(i,t,e):i||t,void 0)||E.concat(),tO=t=>{let[e,i]=t;return Math.atan2(i,e);},tM=t=>{let e=tO(t),i=Math.pow(t[0],2)+Math.pow(t[1],2),r=Math.sqrt(i),s=(t[0]*t[3]-t[2]*t[1])/r,n=Math.atan2(t[0]*t[2]+t[1]*t[3],i);return{angle:tC(e),scaleX:r,scaleY:s,skewX:tC(n),skewY:0,translateX:t[4]||0,translateY:t[5]||0};},tD=function(t){return[1,0,0,1,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0];};function tE(){let{angle:t=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{x:e=0,y:i=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=tw(t),s=tn(r),n=ta(r);return[s,n,-n,s,e?e-(s*e-n*i):0,i?i-(n*e+s*i):0];}let tA=function(t){return[t,0,0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,0,0];},tP=t=>Math.tan(tw(t)),tF=t=>[1,0,tP(t),1,0,0],tR=t=>[1,tP(t),0,1,0,0],tL=t=>{let{scaleX:e=1,scaleY:i=1,flipX:r=!1,flipY:s=!1,skewX:n=0,skewY:a=0}=t,o=tA(r?-e:e,s?-i:i);return n&&(o=tT(o,tF(n),!0)),a&&(o=tT(o,tR(a),!0)),o;},tI=t=>{let{translateX:e=0,translateY:i=0,angle:r=0}=t,s=tD(e,i);r&&(s=tT(s,tE({angle:r})));let n=tL(t);return t_(n)||(s=tT(s,n)),s;},tB=function(t){let{signal:e,crossOrigin:i=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(r,s){let n;if(e&&e.aborted)return s(new m("loadImage"));let a=tv();e&&(n=function(t){a.src="",s(t);},e.addEventListener("abort",n,{once:!0}));let o=function(){a.onload=a.onerror=null,n&&(null==e||e.removeEventListener("abort",n)),r(a);};t?(a.onload=o,a.onerror=function(){n&&(null==e||e.removeEventListener("abort",n)),s(new p("Error loading ".concat(a.src)));},i&&(a.crossOrigin=i),a.src=t):o();});},tW=function(t){let{signal:e,reviver:i=k}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((r,s)=>{let n=[];e&&e.addEventListener("abort",s,{once:!0}),Promise.all(t.map(t=>te.getClass(t.type).fromObject(t,{signal:e}).then(e=>(i(t,e),n.push(e),e)))).then(r).catch(t=>{n.forEach(t=>{t.dispose&&t.dispose();}),s(t);}).finally(()=>{e&&e.removeEventListener("abort",s);});});},tX=function(t){let{signal:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((i,r)=>{let s=[];e&&e.addEventListener("abort",r,{once:!0});let n=Object.values(t).map(t=>t&&t.type&&te.has(t.type)?tW([t],{signal:e}).then(t=>{let[e]=t;return s.push(e),e;}):t),a=Object.keys(t);Promise.all(n).then(t=>t.reduce((t,e,i)=>(t[a[i]]=e,t),{})).then(i).catch(t=>{s.forEach(t=>{t.dispose&&t.dispose();}),r(t);}).finally(()=>{e&&e.removeEventListener("abort",r);});});},tY=function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce((e,i)=>(i in t&&(e[i]=t[i]),e),{});},tz=(t,e)=>Object.keys(t).reduce((i,r)=>(e(t[r],r,t)&&(i[r]=t[r]),i),{}),tV=(t,e)=>parseFloat(Number(t).toFixed(e)),tN=t=>"matrix("+t.map(t=>tV(t,g.NUM_FRACTION_DIGITS)).join(" ")+")",tH=t=>!!t&&void 0!==t.toLive,tG=t=>!!t&&"function"==typeof t.toObject,tU=t=>!!t&&void 0!==t.offsetX&&"source"in t,t$=t=>!!t&&"multiSelectionStacking"in t;function tq(t){let e=t&&tK(t),i=0,r=0;if(!t||!e)return{left:i,top:r};let s=t,n=e.documentElement,a=e.body||{scrollLeft:0,scrollTop:0};for(;s&&(s.parentNode||s.host)&&((s=s.parentNode||s.host)===e?(i=a.scrollLeft||n.scrollLeft||0,r=a.scrollTop||n.scrollTop||0):(i+=s.scrollLeft||0,r+=s.scrollTop||0),1!==s.nodeType||"fixed"!==s.style.position););return{left:i,top:r};}let tK=t=>t.ownerDocument||null,tJ=t=>{var e;return(null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)||null;},tZ=function(t,e,i){let{width:r,height:s}=i,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t.width=r,t.height=s,n>1&&(t.setAttribute("width",(r*n).toString()),t.setAttribute("height",(s*n).toString()),e.scale(n,n));},tQ=(t,e)=>{let{width:i,height:r}=e;i&&(t.style.width="number"==typeof i?"".concat(i,"px"):i),r&&(t.style.height="number"==typeof r?"".concat(r,"px"):r);};function t0(t){return void 0!==t.onselectstart&&(t.onselectstart=()=>!1),t.style.userSelect=L,t;}class t1{constructor(t){o(this,"_originalCanvasStyle",void 0),o(this,"lower",void 0);let e=this.createLowerCanvas(t);this.lower={el:e,ctx:e.getContext("2d")};}createLowerCanvas(t){let e=t&&void 0!==t.getContext?t:t&&C().getElementById(t)||tm();if(e.hasAttribute("data-fabric"))throw new p("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=e.style.cssText,e.setAttribute("data-fabric","main"),e.classList.add("lower-canvas"),e;}cleanupDOM(t){let{width:e,height:i}=t,{el:r}=this.lower;r.classList.remove("lower-canvas"),r.removeAttribute("data-fabric"),r.setAttribute("width","".concat(e)),r.setAttribute("height","".concat(i)),r.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0;}setDimensions(t,e){let{el:i,ctx:r}=this.lower;tZ(i,r,t,e);}setCSSDimensions(t){tQ(this.lower.el,t);}calcOffset(){return function(t){var e;let i=t&&tK(t),r={left:0,top:0};if(!i)return r;let s=(null===(e=tJ(t))||void 0===e?void 0:e.getComputedStyle(t,null))||{};r.left+=parseInt(s.borderLeftWidth,10)||0,r.top+=parseInt(s.borderTopWidth,10)||0,r.left+=parseInt(s.paddingLeft,10)||0,r.top+=parseInt(s.paddingTop,10)||0;let n={left:0,top:0},a=i.documentElement;void 0!==t.getBoundingClientRect&&(n=t.getBoundingClientRect());let o=tq(t);return{left:n.left+o.left-(a.clientLeft||0)+r.left,top:n.top+o.top-(a.clientTop||0)+r.top};}(this.lower.el);}dispose(){w().dispose(this.lower.el),delete this.lower;}}let t2={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...E]},t5=["objects"];class t4 extends tc(td){get lowerCanvasEl(){var t;return null===(t=this.elements.lower)||void 0===t?void 0:t.el;}get contextContainer(){var t;return null===(t=this.elements.lower)||void 0===t?void 0:t.ctx;}static getDefaults(){return t4.ownDefaults;}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(e),this.initElements(t),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries();}initElements(t){this.elements=new t1(t);}add(){let t=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t;}insertAt(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];let s=super.insertAt(t,...i);return i.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),s;}remove(){let t=super.remove(...arguments);return t.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t;}_onObjectAdded(t){t.canvas&&t.canvas!==this&&(f("warn","Canvas is trying to add an object that belongs to a different canvas.\nResulting to default behavior: removing object from previous canvas and adding to new canvas"),t.canvas.remove(t)),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added",{target:this});}_onObjectRemoved(t){t._set("canvas",void 0),this.fire("object:removed",{target:t}),t.fire("removed",{target:this});}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll();}getRetinaScaling(){return this.enableRetinaScaling?S():1;}calcOffset(){return this._offset=this.elements.calcOffset();}getWidth(){return this.width;}getHeight(){return this.height;}setWidth(t,e){return this.setDimensions({width:t},e);}setHeight(t,e){return this.setDimensions({height:t},e);}_setDimensionsImpl(t){let{cssOnly:e=!1,backstoreOnly:i=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e){let e=h({width:this.width,height:this.height},t);this.elements.setDimensions(e,this.getRetinaScaling()),this.hasLostContext=!0,this.width=e.width,this.height=e.height;}i||this.elements.setCSSDimensions(t),this.calcOffset();}setDimensions(t,e){this._setDimensionsImpl(t,e),e&&e.cssOnly||this.requestRenderAll();}getZoom(){return this.viewportTransform[0];}setViewportTransform(t){this.viewportTransform=t,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll();}zoomToPoint(t,e){let i=[...this.viewportTransform],r=tS(t,tj(i));i[0]=e,i[3]=e;let s=tS(r,i);i[4]+=t.x-s.x,i[5]+=t.y-s.y,this.setViewportTransform(i);}setZoom(t){this.zoomToPoint(new to(0,0),t);}absolutePan(t){let e=[...this.viewportTransform];return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e);}relativePan(t){return this.absolutePan(new to(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]));}getElement(){return this.elements.lower.el;}clearContext(t){t.clearRect(0,0,this.width,this.height);}getContext(){return this.elements.lower.ctx;}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll();}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects);}renderAndReset(){this.nextRenderHandle=0,this.renderAll();}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=tu(()=>this.renderAndReset()));}calcViewportBoundaries(){let t=this.width,e=this.height,i=tj(this.viewportTransform),r=tS({x:0,y:0},i),s=tS({x:t,y:e},i),n=r.min(s),a=r.max(s);return this.vptCoords={tl:n,tr:new to(a.x,n.y),bl:new to(n.x,a.y),br:a};}cancelRequestedRender(){this.nextRenderHandle&&(tg(this.nextRenderHandle),this.nextRenderHandle=0);}drawControls(t){}renderCanvas(t,e){if(this.destroyed)return;let i=this.viewportTransform,r=this.clipPath;this.calcViewportBoundaries(),this.clearContext(t),t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.patternQuality="best",this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this._renderObjects(t,e),t.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(t),r&&(r._set("canvas",this),r.shouldCache(),r._transformDone=!0,r.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t,r)),this._renderOverlay(t),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(t),this.fire("after:render",{ctx:t}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0);}drawClipPathOnCanvas(t,e){let i=this.viewportTransform;t.save(),t.transform(...i),t.globalCompositeOperation="destination-in",e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore();}_renderObjects(t,e){for(let i=0,r=e.length;i<r;++i)e[i]&&e[i].render(t);}_renderBackgroundOrOverlay(t,e){let i=this["".concat(e,"Color")],r=this["".concat(e,"Image")],s=this.viewportTransform,n=this["".concat(e,"Vpt")];if(!i&&!r)return;let a=tH(i);if(i){if(t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=a?i.toLive(t):i,n&&t.transform(...s),a){t.transform(1,0,0,1,i.offsetX||0,i.offsetY||0);let e=i.gradientTransform||i.patternTransform;e&&t.transform(...e);}t.fill(),t.restore();}if(r){t.save();let{skipOffscreen:e}=this;this.skipOffscreen=n,n&&t.transform(...s),r.render(t),this.skipOffscreen=e,t.restore();}}_renderBackground(t){this._renderBackgroundOrOverlay(t,"background");}_renderOverlay(t){this._renderBackgroundOrOverlay(t,"overlay");}getCenter(){return{top:this.height/2,left:this.width/2};}getCenterPoint(){return new to(this.width/2,this.height/2);}centerObjectH(t){return this._centerObject(t,new to(this.getCenterPoint().x,t.getCenterPoint().y));}centerObjectV(t){return this._centerObject(t,new to(t.getCenterPoint().x,this.getCenterPoint().y));}centerObject(t){return this._centerObject(t,this.getCenterPoint());}viewportCenterObject(t){return this._centerObject(t,this.getVpCenter());}viewportCenterObjectH(t){return this._centerObject(t,new to(this.getVpCenter().x,t.getCenterPoint().y));}viewportCenterObjectV(t){return this._centerObject(t,new to(t.getCenterPoint().x,this.getVpCenter().y));}getVpCenter(){return tS(this.getCenterPoint(),tj(this.viewportTransform));}_centerObject(t,e){t.setXY(e,A,A),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll();}toDatalessJSON(t){return this.toDatalessObject(t);}toObject(t){return this._toObjectMethod("toObject",t);}toJSON(){return this.toObject();}toDatalessObject(t){return this._toObjectMethod("toDatalessObject",t);}_toObjectMethod(t,e){let i=this.clipPath,r=i&&!i.excludeFromExport?this._toObject(i,t,e):null;return h(h(h({version:T},tY(this,e)),{},{objects:this._objects.filter(t=>!t.excludeFromExport).map(i=>this._toObject(i,t,e))},this.__serializeBgOverlay(t,e)),r?{clipPath:r}:null);}_toObject(t,e,i){let r;this.includeDefaultValues||(r=t.includeDefaultValues,t.includeDefaultValues=!1);let s=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=!!r),s;}__serializeBgOverlay(t,e){let i={},r=this.backgroundImage,s=this.overlayImage,n=this.backgroundColor,a=this.overlayColor;return tH(n)?n.excludeFromExport||(i.background=n.toObject(e)):n&&(i.background=n),tH(a)?a.excludeFromExport||(i.overlay=a.toObject(e)):a&&(i.overlay=a),r&&!r.excludeFromExport&&(i.backgroundImage=this._toObject(r,t,e)),s&&!s.excludeFromExport&&(i.overlayImage=this._toObject(s,t,e)),i;}toSVG(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;t.reviver=e;let i=[];return this._setSVGPreamble(i,t),this._setSVGHeader(i,t),this.clipPath&&i.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,')" >\n')),this._setSVGBgOverlayColor(i,"background"),this._setSVGBgOverlayImage(i,"backgroundImage",e),this._setSVGObjects(i,e),this.clipPath&&i.push("</g>\n"),this._setSVGBgOverlayColor(i,"overlay"),this._setSVGBgOverlayImage(i,"overlayImage",e),i.push("</svg>"),i.join("");}_setSVGPreamble(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n');}_setSVGHeader(t,e){let i;let r=e.width||"".concat(this.width),s=e.height||"".concat(this.height),n=g.NUM_FRACTION_DIGITS,a=e.viewBox;if(a)i='viewBox="'.concat(a.x," ").concat(a.y," ").concat(a.width," ").concat(a.height,'" ');else if(this.svgViewportTransformation){let t=this.viewportTransform;i='viewBox="'.concat(tV(-t[4]/t[0],n)," ").concat(tV(-t[5]/t[3],n)," ").concat(tV(this.width/t[0],n)," ").concat(tV(this.height/t[3],n),'" ');}else i='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',r,'" ','height="',s,'" ',i,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",T,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),"</defs>\n");}createSVGClipPathMarkup(t){let e=this.clipPath;return e?(e.clipPathId="CLIPPATH_".concat(tp()),'<clipPath id="'.concat(e.clipPathId,'" >\n').concat(e.toClipPathSVG(t.reviver),"</clipPath>\n")):"";}createSVGRefElementsMarkup(){return["background","overlay"].map(t=>{let e=this["".concat(t,"Color")];if(tH(e)){let i=this["".concat(t,"Vpt")],r=this.viewportTransform,s={isType:()=>!1,width:this.width/(i?r[0]:1),height:this.height/(i?r[3]:1)};return e.toSVG(s,{additionalTransform:i?tN(r):""});}}).join("");}createSVGFontFacesMarkup(){let t=[],e={},i=g.fontPaths;this._objects.forEach(function e(i){t.push(i),th(i)&&i._objects.forEach(e);}),t.forEach(t=>{if(!t||"function"!=typeof t._renderText)return;let{styles:r,fontFamily:s}=t;!e[s]&&i[s]&&(e[s]=!0,r&&Object.values(r).forEach(t=>{Object.values(t).forEach(t=>{let{fontFamily:r=""}=t;!e[r]&&i[r]&&(e[r]=!0);});}));});let r=Object.keys(e).map(t=>"		@font-face {\n			font-family: '".concat(t,"';\n			src: url('").concat(i[t],"');\n		}\n")).join("");return r?'	<style type="text/css"><![CDATA[\n'.concat(r,"]]></style>\n"):"";}_setSVGObjects(t,e){this.forEachObject(i=>{i.excludeFromExport||this._setSVGObject(t,i,e);});}_setSVGObject(t,e,i){t.push(e.toSVG(i));}_setSVGBgOverlayImage(t,e,i){let r=this[e];r&&!r.excludeFromExport&&r.toSVG&&t.push(r.toSVG(i));}_setSVGBgOverlayColor(t,e){let i=this["".concat(e,"Color")];if(i){if(tH(i)){let r=i.repeat||"",s=this.width,n=this.height,a=this["".concat(e,"Vpt")]?tN(tj(this.viewportTransform)):"";t.push('<rect transform="'.concat(a," translate(").concat(s/2,",").concat(n/2,')" x="').concat(i.offsetX-s/2,'" y="').concat(i.offsetY-n/2,'" width="').concat(("repeat-y"===r||"no-repeat"===r)&&tU(i)?i.source.width:s,'" height="').concat(("repeat-x"===r||"no-repeat"===r)&&tU(i)?i.source.height:n,'" fill="url(#SVGID_').concat(i.id,')"></rect>\n'));}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',i,'"',"></rect>\n");}}loadFromJSON(t,e){let{signal:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)return Promise.reject(new p("`json` is undefined"));let r="string"==typeof t?JSON.parse(t):t,{objects:s=[]}=r,n=c(r,t5),{backgroundImage:a,background:o,overlayImage:l,overlay:h,clipPath:d}=n,u=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([tW(s,{reviver:e,signal:i}),tX({backgroundImage:a,backgroundColor:o,overlayImage:l,overlayColor:h,clipPath:d},{signal:i})]).then(t=>{let[e,i]=t;return this.clear(),this.add(...e),this.set(n),this.set(i),this.renderOnAddRemove=u,this;});}clone(t){let e=this.toObject(t);return this.cloneWithoutData().loadFromJSON(e);}cloneWithoutData(){let t=tx(this);return new this.constructor(t);}toDataURL(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{format:e="png",quality:i=1,multiplier:r=1,enableRetinaScaling:s=!1}=t,n=r*(s?this.getRetinaScaling():1);return ty(this.toCanvasElement(n,t),e,i);}toBlob(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{format:e="png",quality:i=1,multiplier:r=1,enableRetinaScaling:s=!1}=t,n=r*(s?this.getRetinaScaling():1);return tb(this.toCanvasElement(n,t),e,i);}toCanvasElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,{width:e,height:i,left:r,top:s,filter:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(e||this.width)*t,o=(i||this.height)*t,l=this.getZoom(),h=this.width,c=this.height,d=this.skipControlsDrawing,u=l*t,g=this.viewportTransform,f=[u,0,0,u,(g[4]-(r||0))*t,(g[5]-(s||0))*t],p=this.enableRetinaScaling,m=tx({width:a,height:o}),v=n?this._objects.filter(t=>n(t)):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=f,this.width=a,this.height=o,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(m.getContext("2d"),v),this.viewportTransform=g,this.width=h,this.height=c,this.calcViewportBoundaries(),this.enableRetinaScaling=p,this.skipControlsDrawing=d,m;}dispose(){return this.disposed||this.elements.cleanupDOM({width:this.width,height:this.height}),ti.cancelByCanvas(this),this.disposed=!0,new Promise((t,e)=>{let i=()=>{this.destroy(),t(!0);};i.kill=e,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?t(!1):this.nextRenderHandle?this.__cleanupTask=i:i();});}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject(t=>t.dispose()),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose();}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>");}}o(t4,"ownDefaults",t2);let t3=["touchstart","touchmove","touchend"],t6=t=>{let e=tq(t.target),i=function(t){let e=t.changedTouches;return e&&e[0]?e[0]:t;}(t);return new to(i.clientX+e.left,i.clientY+e.top);},t8=t=>t3.includes(t.type)||"touch"===t.pointerType,t7=t=>{t.preventDefault(),t.stopPropagation();},t9=t=>{let e=0,i=0,r=0,s=0;for(let n=0,a=t.length;n<a;n++){let{x:a,y:o}=t[n];(a>r||!n)&&(r=a),(a<e||!n)&&(e=a),(o>s||!n)&&(s=o),(o<i||!n)&&(i=o);}return{left:e,top:i,width:r-e,height:s-i};},et=["translateX","translateY","scaleX","scaleY"],ee=(t,e)=>ei(t,tT(e,t.calcOwnMatrix())),ei=(t,e)=>{let i=tM(e),{translateX:r,translateY:s,scaleX:n,scaleY:a}=i,o=c(i,et),l=new to(r,s);t.flipX=!1,t.flipY=!1,Object.assign(t,o),t.set({scaleX:n,scaleY:a}),t.setPositionByOrigin(l,A,A);},er=t=>{t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.rotate(0);},es=t=>({scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,angle:t.angle,left:t.left,flipX:t.flipX,flipY:t.flipY,top:t.top}),en=(t,e,i)=>{let r=t/2,s=e/2,n=t9([new to(-r,-s),new to(r,-s),new to(-r,s),new to(r,s)].map(t=>t.transform(i)));return new to(n.width,n.height);},ea=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E;return tT(tj(arguments.length>1&&void 0!==arguments[1]?arguments[1]:E),t);},eo=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E;return t.transform(ea(e,i));},el=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E;return t.transform(ea(e,i),!0);},eh=(t,e,i)=>{let r=ea(e,i);return ei(t,tT(r,t.calcOwnMatrix())),r;},ec=(t,e)=>{var i;let{transform:{target:r}}=e;null===(i=r.canvas)||void 0===i||i.fire("object:".concat(t),h(h({},e),{},{target:r})),r.fire(t,e);},ed={left:-.5,top:-.5,center:0,bottom:.5,right:.5},eu=t=>"string"==typeof t?ed[t]:t-.5,eg="not-allowed";function ef(t){return eu(t.originX)===eu(A)&&eu(t.originY)===eu(A);}let ep=(t,e)=>t[e],em=(t,e,i,r)=>({e:t,transform:e,pointer:new to(i,r)});function ev(t,e){return Math.round((t.getTotalAngle()+tC(Math.atan2(e.y,e.x))+360)%360/45);}function ex(t,e,i,r,s){var n;let{target:a,corner:o}=t,l=a.controls[o],h=(null===(n=a.canvas)||void 0===n?void 0:n.getZoom())||1,c=a.padding/h,d=function(t,e,i,r){let s=t.getRelativeCenterPoint(),n=void 0!==i&&void 0!==r?t.translateToGivenOrigin(s,A,A,i,r):new to(t.left,t.top);return(t.angle?e.rotate(-tw(t.angle),s):e).subtract(n);}(a,new to(r,s),e,i);return d.x>=c&&(d.x-=c),d.x<=-c&&(d.x+=c),d.y>=c&&(d.y-=c),d.y<=c&&(d.y+=c),d.x-=l.offsetX,d.y-=l.offsetY,d;}let ey=(t,e,i,r)=>{let{target:s,offsetX:n,offsetY:a}=e,o=i-n,l=r-a,h=!ep(s,"lockMovementX")&&s.left!==o,c=!ep(s,"lockMovementY")&&s.top!==l;return h&&s.set(P,o),c&&s.set("top",l),(h||c)&&ec(B,em(t,e,i,r)),h||c;},eb=t=>t.replace(/\s+/g," "),ew={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},eC=(t,e,i)=>(i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t),e_=(t,e,i,r)=>{let s,n;let a=Math.max(t/=255,e/=255,i/=255),o=Math.min(t,e,i),l=(a+o)/2;if(a===o)s=n=0;else{let r=a-o;switch(n=l>.5?r/(2-a-o):r/(a+o),a){case t:s=(e-i)/r+(e<i?6:0);break;case e:s=(i-t)/r+2;break;case i:s=(t-e)/r+4;}s/=6;}return[Math.round(360*s),Math.round(100*n),Math.round(100*l),r];},eS=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";return parseFloat(t)/(t.endsWith("%")?100:1);},ej=t=>Math.min(Math.round(t),255).toString(16).toUpperCase().padStart(2,"0"),eT=t=>{let[e,i,r,s=1]=t,n=Math.round(.3*e+.59*i+.11*r);return[n,n,n,s];};class ek{constructor(t){if(o(this,"isUnrecognised",!1),t){if(t instanceof ek)this.setSource([...t._source]);else if(Array.isArray(t)){let[e,i,r,s=1]=t;this.setSource([e,i,r,s]);}else this.setSource(this._tryParsingColor(t));}else this.setSource([0,0,0,1]);}_tryParsingColor(t){return(t=t.toLowerCase())in ew&&(t=ew[t]),"transparent"===t?[255,255,255,0]:ek.sourceFromHex(t)||ek.sourceFromRgb(t)||ek.sourceFromHsl(t)||(this.isUnrecognised=!0,[0,0,0,1]);}getSource(){return this._source;}setSource(t){this._source=t;}toRgb(){let[t,e,i]=this.getSource();return"rgb(".concat(t,",").concat(e,",").concat(i,")");}toRgba(){return"rgba(".concat(this.getSource().join(","),")");}toHsl(){let[t,e,i]=e_(...this.getSource());return"hsl(".concat(t,",").concat(e,"%,").concat(i,"%)");}toHsla(){let[t,e,i,r]=e_(...this.getSource());return"hsla(".concat(t,",").concat(e,"%,").concat(i,"%,").concat(r,")");}toHex(){return this.toHexa().slice(0,6);}toHexa(){let[t,e,i,r]=this.getSource();return"".concat(ej(t)).concat(ej(e)).concat(ej(i)).concat(ej(Math.round(255*r)));}getAlpha(){return this.getSource()[3];}setAlpha(t){return this._source[3]=t,this;}toGrayscale(){return this.setSource(eT(this.getSource())),this;}toBlackWhite(t){let[e,,,i]=eT(this.getSource()),r=e<(t||127)?0:255;return this.setSource([r,r,r,i]),this;}overlayWith(t){t instanceof ek||(t=new ek(t));let e=this.getSource(),i=t.getSource(),[r,s,n]=e.map((t,e)=>Math.round(.5*t+.5*i[e]));return this.setSource([r,s,n,e[3]]),this;}static fromRgb(t){return ek.fromRgba(t);}static fromRgba(t){return new ek(ek.sourceFromRgb(t));}static sourceFromRgb(t){let e=eb(t).match(/^rgba?\(\s?(\d{0,3}(?:\.\d+)?%?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?(?:\s?[,/]\s?(\d{0,3}(?:\.\d+)?%?)\s?)?\)$/i);if(e){let[t,i,r]=e.slice(1,4).map(t=>{let e=parseFloat(t);return t.endsWith("%")?Math.round(2.55*e):e;});return[t,i,r,eS(e[4])];}}static fromHsl(t){return ek.fromHsla(t);}static fromHsla(t){return new ek(ek.sourceFromHsl(t));}static sourceFromHsl(t){let e,i,r;let s=eb(t).match(/^hsla?\(\s?([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?[\s|,]\s?(\d{0,3}(?:\.\d+)?%?)\s?(?:\s?[,/]\s?(\d*(?:\.\d+)?%?)\s?)?\)$/i);if(!s)return;let n=(ek.parseAngletoDegrees(s[1])%360+360)%360/360,a=parseFloat(s[2])/100,o=parseFloat(s[3])/100;if(0===a)e=i=r=o;else{let t=o<=.5?o*(a+1):o+a-o*a,s=2*o-t;e=eC(s,t,n+1/3),i=eC(s,t,n),r=eC(s,t,n-1/3);}return[Math.round(255*e),Math.round(255*i),Math.round(255*r),eS(s[4])];}static fromHex(t){return new ek(ek.sourceFromHex(t));}static sourceFromHex(t){if(t.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){let e=t.slice(t.indexOf("#")+1),[i,r,s,n=255]=(e.length<=4?e.split("").map(t=>t+t):e.match(/.{2}/g)).map(t=>parseInt(t,16));return[i,r,s,n/255];}}static parseAngletoDegrees(t){let e=t.toLowerCase(),i=parseFloat(e);return e.includes("rad")?tC(i):e.includes("turn")?360*i:i;}}let eO=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,i=/\D{0,2}$/.exec(t),r=parseFloat(t),s=g.DPI;switch(null==i?void 0:i[0]){case"mm":return r*s/25.4;case"cm":return r*s/2.54;case"in":return r*s;case"pt":return r*s/72;case"pc":return r*s/72*12;case"em":return r*e;default:return r;}},eM=t=>{let[e,i]=t.trim().split(" "),[r,s]=e&&e!==L?[e.slice(1,4),e.slice(5,8)]:e===L?[e,e]:["Mid","Mid"];return{meetOrSlice:i||"meet",alignX:r,alignY:s};},eD=function(t,e){let i,r,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e){if(e.toLive)i="url(#SVGID_".concat(e.id,")");else{let t=new ek(e),s=t.getAlpha();i=t.toRgb(),1!==s&&(r=s.toString());}}else i="none";return s?"".concat(t,": ").concat(i,"; ").concat(r?"".concat(t,"-opacity: ").concat(r,"; "):""):"".concat(t,'="').concat(i,'" ').concat(r?"".concat(t,'-opacity="').concat(r,'" '):"");};class eE{getSvgStyles(t){let e=this.fillRule?this.fillRule:"nonzero",i=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):L,s=this.strokeDashOffset?this.strokeDashOffset:"0",n=this.strokeLineCap?this.strokeLineCap:"butt",a=this.strokeLineJoin?this.strokeLineJoin:"miter",o=this.strokeMiterLimit?this.strokeMiterLimit:"4",l=void 0!==this.opacity?this.opacity:"1",h=this.visible?"":" visibility: hidden;",c=t?"":this.getSvgFilter(),d=eD(J,this.fill);return[eD(Z,this.stroke),"stroke-width: ",i,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",n,"; ","stroke-dashoffset: ",s,"; ","stroke-linejoin: ",a,"; ","stroke-miterlimit: ",o,"; ",d,"fill-rule: ",e,"; ","opacity: ",l,";",c,h].join("");}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):"";}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("");}getSvgTransform(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=t?this.calcTransformMatrix():this.calcOwnMatrix(),r='transform="'.concat(tN(i));return"".concat(r).concat(e,'" ');}_toSVG(t){return[""];}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t});}toClipPathSVG(t){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t});}_createBaseClipPathSVGMarkup(t){let{reviver:e,additionalTransform:i=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=[this.getSvgTransform(!0,i),this.getSvgCommons()].join(""),s=t.indexOf("COMMON_PARTS");return t[s]=r,e?e(t.join("")):t.join("");}_createBaseSVGMarkup(t){let e,{noStyle:i,reviver:r,withShadow:s,additionalTransform:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i?"":'style="'.concat(this.getSvgStyles(),'" '),o=s?'style="'.concat(this.getSvgFilter(),'" '):"",l=this.clipPath,h=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",c=l&&l.absolutePositioned,d=this.stroke,u=this.fill,g=this.shadow,f=[],p=t.indexOf("COMMON_PARTS");l&&(l.clipPathId="CLIPPATH_".concat(tp()),e='<clipPath id="'.concat(l.clipPathId,'" >\n').concat(l.toClipPathSVG(r),"</clipPath>\n")),c&&f.push("<g ",o,this.getSvgCommons()," >\n"),f.push("<g ",this.getSvgTransform(!1),c?"":o+this.getSvgCommons()," >\n");let m=[a,h,i?"":this.addPaintOrder()," ",n?'transform="'.concat(n,'" '):""].join("");return t[p]=m,tH(u)&&f.push(u.toSVG(this)),tH(d)&&f.push(d.toSVG(this)),g&&f.push(g.toSVG(this)),l&&f.push(e),f.push(t.join("")),f.push("</g>\n"),c&&f.push("</g>\n"),r?r(f.join("")):f.join("");}addPaintOrder(){return this.paintFirst!==J?' paint-order="'.concat(this.paintFirst,'" '):"";}}function eA(t){return RegExp("^("+t.join("|")+")\\b","i");}let eP="textDecorationThickness",eF=["fontSize","fontWeight","fontFamily","fontStyle"],eR=["underline","overline","linethrough"],eL=[...eF,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],eI=[...eL,...eR,"textBackgroundColor","direction",eP],eB=[...eF,...eR,Z,"strokeWidth",J,"deltaY","textBackgroundColor",eP],eW="justify",eX="justify-left",eY="justify-right",ez="justify-center",eV=String.raw(ip||(ip=d(["[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?"],["[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?"]))),eN=String.raw(im||(im=d(["(?:s*,?s+|s*,s*)"],["(?:\\s*,?\\s+|\\s*,\\s*)"]))),eH="http://www.w3.org/2000/svg",eG=RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+eV+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+eV+"))?\\s+(.*)"),eU={cx:P,x:P,r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing","text-decoration-thickness":eP},e$="font-size",eq="clip-path",eK=eA(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),eJ=eA(["symbol","image","marker","pattern","view","svg"]),eZ=eA(["symbol","g","a","svg","clipPath","defs"]),eQ=new RegExp(String.raw(iv||(iv=d(["^s*(",")","(",")","(",")","(",")s*$"],["^\\s*(",")","(",")","(",")","(",")\\s*$"])),eV,eN,eV,eN,eV,eN,eV)),e0=new to(1,0),e1=new to,e2=(t,e)=>t.rotate(e),e5=(t,e)=>new to(e).subtract(t),e4=t=>t.distanceFrom(e1),e3=(t,e)=>Math.atan2(e9(t,e),it(t,e)),e6=t=>e3(e0,t),e8=t=>t.eq(e1)?t:t.scalarDivide(e4(t)),e7=function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e8(new to(-t.y,t.x).scalarMultiply(e?1:-1));},e9=(t,e)=>t.x*e.y-t.y*e.x,it=(t,e)=>t.x*e.x+t.y*e.y,ie=(t,e,i)=>{if(t.eq(e)||t.eq(i))return!0;let r=e9(e,i),s=e9(e,t),n=e9(i,t);return r>=0?s>=0&&n<=0:!(s<=0&&n>=0);},ii="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",ir=RegExp("(?:\\s|^)"+ii+ii+"("+eV+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class is{constructor(t){let e="string"==typeof t?is.parseShadow(t):t;Object.assign(this,is.ownDefaults,e),this.id=tp();}static parseShadow(t){let e=t.trim(),[,i=0,r=0,s=0]=(ir.exec(e)||[]).map(t=>parseFloat(t)||0);return{color:(e.replace(ir,"")||"rgb(0,0,0)").trim(),offsetX:i,offsetY:r,blur:s};}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ");}toSVG(t){let e=e2(new to(this.offsetX,this.offsetY),tw(-t.angle)),i=new ek(this.color),r=40,s=40;return t.width&&t.height&&(r=100*tV((Math.abs(e.x)+this.blur)/t.width,g.NUM_FRACTION_DIGITS)+20,s=100*tV((Math.abs(e.y)+this.blur)/t.height,g.NUM_FRACTION_DIGITS)+20),t.flipX&&(e.x*=-1),t.flipY&&(e.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(s,'%" height="').concat(100+2*s,'%" x="-').concat(r,'%" width="').concat(100+2*r,'%" >\n	<feGaussianBlur in="SourceAlpha" stdDeviation="').concat(tV(this.blur?this.blur/2:0,g.NUM_FRACTION_DIGITS),'"></feGaussianBlur>\n	<feOffset dx="').concat(tV(e.x,g.NUM_FRACTION_DIGITS),'" dy="').concat(tV(e.y,g.NUM_FRACTION_DIGITS),'" result="oBlur" ></feOffset>\n	<feFlood flood-color="').concat(i.toRgb(),'" flood-opacity="').concat(i.getAlpha(),'"/>\n	<feComposite in2="oBlur" operator="in" />\n	<feMerge>\n		<feMergeNode></feMergeNode>\n		<feMergeNode in="SourceGraphic"></feMergeNode>\n	</feMerge>\n</filter>\n');}toObject(){let t={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},e=is.ownDefaults;return this.includeDefaultValues?t:tz(t,(t,i)=>t!==e[i]);}static async fromObject(t){return new this(t);}}o(is,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),o(is,"type","shadow"),te.setClass(is,"shadow");let ia=(t,e,i)=>Math.max(t,Math.min(e,i)),io=["top",P,U,$,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",q,K],il=[J,Z,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],ih=(t,e,i,r)=>(t<Math.abs(e)?(t=e,r=i/4):r=0===e&&0===t?i/M*Math.asin(1):i/M*Math.asin(e/t),{a:t,c:e,p:i,s:r}),ic=(t,e,i,r,s)=>t*Math.pow(2,10*(r-=1))*Math.sin((r*s-e)*M/i),id=(t,e,i,r)=>-i*Math.cos(t/r*O)+i+e,iu=(t,e,i,r)=>(t/=r)<1/2.75?7.5625*t*t*i+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e,ig=(t,e,i,r)=>i-iu(r-t,0,i,r)+e;var ip,im,iv,ix,iy,ib,iw,iC,i_,iS,ij=Object.freeze({__proto__:null,defaultEasing:id,easeInBack:function(t,e,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return i*(t/=r)*t*((s+1)*t-s)+e;},easeInBounce:ig,easeInCirc:(t,e,i,r)=>-i*(Math.sqrt(1-(t/=r)*t)-1)+e,easeInCubic:(t,e,i,r)=>i*(t/r)**3+e,easeInElastic:(t,e,i,r)=>{let s=0;if(0===t)return e;if(1==(t/=r))return e+i;s||(s=.3*r);let{a:n,s:a,p:o}=ih(i,i,s,1.70158);return-ic(n,a,o,t,r)+e;},easeInExpo:(t,e,i,r)=>0===t?e:i*2**(10*(t/r-1))+e,easeInOutBack:function(t,e,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return(t/=r/2)<1?i/2*(t*t*((1+(s*=1.525))*t-s))+e:i/2*((t-=2)*t*((1+(s*=1.525))*t+s)+2)+e;},easeInOutBounce:(t,e,i,r)=>t<r/2?.5*ig(2*t,0,i,r)+e:.5*iu(2*t-r,0,i,r)+.5*i+e,easeInOutCirc:(t,e,i,r)=>(t/=r/2)<1?-i/2*(Math.sqrt(1-t**2)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e,easeInOutCubic:(t,e,i,r)=>(t/=r/2)<1?i/2*t**3+e:i/2*((t-2)**3+2)+e,easeInOutElastic:(t,e,i,r)=>{let s=0;if(0===t)return e;if(2==(t/=r/2))return e+i;s||(s=.3*1.5*r);let{a:n,s:a,p:o,c:l}=ih(i,i,s,1.70158);return t<1?-.5*ic(n,a,o,t,r)+e:n*Math.pow(2,-10*(t-=1))*Math.sin((t*r-a)*M/o)*.5+l+e;},easeInOutExpo:(t,e,i,r)=>0===t?e:t===r?e+i:(t/=r/2)<1?i/2*2**(10*(t-1))+e:-(i/2*(2**(-10*--t)+2))+e,easeInOutQuad:(t,e,i,r)=>(t/=r/2)<1?i/2*t**2+e:-i/2*(--t*(t-2)-1)+e,easeInOutQuart:(t,e,i,r)=>(t/=r/2)<1?i/2*t**4+e:-i/2*((t-=2)*t**3-2)+e,easeInOutQuint:(t,e,i,r)=>(t/=r/2)<1?i/2*t**5+e:i/2*((t-2)**5+2)+e,easeInOutSine:(t,e,i,r)=>-i/2*(Math.cos(Math.PI*t/r)-1)+e,easeInQuad:(t,e,i,r)=>i*(t/=r)*t+e,easeInQuart:(t,e,i,r)=>i*(t/=r)*t**3+e,easeInQuint:(t,e,i,r)=>i*(t/r)**5+e,easeInSine:(t,e,i,r)=>-i*Math.cos(t/r*O)+i+e,easeOutBack:function(t,e,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return i*((t=t/r-1)*t*((s+1)*t+s)+1)+e;},easeOutBounce:iu,easeOutCirc:(t,e,i,r)=>i*Math.sqrt(1-(t=t/r-1)*t)+e,easeOutCubic:(t,e,i,r)=>i*((t/r-1)**3+1)+e,easeOutElastic:(t,e,i,r)=>{let s=0;if(0===t)return e;if(1==(t/=r))return e+i;s||(s=.3*r);let{a:n,s:a,p:o,c:l}=ih(i,i,s,1.70158);return n*2**(-10*t)*Math.sin((t*r-a)*M/o)+l+e;},easeOutExpo:(t,e,i,r)=>t===r?e+i:-(i*(2**(-10*t/r)+1))+e,easeOutQuad:(t,e,i,r)=>-i*(t/=r)*(t-2)+e,easeOutQuart:(t,e,i,r)=>-i*((t=t/r-1)*t**3-1)+e,easeOutQuint:(t,e,i,r)=>i*((t/r-1)**5+1)+e,easeOutSine:(t,e,i,r)=>i*Math.sin(t/r*O)+e});let iT=()=>!1;class ik{constructor(t){let{startValue:e,byValue:i,duration:r=500,delay:s=0,easing:n=id,onStart:a=k,onChange:l=k,onComplete:h=k,abort:c=iT,target:d}=t;o(this,"_state","pending"),o(this,"durationProgress",0),o(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=r,this.delay=s,this.easing=n,this._onStart=a,this._onChange=l,this._onComplete=h,this._abort=c,this.target=d,this.startValue=e,this.byValue=i,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value);}get state(){return this._state;}isDone(){return"aborted"===this._state||"completed"===this._state;}start(){let t=t=>{"pending"===this._state&&(this.startTime=t||+new Date,this._state="running",this._onStart(),this.tick(this.startTime));};this.register(),this.delay>0?setTimeout(()=>tu(t),this.delay):tu(t);}tick(t){let e=(t||+new Date)-this.startTime,i=Math.min(e,this.duration);this.durationProgress=i/this.duration;let{value:r,valueProgress:s}=this.calculate(i);this.value=Object.freeze(r),this.valueProgress=s,"aborted"!==this._state&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):e>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),tu(this.tick)));}register(){ti.push(this);}unregister(){ti.remove(this);}abort(){this._state="aborted",this.unregister();}}let iO=["startValue","endValue"];class iM extends ik{constructor(t){let{startValue:e=0,endValue:i=100}=t;super(h(h({},c(t,iO)),{},{startValue:e,byValue:i-e}));}calculate(t){let e=this.easing(t,this.startValue,this.byValue,this.duration);return{value:e,valueProgress:Math.abs((e-this.startValue)/this.byValue)};}}let iD=["startValue","endValue"];class iE extends ik{constructor(t){let{startValue:e=[0],endValue:i=[100]}=t;super(h(h({},c(t,iD)),{},{startValue:e,byValue:i.map((t,i)=>t-e[i])}));}calculate(t){let e=this.startValue.map((e,i)=>this.easing(t,e,this.byValue[i],this.duration,i));return{value:e,valueProgress:Math.abs((e[0]-this.startValue[0])/this.byValue[0])};}}let iA=["startValue","endValue","easing","onChange","onComplete","abort"],iP=(t,e,i,r)=>e+i*(1-Math.cos(t/r*O)),iF=t=>t&&((e,i,r)=>t(new ek(e).toRgba(),i,r));class iR extends ik{constructor(t){let{startValue:e,endValue:i,easing:r=iP,onChange:s,onComplete:n,abort:a}=t,o=c(t,iA),l=new ek(e).getSource();super(h(h({},o),{},{startValue:l,byValue:new ek(i).getSource().map((t,e)=>t-l[e]),easing:r,onChange:iF(s),onComplete:iF(n),abort:iF(a)}));}calculate(t){let[e,i,r,s]=this.startValue.map((e,i)=>this.easing(t,e,this.byValue[i],this.duration,i)),n=[...[e,i,r].map(Math.round),ia(0,s,1)];return{value:n,valueProgress:n.map((t,e)=>0!==this.byValue[e]?Math.abs((t-this.startValue[e])/this.byValue[e]):0).find(t=>0!==t)||0};}}function iL(t){let e=Array.isArray(t.startValue)||Array.isArray(t.endValue)?new iE(t):new iM(t);return e.start(),e;}function iI(t){let e=new iR(t);return e.start(),e;}class iB{constructor(t){this.status=t,this.points=[];}includes(t){return this.points.some(e=>e.eq(t));}append(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.points=this.points.concat(e.filter(t=>!this.includes(t))),this;}static isPointContained(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.eq(i))return t.eq(e);if(e.x===i.x)return t.x===e.x&&(r||t.y>=Math.min(e.y,i.y)&&t.y<=Math.max(e.y,i.y));if(e.y===i.y)return t.y===e.y&&(r||t.x>=Math.min(e.x,i.x)&&t.x<=Math.max(e.x,i.x));{let s=e5(e,i),n=e5(e,t).divide(s);return r?Math.abs(n.x)===Math.abs(n.y):n.x===n.y&&n.x>=0&&n.x<=1;}}static isPointInPolygon(t,e){let i=new to(t).setX(Math.min(t.x-1,...e.map(t=>t.x))),r=0;for(let s=0;s<e.length;s++){let n=this.intersectSegmentSegment(e[s],e[(s+1)%e.length],t,i);if(n.includes(t))return!0;r+=Number("Intersection"===n.status);}return r%2==1;}static intersectLineLine(t,e,i,r){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=e.x-t.x,o=e.y-t.y,l=r.x-i.x,h=r.y-i.y,c=t.x-i.x,d=t.y-i.y,u=l*d-h*c,g=a*d-o*c,f=h*a-l*o;if(0!==f){let e=u/f,i=g/f;return(s||0<=e&&e<=1)&&(n||0<=i&&i<=1)?new iB("Intersection").append(new to(t.x+e*a,t.y+e*o)):new iB;}if(0===u||0===g){let a=s||n||iB.isPointContained(t,i,r)||iB.isPointContained(e,i,r)||iB.isPointContained(i,t,e)||iB.isPointContained(r,t,e);return new iB(a?"Coincident":void 0);}return new iB("Parallel");}static intersectSegmentLine(t,e,i,r){return iB.intersectLineLine(t,e,i,r,!1,!0);}static intersectSegmentSegment(t,e,i,r){return iB.intersectLineLine(t,e,i,r,!1,!1);}static intersectLinePolygon(t,e,i){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=new iB,n=i.length;for(let a,o,l,h=0;h<n;h++){if(a=i[h],o=i[(h+1)%n],"Coincident"===(l=iB.intersectLineLine(t,e,a,o,r,!1)).status)return l;s.append(...l.points);}return s.points.length>0&&(s.status="Intersection"),s;}static intersectSegmentPolygon(t,e,i){return iB.intersectLinePolygon(t,e,i,!1);}static intersectPolygonPolygon(t,e){let i=new iB,r=t.length,s=[];for(let n=0;n<r;n++){let a=t[n],o=t[(n+1)%r],l=iB.intersectSegmentPolygon(a,o,e);"Coincident"===l.status?(s.push(l),i.append(a,o)):i.append(...l.points);}return s.length>0&&s.length===t.length?new iB("Coincident"):(i.points.length>0&&(i.status="Intersection"),i);}static intersectPolygonRectangle(t,e,i){let r=e.min(i),s=e.max(i),n=new to(s.x,r.y),a=new to(r.x,s.y);return iB.intersectPolygonPolygon(t,[r,n,s,a]);}}class iW extends td{getX(){return this.getXY().x;}setX(t){this.setXY(this.getXY().setX(t));}getY(){return this.getXY().y;}setY(t){this.setXY(this.getXY().setY(t));}getRelativeX(){return this.left;}setRelativeX(t){this.left=t;}getRelativeY(){return this.top;}setRelativeY(t){this.top=t;}getXY(){let t=this.getRelativeXY();return this.group?tS(t,this.group.calcTransformMatrix()):t;}setXY(t,e,i){this.group&&(t=tS(t,tj(this.group.calcTransformMatrix()))),this.setRelativeXY(t,e,i);}getRelativeXY(){return new to(this.left,this.top);}setRelativeXY(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.originX,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.originY;this.setPositionByOrigin(t,e,i);}isStrokeAccountedForInDimensions(){return!1;}getCoords(){let{tl:t,tr:e,br:i,bl:r}=this.aCoords||(this.aCoords=this.calcACoords()),s=[t,e,i,r];if(this.group){let t=this.group.calcTransformMatrix();return s.map(e=>tS(e,t));}return s;}intersectsWithRect(t,e){return"Intersection"===iB.intersectPolygonRectangle(this.getCoords(),t,e).status;}intersectsWithObject(t){let e=iB.intersectPolygonPolygon(this.getCoords(),t.getCoords());return"Intersection"===e.status||"Coincident"===e.status||t.isContainedWithinObject(this)||this.isContainedWithinObject(t);}isContainedWithinObject(t){return this.getCoords().every(e=>t.containsPoint(e));}isContainedWithinRect(t,e){let{left:i,top:r,width:s,height:n}=this.getBoundingRect();return i>=t.x&&i+s<=e.x&&r>=t.y&&r+n<=e.y;}isOverlapping(t){return this.intersectsWithObject(t)||this.isContainedWithinObject(t)||t.isContainedWithinObject(this);}containsPoint(t){return iB.isPointInPolygon(t,this.getCoords());}isOnScreen(){if(!this.canvas)return!1;let{tl:t,br:e}=this.canvas.vptCoords;return!!this.getCoords().some(i=>i.x<=e.x&&i.x>=t.x&&i.y<=e.y&&i.y>=t.y)||!!this.intersectsWithRect(t,e)||this.containsPoint(t.midPointFrom(e));}isPartiallyOnScreen(){if(!this.canvas)return!1;let{tl:t,br:e}=this.canvas.vptCoords;return!!this.intersectsWithRect(t,e)||this.getCoords().every(i=>(i.x>=e.x||i.x<=t.x)&&(i.y>=e.y||i.y<=t.y))&&this.containsPoint(t.midPointFrom(e));}getBoundingRect(){return t9(this.getCoords());}getScaledWidth(){return this._getTransformedDimensions().x;}getScaledHeight(){return this._getTransformedDimensions().y;}scale(t){this._set(U,t),this._set($,t),this.setCoords();}scaleToWidth(t){let e=this.getBoundingRect().width/this.getScaledWidth();return this.scale(t/this.width/e);}scaleToHeight(t){let e=this.getBoundingRect().height/this.getScaledHeight();return this.scale(t/this.height/e);}getCanvasRetinaScaling(){var t;return(null===(t=this.canvas)||void 0===t?void 0:t.getRetinaScaling())||1;}getTotalAngle(){return this.group?tC(tO(this.calcTransformMatrix())):this.angle;}getViewportTransform(){var t;return(null===(t=this.canvas)||void 0===t?void 0:t.viewportTransform)||E.concat();}calcACoords(){let t=tE({angle:this.angle}),{x:e,y:i}=this.getRelativeCenterPoint(),r=tT(tD(e,i),t),s=this._getTransformedDimensions(),n=s.x/2,a=s.y/2;return{tl:tS({x:-n,y:-a},r),tr:tS({x:n,y:-a},r),bl:tS({x:-n,y:a},r),br:tS({x:n,y:a},r)};}setCoords(){this.aCoords=this.calcACoords();}transformMatrixKey(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=[];return!t&&this.group&&(e=this.group.transformMatrixKey(t)),e.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,eu(this.originX),eu(this.originY)),e;}calcTransformMatrix(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.calcOwnMatrix();if(t||!this.group)return e;let i=this.transformMatrixKey(t),r=this.matrixCache;return r&&r.key.every((t,e)=>t===i[e])?r.value:(this.group&&(e=tT(this.group.calcTransformMatrix(!1),e)),this.matrixCache={key:i,value:e},e);}calcOwnMatrix(){let t=this.transformMatrixKey(!0),e=this.ownMatrixCache;if(e&&e.key===t)return e.value;let i=this.getRelativeCenterPoint(),r=tI({angle:this.angle,translateX:i.x,translateY:i.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY});return this.ownMatrixCache={key:t,value:r},r;}_getNonTransformedDimensions(){return new to(this.width,this.height).scalarAdd(this.strokeWidth);}_calculateCurrentDimensions(t){return this._getTransformedDimensions(t).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding);}_getTransformedDimensions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=h({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},t),i=e.strokeWidth,r=i,s=0;this.strokeUniform&&(r=0,s=i);let n=e.width+r,a=e.height+r;return(0===e.skewX&&0===e.skewY?new to(n*e.scaleX,a*e.scaleY):en(n,a,tL(e))).scalarAdd(s);}translateToGivenOrigin(t,e,i,r,s){let n=t.x,a=t.y,o=eu(r)-eu(e),l=eu(s)-eu(i);if(o||l){let t=this._getTransformedDimensions();n+=o*t.x,a+=l*t.y;}return new to(n,a);}translateToCenterPoint(t,e,i){if(e===A&&i===A)return t;let r=this.translateToGivenOrigin(t,e,i,A,A);return this.angle?r.rotate(tw(this.angle),t):r;}translateToOriginPoint(t,e,i){let r=this.translateToGivenOrigin(t,A,A,e,i);return this.angle?r.rotate(tw(this.angle),t):r;}getCenterPoint(){let t=this.getRelativeCenterPoint();return this.group?tS(t,this.group.calcTransformMatrix()):t;}getRelativeCenterPoint(){return this.translateToCenterPoint(new to(this.left,this.top),this.originX,this.originY);}getPointByOrigin(t,e){return this.translateToOriginPoint(this.getRelativeCenterPoint(),t,e);}setPositionByOrigin(t,e,i){let r=this.translateToCenterPoint(t,e,i),s=this.translateToOriginPoint(r,this.originX,this.originY);this.set({left:s.x,top:s.y});}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),P,"top");}}let iX=["type"],iY=["extraParam"],iz=class t extends iW{static getDefaults(){return t.ownDefaults;}get type(){let t=this.constructor.type;return"FabricObject"===t?"object":t.toLowerCase();}set type(t){f("warn","Setting type has no effect",t);}constructor(e){super(),o(this,"_cacheContext",null),Object.assign(this,t.ownDefaults),this.setOptions(e);}_createCacheCanvas(){this._cacheCanvas=tm(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0;}_limitCacheSize(t){let e=t.width,i=t.height,r=g.maxCacheSideLimit,s=g.minCacheSideLimit;if(e<=r&&i<=r&&e*i<=g.perfLimitSizeTotal)return e<s&&(t.width=s),i<s&&(t.height=s),t;let[n,a]=j.limitDimsByArea(e/i),o=ia(s,n,r),l=ia(s,a,r);return e>o&&(t.zoomX/=e/o,t.width=o,t.capped=!0),i>l&&(t.zoomY/=i/l,t.height=l,t.capped=!0),t;}_getCacheCanvasDimensions(){let t=this.getTotalObjectScaling(),e=this._getTransformedDimensions({skewX:0,skewY:0}),i=e.x*t.x/this.scaleX,r=e.y*t.y/this.scaleY;return{width:Math.ceil(i+2),height:Math.ceil(r+2),zoomX:t.x,zoomY:t.y,x:i,y:r};}_updateCacheCanvas(){let t=this._cacheCanvas,e=this._cacheContext,{width:i,height:r,zoomX:s,zoomY:n,x:a,y:o}=this._limitCacheSize(this._getCacheCanvasDimensions()),l=i!==t.width||r!==t.height,h=this.zoomX!==s||this.zoomY!==n;if(!t||!e)return!1;if(l||h){i!==t.width||r!==t.height?(t.width=i,t.height=r):(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height));let l=a/2,h=o/2;return this.cacheTranslationX=Math.round(t.width/2-l)+l,this.cacheTranslationY=Math.round(t.height/2-h)+h,e.translate(this.cacheTranslationX,this.cacheTranslationY),e.scale(s,n),this.zoomX=s,this.zoomY=n,!0;}return!1;}setOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setOptions(t);}transform(t){let e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,i=this.calcTransformMatrix(!e);t.transform(i[0],i[1],i[2],i[3],i[4],i[5]);}getObjectScaling(){if(!this.group)return new to(Math.abs(this.scaleX),Math.abs(this.scaleY));let t=tM(this.calcTransformMatrix());return new to(Math.abs(t.scaleX),Math.abs(t.scaleY));}getTotalObjectScaling(){let t=this.getObjectScaling();if(this.canvas){let e=this.canvas.getZoom(),i=this.getCanvasRetinaScaling();return t.scalarMultiply(e*i);}return t;}getObjectOpacity(){let t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t;}_constrainScale(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:0===t?1e-4:t;}_set(t,e){t!==U&&t!==$||(e=this._constrainScale(e)),t===U&&e<0?(this.flipX=!this.flipX,e*=-1):"scaleY"===t&&e<0?(this.flipY=!this.flipY,e*=-1):"shadow"!==t||!e||e instanceof is||(e=new is(e));let i=this[t]!==e;return this[t]=e,i&&this.constructor.cacheProperties.includes(t)&&(this.dirty=!0),this.parent&&(this.dirty||i&&this.constructor.stateProperties.includes(t))&&this.parent._set("dirty",!0),this;}isNotVisible(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible;}render(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.drawObject(t,!1,{}),this.dirty=!1),t.restore());}drawSelectionBackground(t){}renderCache(t){if(t=t||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){let{zoomX:e,zoomY:i,cacheTranslationX:r,cacheTranslationY:s}=this,{width:n,height:a}=this._cacheCanvas;this.drawObject(this._cacheContext,t.forClipping,{zoomX:e,zoomY:i,cacheTranslationX:r,cacheTranslationY:s,width:n,height:a,parentClipPaths:[]}),this.dirty=!1;}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null;}hasStroke(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth;}hasFill(){return this.fill&&"transparent"!==this.fill;}needsItsOwnCache(){return!!(this.paintFirst===Z&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath;}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching;}willDrawShadow(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY);}drawClipPathOnCache(t,e,i){t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",t.setTransform(1,0,0,1,0,0),t.drawImage(i,0,0),t.restore();}drawObject(t,e,i){let r=this.fill,s=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath,i),this.fill=r,this.stroke=s;}createClipPathLayer(t,e){let i=tx(e),r=i.getContext("2d");if(r.translate(e.cacheTranslationX,e.cacheTranslationY),r.scale(e.zoomX,e.zoomY),t._cacheCanvas=i,e.parentClipPaths.forEach(t=>{t.transform(r);}),e.parentClipPaths.push(t),t.absolutePositioned){let t=tj(this.calcTransformMatrix());r.transform(t[0],t[1],t[2],t[3],t[4],t[5]);}return t.transform(r),t.drawObject(r,!0,e),i;}_drawClipPath(t,e,i){if(!e)return;e._transformDone=!0;let r=this.createClipPathLayer(e,i);this.drawClipPathOnCache(t,e,r);}drawCacheOnCanvas(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY);}isCacheDirty(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isNotVisible())return!1;let e=this._cacheCanvas,i=this._cacheContext;return!(!e||!i||t||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(e&&i&&!t&&(i.save(),i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,e.width,e.height),i.restore()),!0);}_renderBackground(t){if(!this.backgroundColor)return;let e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t);}_setOpacity(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity;}_setStrokeStyles(t,e){let i=e.stroke;i&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,tH(i)?"percentage"===i.gradientUnits||i.gradientTransform||i.patternTransform?this._applyPatternForTransformedGradient(t,i):(t.strokeStyle=i.toLive(t),this._applyPatternGradientTransform(t,i)):t.strokeStyle=e.stroke);}_setFillStyles(t,e){let{fill:i}=e;i&&(tH(i)?(t.fillStyle=i.toLive(t),this._applyPatternGradientTransform(t,i)):t.fillStyle=i);}_setClippingProperties(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000";}_setLineDash(t,e){e&&0!==e.length&&t.setLineDash(e);}_setShadow(t){if(!this.shadow)return;let e=this.shadow,i=this.canvas,r=this.getCanvasRetinaScaling(),[s,,,n]=(null==i?void 0:i.viewportTransform)||E,a=s*r,o=n*r,l=e.nonScaling?new to(1,1):this.getObjectScaling();t.shadowColor=e.color,t.shadowBlur=e.blur*g.browserShadowBlurConstant*(a+o)*(l.x+l.y)/4,t.shadowOffsetX=e.offsetX*a*l.x,t.shadowOffsetY=e.offsetY*o*l.y;}_removeShadow(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0);}_applyPatternGradientTransform(t,e){if(!tH(e))return{offsetX:0,offsetY:0};let i=e.gradientTransform||e.patternTransform,r=-this.width/2+e.offsetX||0,s=-this.height/2+e.offsetY||0;return"percentage"===e.gradientUnits?t.transform(this.width,0,0,this.height,r,s):t.transform(1,0,0,1,r,s),i&&t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),{offsetX:r,offsetY:s};}_renderPaintInOrder(t){this.paintFirst===Z?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t));}_render(t){}_renderFill(t){this.fill&&(t.save(),this._setFillStyles(t,this),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore());}_renderStroke(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform){let e=this.getObjectScaling();t.scale(1/e.x,1/e.y);}this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore();}}_applyPatternForTransformedGradient(t,e){var i;let r=this._limitCacheSize(this._getCacheCanvasDimensions()),s=this.getCanvasRetinaScaling(),n=r.x/this.scaleX/s,a=r.y/this.scaleY/s,o=tx({width:Math.ceil(n),height:Math.ceil(a)}),l=o.getContext("2d");l&&(l.beginPath(),l.moveTo(0,0),l.lineTo(n,0),l.lineTo(n,a),l.lineTo(0,a),l.closePath(),l.translate(n/2,a/2),l.scale(r.zoomX/this.scaleX/s,r.zoomY/this.scaleY/s),this._applyPatternGradientTransform(l,e),l.fillStyle=e.toLive(t),l.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(s*this.scaleX/r.zoomX,s*this.scaleY/r.zoomY),t.strokeStyle=null!==(i=l.createPattern(o,"no-repeat"))&&void 0!==i?i:"");}_findCenterFromElement(){return new to(this.left+this.width/2,this.top+this.height/2);}clone(t){let e=this.toObject(t);return this.constructor.fromObject(e);}cloneAsImage(t){let e=this.toCanvasElement(t);return new(te.getClass("image"))(e);}toCanvasElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=es(this),i=this.group,r=this.shadow,s=Math.abs,n=t.enableRetinaScaling?S():1,a=(t.multiplier||1)*n,o=t.canvasProvider||(t=>new t4(t,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,t.withoutTransform&&er(this),t.withoutShadow&&(this.shadow=null),t.viewportTransform&&eh(this,this.getViewportTransform()),this.setCoords();let l=tm(),h=this.getBoundingRect(),c=this.shadow,d=new to;if(c){let t=c.blur,e=c.nonScaling?new to(1,1):this.getObjectScaling();d.x=2*Math.round(s(c.offsetX)+t)*s(e.x),d.y=2*Math.round(s(c.offsetY)+t)*s(e.y);}let u=h.width+d.x,g=h.height+d.y;l.width=Math.ceil(u),l.height=Math.ceil(g);let f=o(l);"jpeg"===t.format&&(f.backgroundColor="#fff"),this.setPositionByOrigin(new to(f.width/2,f.height/2),A,A);let p=this.canvas;f._objects=[this],this.set("canvas",f),this.setCoords();let m=f.toCanvasElement(a||1,t);return this.set("canvas",p),this.shadow=r,i&&(this.group=i),this.set(e),this.setCoords(),f._objects=[],f.destroy(),m;}toDataURL(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ty(this.toCanvasElement(t),t.format||"png",t.quality||1);}toBlob(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return tb(this.toCanvasElement(t),t.format||"png",t.quality||1);}isType(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.includes(this.constructor.type)||e.includes(this.type);}complexity(){return 1;}toJSON(){return this.toObject();}rotate(t){let{centeredRotation:e,originX:i,originY:r}=this;if(e){let{x:t,y:e}=this.getRelativeCenterPoint();this.originX=A,this.originY=A,this.left=t,this.top=e;}if(this.set("angle",t),e){let{x:t,y:e}=this.translateToOriginPoint(this.getRelativeCenterPoint(),i,r);this.left=t,this.top=e,this.originX=i,this.originY=r;}}setOnGroup(){}_setupCompositeOperation(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation);}dispose(){ti.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&w().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null;}animate(t,e){return Object.entries(t).reduce((t,i)=>{let[r,s]=i;return t[r]=this._animate(r,s,e),t;},{});}_animate(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.split("."),s=this.constructor.colorProperties.includes(r[r.length-1]),{abort:n,startValue:a,onChange:o,onComplete:l}=i,c=h(h({},i),{},{target:this,startValue:null!=a?a:r.reduce((t,e)=>t[e],this),endValue:e,abort:null==n?void 0:n.bind(this),onChange:(t,e,i)=>{r.reduce((e,i,s)=>(s===r.length-1&&(e[i]=t),e[i]),this),o&&o(t,e,i);},onComplete:(t,e,i)=>{this.setCoords(),l&&l(t,e,i);}});return s?iI(c):iL(c);}isDescendantOf(t){let{parent:e,group:i}=this;return e===t||i===t||!!e&&e.isDescendantOf(t)||!!i&&i!==e&&i.isDescendantOf(t);}getAncestors(){let t=[],e=this;do(e=e.parent)&&t.push(e);while(e)return t;}findCommonAncestors(t){if(this===t)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};let e=this.getAncestors(),i=t.getAncestors();if(0===e.length&&i.length>0&&this===i[i.length-1])return{fork:[],otherFork:[t,...i.slice(0,i.length-1)],common:[this]};for(let r,s=0;s<e.length;s++){if((r=e[s])===t)return{fork:[this,...e.slice(0,s)],otherFork:[],common:e.slice(s)};for(let n=0;n<i.length;n++){if(this===i[n])return{fork:[],otherFork:[t,...i.slice(0,n)],common:[this,...e]};if(r===i[n])return{fork:[this,...e.slice(0,s)],otherFork:[t,...i.slice(0,n)],common:e.slice(s)};}}return{fork:[this,...e],otherFork:[t,...i],common:[]};}hasCommonAncestors(t){let e=this.findCommonAncestors(t);return e&&!!e.common.length;}isInFrontOf(t){if(this===t)return;let e=this.findCommonAncestors(t);if(e.fork.includes(t))return!0;if(e.otherFork.includes(this))return!1;let i=e.common[0]||this.canvas;if(!i)return;let r=e.fork.pop(),s=e.otherFork.pop(),n=i._objects.indexOf(r),a=i._objects.indexOf(s);return n>-1&&n>a;}toObject(){let e;let i=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).concat(t.customProperties,this.constructor.customProperties||[]),r=g.NUM_FRACTION_DIGITS,{clipPath:s,fill:n,stroke:a,shadow:o,strokeDashArray:l,left:c,top:d,originX:u,originY:f,width:p,height:m,strokeWidth:v,strokeLineCap:x,strokeDashOffset:y,strokeLineJoin:b,strokeUniform:w,strokeMiterLimit:C,scaleX:_,scaleY:S,angle:j,flipX:k,flipY:O,opacity:M,visible:D,backgroundColor:E,fillRule:A,paintFirst:P,globalCompositeOperation:F,skewX:R,skewY:L}=this;s&&!s.excludeFromExport&&(e=s.toObject(i.concat("inverted","absolutePositioned")));let I=t=>tV(t,r),B=h(h({},tY(this,i)),{},{type:this.constructor.type,version:T,originX:u,originY:f,left:I(c),top:I(d),width:I(p),height:I(m),fill:tG(n)?n.toObject():n,stroke:tG(a)?a.toObject():a,strokeWidth:I(v),strokeDashArray:l?l.concat():l,strokeLineCap:x,strokeDashOffset:y,strokeLineJoin:b,strokeUniform:w,strokeMiterLimit:I(C),scaleX:I(_),scaleY:I(S),angle:I(j),flipX:k,flipY:O,opacity:I(M),shadow:o?o.toObject():o,visible:D,backgroundColor:E,fillRule:A,paintFirst:P,globalCompositeOperation:F,skewX:I(R),skewY:I(L)},e?{clipPath:e}:null);return this.includeDefaultValues?B:this._removeDefaultValues(B);}toDatalessObject(t){return this.toObject(t);}_removeDefaultValues(t){let e=this.constructor.getDefaults(),i=Object.keys(e).length>0?e:Object.getPrototypeOf(this);return tz(t,(t,e)=>{if(e===P||"top"===e||"type"===e)return!0;let r=i[e];return t!==r&&!(Array.isArray(t)&&Array.isArray(r)&&0===t.length&&0===r.length);});}toString(){return"#<".concat(this.constructor.type,">");}static _fromObject(t){let e=c(t,iX),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{extraParam:r}=i;return tX(e,c(i,iY)).then(t=>r?(delete t[r],new this(e[r],t)):new this(t));}static fromObject(t,e){return this._fromObject(t,e);}};o(iz,"stateProperties",io),o(iz,"cacheProperties",il),o(iz,"ownDefaults",{top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:P,originY:"top",strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:J,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0}),o(iz,"type","FabricObject"),o(iz,"colorProperties",[J,Z,"backgroundColor"]),o(iz,"customProperties",[]),te.setClass(iz),te.setClass(iz,"object");let iV=(t,e,i)=>(r,s,n,a)=>{let o=e(r,s,n,a);return o&&ec(t,h(h({},em(r,s,n,a)),i)),o;};function iN(t){return(e,i,r,s)=>{let{target:n,originX:a,originY:o}=i,l=n.getRelativeCenterPoint(),h=n.translateToOriginPoint(l,a,o),c=t(e,i,r,s);return n.setPositionByOrigin(h,i.originX,i.originY),c;};}let iH=iV(V,iN((t,e,i,r)=>{let s=ex(e,e.originX,e.originY,i,r);if(eu(e.originX)===eu(A)||eu(e.originX)===eu(R)&&s.x<0||eu(e.originX)===eu(P)&&s.x>0){let{target:t}=e,i=t.strokeWidth/(t.strokeUniform?t.scaleX:1),r=ef(e)?2:1,n=t.width,a=Math.abs(s.x*r/t.scaleX)-i;return t.set("width",Math.max(a,1)),n!==t.width;}return!1;}));function iG(t,e,i,r,s){r=r||{};let n=this.sizeX||r.cornerSize||s.cornerSize,a=this.sizeY||r.cornerSize||s.cornerSize,o=void 0!==r.transparentCorners?r.transparentCorners:s.transparentCorners,l=o?Z:J,h=!o&&(r.cornerStrokeColor||s.cornerStrokeColor),c,d=e,u=i;t.save(),t.fillStyle=r.cornerColor||s.cornerColor||"",t.strokeStyle=r.cornerStrokeColor||s.cornerStrokeColor||"",n>a?(c=n,t.scale(1,a/n),u=i*n/a):a>n?(c=a,t.scale(n/a,1),d=e*a/n):c=n,t.beginPath(),t.arc(d,u,c/2,0,M,!1),t[l](),h&&t.stroke(),t.restore();}function iU(t,e,i,r,s){r=r||{};let n=this.sizeX||r.cornerSize||s.cornerSize,a=this.sizeY||r.cornerSize||s.cornerSize,o=void 0!==r.transparentCorners?r.transparentCorners:s.transparentCorners,l=o?Z:J,h=!o&&(r.cornerStrokeColor||s.cornerStrokeColor),c=n/2,d=a/2;t.save(),t.fillStyle=r.cornerColor||s.cornerColor||"",t.strokeStyle=r.cornerStrokeColor||s.cornerStrokeColor||"",t.translate(e,i);let u=s.getTotalAngle();t.rotate(tw(u)),t["".concat(l,"Rect")](-c,-d,n,a),h&&t.strokeRect(-c,-d,n,a),t.restore();}class i${constructor(t){o(this,"visible",!0),o(this,"actionName",G),o(this,"angle",0),o(this,"x",0),o(this,"y",0),o(this,"offsetX",0),o(this,"offsetY",0),o(this,"sizeX",0),o(this,"sizeY",0),o(this,"touchSizeX",0),o(this,"touchSizeY",0),o(this,"cursorStyle","crosshair"),o(this,"withConnection",!1),Object.assign(this,t);}shouldActivate(t,e,i,r){var s;let{tl:n,tr:a,br:o,bl:l}=r;return(null===(s=e.canvas)||void 0===s?void 0:s.getActiveObject())===e&&e.isControlVisible(t)&&iB.isPointInPolygon(i,[n,a,o,l]);}getActionHandler(t,e,i){return this.actionHandler;}getMouseDownHandler(t,e,i){return this.mouseDownHandler;}getMouseUpHandler(t,e,i){return this.mouseUpHandler;}cursorStyleHandler(t,e,i){return e.cursorStyle;}getActionName(t,e,i){return e.actionName;}getVisibility(t,e){var i,r;return null!==(i=null===(r=t._controlsVisibility)||void 0===r?void 0:r[e])&&void 0!==i?i:this.visible;}setVisibility(t,e,i){this.visible=t;}positionHandler(t,e,i,r){return new to(this.x*t.x+this.offsetX,this.y*t.y+this.offsetY).transform(e);}calcCornerCoords(t,e,i,r,s,n){let a=tk([tD(i,r),tE({angle:t}),tA((s?this.touchSizeX:this.sizeX)||e,(s?this.touchSizeY:this.sizeY)||e)]);return{tl:new to(-.5,-.5).transform(a),tr:new to(.5,-.5).transform(a),br:new to(.5,.5).transform(a),bl:new to(-.5,.5).transform(a)};}render(t,e,i,r,s){"circle"===((r=r||{}).cornerStyle||s.cornerStyle)?iG.call(this,t,e,i,r,s):iU.call(this,t,e,i,r,s);}}let iq=(t,e,i)=>i.lockRotation?eg:e.cursorStyle,iK=iV(X,iN((t,e,i,r)=>{let{target:s,ex:n,ey:a,theta:o,originX:l,originY:h}=e,c=s.translateToOriginPoint(s.getRelativeCenterPoint(),l,h);if(ep(s,"lockRotation"))return!1;let d=Math.atan2(a-c.y,n-c.x),u=tC(Math.atan2(r-c.y,i-c.x)-d+o);if(s.snapAngle&&s.snapAngle>0){let t=s.snapAngle,e=s.snapThreshold||t,i=Math.ceil(u/t)*t,r=Math.floor(u/t)*t;Math.abs(u-r)<e?u=r:Math.abs(u-i)<e&&(u=i);}u<0&&(u=360+u),u%=360;let g=s.angle!==u;return s.angle=u,g;}));function iJ(t,e){let i=e.canvas,r=t[i.uniScaleKey];return i.uniformScaling&&!r||!i.uniformScaling&&r;}function iZ(t,e,i){let r=ep(t,"lockScalingX"),s=ep(t,"lockScalingY");if(r&&s||!e&&(r||s)&&i||r&&"x"===e||s&&"y"===e)return!0;let{width:n,height:a,strokeWidth:o}=t;return 0===n&&0===o&&"y"!==e||0===a&&0===o&&"x"!==e;}let iQ=["e","se","s","sw","w","nw","n","ne","e"],i0=(t,e,i)=>{let r=iJ(t,i);if(iZ(i,0!==e.x&&0===e.y?"x":0===e.x&&0!==e.y?"y":"",r))return eg;let s=ev(i,e);return"".concat(iQ[s],"-resize");};function i1(t,e,i,r){let s,n,a,o,l,h,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},d=e.target,u=c.by,g=iJ(t,d);if(iZ(d,u,g))return!1;if(e.gestureScale)n=e.scaleX*e.gestureScale,a=e.scaleY*e.gestureScale;else{if(s=ex(e,e.originX,e.originY,i,r),l="y"!==u?Math.sign(s.x||e.signX||1):1,h="x"!==u?Math.sign(s.y||e.signY||1):1,e.signX||(e.signX=l),e.signY||(e.signY=h),ep(d,"lockScalingFlip")&&(e.signX!==l||e.signY!==h))return!1;if(o=d._getTransformedDimensions(),g&&!u){let t=Math.abs(s.x)+Math.abs(s.y),{original:i}=e,r=t/(Math.abs(o.x*i.scaleX/d.scaleX)+Math.abs(o.y*i.scaleY/d.scaleY));n=i.scaleX*r,a=i.scaleY*r;}else n=Math.abs(s.x*d.scaleX/o.x),a=Math.abs(s.y*d.scaleY/o.y);ef(e)&&(n*=2,a*=2),e.signX!==l&&"y"!==u&&(e.originX=.5-eu(e.originX),n*=-1,e.signX=l),e.signY!==h&&"x"!==u&&(e.originY=.5-eu(e.originY),a*=-1,e.signY=h);}let f=d.scaleX,p=d.scaleY;return u?("x"===u&&d.set(U,n),"y"===u&&d.set($,a)):(ep(d,"lockScalingX")||d.set(U,n),ep(d,"lockScalingY")||d.set($,a)),f!==d.scaleX||p!==d.scaleY;}let i2=iV(W,iN((t,e,i,r)=>i1(t,e,i,r))),i5=iV(W,iN((t,e,i,r)=>i1(t,e,i,r,{by:"x"}))),i4=iV(W,iN((t,e,i,r)=>i1(t,e,i,r,{by:"y"}))),i3=["target","ex","ey","skewingSide"],i6={x:{counterAxis:"y",scale:U,skew:q,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:$,skew:K,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},i8=["ns","nesw","ew","nwse"],i7=(t,e,i)=>{if(0!==e.x&&ep(i,"lockSkewingY")||0!==e.y&&ep(i,"lockSkewingX"))return eg;let r=ev(i,e)%4;return"".concat(i8[r],"-resize");};function i9(t,e,i,r,s){let{target:n}=i,{counterAxis:a,origin:o,lockSkewing:l,skew:d,flip:u}=i6[t];if(ep(n,l))return!1;let{origin:g,flip:f}=i6[a],p=-Math.sign(eu(i[g])*(n[f]?-1:1))*(n[u]?-1:1),m=-(.5*((0===n[d]&&ex(i,A,A,r,s)[t]>0||n[d]>0?1:-1)*p))+.5;return iV(z,iN((e,i,r,s)=>(function(t,e,i){let{target:r,ex:s,ey:n,skewingSide:a}=e,o=c(e,i3),{skew:l}=i6[t],h=i.subtract(new to(s,n)).divide(new to(r.scaleX,r.scaleY))[t],d=r[l],u=Math.tan(tw(o[l])),g=tC(Math.atan(2*h*a/Math.max("y"===t?r._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:r._getTransformedDimensions({scaleX:1,scaleY:1}).y,1)+u));r.set(l,g);let f=d!==r[l];if(f&&"y"===t){let{skewX:t,scaleX:e}=r,i=r._getTransformedDimensions({skewY:d}),s=r._getTransformedDimensions(),n=0!==t?i.x/s.x:1;1!==n&&r.set(U,n*e);}return f;})(t,i,new to(r,s))))(e,h(h({},i),{},{[o]:m,skewingSide:p}),r,s);}let rt=(t,e,i,r)=>i9("x",t,e,i,r),re=(t,e,i,r)=>i9("y",t,e,i,r);function ri(t,e){return t[e.canvas.altActionKey];}let rr=(t,e,i)=>{let r=ri(t,i);return 0===e.x?r?q:$:0===e.y?r?K:U:"";},rs=(t,e,i)=>ri(t,i)?i7(0,e,i):i0(t,e,i),rn=(t,e,i,r)=>ri(t,e.target)?re(t,e,i,r):i5(t,e,i,r),ra=(t,e,i,r)=>ri(t,e.target)?rt(t,e,i,r):i4(t,e,i,r),ro=()=>({ml:new i$({x:-.5,y:0,cursorStyleHandler:rs,actionHandler:rn,getActionName:rr}),mr:new i$({x:.5,y:0,cursorStyleHandler:rs,actionHandler:rn,getActionName:rr}),mb:new i$({x:0,y:.5,cursorStyleHandler:rs,actionHandler:ra,getActionName:rr}),mt:new i$({x:0,y:-.5,cursorStyleHandler:rs,actionHandler:ra,getActionName:rr}),tl:new i$({x:-.5,y:-.5,cursorStyleHandler:i0,actionHandler:i2}),tr:new i$({x:.5,y:-.5,cursorStyleHandler:i0,actionHandler:i2}),bl:new i$({x:-.5,y:.5,cursorStyleHandler:i0,actionHandler:i2}),br:new i$({x:.5,y:.5,cursorStyleHandler:i0,actionHandler:i2}),mtr:new i$({x:0,y:-.5,actionHandler:iK,cursorStyleHandler:iq,offsetY:-40,withConnection:!0,actionName:Y})}),rl=()=>({mr:new i$({x:.5,y:0,actionHandler:iH,cursorStyleHandler:rs,actionName:V}),ml:new i$({x:-.5,y:0,actionHandler:iH,cursorStyleHandler:rs,actionName:V})}),rh=()=>h(h({},ro()),rl());class rc extends iz{static getDefaults(){return h(h({},super.getDefaults()),rc.ownDefaults);}constructor(t){super(),Object.assign(this,this.constructor.createControls(),rc.ownDefaults),this.setOptions(t);}static createControls(){return{controls:ro()};}_updateCacheCanvas(){let t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){let e=t._currentTransform,i=e.target,r=e.action;if(this===i&&r&&r.startsWith(G))return!1;}return super._updateCacheCanvas();}getActiveControl(){let t=this.__corner;return t?{key:t,control:this.controls[t],coord:this.oCoords[t]}:void 0;}findControl(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;let i=Object.entries(this.oCoords);for(let r=i.length-1;r>=0;r--){let[s,n]=i[r],a=this.controls[s];if(a.shouldActivate(s,this,t,e?n.touchCorner:n.corner))return this.__corner=s,{key:s,control:a,coord:this.oCoords[s]};}}calcOCoords(){let t=this.getViewportTransform(),e=this.getCenterPoint(),i=tT(tD(e.x,e.y),tE({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)})),r=tT(t,i),s=tT(r,[1/t[0],0,0,1/t[3],0,0]),n=this.group?tM(this.calcTransformMatrix()):void 0;n&&(n.scaleX=Math.abs(n.scaleX),n.scaleY=Math.abs(n.scaleY));let a=this._calculateCurrentDimensions(n),o={};return this.forEachControl((t,e)=>{let i=t.positionHandler(a,s,this,t);o[e]=Object.assign(i,this._calcCornerCoords(t,i));}),o;}_calcCornerCoords(t,e){let i=this.getTotalAngle();return{corner:t.calcCornerCoords(i,this.cornerSize,e.x,e.y,!1,this),touchCorner:t.calcCornerCoords(i,this.touchCornerSize,e.x,e.y,!0,this)};}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords());}forEachControl(t){for(let e in this.controls)t(this.controls[e],e,this);}drawSelectionBackground(t){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;t.save();let e=this.getRelativeCenterPoint(),i=this._calculateCurrentDimensions(),r=this.getViewportTransform();t.translate(e.x,e.y),t.scale(1/r[0],1/r[3]),t.rotate(tw(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-i.x/2,-i.y/2,i.x,i.y),t.restore();}strokeBorders(t,e){t.strokeRect(-e.x/2,-e.y/2,e.x,e.y);}_drawBorders(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=h({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},i);t.save(),t.strokeStyle=r.borderColor,this._setLineDash(t,r.borderDashArray),this.strokeBorders(t,e),r.hasControls&&this.drawControlsConnectingLines(t,e),t.restore();}_renderControls(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{hasBorders:i,hasControls:r}=this,s=h({hasBorders:i,hasControls:r},e),n=this.getViewportTransform(),a=s.hasBorders,o=s.hasControls,l=tM(tT(n,this.calcTransformMatrix()));t.save(),t.translate(l.translateX,l.translateY),t.lineWidth=this.borderScaleFactor,this.group===this.parent&&(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(l.angle-=180),t.rotate(tw(this.group?l.angle:this.angle)),a&&this.drawBorders(t,l,e),o&&this.drawControls(t,e),t.restore();}drawBorders(t,e,i){let r;if(i&&i.forActiveSelection||this.group){let t=en(this.width,this.height,tL(e)),i=this.isStrokeAccountedForInDimensions()?tl:(this.strokeUniform?(new to).scalarAdd(this.canvas?this.canvas.getZoom():1):new to(e.scaleX,e.scaleY)).scalarMultiply(this.strokeWidth);r=t.add(i).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding);}else r=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(t,r,i);}drawControlsConnectingLines(t,e){let i=!1;t.beginPath(),this.forEachControl((r,s)=>{r.withConnection&&r.getVisibility(this,s)&&(i=!0,t.moveTo(r.x*e.x,r.y*e.y),t.lineTo(r.x*e.x+r.offsetX,r.y*e.y+r.offsetY));}),i&&t.stroke();}drawControls(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.save();let i=this.getCanvasRetinaScaling(),{cornerStrokeColor:r,cornerDashArray:s,cornerColor:n}=this,a=h({cornerStrokeColor:r,cornerDashArray:s,cornerColor:n},e);t.setTransform(i,0,0,i,0,0),t.strokeStyle=t.fillStyle=a.cornerColor,this.transparentCorners||(t.strokeStyle=a.cornerStrokeColor),this._setLineDash(t,a.cornerDashArray),this.forEachControl((e,i)=>{if(e.getVisibility(this,i)){let r=this.oCoords[i];e.render(t,r.x,r.y,a,this);}}),t.restore();}isControlVisible(t){return this.controls[t]&&this.controls[t].getVisibility(this,t);}setControlVisible(t,e){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e;}setControlsVisibility(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.entries(t).forEach(t=>{let[e,i]=t;return this.setControlVisible(e,i);});}clearContextTop(t){if(!this.canvas)return;let e=this.canvas.contextTop;if(!e)return;let i=this.canvas.viewportTransform;e.save(),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(e);let r=this.width+4,s=this.height+4;return e.clearRect(-r/2,-s/2,r,s),t||e.restore(),e;}onDeselect(t){return!1;}onSelect(t){return!1;}shouldStartDragging(t){return!1;}onDragStart(t){return!1;}canDrop(t){return!1;}renderDragSourceEffect(t){}renderDropTargetEffect(t){}}function rd(t,e){return e.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(i=>{"constructor"!==i&&Object.defineProperty(t.prototype,i,Object.getOwnPropertyDescriptor(e.prototype,i)||Object.create(null));});}),t;}o(rc,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class ru extends rc{}rd(ru,[eE]),te.setClass(ru),te.setClass(ru,"object");let rg=(t,e,i,r)=>{let s=2*(r=Math.round(r))+1,{data:n}=t.getImageData(e-r,i-r,s,s);for(let t=3;t<n.length;t+=4)if(n[t]>0)return!1;return!0;};class rf{constructor(t){this.options=t,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new to(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new to(1/this.options.scaleX,1/this.options.scaleY):new to(1,1);}createSideVector(t,e){let i=e5(t,e);return this.options.strokeUniform?i.multiply(this.scale):i;}projectOrthogonally(t,e,i){return this.applySkew(t.add(this.calcOrthogonalProjection(t,e,i)));}isSkewed(){return 0!==this.options.skewX||0!==this.options.skewY;}applySkew(t){let e=new to(t);return e.y+=e.x*Math.tan(tw(this.options.skewY)),e.x+=e.y*Math.tan(tw(this.options.skewX)),e;}scaleUnitVector(t,e){return t.multiply(this.strokeUniformScalar).scalarMultiply(e);}}let rp=new to;class rm extends rf{static getOrthogonalRotationFactor(t,e){return Math.abs(e?e3(t,e):e6(t))<O?-1:1;}constructor(t,e,i,r){super(r),o(this,"AB",void 0),o(this,"AC",void 0),o(this,"alpha",void 0),o(this,"bisector",void 0),this.A=new to(t),this.B=new to(e),this.C=new to(i),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=e3(this.AB,this.AC),this.bisector=e8(e2(this.AB.eq(rp)?this.AC:this.AB,this.alpha/2));}calcOrthogonalProjection(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude,r=e7(this.createSideVector(t,e)),s=rm.getOrthogonalRotationFactor(r,this.bisector);return this.scaleUnitVector(r,i*s);}projectBevel(){let t=[];return(this.alpha%M==0?[this.B]:[this.B,this.C]).forEach(e=>{t.push(this.projectOrthogonally(this.A,e)),t.push(this.projectOrthogonally(this.A,e,-this.strokeProjectionMagnitude));}),t;}projectMiter(){let t=[],e=1/Math.sin(Math.abs(this.alpha)/2),i=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*e),r=this.options.strokeUniform?e4(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return e4(i)/this.strokeProjectionMagnitude<=r&&t.push(this.applySkew(this.A.add(i))),t.push(...this.projectBevel()),t;}projectRoundNoSkew(t,e){let i=[],r=new to(rm.getOrthogonalRotationFactor(this.bisector),rm.getOrthogonalRotationFactor(new to(this.bisector.y,this.bisector.x)));return[new to(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(r),new to(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(r)].forEach(r=>{ie(r,t,e)&&i.push(this.A.add(r));}),i;}projectRoundWithSkew(t,e){let i=[],{skewX:r,skewY:s,scaleX:n,scaleY:a,strokeUniform:o}=this.options,l=new to(Math.tan(tw(r)),Math.tan(tw(s))),h=this.strokeProjectionMagnitude,c=o?h/a/Math.sqrt(1/a**2+1/n**2*l.y**2):h/Math.sqrt(1+l.y**2),d=new to(Math.sqrt(Math.max(h**2-c**2,0)),c),u=o?h/Math.sqrt(1+l.x**2*(1/a)**2/(1/n+1/n*l.x*l.y)**2):h/Math.sqrt(1+l.x**2/(1+l.x*l.y)**2),g=new to(u,Math.sqrt(Math.max(h**2-u**2,0)));return[g,g.scalarMultiply(-1),d,d.scalarMultiply(-1)].map(t=>this.applySkew(o?t.multiply(this.strokeUniformScalar):t)).forEach(r=>{ie(r,t,e)&&i.push(this.applySkew(this.A).add(r));}),i;}projectRound(){let t=[];t.push(...this.projectBevel());let e=this.alpha%M==0,i=this.applySkew(this.A),r=t[e?0:2].subtract(i),s=t[e?1:0].subtract(i),n=e9(r,e?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)))>0,a=n?r:s,o=n?s:r;return this.isSkewed()?t.push(...this.projectRoundWithSkew(a,o)):t.push(...this.projectRoundNoSkew(a,o)),t;}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel();}}project(){return this.projectPoints().map(t=>({originPoint:this.A,projectedPoint:t,angle:this.alpha,bisector:this.bisector}));}}class rv extends rf{constructor(t,e,i){super(i),this.A=new to(t),this.T=new to(e);}calcOrthogonalProjection(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude,r=this.createSideVector(t,e);return this.scaleUnitVector(e7(r),i);}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)];}projectRound(){let t=[];if(!this.isSkewed()&&this.A.eq(this.T)){let e=new to(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.applySkew(this.A.add(e)),this.applySkew(this.A.subtract(e)));}else t.push(...new rm(this.A,this.T,this.T,this.options).projectRound());return t;}projectSquare(){let t=[];if(this.A.eq(this.T)){let e=new to(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.A.add(e),this.A.subtract(e));}else{let e=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),i=this.scaleUnitVector(e8(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),r=this.A.add(i);t.push(r.add(e),r.subtract(e));}return t.map(t=>this.applySkew(t));}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt();}}project(){return this.projectPoints().map(t=>({originPoint:this.A,projectedPoint:t}));}}let rx=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[];if(0===t.length)return r;let s=t.reduce((t,e)=>(t[t.length-1].eq(e)||t.push(new to(e)),t),[new to(t[0])]);if(1===s.length)i=!0;else if(!i){let t=s[0],e=((t,e)=>{for(let i=t.length-1;i>=0;i--)if(e(t[i],i,t))return i;return -1;})(s,e=>!e.eq(t));s.splice(e+1);}return s.forEach((t,s,n)=>{let a,o;0===s?(o=n[1],a=i?t:n[n.length-1]):s===n.length-1?(a=n[s-1],o=i?t:n[0]):(a=n[s-1],o=n[s+1]),i&&1===n.length?r.push(...new rv(t,t,e).project()):i&&(0===s||s===n.length-1)?r.push(...new rv(t,0===s?o:a,e).project()):r.push(...new rm(t,a,o,e).project());}),r;},ry=t=>{let e={};return Object.keys(t).forEach(i=>{e[i]={},Object.keys(t[i]).forEach(r=>{e[i][r]=h({},t[i][r]);});}),e;},rb=t=>t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),rw=t=>(s||s||(s="Intl"in _()&&"Segmenter"in Intl&&new Intl.Segmenter(void 0,{granularity:"grapheme"})),s)?Array.from(s.segment(t)).map(t=>{let{segment:e}=t;return e;}):rC(t),rC=t=>{let e=[];for(let i,r=0;r<t.length;r++)!1!==(i=r_(t,r))&&e.push(i);return e;},r_=(t,e)=>{let i=t.charCodeAt(e);if(isNaN(i))return"";if(i<55296||i>57343)return t.charAt(e);if(55296<=i&&i<=56319){if(t.length<=e+1)throw"High surrogate without following low surrogate";let i=t.charCodeAt(e+1);if(56320>i||i>57343)throw"High surrogate without following low surrogate";return t.charAt(e)+t.charAt(e+1);}if(0===e)throw"Low surrogate without preceding high surrogate";let r=t.charCodeAt(e-1);if(55296>r||r>56319)throw"Low surrogate without preceding high surrogate";return!1;};var rS=Object.freeze({__proto__:null,capitalize:function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"".concat(t.charAt(0).toUpperCase()).concat(e?t.slice(1):t.slice(1).toLowerCase());},escapeXml:rb,graphemeSplit:rw});let rj=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.fill!==e.fill||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth||t.fontSize!==e.fontSize||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.textDecorationThickness!==e.textDecorationThickness||t.textBackgroundColor!==e.textBackgroundColor||t.deltaY!==e.deltaY||i&&(t.overline!==e.overline||t.underline!==e.underline||t.linethrough!==e.linethrough);},rT=(t,e)=>{let i=e.split("\n"),r=[],s=-1,n={};t=ry(t);for(let e=0;e<i.length;e++){let a=rw(i[e]);if(t[e])for(let i=0;i<a.length;i++){s++;let a=t[e][i];a&&Object.keys(a).length>0&&(rj(n,a,!0)?r.push({start:s,end:s+1,style:a}):r[r.length-1].end++),n=a||{};}else s+=a.length,n={};}return r;},rk=(t,e)=>{if(!Array.isArray(t))return ry(t);let i=e.split(I),r={},s=-1,n=0;for(let e=0;e<i.length;e++){let a=rw(i[e]);for(let i=0;i<a.length;i++)s++,t[n]&&t[n].start<=s&&s<t[n].end&&(r[e]=r[e]||{},r[e][i]=h({},t[n].style),s===t[n].end-1&&n++);}return r;},rO=["display","transform",J,"fill-opacity","fill-rule","opacity",Z,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function rM(t,e){let i;let r=t.nodeName,s=t.getAttribute("class"),n=t.getAttribute("id"),a="(?![a-zA-Z\\-]+)";if(i=RegExp("^"+r,"i"),e=e.replace(i,""),n&&e.length&&(i=RegExp("#"+n+a,"i"),e=e.replace(i,"")),s&&e.length){let t=s.split(" ");for(let r=t.length;r--;)i=RegExp("\\."+t[r]+a,"i"),e=e.replace(i,"");}return 0===e.length;}let rD=t=>{var e;return null!==(e=eU[t])&&void 0!==e?e:t;},rE=RegExp("(".concat(eV,")"),"gi"),rA=t=>eb(t.replace(rE," $1 ").replace(/,/gi," ")),rP="(".concat(eV,")"),rF=String.raw(ix||(ix=d(["(skewX)(",")"],["(skewX)\\(","\\)"])),rP),rR=String.raw(iy||(iy=d(["(skewY)(",")"],["(skewY)\\(","\\)"])),rP),rL=String.raw(ib||(ib=d(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),rP,rP,rP),rI=String.raw(iw||(iw=d(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),rP,rP),rB=String.raw(iC||(iC=d(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),rP,rP),rW=String.raw(i_||(i_=d(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),rP,rP,rP,rP,rP,rP),rX="(?:".concat(rW,"|").concat(rB,"|").concat(rL,"|").concat(rI,"|").concat(rF,"|").concat(rR,")"),rY=new RegExp(String.raw(iS||(iS=d(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),"(?:".concat(rX,"*)"))),rz=new RegExp(rX),rV=RegExp(rX,"g");function rN(t){let e=[];if(!(t=rA(t).replace(/\s*([()])\s*/gi,"$1"))||t&&!rY.test(t))return[...E];for(let i of t.matchAll(rV)){let t=rz.exec(i[0]);if(!t)continue;let r=E,[,s,...n]=t.filter(t=>!!t),[a,o,l,h,c,d]=n.map(t=>parseFloat(t));switch(s){case"translate":r=tD(a,o);break;case Y:r=tE({angle:a},{x:o,y:l});break;case G:r=tA(a,o);break;case q:r=tF(a);break;case K:r=tR(a);break;case"matrix":r=[a,o,l,h,c,d];}e.push(r);}return tk(e);}function rH(t,e){let i=t.match(eG);if(!i)return;let r=i[1],s=i[3],n=i[4],a=i[5],o=i[6];r&&(e.fontStyle=r),s&&(e.fontWeight=isNaN(parseFloat(s))?s:parseFloat(s)),n&&(e.fontSize=eO(n)),o&&(e.fontFamily=o),a&&(e.lineHeight="normal"===a?1:a);}function rG(t,e){t.replace(/;\s*$/,"").split(";").forEach(t=>{if(!t)return;let[i,r]=t.split(":");e[i.trim().toLowerCase()]=r.trim();});}function rU(t){let e={},i=t.getAttribute("style");return i&&("string"==typeof i?rG(i,e):function(t,e){Object.entries(t).forEach(t=>{let[i,r]=t;void 0!==r&&(e[i.toLowerCase()]=r);});}(i,e)),e;}let r$={stroke:"strokeOpacity",fill:"fillOpacity"};function rq(t,e,i){if(!t)return{};let r,s={},n=16;t.parentNode&&eZ.test(t.parentNode.nodeName)&&(s=rq(t.parentElement,e,i)).fontSize&&(r=n=eO(s.fontSize));let a=h(h(h({},e.reduce((e,i)=>{let r=t.getAttribute(i);return r&&(e[i]=r),e;},{})),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i={};for(let r in e)(function(t,e){let i=!0,r=rM(t,e.pop());return r&&e.length&&(i=function(t,e){let i,r=!0;for(;t.parentElement&&1===t.parentElement.nodeType&&e.length;)r&&(i=e.pop()),r=rM(t=t.parentElement,i);return 0===e.length;}(t,e)),r&&i&&0===e.length;})(t,r.split(" "))&&(i=h(h({},i),e[r]));return i;}(t,i)),rU(t));a[eq]&&t.setAttribute(eq,a[eq]),a[e$]&&(r=eO(a[e$],n),a[e$]="".concat(r));let o={};for(let t in a){let e=rD(t),i=function(t,e,i,r){let s=Array.isArray(e),n,a=e;if(t!==J&&t!==Z||e!==L){if("strokeUniform"===t)return"non-scaling-stroke"===e;if("strokeDashArray"===t)a=e===L?null:e.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===t)a=i&&i.transformMatrix?tT(i.transformMatrix,rN(e)):rN(e);else if("visible"===t)a=e!==L&&"hidden"!==e,i&&!1===i.visible&&(a=!1);else if("opacity"===t)a=parseFloat(e),i&&void 0!==i.opacity&&(a*=i.opacity);else if("textAnchor"===t)a="start"===e?P:"end"===e?R:A;else if("charSpacing"===t||t===eP)n=eO(e,r)/r*1e3;else if("paintFirst"===t){let t=e.indexOf(J),i=e.indexOf(Z);a=J,(t>-1&&i>-1&&i<t||-1===t&&i>-1)&&(a=Z);}else{if("href"===t||"xlink:href"===t||"font"===t||"id"===t)return e;if("imageSmoothing"===t)return"optimizeQuality"===e;n=s?e.map(eO):eO(e,r);}}else a="";return!s&&isNaN(n)?a:n;}(e,a[t],s,r);o[e]=i;}o&&o.font&&rH(o.font,o);let l=h(h({},s),o);return eZ.test(t.nodeName)?l:function(t){let e=ru.getDefaults();return Object.entries(r$).forEach(i=>{let[r,s]=i;if(void 0===t[s]||""===t[r])return;if(void 0===t[r]){if(!e[r])return;t[r]=e[r];}if(0===t[r].indexOf("url("))return;let n=new ek(t[r]);t[r]=n.setAlpha(tV(n.getAlpha()*t[s],2)).toRgba();}),t;}(l);}let rK=["left","top","width","height","visible"],rJ=["rx","ry"];class rZ extends ru{static getDefaults(){return h(h({},super.getDefaults()),rZ.ownDefaults);}constructor(t){super(),Object.assign(this,rZ.ownDefaults),this.setOptions(t),this._initRxRy();}_initRxRy(){let{rx:t,ry:e}=this;t&&!e?this.ry=t:e&&!t&&(this.rx=e);}_render(t){let{width:e,height:i}=this,r=-e/2,s=-i/2,n=this.rx?Math.min(this.rx,e/2):0,a=this.ry?Math.min(this.ry,i/2):0,o=0!==n||0!==a;t.beginPath(),t.moveTo(r+n,s),t.lineTo(r+e-n,s),o&&t.bezierCurveTo(r+e-.4477152502*n,s,r+e,s+.4477152502*a,r+e,s+a),t.lineTo(r+e,s+i-a),o&&t.bezierCurveTo(r+e,s+i-.4477152502*a,r+e-.4477152502*n,s+i,r+e-n,s+i),t.lineTo(r+n,s+i),o&&t.bezierCurveTo(r+.4477152502*n,s+i,r,s+i-.4477152502*a,r,s+i-a),t.lineTo(r,s+a),o&&t.bezierCurveTo(r,s+.4477152502*a,r+.4477152502*n,s,r+n,s),t.closePath(),this._renderPaintInOrder(t);}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...rJ,...t]);}_toSVG(){let{width:t,height:e,rx:i,ry:r}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-t/2,'" y="').concat(-e/2,'" rx="').concat(i,'" ry="').concat(r,'" width="').concat(t,'" height="').concat(e,'" />\n')];}static async fromElement(t,e,i){let r=rq(t,this.ATTRIBUTE_NAMES,i),{left:s=0,top:n=0,width:a=0,height:o=0,visible:l=!0}=r,d=c(r,rK);return new this(h(h(h({},e),d),{},{left:s,top:n,width:a,height:o,visible:!!(l&&a&&o)}));}}o(rZ,"type","Rect"),o(rZ,"cacheProperties",[...il,...rJ]),o(rZ,"ownDefaults",{rx:0,ry:0}),o(rZ,"ATTRIBUTE_NAMES",[...rO,"x","y","rx","ry","width","height"]),te.setClass(rZ),te.setSVGClass(rZ);let rQ="initialization",r0="added",r1="removed",r2="imperative",r5=(t,e)=>{let{strokeUniform:i,strokeWidth:r,width:s,height:n,group:a}=e,o=a&&a!==t?ea(a.calcTransformMatrix(),t.calcTransformMatrix()):null,l=o?e.getRelativeCenterPoint().transform(o):e.getRelativeCenterPoint(),h=!e.isStrokeAccountedForInDimensions(),c=i&&h?el(new to(r,r),void 0,t.calcTransformMatrix()):tl,d=!i&&h?r:0,u=en(s+d,n+d,tk([o,e.calcOwnMatrix()],!0)).add(c).scalarDivide(2);return[l.subtract(u),l.add(u)];};class r4{calcLayoutResult(t,e){if(this.shouldPerformLayout(t))return this.calcBoundingBox(e,t);}shouldPerformLayout(t){let{type:e,prevStrategy:i,strategy:r}=t;return e===rQ||e===r2||!!i&&r!==i;}shouldLayoutClipPath(t){let{type:e,target:{clipPath:i}}=t;return e!==rQ&&i&&!i.absolutePositioned;}getInitialSize(t,e){return e.size;}calcBoundingBox(t,e){let{type:i,target:r}=e;if(i===r2&&e.overrides)return e.overrides;if(0===t.length)return;let{left:s,top:n,width:a,height:o}=t9(t.map(t=>r5(r,t)).reduce((t,e)=>t.concat(e),[])),l=new to(a,o),h=new to(s,n).add(l.scalarDivide(2));if(i===rQ){let t=this.getInitialSize(e,{size:l,center:h});return{center:h,relativeCorrection:new to(0,0),size:t};}return{center:h.transform(r.calcOwnMatrix()),size:l};}}o(r4,"type","strategy");class r3 extends r4{shouldPerformLayout(t){return!0;}}o(r3,"type","fit-content"),te.setClass(r3);let r6=["strategy"],r8=["target","strategy","bubbles","prevStrategy"],r7="layoutManager";class r9{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new r3;o(this,"strategy",void 0),this.strategy=t,this._subscriptions=new Map;}performLayout(t){let e=h(h({bubbles:!0,strategy:this.strategy},t),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1;}});this.onBeforeLayout(e);let i=this.getLayoutResult(e);i&&this.commitLayout(e,i),this.onAfterLayout(e,i),this._prevLayoutStrategy=e.strategy;}attachHandlers(t,e){let{target:i}=e;return[Q,B,V,X,W,z,H,N,"modifyPath"].map(e=>t.on(e,t=>this.performLayout(e===Q?{type:"object_modified",trigger:e,e:t,target:i}:{type:"object_modifying",trigger:e,e:t,target:i})));}subscribe(t,e){this.unsubscribe(t,e);let i=this.attachHandlers(t,e);this._subscriptions.set(t,i);}unsubscribe(t,e){(this._subscriptions.get(t)||[]).forEach(t=>t()),this._subscriptions.delete(t);}unsubscribeTargets(t){t.targets.forEach(e=>this.unsubscribe(e,t));}subscribeTargets(t){t.targets.forEach(e=>this.subscribe(e,t));}onBeforeLayout(t){let{target:e,type:i}=t,{canvas:r}=e;if(i===rQ||i===r0?this.subscribeTargets(t):i===r1&&this.unsubscribeTargets(t),e.fire("layout:before",{context:t}),r&&r.fire("object:layout:before",{target:e,context:t}),i===r2&&t.deep){let i=c(t,r6);e.forEachObject(t=>t.layoutManager&&t.layoutManager.performLayout(h(h({},i),{},{bubbles:!1,target:t})));}}getLayoutResult(t){let{target:e,strategy:i,type:r}=t,s=i.calcLayoutResult(t,e.getObjects());if(!s)return;let n=r===rQ?new to:e.getRelativeCenterPoint(),{center:a,correction:o=new to,relativeCorrection:l=new to}=s,h=n.subtract(a).add(o).transform(r===rQ?E:tj(e.calcOwnMatrix()),!0).add(l);return{result:s,prevCenter:n,nextCenter:a,offset:h};}commitLayout(t,e){var i,r;let{target:s}=t,{result:{size:n},nextCenter:a}=e;(s.set({width:n.x,height:n.y}),this.layoutObjects(t,e),t.type===rQ)?s.set({left:null!==(i=t.x)&&void 0!==i?i:a.x+n.x*eu(s.originX),top:null!==(r=t.y)&&void 0!==r?r:a.y+n.y*eu(s.originY)}):(s.setPositionByOrigin(a,A,A),s.setCoords(),s.set("dirty",!0));}layoutObjects(t,e){let{target:i}=t;i.forEachObject(r=>{r.group===i&&this.layoutObject(t,e,r);}),t.strategy.shouldLayoutClipPath(t)&&this.layoutObject(t,e,i.clipPath);}layoutObject(t,e,i){let{offset:r}=e;i.set({left:i.left+r.x,top:i.top+r.y});}onAfterLayout(t,e){let{target:i,strategy:r,bubbles:s,prevStrategy:n}=t,a=c(t,r8),{canvas:o}=i;i.fire("layout:after",{context:t,result:e}),o&&o.fire("object:layout:after",{context:t,result:e,target:i});let l=i.parent;s&&null!=l&&l.layoutManager&&((a.path||(a.path=[])).push(i),l.layoutManager.performLayout(h(h({},a),{},{target:l}))),i.set("dirty",!0);}dispose(){let{_subscriptions:t}=this;t.forEach(t=>t.forEach(t=>t())),t.clear();}toObject(){return{type:r7,strategy:this.strategy.constructor.type};}toJSON(){return this.toObject();}}te.setClass(r9,r7);let st=["type","objects","layoutManager"];class se extends r9{performLayout(){}}class si extends tc(ru){static getDefaults(){return h(h({},super.getDefaults()),si.ownDefaults);}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),o(this,"_activeObjects",[]),o(this,"__objectSelectionTracker",void 0),o(this,"__objectSelectionDisposer",void 0),Object.assign(this,si.ownDefaults),this.setOptions(e),this.groupInit(t,e);}groupInit(t,e){var i;this._objects=[...t],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject(t=>{this.enterGroup(t,!1);}),this.layoutManager=null!==(i=e.layoutManager)&&void 0!==i?i:new r9,this.layoutManager.performLayout({type:rQ,target:this,targets:[...t],x:e.left,y:e.top});}canEnterGroup(t){return t===this||this.isDescendantOf(t)?(f("error","Group: circular object trees are not supported, this call has no effect"),!1):-1===this._objects.indexOf(t)||(f("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1);}_filterObjectsBeforeEnteringGroup(t){return t.filter((t,e,i)=>this.canEnterGroup(t)&&i.indexOf(t)===e);}add(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];let r=this._filterObjectsBeforeEnteringGroup(e),s=super.add(...r);return this._onAfterObjectsChange(r0,r),s;}insertAt(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];let s=this._filterObjectsBeforeEnteringGroup(i),n=super.insertAt(t,...s);return this._onAfterObjectsChange(r0,s),n;}remove(){let t=super.remove(...arguments);return this._onAfterObjectsChange(r1,t),t;}_onObjectAdded(t){this.enterGroup(t,!0),this.fire("object:added",{target:t}),t.fire("added",{target:this});}_onObjectRemoved(t,e){this.exitGroup(t,e),this.fire("object:removed",{target:t}),t.fire("removed",{target:this});}_onAfterObjectsChange(t,e){this.layoutManager.performLayout({type:t,targets:e,target:this});}_onStackOrderChanged(){this._set("dirty",!0);}_set(t,e){let i=this[t];return super._set(t,e),"canvas"===t&&i!==e&&(this._objects||[]).forEach(i=>{i._set(t,e);}),this;}_shouldSetNestedCoords(){return this.subTargetCheck;}removeAll(){return this._activeObjects=[],this.remove(...this._objects);}__objectSelectionMonitor(t,e){let{target:i}=e,r=this._activeObjects;if(t)r.push(i),this._set("dirty",!0);else if(r.length>0){let t=r.indexOf(i);t>-1&&(r.splice(t,1),this._set("dirty",!0));}}_watchObject(t,e){t&&this._watchObject(!1,e),t?(e.on("selected",this.__objectSelectionTracker),e.on("deselected",this.__objectSelectionDisposer)):(e.off("selected",this.__objectSelectionTracker),e.off("deselected",this.__objectSelectionDisposer));}enterGroup(t,e){t.group&&t.group.remove(t),t._set("parent",this),this._enterGroup(t,e);}_enterGroup(t,e){e&&ei(t,tT(tj(this.calcTransformMatrix()),t.calcTransformMatrix())),this._shouldSetNestedCoords()&&t.setCoords(),t._set("group",this),t._set("canvas",this.canvas),this._watchObject(!0,t);let i=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();i&&(i===t||t.isDescendantOf(i))&&this._activeObjects.push(t);}exitGroup(t,e){this._exitGroup(t,e),t._set("parent",void 0),t._set("canvas",void 0);}_exitGroup(t,e){t._set("group",void 0),e||(ei(t,tT(this.calcTransformMatrix(),t.calcTransformMatrix())),t.setCoords()),this._watchObject(!1,t);let i=this._activeObjects.length>0?this._activeObjects.indexOf(t):-1;i>-1&&this._activeObjects.splice(i,1);}shouldCache(){let t=ru.prototype.shouldCache.call(this);if(t){for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return this.ownCaching=!1,!1;}return t;}willDrawShadow(){if(super.willDrawShadow())return!0;for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return!0;return!1;}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache();}drawObject(t,e,i){this._renderBackground(t);for(let e=0;e<this._objects.length;e++){var r;let i=this._objects[e];null!==(r=this.canvas)&&void 0!==r&&r.preserveObjectStacking&&i.group!==this?(t.save(),t.transform(...tj(this.calcTransformMatrix())),i.render(t),t.restore()):i.group===this&&i.render(t);}this._drawClipPath(t,this.clipPath,i);}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject(t=>t.setCoords());}triggerLayout(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.layoutManager.performLayout(h({target:this,type:r2},t));}render(t){this._transformDone=!0,super.render(t),this._transformDone=!1;}__serializeObjects(t,e){let i=this.includeDefaultValues;return this._objects.filter(function(t){return!t.excludeFromExport;}).map(function(r){let s=r.includeDefaultValues;r.includeDefaultValues=i;let n=r[t||"toObject"](e);return r.includeDefaultValues=s,n;});}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this.layoutManager.toObject();return h(h(h({},super.toObject(["subTargetCheck","interactive",...t])),"fit-content"!==e.strategy||this.includeDefaultValues?{layoutManager:e}:{}),{},{objects:this.__serializeObjects("toObject",t)});}toString(){return"#<Group: (".concat(this.complexity(),")>");}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject(t=>{this._watchObject(!1,t),t.dispose();}),super.dispose();}_createSVGBgRect(t){if(!this.backgroundColor)return"";let e=rZ.prototype._toSVG.call(this),i=e.indexOf("COMMON_PARTS");e[i]='for="group" ';let r=e.join("");return t?t(r):r;}_toSVG(t){let e=["<g ","COMMON_PARTS"," >\n"],i=this._createSVGBgRect(t);i&&e.push("		",i);for(let i=0;i<this._objects.length;i++)e.push("		",this._objects[i].toSVG(t));return e.push("</g>\n"),e;}getSvgStyles(){let t=void 0!==this.opacity&&1!==this.opacity?"opacity: ".concat(this.opacity,";"):"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("");}toClipPathSVG(t){let e=[],i=this._createSVGBgRect(t);i&&e.push("	",i);for(let i=0;i<this._objects.length;i++)e.push("	",this._objects[i].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t});}static fromObject(t,e){let{type:i,objects:r=[],layoutManager:s}=t,n=c(t,st);return Promise.all([tW(r,e),tX(n,e)]).then(t=>{let[e,i]=t,r=new this(e,h(h(h({},n),i),{},{layoutManager:new se}));if(s){let t=te.getClass(s.type),e=te.getClass(s.strategy);r.layoutManager=new t(new e);}else r.layoutManager=new r9;return r.layoutManager.subscribeTargets({type:rQ,target:r,targets:r.getObjects()}),r.setCoords(),r;});}}o(si,"type","Group"),o(si,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),te.setClass(si);let sr=(t,e)=>Math.min(e.width/t.width,e.height/t.height),ss=(t,e)=>Math.max(e.width/t.width,e.height/t.height),sn="\\s*,?\\s*",sa="".concat(sn,"(").concat(eV,")"),so="".concat(sa).concat(sa).concat(sa).concat(sn,"([01])").concat(sn,"([01])").concat(sa).concat(sa),sl={m:"l",M:"L"},sh=(t,e,i,r,s,n,a,o,l,h,c)=>{let d=tn(t),u=ta(t),g=tn(e),f=ta(e),p=i*s*g-r*n*f+a,m=r*s*g+i*n*f+o;return["C",h+l*(-i*s*u-r*n*d),c+l*(-r*s*u+i*n*d),p+l*(i*s*f+r*n*g),m+l*(r*s*f-i*n*g),p,m];},sc=(t,e,i,r)=>{let s=Math.atan2(e,t),n=Math.atan2(r,i);return n>=s?n-s:2*Math.PI-(s-n);};function sd(t,e,i,r,s,n,a,o){let l;if(g.cachesBoundsOfCurve&&(l=[...arguments].join(),j.boundsOfCurveCache[l]))return j.boundsOfCurveCache[l];let h=Math.sqrt,c=Math.abs,d=[],u=[[0,0],[0,0]],f=6*t-12*i+6*s,p=-3*t+9*i-9*s+3*a,m=3*i-3*t;for(let t=0;t<2;++t){if(t>0&&(f=6*e-12*r+6*n,p=-3*e+9*r-9*n+3*o,m=3*r-3*e),1e-12>c(p)){if(1e-12>c(f))continue;let t=-m/f;0<t&&t<1&&d.push(t);continue;}let i=f*f-4*m*p;if(i<0)continue;let s=h(i),a=(-f+s)/(2*p);0<a&&a<1&&d.push(a);let l=(-f-s)/(2*p);0<l&&l<1&&d.push(l);}let v=d.length,x=v,y=sp(t,e,i,r,s,n,a,o);for(;v--;){let{x:t,y:e}=y(d[v]);u[0][v]=t,u[1][v]=e;}u[0][x]=t,u[1][x]=e,u[0][x+1]=a,u[1][x+1]=o;let b=[new to(Math.min(...u[0]),Math.min(...u[1])),new to(Math.max(...u[0]),Math.max(...u[1]))];return g.cachesBoundsOfCurve&&(j.boundsOfCurveCache[l]=b),b;}let su=(t,e,i)=>{let[r,s,n,a,o,l,h,c]=i,d=((t,e,i,r,s,n,a)=>{if(0===i||0===r)return[];let o=0,l=0,h=0,c=Math.PI,d=a*D,u=ta(d),g=tn(d),f=.5*(-g*t-u*e),p=.5*(-g*e+u*t),m=i**2,v=r**2,x=p**2,y=f**2,b=m*v-m*x-v*y,w=Math.abs(i),C=Math.abs(r);if(b<0){let t=Math.sqrt(1-b/(m*v));w*=t,C*=t;}else h=(s===n?-1:1)*Math.sqrt(b/(m*x+v*y));let _=h*w*p/C,S=-h*C*f/w,j=g*_-u*S+.5*t,T=u*_+g*S+.5*e,k=sc(1,0,(f-_)/w,(p-S)/C),O=sc((f-_)/w,(p-S)/C,(-f-_)/w,(-p-S)/C);0===n&&O>0?O-=2*c:1===n&&O<0&&(O+=2*c);let M=Math.ceil(Math.abs(O/c*2)),E=[],A=O/M,P=8/3*Math.sin(A/4)*Math.sin(A/4)/Math.sin(A/2),F=k+A;for(let t=0;t<M;t++)E[t]=sh(k,F,g,u,w,C,j,T,P,o,l),o=E[t][5],l=E[t][6],k=F,F+=A;return E;})(h-t,c-e,s,n,o,l,a);for(let i=0,r=d.length;i<r;i++)d[i][1]+=t,d[i][2]+=e,d[i][3]+=t,d[i][4]+=e,d[i][5]+=t,d[i][6]+=e;return d;},sg=t=>{let e=0,i=0,r=0,s=0,n=[],a,o=0,l=0;for(let h of t){let t;let c=[...h];switch(c[0]){case"l":c[1]+=e,c[2]+=i;case"L":t=["L",e=c[1],i=c[2]];break;case"h":c[1]+=e;case"H":t=["L",e=c[1],i];break;case"v":c[1]+=i;case"V":t=["L",e,i=c[1]];break;case"m":c[1]+=e,c[2]+=i;case"M":e=c[1],i=c[2],r=c[1],s=c[2],t=["M",e,i];break;case"c":c[1]+=e,c[2]+=i,c[3]+=e,c[4]+=i,c[5]+=e,c[6]+=i;case"C":o=c[3],l=c[4],e=c[5],i=c[6],t=["C",c[1],c[2],o,l,e,i];break;case"s":c[1]+=e,c[2]+=i,c[3]+=e,c[4]+=i;case"S":"C"===a?(o=2*e-o,l=2*i-l):(o=e,l=i),e=c[3],i=c[4],o=(t=["C",o,l,c[1],c[2],e,i])[3],l=t[4];break;case"q":c[1]+=e,c[2]+=i,c[3]+=e,c[4]+=i;case"Q":o=c[1],t=["Q",o,l=c[2],e=c[3],i=c[4]];break;case"t":c[1]+=e,c[2]+=i;case"T":"Q"===a?(o=2*e-o,l=2*i-l):(o=e,l=i),t=["Q",o,l,e=c[1],i=c[2]];break;case"a":c[6]+=e,c[7]+=i;case"A":su(e,i,c).forEach(t=>n.push(t)),e=c[6],i=c[7];break;case"z":case"Z":e=r,i=s,t=["Z"];}t?(n.push(t),a=t[0]):a="";}return n;},sf=(t,e,i,r)=>Math.sqrt((i-t)**2+(r-e)**2),sp=(t,e,i,r,s,n,a,o)=>l=>{let h=l**3,c=3*l**2*(1-l),d=3*l*(1-l)**2,u=(1-l)**3;return new to(a*h+s*c+i*d+t*u,o*h+n*c+r*d+e*u);},sm=t=>t**2,sv=t=>2*t*(1-t),sx=t=>(1-t)**2,sy=(t,e,i,r,s,n,a,o)=>l=>{let h=sm(l),c=sv(l),d=sx(l);return Math.atan2(3*(d*(r-e)+c*(n-r)+h*(o-n)),3*(d*(i-t)+c*(s-i)+h*(a-s)));},sb=(t,e,i,r,s,n)=>a=>{let o=sm(a),l=sv(a),h=sx(a);return new to(s*o+i*l+t*h,n*o+r*l+e*h);},sw=(t,e,i,r,s,n)=>a=>{let o=1-a;return Math.atan2(2*(o*(r-e)+a*(n-r)),2*(o*(i-t)+a*(s-i)));},sC=(t,e,i)=>{let r=new to(e,i),s=0;for(let e=1;e<=100;e+=1){let i=t(e/100);s+=sf(r.x,r.y,i.x,i.y),r=i;}return s;},s_=(t,e)=>{let i,r=0,s=0,n={x:t.x,y:t.y},a=h({},n),o=.01,l=0,c=t.iterator,d=t.angleFinder;for(;s<e&&o>1e-4;)a=c(r),l=r,(i=sf(n.x,n.y,a.x,a.y))+s>e?(r-=o,o/=2):(n=a,r+=o,s+=i);return h(h({},a),{},{angle:d(l)});},sS=t=>{let e,i,r=0,s=0,n=0,a=0,o=0,l=[];for(let h of t){let t={x:s,y:n,command:h[0],length:0};switch(h[0]){case"M":(i=t).x=a=s=h[1],i.y=o=n=h[2];break;case"L":(i=t).length=sf(s,n,h[1],h[2]),s=h[1],n=h[2];break;case"C":e=sp(s,n,h[1],h[2],h[3],h[4],h[5],h[6]),(i=t).iterator=e,i.angleFinder=sy(s,n,h[1],h[2],h[3],h[4],h[5],h[6]),i.length=sC(e,s,n),s=h[5],n=h[6];break;case"Q":e=sb(s,n,h[1],h[2],h[3],h[4]),(i=t).iterator=e,i.angleFinder=sw(s,n,h[1],h[2],h[3],h[4]),i.length=sC(e,s,n),s=h[3],n=h[4];break;case"Z":(i=t).destX=a,i.destY=o,i.length=sf(s,n,a,o),s=a,n=o;}r+=i.length,l.push(i);}return l.push({length:r,x:s,y:n}),l;},sj=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:sS(t),r=0;for(;e-i[r].length>0&&r<i.length-2;)e-=i[r].length,r++;let s=i[r],n=e/s.length,a=t[r];switch(s.command){case"M":return{x:s.x,y:s.y,angle:0};case"Z":return h(h({},new to(s.x,s.y).lerp(new to(s.destX,s.destY),n)),{},{angle:Math.atan2(s.destY-s.y,s.destX-s.x)});case"L":return h(h({},new to(s.x,s.y).lerp(new to(a[1],a[2]),n)),{},{angle:Math.atan2(a[2]-s.y,a[1]-s.x)});case"C":case"Q":return s_(s,e);}},sT=RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),sk=RegExp(so,"g"),sO=RegExp(eV,"gi"),sM={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},sD=t=>{var e;let i=[];for(let r of null!==(e=t.match(sT))&&void 0!==e?e:[]){let t=r[0];if("z"===t||"Z"===t){i.push([t]);continue;}let e=sM[t.toLowerCase()],s=[];if("a"===t||"A"===t){sk.lastIndex=0;for(let t=null;t=sk.exec(r);)s.push(...t.slice(1));}else s=r.match(sO)||[];for(let r=0;r<s.length;r+=e){let n=Array(e),a=sl[t];n[0]=r>0&&a?a:t;for(let t=0;t<e;t++)n[t+1]=parseFloat(s[r+t]);i.push(n);}}return i;},sE=function(t){let e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new to(t[0]),s=new to(t[1]),n=1,a=0,o=[],l=t.length,h=l>2;for(h&&(n=t[2].x<s.x?-1:t[2].x===s.x?0:1,a=t[2].y<s.y?-1:t[2].y===s.y?0:1),o.push(["M",r.x-n*i,r.y-a*i]),e=1;e<l;e++){if(!r.eq(s)){let t=r.midPointFrom(s);o.push(["Q",r.x,r.y,t.x,t.y]);}r=t[e],e+1<t.length&&(s=t[e+1]);}return h&&(n=r.x>t[e-2].x?1:r.x===t[e-2].x?0:-1,a=r.y>t[e-2].y?1:r.y===t[e-2].y?0:-1),o.push(["L",r.x+n*i,r.y+a*i]),o;},sA=(t,e)=>t.map(t=>t.map((t,i)=>0===i||void 0===e?t:tV(t,e)).join(" ")).join(" ");function sP(t,e){let i=t.style;i&&e&&("string"==typeof e?i.cssText+=";"+e:Object.entries(e).forEach(t=>{let[e,r]=t;return i.setProperty(e,r);}));}let sF=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;function sR(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.onComplete||k,r=new(_()).XMLHttpRequest,s=e.signal,n=function(){r.abort();},a=function(){s&&s.removeEventListener("abort",n),r.onerror=r.ontimeout=k;};if(s&&s.aborted)throw new m("request");return s&&s.addEventListener("abort",n,{once:!0}),r.onreadystatechange=function(){4===r.readyState&&(a(),i(r),r.onreadystatechange=k);},r.onerror=r.ontimeout=a,r.open("get",t,!0),r.send(),r;}let sL=(t,e)=>{let i=t._findCenterFromElement();t.transformMatrix&&((t=>{if(t.transformMatrix){let{scaleX:e,scaleY:i,angle:r,skewX:s}=tM(t.transformMatrix);t.flipX=!1,t.flipY=!1,t.set(U,e),t.set($,i),t.angle=r,t.skewX=s,t.skewY=0;}})(t),i=i.transform(t.transformMatrix)),delete t.transformMatrix,e&&(t.scaleX*=e.scaleX,t.scaleY*=e.scaleY,t.cropX=e.cropX,t.cropY=e.cropY,i.x+=e.offsetLeft,i.y+=e.offsetTop,t.width=e.width,t.height=e.height),t.setPositionByOrigin(i,A,A);};var sI=Object.freeze({__proto__:null,addTransformToObject:ee,animate:iL,animateColor:iI,applyTransformToObject:ei,calcAngleBetweenVectors:e3,calcDimensionsMatrix:tL,calcPlaneChangeMatrix:ea,calcVectorRotation:e6,cancelAnimFrame:tg,capValue:ia,composeMatrix:tI,copyCanvasElement:t=>{var e;let i=tx(t);return null===(e=i.getContext("2d"))||void 0===e||e.drawImage(t,0,0),i;},cos:tn,createCanvasElement:tm,createImage:tv,createRotateMatrix:tE,createScaleMatrix:tA,createSkewXMatrix:tF,createSkewYMatrix:tR,createTranslateMatrix:tD,createVector:e5,crossProduct:e9,degreesToRadians:tw,dotProduct:it,ease:ij,enlivenObjectEnlivables:tX,enlivenObjects:tW,findScaleToCover:ss,findScaleToFit:sr,getBoundsOfCurve:sd,getOrthonormalVector:e7,getPathSegmentsInfo:sS,getPointOnPath:sj,getPointer:t6,getRandomInt:sF,getRegularPolygonPath:(t,e)=>{let i=2*Math.PI/t,r=-O;t%2==0&&(r+=i/2);let s=Array(t+1);for(let n=0;n<t;n++){let t=n*i+r,{x:a,y:o}=new to(tn(t),ta(t)).scalarMultiply(e);s[n]=[0===n?"M":"L",a,o];}return s[t]=["Z"],s;},getSmoothPathFromPoints:sE,getSvgAttributes:t=>{let e=["instantiated_by_use","style","id","class"];switch(t){case"linearGradient":return e.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return e.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return e.concat(["offset","stop-color","stop-opacity"]);}return e;},getUnitVector:e8,groupSVGElements:(t,e)=>t&&1===t.length?t[0]:new si(t,e),hasStyleChanged:rj,invertTransform:tj,isBetweenVectors:ie,isIdentityMatrix:t_,isTouchEvent:t8,isTransparent:rg,joinPath:sA,loadImage:tB,magnitude:e4,makeBoundingBoxFromPoints:t9,makePathSimpler:sg,matrixToSVG:tN,mergeClipPaths:(t,e)=>{var i;let r=t,s=e;r.inverted&&!s.inverted&&(r=e,s=t),eh(s,null===(i=s.group)||void 0===i?void 0:i.calcTransformMatrix(),r.calcTransformMatrix());let n=r.inverted&&s.inverted;return n&&(r.inverted=s.inverted=!1),new si([r],{clipPath:s,inverted:n});},multiplyTransformMatrices:tT,multiplyTransformMatrixArray:tk,parsePath:sD,parsePreserveAspectRatioAttribute:eM,parseUnit:eO,pick:tY,projectStrokeOnPoints:rx,qrDecompose:tM,radiansToDegrees:tC,removeFromArray:ts,removeTransformFromObject:(t,e)=>{let i=tT(tj(e),t.calcOwnMatrix());ei(t,i);},removeTransformMatrixForSvgParsing:sL,request:sR,requestAnimFrame:tu,resetObjectTransform:er,rotatePoint:(t,e,i)=>t.rotate(i,e),rotateVector:e2,saveObjectTransform:es,sendObjectToPlane:eh,sendPointToPlane:eo,sendVectorToPlane:el,setStyle:sP,sin:ta,sizeAfterTransform:en,string:rS,stylesFromArray:rk,stylesToArray:rT,toBlob:tb,toDataURL:ty,toFixed:tV,transformPath:(t,e,i)=>(i&&(e=tT(e,[1,0,0,1,-i.x,-i.y])),t.map(t=>{let i=[...t];for(let r=1;r<t.length-1;r+=2){let{x:s,y:n}=tS({x:t[r],y:t[r+1]},e);i[r]=s,i[r+1]=n;}return i;})),transformPoint:tS});class sB extends t1{constructor(t){let{allowTouchScrolling:e=!1,containerClass:i=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t),o(this,"upper",void 0),o(this,"container",void 0);let{el:r}=this.lower,s=this.createUpperCanvas();this.upper={el:s,ctx:s.getContext("2d")},this.applyCanvasStyle(r,{allowTouchScrolling:e}),this.applyCanvasStyle(s,{allowTouchScrolling:e,styles:{position:"absolute",left:"0",top:"0"}});let n=this.createContainerElement();n.classList.add(i),r.parentNode&&r.parentNode.replaceChild(n,r),n.append(r,s),this.container=n;}createUpperCanvas(){let{el:t}=this.lower,e=tm();return e.className=t.className,e.classList.remove("lower-canvas"),e.classList.add("upper-canvas"),e.setAttribute("data-fabric","top"),e.style.cssText=t.style.cssText,e.setAttribute("draggable","true"),e;}createContainerElement(){let t=C().createElement("div");return t.setAttribute("data-fabric","wrapper"),sP(t,{position:"relative"}),t0(t),t;}applyCanvasStyle(t,e){let{styles:i,allowTouchScrolling:r}=e;sP(t,h(h({},i),{},{"touch-action":r?"manipulation":L})),t0(t);}setDimensions(t,e){super.setDimensions(t,e);let{el:i,ctx:r}=this.upper;tZ(i,r,t,e);}setCSSDimensions(t){super.setCSSDimensions(t),tQ(this.upper.el,t),tQ(this.container,t);}cleanupDOM(t){let e=this.container,{el:i}=this.lower,{el:r}=this.upper;super.cleanupDOM(t),e.removeChild(r),e.removeChild(i),e.parentNode&&e.parentNode.replaceChild(i,e);}dispose(){super.dispose(),w().dispose(this.upper.el),delete this.upper,delete this.container;}}class sW extends t4{constructor(){super(...arguments),o(this,"targets",[]),o(this,"_hoveredTargets",[]),o(this,"_currentTransform",null),o(this,"_groupSelector",null),o(this,"contextTopDirty",!1);}static getDefaults(){return h(h({},super.getDefaults()),sW.ownDefaults);}get upperCanvasEl(){var t;return null===(t=this.elements.upper)||void 0===t?void 0:t.el;}get contextTop(){var t;return null===(t=this.elements.upper)||void 0===t?void 0:t.ctx;}get wrapperEl(){return this.elements.container;}initElements(t){this.elements=new sB(t,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas();}_onObjectAdded(t){this._objectsToRender=void 0,super._onObjectAdded(t);}_onObjectRemoved(t){this._objectsToRender=void 0,t===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[t]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[t]}),t.fire("deselected",{target:t})),t===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(t);}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged();}_chooseObjectsToRender(){let t=this._activeObject;return!this.preserveObjectStacking&&t?this._objects.filter(e=>!e.group&&e!==t).concat(t):this._objects;}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),this._objectsToRender||(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender));}renderTopLayer(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore();}renderTop(){let t=this.contextTop;this.clearContext(t),this.renderTopLayer(t),this.fire("after:render",{ctx:t});}setTargetFindTolerance(t){t=Math.round(t),this.targetFindTolerance=t;let e=this.getRetinaScaling(),i=Math.ceil((2*t+1)*e);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=i,this.pixelFindContext.scale(e,e);}isTargetTransparent(t,e,i){let r=this.targetFindTolerance,s=this.pixelFindContext;this.clearContext(s),s.save(),s.translate(-e+r,-i+r),s.transform(...this.viewportTransform);let n=t.selectionBackgroundColor;t.selectionBackgroundColor="",t.render(s),t.selectionBackgroundColor=n,s.restore();let a=Math.round(r*this.getRetinaScaling());return rg(s,a,a,a);}_isSelectionKeyPressed(t){let e=this.selectionKey;return!!e&&(Array.isArray(e)?!!e.find(e=>!!e&&!0===t[e]):t[e]);}_shouldClearSelection(t,e){let i=this.getActiveObjects(),r=this._activeObject;return!!(!e||e&&r&&i.length>1&&-1===i.indexOf(e)&&r!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&r&&r!==e);}_shouldCenterTransform(t,e,i){let r;if(t)return e===G||e===U||e===$||e===V?r=this.centeredScaling||t.centeredScaling:e===Y&&(r=this.centeredRotation||t.centeredRotation),r?!i:i;}_getOriginFromCorner(t,e){let i={x:t.originX,y:t.originY};return e&&(["ml","tl","bl"].includes(e)?i.x=R:["mr","tr","br"].includes(e)&&(i.x=P),["tl","mt","tr"].includes(e)?i.y=F:["bl","mb","br"].includes(e)&&(i.y="top")),i;}_setupCurrentTransform(t,e,i){var r;let s=e.group?eo(this.getScenePoint(t),void 0,e.group.calcTransformMatrix()):this.getScenePoint(t),{key:n="",control:a}=e.getActiveControl()||{},o=i&&a?null===(r=a.getActionHandler(t,e,a))||void 0===r?void 0:r.bind(a):ey,l=((t,e,i,r)=>{if(!e||!t)return"drag";let s=r.controls[e];return s.getActionName(i,s,r);})(i,n,t,e),c=t[this.centeredKey],d=this._shouldCenterTransform(e,l,c)?{x:A,y:A}:this._getOriginFromCorner(e,n),u={target:e,action:l,actionHandler:o,actionPerformed:!1,corner:n,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:s.x-e.left,offsetY:s.y-e.top,originX:d.x,originY:d.y,ex:s.x,ey:s.y,lastX:s.x,lastY:s.y,theta:tw(e.angle),width:e.width,height:e.height,shiftKey:t.shiftKey,altKey:c,original:h(h({},es(e)),{},{originX:d.x,originY:d.y})};this._currentTransform=u,this.fire("before:transform",{e:t,transform:u});}setCursor(t){this.upperCanvasEl.style.cursor=t;}_drawSelection(t){let{x:e,y:i,deltaX:r,deltaY:s}=this._groupSelector,n=new to(e,i).transform(this.viewportTransform),a=new to(e+r,i+s).transform(this.viewportTransform),o=this.selectionLineWidth/2,l=Math.min(n.x,a.x),h=Math.min(n.y,a.y),c=Math.max(n.x,a.x),d=Math.max(n.y,a.y);this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(l,h,c-l,d-h)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,l+=o,h+=o,c-=o,d-=o,ru.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(l,h,c-l,d-h));}findTarget(t){if(this.skipTargetFind)return;let e=this.getViewportPoint(t),i=this._activeObject,r=this.getActiveObjects();if(this.targets=[],i&&r.length>=1){if(i.findControl(e,t8(t))||r.length>1&&this.searchPossibleTargets([i],e))return i;if(i===this.searchPossibleTargets([i],e)){if(this.preserveObjectStacking){let r=this.targets;this.targets=[];let s=this.searchPossibleTargets(this._objects,e);return t[this.altSelectionKey]&&s&&s!==i?(this.targets=r,i):s;}return i;}}return this.searchPossibleTargets(this._objects,e);}_pointIsInObjectSelectionArea(t,e){let i=t.getCoords(),r=this.getZoom(),s=t.padding/r;if(s){let[t,e,r,n]=i,a=Math.atan2(e.y-t.y,e.x-t.x),o=tn(a)*s,l=ta(a)*s,h=o+l,c=o-l;i=[new to(t.x-c,t.y-h),new to(e.x+h,e.y-c),new to(r.x+c,r.y+h),new to(n.x-h,n.y+c)];}return iB.isPointInPolygon(e,i);}_checkTarget(t,e){return!!(t&&t.visible&&t.evented&&this._pointIsInObjectSelectionArea(t,eo(e,void 0,this.viewportTransform)))&&(!this.perPixelTargetFind&&!t.perPixelTargetFind||!!t.isEditing||!this.isTargetTransparent(t,e.x,e.y));}_searchPossibleTargets(t,e){let i=t.length;for(;i--;){let r=t[i];if(this._checkTarget(r,e)){if(th(r)&&r.subTargetCheck){let t=this._searchPossibleTargets(r._objects,e);t&&this.targets.push(t);}return r;}}}searchPossibleTargets(t,e){let i=this._searchPossibleTargets(t,e);if(i&&th(i)&&i.interactive&&this.targets[0]){let t=this.targets;for(let e=t.length-1;e>0;e--){let i=t[e];if(!th(i)||!i.interactive)return i;}return t[0];}return i;}getViewportPoint(t){return this._pointer?this._pointer:this.getPointer(t,!0);}getScenePoint(t){return this._absolutePointer?this._absolutePointer:this.getPointer(t);}getPointer(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.upperCanvasEl,r=i.getBoundingClientRect(),s=t6(t),n=r.width||0,a=r.height||0;n&&a||("top"in r&&F in r&&(a=Math.abs(r.top-r.bottom)),R in r&&P in r&&(n=Math.abs(r.right-r.left))),this.calcOffset(),s.x=s.x-this._offset.left,s.y=s.y-this._offset.top,e||(s=eo(s,void 0,this.viewportTransform));let o=this.getRetinaScaling();1!==o&&(s.x/=o,s.y/=o);let l=0===n||0===a?new to(1,1):new to(i.width/n,i.height/a);return s.multiply(l);}_setDimensionsImpl(t,e){this._resetTransformEventData(),super._setDimensionsImpl(t,e),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop);}_createCacheCanvas(){this.pixelFindCanvasEl=tm(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance);}getTopContext(){return this.elements.upper.ctx;}getSelectionContext(){return this.elements.upper.ctx;}getSelectionElement(){return this.elements.upper.el;}getActiveObject(){return this._activeObject;}getActiveObjects(){let t=this._activeObject;return t$(t)?t.getObjects():t?[t]:[];}_fireSelectionEvents(t,e){let i=!1,r=!1,s=this.getActiveObjects(),n=[],a=[];t.forEach(t=>{s.includes(t)||(i=!0,t.fire("deselected",{e:e,target:t}),a.push(t));}),s.forEach(r=>{t.includes(r)||(i=!0,r.fire("selected",{e:e,target:r}),n.push(r));}),t.length>0&&s.length>0?(r=!0,i&&this.fire("selection:updated",{e:e,selected:n,deselected:a})):s.length>0?(r=!0,this.fire("selection:created",{e:e,selected:n})):t.length>0&&(r=!0,this.fire("selection:cleared",{e:e,deselected:a})),r&&(this._objectsToRender=void 0);}setActiveObject(t,e){let i=this.getActiveObjects(),r=this._setActiveObject(t,e);return this._fireSelectionEvents(i,e),r;}_setActiveObject(t,e){let i=this._activeObject;return i!==t&&!(!this._discardActiveObject(e,t)&&this._activeObject)&&!t.onSelect({e:e})&&(this._activeObject=t,t$(t)&&i!==t&&t.set("canvas",this),t.setCoords(),!0);}_discardActiveObject(t,e){let i=this._activeObject;return!!i&&!i.onDeselect({e:t,object:e})&&(this._currentTransform&&this._currentTransform.target===i&&this.endCurrentTransform(t),t$(i)&&i===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0);}discardActiveObject(t){let e=this.getActiveObjects(),i=this.getActiveObject();e.length&&this.fire("before:selection:cleared",{e:t,deselected:[i]});let r=this._discardActiveObject(t);return this._fireSelectionEvents(e,t),r;}endCurrentTransform(t){let e=this._currentTransform;this._finalizeCurrentTransform(t),e&&e.target&&(e.target.isMoving=!1),this._currentTransform=null;}_finalizeCurrentTransform(t){let e=this._currentTransform,i=e.target,r={e:t,target:i,transform:e,action:e.action};i._scaling&&(i._scaling=!1),i.setCoords(),e.actionPerformed&&(this.fire("object:modified",r),i.fire(Q,r));}setViewportTransform(t){super.setViewportTransform(t);let e=this._activeObject;e&&e.setCoords();}destroy(){let t=this._activeObject;t$(t)&&(t.removeAll(),t.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0;}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear();}drawControls(t){let e=this._activeObject;e&&e._renderControls(t);}_toObject(t,e,i){let r=this._realizeGroupTransformOnObject(t),s=super._toObject(t,e,i);return t.set(r),s;}_realizeGroupTransformOnObject(t){let{group:e}=t;if(e&&t$(e)&&this._activeObject===e){let i=tY(t,["angle","flipX","flipY",P,U,$,q,K,"top"]);return ee(t,e.calcOwnMatrix()),i;}return{};}_setSVGObject(t,e,i){let r=this._realizeGroupTransformOnObject(e);super._setSVGObject(t,e,i),e.set(r);}}o(sW,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class sX{constructor(t){o(this,"targets",[]),o(this,"__disposer",void 0);let e=()=>{let{hiddenTextarea:e}=t.getActiveObject()||{};e&&e.focus();},i=t.upperCanvasEl;i.addEventListener("click",e),this.__disposer=()=>i.removeEventListener("click",e);}exitTextEditing(){this.target=void 0,this.targets.forEach(t=>{t.isEditing&&t.exitEditing();});}add(t){this.targets.push(t);}remove(t){this.unregister(t),ts(this.targets,t);}register(t){this.target=t;}unregister(t){t===this.target&&(this.target=void 0);}onMouseMove(t){var e;(null===(e=this.target)||void 0===e?void 0:e.isEditing)&&this.target.updateSelectionOnMouseMove(t);}clear(){this.targets=[],this.target=void 0;}dispose(){this.clear(),this.__disposer(),delete this.__disposer;}}let sY=["target","oldTarget","fireCanvas","e"],sz={passive:!1},sV=(t,e)=>{let i=t.getViewportPoint(e),r=t.getScenePoint(e);return{viewportPoint:i,scenePoint:r,pointer:i,absolutePointer:r};},sN=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return t.addEventListener(...i);},sH=function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return t.removeEventListener(...i);},sG={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class sU extends sW{constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),o(this,"_isClick",void 0),o(this,"textEditingManager",new sX(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach(t=>{this[t]=this[t].bind(this);}),this.addOrRemove(sN,"add");}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse";}addOrRemove(t,e){let i=this.upperCanvasEl,r=this._getEventPrefix();t(tJ(i),"resize",this._onResize),t(i,r+"down",this._onMouseDown),t(i,"".concat(r,"move"),this._onMouseMove,sz),t(i,"".concat(r,"out"),this._onMouseOut),t(i,"".concat(r,"enter"),this._onMouseEnter),t(i,"wheel",this._onMouseWheel,{passive:!1}),t(i,"contextmenu",this._onContextMenu),t(i,"click",this._onClick),t(i,"dblclick",this._onClick),t(i,"dragstart",this._onDragStart),t(i,"dragend",this._onDragEnd),t(i,"dragover",this._onDragOver),t(i,"dragenter",this._onDragEnter),t(i,"dragleave",this._onDragLeave),t(i,"drop",this._onDrop),this.enablePointerEvents||t(i,"touchstart",this._onTouchStart,sz);}removeListeners(){this.addOrRemove(sH,"remove");let t=this._getEventPrefix(),e=tK(this.upperCanvasEl);sH(e,"".concat(t,"up"),this._onMouseUp),sH(e,"touchend",this._onTouchEnd,sz),sH(e,"".concat(t,"move"),this._onMouseMove,sz),sH(e,"touchmove",this._onMouseMove,sz),clearTimeout(this._willAddMouseDown);}_onMouseWheel(t){this.__onMouseWheel(t);}_onMouseOut(t){let e=this._hoveredTarget,i=h({e:t},sV(this,t));this.fire("mouse:out",h(h({},i),{},{target:e})),this._hoveredTarget=void 0,e&&e.fire("mouseout",h({},i)),this._hoveredTargets.forEach(t=>{this.fire("mouse:out",h(h({},i),{},{target:t})),t&&t.fire("mouseout",h({},i));}),this._hoveredTargets=[];}_onMouseEnter(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",h({e:t},sV(this,t))),this._hoveredTarget=void 0,this._hoveredTargets=[]);}_onDragStart(t){this._isClick=!1;let e=this.getActiveObject();if(e&&e.onDragStart(t)){this._dragSource=e;let i={e:t,target:e};return this.fire("dragstart",i),e.fire("dragstart",i),void sN(this.upperCanvasEl,"drag",this._onDragProgress);}t7(t);}_renderDragEffects(t,e,i){let r=!1,s=this._dropTarget;s&&s!==e&&s!==i&&(s.clearContextTop(),r=!0),null==e||e.clearContextTop(),i!==e&&(null==i||i.clearContextTop());let n=this.contextTop;n.save(),n.transform(...this.viewportTransform),e&&(n.save(),e.transform(n),e.renderDragSourceEffect(t),n.restore(),r=!0),i&&(n.save(),i.transform(n),i.renderDropTargetEffect(t),n.restore(),r=!0),n.restore(),r&&(this.contextTopDirty=!0);}_onDragEnd(t){let e=!!t.dataTransfer&&t.dataTransfer.dropEffect!==L,i=e?this._activeObject:void 0,r={e:t,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:e,dropTarget:i};sH(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",r),this._dragSource&&this._dragSource.fire("dragend",r),delete this._dragSource,this._onMouseUp(t);}_onDragProgress(t){let e={e:t,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",e),this._dragSource&&this._dragSource.fire("drag",e);}findDragTargets(t){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(t)),targets:[...this.targets]};}_onDragOver(t){let e;let i="dragover",{target:r,targets:s}=this.findDragTargets(t),n=this._dragSource,a={e:t,target:r,subTargets:s,dragSource:n,canDrop:!1,dropTarget:void 0};this.fire(i,a),this._fireEnterLeaveEvents(r,a),r&&(r.canDrop(t)&&(e=r),r.fire(i,a));for(let r=0;r<s.length;r++){let n=s[r];n.canDrop(t)&&(e=n),n.fire(i,a);}this._renderDragEffects(t,n,e),this._dropTarget=e;}_onDragEnter(t){let{target:e,targets:i}=this.findDragTargets(t),r={e:t,target:e,subTargets:i,dragSource:this._dragSource};this.fire("dragenter",r),this._fireEnterLeaveEvents(e,r);}_onDragLeave(t){let e={e:t,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",e),this._fireEnterLeaveEvents(void 0,e),this._renderDragEffects(t,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[];}_onDrop(t){let{target:e,targets:i}=this.findDragTargets(t),r=this._basicEventHandler("drop:before",h({e:t,target:e,subTargets:i,dragSource:this._dragSource},sV(this,t)));r.didDrop=!1,r.dropTarget=void 0,this._basicEventHandler("drop",r),this.fire("drop:after",r);}_onContextMenu(t){let e=this.findTarget(t),i=this.targets||[],r=this._basicEventHandler("contextmenu:before",{e:t,target:e,subTargets:i});return this.stopContextMenu&&t7(t),this._basicEventHandler("contextmenu",r),!1;}_onClick(t){let e=t.detail;e>3||e<2||(this._cacheTransformEventData(t),2==e&&"dblclick"===t.type&&this._handleEvent(t,"dblclick"),3==e&&this._handleEvent(t,"tripleclick"),this._resetTransformEventData());}getPointerId(t){let e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1;}_isMainEvent(t){return!0===t.isPrimary||!1!==t.isPrimary&&("touchend"===t.type&&0===t.touches.length||!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId);}_onTouchStart(t){let e=!this.allowTouchScrolling,i=this._activeObject;void 0===this.mainTouchId&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),(this.isDrawingMode||i&&this._target===i)&&(e=!0),e&&t.preventDefault(),this._resetTransformEventData();let r=this.upperCanvasEl,s=this._getEventPrefix(),n=tK(r);sN(n,"touchend",this._onTouchEnd,sz),e&&sN(n,"touchmove",this._onMouseMove,sz),sH(r,"".concat(s,"down"),this._onMouseDown);}_onMouseDown(t){this.__onMouseDown(t),this._resetTransformEventData();let e=this.upperCanvasEl,i=this._getEventPrefix();sH(e,"".concat(i,"move"),this._onMouseMove,sz);let r=tK(e);sN(r,"".concat(i,"up"),this._onMouseUp),sN(r,"".concat(i,"move"),this._onMouseMove,sz);}_onTouchEnd(t){if(t.touches.length>0)return;this.__onMouseUp(t),this._resetTransformEventData(),delete this.mainTouchId;let e=this._getEventPrefix(),i=tK(this.upperCanvasEl);sH(i,"touchend",this._onTouchEnd,sz),sH(i,"touchmove",this._onMouseMove,sz),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(()=>{sN(this.upperCanvasEl,"".concat(e,"down"),this._onMouseDown),this._willAddMouseDown=0;},400);}_onMouseUp(t){this.__onMouseUp(t),this._resetTransformEventData();let e=this.upperCanvasEl,i=this._getEventPrefix();if(this._isMainEvent(t)){let t=tK(this.upperCanvasEl);sH(t,"".concat(i,"up"),this._onMouseUp),sH(t,"".concat(i,"move"),this._onMouseMove,sz),sN(e,"".concat(i,"move"),this._onMouseMove,sz);}}_onMouseMove(t){let e=this.getActiveObject();this.allowTouchScrolling||e&&e.shouldStartDragging(t)||!t.preventDefault||t.preventDefault(),this.__onMouseMove(t);}_onResize(){this.calcOffset(),this._resetTransformEventData();}_shouldRender(t){let e=this.getActiveObject();return!!e!=!!t||e&&t&&e!==t;}__onMouseUp(t){var e;this._cacheTransformEventData(t),this._handleEvent(t,"up:before");let i=this._currentTransform,r=this._isClick,s=this._target,{button:n}=t;if(n)return(this.fireMiddleClick&&1===n||this.fireRightClick&&2===n)&&this._handleEvent(t,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);if(!this._isMainEvent(t))return;let a,o,l=!1;if(i&&(this._finalizeCurrentTransform(t),l=i.actionPerformed),!r){let e=s===this._activeObject;this.handleSelection(t),l||(l=this._shouldRender(s)||!e&&s===this._activeObject);}if(s){let{key:e,control:r}=s.findControl(this.getViewportPoint(t),t8(t))||{};if(o=e,s.selectable&&s!==this._activeObject&&"up"===s.activeOn)this.setActiveObject(s,t),l=!0;else if(r){let e=r.getMouseUpHandler(t,s,r);e&&(a=this.getScenePoint(t),e.call(r,t,i,a.x,a.y));}s.isMoving=!1;}if(i&&(i.target!==s||i.corner!==o)){let e=i.target&&i.target.controls[i.corner],r=e&&e.getMouseUpHandler(t,i.target,e);a=a||this.getScenePoint(t),r&&r.call(e,t,i,a.x,a.y);}this._setCursorFromEvent(t,s),this._handleEvent(t,"up"),this._groupSelector=null,this._currentTransform=null,s&&(s.__corner=void 0),l?this.requestRenderAll():r||null!==(e=this._activeObject)&&void 0!==e&&e.isEditing||this.renderTop();}_basicEventHandler(t,e){let{target:i,subTargets:r=[]}=e;this.fire(t,e),i&&i.fire(t,e);for(let s=0;s<r.length;s++)r[s]!==i&&r[s].fire(t,e);return e;}_handleEvent(t,e,i){let r=this._target,s=this.targets||[],n=h(h(h({e:t,target:r,subTargets:s},sV(this,t)),{},{transform:this._currentTransform},"up:before"===e||"up"===e?{isClick:this._isClick,currentTarget:this.findTarget(t),currentSubTargets:this.targets}:{}),"down:before"===e||"down"===e?i:{});this.fire("mouse:".concat(e),n),r&&r.fire("mouse".concat(e),n);for(let t=0;t<s.length;t++)s[t]!==r&&s[t].fire("mouse".concat(e),n);}_onMouseDownInDrawingMode(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(t),this.requestRenderAll());let e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down",{alreadySelected:!1});}_onMouseMoveInDrawingMode(t){if(this._isCurrentlyDrawing){let e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e});}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move");}_onMouseUpInDrawingMode(t){let e=this.getScenePoint(t);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:t,pointer:e}):this._isCurrentlyDrawing=!1,this._handleEvent(t,"up");}__onMouseDown(t){this._isClick=!0,this._cacheTransformEventData(t),this._handleEvent(t,"down:before");let e=this._target,i=!!e&&e===this._activeObject,{button:r}=t;if(r)return(this.fireMiddleClick&&1===r||this.fireRightClick&&2===r)&&this._handleEvent(t,"down",{alreadySelected:i}),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._isMainEvent(t)||this._currentTransform)return;let s=this._shouldRender(e),n=!1;if(this.handleMultiSelection(t,e)?(e=this._activeObject,n=!0,s=!0):this._shouldClearSelection(t,e)&&this.discardActiveObject(t),this.selection&&(!e||!e.selectable&&!e.isEditing&&e!==this._activeObject)){let e=this.getScenePoint(t);this._groupSelector={x:e.x,y:e.y,deltaY:0,deltaX:0};}if(i=!!e&&e===this._activeObject,e){e.selectable&&"down"===e.activeOn&&this.setActiveObject(e,t);let r=e.findControl(this.getViewportPoint(t),t8(t));if(e===this._activeObject&&(r||!n)){this._setupCurrentTransform(t,e,i);let s=r?r.control:void 0,n=this.getScenePoint(t),a=s&&s.getMouseDownHandler(t,e,s);a&&a.call(s,t,this._currentTransform,n.x,n.y);}}s&&(this._objectsToRender=void 0),this._handleEvent(t,"down",{alreadySelected:i}),s&&this.requestRenderAll();}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0;}_cacheTransformEventData(t){this._resetTransformEventData(),this._pointer=this.getViewportPoint(t),this._absolutePointer=eo(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t);}__onMouseMove(t){if(this._isClick=!1,this._cacheTransformEventData(t),this._handleEvent(t,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);if(!this._isMainEvent(t))return;let e=this._groupSelector;if(e){let i=this.getScenePoint(t);e.deltaX=i.x-e.x,e.deltaY=i.y-e.y,this.renderTop();}else if(this._currentTransform)this._transformObject(t);else{let e=this.findTarget(t);this._setCursorFromEvent(t,e),this._fireOverOutEvents(t,e);}this.textEditingManager.onMouseMove(t),this._handleEvent(t,"move"),this._resetTransformEventData();}_fireOverOutEvents(t,e){let i=this._hoveredTarget,r=this._hoveredTargets,s=this.targets,n=Math.max(r.length,s.length);this.fireSyntheticInOutEvents("mouse",{e:t,target:e,oldTarget:i,fireCanvas:!0});for(let a=0;a<n;a++)s[a]===e||r[a]&&r[a]===i||this.fireSyntheticInOutEvents("mouse",{e:t,target:s[a],oldTarget:r[a]});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat();}_fireEnterLeaveEvents(t,e){let i=this._draggedoverTarget,r=this._hoveredTargets,s=this.targets,n=Math.max(r.length,s.length);this.fireSyntheticInOutEvents("drag",h(h({},e),{},{target:t,oldTarget:i,fireCanvas:!0}));for(let t=0;t<n;t++)this.fireSyntheticInOutEvents("drag",h(h({},e),{},{target:s[t],oldTarget:r[t]}));this._draggedoverTarget=t;}fireSyntheticInOutEvents(t,e){let{target:i,oldTarget:r,fireCanvas:s,e:n}=e,a=c(e,sY),{targetIn:o,targetOut:l,canvasIn:d,canvasOut:u}=sG[t],g=r!==i;if(r&&g){let t=h(h({},a),{},{e:n,target:r,nextTarget:i},sV(this,n));s&&this.fire(u,t),r.fire(l,t);}if(i&&g){let t=h(h({},a),{},{e:n,target:i,previousTarget:r},sV(this,n));s&&this.fire(d,t),i.fire(o,t);}}__onMouseWheel(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData();}_transformObject(t){let e=this.getScenePoint(t),i=this._currentTransform,r=i.target,s=r.group?eo(e,void 0,r.group.calcTransformMatrix()):e;i.shiftKey=t.shiftKey,i.altKey=!!this.centeredKey&&t[this.centeredKey],this._performTransformAction(t,i,s),i.actionPerformed&&this.requestRenderAll();}_performTransformAction(t,e,i){let{action:r,actionHandler:s,target:n}=e,a=!!s&&s(t,e,i.x,i.y);a&&n.setCoords(),"drag"===r&&a&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||a;}_setCursorFromEvent(t,e){if(!e)return void this.setCursor(this.defaultCursor);let i=e.hoverCursor||this.hoverCursor,r=t$(this._activeObject)?this._activeObject:null,s=(!r||e.group!==r)&&e.findControl(this.getViewportPoint(t));if(s){let i=s.control;this.setCursor(i.cursorStyleHandler(t,i,e));}else e.subTargetCheck&&this.targets.concat().reverse().map(t=>{i=t.hoverCursor||i;}),this.setCursor(i);}handleMultiSelection(t,e){let i=this._activeObject,r=t$(i);if(i&&this._isSelectionKeyPressed(t)&&this.selection&&e&&e.selectable&&(i!==e||r)&&(r||!e.isDescendantOf(i)&&!i.isDescendantOf(e))&&!e.onSelect({e:t})&&!i.getActiveControl()){if(r){let r=i.getObjects();if(e===i){let i=this.getViewportPoint(t);if(!(e=this.searchPossibleTargets(r,i)||this.searchPossibleTargets(this._objects,i))||!e.selectable)return!1;}e.group===i?(i.remove(e),this._hoveredTarget=e,this._hoveredTargets=[...this.targets],1===i.size()&&this._setActiveObject(i.item(0),t)):(i.multiSelectAdd(e),this._hoveredTarget=i,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(r,t);}else{i.isEditing&&i.exitEditing();let r=new(te.getClass("ActiveSelection"))([],{canvas:this});r.multiSelectAdd(i,e),this._hoveredTarget=r,this._setActiveObject(r,t),this._fireSelectionEvents([i],t);}return!0;}return!1;}handleSelection(t){if(!this.selection||!this._groupSelector)return!1;let{x:e,y:i,deltaX:r,deltaY:s}=this._groupSelector,n=new to(e,i),a=n.add(new to(r,s)),o=n.min(a),l=n.max(a).subtract(o),h=this.collectObjects({left:o.x,top:o.y,width:l.x,height:l.y},{includeIntersecting:!this.selectionFullyContained}),c=n.eq(a)?h[0]?[h[0]]:[]:h.length>1?h.filter(e=>!e.onSelect({e:t})).reverse():h;if(1===c.length)this.setActiveObject(c[0],t);else if(c.length>1){let e=te.getClass("ActiveSelection");this.setActiveObject(new e(c,{canvas:this}),t);}return this._groupSelector=null,!0;}toCanvasElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1?arguments[1]:void 0,{upper:i}=this.elements;i.ctx=void 0;let r=super.toCanvasElement(t,e);return i.ctx=i.el.getContext("2d"),r;}clear(){this.textEditingManager.clear(),super.clear();}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy();}}let s$={x1:0,y1:0,x2:0,y2:0},sq=h(h({},s$),{},{r1:0,r2:0}),sK=(t,e)=>isNaN(t)&&"number"==typeof e?e:t;function sJ(t){return t&&/%$/.test(t)&&Number.isFinite(parseFloat(t));}function sZ(t,e){return ia(0,sK("number"==typeof t?t:"string"==typeof t?parseFloat(t)/(sJ(t)?100:1):NaN,e),1);}let sQ=/\s*;\s*/,s0=/\s*:\s*/;function s1(t){return"linearGradient"===t.nodeName||"LINEARGRADIENT"===t.nodeName?"linear":"radial";}function s2(t){return"userSpaceOnUse"===t.getAttribute("gradientUnits")?"pixels":"percentage";}function s5(t,e){return t.getAttribute(e);}class s4{constructor(t){let{type:e="linear",gradientUnits:i="pixels",coords:r={},colorStops:s=[],offsetX:n=0,offsetY:a=0,gradientTransform:o,id:l}=t||{};Object.assign(this,{type:e,gradientUnits:i,coords:h(h({},"radial"===e?sq:s$),r),colorStops:s,offsetX:n,offsetY:a,gradientTransform:o,id:l?"".concat(l,"_").concat(tp()):tp()});}addColorStop(t){for(let e in t){let i=new ek(t[e]);this.colorStops.push({offset:parseFloat(e),color:i.toRgb(),opacity:i.getAlpha()});}return this;}toObject(t){return h(h({},tY(this,t)),{},{type:this.type,coords:h({},this.coords),colorStops:this.colorStops.map(t=>h({},t)),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0});}toSVG(t){let{additionalTransform:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=[],r=this.gradientTransform?this.gradientTransform.concat():E.concat(),s="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox",n=this.colorStops.map(t=>h({},t)).sort((t,e)=>t.offset-e.offset),a=-this.offsetX,o=-this.offsetY;"objectBoundingBox"===s?(a/=t.width,o/=t.height):(a+=t.width/2,o+=t.height/2),t&&"function"==typeof t._renderPathCommands&&"percentage"!==this.gradientUnits&&(a-=t.pathOffset.x,o-=t.pathOffset.y),r[4]-=a,r[5]-=o;let l=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(s,'"'),'gradientTransform="'.concat(e?e+" ":"").concat(tN(r),'"'),""].join(" ");if("linear"===this.type){let{x1:t,y1:e,x2:r,y2:s}=this.coords;i.push("<linearGradient ",l,' x1="',t,'" y1="',e,'" x2="',r,'" y2="',s,'">\n');}else if("radial"===this.type){let{x1:t,y1:e,x2:r,y2:s,r1:a,r2:o}=this.coords,h=a>o;i.push("<radialGradient ",l,' cx="',h?t:r,'" cy="',h?e:s,'" r="',h?a:o,'" fx="',h?r:t,'" fy="',h?s:e,'">\n'),h&&(n.reverse(),n.forEach(t=>{t.offset=1-t.offset;}));let c=Math.min(a,o);if(c>0){let t=c/Math.max(a,o);n.forEach(e=>{e.offset+=t*(1-e.offset);});}}return n.forEach(t=>{let{color:e,offset:r,opacity:s}=t;i.push("<stop ",'offset="',100*r+"%",'" style="stop-color:',e,void 0!==s?";stop-opacity: "+s:";",'"/>\n');}),i.push("linear"===this.type?"</linearGradient>":"</radialGradient>","\n"),i.join("");}toLive(t){let{x1:e,y1:i,x2:r,y2:s,r1:n,r2:a}=this.coords,o="linear"===this.type?t.createLinearGradient(e,i,r,s):t.createRadialGradient(e,i,n,r,s,a);return this.colorStops.forEach(t=>{let{color:e,opacity:i,offset:r}=t;o.addColorStop(r,void 0!==i?new ek(e).setAlpha(i).toRgba():e);}),o;}static async fromObject(t){let{colorStops:e,gradientTransform:i}=t;return new this(h(h({},t),{},{colorStops:e?e.map(t=>h({},t)):void 0,gradientTransform:i?[...i]:void 0}));}static fromElement(t,e,i){var r;let s=s2(t),n=e._findCenterFromElement();return new this(h({id:t.getAttribute("id")||void 0,type:s1(t),coords:(r={width:i.viewBoxWidth||i.width,height:i.viewBoxHeight||i.height},function(t,e){let i,{width:r,height:s,gradientUnits:n}=e;return Object.entries(t).reduce((t,e)=>{let[a,o]=e;if("Infinity"===o)i=1;else if("-Infinity"===o)i=0;else{let t="string"==typeof o;i=t?parseFloat(o):o,t&&sJ(o)&&(i*=.01,"pixels"===n&&("x1"!==a&&"x2"!==a&&"r2"!==a||(i*=r),"y1"!==a&&"y2"!==a||(i*=s)));}return t[a]=i,t;},{});}("linear"===s1(t)?{x1:s5(t,"x1")||0,y1:s5(t,"y1")||0,x2:s5(t,"x2")||"100%",y2:s5(t,"y2")||0}:{x1:s5(t,"fx")||s5(t,"cx")||"50%",y1:s5(t,"fy")||s5(t,"cy")||"50%",r1:0,x2:s5(t,"cx")||"50%",y2:s5(t,"cy")||"50%",r2:s5(t,"r")||"50%"},h(h({},r),{},{gradientUnits:s2(t)}))),colorStops:function(t,e){let i=[],r=t.getElementsByTagName("stop"),s=sZ(e,1);for(let t=r.length;t--;)i.push(function(t,e){let i,r;let s=t.getAttribute("style");if(s){let t=s.split(sQ);""===t[t.length-1]&&t.pop();for(let e=t.length;e--;){let[s,n]=t[e].split(s0).map(t=>t.trim());"stop-color"===s?i=n:"stop-opacity"===s&&(r=n);}}let n=new ek(i||t.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:sZ(t.getAttribute("offset"),0),color:n.toRgb(),opacity:sK(parseFloat(r||t.getAttribute("stop-opacity")||""),1)*n.getAlpha()*e};}(r[t],s));return i;}(t,i.opacity),gradientUnits:s,gradientTransform:rN(t.getAttribute("gradientTransform")||"")},"pixels"===s?{offsetX:e.width/2-n.x,offsetY:e.height/2-n.y}:{offsetX:0,offsetY:0}));}}o(s4,"type","Gradient"),te.setClass(s4,"gradient"),te.setClass(s4,"linear"),te.setClass(s4,"radial");let s3=["type","source","patternTransform"];class s6{get type(){return"pattern";}set type(t){f("warn","Setting type has no effect",t);}constructor(t){o(this,"repeat","repeat"),o(this,"offsetX",0),o(this,"offsetY",0),o(this,"crossOrigin",""),this.id=tp(),Object.assign(this,t);}isImageSource(){return!!this.source&&"string"==typeof this.source.src;}isCanvasSource(){return!!this.source&&!!this.source.toDataURL;}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():"";}toLive(t){return this.source&&(!this.isImageSource()||this.source.complete&&0!==this.source.naturalWidth&&0!==this.source.naturalHeight)?t.createPattern(this.source,this.repeat):null;}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{repeat:e,crossOrigin:i}=this;return h(h({},tY(this,t)),{},{type:"pattern",source:this.sourceToString(),repeat:e,crossOrigin:i,offsetX:tV(this.offsetX,g.NUM_FRACTION_DIGITS),offsetY:tV(this.offsetY,g.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null});}toSVG(t){let{width:e,height:i}=t,{source:r,repeat:s,id:n}=this,a=sK(this.offsetX/e,0),o=sK(this.offsetY/i,0),l="repeat-y"===s||"no-repeat"===s?1+Math.abs(a||0):sK(r.width/e,0),h="repeat-x"===s||"no-repeat"===s?1+Math.abs(o||0):sK(r.height/i,0);return['<pattern id="SVGID_'.concat(n,'" x="').concat(a,'" y="').concat(o,'" width="').concat(l,'" height="').concat(h,'">'),'<image x="0" y="0" width="'.concat(r.width,'" height="').concat(r.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join("\n");}static async fromObject(t,e){let{type:i,source:r,patternTransform:s}=t,n=c(t,s3),a=await tB(r,h(h({},e),{},{crossOrigin:n.crossOrigin}));return new this(h(h({},n),{},{patternTransform:s&&s.slice(0),source:a}));}}o(s6,"type","Pattern"),te.setClass(s6),te.setClass(s6,"pattern");class s8{constructor(t){o(this,"color","rgb(0, 0, 0)"),o(this,"width",1),o(this,"shadow",null),o(this,"strokeLineCap","round"),o(this,"strokeLineJoin","round"),o(this,"strokeMiterLimit",10),o(this,"strokeDashArray",null),o(this,"limitedToCanvasSize",!1),this.canvas=t;}_setBrushStyles(t){t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.miterLimit=this.strokeMiterLimit,t.lineJoin=this.strokeLineJoin,t.setLineDash(this.strokeDashArray||[]);}_saveAndTransform(t){let e=this.canvas.viewportTransform;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]);}needsFullRender(){return 1>new ek(this.color).getAlpha()||!!this.shadow;}_setShadow(){if(!this.shadow||!this.canvas)return;let t=this.canvas,e=this.shadow,i=t.contextTop,r=t.getZoom()*t.getRetinaScaling();i.shadowColor=e.color,i.shadowBlur=e.blur*r,i.shadowOffsetX=e.offsetX*r,i.shadowOffsetY=e.offsetY*r;}_resetShadow(){let t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0;}_isOutSideCanvas(t){return t.x<0||t.x>this.canvas.getWidth()||t.y<0||t.y>this.canvas.getHeight();}}let s7=["path","left","top"],s9=["d"];class nt extends ru{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{path:i,left:r,top:s}=e,n=c(e,s7);super(),Object.assign(this,nt.ownDefaults),this.setOptions(n),this._setPath(t||[],!0),"number"==typeof r&&this.set(P,r),"number"==typeof s&&this.set("top",s);}_setPath(t,e){this.path=sg(Array.isArray(t)?t:sD(t)),this.setBoundingBox(e);}_findCenterFromElement(){let t=this._calcBoundsFromPath();return new to(t.left+t.width/2,t.top+t.height/2);}_renderPathCommands(t){let e=-this.pathOffset.x,i=-this.pathOffset.y;for(let r of(t.beginPath(),this.path))switch(r[0]){case"L":t.lineTo(r[1]+e,r[2]+i);break;case"M":t.moveTo(r[1]+e,r[2]+i);break;case"C":t.bezierCurveTo(r[1]+e,r[2]+i,r[3]+e,r[4]+i,r[5]+e,r[6]+i);break;case"Q":t.quadraticCurveTo(r[1]+e,r[2]+i,r[3]+e,r[4]+i);break;case"Z":t.closePath();}}_render(t){this._renderPathCommands(t),this._renderPaintInOrder(t);}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>");}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return h(h({},super.toObject(t)),{},{path:this.path.map(t=>t.slice())});}toDatalessObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this.toObject(t);return this.sourcePath&&(delete e.path,e.sourcePath=this.sourcePath),e;}_toSVG(){let t=sA(this.path,g.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(t,'" stroke-linecap="round" />\n')];}_getOffsetTransform(){let t=g.NUM_FRACTION_DIGITS;return" translate(".concat(tV(-this.pathOffset.x,t),", ").concat(tV(-this.pathOffset.y,t),")");}toClipPathSVG(t){let e=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e});}toSVG(t){let e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e});}complexity(){return this.path.length;}setDimensions(){this.setBoundingBox();}setBoundingBox(t){let{width:e,height:i,pathOffset:r}=this._calcDimensions();this.set({width:e,height:i,pathOffset:r}),t&&this.setPositionByOrigin(r,A,A);}_calcBoundsFromPath(){let t=[],e=0,i=0,r=0,s=0;for(let n of this.path)switch(n[0]){case"L":r=n[1],s=n[2],t.push({x:e,y:i},{x:r,y:s});break;case"M":r=n[1],s=n[2],e=r,i=s;break;case"C":t.push(...sd(r,s,n[1],n[2],n[3],n[4],n[5],n[6])),r=n[5],s=n[6];break;case"Q":t.push(...sd(r,s,n[1],n[2],n[1],n[2],n[3],n[4])),r=n[3],s=n[4];break;case"Z":r=e,s=i;}return t9(t);}_calcDimensions(){let t=this._calcBoundsFromPath();return h(h({},t),{},{pathOffset:new to(t.left+t.width/2,t.top+t.height/2)});}static fromObject(t){return this._fromObject(t,{extraParam:"path"});}static async fromElement(t,e,i){let r=rq(t,this.ATTRIBUTE_NAMES,i),{d:s}=r;return new this(s,h(h(h({},c(r,s9)),e),{},{left:void 0,top:void 0}));}}o(nt,"type","Path"),o(nt,"cacheProperties",[...il,"path","fillRule"]),o(nt,"ATTRIBUTE_NAMES",[...rO,"d"]),te.setClass(nt),te.setSVGClass(nt);class ne extends s8{constructor(t){super(t),o(this,"decimate",.4),o(this,"drawStraightLine",!1),o(this,"straightLineKey","shiftKey"),this._points=[],this._hasStraightLine=!1;}needsFullRender(){return super.needsFullRender()||this._hasStraightLine;}static drawSegment(t,e,i){let r=e.midPointFrom(i);return t.quadraticCurveTo(e.x,e.y,r.x,r.y),r;}onMouseDown(t,e){let{e:i}=e;this.canvas._isMainEvent(i)&&(this.drawStraightLine=!!this.straightLineKey&&i[this.straightLineKey],this._prepareForDrawing(t),this._addPoint(t),this._render());}onMouseMove(t,e){let{e:i}=e;if(this.canvas._isMainEvent(i)&&(this.drawStraightLine=!!this.straightLineKey&&i[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(t))&&this._addPoint(t)&&this._points.length>1)){if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{let t=this._points,e=t.length,i=this.canvas.contextTop;this._saveAndTransform(i),this.oldEnd&&(i.beginPath(),i.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=ne.drawSegment(i,t[e-2],t[e-1]),i.stroke(),i.restore();}}}onMouseUp(t){let{e:e}=t;return!this.canvas._isMainEvent(e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1);}_prepareForDrawing(t){this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y);}_addPoint(t){return!(this._points.length>1&&t.eq(this._points[this._points.length-1]))&&(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(t),!0);}_reset(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1;}_render(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.canvas.contextTop,e=this._points[0],i=this._points[1];if(this._saveAndTransform(t),t.beginPath(),2===this._points.length&&e.x===i.x&&e.y===i.y){let t=this.width/1e3;e.x-=t,i.x+=t;}t.moveTo(e.x,e.y);for(let r=1;r<this._points.length;r++)ne.drawSegment(t,e,i),e=this._points[r],i=this._points[r+1];t.lineTo(e.x,e.y),t.stroke(),t.restore();}convertPointsToSVGPath(t){return sE(t,this.width/1e3);}createPath(t){let e=new nt(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,e.shadow=new is(this.shadow)),e;}decimatePoints(t,e){if(t.length<=2)return t;let i=t[0],r=Math.pow(e/this.canvas.getZoom(),2),s=t.length-1,n=[i];for(let e=1;e<s-1;e++)Math.pow(i.x-t[e].x,2)+Math.pow(i.y-t[e].y,2)>=r&&n.push(i=t[e]);return n.push(t[s]),n;}_finalizeAndAddPath(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));let t=this.convertPointsToSVGPath(this._points);if("M 0 0 Q 0 0 0 0 L 0 0"===sA(t))return void this.canvas.requestRenderAll();let e=this.createPath(t);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:e}),this.canvas.add(e),this.canvas.requestRenderAll(),e.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:e});}}let ni=["left","top","radius"],nr=["radius","startAngle","endAngle","counterClockwise"];class ns extends ru{static getDefaults(){return h(h({},super.getDefaults()),ns.ownDefaults);}constructor(t){super(),Object.assign(this,ns.ownDefaults),this.setOptions(t);}_set(t,e){return super._set(t,e),"radius"===t&&this.setRadius(e),this;}_render(t){t.beginPath(),t.arc(0,0,this.radius,tw(this.startAngle),tw(this.endAngle),this.counterClockwise),this._renderPaintInOrder(t);}getRadiusX(){return this.get("radius")*this.get(U);}getRadiusY(){return this.get("radius")*this.get($);}setRadius(t){this.radius=t,this.set({width:2*t,height:2*t});}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...nr,...t]);}_toSVG(){let t=(this.endAngle-this.startAngle)%360;if(0===t)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),'" />\n'];{let{radius:e}=this,i=tw(this.startAngle),r=tw(this.endAngle),s=tn(i)*e,n=ta(i)*e,a=tn(r)*e,o=ta(r)*e,l=this.counterClockwise?0:1;return['<path d="M '.concat(s," ").concat(n," A ").concat(e," ").concat(e," 0 ").concat(t>180?1:0," ").concat(l," ").concat(a," ").concat(o,'" '),"COMMON_PARTS"," />\n"];}}static async fromElement(t,e,i){let r=rq(t,this.ATTRIBUTE_NAMES,i),{left:s=0,top:n=0,radius:a=0}=r;return new this(h(h({},c(r,ni)),{},{radius:a,left:s-a,top:n-a}));}static fromObject(t){return super._fromObject(t);}}o(ns,"type","Circle"),o(ns,"cacheProperties",[...il,...nr]),o(ns,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),o(ns,"ATTRIBUTE_NAMES",["cx","cy","r",...rO]),te.setClass(ns),te.setSVGClass(ns);class nn extends s8{constructor(t){super(t),o(this,"width",10),this.points=[];}drawDot(t){let e=this.addPoint(t),i=this.canvas.contextTop;this._saveAndTransform(i),this.dot(i,e),i.restore();}dot(t,e){t.fillStyle=e.fill,t.beginPath(),t.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),t.closePath(),t.fill();}onMouseDown(t){this.points=[],this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t);}_render(){let t=this.canvas.contextTop,e=this.points;this._saveAndTransform(t);for(let i=0;i<e.length;i++)this.dot(t,e[i]);t.restore();}onMouseMove(t){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(t)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(t),this._render()):this.drawDot(t));}onMouseUp(){let t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;let e=[];for(let t=0;t<this.points.length;t++){let i=this.points[t],r=new ns({radius:i.radius,left:i.x,top:i.y,originX:A,originY:A,fill:i.fill});this.shadow&&(r.shadow=new is(this.shadow)),e.push(r);}let i=new si(e,{canvas:this.canvas});this.canvas.fire("before:path:created",{path:i}),this.canvas.add(i),this.canvas.fire("path:created",{path:i}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.requestRenderAll();}addPoint(t){let{x:e,y:i}=t,r={x:e,y:i,radius:sF(Math.max(0,this.width-20),this.width+20)/2,fill:new ek(this.color).setAlpha(sF(0,100)/100).toRgba()};return this.points.push(r),r;}}class na extends s8{constructor(t){super(t),o(this,"width",10),o(this,"density",20),o(this,"dotWidth",1),o(this,"dotWidthVariance",1),o(this,"randomOpacity",!1),o(this,"optimizeOverlapping",!0),this.sprayChunks=[],this.sprayChunk=[];}onMouseDown(t){this.sprayChunks=[],this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.renderChunck(this.sprayChunk);}onMouseMove(t){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(t)||(this.addSprayChunk(t),this.renderChunck(this.sprayChunk));}onMouseUp(){let t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;let e=[];for(let t=0;t<this.sprayChunks.length;t++){let i=this.sprayChunks[t];for(let t=0;t<i.length;t++){let r=i[t],s=new rZ({width:r.width,height:r.width,left:r.x+1,top:r.y+1,originX:A,originY:A,fill:this.color});e.push(s);}}let i=new si(this.optimizeOverlapping?function(t){let e={},i=[];for(let r,s=0;s<t.length;s++)e[r="".concat(t[s].left).concat(t[s].top)]||(e[r]=!0,i.push(t[s]));return i;}(e):e,{objectCaching:!0,subTargetCheck:!1,interactive:!1});this.shadow&&i.set("shadow",new is(this.shadow)),this.canvas.fire("before:path:created",{path:i}),this.canvas.add(i),this.canvas.fire("path:created",{path:i}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.requestRenderAll();}renderChunck(t){let e=this.canvas.contextTop;e.fillStyle=this.color,this._saveAndTransform(e);for(let i=0;i<t.length;i++){let r=t[i];e.globalAlpha=r.opacity,e.fillRect(r.x,r.y,r.width,r.width);}e.restore();}_render(){let t=this.canvas.contextTop;t.fillStyle=this.color,this._saveAndTransform(t);for(let t=0;t<this.sprayChunks.length;t++)this.renderChunck(this.sprayChunks[t]);t.restore();}addSprayChunk(t){this.sprayChunk=[];let e=this.width/2;for(let i=0;i<this.density;i++)this.sprayChunk.push({x:sF(t.x-e,t.x+e),y:sF(t.y-e,t.y+e),width:this.dotWidthVariance?sF(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,opacity:this.randomOpacity?sF(0,100)/100:1});this.sprayChunks.push(this.sprayChunk);}}class no extends ne{constructor(t){super(t);}getPatternSrc(){let t=tm(),e=t.getContext("2d");return t.width=t.height=25,e&&(e.fillStyle=this.color,e.beginPath(),e.arc(10,10,10,0,2*Math.PI,!1),e.closePath(),e.fill()),t;}getPattern(t){return t.createPattern(this.source||this.getPatternSrc(),"repeat");}_setBrushStyles(t){super._setBrushStyles(t);let e=this.getPattern(t);e&&(t.strokeStyle=e);}createPath(t){let e=super.createPath(t),i=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new s6({source:this.source||this.getPatternSrc(),offsetX:-i.x,offsetY:-i.y}),e;}}let nl=["x1","y1","x2","y2"],nh=["x1","y1","x2","y2"],nc=["x1","x2","y1","y2"];class nd extends ru{constructor(){let[t,e,i,r]=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,nd.ownDefaults),this.setOptions(s),this.x1=t,this.x2=i,this.y1=e,this.y2=r,this._setWidthHeight();let{left:n,top:a}=s;"number"==typeof n&&this.set(P,n),"number"==typeof a&&this.set("top",a);}_setWidthHeight(){let{x1:t,y1:e,x2:i,y2:r}=this;this.width=Math.abs(i-t),this.height=Math.abs(r-e);let{left:s,top:n,width:a,height:o}=t9([{x:t,y:e},{x:i,y:r}]),l=new to(s+a/2,n+o/2);this.setPositionByOrigin(l,A,A);}_set(t,e){return super._set(t,e),nc.includes(t)&&this._setWidthHeight(),this;}_render(t){var e;t.beginPath();let i=this.calcLinePoints();t.moveTo(i.x1,i.y1),t.lineTo(i.x2,i.y2),t.lineWidth=this.strokeWidth;let r=t.strokeStyle;tH(this.stroke)?t.strokeStyle=this.stroke.toLive(t):t.strokeStyle=null!==(e=this.stroke)&&void 0!==e?e:t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=r;}_findCenterFromElement(){return new to((this.x1+this.x2)/2,(this.y1+this.y2)/2);}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return h(h({},super.toObject(t)),this.calcLinePoints());}_getNonTransformedDimensions(){let t=super._getNonTransformedDimensions();return"butt"===this.strokeLineCap&&(0===this.width&&(t.y-=this.strokeWidth),0===this.height&&(t.x-=this.strokeWidth)),t;}calcLinePoints(){let{x1:t,x2:e,y1:i,y2:r,width:s,height:n}=this,a=t<=e?-1:1,o=i<=r?-1:1;return{x1:a*s/2,x2:-(a*s)/2,y1:o*n/2,y2:-(o*n)/2};}_toSVG(){let{x1:t,x2:e,y1:i,y2:r}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(t,'" y1="').concat(i,'" x2="').concat(e,'" y2="').concat(r,'" />\n')];}static async fromElement(t,e,i){let r=rq(t,this.ATTRIBUTE_NAMES,i),{x1:s=0,y1:n=0,x2:a=0,y2:o=0}=r;return new this([s,n,a,o],c(r,nl));}static fromObject(t){let{x1:e,y1:i,x2:r,y2:s}=t,n=c(t,nh);return this._fromObject(h(h({},n),{},{points:[e,i,r,s]}),{extraParam:"points"});}}o(nd,"type","Line"),o(nd,"cacheProperties",[...il,...nc]),o(nd,"ATTRIBUTE_NAMES",rO.concat(nc)),te.setClass(nd),te.setSVGClass(nd);class nu extends ru{static getDefaults(){return h(h({},super.getDefaults()),nu.ownDefaults);}constructor(t){super(),Object.assign(this,nu.ownDefaults),this.setOptions(t);}_render(t){let e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this._renderPaintInOrder(t);}_toSVG(){let t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-t," ").concat(e,",0 ").concat(-e,",").concat(t," ").concat(e),'" />'];}}o(nu,"type","Triangle"),o(nu,"ownDefaults",{width:100,height:100}),te.setClass(nu),te.setSVGClass(nu);let ng=["rx","ry"];class nf extends ru{static getDefaults(){return h(h({},super.getDefaults()),nf.ownDefaults);}constructor(t){super(),Object.assign(this,nf.ownDefaults),this.setOptions(t);}_set(t,e){switch(super._set(t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e);}return this;}getRx(){return this.get("rx")*this.get(U);}getRy(){return this.get("ry")*this.get($);}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...ng,...t]);}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,'" />\n')];}_render(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,M,!1),t.restore(),this._renderPaintInOrder(t);}static async fromElement(t,e,i){let r=rq(t,this.ATTRIBUTE_NAMES,i);return r.left=(r.left||0)-r.rx,r.top=(r.top||0)-r.ry,new this(r);}}function np(t){if(!t)return[];let e=t.replace(/,/g," ").trim().split(/\s+/),i=[];for(let t=0;t<e.length;t+=2)i.push({x:parseFloat(e[t]),y:parseFloat(e[t+1])});return i;}o(nf,"type","Ellipse"),o(nf,"cacheProperties",[...il,...ng]),o(nf,"ownDefaults",{rx:0,ry:0}),o(nf,"ATTRIBUTE_NAMES",[...rO,"cx","cy","rx","ry"]),te.setClass(nf),te.setSVGClass(nf);let nm=["left","top"],nv={exactBoundingBox:!1};class nx extends ru{static getDefaults(){return h(h({},super.getDefaults()),nx.ownDefaults);}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),o(this,"strokeDiff",void 0),Object.assign(this,nx.ownDefaults),this.setOptions(e),this.points=t;let{left:i,top:r}=e;this.initialized=!0,this.setBoundingBox(!0),"number"==typeof i&&this.set(P,i),"number"==typeof r&&this.set("top",r);}isOpen(){return!0;}_projectStrokeOnPoints(t){return rx(this.points,t,this.isOpen());}_calcDimensions(t){t=h({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},t||{});let e=this.exactBoundingBox?this._projectStrokeOnPoints(t).map(t=>t.projectedPoint):this.points;if(0===e.length)return{left:0,top:0,width:0,height:0,pathOffset:new to,strokeOffset:new to,strokeDiff:new to};let i=t9(e),r=tL(h(h({},t),{},{scaleX:1,scaleY:1})),s=t9(this.points.map(t=>tS(t,r,!0))),n=new to(this.scaleX,this.scaleY),a=i.left+i.width/2,o=i.top+i.height/2;return this.exactBoundingBox&&(a-=o*Math.tan(tw(this.skewX)),o-=a*Math.tan(tw(this.skewY))),h(h({},i),{},{pathOffset:new to(a,o),strokeOffset:new to(s.left,s.top).subtract(new to(i.left,i.top)).multiply(n),strokeDiff:new to(i.width,i.height).subtract(new to(s.width,s.height)).multiply(n)});}_findCenterFromElement(){let t=t9(this.points);return new to(t.left+t.width/2,t.top+t.height/2);}setDimensions(){this.setBoundingBox();}setBoundingBox(t){let{left:e,top:i,width:r,height:s,pathOffset:n,strokeOffset:a,strokeDiff:o}=this._calcDimensions();this.set({width:r,height:s,pathOffset:n,strokeOffset:a,strokeDiff:o}),t&&this.setPositionByOrigin(new to(e+r/2,i+s/2),A,A);}isStrokeAccountedForInDimensions(){return this.exactBoundingBox;}_getNonTransformedDimensions(){return this.exactBoundingBox?new to(this.width,this.height):super._getNonTransformedDimensions();}_getTransformedDimensions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.exactBoundingBox){var e,i,r,s;let n;if(Object.keys(t).some(t=>this.strokeUniform||this.constructor.layoutProperties.includes(t))){let{width:r,height:s}=this._calcDimensions(t);n=new to(null!==(e=t.width)&&void 0!==e?e:r,null!==(i=t.height)&&void 0!==i?i:s);}else n=new to(null!==(r=t.width)&&void 0!==r?r:this.width,null!==(s=t.height)&&void 0!==s?s:this.height);return n.multiply(new to(t.scaleX||this.scaleX,t.scaleY||this.scaleY));}return super._getTransformedDimensions(t);}_set(t,e){let i=this.initialized&&this[t]!==e,r=super._set(t,e);return this.exactBoundingBox&&i&&((t===U||t===$)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(t))&&this.setDimensions(),r;}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return h(h({},super.toObject(t)),{},{points:this.points.map(t=>{let{x:e,y:i}=t;return{x:e,y:i};})});}_toSVG(){let t=[],e=this.pathOffset.x,i=this.pathOffset.y,r=g.NUM_FRACTION_DIGITS;for(let s=0,n=this.points.length;s<n;s++)t.push(tV(this.points[s].x-e,r),",",tV(this.points[s].y-i,r)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(t.join(""),'" />\n')];}_render(t){let e=this.points.length,i=this.pathOffset.x,r=this.pathOffset.y;if(e&&!isNaN(this.points[e-1].y)){t.beginPath(),t.moveTo(this.points[0].x-i,this.points[0].y-r);for(let s=0;s<e;s++){let e=this.points[s];t.lineTo(e.x-i,e.y-r);}this.isOpen()||t.closePath(),this._renderPaintInOrder(t);}}complexity(){return this.points.length;}static async fromElement(t,e,i){return new this(np(t.getAttribute("points")),h(h({},c(rq(t,this.ATTRIBUTE_NAMES,i),nm)),e));}static fromObject(t){return this._fromObject(t,{extraParam:"points"});}}o(nx,"ownDefaults",nv),o(nx,"type","Polyline"),o(nx,"layoutProperties",[q,K,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),o(nx,"cacheProperties",[...il,"points"]),o(nx,"ATTRIBUTE_NAMES",[...rO]),te.setClass(nx),te.setSVGClass(nx);class ny extends nx{isOpen(){return!1;}}o(ny,"ownDefaults",nv),o(ny,"type","Polygon"),te.setClass(ny),te.setSVGClass(ny);class nb extends ru{isEmptyStyles(t){if(!this.styles||void 0!==t&&!this.styles[t])return!0;let e=void 0===t?this.styles:{line:this.styles[t]};for(let t in e)for(let i in e[t])for(let r in e[t][i])return!1;return!0;}styleHas(t,e){if(!this.styles||void 0!==e&&!this.styles[e])return!1;let i=void 0===e?this.styles:{0:this.styles[e]};for(let e in i)for(let r in i[e])if(void 0!==i[e][r][t])return!0;return!1;}cleanStyle(t){if(!this.styles)return!1;let e=this.styles,i,r,s=0,n=!0,a=0;for(let a in e){for(let o in i=0,e[a]){let l=e[a][o]||{};s++,void 0!==l[t]?(r?l[t]!==r&&(n=!1):r=l[t],l[t]===this[t]&&delete l[t]):n=!1,0!==Object.keys(l).length?i++:delete e[a][o];}0===i&&delete e[a];}for(let t=0;t<this._textLines.length;t++)a+=this._textLines[t].length;n&&s===a&&(this[t]=r,this.removeStyle(t));}removeStyle(t){let e,i,r;if(!this.styles)return;let s=this.styles;for(i in s){for(r in e=s[i])delete e[r][t],0===Object.keys(e[r]).length&&delete e[r];0===Object.keys(e).length&&delete s[i];}}_extendStyles(t,e){let{lineIndex:i,charIndex:r}=this.get2DCursorLocation(t);this._getLineStyle(i)||this._setLineStyle(i);let s=tz(h(h({},this._getStyleDeclaration(i,r)),e),t=>void 0!==t);this._setStyleDeclaration(i,r,s);}getSelectionStyles(t,e,i){let r=[];for(let s=t;s<(e||t);s++)r.push(this.getStyleAtPosition(s,i));return r;}getStyleAtPosition(t,e){let{lineIndex:i,charIndex:r}=this.get2DCursorLocation(t);return e?this.getCompleteStyleDeclaration(i,r):this._getStyleDeclaration(i,r);}setSelectionStyles(t,e,i){for(let r=e;r<(i||e);r++)this._extendStyles(r,t);this._forceClearCache=!0;}_getStyleDeclaration(t,e){var i;let r=this.styles&&this.styles[t];return r&&null!==(i=r[e])&&void 0!==i?i:{};}getCompleteStyleDeclaration(t,e){return h(h({},tY(this,this.constructor._styleProperties)),this._getStyleDeclaration(t,e));}_setStyleDeclaration(t,e,i){this.styles[t][e]=i;}_deleteStyleDeclaration(t,e){delete this.styles[t][e];}_getLineStyle(t){return!!this.styles[t];}_setLineStyle(t){this.styles[t]={};}_deleteLineStyle(t){delete this.styles[t];}}o(nb,"_styleProperties",eB);let nw=/  +/g,nC=/"/g;function n_(t,e,i,r,s){return"		".concat(function(t,e){let{left:i,top:r,width:s,height:n}=e,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.NUM_FRACTION_DIGITS,o=eD(J,t,!1),[l,h,c,d]=[i,r,s,n].map(t=>tV(t,a));return"<rect ".concat(o,' x="').concat(l,'" y="').concat(h,'" width="').concat(c,'" height="').concat(d,'"></rect>');}(t,{left:e,top:i,width:r,height:s}),"\n");}let nS=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];class nj extends nb{static getDefaults(){return h(h({},super.getDefaults()),nj.ownDefaults);}constructor(t,e){super(),o(this,"__charBounds",[]),Object.assign(this,nj.ownDefaults),this.setOptions(e),this.styles||(this.styles={}),this.text=t,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords();}setPathInfo(){let t=this.path;t&&(t.segmentsInfo=sS(t.path));}_splitText(){let t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t;}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(eW)&&this.enlargeSpaces();}enlargeSpaces(){let t,e,i,r,s,n,a;for(let o=0,l=this._textLines.length;o<l;o++)if((this.textAlign===eW||o!==l-1&&!this.isEndOfWrapping(o))&&(r=0,s=this._textLines[o],(e=this.getLineWidth(o))<this.width&&(a=this.textLines[o].match(this._reSpacesAndTabs)))){i=a.length,t=(this.width-e)/i;for(let e=0;e<=s.length;e++)n=this.__charBounds[o][e],this._reSpaceAndTab.test(s[e])?(n.width+=t,n.kernedWidth+=t,n.left+=r,r+=t):n.left+=r;}}isEndOfWrapping(t){return t===this._textLines.length-1;}missingNewlineOffset(t){return 1;}get2DCursorLocation(t,e){let i;let r=e?this._unwrappedTextLines:this._textLines;for(i=0;i<r.length;i++){if(t<=r[i].length)return{lineIndex:i,charIndex:t};t-=r[i].length+this.missingNewlineOffset(i,e);}return{lineIndex:i-1,charIndex:r[i-1].length<t?r[i-1].length:t};}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>');}_getCacheCanvasDimensions(){let t=super._getCacheCanvasDimensions(),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t;}_render(t){let e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough");}_renderText(t){this.paintFirst===Z?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t));}_setTextStyles(t,e,i){if(t.textBaseline="alphabetic",this.path)switch(this.pathAlign){case A:t.textBaseline="middle";break;case"ascender":t.textBaseline="top";break;case"descender":t.textBaseline=F;}t.font=this._getFontDeclaration(e,i);}calcTextWidth(){let t=this.getLineWidth(0);for(let e=1,i=this._textLines.length;e<i;e++){let i=this.getLineWidth(e);i>t&&(t=i);}return t;}_renderTextLine(t,e,i,r,s,n){this._renderChars(t,e,i,r,s,n);}_renderTextLinesBackground(t){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;let e=t.fillStyle,i=this._getLeftOffset(),r=this._getTopOffset();for(let e=0,s=this._textLines.length;e<s;e++){let s=this.getHeightOfLine(e);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",e)){r+=s;continue;}let n=this._textLines[e].length,a=this._getLineLeftOffset(e),o,l,h=0,c=0,d=this.getValueOfPropertyAt(e,0,"textBackgroundColor"),u=this.getHeightOfLineImpl(e);for(let s=0;s<n;s++){let n=this.__charBounds[e][s];l=this.getValueOfPropertyAt(e,s,"textBackgroundColor"),this.path?(t.save(),t.translate(n.renderLeft,n.renderTop),t.rotate(n.angle),t.fillStyle=l,l&&t.fillRect(-n.width/2,-u*(1-this._fontSizeFraction),n.width,u),t.restore()):l!==d?(o=i+a+c,"rtl"===this.direction&&(o=this.width-o-h),t.fillStyle=d,d&&t.fillRect(o,r,h,u),c=n.left,h=n.width,d=l):h+=n.kernedWidth;}l&&!this.path&&(o=i+a+c,"rtl"===this.direction&&(o=this.width-o-h),t.fillStyle=l,t.fillRect(o,r,h,u)),r+=s;}t.fillStyle=e,this._removeShadow(t);}_measureChar(t,e,i,r){let s,a,o,l;let h=j.getFontCache(e),c=this._getFontDeclaration(e),d=i?i+t:t,u=i&&c===this._getFontDeclaration(r),g=e.fontSize/this.CACHE_FONT_SIZE;if(i&&h.has(i)&&(o=h.get(i)),h.has(t)&&(l=s=h.get(t)),u&&h.has(d)&&(l=(a=h.get(d))-o),void 0===s||void 0===o||void 0===a){let r=(n||(n=tx({width:0,height:0}).getContext("2d")),n);this._setTextStyles(r,e,!0),void 0===s&&(l=s=r.measureText(t).width,h.set(t,s)),void 0===o&&u&&i&&(o=r.measureText(i).width,h.set(i,o)),u&&void 0===a&&(a=r.measureText(d).width,h.set(d,a),l=a-o);}return{width:s*g,kernedWidth:l*g};}getHeightOfChar(t,e){return this.getValueOfPropertyAt(t,e,"fontSize");}measureLine(t){let e=this._measureLine(t);return 0!==this.charSpacing&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e;}_measureLine(t){let e,i,r=0,s=this.pathSide===R,n=this.path,a=this._textLines[t],o=a.length,l=Array(o);this.__charBounds[t]=l;for(let s=0;s<o;s++){let n=a[s];i=this._getGraphemeBox(n,t,s,e),l[s]=i,r+=i.kernedWidth,e=n;}if(l[o]={left:i?i.left+i.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},n&&n.segmentsInfo){let t=0,e=n.segmentsInfo[n.segmentsInfo.length-1].length;switch(this.textAlign){case P:t=s?e-r:0;break;case A:t=(e-r)/2;break;case R:t=s?0:e-r;}t+=this.pathStartOffset*(s?-1:1);for(let r=s?o-1:0;s?r>=0:r<o;s?r--:r++)i=l[r],t>e?t%=e:t<0&&(t+=e),this._setGraphemeOnPath(t,i),t+=i.kernedWidth;}return{width:r,numOfSpaces:0};}_setGraphemeOnPath(t,e){let i=t+e.kernedWidth/2,r=this.path,s=sj(r.path,i,r.segmentsInfo);e.renderLeft=s.x-r.pathOffset.x,e.renderTop=s.y-r.pathOffset.y,e.angle=s.angle+(this.pathSide===R?Math.PI:0);}_getGraphemeBox(t,e,i,r,s){let n=this.getCompleteStyleDeclaration(e,i),a=r?this.getCompleteStyleDeclaration(e,i-1):{},o=this._measureChar(t,n,r,a),l,h=o.kernedWidth,c=o.width;0!==this.charSpacing&&(c+=l=this._getWidthOfCharSpacing(),h+=l);let d={width:c,left:0,height:n.fontSize,kernedWidth:h,deltaY:n.deltaY};if(i>0&&!s){let t=this.__charBounds[e][i-1];d.left=t.left+t.width+o.kernedWidth-o.width;}return d;}getHeightOfLineImpl(t){let e=this.__lineHeights;if(e[t])return e[t];let i=this.getHeightOfChar(t,0);for(let e=1,r=this._textLines[t].length;e<r;e++)i=Math.max(this.getHeightOfChar(t,e),i);return e[t]=i*this._fontSizeMult;}getHeightOfLine(t){return this.getHeightOfLineImpl(t)*this.lineHeight;}calcTextHeight(){let t=0;for(let e=0,i=this._textLines.length;e<i;e++)t+=e===i-1?this.getHeightOfLineImpl(e):this.getHeightOfLine(e);return t;}_getLeftOffset(){return"ltr"===this.direction?-this.width/2:this.width/2;}_getTopOffset(){return-this.height/2;}_renderTextCommon(t,e){t.save();let i=0,r=this._getLeftOffset(),s=this._getTopOffset();for(let n=0,a=this._textLines.length;n<a;n++)this._renderTextLine(e,t,this._textLines[n],r+this._getLineLeftOffset(n),s+i+this.getHeightOfLineImpl(n),n),i+=this.getHeightOfLine(n);t.restore();}_renderTextFill(t){(this.fill||this.styleHas(J))&&this._renderTextCommon(t,"fillText");}_renderTextStroke(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore());}_renderChars(t,e,i,r,s,n){let a=this.textAlign.includes(eW),o=this.path,l=!a&&0===this.charSpacing&&this.isEmptyStyles(n)&&!o,h="ltr"===this.direction,c="ltr"===this.direction?1:-1,d=e.direction,u,g,f,p,m,v="",x=0;if(e.save(),d!==this.direction&&(e.canvas.setAttribute("dir",h?"ltr":"rtl"),e.direction=h?"ltr":"rtl",e.textAlign=h?P:R),s-=this.getHeightOfLineImpl(n)*this._fontSizeFraction,l)return this._renderChar(t,e,n,0,i.join(""),r,s),void e.restore();for(let l=0,h=i.length-1;l<=h;l++)p=l===h||this.charSpacing||o,v+=i[l],f=this.__charBounds[n][l],0===x?(r+=c*(f.kernedWidth-f.width),x+=f.width):x+=f.kernedWidth,a&&!p&&this._reSpaceAndTab.test(i[l])&&(p=!0),p||(p=rj(u=u||this.getCompleteStyleDeclaration(n,l),g=this.getCompleteStyleDeclaration(n,l+1),!1)),p&&(o?(e.save(),e.translate(f.renderLeft,f.renderTop),e.rotate(f.angle),this._renderChar(t,e,n,l,v,-x/2,0),e.restore()):(m=r,this._renderChar(t,e,n,l,v,m,s)),v="",u=g,r+=c*x,x=0);e.restore();}_applyPatternGradientTransformText(t){let e=this.width+this.strokeWidth,i=this.height+this.strokeWidth,r=tx({width:e,height:i}),s=r.getContext("2d");return r.width=e,r.height=i,s.beginPath(),s.moveTo(0,0),s.lineTo(e,0),s.lineTo(e,i),s.lineTo(0,i),s.closePath(),s.translate(e/2,i/2),s.fillStyle=t.toLive(s),this._applyPatternGradientTransform(s,t),s.fill(),s.createPattern(r,"no-repeat");}handleFiller(t,e,i){let r,s;return tH(i)?"percentage"===i.gradientUnits||i.gradientTransform||i.patternTransform?(r=-this.width/2,s=-this.height/2,t.translate(r,s),t[e]=this._applyPatternGradientTransformText(i),{offsetX:r,offsetY:s}):(t[e]=i.toLive(t),this._applyPatternGradientTransform(t,i)):(t[e]=i,{offsetX:0,offsetY:0});}_setStrokeStyles(t,e){let{stroke:i,strokeWidth:r}=e;return t.lineWidth=r,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",i);}_setFillStyles(t,e){let{fill:i}=e;return this.handleFiller(t,"fillStyle",i);}_renderChar(t,e,i,r,s,n,a){let o=this._getStyleDeclaration(i,r),l=this.getCompleteStyleDeclaration(i,r),h="fillText"===t&&l.fill,c="strokeText"===t&&l.stroke&&l.strokeWidth;if(c||h){if(e.save(),e.font=this._getFontDeclaration(l),o.textBackgroundColor&&this._removeShadow(e),o.deltaY&&(a+=o.deltaY),h){let t=this._setFillStyles(e,l);e.fillText(s,n-t.offsetX,a-t.offsetY);}if(c){let t=this._setStrokeStyles(e,l);e.strokeText(s,n-t.offsetX,a-t.offsetY);}e.restore();}}setSuperscript(t,e){this._setScript(t,e,this.superscript);}setSubscript(t,e){this._setScript(t,e,this.subscript);}_setScript(t,e,i){let r=this.get2DCursorLocation(t,!0),s=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"fontSize"),n=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"deltaY"),a={fontSize:s*i.size,deltaY:n+s*i.baseline};this.setSelectionStyles(a,t,e);}_getLineLeftOffset(t){let e=this.getLineWidth(t),i=this.width-e,r=this.textAlign,s=this.direction,n=this.isEndOfWrapping(t),a=0;return r!==eW&&(r!==ez||n)&&(r!==eY||n)&&(r!==eX||n)?(r===A&&(a=i/2),r===R&&(a=i),r===ez&&(a=i/2),r===eY&&(a=i),"rtl"===s&&(r===R||r===eW||r===eY?a=0:r===P||r===eX?a=-i:r!==A&&r!==ez||(a=-i/2)),a):0;}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[];}getLineWidth(t){if(void 0!==this.__lineWidths[t])return this.__lineWidths[t];let{width:e}=this.measureLine(t);return this.__lineWidths[t]=e,e;}_getWidthOfCharSpacing(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0;}getValueOfPropertyAt(t,e,i){var r;return null!==(r=this._getStyleDeclaration(t,e)[i])&&void 0!==r?r:this[i];}_renderTextDecoration(t,e){if(!this[e]&&!this.styleHas(e))return;let i=this._getTopOffset(),r=this._getLeftOffset(),s=this.path,n=this._getWidthOfCharSpacing(),a="linethrough"===e?.5:"overline"===e?1:0,o=this.offsets[e];for(let l=0,h=this._textLines.length;l<h;l++){let h=this.getHeightOfLine(l);if(!this[e]&&!this.styleHas(e,l)){i+=h;continue;}let c=this._textLines[l],d=h/this.lineHeight,u=this._getLineLeftOffset(l),g=0,f=0,p=this.getValueOfPropertyAt(l,0,e),m=this.getValueOfPropertyAt(l,0,J),v=this.getValueOfPropertyAt(l,0,eP),x=p,y=m,b=v,w=i+d*(1-this._fontSizeFraction),C=this.getHeightOfChar(l,0),_=this.getValueOfPropertyAt(l,0,"deltaY");for(let i=0,n=c.length;i<n;i++){let n=this.__charBounds[l][i];x=this.getValueOfPropertyAt(l,i,e),y=this.getValueOfPropertyAt(l,i,J),b=this.getValueOfPropertyAt(l,i,eP);let h=this.getHeightOfChar(l,i),c=this.getValueOfPropertyAt(l,i,"deltaY");if(s&&x&&y){let e=this.fontSize*b/1e3;t.save(),t.fillStyle=m,t.translate(n.renderLeft,n.renderTop),t.rotate(n.angle),t.fillRect(-n.kernedWidth/2,o*h+c-a*e,n.kernedWidth,e),t.restore();}else if((x!==p||y!==m||h!==C||b!==v||c!==_)&&f>0){let e=this.fontSize*v/1e3,i=r+u+g;"rtl"===this.direction&&(i=this.width-i-f),p&&m&&v&&(t.fillStyle=m,t.fillRect(i,w+o*C+_-a*e,f,e)),g=n.left,f=n.width,p=x,v=b,m=y,C=h,_=c;}else f+=n.kernedWidth;}let S=r+u+g;"rtl"===this.direction&&(S=this.width-S-f),t.fillStyle=y;let j=this.fontSize*b/1e3;x&&y&&b&&t.fillRect(S,w+o*C+_-a*j,f-n,j),i+=h;}this._removeShadow(t);}_getFontDeclaration(){let{fontFamily:t=this.fontFamily,fontStyle:e=this.fontStyle,fontWeight:i=this.fontWeight,fontSize:r=this.fontSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0,n=t.includes("'")||t.includes('"')||t.includes(",")||nj.genericFonts.includes(t.toLowerCase())?t:'"'.concat(t,'"');return[e,i,"".concat(s?this.CACHE_FONT_SIZE:r,"px"),n].join(" ");}render(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(t)));}graphemeSplit(t){return rw(t);}_splitTextIntoLines(t){let e=t.split(this._reNewline),i=Array(e.length),r=["\n"],s=[];for(let t=0;t<e.length;t++)i[t]=this.graphemeSplit(e[t]),s=s.concat(i[t],r);return s.pop(),{_unwrappedLines:i,lines:e,graphemeText:s,graphemeLines:i};}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return h(h({},super.toObject([...eI,...t])),{},{styles:rT(this.styles,this.text)},this.path?{path:this.path.toObject()}:{});}set(t,e){let{textLayoutProperties:i}=this.constructor;super.set(t,e);let r=!1,s=!1;if("object"==typeof t)for(let e in t)"path"===e&&this.setPathInfo(),r=r||i.includes(e),s=s||"path"===e;else r=i.includes(t),s="path"===t;return s&&this.setPathInfo(),r&&this.initialized&&(this.initDimensions(),this.setCoords()),this;}complexity(){return 1;}static async fromElement(t,e,i){let r=rq(t,nj.ATTRIBUTE_NAMES,i),s=h(h({},e),r),{textAnchor:n=P,textDecoration:a="",dx:o=0,dy:l=0,top:d=0,left:u=0,fontSize:g=16,strokeWidth:f=1}=s,p=c(s,nS),m=new this(eb(t.textContent||"").trim(),h({left:u+o,top:d+l,underline:a.includes("underline"),overline:a.includes("overline"),linethrough:a.includes("line-through"),strokeWidth:0,fontSize:g},p)),v=m.getScaledHeight()/m.height,x=((m.height+m.strokeWidth)*m.lineHeight-m.height)*v,y=m.getScaledHeight()+x,b=0;return n===A&&(b=m.getScaledWidth()/2),n===R&&(b=m.getScaledWidth()),m.set({left:m.left-b,top:m.top-(y-m.fontSize*(.07+m._fontSizeFraction))/m.lineHeight,strokeWidth:f}),m;}static fromObject(t){return this._fromObject(h(h({},t),{},{styles:rk(t.styles||{},t.text)}),{extraParam:"text"});}}o(nj,"textLayoutProperties",eL),o(nj,"cacheProperties",[...il,...eI]),o(nj,"ownDefaults",{_reNewline:I,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:P,fontStyle:"normal",lineHeight:1.16,textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:P,pathAlign:"baseline",charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.28167,overline:-.81333},_fontSizeMult:1.13,[eP]:66.667}),o(nj,"type","Text"),o(nj,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),o(nj,"ATTRIBUTE_NAMES",rO.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),rd(nj,[class extends eE{_toSVG(){let t=this._getSVGLeftTopOffsets(),e=this._getSVGTextAndBg(t.textTop,t.textLeft);return this._wrapSVGTextAndBg(e);}toSVG(t){let e=this._createBaseSVGMarkup(this._toSVG(),{reviver:t,noStyle:!0,withShadow:!0}),i=this.path;return i?e+i._createBaseSVGMarkup(i._toSVG(),{reviver:t,withShadow:!0,additionalTransform:tN(this.calcOwnMatrix())}):e;}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)};}_wrapSVGTextAndBg(t){let{textBgRects:e,textSpans:i}=t,r=this.getSvgTextDecoration(this);return[e.join(""),'		<text xml:space="preserve" ','font-family="'.concat(this.fontFamily.replace(nC,"'"),'" '),'font-size="'.concat(this.fontSize,'" '),this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",r?'text-decoration="'.concat(r,'" '):"","rtl"===this.direction?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",i.join(""),"</text>\n"];}_getSVGTextAndBg(t,e){let i=[],r=[],s,n=t;this.backgroundColor&&r.push(...n_(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let t=0,a=this._textLines.length;t<a;t++)s=this._getLineLeftOffset(t),"rtl"===this.direction&&(s+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",t))&&this._setSVGTextLineBg(r,t,e+s,n),this._setSVGTextLineText(i,t,e+s,n),n+=this.getHeightOfLine(t);return{textSpans:i,textBgRects:r};}_createTextCharSpan(t,e,i,r,s){let n=g.NUM_FRACTION_DIGITS,a=this.getSvgSpanStyles(e,t!==t.trim()||!!t.match(nw)),o=e.deltaY,l=o?' dy="'.concat(tV(o,n),'" '):"",{angle:h,renderLeft:c,renderTop:d,width:u}=s,f="";if(void 0!==c){h&&(f=' rotate="'.concat(tV(tC(h),n),'"'));let t=tE({angle:tC(h)});t[4]=c,t[5]=d;let e=new to(-(u/2),0).transform(t);i=e.x,r=e.y;}return'<tspan x="'.concat(tV(i,n),'" y="').concat(tV(r,n),'" ').concat(l).concat(f).concat(a?'style="'.concat(a,'"'):"",">").concat(rb(t),"</tspan>");}_setSVGTextLineText(t,e,i,r){let s=this.getHeightOfLine(e),n=this.textAlign.includes(eW),a=this._textLines[e],o,l,h,c,d,u="",g=0;r+=s*(1-this._fontSizeFraction)/this.lineHeight;for(let s=0,f=a.length-1;s<=f;s++)d=s===f||this.charSpacing||this.path,u+=a[s],h=this.__charBounds[e][s],0===g?(i+=h.kernedWidth-h.width,g+=h.width):g+=h.kernedWidth,n&&!d&&this._reSpaceAndTab.test(a[s])&&(d=!0),d||(d=rj(o=o||this.getCompleteStyleDeclaration(e,s),l=this.getCompleteStyleDeclaration(e,s+1),!0)),d&&(c=this._getStyleDeclaration(e,s),t.push(this._createTextCharSpan(u,c,i,r,h)),u="",o=l,"rtl"===this.direction?i-=g:i+=g,g=0);}_setSVGTextLineBg(t,e,i,r){let s=this._textLines[e],n=this.getHeightOfLine(e)/this.lineHeight,a,o=0,l=0,h=this.getValueOfPropertyAt(e,0,"textBackgroundColor");for(let c=0;c<s.length;c++){let{left:s,width:d,kernedWidth:u}=this.__charBounds[e][c];(a=this.getValueOfPropertyAt(e,c,"textBackgroundColor"))!==h?(h&&t.push(...n_(h,i+l,r,o,n)),l=s,o=d,h=a):o+=u;}a&&t.push(...n_(h,i+l,r,o,n));}_getSVGLineTopOffset(t){let e,i=0;for(e=0;e<t;e++)i+=this.getHeightOfLine(e);let r=this.getHeightOfLine(e);return{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*r/(this.lineHeight*this._fontSizeMult)};}getSvgStyles(t){return"".concat(super.getSvgStyles(t)," text-decoration-thickness: ").concat(tV(this.textDecorationThickness*this.getObjectScaling().y/10,g.NUM_FRACTION_DIGITS),"%; white-space: pre;");}getSvgSpanStyles(t,e){let{fontFamily:i,strokeWidth:r,stroke:s,fill:n,fontSize:a,fontStyle:o,fontWeight:l,deltaY:h,textDecorationThickness:c,linethrough:d,overline:u,underline:f}=t,p=this.getSvgTextDecoration({underline:null!=f?f:this.underline,overline:null!=u?u:this.overline,linethrough:null!=d?d:this.linethrough}),m=c||this.textDecorationThickness;return[s?eD(Z,s):"",r?"stroke-width: ".concat(r,"; "):"",i?"font-family: ".concat(i.includes("'")||i.includes('"')?i:"'".concat(i,"'"),"; "):"",a?"font-size: ".concat(a,"px; "):"",o?"font-style: ".concat(o,"; "):"",l?"font-weight: ".concat(l,"; "):"",p?"text-decoration: ".concat(p,"; text-decoration-thickness: ").concat(tV(m*this.getObjectScaling().y/10,g.NUM_FRACTION_DIGITS),"%; "):"",n?eD(J,n):"",h?"baseline-shift: ".concat(-h,"; "):"",e?"white-space: pre; ":""].join("");}getSvgTextDecoration(t){return["overline","underline","line-through"].filter(e=>t[e.replace("-","")]).join(" ");}}]),te.setClass(nj),te.setSVGClass(nj);class nT{constructor(t){o(this,"target",void 0),o(this,"__mouseDownInPlace",!1),o(this,"__dragStartFired",!1),o(this,"__isDraggingOver",!1),o(this,"__dragStartSelection",void 0),o(this,"__dragImageDisposer",void 0),o(this,"_dispose",void 0),this.target=t;let e=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{e.forEach(t=>t()),this._dispose=void 0;};}isPointerOverSelection(t){let e=this.target,i=e.getSelectionStartFromPointer(t);return e.isEditing&&i>=e.selectionStart&&i<=e.selectionEnd&&e.selectionStart<e.selectionEnd;}start(t){return this.__mouseDownInPlace=this.isPointerOverSelection(t);}isActive(){return this.__mouseDownInPlace;}end(t){let e=this.isActive();return e&&!this.__dragStartFired&&(this.target.setCursorByClick(t),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,e;}getDragStartSelection(){return this.__dragStartSelection;}setDragImage(t,e){var i;let{selectionStart:r,selectionEnd:s}=e,n=this.target,a=n.canvas,o=new to(n.flipX?-1:1,n.flipY?-1:1),l=n._getCursorBoundaries(r),h=new to(l.left+l.leftOffset,l.top+l.topOffset).multiply(o).transform(n.calcTransformMatrix()),c=a.getScenePoint(t).subtract(h),d=n.getCanvasRetinaScaling(),u=n.getBoundingRect(),g=h.subtract(new to(u.left,u.top)),f=a.viewportTransform,p=g.add(c).transform(f,!0),m=n.backgroundColor,v=ry(n.styles);n.backgroundColor="";let x={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};n.setSelectionStyles(x,0,r),n.setSelectionStyles(x,s,n.text.length),n.dirty=!0;let y=n.toCanvasElement({enableRetinaScaling:a.enableRetinaScaling,viewportTransform:!0});n.backgroundColor=m,n.styles=v,n.dirty=!0,sP(y,{position:"fixed",left:"".concat(-y.width,"px"),border:L,width:"".concat(y.width/d,"px"),height:"".concat(y.height/d,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{y.remove();},tK(t.target||this.target.hiddenTextarea).body.appendChild(y),null===(i=t.dataTransfer)||void 0===i||i.setDragImage(y,p.x,p.y);}onDragStart(t){this.__dragStartFired=!0;let e=this.target,i=this.isActive();if(i&&t.dataTransfer){let i=this.__dragStartSelection={selectionStart:e.selectionStart,selectionEnd:e.selectionEnd},r=e._text.slice(i.selectionStart,i.selectionEnd).join(""),s=h({text:e.text,value:r},i);t.dataTransfer.setData("text/plain",r),t.dataTransfer.setData("application/fabric",JSON.stringify({value:r,styles:e.getSelectionStyles(i.selectionStart,i.selectionEnd,!0)})),t.dataTransfer.effectAllowed="copyMove",this.setDragImage(t,s);}return e.abortCursorAnimation(),i;}canDrop(t){if(this.target.editable&&!this.target.getActiveControl()&&!t.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){let e=this.target.getSelectionStartFromPointer(t),i=this.__dragStartSelection;return e<i.selectionStart||e>i.selectionEnd;}return!0;}return!1;}targetCanDrop(t){return this.target.canDrop(t);}dragEnterHandler(t){let{e:e}=t,i=this.targetCanDrop(e);!this.__isDraggingOver&&i&&(this.__isDraggingOver=!0);}dragOverHandler(t){let{e:e}=t,i=this.targetCanDrop(e);!this.__isDraggingOver&&i?this.__isDraggingOver=!0:this.__isDraggingOver&&!i&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(e.preventDefault(),t.canDrop=!0,t.dropTarget=this.target);}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1);}dropHandler(t){var e;let{e:i}=t,r=i.defaultPrevented;this.__isDraggingOver=!1,i.preventDefault();let s=null===(e=i.dataTransfer)||void 0===e?void 0:e.getData("text/plain");if(s&&!r){let e=this.target,r=e.canvas,n=e.getSelectionStartFromPointer(i),{styles:a}=i.dataTransfer.types.includes("application/fabric")?JSON.parse(i.dataTransfer.getData("application/fabric")):{},o=s[Math.max(0,s.length-1)];if(this.__dragStartSelection){let t=this.__dragStartSelection.selectionStart,i=this.__dragStartSelection.selectionEnd;n>t&&n<=i?n=t:n>i&&(n-=i-t),e.removeChars(t,i),delete this.__dragStartSelection;}e._reNewline.test(o)&&(e._reNewline.test(e._text[n])||n===e._text.length)&&(s=s.trimEnd()),t.didDrop=!0,t.dropTarget=e,e.insertChars(s,a,n),r.setActiveObject(e),e.enterEditing(i),e.selectionStart=Math.min(n+0,e._text.length),e.selectionEnd=Math.min(e.selectionStart+s.length,e._text.length),e.hiddenTextarea.value=e.text,e._updateTextarea(),e.hiddenTextarea.focus(),e.fire(H,{index:n+0,action:"drop"}),r.fire("text:changed",{target:e}),r.contextTopDirty=!0,r.requestRenderAll();}}dragEndHandler(t){let{e:e}=t;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var i;let t=this.target,r=this.target.canvas,{selectionStart:s,selectionEnd:n}=this.__dragStartSelection,a=(null===(i=e.dataTransfer)||void 0===i?void 0:i.dropEffect)||L;a===L?(t.selectionStart=s,t.selectionEnd=n,t._updateTextarea(),t.hiddenTextarea.focus()):(t.clearContextTop(),"move"===a&&(t.removeChars(s,n),t.selectionStart=t.selectionEnd=s,t.hiddenTextarea&&(t.hiddenTextarea.value=t.text),t._updateTextarea(),t.fire(H,{index:s,action:"dragend"}),r.fire("text:changed",{target:t}),r.requestRenderAll()),t.exitEditing());}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1;}dispose(){this._dispose&&this._dispose();}}let nk=/[ \n\.,;!\?\-]/;class nO extends nj{constructor(){super(...arguments),o(this,"_currentCursorOpacity",1);}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this);}onDeselect(t){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(t);}_animateCursor(t){let{toValue:e,duration:i,delay:r,onComplete:s}=t;return iL({startValue:this._currentCursorOpacity,endValue:e,duration:i,delay:r,onComplete:s,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:t=>{this._currentCursorOpacity=t,this.renderCursorOrSelection();}});}_tick(t){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(t||0,100),onComplete:this._onTickComplete});}_onTickComplete(){var t;null===(t=this._currentTickCompleteState)||void 0===t||t.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick});}initDelayedCursor(t){this.abortCursorAnimation(),this._tick(t?0:this.cursorDelay);}abortCursorAnimation(){let t=!1;[this._currentTickState,this._currentTickCompleteState].forEach(e=>{e&&!e.isDone()&&(t=!0,e.abort());}),this._currentCursorOpacity=1,t&&this.clearContextTop();}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some(t=>!t||t.isDone())&&this.initDelayedCursor();}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this;}cmdAll(){this.selectAll(),this.renderCursorOrSelection();}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("");}findWordBoundaryLeft(t){let e=0,i=t-1;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)e++,i--;for(;/\S/.test(this._text[i])&&i>-1;)e++,i--;return t-e;}findWordBoundaryRight(t){let e=0,i=t;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)e++,i++;for(;/\S/.test(this._text[i])&&i<this._text.length;)e++,i++;return t+e;}findLineBoundaryLeft(t){let e=0,i=t-1;for(;!/\n/.test(this._text[i])&&i>-1;)e++,i--;return t-e;}findLineBoundaryRight(t){let e=0,i=t;for(;!/\n/.test(this._text[i])&&i<this._text.length;)e++,i++;return t+e;}searchWordBoundary(t,e){let i=this._text,r=t>0&&this._reSpace.test(i[t])&&(-1===e||!I.test(i[t-1]))?t-1:t,s=i[r];for(;r>0&&r<i.length&&!nk.test(s);)r+=e,s=i[r];return -1===e&&nk.test(s)&&r++,r;}selectWord(t){var e;t=null!==(e=t)&&void 0!==e?e:this.selectionStart;let i=this.searchWordBoundary(t,-1),r=Math.max(i,this.searchWordBoundary(t,1));this.selectionStart=i,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection();}selectLine(t){var e;t=null!==(e=t)&&void 0!==e?e:this.selectionStart;let i=this.findLineBoundaryLeft(t),r=this.findLineBoundaryRight(t);this.selectionStart=i,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea();}enterEditing(t){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",t?{e:t}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:t}),this.canvas.requestRenderAll()));}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick();}updateSelectionOnMouseMove(t){if(this.getActiveControl())return;let e=this.hiddenTextarea;tK(e).activeElement!==e&&e.focus();let i=this.getSelectionStartFromPointer(t),r=this.selectionStart,s=this.selectionEnd;(i===this.__selectionStartOnMouseDown&&r!==s||r!==i&&s!==i)&&(i>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=i):(this.selectionStart=i,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===r&&this.selectionEnd===s||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()));}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0;}fromStringToGraphemeSelection(t,e,i){let r=i.slice(0,t),s=this.graphemeSplit(r).length;if(t===e)return{selectionStart:s,selectionEnd:s};let n=i.slice(t,e);return{selectionStart:s,selectionEnd:s+this.graphemeSplit(n).length};}fromGraphemeToStringSelection(t,e,i){let r=i.slice(0,t).join("").length;return t===e?{selectionStart:r,selectionEnd:r}:{selectionStart:r,selectionEnd:r+i.slice(t,e).join("").length};}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){let t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd;}this.updateTextareaPosition();}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};let t=this.hiddenTextarea;this.text=t.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();let e=this.fromStringToGraphemeSelection(t.selectionStart,t.selectionEnd,t.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition();}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){let t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top;}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};let t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),i=this.get2DCursorLocation(t),r=i.lineIndex,s=i.charIndex,n=this.getValueOfPropertyAt(r,s,"fontSize")*this.lineHeight,a=e.leftOffset,o=this.getCanvasRetinaScaling(),l=this.canvas.upperCanvasEl,h=l.width/o,c=l.height/o,d=h-n,u=c-n,g=new to(e.left+a,e.top+e.topOffset+n).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new to(l.clientWidth/h,l.clientHeight/c));return g.x<0&&(g.x=0),g.x>d&&(g.x=d),g.y<0&&(g.y=0),g.y>u&&(g.y=u),g.x+=this.canvas._offset.left,g.y+=this.canvas._offset.top,{left:"".concat(g.x,"px"),top:"".concat(g.y,"px"),fontSize:"".concat(n,"px"),charHeight:n};}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor};}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps);}_exitEditing(){let t=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop();}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords());}exitEditing(){let t=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),t&&this.fire(Q),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this;}_removeExtraneousStyles(){for(let t in this.styles)this._textLines[t]||delete this.styles[t];}removeStyleFromTo(t,e){let{lineIndex:i,charIndex:r}=this.get2DCursorLocation(t,!0),{lineIndex:s,charIndex:n}=this.get2DCursorLocation(e,!0);if(i!==s){if(this.styles[i])for(let t=r;t<this._unwrappedTextLines[i].length;t++)delete this.styles[i][t];if(this.styles[s])for(let t=n;t<this._unwrappedTextLines[s].length;t++){let e=this.styles[s][t];e&&(this.styles[i]||(this.styles[i]={}),this.styles[i][r+t-n]=e);}for(let t=i+1;t<=s;t++)delete this.styles[t];this.shiftLineStyles(s,i-s);}else if(this.styles[i]){let t=this.styles[i],e=n-r;for(let e=r;e<n;e++)delete t[e];for(let r in this.styles[i]){let i=parseInt(r,10);i>=n&&(t[i-e]=t[r],delete t[r]);}}}shiftLineStyles(t,e){let i=Object.assign({},this.styles);for(let r in this.styles){let s=parseInt(r,10);s>t&&(this.styles[s+e]=i[s],i[s-e]||delete this.styles[s]);}}insertNewlineStyleObject(t,e,i,r){let s={},n=this._unwrappedTextLines[t].length,a=n===e,o=!1;i||(i=1),this.shiftLineStyles(t,i);let l=this.styles[t]?this.styles[t][0===e?e:e-1]:void 0;for(let i in this.styles[t]){let r=parseInt(i,10);r>=e&&(o=!0,s[r-e]=this.styles[t][i],a&&0===e||delete this.styles[t][i]);}let c=!1;for(o&&!a&&(this.styles[t+i]=s,c=!0),(c||n>e)&&i--;i>0;)r&&r[i-1]?this.styles[t+i]={0:h({},r[i-1])}:l?this.styles[t+i]={0:h({},l)}:delete this.styles[t+i],i--;this._forceClearCache=!0;}insertCharStyleObject(t,e,i,r){this.styles||(this.styles={});let s=this.styles[t],n=s?h({},s):{};for(let t in i||(i=1),n){let r=parseInt(t,10);r>=e&&(s[r+i]=n[r],n[r-i]||delete s[r]);}if(this._forceClearCache=!0,r){for(;i--;)Object.keys(r[i]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+i]=h({},r[i]));return;}if(!s)return;let a=s[e?e-1:1];for(;a&&i--;)this.styles[t][e+i]=h({},a);}insertNewStyleBlock(t,e,i){let r=this.get2DCursorLocation(e,!0),s=[0],n,a=0;for(let e=0;e<t.length;e++)"\n"===t[e]?s[++a]=0:s[a]++;for(s[0]>0&&(this.insertCharStyleObject(r.lineIndex,r.charIndex,s[0],i),i=i&&i.slice(s[0]+1)),a&&this.insertNewlineStyleObject(r.lineIndex,r.charIndex+s[0],a),n=1;n<a;n++)s[n]>0?this.insertCharStyleObject(r.lineIndex+n,0,s[n],i):i&&this.styles[r.lineIndex+n]&&i[0]&&(this.styles[r.lineIndex+n][0]=i[0]),i=i&&i.slice(s[n]+1);s[n]>0&&this.insertCharStyleObject(r.lineIndex+n,0,s[n],i);}removeChars(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t+1;this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles();}insertChars(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i;r>i&&this.removeStyleFromTo(i,r);let s=this.graphemeSplit(t);this.insertNewStyleBlock(s,i,e),this._text=[...this._text.slice(0,i),...s,...this._text.slice(r)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles();}setSelectionStartEndWithShift(t,e,i){i<=t?(e===t?this._selectionDirection=P:this._selectionDirection===R&&(this._selectionDirection=P,this.selectionEnd=t),this.selectionStart=i):i>t&&i<e?this._selectionDirection===R?this.selectionEnd=i:this.selectionStart=i:(e===t?this._selectionDirection=R:this._selectionDirection===P&&(this._selectionDirection=R,this.selectionStart=e),this.selectionEnd=i);}}class nM extends nO{initHiddenTextarea(){let t=this.canvas&&tK(this.canvas.getElement())||C(),e=t.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off",name:"fabricTextarea"}).map(t=>{let[i,r]=t;return e.setAttribute(i,r);});let{top:i,left:r,fontSize:s}=this._calcTextareaPosition();e.style.cssText="position: absolute; top: ".concat(i,"; left: ").concat(r,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(s,";"),(this.hiddenTextareaContainer||t.body).appendChild(e),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map(t=>{let[i,r]=t;return e.addEventListener(i,this[r].bind(this));}),this.hiddenTextarea=e;}blur(){this.abortCursorAnimation();}onKeyDown(t){if(!this.isEditing)return;let e="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(t.keyCode in e)this[e[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown)||!t.ctrlKey&&!t.metaKey)return;this[this.ctrlKeysMapDown[t.keyCode]](t);}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll();}onKeyUp(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll());}onInput(t){let e=this.fromPaste,{value:i,selectionStart:r,selectionEnd:s}=this.hiddenTextarea;if(this.fromPaste=!1,t&&t.stopPropagation(),!this.isEditing)return;let n=()=>{this.updateFromTextArea(),this.fire(H),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());};if(""===this.hiddenTextarea.value)return this.styles={},void n();let a=this._splitTextIntoLines(i).graphemeText,o=this._text.length,l=a.length,h=this.selectionStart,c=this.selectionEnd,d=h!==c,u,f,p,m,v=l-o,x=this.fromStringToGraphemeSelection(r,s,i),y=h>x.selectionStart;d?(f=this._text.slice(h,c),v+=c-h):l<o&&(f=y?this._text.slice(c+v,c):this._text.slice(h,h-v));let b=a.slice(x.selectionEnd-v,x.selectionEnd);if(f&&f.length&&(b.length&&(u=this.getSelectionStyles(h,h+1,!1),u=b.map(()=>u[0])),d?(p=h,m=c):y?(p=c-f.length,m=c):(p=c,m=c+f.length),this.removeStyleFromTo(p,m)),b.length){let{copyPasteData:t}=w();e&&b.join("")===t.copiedText&&!g.disableStyleCopyPaste&&(u=t.copiedTextStyle),this.insertNewStyleBlock(b,h,u);}n();}onCompositionStart(){this.inCompositionMode=!0;}onCompositionEnd(){this.inCompositionMode=!1;}onCompositionUpdate(t){let{target:e}=t,{selectionStart:i,selectionEnd:r}=e;this.compositionStart=i,this.compositionEnd=r,this.updateTextareaPosition();}copy(){if(this.selectionStart===this.selectionEnd)return;let{copyPasteData:t}=w();t.copiedText=this.getSelectedText(),g.disableStyleCopyPaste?t.copiedTextStyle=void 0:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0;}paste(){this.fromPaste=!0;}_getWidthBeforeCursor(t,e){let i,r=this._getLineLeftOffset(t);return e>0&&(r+=(i=this.__charBounds[t][e-1]).left+i.width),r;}getDownCursorOffset(t,e){let i=this._getSelectionForOffset(t,e),r=this.get2DCursorLocation(i),s=r.lineIndex;if(s===this._textLines.length-1||t.metaKey||34===t.keyCode)return this._text.length-i;let n=r.charIndex,a=this._getWidthBeforeCursor(s,n),o=this._getIndexOnLine(s+1,a);return this._textLines[s].slice(n).length+o+1+this.missingNewlineOffset(s);}_getSelectionForOffset(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart;}getUpCursorOffset(t,e){let i=this._getSelectionForOffset(t,e),r=this.get2DCursorLocation(i),s=r.lineIndex;if(0===s||t.metaKey||33===t.keyCode)return-i;let n=r.charIndex,a=this._getWidthBeforeCursor(s,n),o=this._getIndexOnLine(s-1,a),l=this._textLines[s].slice(0,n),h=this.missingNewlineOffset(s-1);return-this._textLines[s-1].length+o-l.length+(1-h);}_getIndexOnLine(t,e){let i=this._textLines[t],r,s,n=this._getLineLeftOffset(t),a=0;for(let o=0,l=i.length;o<l;o++)if((n+=r=this.__charBounds[t][o].width)>e){s=!0;let t=Math.abs(n-r-e);a=Math.abs(n-e)<t?o:o-1;break;}return s||(a=i.length-1),a;}moveCursorDown(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t);}moveCursorUp(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t);}_moveCursorUpOrDown(t,e){let i=this["get".concat(t,"CursorOffset")](e,this._selectionDirection===R);if(e.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),0!==i){let t=this.text.length;this.selectionStart=ia(0,this.selectionStart,t),this.selectionEnd=ia(0,this.selectionEnd,t),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea();}}moveCursorWithShift(t){let e=this._selectionDirection===P?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t;}moveCursorWithoutShift(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t;}moveCursorLeft(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t);}_move(t,e,i){let r;if(t.altKey)r=this["findWordBoundary".concat(i)](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===i?-1:1,!0;r=this["findLineBoundary".concat(i)](this[e]);}return void 0!==r&&this[e]!==r&&(this[e]=r,!0);}_moveLeft(t,e){return this._move(t,e,"Left");}_moveRight(t,e){return this._move(t,e,"Right");}moveCursorLeftWithoutShift(t){let e=!0;return this._selectionDirection=P,this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e;}moveCursorLeftWithShift(t){return this._selectionDirection===R&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection=P,this._moveLeft(t,"selectionStart")):void 0;}moveCursorRight(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t);}_moveCursorLeftOrRight(t,e){let i="moveCursor".concat(t).concat(e.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[i](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea());}moveCursorRightWithShift(t){return this._selectionDirection===P&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=R,this._moveRight(t,"selectionEnd")):void 0;}moveCursorRightWithoutShift(t){let e=!0;return this._selectionDirection=R,this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e;}}let nD=t=>!!t.button;class nE extends nM{constructor(){super(...arguments),o(this,"draggableTextDelegate",void 0);}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("mousetripleclick",this.tripleClickHandler),this.draggableTextDelegate=new nT(this),super.initBehavior();}shouldStartDragging(){return this.draggableTextDelegate.isActive();}onDragStart(t){return this.draggableTextDelegate.onDragStart(t);}canDrop(t){return this.draggableTextDelegate.canDrop(t);}doubleClickHandler(t){this.isEditing&&(this.selectWord(this.getSelectionStartFromPointer(t.e)),this.renderCursorOrSelection());}tripleClickHandler(t){this.isEditing&&(this.selectLine(this.getSelectionStartFromPointer(t.e)),this.renderCursorOrSelection());}_mouseDownHandler(t){let{e:e,alreadySelected:i}=t;this.canvas&&this.editable&&!nD(e)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(e)||(this.canvas.textEditingManager.register(this),i&&(this.inCompositionMode=!1,this.setCursorByClick(e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()),this.selected||(this.selected=i||this.isEditing)));}mouseUpHandler(t){let{e:e,transform:i}=t,r=this.draggableTextDelegate.end(e);if(this.canvas){this.canvas.textEditingManager.unregister(this);let t=this.canvas._activeObject;if(t&&t!==this)return;}!this.editable||this.group&&!this.group.interactive||i&&i.actionPerformed||nD(e)||r||this.selected&&!this.getActiveControl()&&(this.enterEditing(e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection());}setCursorByClick(t){let e=this.getSelectionStartFromPointer(t),i=this.selectionStart,r=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(i,r,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea());}getSelectionStartFromPointer(t){let e=this.canvas.getScenePoint(t).transform(tj(this.calcTransformMatrix())).add(new to(-this._getLeftOffset(),-this._getTopOffset())),i=0,r=0,s=0;for(let t=0;t<this._textLines.length&&i<=e.y;t++)i+=this.getHeightOfLine(t),s=t,t>0&&(r+=this._textLines[t-1].length+this.missingNewlineOffset(t-1));let n=Math.abs(this._getLineLeftOffset(s)),a=this._textLines[s].length,o=this.__charBounds[s];for(let t=0;t<a;t++){let i=n+o[t].kernedWidth;if(e.x<=i){Math.abs(e.x-i)<=Math.abs(e.x-n)&&r++;break;}n=i,r++;}return Math.min(this.flipX?a-r:r,this._text.length);}}let nA="moveCursorUp",nP="moveCursorDown",nF="moveCursorLeft",nR="moveCursorRight",nL="exitEditing",nI=(t,e)=>{let i=e.getRetinaScaling();t.setTransform(i,0,0,i,0,0);let r=e.viewportTransform;t.transform(r[0],r[1],r[2],r[3],r[4],r[5]);},nB=h({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:nL,27:nL,33:nA,34:nP,35:nR,36:nF,37:nF,38:nA,39:nR,40:nP},keysMapRtl:{9:nL,27:nL,33:nA,34:nP,35:nF,36:nR,37:nR,38:nA,39:nF,40:nP},ctrlKeysMapDown:{65:"cmdAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class nW extends nE{static getDefaults(){return h(h({},super.getDefaults()),nW.ownDefaults);}get type(){let t=super.type;return"itext"===t?"i-text":t;}constructor(t,e){super(t,h(h({},nW.ownDefaults),e)),this.initBehavior();}_set(t,e){return this.isEditing&&this._savedProps&&t in this._savedProps?(this._savedProps[t]=e,this):("canvas"===t&&(this.canvas instanceof sU&&this.canvas.textEditingManager.remove(this),e instanceof sU&&e.textEditingManager.add(this)),super._set(t,e));}setSelectionStart(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t);}setSelectionEnd(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t);}_updateAndFire(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea();}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this});}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions();}getSelectionStyles(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart||0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionEnd,i=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(t,e,i);}setSelectionStyles(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionStart||0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.selectionEnd;return super.setSelectionStyles(t,e,i);}get2DCursorLocation(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(t,e);}render(t){super.render(t),this.cursorOffsetCache={},this.renderCursorOrSelection();}toCanvasElement(t){let e=this.isEditing;this.isEditing=!1;let i=super.toCanvasElement(t);return this.isEditing=e,i;}renderCursorOrSelection(){if(!this.isEditing||!this.canvas)return;let t=this.clearContextTop(!0);if(!t)return;let e=this._getCursorBoundaries(),i=this.findAncestorsWithClipPath(),r=i.length>0,s,n=t;if(r){nI(n=(s=tx(t.canvas)).getContext("2d"),this.canvas);let e=this.calcTransformMatrix();n.transform(e[0],e[1],e[2],e[3],e[4],e[5]);}if(this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(n,e):this.renderCursor(n,e),r)for(let e of i){let i=e.clipPath,r=tx(t.canvas),s=r.getContext("2d");if(nI(s,this.canvas),!i.absolutePositioned){let t=e.calcTransformMatrix();s.transform(t[0],t[1],t[2],t[3],t[4],t[5]);}i.transform(s),i.drawObject(s,!0,{}),this.drawClipPathOnCache(n,i,r);}r&&(t.setTransform(1,0,0,1,0,0),t.drawImage(s,0,0)),this.canvas.contextTopDirty=!0,t.restore();}findAncestorsWithClipPath(){let t=[],e=this;for(;e;)e.clipPath&&t.push(e),e=e.parent;return t;}_getCursorBoundaries(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0,i=this._getLeftOffset(),r=this._getTopOffset(),s=this._getCursorBoundariesOffsets(t,e);return{left:i,top:r,leftOffset:s.left,topOffset:s.top};}_getCursorBoundariesOffsets(t,e){return e?this.__getCursorBoundariesOffsets(t):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(t);}__getCursorBoundariesOffsets(t){let e=0,i=0,{charIndex:r,lineIndex:s}=this.get2DCursorLocation(t);for(let t=0;t<s;t++)e+=this.getHeightOfLine(t);let n=this._getLineLeftOffset(s),a=this.__charBounds[s][r];a&&(i=a.left),0!==this.charSpacing&&r===this._textLines[s].length&&(i-=this._getWidthOfCharSpacing());let o={top:e,left:n+(i>0?i:0)};return"rtl"===this.direction&&(this.textAlign===R||this.textAlign===eW||this.textAlign===eY?o.left*=-1:this.textAlign===P||this.textAlign===eX?o.left=n-(i>0?i:0):this.textAlign!==A&&this.textAlign!==ez||(o.left=n-(i>0?i:0))),o;}renderCursorAt(t){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(t,!0),t);}renderCursor(t,e){this._renderCursor(t,e,this.selectionStart);}getCursorRenderingData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._getCursorBoundaries(t),i=this.get2DCursorLocation(t),r=i.lineIndex,s=i.charIndex>0?i.charIndex-1:0,n=this.getValueOfPropertyAt(r,s,"fontSize"),a=this.getObjectScaling().x*this.canvas.getZoom(),o=this.cursorWidth/a,l=this.getValueOfPropertyAt(r,s,"deltaY"),h=e.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-n*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(r,s,"fill"),opacity:this._currentCursorOpacity,left:e.left+e.leftOffset-o/2,top:h+e.top+l,width:o,height:n};}_renderCursor(t,e,i){let{color:r,opacity:s,left:n,top:a,width:o,height:l}=this.getCursorRenderingData(i,e);t.fillStyle=r,t.globalAlpha=s,t.fillRect(n,a,o,l);}renderSelection(t,e){let i={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(t,i,e);}renderDragSourceEffect(){let t=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,t,this._getCursorBoundaries(t.selectionStart,!0));}renderDropTargetEffect(t){let e=this.getSelectionStartFromPointer(t);this.renderCursorAt(e);}_renderSelection(t,e,i){let r=e.selectionStart,s=e.selectionEnd,n=this.textAlign.includes(eW),a=this.get2DCursorLocation(r),o=this.get2DCursorLocation(s),l=a.lineIndex,h=o.lineIndex,c=a.charIndex<0?0:a.charIndex,d=o.charIndex<0?0:o.charIndex;for(let e=l;e<=h;e++){let r=this._getLineLeftOffset(e)||0,s=this.getHeightOfLine(e),a=0,o=0,u=0;if(e===l&&(o=this.__charBounds[l][c].left),e>=l&&e<h)u=n&&!this.isEndOfWrapping(e)?this.width:this.getLineWidth(e)||5;else if(e===h){if(0===d)u=this.__charBounds[h][d].left;else{let t=this._getWidthOfCharSpacing();u=this.__charBounds[h][d-1].left+this.__charBounds[h][d-1].width-t;}}a=s,(this.lineHeight<1||e===h&&this.lineHeight>1)&&(s/=this.lineHeight);let g=i.left+r+o,f=s,p=0,m=u-o;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",f=1,p=s):t.fillStyle=this.selectionColor,"rtl"===this.direction&&(this.textAlign===R||this.textAlign===eW||this.textAlign===eY?g=this.width-g-m:this.textAlign===P||this.textAlign===eX?g=i.left+r-u:this.textAlign!==A&&this.textAlign!==ez||(g=i.left+r-u)),t.fillRect(g,i.top+i.topOffset+p,m,f),i.topOffset+=a;}}getCurrentCharFontSize(){let t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize");}getCurrentCharColor(){let t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,J);}_getCurrentCharIndex(){let t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e};}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose();}}o(nW,"ownDefaults",nB),o(nW,"type","IText"),te.setClass(nW),te.setClass(nW,"i-text");class nX extends nW{static getDefaults(){return h(h({},super.getDefaults()),nX.ownDefaults);}constructor(t,e){super(t,h(h({},nX.ownDefaults),e));}static createControls(){return{controls:rh()};}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(eW)&&this.enlargeSpaces(),this.height=this.calcTextHeight());}_generateStyleMap(t){let e=0,i=0,r=0,s={};for(let n=0;n<t.graphemeLines.length;n++)"\n"===t.graphemeText[r]&&n>0?(i=0,r++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[r])&&n>0&&(i++,r++),s[n]={line:e,offset:i},r+=t.graphemeLines[n].length,i+=t.graphemeLines[n].length;return s;}styleHas(t,e){if(this._styleMap&&!this.isWrapping){let t=this._styleMap[e];t&&(e=t.line);}return super.styleHas(t,e);}isEmptyStyles(t){if(!this.styles)return!0;let e,i=0,r=!1,s=this._styleMap[t],n=this._styleMap[t+1];s&&(t=s.line,i=s.offset),n&&(r=n.line===t,e=n.offset);let a=void 0===t?this.styles:{line:this.styles[t]};for(let t in a)for(let s in a[t]){let n=parseInt(s,10);if(n>=i&&(!r||n<e))for(let e in a[t][s])return!1;}return!0;}_getStyleDeclaration(t,e){if(this._styleMap&&!this.isWrapping){let i=this._styleMap[t];if(!i)return{};t=i.line,e=i.offset+e;}return super._getStyleDeclaration(t,e);}_setStyleDeclaration(t,e,i){let r=this._styleMap[t];super._setStyleDeclaration(r.line,r.offset+e,i);}_deleteStyleDeclaration(t,e){let i=this._styleMap[t];super._deleteStyleDeclaration(i.line,i.offset+e);}_getLineStyle(t){let e=this._styleMap[t];return!!this.styles[e.line];}_setLineStyle(t){let e=this._styleMap[t];super._setLineStyle(e.line);}_wrapText(t,e){this.isWrapping=!0;let i=this.getGraphemeDataForRender(t),r=[];for(let t=0;t<i.wordsData.length;t++)r.push(...this._wrapLine(t,e,i));return this.isWrapping=!1,r;}getGraphemeDataForRender(t){let e=this.splitByGrapheme,i=e?"":" ",r=0;return{wordsData:t.map((t,s)=>{let n=0,a=e?this.graphemeSplit(t):this.wordSplit(t);return 0===a.length?[{word:[],width:0}]:a.map(t=>{let a=e?[t]:this.graphemeSplit(t),o=this._measureWord(a,s,n);return r=Math.max(o,r),n+=a.length+i.length,{word:a,width:o};});}),largestWordWidth:r};}_measureWord(t,e){let i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=0;for(let n=0,a=t.length;n<a;n++)s+=this._getGraphemeBox(t[n],e,n+r,i,!0).kernedWidth,i=t[n];return s;}wordSplit(t){return t.split(this._wordJoiners);}_wrapLine(t,e,i){let r,{largestWordWidth:s,wordsData:n}=i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=this._getWidthOfCharSpacing(),l=this.splitByGrapheme,h=[],c=l?"":" ",d=0,u=[],g=0,f=0,p=!0,m=Math.max(e-=a,s,this.dynamicMinWidth),v=n[t];for(g=0,r=0;r<v.length;r++){let{word:e,width:i}=v[r];g+=e.length,(d+=f+i-o)>m&&!p?(h.push(u),u=[],d=i,p=!0):d+=o,p||l||u.push(c),u=u.concat(e),f=l?0:this._measureWord([c],t,g),g++,p=!1;}return r&&h.push(u),s+a>this.dynamicMinWidth&&(this.dynamicMinWidth=s-o+a),h;}isEndOfWrapping(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line;}missingNewlineOffset(t,e){return this.splitByGrapheme&&!e?this.isEndOfWrapping(t)?1:0:1;}_splitTextIntoLines(t){let e=super._splitTextIntoLines(t),i=this._wrapText(e.lines,this.width),r=Array(i.length);for(let t=0;t<i.length;t++)r[t]=i[t].join("");return e.lines=r,e.graphemeLines=i,e;}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth);}_removeExtraneousStyles(){let t=new Map;for(let e in this._styleMap){let i=parseInt(e,10);if(this._textLines[i]){let i=this._styleMap[e].line;t.set("".concat(i),!0);}}for(let e in this.styles)t.has(e)||delete this.styles[e];}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...t]);}}o(nX,"type","Textbox"),o(nX,"textLayoutProperties",[...nW.textLayoutProperties,"width"]),o(nX,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),te.setClass(nX);class nY extends r4{shouldPerformLayout(t){return!!t.target.clipPath&&super.shouldPerformLayout(t);}shouldLayoutClipPath(){return!1;}calcLayoutResult(t,e){let{target:i}=t,{clipPath:r,group:s}=i;if(!r||!this.shouldPerformLayout(t))return;let{width:n,height:a}=t9(r5(i,r)),o=new to(n,a);if(r.absolutePositioned)return{center:eo(r.getRelativeCenterPoint(),void 0,s?s.calcTransformMatrix():void 0),size:o};{let s=r.getRelativeCenterPoint().transform(i.calcOwnMatrix(),!0);if(this.shouldPerformLayout(t)){let{center:i=new to,correction:r=new to}=this.calcBoundingBox(e,t)||{};return{center:i.add(s),correction:r.subtract(s),size:o};}return{center:i.getRelativeCenterPoint().add(s),size:o};}}}o(nY,"type","clip-path"),te.setClass(nY);class nz extends r4{getInitialSize(t,e){let{target:i}=t,{size:r}=e;return new to(i.width||r.x,i.height||r.y);}}o(nz,"type","fixed"),te.setClass(nz);class nV extends r9{subscribeTargets(t){let e=t.target;t.targets.reduce((t,e)=>(e.parent&&t.add(e.parent),t),new Set).forEach(t=>{t.layoutManager.subscribeTargets({target:t,targets:[e]});});}unsubscribeTargets(t){let e=t.target,i=e.getObjects();t.targets.reduce((t,e)=>(e.parent&&t.add(e.parent),t),new Set).forEach(t=>{i.some(e=>e.parent===t)||t.layoutManager.unsubscribeTargets({target:t,targets:[e]});});}}class nN extends si{static getDefaults(){return h(h({},super.getDefaults()),nN.ownDefaults);}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,nN.ownDefaults),this.setOptions(e);let{left:i,top:r,layoutManager:s}=e;this.groupInit(t,{left:i,top:r,layoutManager:null!=s?s:new nV});}_shouldSetNestedCoords(){return!0;}__objectSelectionMonitor(){}multiSelectAdd(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];"selection-order"===this.multiSelectionStacking?this.add(...e):e.forEach(t=>{let e=this._objects.findIndex(e=>e.isInFrontOf(t)),i=-1===e?this.size():e;this.insertAt(i,t);});}canEnterGroup(t){return this.getObjects().some(e=>e.isDescendantOf(t)||t.isDescendantOf(e))?(f("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(t);}enterGroup(t,e){t.parent&&t.parent===t.group?t.parent._exitGroup(t):t.group&&t.parent!==t.group&&t.group.remove(t),this._enterGroup(t,e);}exitGroup(t,e){this._exitGroup(t,e),t.parent&&t.parent._enterGroup(t,!0);}_onAfterObjectsChange(t,e){super._onAfterObjectsChange(t,e);let i=new Set;e.forEach(t=>{let{parent:e}=t;e&&i.add(e);}),t===r1?i.forEach(t=>{t._onAfterObjectsChange(r0,e);}):i.forEach(t=>{t._set("dirty",!0);});}onDeselect(){return this.removeAll(),!1;}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>");}shouldCache(){return!1;}isOnACache(){return!1;}_renderControls(t,e,i){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;let r=h(h({hasControls:!1},i),{},{forActiveSelection:!0});for(let e=0;e<this._objects.length;e++)this._objects[e]._renderControls(t,r);super._renderControls(t,e),t.restore();}}o(nN,"type","ActiveSelection"),o(nN,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),te.setClass(nN),te.setClass(nN,"activeSelection");class nH{constructor(){o(this,"resources",{});}applyFilters(t,e,i,r,s){let n=s.getContext("2d");if(!n)return;n.drawImage(e,0,0,i,r);let a={sourceWidth:i,sourceHeight:r,imageData:n.getImageData(0,0,i,r),originalEl:e,originalImageData:n.getImageData(0,0,i,r),canvasEl:s,ctx:n,filterBackend:this};t.forEach(t=>{t.applyTo(a);});let{imageData:o}=a;return o.width===i&&o.height===r||(s.width=o.width,s.height=o.height),n.putImageData(o,0,0),a;}}class nG{constructor(){let{tileSize:t=g.textureSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),o(this,"resources",{}),this.tileSize=t,this.setupGLContext(t,t),this.captureGPUInfo();}setupGLContext(t,e){this.dispose(),this.createWebGLCanvas(t,e);}createWebGLCanvas(t,e){let i=tx({width:t,height:e}),r=i.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});r&&(r.clearColor(0,0,0,0),this.canvas=i,this.gl=r);}applyFilters(t,e,i,r,s,n){let a;let o=this.gl,l=s.getContext("2d");if(!o||!l)return;n&&(a=this.getCachedTexture(n,e));let h={originalWidth:e.width||e.naturalWidth||0,originalHeight:e.height||e.naturalHeight||0,sourceWidth:i,sourceHeight:r,destinationWidth:i,destinationHeight:r,context:o,sourceTexture:this.createTexture(o,i,r,a?void 0:e),targetTexture:this.createTexture(o,i,r),originalTexture:a||this.createTexture(o,i,r,a?void 0:e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:s},c=o.createFramebuffer();return o.bindFramebuffer(o.FRAMEBUFFER,c),t.forEach(t=>{t&&t.applyTo(h);}),function(t){let e=t.targetCanvas,i=e.width,r=e.height,s=t.destinationWidth,n=t.destinationHeight;i===s&&r===n||(e.width=s,e.height=n);}(h),this.copyGLTo2D(o,h),o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(h.sourceTexture),o.deleteTexture(h.targetTexture),o.deleteFramebuffer(c),l.setTransform(1,0,0,1,0,0),h;}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches();}clearWebGLCaches(){this.programCache={},this.textureCache={};}createTexture(t,e,i,r,s){let{NEAREST:n,TEXTURE_2D:a,RGBA:o,UNSIGNED_BYTE:l,CLAMP_TO_EDGE:h,TEXTURE_MAG_FILTER:c,TEXTURE_MIN_FILTER:d,TEXTURE_WRAP_S:u,TEXTURE_WRAP_T:g}=t,f=t.createTexture();return t.bindTexture(a,f),t.texParameteri(a,c,s||n),t.texParameteri(a,d,s||n),t.texParameteri(a,u,h),t.texParameteri(a,g,h),r?t.texImage2D(a,0,o,o,l,r):t.texImage2D(a,0,o,e,i,0,o,l,null),f;}getCachedTexture(t,e,i){let{textureCache:r}=this;if(r[t])return r[t];{let s=this.createTexture(this.gl,e.width,e.height,e,i);return s&&(r[t]=s),s;}}evictCachesForKey(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t]);}copyGLTo2D(t,e){let i=t.canvas,r=e.targetCanvas,s=r.getContext("2d");if(!s)return;s.translate(0,r.height),s.scale(1,-1);let n=i.height-r.height;s.drawImage(i,0,n,r.width,r.height,0,0,r.width,r.height);}copyGLTo2DPutImageData(t,e){let i=e.targetCanvas.getContext("2d"),r=e.destinationWidth,s=e.destinationHeight,n=r*s*4;if(!i)return;let a=new Uint8Array(this.imageBuffer,0,n),o=new Uint8ClampedArray(this.imageBuffer,0,n);t.readPixels(0,0,r,s,t.RGBA,t.UNSIGNED_BYTE,a);let l=new ImageData(o,r,s);i.putImageData(l,0,0);}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;let t=this.gl,e={renderer:"",vendor:""};if(!t)return e;let i=t.getExtension("WEBGL_debug_renderer_info");if(i){let r=t.getParameter(i.UNMASKED_RENDERER_WEBGL),s=t.getParameter(i.UNMASKED_VENDOR_WEBGL);r&&(e.renderer=r.toLowerCase()),s&&(e.vendor=s.toLowerCase());}return this.gpuInfo=e,e;}}function nU(){let{WebGLProbe:t}=w();return t.queryWebGL(tm()),g.enableGLFiltering&&t.isSupported(g.textureSize)?new nG({tileSize:g.textureSize}):new nH;}function n$(){return a||arguments.length>0&&void 0!==arguments[0]&&!arguments[0]||(a=nU()),a;}function nq(t){a=t;}let nK=["filters","resizeFilter","src","crossOrigin","type"],nJ=["cropX","cropY"];class nZ extends ru{static getDefaults(){return h(h({},super.getDefaults()),nZ.ownDefaults);}constructor(t,e){super(),o(this,"_lastScaleX",1),o(this,"_lastScaleY",1),o(this,"_filterScalingX",1),o(this,"_filterScalingY",1),this.filters=[],Object.assign(this,nZ.ownDefaults),this.setOptions(e),this.cacheKey="texture".concat(tp()),this.setElement("string"==typeof t?(this.canvas&&tK(this.canvas.getElement())||C()).getElementById(t):t,e);}getElement(){return this._element;}setElement(t){var e;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=t,this._originalElement=t,this._setWidthHeight(i),null===(e=t.classList)||void 0===e||e.add(nZ.CSS_CANVAS),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters();}removeTexture(t){let e=n$(!1);e instanceof nG&&e.evictCachesForKey(t);}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(t=>{let e=this[t];e&&w().dispose(e),this[t]=void 0;});}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null);}getOriginalSize(){let t=this.getElement();return t?{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}:{width:0,height:0};}_stroke(t){if(!this.stroke||0===this.strokeWidth)return;let e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,-i),t.lineTo(e,-i),t.lineTo(e,i),t.lineTo(-e,i),t.lineTo(-e,-i),t.closePath();}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=[];return this.filters.forEach(t=>{t&&e.push(t.toObject());}),h(h({},super.toObject([...nJ,...t])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:e},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{});}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height;}_toSVG(){let t=[],e=this._element,i=-this.width/2,r=-this.height/2,s=[],n=[],a="",o="";if(!e)return[];if(this.hasCrop()){let t=tp();s.push('<clipPath id="imageCrop_'+t+'">\n','	<rect x="'+i+'" y="'+r+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),a=' clip-path="url(#imageCrop_'+t+')" ';}if(this.imageSmoothing||(o=' image-rendering="optimizeSpeed"'),t.push("	<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(i-this.cropX,'" y="').concat(r-this.cropY,'" width="').concat(e.width||e.naturalWidth,'" height="').concat(e.height||e.naturalHeight,'"').concat(o).concat(a,"></image>\n")),this.stroke||this.strokeDashArray){let t=this.fill;this.fill=null,n=['	<rect x="'.concat(i,'" y="').concat(r,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),'" />\n')],this.fill=t;}return this.paintFirst!==J?s.concat(n,t):s.concat(t,n);}getSrc(t){let e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src")||"":e.src:this.src||"";}getSvgSrc(t){return this.getSrc(t);}setSrc(t){let{crossOrigin:e,signal:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return tB(t,{crossOrigin:e,signal:i}).then(t=>{void 0!==e&&this.set({crossOrigin:e}),this.setElement(t);});}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>');}applyResizeFilters(){let t=this.resizeFilter,e=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),r=i.x,s=i.y,n=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||r>e&&s>e)return this._element=n,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=r,void(this._lastScaleY=s);let a=tx(n),{width:o,height:l}=n;this._element=a,this._lastScaleX=t.scaleX=r,this._lastScaleY=t.scaleY=s,n$().applyFilters([t],n,o,l,this._element),this._filterScalingX=a.width/this._originalElement.width,this._filterScalingY=a.height/this._originalElement.height;}applyFilters(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.filters||[];if(t=t.filter(t=>t&&!t.isNeutralState()),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),0===t.length)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);let e=this._originalElement,i=e.naturalWidth||e.width,r=e.naturalHeight||e.height;if(this._element===this._originalElement){let t=tx({width:i,height:r});this._element=t,this._filteredEl=t;}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,r),this._lastScaleX=1,this._lastScaleY=1);n$().applyFilters(t,this._originalElement,i,r,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height);}_render(t){t.imageSmoothingEnabled=this.imageSmoothing,!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t);}drawCacheOnCanvas(t){t.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(t);}shouldCache(){return this.needsItsOwnCache();}_renderFill(t){let e=this._element;if(!e)return;let i=this._filterScalingX,r=this._filterScalingY,s=this.width,n=this.height,a=Math.max(this.cropX,0),o=Math.max(this.cropY,0),l=e.naturalWidth||e.width,h=e.naturalHeight||e.height,c=a*i,d=o*r,u=Math.min(s*i,l-c),g=Math.min(n*r,h-d),f=Math.min(s,l/i-a),p=Math.min(n,h/r-o);e&&t.drawImage(e,c,d,u,g,-s/2,-n/2,f,p);}_needsResize(){let t=this.getTotalObjectScaling();return t.x!==this._lastScaleX||t.y!==this._lastScaleY;}_resetWidthHeight(){this.set(this.getOriginalSize());}_setWidthHeight(){let{width:t,height:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=this.getOriginalSize();this.width=t||i.width,this.height=e||i.height;}parsePreserveAspectRatioAttribute(){let t=eM(this.preserveAspectRatio||""),e=this.width,i=this.height,r={width:e,height:i},s,n=this._element.width,a=this._element.height,o=1,l=1,h=0,c=0,d=0,u=0;return t&&(t.alignX!==L||t.alignY!==L)?("meet"===t.meetOrSlice&&(s=(e-n*(o=l=sr(this._element,r)))/2,"Min"===t.alignX&&(h=-s),"Max"===t.alignX&&(h=s),s=(i-a*l)/2,"Min"===t.alignY&&(c=-s),"Max"===t.alignY&&(c=s)),"slice"===t.meetOrSlice&&(s=n-e/(o=l=ss(this._element,r)),"Mid"===t.alignX&&(d=s/2),"Max"===t.alignX&&(d=s),s=a-i/l,"Mid"===t.alignY&&(u=s/2),"Max"===t.alignY&&(u=s),n=e/o,a=i/l)):(o=e/n,l=i/a),{width:n,height:a,scaleX:o,scaleY:l,offsetLeft:h,offsetTop:c,cropX:d,cropY:u};}static fromObject(t,e){let{filters:i,resizeFilter:r,src:s,crossOrigin:n,type:a}=t,o=c(t,nK);return Promise.all([tB(s,h(h({},e),{},{crossOrigin:n})),i&&tW(i,e),r&&tW([r],e),tX(o,e)]).then(t=>{let[e,i=[],[r]=[],n={}]=t;return new this(e,h(h({},o),{},{src:s,filters:i,resizeFilter:r},n));});}static fromURL(t){let{crossOrigin:e=null,signal:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return tB(t,{crossOrigin:e,signal:i}).then(t=>new this(t,r));}static async fromElement(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=rq(t,this.ATTRIBUTE_NAMES,i);return this.fromURL(r["xlink:href"]||r.href,e,r).catch(t=>(f("log","Unable to parse Image",t),null));}}function nQ(t){if(!eJ.test(t.nodeName))return{};let e=t.getAttribute("viewBox"),i,r,s=1,n=1,a=0,o=0,l=t.getAttribute("width"),h=t.getAttribute("height"),c=t.getAttribute("x")||0,d=t.getAttribute("y")||0,u=!(e&&eQ.test(e)),g=!l||!h||"100%"===l||"100%"===h,f="",p=0,m=0;if(u&&(c||d)&&t.parentNode&&"#document"!==t.parentNode.nodeName&&(f=" translate("+eO(c||"0")+" "+eO(d||"0")+") ",i=(t.getAttribute("transform")||"")+f,t.setAttribute("transform",i),t.removeAttribute("x"),t.removeAttribute("y")),u&&g)return{width:0,height:0};let v={width:0,height:0};if(u)return v.width=eO(l),v.height=eO(h),v;let x=e.match(eQ);a=-parseFloat(x[1]),o=-parseFloat(x[2]);let y=parseFloat(x[3]),b=parseFloat(x[4]);v.minX=a,v.minY=o,v.viewBoxWidth=y,v.viewBoxHeight=b,g?(v.width=y,v.height=b):(v.width=eO(l),v.height=eO(h),s=v.width/y,n=v.height/b);let w=eM(t.getAttribute("preserveAspectRatio")||"");if(w.alignX!==L&&("meet"===w.meetOrSlice&&(n=s=s>n?n:s),"slice"===w.meetOrSlice&&(n=s=s>n?s:n),p=v.width-y*s,m=v.height-b*s,"Mid"===w.alignX&&(p/=2),"Mid"===w.alignY&&(m/=2),"Min"===w.alignX&&(p=0),"Min"===w.alignY&&(m=0)),1===s&&1===n&&0===a&&0===o&&0===c&&0===d)return v;if((c||d)&&"#document"!==t.parentNode.nodeName&&(f=" translate("+eO(c||"0")+" "+eO(d||"0")+") "),i=f+" matrix("+s+" 0 0 "+n+" "+(a*s+p)+" "+(o*n+m)+") ","svg"===t.nodeName){for(r=t.ownerDocument.createElementNS(eH,"g");t.firstChild;)r.appendChild(t.firstChild);t.appendChild(r);}else(r=t).removeAttribute("x"),r.removeAttribute("y"),i=r.getAttribute("transform")+i;return r.setAttribute("transform",i),v;}o(nZ,"type","Image"),o(nZ,"cacheProperties",[...il,...nJ]),o(nZ,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),o(nZ,"CSS_CANVAS","canvas-img"),o(nZ,"ATTRIBUTE_NAMES",[...rO,"x","y","width","height","preserveAspectRatio","xlink:href","href","crossOrigin","image-rendering"]),te.setClass(nZ),te.setSVGClass(nZ);let n0=t=>t.tagName.replace("svg:",""),n1=eA(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);function n2(t,e){let i,r,s,n,a=[];for(s=0,n=e.length;s<n;s++)i=e[s],r=t.getElementsByTagNameNS("http://www.w3.org/2000/svg",i),a=a.concat(Array.from(r));return a;}let n5=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],n4="xlink:href",n3=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"];function n6(t){let e=t.getElementsByTagName("style"),i={};for(let t=0;t<e.length;t++){let r=(e[t].textContent||"").replace(/\/\*[\s\S]*?\*\//g,"");""!==r.trim()&&r.split("}").filter((t,e,i)=>i.length>1&&t.trim()).forEach(t=>{if((t.match(/{/g)||[]).length>1&&t.trim().startsWith("@"))return;let e=t.split("{"),r={},s=e[1].trim().split(";").filter(function(t){return t.trim();});for(let t=0;t<s.length;t++){let e=s[t].split(":"),i=e[0].trim(),n=e[1].trim();r[i]=n;}(t=e[0].trim()).split(",").forEach(t=>{""!==(t=t.replace(/^svg/i,"").trim())&&(i[t]=h(h({},i[t]||{}),r));});});}return i;}let n8=t=>te.getSVGClass(n0(t).toLowerCase());class n7{constructor(t,e,i,r,s){this.elements=t,this.options=e,this.reviver=i,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=r,this.clipPaths=s,this.gradientDefs=function(t){let e=n2(t,n3),i={},r=e.length;for(;r--;){let s=e[r];s.getAttribute("xlink:href")&&function t(e,i){var r;let s=(null===(r=i.getAttribute(n4))||void 0===r?void 0:r.slice(1))||"",n=e.getElementById(s);if(n&&n.getAttribute(n4)&&t(e,n),n&&(n5.forEach(t=>{let e=n.getAttribute(t);!i.hasAttribute(t)&&e&&i.setAttribute(t,e);}),!i.children.length)){let t=n.cloneNode(!0);for(;t.firstChild;)i.appendChild(t.firstChild);}i.removeAttribute(n4);}(t,s);let n=s.getAttribute("id");n&&(i[n]=s);}return i;}(r),this.cssRules=n6(r);}parse(){return Promise.all(this.elements.map(t=>this.createObject(t)));}async createObject(t){let e=n8(t);if(e){let i=await e.fromElement(t,this.options,this.cssRules);return this.resolveGradient(i,t,J),this.resolveGradient(i,t,Z),i instanceof nZ&&i._originalElement?sL(i,i.parsePreserveAspectRatioAttribute()):sL(i),await this.resolveClipPath(i,t),this.reviver&&this.reviver(t,i),i;}return null;}extractPropertyDefinition(t,e,i){let r=t[e],s=this.regexUrl;if(!s.test(r))return;s.lastIndex=0;let n=s.exec(r)[1];return s.lastIndex=0,i[n];}resolveGradient(t,e,i){let r=this.extractPropertyDefinition(t,i,this.gradientDefs);if(r){let s=e.getAttribute(i+"-opacity"),n=s4.fromElement(r,t,h(h({},this.options),{},{opacity:s}));t.set(i,n);}}async resolveClipPath(t,e,i){let r=this.extractPropertyDefinition(t,"clipPath",this.clipPaths);if(r){let s=tj(t.calcTransformMatrix()),n=r[0].parentElement,a=e;for(;!i&&a.parentElement&&a.getAttribute("clip-path")!==t.clipPath;)a=a.parentElement;a.parentElement.appendChild(n);let o=rN("".concat(a.getAttribute("transform")||""," ").concat(n.getAttribute("originalTransform")||""));n.setAttribute("transform","matrix(".concat(o.join(","),")"));let l=await Promise.all(r.map(t=>n8(t).fromElement(t,this.options,this.cssRules).then(t=>(sL(t),t.fillRule=t.clipRule,delete t.clipRule,t)))),h=1===l.length?l[0]:new si(l),c=tT(s,h.calcTransformMatrix());h.clipPath&&await this.resolveClipPath(h,a,n.getAttribute("clip-path")?a:void 0);let{scaleX:d,scaleY:u,angle:g,skewX:f,translateX:p,translateY:m}=tM(c);h.set({flipX:!1,flipY:!1}),h.set({scaleX:d,scaleY:u,angle:g,skewX:f,skewY:0}),h.setPositionByOrigin(new to(p,m),A,A),t.clipPath=h;}else delete t.clipPath;}}let n9=t=>eK.test(n0(t)),at=()=>({objects:[],elements:[],options:{},allElements:[]});async function ae(t,e){let{crossOrigin:i,signal:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r&&r.aborted)return f("log",new m("parseSVGDocument")),at();let s=t.documentElement;!function(t){let e=n2(t,["use","svg:use"]),i=["x","y","xlink:href","href","transform"];for(let r of e){let e=r.attributes,s={};for(let t of e)t.value&&(s[t.name]=t.value);let n=(s["xlink:href"]||s.href||"").slice(1);if(""===n)return;let a=t.getElementById(n);if(null===a)return;let o=a.cloneNode(!0),l=o.attributes,h={};for(let t of l)t.value&&(h[t.name]=t.value);let{x:c=0,y:d=0,transform:u=""}=s,g="".concat(u," ").concat(h.transform||""," translate(").concat(c,", ").concat(d,")");if(nQ(o),/^svg$/i.test(o.nodeName)){let t=o.ownerDocument.createElementNS(eH,"g");Object.entries(h).forEach(e=>{let[i,r]=e;return t.setAttributeNS(eH,i,r);}),t.append(...o.childNodes),o=t;}for(let t of e){if(!t)continue;let{name:e,value:r}=t;if(!i.includes(e)){if("style"===e){let t={};rG(r,t),Object.entries(h).forEach(e=>{let[i,r]=e;t[i]=r;}),rG(h.style||"",t);let i=Object.entries(t).map(t=>t.join(":")).join(";");o.setAttribute(e,i);}else h[e]||o.setAttribute(e,r);}}o.setAttribute("transform",g),o.setAttribute("instantiated_by_use","1"),o.removeAttribute("id"),r.parentNode.replaceChild(o,r);}}(t);let n=Array.from(s.getElementsByTagName("*")),a=h(h({},nQ(s)),{},{crossOrigin:i,signal:r}),o=n.filter(t=>(nQ(t),n9(t)&&!function(t){let e=t;for(;e&&(e=e.parentElement);)if(e&&e.nodeName&&n1.test(n0(e))&&!e.getAttribute("instantiated_by_use"))return!0;return!1;}(t)));if(!o||o&&!o.length)return h(h({},at()),{},{options:a,allElements:n});let l={};n.filter(t=>"clipPath"===n0(t)).forEach(t=>{t.setAttribute("originalTransform",t.getAttribute("transform")||""),l[t.getAttribute("id")]=Array.from(t.getElementsByTagName("*")).filter(t=>n9(t));});let c=new n7(o,a,e,t,l);return{objects:await c.parse(),elements:o,options:a,allElements:n};}function ai(t,e,i){return ae((new(_()).DOMParser).parseFromString(t.trim(),"text/xml"),e,i);}function ar(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((e,r)=>{sR(t.replace(/^\n\s*/,"").trim(),{onComplete:t=>{let i=t.responseXML;i&&e(i),r();},signal:i.signal});}).then(t=>ae(t,e,i)).catch(()=>at());}let as=t=>function(e,i,r){let{points:s,pathOffset:n}=r;return new to(s[t]).subtract(n).transform(tT(r.getViewportTransform(),r.calcTransformMatrix()));},an=(t,e,i,r)=>{let{target:s,pointIndex:n}=e,a=eo(new to(i,r),void 0,s.calcOwnMatrix());return s.points[n]=a.add(s.pathOffset),s.setDimensions(),s.set("dirty",!0),!0;},aa=(t,e)=>function(i,r,s,n){let a=r.target,o=new to(a.points[(t>0?t:a.points.length)-1]),l=o.subtract(a.pathOffset).transform(a.calcOwnMatrix()),c=e(i,h(h({},r),{},{pointIndex:t}),s,n),d=o.subtract(a.pathOffset).transform(a.calcOwnMatrix()).subtract(l);return a.left-=d.x,a.top-=d.y,c;},ao=t=>iV(N,aa(t,an)),al=(t,e,i)=>{let{path:r,pathOffset:s}=t,n=r[e];return new to(n[i]-s.x,n[i+1]-s.y).transform(tT(t.getViewportTransform(),t.calcTransformMatrix()));};function ah(t,e,i){let{commandIndex:r,pointIndex:s}=this;return al(i,r,s);}function ac(t,e,i,r){let{target:s}=e,{commandIndex:n,pointIndex:a}=this,o=((t,e,i,r,s)=>{let{path:n,pathOffset:a}=t,o=n[(r>0?r:n.length)-1],l=new to(o[s],o[s+1]),h=l.subtract(a).transform(t.calcOwnMatrix()),c=eo(new to(e,i),void 0,t.calcOwnMatrix());n[r][s]=c.x+a.x,n[r][s+1]=c.y+a.y,t.setDimensions();let d=l.subtract(t.pathOffset).transform(t.calcOwnMatrix()).subtract(h);return t.left-=d.x,t.top-=d.y,t.set("dirty",!0),!0;})(s,i,r,n,a);return ec(this.actionName,h(h({},em(t,e,i,r)),{},{commandIndex:n,pointIndex:a})),o;}class ad extends i${constructor(t){super(t);}render(t,e,i,r,s){let n=h(h({},r),{},{cornerColor:this.controlFill,cornerStrokeColor:this.controlStroke,transparentCorners:!this.controlFill});super.render(t,e,i,n,s);}}class au extends ad{constructor(t){super(t);}render(t,e,i,r,s){let{path:n}=s,{commandIndex:a,pointIndex:o,connectToCommandIndex:l,connectToPointIndex:h}=this;t.save(),t.strokeStyle=this.controlStroke,this.connectionDashArray&&t.setLineDash(this.connectionDashArray);let[c]=n[a],d=al(s,l,h);if("Q"===c){let r=al(s,a,o+2);t.moveTo(r.x,r.y),t.lineTo(e,i);}else t.moveTo(e,i);t.lineTo(d.x,d.y),t.stroke(),t.restore(),super.render(t,e,i,r,s);}}let ag=(t,e,i,r,s,n)=>new(i?au:ad)(h(h({commandIndex:t,pointIndex:e,actionName:"modifyPath",positionHandler:ah,actionHandler:ac,connectToCommandIndex:s,connectToPointIndex:n},r),i?r.controlPointStyle:r.pointStyle));var af=Object.freeze({__proto__:null,changeWidth:iH,createObjectDefaultControls:ro,createPathControls:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i={},r="M";return t.path.forEach((t,s)=>{let n=t[0];switch("Z"!==n&&(i["c_".concat(s,"_").concat(n)]=ag(s,t.length-2,!1,e)),n){case"C":let a;i["c_".concat(s,"_C_CP_1")]=ag(s,1,!0,e,s-1,"C"===(a=r)?5:"Q"===a?3:1),i["c_".concat(s,"_C_CP_2")]=ag(s,3,!0,e,s,5);break;case"Q":i["c_".concat(s,"_Q_CP_1")]=ag(s,1,!0,e,s,3);}r=n;}),i;},createPolyActionHandler:ao,createPolyControls:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i={};for(let r=0;r<("number"==typeof t?t:t.points.length);r++)i["p".concat(r)]=new i$(h({actionName:N,positionHandler:as(r),actionHandler:ao(r)},e));return i;},createPolyPositionHandler:as,createResizeControls:rl,createTextboxDefaultControls:rh,dragHandler:ey,factoryPolyActionHandler:aa,getLocalPoint:ex,polyActionHandler:an,renderCircleControl:iG,renderSquareControl:iU,rotationStyleHandler:iq,rotationWithSnapping:iK,scaleCursorStyleHandler:i0,scaleOrSkewActionName:rr,scaleSkewCursorStyleHandler:rs,scalingEqually:i2,scalingX:i5,scalingXOrSkewingY:rn,scalingY:i4,scalingYOrSkewingX:ra,skewCursorStyleHandler:i7,skewHandlerX:rt,skewHandlerY:re,wrapWithFireEvent:iV,wrapWithFixedAnchor:iN});let ap=t=>void 0!==t.webgl,am=(t,e)=>{let i;let r=tx({width:t,height:e}),s=tm().getContext("webgl"),n={imageBuffer:new ArrayBuffer(t*e*4)},a={destinationWidth:t,destinationHeight:e,targetCanvas:r};i=_().performance.now(),nG.prototype.copyGLTo2D.call(n,s,a);let o=_().performance.now()-i;return i=_().performance.now(),nG.prototype.copyGLTo2DPutImageData.call(n,s,a),o>_().performance.now()-i;},av="precision highp float",ax="\n    ".concat(av,";\n    varying vec2 vTexCoord;\n    uniform sampler2D uTexture;\n    void main() {\n      gl_FragColor = texture2D(uTexture, vTexCoord);\n    }"),ay=["type"],ab=["type"],aw=RegExp(av,"g");class aC{get type(){return this.constructor.type;}constructor(){let t=c(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},ay);Object.assign(this,this.constructor.defaults,t);}getFragmentSource(){return ax;}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    void main() {\n      vTexCoord = aPosition;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }";}createProgram(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getFragmentSource(),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getVertexSource(),{WebGLProbe:{GLPrecision:r="highp"}}=w();"highp"!==r&&(e=e.replace(aw,av.replace("highp",r)));let s=t.createShader(t.VERTEX_SHADER),n=t.createShader(t.FRAGMENT_SHADER),a=t.createProgram();if(!s||!n||!a)throw new p("Vertex, fragment shader or program creation error");if(t.shaderSource(s,i),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new p("Vertex shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(s)));if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new p("Fragment shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(n)));if(t.attachShader(a,s),t.attachShader(a,n),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw new p('Shader link error for "'.concat(this.type,'" ').concat(t.getProgramInfoLog(a)));let o=this.getUniformLocations(t,a)||{};return o.uStepW=t.getUniformLocation(a,"uStepW"),o.uStepH=t.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:this.getAttributeLocations(t,a),uniformLocations:o};}getAttributeLocations(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")};}getUniformLocations(t,e){let i=this.constructor.uniformLocations,r={};for(let s=0;s<i.length;s++)r[i[s]]=t.getUniformLocation(e,i[s]);return r;}sendAttributeData(t,e,i){let r=e.aPosition,s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW);}_setupFrameBuffer(t){let e=t.context;if(t.passes>1){let i=t.destinationWidth,r=t.destinationHeight;t.sourceWidth===i&&t.sourceHeight===r||(e.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(e,i,r)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.targetTexture,0);}else e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish();}_swapTextures(t){t.passes--,t.pass++;let e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e;}isNeutralState(t){return!1;}applyTo(t){ap(t)?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t);}applyTo2d(t){}getCacheKey(){return this.type;}retrieveShader(t){let e=this.getCacheKey();return t.programCache[e]||(t.programCache[e]=this.createProgram(t.context)),t.programCache[e];}applyToWebGL(t){let e=t.context,i=this.retrieveShader(t);0===t.pass&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(i.program),this.sendAttributeData(e,i.attributeLocations,t.aPosition),e.uniform1f(i.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(i.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,i.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4);}bindAdditionalTexture(t,e,i){t.activeTexture(i),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0);}unbindAdditionalTexture(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0);}sendUniformData(t,e){}createHelpLayer(t){if(!t.helpLayer){let{sourceWidth:e,sourceHeight:i}=t,r=tx({width:e,height:i});t.helpLayer=r;}}toObject(){let t=Object.keys(this.constructor.defaults||{});return h({type:this.type},t.reduce((t,e)=>(t[e]=this[e],t),{}));}toJSON(){return this.toObject();}static async fromObject(t,e){return new this(c(t,ab));}}o(aC,"type","BaseFilter"),o(aC,"uniformLocations",[]);let a_={multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",difference:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"\n    if (uColor.r < 0.5) {\n      gl_FragColor.r *= 2.0 * uColor.r;\n    } else {\n      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n    }\n    if (uColor.g < 0.5) {\n      gl_FragColor.g *= 2.0 * uColor.g;\n    } else {\n      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n    }\n    if (uColor.b < 0.5) {\n      gl_FragColor.b *= 2.0 * uColor.b;\n    } else {\n      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n    }\n    ",tint:"\n    gl_FragColor.rgb *= (1.0 - uColor.a);\n    gl_FragColor.rgb += uColor.rgb;\n    "};class aS extends aC{getCacheKey(){return"".concat(this.type,"_").concat(this.mode);}getFragmentSource(){return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec4 uColor;\n      varying vec2 vTexCoord;\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        gl_FragColor = color;\n        if (color.a > 0.0) {\n          ".concat(a_[this.mode],"\n        }\n      }\n      ");}applyTo2d(t){let{imageData:{data:e}}=t,i=new ek(this.color).getSource(),r=this.alpha,s=i[0]*r,n=i[1]*r,a=i[2]*r,o=1-r;for(let t=0;t<e.length;t+=4){let i,r,l;let h=e[t],c=e[t+1],d=e[t+2];switch(this.mode){case"multiply":i=h*s/255,r=c*n/255,l=d*a/255;break;case"screen":i=255-(255-h)*(255-s)/255,r=255-(255-c)*(255-n)/255,l=255-(255-d)*(255-a)/255;break;case"add":i=h+s,r=c+n,l=d+a;break;case"difference":i=Math.abs(h-s),r=Math.abs(c-n),l=Math.abs(d-a);break;case"subtract":i=h-s,r=c-n,l=d-a;break;case"darken":i=Math.min(h,s),r=Math.min(c,n),l=Math.min(d,a);break;case"lighten":i=Math.max(h,s),r=Math.max(c,n),l=Math.max(d,a);break;case"overlay":i=s<128?2*h*s/255:255-2*(255-h)*(255-s)/255,r=n<128?2*c*n/255:255-2*(255-c)*(255-n)/255,l=a<128?2*d*a/255:255-2*(255-d)*(255-a)/255;break;case"exclusion":i=s+h-2*s*h/255,r=n+c-2*n*c/255,l=a+d-2*a*d/255;break;case"tint":i=s+h*o,r=n+c*o,l=a+d*o;}e[t]=i,e[t+1]=r,e[t+2]=l;}}sendUniformData(t,e){let i=new ek(this.color).getSource();i[0]=this.alpha*i[0]/255,i[1]=this.alpha*i[1]/255,i[2]=this.alpha*i[2]/255,i[3]=this.alpha,t.uniform4fv(e.uColor,i);}}o(aS,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),o(aS,"type","BlendColor"),o(aS,"uniformLocations",["uColor"]),te.setClass(aS);let aj={multiply:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.rgba *= color2.rgba;\n      gl_FragColor = color;\n    }\n    ",mask:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.a = color2.a;\n      gl_FragColor = color;\n    }\n    "},aT=["type","image"];class ak extends aC{getCacheKey(){return"".concat(this.type,"_").concat(this.mode);}getFragmentSource(){return aj[this.mode];}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    uniform mat3 uTransformMatrix;\n    void main() {\n      vTexCoord = aPosition;\n      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ";}applyToWebGL(t){let e=t.context,i=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,i,e.TEXTURE1),super.applyToWebGL(t),this.unbindAdditionalTexture(e,e.TEXTURE1);}createTexture(t,e){return t.getCachedTexture(e.cacheKey,e.getElement());}calculateMatrix(){let t=this.image,{width:e,height:i}=t.getElement();return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/i,1];}applyTo2d(t){let{imageData:{data:e,width:i,height:r},filterBackend:{resources:s}}=t,n=this.image;s.blendImage||(s.blendImage=tm());let a=s.blendImage,o=a.getContext("2d");a.width!==i||a.height!==r?(a.width=i,a.height=r):o.clearRect(0,0,i,r),o.setTransform(n.scaleX,0,0,n.scaleY,n.left,n.top),o.drawImage(n.getElement(),0,0,i,r);let l=o.getImageData(0,0,i,r).data;for(let t=0;t<e.length;t+=4){let i=e[t],r=e[t+1],s=e[t+2],n=e[t+3],a=l[t],o=l[t+1],h=l[t+2],c=l[t+3];switch(this.mode){case"multiply":e[t]=i*a/255,e[t+1]=r*o/255,e[t+2]=s*h/255,e[t+3]=n*c/255;break;case"mask":e[t+3]=c;}}}sendUniformData(t,e){let i=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,i);}toObject(){return h(h({},super.toObject()),{},{image:this.image&&this.image.toObject()});}static async fromObject(t,e){let{type:i,image:r}=t,s=c(t,aT);return nZ.fromObject(r,e).then(t=>new this(h(h({},s),{},{image:t})));}}o(ak,"type","BlendImage"),o(ak,"defaults",{mode:"multiply",alpha:1}),o(ak,"uniformLocations",["uTransformMatrix","uImage"]),te.setClass(ak);class aO extends aC{getFragmentSource(){return"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform vec2 uDelta;\n    varying vec2 vTexCoord;\n    const float nSamples = 15.0;\n    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\n    float random(vec3 scale) {\n      /* use the fragment position for a different seed per-pixel */\n      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n    }\n    void main() {\n      vec4 color = vec4(0.0);\n      float totalC = 0.0;\n      float totalA = 0.0;\n      float offset = random(v3offset);\n      for (float t = -nSamples; t <= nSamples; t++) {\n        float percent = (t + offset - 0.5) / nSamples;\n        vec4 sample = texture2D(uTexture, vTexCoord + uDelta * percent);\n        float weight = 1.0 - abs(percent);\n        float alpha = weight * sample.a;\n        color.rgb += sample.rgb * alpha;\n        color.a += alpha;\n        totalA += weight;\n        totalC += alpha;\n      }\n      gl_FragColor.rgb = color.rgb / totalC;\n      gl_FragColor.a = color.a / totalA;\n    }\n  ";}applyTo(t){ap(t)?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t);}applyTo2d(t){let{imageData:{data:e,width:i,height:r}}=t;this.aspectRatio=i/r,this.horizontal=!0;let s=this.getBlurValue()*i,n=new Uint8ClampedArray(e),a=4*i;for(let t=0;t<e.length;t+=4){let i=0,r=0,o=0,l=0,h=0,c=t-t%a,d=c+a;for(let n=-14;n<15;n++){let a=n/15,u=4*Math.floor(s*a),g=1-Math.abs(a),f=t+u;f<c?f=c:f>d&&(f=d);let p=e[f+3]*g;i+=e[f]*p,r+=e[f+1]*p,o+=e[f+2]*p,l+=p,h+=g;}n[t]=i/l,n[t+1]=r/l,n[t+2]=o/l,n[t+3]=l/h;}this.horizontal=!1,s=this.getBlurValue()*r;for(let t=0;t<n.length;t+=4){let i=0,r=0,o=0,l=0,h=0,c=t%a,d=n.length-a+c;for(let e=-14;e<15;e++){let u=e/15,g=Math.floor(s*u)*a,f=1-Math.abs(u),p=t+g;p<c?p=c:p>d&&(p=d);let m=n[p+3]*f;i+=n[p]*m,r+=n[p+1]*m,o+=n[p+2]*m,l+=m,h+=f;}e[t]=i/l,e[t+1]=r/l,e[t+2]=o/l,e[t+3]=l/h;}}sendUniformData(t,e){let i=this.chooseRightDelta();t.uniform2fv(e.uDelta,i);}isNeutralState(){return 0===this.blur;}getBlurValue(){let t=1,{horizontal:e,aspectRatio:i}=this;return e?i>1&&(t=1/i):i<1&&(t=i),t*this.blur*.12;}chooseRightDelta(){let t=this.getBlurValue();return this.horizontal?[t,0]:[0,t];}}o(aO,"type","Blur"),o(aO,"defaults",{blur:0}),o(aO,"uniformLocations",["uDelta"]),te.setClass(aO);class aM extends aC{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBrightness;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += uBrightness;\n    gl_FragColor = color;\n  }\n";}applyTo2d(t){let{imageData:{data:e}}=t,i=Math.round(255*this.brightness);for(let t=0;t<e.length;t+=4)e[t]+=i,e[t+1]+=i,e[t+2]+=i;}isNeutralState(){return 0===this.brightness;}sendUniformData(t,e){t.uniform1f(e.uBrightness,this.brightness);}}o(aM,"type","Brightness"),o(aM,"defaults",{brightness:0}),o(aM,"uniformLocations",["uBrightness"]),te.setClass(aM);let aD={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class aE extends aC{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  varying vec2 vTexCoord;\n  uniform mat4 uColorMatrix;\n  uniform vec4 uConstants;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color *= uColorMatrix;\n    color += uConstants;\n    gl_FragColor = color;\n  }";}applyTo2d(t){let e=t.imageData.data,i=this.matrix,r=this.colorsOnly;for(let t=0;t<e.length;t+=4){let s=e[t],n=e[t+1],a=e[t+2];if(e[t]=s*i[0]+n*i[1]+a*i[2]+255*i[4],e[t+1]=s*i[5]+n*i[6]+a*i[7]+255*i[9],e[t+2]=s*i[10]+n*i[11]+a*i[12]+255*i[14],!r){let r=e[t+3];e[t]+=r*i[3],e[t+1]+=r*i[8],e[t+2]+=r*i[13],e[t+3]=s*i[15]+n*i[16]+a*i[17]+r*i[18]+255*i[19];}}}sendUniformData(t,e){let i=this.matrix,r=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],s=[i[4],i[9],i[14],i[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,r),t.uniform4fv(e.uConstants,s);}toObject(){return h(h({},super.toObject()),{},{matrix:[...this.matrix]});}}function aA(t,e){var i;let r=(o(i=class extends aE{toObject(){return{type:this.type,colorsOnly:this.colorsOnly};}},"type",t),o(i,"defaults",{colorsOnly:!1,matrix:e}),i);return te.setClass(r,t),r;}o(aE,"type","ColorMatrix"),o(aE,"defaults",aD),o(aE,"uniformLocations",["uColorMatrix","uConstants"]),te.setClass(aE);let aP=aA("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]),aF=aA("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]),aR=aA("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]),aL=aA("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]),aI=aA("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]),aB=aA("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]),aW=aA("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class aX extends aC{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.subFilters=t.subFilters||[];}applyTo(t){ap(t)&&(t.passes+=this.subFilters.length-1),this.subFilters.forEach(e=>{e.applyTo(t);});}toObject(){return{type:this.type,subFilters:this.subFilters.map(t=>t.toObject())};}isNeutralState(){return!this.subFilters.some(t=>!t.isNeutralState());}static fromObject(t,e){return Promise.all((t.subFilters||[]).map(t=>te.getClass(t.type).fromObject(t,e))).then(t=>new this({subFilters:t}));}}o(aX,"type","Composed"),te.setClass(aX);class aY extends aC{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uContrast;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\n    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\n    gl_FragColor = color;\n  }";}isNeutralState(){return 0===this.contrast;}applyTo2d(t){let{imageData:{data:e}}=t,i=Math.floor(255*this.contrast),r=259*(i+255)/(255*(259-i));for(let t=0;t<e.length;t+=4)e[t]=r*(e[t]-128)+128,e[t+1]=r*(e[t+1]-128)+128,e[t+2]=r*(e[t+2]-128)+128;}sendUniformData(t,e){t.uniform1f(e.uContrast,this.contrast);}}o(aY,"type","Contrast"),o(aY,"defaults",{contrast:0}),o(aY,"uniformLocations",["uContrast"]),te.setClass(aY);let az={Convolute_3_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_3_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_5_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_5_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_7_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_7_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_9_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_9_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    "};class aV extends aC{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0);}getFragmentSource(){return az[this.getCacheKey()];}applyTo2d(t){let e,i,r,s,n,a,o,l,h,c,d,u,g;let f=t.imageData,p=f.data,m=this.matrix,v=Math.round(Math.sqrt(m.length)),x=Math.floor(v/2),y=f.width,b=f.height,w=t.ctx.createImageData(y,b),C=w.data,_=this.opaque?1:0;for(d=0;d<b;d++)for(c=0;c<y;c++){for(n=4*(d*y+c),e=0,i=0,r=0,s=0,g=0;g<v;g++)for(u=0;u<v;u++)o=d+g-x,a=c+u-x,o<0||o>=b||a<0||a>=y||(l=4*(o*y+a),h=m[g*v+u],e+=p[l]*h,i+=p[l+1]*h,r+=p[l+2]*h,_||(s+=p[l+3]*h));C[n]=e,C[n+1]=i,C[n+2]=r,C[n+3]=_?p[n+3]:s;}t.imageData=w;}sendUniformData(t,e){t.uniform1fv(e.uMatrix,this.matrix);}toObject(){return h(h({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]});}}o(aV,"type","Convolute"),o(aV,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),o(aV,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),te.setClass(aV);let aN="Gamma";class aH extends aC{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform vec3 uGamma;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    vec3 correction = (1.0 / uGamma);\n    color.r = pow(color.r, correction.r);\n    color.g = pow(color.g, correction.g);\n    color.b = pow(color.b, correction.b);\n    gl_FragColor = color;\n    gl_FragColor.rgb *= color.a;\n  }\n";}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.gamma=t.gamma||this.constructor.defaults.gamma.concat();}applyTo2d(t){let{imageData:{data:e}}=t,i=this.gamma,r=1/i[0],s=1/i[1],n=1/i[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});let a=this.rgbValues;for(let t=0;t<256;t++)a.r[t]=255*Math.pow(t/255,r),a.g[t]=255*Math.pow(t/255,s),a.b[t]=255*Math.pow(t/255,n);for(let t=0;t<e.length;t+=4)e[t]=a.r[e[t]],e[t+1]=a.g[e[t+1]],e[t+2]=a.b[e[t+2]];}sendUniformData(t,e){t.uniform3fv(e.uGamma,this.gamma);}isNeutralState(){let{gamma:t}=this;return 1===t[0]&&1===t[1]&&1===t[2];}toObject(){return{type:aN,gamma:this.gamma.concat()};}}o(aH,"type",aN),o(aH,"defaults",{gamma:[1,1,1]}),o(aH,"uniformLocations",["uGamma"]),te.setClass(aH);let aG={average:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      float average = (color.r + color.b + color.g) / 3.0;\n      gl_FragColor = vec4(average, average, average, color.a);\n    }\n    ",lightness:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    ",luminosity:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    "};class aU extends aC{applyTo2d(t){let{imageData:{data:e}}=t;for(let t,i=0;i<e.length;i+=4){let r=e[i],s=e[i+1],n=e[i+2];switch(this.mode){case"average":t=(r+s+n)/3;break;case"lightness":t=(Math.min(r,s,n)+Math.max(r,s,n))/2;break;case"luminosity":t=.21*r+.72*s+.07*n;}e[i+2]=e[i+1]=e[i]=t;}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode);}getFragmentSource(){return aG[this.mode];}sendUniformData(t,e){t.uniform1i(e.uMode,1);}isNeutralState(){return!1;}}o(aU,"type","Grayscale"),o(aU,"defaults",{mode:"average"}),o(aU,"uniformLocations",["uMode"]),te.setClass(aU);let a$=h(h({},aD),{},{rotation:0});class aq extends aE{calculateMatrix(){let t=this.rotation*Math.PI,e=tn(t),i=ta(t),r=1/3,s=Math.sqrt(1/3)*i,n=1-e;this.matrix=[e+n/3,r*n-s,r*n+s,0,0,r*n+s,e+r*n,r*n-s,0,0,r*n-s,r*n+s,e+r*n,0,0,0,0,0,1,0];}isNeutralState(){return 0===this.rotation;}applyTo(t){this.calculateMatrix(),super.applyTo(t);}toObject(){return{type:this.type,rotation:this.rotation};}}o(aq,"type","HueRotation"),o(aq,"defaults",a$),te.setClass(aq);class aK extends aC{applyTo2d(t){let{imageData:{data:e}}=t;for(let t=0;t<e.length;t+=4)e[t]=255-e[t],e[t+1]=255-e[t+1],e[t+2]=255-e[t+2],this.alpha&&(e[t+3]=255-e[t+3]);}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform int uInvert;\n  uniform int uAlpha;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    if (uInvert == 1) {\n      if (uAlpha == 1) {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);\n      } else {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n      }\n    } else {\n      gl_FragColor = color;\n    }\n  }\n";}isNeutralState(){return!this.invert;}sendUniformData(t,e){t.uniform1i(e.uInvert,Number(this.invert)),t.uniform1i(e.uAlpha,Number(this.alpha));}}o(aK,"type","Invert"),o(aK,"defaults",{alpha:!1,invert:!0}),o(aK,"uniformLocations",["uInvert","uAlpha"]),te.setClass(aK);class aJ extends aC{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uStepH;\n  uniform float uNoise;\n  uniform float uSeed;\n  varying vec2 vTexCoord;\n  float rand(vec2 co, float seed, float vScale) {\n    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n  }\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\n    gl_FragColor = color;\n  }\n";}applyTo2d(t){let{imageData:{data:e}}=t,i=this.noise;for(let t=0;t<e.length;t+=4){let r=(.5-Math.random())*i;e[t]+=r,e[t+1]+=r,e[t+2]+=r;}}sendUniformData(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random());}isNeutralState(){return 0===this.noise;}}o(aJ,"type","Noise"),o(aJ,"defaults",{noise:0}),o(aJ,"uniformLocations",["uNoise","uSeed"]),te.setClass(aJ);class aZ extends aC{applyTo2d(t){let{imageData:{data:e,width:i,height:r}}=t;for(let t=0;t<r;t+=this.blocksize)for(let s=0;s<i;s+=this.blocksize){let n=4*t*i+4*s,a=e[n],o=e[n+1],l=e[n+2],h=e[n+3];for(let n=t;n<Math.min(t+this.blocksize,r);n++)for(let t=s;t<Math.min(s+this.blocksize,i);t++){let r=4*n*i+4*t;e[r]=a,e[r+1]=o,e[r+2]=l,e[r+3]=h;}}}isNeutralState(){return 1===this.blocksize;}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBlocksize;\n  uniform float uStepW;\n  uniform float uStepH;\n  varying vec2 vTexCoord;\n  void main() {\n    float blockW = uBlocksize * uStepW;\n    float blockH = uBlocksize * uStepH;\n    int posX = int(vTexCoord.x / blockW);\n    int posY = int(vTexCoord.y / blockH);\n    float fposX = float(posX);\n    float fposY = float(posY);\n    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\n    vec4 color = texture2D(uTexture, squareCoords);\n    gl_FragColor = color;\n  }\n";}sendUniformData(t,e){t.uniform1f(e.uBlocksize,this.blocksize);}}o(aZ,"type","Pixelate"),o(aZ,"defaults",{blocksize:4}),o(aZ,"uniformLocations",["uBlocksize"]),te.setClass(aZ);class aQ extends aC{getFragmentSource(){return"\nprecision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(uTexture, vTexCoord);\n  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\n    gl_FragColor.a = 0.0;\n  }\n}\n";}applyTo2d(t){let{imageData:{data:e}}=t,i=255*this.distance,r=new ek(this.color).getSource(),s=[r[0]-i,r[1]-i,r[2]-i],n=[r[0]+i,r[1]+i,r[2]+i];for(let t=0;t<e.length;t+=4){let i=e[t],r=e[t+1],a=e[t+2];i>s[0]&&r>s[1]&&a>s[2]&&i<n[0]&&r<n[1]&&a<n[2]&&(e[t+3]=0);}}sendUniformData(t,e){let i=new ek(this.color).getSource(),r=this.distance,s=[0+i[0]/255-r,0+i[1]/255-r,0+i[2]/255-r,1],n=[i[0]/255+r,i[1]/255+r,i[2]/255+r,1];t.uniform4fv(e.uLow,s),t.uniform4fv(e.uHigh,n);}}o(aQ,"type","RemoveColor"),o(aQ,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),o(aQ,"uniformLocations",["uLow","uHigh"]),te.setClass(aQ);class a0 extends aC{sendUniformData(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps);}getFilterWindow(){let t=this.tempScale;return Math.ceil(this.lanczosLobes/t);}getCacheKey(){let t=this.getFilterWindow();return"".concat(this.type,"_").concat(t);}getFragmentSource(){let t=this.getFilterWindow();return this.generateShader(t);}getTaps(){let t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,i=this.getFilterWindow(),r=Array(i);for(let s=1;s<=i;s++)r[s-1]=t(s*e);return r;}generateShader(t){let e=Array(t);for(let i=1;i<=t;i++)e[i-1]="".concat(i,".0 * uDelta");return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec2 uDelta;\n      varying vec2 vTexCoord;\n      uniform float uTaps[".concat(t,"];\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        float sum = 1.0;\n        ").concat(e.map((t,e)=>"\n              color += texture2D(uTexture, vTexCoord + ".concat(t,") * uTaps[").concat(e,"] + texture2D(uTexture, vTexCoord - ").concat(t,") * uTaps[").concat(e,"];\n              sum += 2.0 * uTaps[").concat(e,"];\n            ")).join("\n"),"\n        gl_FragColor = color / sum;\n      }\n    ");}applyToForWebgl(t){t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,super.applyTo(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,super.applyTo(t),t.sourceHeight=t.destinationHeight;}applyTo(t){ap(t)?this.applyToForWebgl(t):this.applyTo2d(t);}isNeutralState(){return 1===this.scaleX&&1===this.scaleY;}lanczosCreate(t){return e=>{if(e>=t||e<=-t)return 0;if(e<11920929e-14&&e>-.00000011920929)return 1;let i=(e*=Math.PI)/t;return Math.sin(e)/e*Math.sin(i)/i;};}applyTo2d(t){let e;let i=t.imageData,r=this.scaleX,s=this.scaleY;this.rcpScaleX=1/r,this.rcpScaleY=1/s;let n=i.width,a=i.height,o=Math.round(n*r),l=Math.round(a*s);e="sliceHack"===this.resizeType?this.sliceByTwo(t,n,a,o,l):"hermite"===this.resizeType?this.hermiteFastResize(t,n,a,o,l):"bilinear"===this.resizeType?this.bilinearFiltering(t,n,a,o,l):"lanczos"===this.resizeType?this.lanczosResize(t,n,a,o,l):new ImageData(o,l),t.imageData=e;}sliceByTwo(t,e,i,r,s){let n=t.imageData,a=!1,o=!1,l=.5*e,h=.5*i,c=t.filterBackend.resources,d=0,u=0,g=e,f=0;c.sliceByTwo||(c.sliceByTwo=tm());let p=c.sliceByTwo;(p.width<1.5*e||p.height<i)&&(p.width=1.5*e,p.height=i);let m=p.getContext("2d");for(m.clearRect(0,0,1.5*e,i),m.putImageData(n,0,0),r=Math.floor(r),s=Math.floor(s);!a||!o;)e=l,i=h,r<Math.floor(.5*l)?l=Math.floor(.5*l):(l=r,a=!0),s<Math.floor(.5*h)?h=Math.floor(.5*h):(h=s,o=!0),m.drawImage(p,d,u,e,i,g,f,l,h),d=g,u=f,f+=h;return m.getImageData(d,u,r,s);}lanczosResize(t,e,i,r,s){let n=t.imageData.data,a=t.ctx.createImageData(r,s),o=a.data,l=this.lanczosCreate(this.lanczosLobes),h=this.rcpScaleX,c=this.rcpScaleY,d=2/this.rcpScaleX,u=2/this.rcpScaleY,g=Math.ceil(h*this.lanczosLobes/2),f=Math.ceil(c*this.lanczosLobes/2),p={},m={x:0,y:0},v={x:0,y:0};return function t(x){let y,b,w,C,_,S,j,T,k,O,M;for(m.x=(x+.5)*h,v.x=Math.floor(m.x),y=0;y<s;y++){for(m.y=(y+.5)*c,v.y=Math.floor(m.y),_=0,S=0,j=0,T=0,k=0,b=v.x-g;b<=v.x+g;b++)if(!(b<0||b>=e)){p[O=Math.floor(1e3*Math.abs(b-m.x))]||(p[O]={});for(let t=v.y-f;t<=v.y+f;t++)t<0||t>=i||(M=Math.floor(1e3*Math.abs(t-m.y)),p[O][M]||(p[O][M]=l(Math.sqrt(Math.pow(O*d,2)+Math.pow(M*u,2))/1e3)),(w=p[O][M])>0&&(C=4*(t*e+b),_+=w,S+=w*n[C],j+=w*n[C+1],T+=w*n[C+2],k+=w*n[C+3]));}o[C=4*(y*r+x)]=S/_,o[C+1]=j/_,o[C+2]=T/_,o[C+3]=k/_;}return++x<r?t(x):a;}(0);}bilinearFiltering(t,e,i,r,s){let n,a,o,l,h,c,d,u,g,f,p=0,m=this.rcpScaleX,v=this.rcpScaleY,x=4*(e-1),y=t.imageData.data,b=t.ctx.createImageData(r,s),w=b.data;for(l=0;l<s;l++)for(h=0;h<r;h++)for(a=Math.floor(m*h),o=Math.floor(v*l),c=m*h-a,d=v*l-o,f=4*(o*e+a),u=0;u<4;u++)n=y[f+u],g=n*(1-c)*(1-d)+y[f+4+u]*c*(1-d)+y[f+x+u]*d*(1-c)+y[f+x+4+u]*c*d,w[p++]=g;return b;}hermiteFastResize(t,e,i,r,s){let n=this.rcpScaleX,a=this.rcpScaleY,o=Math.ceil(n/2),l=Math.ceil(a/2),h=t.imageData.data,c=t.ctx.createImageData(r,s),d=c.data;for(let t=0;t<s;t++)for(let i=0;i<r;i++){let s=4*(i+t*r),c=0,u=0,g=0,f=0,p=0,m=0,v=0,x=(t+.5)*a;for(let r=Math.floor(t*a);r<(t+1)*a;r++){let t=Math.abs(x-(r+.5))/l,s=(i+.5)*n,a=t*t;for(let t=Math.floor(i*n);t<(i+1)*n;t++){let i=Math.abs(s-(t+.5))/o,n=Math.sqrt(a+i*i);n>1&&n<-1||(c=2*n*n*n-3*n*n+1)>0&&(v+=c*h[(i=4*(t+r*e))+3],g+=c,h[i+3]<255&&(c=c*h[i+3]/250),f+=c*h[i],p+=c*h[i+1],m+=c*h[i+2],u+=c);}}d[s]=f/u,d[s+1]=p/u,d[s+2]=m/u,d[s+3]=v/g;}return c;}}o(a0,"type","Resize"),o(a0,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),o(a0,"uniformLocations",["uDelta","uTaps"]),te.setClass(a0);class a1 extends aC{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uSaturation;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float rgMax = max(color.r, color.g);\n    float rgbMax = max(rgMax, color.b);\n    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\n    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\n    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\n    gl_FragColor = color;\n  }\n";}applyTo2d(t){let{imageData:{data:e}}=t,i=-this.saturation;for(let t=0;t<e.length;t+=4){let r=e[t],s=e[t+1],n=e[t+2],a=Math.max(r,s,n);e[t]+=a!==r?(a-r)*i:0,e[t+1]+=a!==s?(a-s)*i:0,e[t+2]+=a!==n?(a-n)*i:0;}}sendUniformData(t,e){t.uniform1f(e.uSaturation,-this.saturation);}isNeutralState(){return 0===this.saturation;}}o(a1,"type","Saturation"),o(a1,"defaults",{saturation:0}),o(a1,"uniformLocations",["uSaturation"]),te.setClass(a1);class a2 extends aC{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uVibrance;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float max = max(color.r, max(color.g, color.b));\n    float avg = (color.r + color.g + color.b) / 3.0;\n    float amt = (abs(max - avg) * 2.0) * uVibrance;\n    color.r += max != color.r ? (max - color.r) * amt : 0.00;\n    color.g += max != color.g ? (max - color.g) * amt : 0.00;\n    color.b += max != color.b ? (max - color.b) * amt : 0.00;\n    gl_FragColor = color;\n  }\n";}applyTo2d(t){let{imageData:{data:e}}=t,i=-this.vibrance;for(let t=0;t<e.length;t+=4){let r=e[t],s=e[t+1],n=e[t+2],a=Math.max(r,s,n),o=2*Math.abs(a-(r+s+n)/3)/255*i;e[t]+=a!==r?(a-r)*o:0,e[t+1]+=a!==s?(a-s)*o:0,e[t+2]+=a!==n?(a-n)*o:0;}}sendUniformData(t,e){t.uniform1f(e.uVibrance,-this.vibrance);}isNeutralState(){return 0===this.vibrance;}}o(a2,"type","Vibrance"),o(a2,"defaults",{vibrance:0}),o(a2,"uniformLocations",["uVibrance"]),te.setClass(a2);var a5=Object.freeze({__proto__:null,BaseFilter:aC,BlackWhite:aW,BlendColor:aS,BlendImage:ak,Blur:aO,Brightness:aM,Brownie:aP,ColorMatrix:aE,Composed:aX,Contrast:aY,Convolute:aV,Gamma:aH,Grayscale:aU,HueRotation:aq,Invert:aK,Kodachrome:aR,Noise:aJ,Pixelate:aZ,Polaroid:aI,RemoveColor:aQ,Resize:a0,Saturation:a1,Sepia:aB,Technicolor:aL,Vibrance:a2,Vintage:aF});},"6285ff60":function(t,e,i){"use strict";i.d(e,"__esModule",{value:!0}),i.d(e,"default",{enumerable:!0,get:function(){return o;}});var r=i("777fffbe"),s=i("1a7c85b4"),n=r._(i("dfa4ac87")),a=r._(i("d7b66386")),o=({visible:t,onCancel:e,projects:i,onLoad:r,onDelete:o})=>(0,s.jsx)(n.default,{title:"Saved Projects",open:t,onCancel:e,footer:null,width:800,children:(0,s.jsx)(a.default,{projects:i,onLoad:r,onDelete:o})});},"73fccb4c":function(t,e,i){"use strict";var r=i("852bbaa9")._;i.d(e,"__esModule",{value:!0}),i.d(e,"default",{enumerable:!0,get:function(){return _;}});var s=i("777fffbe"),n=i("1a7c85b4"),a=i("d322be42"),o=s._(i("b2a1469e")),l=s._(i("d70e0f0a")),h=s._(i("1c8d1214")),c=s._(i("d4a32650")),d=s._(i("36ede29e")),u=s._(i("1ee4d6ad")),g=s._(i("e2b6eb70")),f=s._(i("62318dd7")),p=s._(i("abad682b")),m=s._(i("798b293b")),v=s._(i("70bd2056")),x=s._(i("702fd995")),y=i("4e1dc2f8"),b=i("dc6d1542"),w=s._(i("8627c865")),C=s._(i("6285ff60")),_=({canvas:t,selectedObject:e,clipboard:s,setClipboard:_,saveState:S,savedProjects:j,onSaveProject:T,onDeleteProject:k,onLoadProject:O,onNewProject:M,exportModalVisible:D,setExportModalVisible:E,projectModalVisible:A,setProjectModalVisible:P})=>{let F=(0,a.useRef)(null),R=(0,a.useRef)(null),L=async()=>{if(!t)return;let e=t.getActiveObject();e&&(_(await e.clone()),b.photoEditorMessages.copied());},I=async()=>{if(!t||!s)return;let e=await s.clone();t.discardActiveObject(),e.set({left:(e.left||0)+10,top:(e.top||0)+10,evented:!0}),e instanceof y.ActiveSelection?(e.canvas=t,e.forEachObject(e=>{t.add(e);}),e.setCoords()):t.add(e),t.setActiveObject(e),t.requestRenderAll(),S(),b.photoEditorMessages.pasted();};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("input",{type:"file",ref:R,hidden:!0,accept:"image/*",onChange:e=>{if(!t||!e.target.files||!e.target.files[0])return;let s=e.target.files[0],n=new FileReader;n.onload=async e=>{var s;let n=null===(s=e.target)||void 0===s?void 0:s.result,{FabricImage:a}=await Promise.all([i.ensure("4e1dc2f8")]).then(i.dr(r,i.bind(i,"4e1dc2f8")));a.fromURL(n).then(e=>{e.scaleToWidth(200),t.add(e),t.centerObject(e),t.setActiveObject(e),S(),b.photoEditorMessages.imageAdded();});},n.readAsDataURL(s),e.currentTarget.value="";}}),(0,n.jsx)("input",{type:"file",ref:F,hidden:!0,accept:"application/json, .json",onChange:e=>{if(!t)return;let i=e.target.files&&e.target.files[0];if(!i)return;let r=new FileReader;r.onload=e=>{try{var i;let r=null===(i=e.target)||void 0===i?void 0:i.result,s=JSON.parse(r);t.loadFromJSON(s,()=>{t.renderAll(),S(),b.photoEditorMessages.projectLoaded();});}catch(t){console.error("Failed to import project JSON",t),b.photoEditorMessages.projectImportFailed();}},r.readAsText(i),e.currentTarget.value="";}}),(0,n.jsx)(l.default,{overlay:(0,n.jsxs)(h.default,{children:[(0,n.jsx)(h.default.Item,{icon:(0,n.jsx)(d.default,{}),onClick:()=>{var t;return null===(t=R.current)||void 0===t?void 0:t.click();},children:"Upload Image"},"upload"),(0,n.jsx)(h.default.Item,{icon:(0,n.jsx)(u.default,{}),onClick:L,disabled:!e,children:"Copy (Ctrl+C)"},"copy"),(0,n.jsx)(h.default.Item,{icon:(0,n.jsx)(g.default,{}),onClick:I,disabled:!s,children:"Paste (Ctrl+V)"},"paste"),(0,n.jsx)(h.default.Divider,{}),(0,n.jsx)(h.default.Item,{icon:(0,n.jsx)(d.default,{}),onClick:M,children:"New Project (Ctrl+N)"},"new"),(0,n.jsx)(h.default.Item,{icon:(0,n.jsx)(f.default,{}),onClick:T,children:"Save Project (Ctrl+S)"},"save"),(0,n.jsx)(h.default.Item,{icon:(0,n.jsx)(p.default,{}),onClick:()=>P(!0),children:"Open Projects"},"open"),(0,n.jsx)(h.default.Item,{icon:(0,n.jsx)(v.default,{}),onClick:()=>{var t;return null===(t=F.current)||void 0===t?void 0:t.click();},children:"Import Project (JSON)"},"import"),(0,n.jsx)(h.default.Item,{icon:(0,n.jsx)(x.default,{}),onClick:()=>E(!0),children:"Export (Ctrl+Shift+S)"},"export")]}),trigger:["click"],children:(0,n.jsx)(c.default,{title:"More",children:(0,n.jsx)(o.default,{icon:(0,n.jsx)(m.default,{})})})}),(0,n.jsx)(w.default,{visible:D,onCancel:()=>E(!1),canvas:t}),(0,n.jsx)(C.default,{visible:A,onCancel:()=>P(!1),projects:j,onLoad:O,onDelete:k})]});};},"743075ef":function(t,e,i){i.d(e,"__esModule",{value:!0}),i.e(e,{PhotoEditorProvider:function(){return f;},usePhotoEditor:function(){return p;}});var r=i("852bbaa9"),s=i("1a7c85b4"),n=i("d322be42"),a=r._(n);let o={maxEntries:50,keyFrameInterval:10,enableThumbnails:!0,thumbnailSize:64},l=(t,e)=>{let i=t.length,r=e.length;if(Math.abs(i-r)/Math.max(i,r)<.2)try{let i=JSON.parse(t),s=JSON.parse(e),n=h(i,s),a=JSON.stringify(n);if(a.length<.7*r)return{delta:a,isKeyFrame:!1};}catch{}return{delta:e,isKeyFrame:!0};},h=(t,e)=>{if("object"!=typeof t||"object"!=typeof e)return e;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{_type:"array_replace",value:e};let i=[],r=!1;for(let s=0;s<e.length;s++)JSON.stringify(t[s])!==JSON.stringify(e[s])&&(i.push({index:s,value:e[s]}),r=!0);return r?{_type:"array_patch",changes:i}:null;}let i={_type:"object_patch",changes:{}},r=!1;for(let s of new Set([...Object.keys(t),...Object.keys(e)]))JSON.stringify(t[s])!==JSON.stringify(e[s])&&(i.changes[s]=e[s],r=!0);return r?i:null;},c=(t,e)=>{try{let i=JSON.parse(e);if(!i._type)return e;let r=JSON.parse(t);if("array_replace"===i._type)return JSON.stringify(i.value);if("array_patch"===i._type&&Array.isArray(r.objects)){let t={...r};for(let e of(t.objects=[...r.objects],i.changes))t.objects[e.index]=e.value;return JSON.stringify(t);}if("object_patch"===i._type){let t={...r,...i.changes};return JSON.stringify(t);}return e;}catch{return e;}},d=()=>`${Date.now()}_${Math.random().toString(36).substr(2,9)}`,u=(t,e={})=>{let i={...o,...e},[r,s]=(0,a.useState)([]),[n,h]=(0,a.useState)(-1),[u,g]=(0,a.useState)(!1),f=(0,a.useRef)(""),p=(0,a.useRef)(0),m=(0,a.useCallback)(t=>{if(i.enableThumbnails)try{return t.toDataURL({format:"png",multiplier:i.thumbnailSize/Math.max(t.width,t.height)});}catch{return;}},[i.enableThumbnails,i.thumbnailSize]),v=(0,a.useCallback)(e=>{let a;if(!t||u)return;let o=JSON.stringify(t.toJSON());if(f.current===o)return;if(0===r.length||n<0||p.current>=i.keyFrameInterval)a={id:d(),timestamp:Date.now(),snapshot:o,description:e,thumbnail:m(t)},p.current=0;else{let{delta:i,isKeyFrame:r}=l(f.current,o);a={id:d(),timestamp:Date.now(),snapshot:r?o:"",delta:r?void 0:i,description:e,thumbnail:m(t)},r?p.current=0:p.current++;}f.current=o;let c=r.slice(0,n+1);for(c.push(a);c.length>i.maxEntries;)c.shift();s(c),h(c.length-1);},[t,r,n,u,i.keyFrameInterval,i.maxEntries,m]),x=(0,a.useCallback)(t=>{if(t<0||t>=r.length)return null;let e=t;for(;e>=0&&!r[e].snapshot;)e--;if(e<0)return null;let i=r[e].snapshot;for(let s=e+1;s<=t;s++){let t=r[s];t.snapshot?i=t.snapshot:t.delta&&(i=c(i,t.delta));}return i;},[r]),y=(0,a.useCallback)(()=>{if(!t||n<=0||u)return;g(!0);let e=n-1,i=x(e);i?t.loadFromJSON(JSON.parse(i)).then(()=>{t.renderAll(),h(e),f.current=i,g(!1);}).catch(()=>{g(!1);}):g(!1);},[t,n,u,x]),b=(0,a.useCallback)(()=>{if(!t||n>=r.length-1||u)return;g(!0);let e=n+1,i=x(e);i?t.loadFromJSON(JSON.parse(i)).then(()=>{t.renderAll(),h(e),f.current=i,g(!1);}).catch(()=>{g(!1);}):g(!1);},[t,r.length,n,u,x]),w=(0,a.useCallback)(e=>{if(!t||u)return;let i=r.findIndex(t=>t.id===e);if(i<0||i===n)return;g(!0);let s=x(i);s?t.loadFromJSON(JSON.parse(s)).then(()=>{t.renderAll(),h(i),f.current=s,g(!1);}).catch(()=>{g(!1);}):g(!1);},[t,r,n,u,x]);return(0,a.useEffect)(()=>{if(!t)return;let e=()=>{v();};return t.on("object:modified",e),t.on("object:added",e),t.on("object:removed",e),t.on("path:created",e),()=>{t.off("object:modified",e),t.off("object:added",e),t.off("object:removed",e),t.off("path:created",e);};},[t,v]),{saveState:v,undo:y,redo:b,goToEntry:w,canUndo:n>0,canRedo:n<r.length-1,entries:r,currentIndex:n,isProcessing:u};},g=(0,a.createContext)(void 0),f=({children:t,imageUrl:e,initialProject:i,addOnFile:r,setAddOnFile:n})=>{let[o,l]=(0,a.useState)(null),[h,c]=(0,a.useState)("select"),[d,f]=(0,a.useState)(null),[p,m]=(0,a.useState)(null),[v,x]=(0,a.useState)(5),[y,b]=(0,a.useState)("#000000"),[w,C]=(0,a.useState)(1),_=u(o,{maxEntries:50,keyFrameInterval:10,enableThumbnails:!0,thumbnailSize:64});return(0,s.jsx)(g.Provider,{value:{canvas:o,setCanvas:l,activeTool:h,setActiveTool:c,selectedObject:d,setSelectedObject:f,history:_,clipboard:p,setClipboard:m,imageUrl:e,initialProject:i,addOnFile:r,setAddOnFile:n,brushSize:v,setBrushSize:x,brushColor:y,setBrushColor:b,brushOpacity:w,setBrushOpacity:C},children:t});},p=()=>{let t=(0,a.useContext)(g);if(!t)throw Error("usePhotoEditor must be used within a PhotoEditorProvider");return t;};},"8627c865":function(t,e,i){"use strict";i.d(e,"__esModule",{value:!0}),i.d(e,"default",{enumerable:!0,get:function(){return g;}});var r=i("777fffbe"),s=i("1a7c85b4"),n=i("d322be42"),a=r._(i("dfa4ac87")),o=r._(i("d5daf11a")),l=r._(i("3eb6f542")),h=r._(i("2aa4d12e")),c=r._(i("b2a1469e")),d=r._(i("9f0970b1")),u=i("dc6d1542"),g=({visible:t,onCancel:e,canvas:i})=>{let[r,g]=(0,n.useState)("png"),[f,p]=(0,n.useState)(1),[m,v]=(0,n.useState)(1),[x,y]=(0,n.useState)(!0),b=(t,e)=>{let i=document.createElement("a");i.href=URL.createObjectURL(t),i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i);};return(0,s.jsx)(a.default,{title:"Export Image",open:t,onCancel:e,footer:[(0,s.jsx)(c.default,{onClick:e,children:"Cancel"},"cancel"),(0,s.jsx)(c.default,{type:"primary",onClick:()=>{if(i){if("json"===r)b(new Blob([JSON.stringify(i.toJSON())],{type:"application/json"}),"project.json");else if("svg"===r)b(new Blob([i.toSVG()],{type:"image/svg+xml"}),"image.svg");else{let t={format:r,quality:f,multiplier:m},e=null,s=null;if(x){let r=i.getObjects();if(r.length>0){let n=1/0,a=1/0,o=-1/0,l=-1/0;r.forEach(t=>{let e=t.getBoundingRect();e.left<n&&(n=e.left),e.top<a&&(a=e.top),e.left+e.width>o&&(o=e.left+e.width),e.top+e.height>l&&(l=e.top+e.height);}),t={...t,left:n,top:a,width:o-n,height:l-a},e=i.backgroundColor,s=i.backgroundImage,i.backgroundColor=null,i.backgroundImage=null;}}let n=i.toDataURL(t);x&&(i.backgroundColor=e,i.backgroundImage=s);let a=document.createElement("a");a.download=`image.${r}`,a.href=n,document.body.appendChild(a),a.click(),document.body.removeChild(a);}u.photoEditorMessages.projectExported(r),e();}},children:"Export"},"export")],children:(0,s.jsxs)(o.default,{layout:"vertical",children:[(0,s.jsx)(o.default.Item,{label:"Format",children:(0,s.jsxs)(l.default,{value:r,onChange:t=>g(t),children:[(0,s.jsx)(l.default.Option,{value:"png",children:"PNG"}),(0,s.jsx)(l.default.Option,{value:"jpeg",children:"JPEG"}),(0,s.jsx)(l.default.Option,{value:"svg",children:"SVG"}),(0,s.jsx)(l.default.Option,{value:"json",children:"JSON (Project)"})]})}),"json"!==r&&"svg"!==r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.default.Item,{label:"Quality (0.1 - 1)",children:(0,s.jsx)(h.default,{min:.1,max:1,step:.1,value:f,onChange:t=>p(t||1),style:{width:"100%"}})}),(0,s.jsx)(o.default.Item,{label:"Multiplier (Scale)",children:(0,s.jsx)(h.default,{min:.1,max:5,step:.1,value:m,onChange:t=>v(t||1),style:{width:"100%"}})}),(0,s.jsx)(o.default.Item,{children:(0,s.jsx)(d.default,{checked:x,onChange:t=>y(t.target.checked),children:"Trim Whitespace (Export content only)"})})]})]})});};},cd7c2b80:function(t,e,i){"use strict";i.d(e,"__esModule",{value:!0}),i.d(e,"imageProcessingService",{enumerable:!0,get:function(){return s;}});class r{worker=null;pendingTasks=new Map;taskIdCounter=0;getWorker(){return this.worker||(this.worker=new Worker(new URL("55372c14-worker.js",self.document?self.document.baseURI:self.location.href),{type:"module"}),this.worker.onmessage=t=>{let{id:e,success:i,data:r,error:s}=t.data,n=this.pendingTasks.get(e);n&&(this.pendingTasks.delete(e),i&&r?n.resolve(r):n.reject(Error(s||"Worker processing failed")));},this.worker.onerror=t=>{console.error("Worker error:",t),this.pendingTasks.forEach(t=>{t.reject(Error("Worker error"));}),this.pendingTasks.clear();}),this.worker;}generateTaskId(){return`task_${++this.taskIdCounter}_${Date.now()}`;}sendMessage(t,e){return new Promise((i,r)=>{var s,n,a,o;let l=this.generateTaskId(),h=this.getWorker();this.pendingTasks.set(l,{resolve:i,reject:r});let c={type:t,id:l,payload:e},d=[];(null===(n=e.imageData)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:s.buffer)&&d.push(e.imageData.data.buffer),(null===(o=e.maskData)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.buffer)&&d.push(e.maskData.data.buffer),d.length>0?h.postMessage(c,d):h.postMessage(c);});}async applyBlurWithMask(t,e,i=15,r=7){let s=t.getContext("2d"),n=e.getContext("2d");if(!s||!n)throw Error("Failed to get canvas context");let a=s.getImageData(0,0,t.width,t.height),o=n.getImageData(0,0,e.width,e.height),l=await this.sendMessage("APPLY_BLUR",{imageData:a,maskData:o,blurAmount:i,feather:r}),h=document.createElement("canvas");h.width=t.width,h.height=t.height;let c=h.getContext("2d");return c&&c.putImageData(l,0,0),h;}async applyCameraRaw(t,e){let i=t.getContext("2d");if(!i)throw Error("Failed to get canvas context");let r=i.getImageData(0,0,t.width,t.height),s=await this.sendMessage("APPLY_CAMERA_RAW",{imageData:r,settings:e}),n=document.createElement("canvas");n.width=t.width,n.height=t.height;let a=n.getContext("2d");return a&&a.putImageData(s,0,0),n;}async applyCurves(t,e){let i=t.getContext("2d");if(!i)throw Error("Failed to get canvas context");let r=i.getImageData(0,0,t.width,t.height),s=await this.sendMessage("APPLY_CURVES",{imageData:r,curves:e}),n=document.createElement("canvas");n.width=t.width,n.height=t.height;let a=n.getContext("2d");return a&&a.putImageData(s,0,0),n;}terminate(){this.worker&&(this.worker.terminate(),this.worker=null,this.pendingTasks.clear());}static isSupported(){return"undefined"!=typeof Worker;}}let s=new r;},d7b66386:function(t,e,i){"use strict";i.d(e,"__esModule",{value:!0}),i.d(e,"default",{enumerable:!0,get:function(){return u;}});var r=i("777fffbe"),s=i("1a7c85b4"),n=r._(i("95eb3634")),a=r._(i("e9bcd22d")),o=r._(i("b2a1469e")),l=r._(i("bb755443")),h=r._(i("1ffd224b")),c=r._(i("6effc0fd")),d=r._(i("84cd549f")),u=({projects:t,onLoad:e,onDelete:i})=>0===t.length?(0,s.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,s.jsx)(c.default.Text,{type:"secondary",children:"No saved projects found."})}):(0,s.jsx)(n.default,{grid:{gutter:16,column:3},dataSource:t,renderItem:t=>(0,s.jsx)(n.default.Item,{children:(0,s.jsx)(a.default,{hoverable:!0,cover:(0,s.jsx)("div",{style:{height:150,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f0f0f0"},children:(0,s.jsx)(h.default,{src:t.thumbnail,preview:!1,style:{maxHeight:"100%",maxWidth:"100%",objectFit:"contain"}})}),onClick:()=>e(t),actions:[(0,s.jsx)(l.default,{title:"Delete project?",onConfirm:()=>{i(t.id);},okText:"Yes",cancelText:"No",children:(0,s.jsx)(o.default,{type:"text",danger:!0,icon:(0,s.jsx)(d.default,{}),onClick:t=>t.stopPropagation(),children:"Delete"})})],children:(0,s.jsx)(a.default.Meta,{title:t.name,description:new Date(t.updatedAt).toLocaleString()})})})});},dc6d1542:function(t,e,i){"use strict";i.d(e,"__esModule",{value:!0}),i.d(e,"photoEditorMessages",{enumerable:!0,get:function(){return a;}});var r=i("777fffbe"),s=r._(i("c9d8dc0b")),n=r._(i("2343d707"));let a={projectSaved:()=>s.default.success("Project saved successfully"),projectLoaded:()=>s.default.success("Project loaded"),projectExported:t=>s.default.success(`Exported as ${t}`),projectImportFailed:()=>s.default.error("Failed to import project. Make sure it is a valid project file."),imageAdded:()=>s.default.success("Image added to canvas"),imageLoadFailed:()=>s.default.error("Failed to load image"),copied:()=>s.default.success("Copied to clipboard"),pasted:()=>s.default.success("Pasted from clipboard"),nothingToCopy:()=>s.default.info("Nothing selected to copy"),nothingToPaste:()=>s.default.info("Nothing in clipboard to paste"),filterApplied:t=>s.default.success(`${t} applied`),filterFailed:t=>s.default.error(`Failed to apply ${t}. Please try again.`),selectionCreated:()=>s.default.success("Selection created"),selectionCleared:()=>s.default.info("Selection cleared"),canvasCleared:()=>s.default.info("Canvas cleared"),objectDeleted:()=>s.default.success("Deleted"),undoPerformed:()=>s.default.info("Undo"),redoPerformed:()=>s.default.info("Redo"),noMoreUndo:()=>s.default.info("Nothing to undo"),noMoreRedo:()=>s.default.info("Nothing to redo"),genericError:t=>s.default.error(t||"An error occurred. Please try again."),operationFailed:t=>s.default.error(`${t} failed. Please try again.`),largeImageWarning:()=>n.default.warning({message:"Large Image Detected",description:"This image is quite large. Some operations may take longer to process. Consider using preview mode for faster editing.",duration:5}),unsavedChanges:()=>n.default.warning({message:"Unsaved Changes",description:"You have unsaved changes. Save your project to avoid losing work.",duration:4}),crossOriginWarning:()=>n.default.warning({message:"Cross-Origin Image",description:"This image is from a different domain and may not support some operations. Try downloading and uploading the image instead.",duration:5})};}}]);
//# sourceMappingURL=ad692153-async.6f8bd844.js.map