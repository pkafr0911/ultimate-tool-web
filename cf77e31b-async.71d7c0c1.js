(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]||[]).push([["cf77e31b"],{ce47aff6:function(e,t,r){r.d(t,"__esModule",{value:!0}),r.e(t,{default:function(){return r0;}});var l=r("777fffbe"),n=r("852bbaa9"),a=r("95bd365d"),i=r("314fd1a3"),o=n._(i),s=r("0ec3d373"),d=l._(s),c=r("bb4b9fac"),u=l._(c),h=r("5a83e636"),f=l._(h),g=r("2206dff1"),x=l._(g),m=r("532621ad"),p=l._(m),y=r("a4f51854"),v=l._(y),w=r("d6f53458"),j=l._(w),b=r("90c13dc1"),C=l._(b),k=r("0ed998a9"),S=l._(k),M=r("636e58f3"),R=l._(M),I=r("95d03ed3"),E=l._(I);function D(e,t){let r=document.createElement("canvas");return r.width=e,r.height=t,r;}function z(e,t,r){let l=e.width,n=e.height,a=e.data,i=new Uint8ClampedArray(a.length),o=Math.floor(r/2);for(let e=0;e<n;e++)for(let s=0;s<l;s++){let d=0,c=0,u=0,h=0;for(let i=0;i<r;i++)for(let f=0;f<r;f++){let g=s+f-o,x=e+i-o;if(g<0||g>=l||x<0||x>=n)continue;let m=(x*l+g)*4,p=t[i*r+f];d+=a[m]*p,c+=a[m+1]*p,u+=a[m+2]*p,h+=a[m+3]*p;}let f=(e*l+s)*4;i[f]=Math.min(255,Math.max(0,d)),i[f+1]=Math.min(255,Math.max(0,c)),i[f+2]=Math.min(255,Math.max(0,u)),i[f+3]=Math.min(255,Math.max(0,h||a[f+3]));}return e.data.set(i),e;}let L={sharpen:[0,-1,0,-1,5,-1,0,-1,0],blur3:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],gaussian5:[1/273,4/273,7/273,4/273,1/273,4/273,16/273,26/273,16/273,4/273,7/273,26/273,41/273,26/273,7/273,4/273,16/273,26/273,16/273,4/273,1/273,4/273,7/273,4/273,1/273],generateBoxBlurKernel(e){let t=0|e,r=t*t;return Array(r).fill(1/r);},generateGaussianKernel(e){let t=0|e,r=t/2,l=2*r*r,n=[],a=0;for(let e=-t;e<=t;e++)for(let r=-t;r<=t;r++){let t=Math.exp(-(r*r+e*e)/l);n.push(t),a+=t;}return n.map(e=>e/a);}},T=(e,{highlights:t=0,shadows:r=0,whites:l=0,blacks:n=0,vibrance:a=0,saturation:i=0,clarity:o=0,dehaze:s=0})=>{let d=e.data,c=0!==o?new Uint8ClampedArray(d):null;for(let e=0;e<d.length;e+=4){let u=d[e],h=d[e+1],f=d[e+2],g=.299*u+.587*h+.114*f;if(g>192&&0!==t){let e=(g-192)/63;u=P(u+t*e),h=P(h+t*e),f=P(f+t*e);}if(g<64&&0!==r){let e=1-g/64;u=P(u+r*e),h=P(h+r*e),f=P(f+r*e);}if(u=P(u+l-n),h=P(h+l-n),f=P(f+l-n),0!==s&&(u=P(u*(1+s/100)),h=P(h*(1-s/200)),f=P(f*(1-s/200))),0!==a||0!==i){let e=[u,h,f];A(e,0,{vibrance:a,saturation:i}),[u,h,f]=e;}if(0!==o&&c){let t=o/100*(g-(.299*c[e]+.587*c[e+1]+.114*c[e+2]));u=P(u+t),h=P(h+t),f=P(f+t);}d[e]=u,d[e+1]=h,d[e+2]=f;}return e;},B=(e,t,r)=>{let l=e[t],n=e[t+1],a=e[t+2],[i,o,s]=N(l,n,a),d=1+r/100*1.5;l=P(128+(l-128)*d),n=P(128+(n-128)*d),a=P(128+(a-128)*d),[i,o,s]=N(l,n,a),o=W(o*(1+r/100*.6)),s=W(s*(1+r/100*.15)),[l,n,a]=_(i,o,s),e[t]=l,e[t+1]=n,e[t+2]=a;},A=(e,t,{vibrance:r=0,saturation:l=0})=>{let[n,a,i]=N(e[t],e[t+1],e[t+2]);0!==l&&(a=W(a*(1+l/100))),0!==r&&(a=W(a+r/100*(1-a)*(1-a)));let[o,s,d]=_(n,a,i);e[t]=o,e[t+1]=s,e[t+2]=d;},P=(e,t=0,r=255)=>Math.min(r,Math.max(t,e)),W=e=>Math.min(1,Math.max(0,e)),N=(e,t,r)=>{let l=Math.max(e/=255,t/=255,r/=255),n=Math.min(e,t,r),a=0,i=0,o=(l+n)/2;if(l!==n){let s=l-n;switch(i=o>.5?s/(2-l-n):s/(l+n),l){case e:a=(t-r)/s+(t<r?6:0);break;case t:a=(r-e)/s+2;break;case r:a=(e-t)/s+4;}a/=6;}return[a,i,o];},_=(e,t,r)=>{let l,n,a;if(0===t)l=n=a=r;else{let i=(e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6)?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e,o=r<.5?r*(1+t):r+t-r*t,s=2*r-o;l=i(s,o,e+1/3),n=i(s,o,e),a=i(s,o,e-1/3);}return[Math.round(255*l),Math.round(255*n),Math.round(255*a)];},U=[{name:"red",range:[345,15]},{name:"orange",range:[15,45]},{name:"yellow",range:[45,75]},{name:"green",range:[75,165]},{name:"aqua",range:[165,195]},{name:"blue",range:[195,255]},{name:"purple",range:[255,285]},{name:"magenta",range:[285,345]}],H=(e,t)=>{let r=e.data;for(let e=0;e<r.length;e+=4){let[l,n,a]=[r[e],r[e+1],r[e+2]],[i,o,s]=N(l,n,a),d=(360*i+360)%360,c=U.find(({range:e})=>{let[t,r]=e;return t<=r?d>=t&&d<=r:d>=t||d<=r;});if(!c){[r[e],r[e+1],r[e+2]]=_(i,o,s);continue;}let u=t[c.name];if(!u){[r[e],r[e+1],r[e+2]]=_(i,o,s);continue;}let[h,f]=c.range,g=f;h>g&&(g+=360);let x=d;if(x<h&&(x+=360),"number"==typeof u.h&&0!==u.h){let e=x+u.h;e<h&&(e=h),e>g&&(e=g),i=(d=(e%360+360)%360)/360;}"number"==typeof u.s&&0!==u.s&&(o=W(o*(1+(1>=Math.abs(u.s)?100*u.s:u.s)/100))),"number"==typeof u.l&&0!==u.l&&(s=W(s*(1+(1>=Math.abs(u.l)?100*u.l:u.l)/100))),[r[e],r[e+1],r[e+2]]=_(i,o,s);}return e;},$=(e,t,r,l)=>{if(!t.current)return;let n=t.current,a=D(n.width,n.height);a.getContext("2d").drawImage(n,0,0);let i=D(n.height,n.width),o=i.getContext("2d");o.translate(i.width/2,i.height/2),o.rotate(e*Math.PI/180),o.drawImage(a,-a.width/2,-a.height/2),t.current.width=i.width,t.current.height=i.height,r.current.width=i.width,r.current.height=i.height;let s=t.current.getContext("2d");s.clearRect(0,0,i.width,i.height),s.drawImage(i,0,0),l.push(t.current.toDataURL(),`Rotate ${e}`);},O=(e,t)=>{if(!e.current)return;let r=e.current.getContext("2d"),l=D(e.current.width,e.current.height);l.getContext("2d").drawImage(e.current,0,0),r.save(),r.clearRect(0,0,e.current.width,e.current.height),r.scale(-1,1),r.drawImage(l,-e.current.width,0),r.restore(),t.push(e.current.toDataURL(),"Flip horizontal");},F=(e,t)=>{if(!e.current)return;let r=e.current.getContext("2d"),l=D(e.current.width,e.current.height);l.getContext("2d").drawImage(e.current,0,0),r.save(),r.clearRect(0,0,e.current.width,e.current.height),r.scale(1,-1),r.drawImage(l,0,-e.current.height),r.restore(),t.push(e.current.toDataURL(),"Flip vertical");},K=(e,t,r,l,n)=>{if(!e.current||!r)return;let a=D(Math.max(1,Math.round(r.w)),Math.max(1,Math.round(r.h)));a.getContext("2d").drawImage(e.current,r.x,r.y,r.w,r.h,0,0,r.w,r.h),e.current.width=a.width,e.current.height=a.height,t.current.width=a.width,t.current.height=a.height;let i=e.current.getContext("2d");i.clearRect(0,0,a.width,a.height),i.drawImage(a,0,0),l(null),n.push(e.current.toDataURL(),"Cropped");},G=async e=>{if(e.current)try{let t=await new Promise(t=>e.current.toBlob(e=>t(e),"image/png"));if(!t)return;await navigator.clipboard.write([new ClipboardItem({"image/png":t})]),S.default.success("Image copied to clipboard");}catch(e){console.warn("clipboard failed",e),S.default.error("Copy failed (browser may not support)");}},V=(e,t,r)=>{let l=t.current;if(!l)return null;let n=l.getBoundingClientRect(),a=Math.floor((e.clientX-n.left)/r),i=Math.floor((e.clientY-n.top)/r);if(a<0||i<0||a>=l.width||i>=l.height)return null;let o=l.getContext("2d",{willReadFrequently:!0});if(!o)return null;let s=o.getImageData(a,i,1,1).data;return`#${[s[0],s[1],s[2]].map(e=>e.toString(16).padStart(2,"0")).join("")}`;},X=(e,t,r,l,n,a,i)=>{let o=new Image;o.onload=()=>{var e,i;let s=(null===(e=t.current)||void 0===e?void 0:e.width)||o.naturalWidth,d=(null===(i=t.current)||void 0===i?void 0:i.height)||o.naturalHeight,c=o.naturalWidth,u=o.naturalHeight,h=Math.min(1,Math.min(s/(1.2*c),d/(1.2*u))),f=Math.round((s-(c=Math.round(c*h)))/2),g=Math.round((d-(u=Math.round(u*h)))/2),x=`${Date.now()}_${Math.round(1e4*Math.random())}`,m={id:x,type:"image",img:o,rect:{x:f,y:g,w:c,h:u},opacity:1,blend:"source-over"};r(e=>[...e,m]),l(x),n(!0),a(),S.default.success("Overlay image added");},o.onerror=()=>S.default.error("Failed to load overlay image"),o.src=URL.createObjectURL(e),i("layer");},Y=(e,t,r,l,n,a)=>{if(!e.mask){"image"===e.type&&e.img&&t.drawImage(e.img,r,l,n,a);return;}let i=D(n,a),o=i.getContext("2d");"image"===e.type&&e.img&&o.drawImage(e.img,0,0,n,a),o.globalCompositeOperation="destination-in",o.drawImage(e.mask,0,0,n,a),t.drawImage(i,r,l);},q=async(e,t,r,l)=>{if(!t.current)return;let n=t.current,a=D(n.width,n.height),i=a.getContext("2d");for(let e of(i.clearRect(0,0,a.width,a.height),i.drawImage(n,0,0),r))try{if(i.save(),i.globalAlpha=e.opacity,i.globalCompositeOperation=e.blend||"source-over",e.rotation&&0!==e.rotation){let t=e.rect.x+e.rect.w/2,r=e.rect.y+e.rect.h/2;i.translate(t,r),i.rotate(e.rotation*Math.PI/180),i.translate(-t,-r);}if("image"===e.type&&e.img)Y(e,i,e.rect.x,e.rect.y,e.rect.w,e.rect.h);else if("text"===e.type){let t=e.fontItalic?"italic":"normal",r=e.fontWeight||"normal",l=e.fontSize||16;i.font=`${t} ${r} ${l}px ${e.font||"Arial"}`,i.fillStyle=e.textColor||"#000000",i.textAlign=e.textAlign||"left",i.textBaseline="top";let n=(e.text||"").split("\n"),a=1.2*l,o=e.rect.y;for(let t of n){let r=e.rect.x;if("center"===e.textAlign?r+=e.rect.w/2:"right"===e.textAlign&&(r+=e.rect.w),i.fillText(t,r,o),"underline"===e.textDecoration){let n=i.measureText(t);i.strokeStyle=e.textColor||"#000000",i.lineWidth=1,i.beginPath(),i.moveTo(r,o+l),i.lineTo(r+n.width,o+l),i.stroke();}else if("line-through"===e.textDecoration){let n=i.measureText(t);i.strokeStyle=e.textColor||"#000000",i.lineWidth=1,i.beginPath(),i.moveTo(r,o+l/2),i.lineTo(r+n.width,o+l/2),i.stroke();}o+=a;}}i.restore();}catch(e){}i.globalAlpha=1,i.globalCompositeOperation="source-over";let o=await new Promise(t=>a.toBlob(e=>t(e),e?"image/jpeg":"image/png",.92));if(o){l&&l(o);let t=URL.createObjectURL(o),r=document.createElement("a");r.href=t,r.download=e?"edited.jpg":"edited.png",r.click(),URL.revokeObjectURL(t),S.default.success("Exported image (with overlays)");}},Z=(e,t,r,l,n)=>{if(!e.current)return;let a=n?t.filter(e=>e.id===n&&!e.locked):t.slice();if(0===a.length)return;let i=e.current.getContext("2d");for(let e of a)try{if(i.save(),i.globalAlpha=e.opacity,i.globalCompositeOperation=e.blend||"source-over",e.rotation&&0!==e.rotation){let t=e.rect.x+e.rect.w/2,r=e.rect.y+e.rect.h/2;i.translate(t,r),i.rotate(e.rotation*Math.PI/180),i.translate(-t,-r);}if("image"===e.type&&e.img)Y(e,i,e.rect.x,e.rect.y,e.rect.w,e.rect.h);else if("text"===e.type){let t=e.fontItalic?"italic":"normal",r=e.fontWeight||"normal",l=e.fontSize||16;i.font=`${t} ${r} ${l}px ${e.font||"Arial"}`,i.fillStyle=e.textColor||"#000000",i.textAlign=e.textAlign||"left",i.textBaseline="top";let n=(e.text||"").split("\n"),a=1.2*l,o=e.rect.y;for(let t of n){let r=e.rect.x;if("center"===e.textAlign?r+=e.rect.w/2:"right"===e.textAlign&&(r+=e.rect.w),i.fillText(t,r,o),"underline"===e.textDecoration){let n=i.measureText(t);i.strokeStyle=e.textColor||"#000000",i.lineWidth=1,i.beginPath(),i.moveTo(r,o+l),i.lineTo(r+n.width,o+l),i.stroke();}else if("line-through"===e.textDecoration){let n=i.measureText(t);i.strokeStyle=e.textColor||"#000000",i.lineWidth=1,i.beginPath(),i.moveTo(r,o+l/2),i.lineTo(r+n.width,o+l/2),i.stroke();}o+=a;}}i.restore();}catch(e){}r(e=>e.filter(e=>!a.find(t=>t.id===e.id))),l.push(e.current.toDataURL(),n?"Merge layer":"Merge layers"),S.default.success("Layer(s) merged into base");},J=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,opacity:r}:e)),Q=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,blend:r}:e)),ee=(e,t)=>e(e=>{let r=e.findIndex(e=>e.id===t);if(-1===r||r===e.length-1)return e;let l=e.slice(),n=l[r+1];return l[r+1]=l[r],l[r]=n,l;}),et=(e,t)=>e(e=>{let r=e.findIndex(e=>e.id===t);if(r<=0)return e;let l=e.slice(),n=l[r-1];return l[r-1]=l[r],l[r]=n,l;}),er=(e,t,r)=>e(e=>{let l=e.filter(e=>e.id!==t||e.locked);return r&&r(l.length?l[l.length-1].id:null),l;}),el=(e,t)=>{e(t);},en=(e,t,r,l,n,a,i)=>{var o,s;if(!a.text.trim()){S.default.warning("Please enter text first");return;}let d=(null===(o=e.current)||void 0===o?void 0:o.width)||400,c=(null===(s=e.current)||void 0===s?void 0:s.height)||300,u=i?Math.round(i.x):Math.round(d/4),h=i?Math.round(i.y):Math.round(c/4),f=`text_${Date.now()}_${Math.round(1e4*Math.random())}`,g={id:f,type:"text",rect:{x:u,y:h,w:Math.min(300,d/2),h:a.fontSize+20},opacity:1,blend:"source-over",text:a.text,font:a.font,fontSize:a.fontSize,fontWeight:a.fontWeight,fontItalic:a.fontItalic,textDecoration:a.textDecoration,textColor:a.textColor,textAlign:a.textAlign};t(e=>[...e,g]),r(f),l(!0),n(),S.default.success("Text layer added");},ea=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,text:r}:e)),ei=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,font:r}:e)),eo=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,fontSize:r}:e)),es=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,fontWeight:r}:e)),ed=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,fontItalic:r}:e)),ec=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,textDecoration:r}:e)),eu=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,textColor:r}:e)),eh=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,textAlign:r}:e)),ef=(e,t,r)=>{if(!(t.length<2)){e.save(),e.globalAlpha=r.opacity*r.flow,"soft"===r.type?(e.shadowColor=r.color,e.shadowBlur=.5*r.lineWidth,e.lineWidth=.5*r.lineWidth):(e.shadowBlur=0,e.lineWidth=r.lineWidth),e.strokeStyle=r.color,e.lineCap="round",e.lineJoin="round",e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let r=1;r<t.length;r++)e.lineTo(t[r].x,t[r].y);e.stroke(),e.restore();}},eg=(e,t,r,l,n,a=1)=>{e.save(),e.strokeStyle=n,e.lineWidth=2/a,e.beginPath(),e.arc(t,r,l/2,0,2*Math.PI),e.stroke(),e.restore();},ex=(e,t,r=1,l={x:0,y:0})=>{if(!t.current)return null;let n=t.current.getBoundingClientRect();return{x:(e.clientX-n.left)/r-l.x,y:(e.clientY-n.top)/r-l.y};},em=(e,t,r)=>{let l=e.getContext("2d");if(!l)return null;let[n,a,i]=l.getImageData(t,r,1,1).data;return`#${[n,a,i].map(e=>e.toString(16).padStart(2,"0")).join("")}`;},ep=(e,t,r)=>{if(!e.current||!t.current)return;let{zoom:l,cropRect:n,rulerPoints:a,perspectivePoints:i,hoverColor:o,tool:s,drawColor:d,drawLineWidth:c,layers:u,overlaySelected:h,activeLayerId:f}=r,g=e.current.getContext("2d");if(g.clearRect(0,0,e.current.width,e.current.height),n&&(g.save(),g.strokeStyle="#00aaff",g.lineWidth=2,g.setLineDash([6,4]),g.strokeRect(n.x,n.y,n.w,n.h),g.restore()),a&&(g.save(),g.strokeStyle="#ffcc00",g.lineWidth=2,g.beginPath(),g.moveTo(a.x1,a.y1),g.lineTo(a.x2,a.y2),g.stroke(),g.restore()),i){g.save();let e=[];for(let t=0;t<8;t+=2){let r=i[t],l=i[t+1];isNaN(r)||isNaN(l)||e.push({x:r,y:l});}if(e.length>=2){g.strokeStyle="rgba(0,255,0,0.9)",g.lineWidth=2,g.setLineDash([4,4]),g.beginPath(),g.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++)g.lineTo(e[t].x,e[t].y);4===e.length&&g.closePath(),g.stroke();}g.fillStyle="rgba(0,255,0,0.9)";for(let e=0;e<8;e+=2){let t=i[e],r=i[e+1];isNaN(t)||isNaN(r)||g.fillRect(t-5,r-5,10,10);}g.restore();}if(o&&("color"===s||"removeColor"===s)){let e=t.current.getBoundingClientRect();eg(g,(o.x-e.left)/l,(o.y-e.top)/l,16/l,o.color,l);}for(let e of u)try{if(g.save(),g.globalAlpha=e.opacity,g.globalCompositeOperation=e.blend||"source-over",e.rotation&&0!==e.rotation){let t=e.rect.x+e.rect.w/2,r=e.rect.y+e.rect.h/2;g.translate(t,r),g.rotate(e.rotation*Math.PI/180),g.translate(-t,-r);}if("image"===e.type&&e.img){if(e.mask){let t=document.createElement("canvas");t.width=e.rect.w,t.height=e.rect.h;let r=t.getContext("2d");r.drawImage(e.img,0,0,e.rect.w,e.rect.h),r.globalCompositeOperation="destination-in",r.drawImage(e.mask,0,0,e.rect.w,e.rect.h),g.drawImage(t,e.rect.x,e.rect.y);}else g.drawImage(e.img,e.rect.x,e.rect.y,e.rect.w,e.rect.h);}else if("text"===e.type){let t=e.fontItalic?"italic":"normal",r=e.fontWeight||"normal",l=e.fontSize||16;g.font=`${t} ${r} ${l}px ${e.font||"Arial"}`,g.fillStyle=e.textColor||"#000000",g.textAlign=e.textAlign||"left",g.textBaseline="top";let n=(e.text||"").split("\n"),a=1.2*l,i=e.rect.y;for(let t of n){let r=e.rect.x;if("center"===e.textAlign?r+=e.rect.w/2:"right"===e.textAlign&&(r+=e.rect.w),g.fillText(t,r,i),"underline"===e.textDecoration){let n=g.measureText(t);g.strokeStyle=e.textColor||"#000000",g.lineWidth=1,g.beginPath(),g.moveTo(r,i+l),g.lineTo(r+n.width,i+l),g.stroke();}else if("line-through"===e.textDecoration){let n=g.measureText(t);g.strokeStyle=e.textColor||"#000000",g.lineWidth=1,g.beginPath(),g.moveTo(r,i+l/2),g.lineTo(r+n.width,i+l/2),g.stroke();}i+=a;}}g.restore();}catch(e){}if(h&&f){let e=u.find(e=>e.id===f);if(e){let t=e.rect;if(g.save(),g.globalAlpha=1,g.globalCompositeOperation="source-over",e.rotation&&0!==e.rotation){let r=t.x+t.w/2,l=t.y+t.h/2;g.translate(r,l),g.rotate(e.rotation*Math.PI/180),g.translate(-r,-l);}g.strokeStyle="rgba(255,165,0,0.95)",g.lineWidth=2,g.setLineDash([6,3]),g.strokeRect(t.x,t.y,t.w,t.h),g.setLineDash([]),g.fillStyle="rgba(255,165,0,0.95)";let r=Math.max(6/Math.max(1,l),6),n=r/2;[[t.x,t.y],[t.x+t.w,t.y],[t.x,t.y+t.h],[t.x+t.w,t.y+t.h]].forEach(([e,t])=>g.fillRect(e-n,t-n,r,r)),g.fillStyle="rgba(0,180,255,0.95)",[[t.x+t.w/2,t.y],[t.x+t.w/2,t.y+t.h],[t.x,t.y+t.h/2],[t.x+t.w,t.y+t.h/2]].forEach(([e,t])=>{g.fillRect(e-n,t-n,r,r);}),g.restore();}}if(o&&"draw"===s){let e=t.current.getBoundingClientRect();eg(g,(o.x-e.left)/l,(o.y-e.top)/l,c,d,l);}},ey=e=>{let{canvasX:t,canvasY:r,canvasRect:l,containerRef:n,inlineEditorRef:a,zoom:i,initial:o="",layerId:s,layer:d,textColor:c="#000",textFont:u="Arial",textFontSize:h=16,textWeight:f="normal",textItalic:g=!1,onCommit:x,onCancel:m}=e;a.current&&(a.current.remove(),a.current=null);let p=n.current,y=p?p.getBoundingClientRect():{left:0,top:0},v=l.left+t*i,w=l.top+r*i,j=v-y.left,b=w-y.top,C=document.createElement("textarea");C.value=o,C.style.position="absolute",C.style.left=`${j}px`,C.style.top=`${b}px`,C.style.zIndex="10000",C.style.minWidth="60px",C.style.minHeight="24px",C.style.background="transparent",C.style.border="1px dashed rgba(0,0,0,0.4)",C.style.color=d&&d.textColor||c||"#000",C.style.fontFamily=d&&d.font||u||"Arial";let k=d&&d.fontSize||h||16;C.style.fontSize=`${k*i}px`,C.style.fontWeight=String(d&&d.fontWeight||f||"normal"),C.style.fontStyle=d&&d.fontItalic||g?"italic":"normal",C.style.resize="both",C.style.outline="none",C.style.padding="4px",C.placeholder="Type text and press Enter";let S=!1,M=()=>{S||(S=!!C.value&&!o,x(C.value||""),C.remove(),a.current=null);},R=()=>{C.remove(),a.current=null,m&&m();};C.addEventListener("keydown",e=>{e.shiftKey&&"Enter"===e.key||("Enter"!==e.key||e.shiftKey?"Escape"===e.key&&(e.preventDefault(),R()):(e.preventDefault(),M()));}),C.addEventListener("blur",()=>{M();});let I=()=>{C.style.position="fixed",C.style.left=`${v}px`,C.style.top=`${w}px`,C.style.zIndex="200000",document.body.appendChild(C),a.current=C,C.focus(),C.selectionStart=C.selectionEnd=C.value.length,console.log("[DEBUG] appended editor to document.body at",{fixedLeft:v,fixedTop:w});};p?(()=>{try{if(p)p.appendChild(C);else throw Error("no container");}catch(e){console.warn("[DEBUG] append to container failed, will fallback to body",e),I();return;}a.current=C,C.focus(),C.selectionStart=C.selectionEnd=C.value.length,requestAnimationFrame(()=>{try{let e=C.getBoundingClientRect();0===e.width&&0===e.height&&(console.warn("[DEBUG] appended editor has zero size; falling back to body"),C.remove(),I());}catch(e){}});})():I();},ev=async(e,t,r,l,n,a)=>{if(!e.current||!r.current){S.default.warning("No perspective points defined.");return;}let i=r.current,o=[];for(let e=0;e<8;e+=2){let t=i[e],r=i[e+1];isNaN(t)||isNaN(r)||o.push([t,r]);}if(4!==o.length){S.default.error("Please select 4 corner points before applying perspective correction.");return;}try{let i=(e=>{let t=e.reduce((e,t)=>e+t[0],0)/e.length,r=e.reduce((e,t)=>e+t[1],0)/e.length,l=e.map(e=>({pt:e,angle:Math.atan2(e[1]-r,e[0]-t)})).sort((e,t)=>e.angle-t.angle).map(e=>e.pt),n=0;for(let e=0;e<l.length;e++){let[t,r]=l[e],[a,i]=l[(e+1)%l.length];n+=t*i-a*r;}n>0&&l.reverse();let a=0;for(let e=1;e<l.length;e++)(l[e][1]<l[a][1]||l[e][1]===l[a][1]&&l[e][0]<l[a][0])&&(a=e);return Array.from({length:l.length},(e,t)=>l[(a+t)%l.length]);})(o),s=[Math.round(i[0][0]),Math.round(i[0][1]),Math.round(i[1][0]),Math.round(i[1][1]),Math.round(i[2][0]),Math.round(i[2][1]),Math.round(i[3][0]),Math.round(i[3][1])],d=function(e,t,r,l){let n=D(r,l),a=n.getContext("2d"),i=e.getContext("2d").getImageData(0,0,e.width,e.height),o=a.createImageData(r,l),s=[[t[0],t[1]],[t[2],t[3]],[t[4],t[5]],[t[6],t[7]]],d=function(e,t){if(4!==e.length||4!==t.length)throw Error("computeHomography requires exactly 4 points for src and dst");let r=[];for(let l=0;l<4;l++){let[n,a]=e[l],[i,o]=t[l];r.push([-n,-a,-1,0,0,0,n*i,a*i,i]),r.push([0,0,0,-n,-a,-1,n*o,a*o,o]);}let l=[],n=[];for(let e=0;e<8;e++)l.push(r[e].slice(0,8)),n.push(-r[e][8]);let a=[...function(e,t){let r=t.length,l=e.map((e,r)=>[...e,t[r]]);for(let e=0;e<r;e++){let t=e;for(let n=e+1;n<r;n++)Math.abs(l[n][e])>Math.abs(l[t][e])&&(t=n);[l[e],l[t]]=[l[t],l[e]];for(let t=e+1;t<r;t++){let n=l[t][e]/l[e][e];for(let a=e;a<=r;a++)l[t][a]-=n*l[e][a];}}let n=Array(r).fill(0);for(let e=r-1;e>=0;e--){let t=l[e][r];for(let a=e+1;a<r;a++)t-=l[e][a]*n[a];n[e]=t/l[e][e];}return n;}(l,n),1];return[[a[0],a[1],a[2]],[a[3],a[4],a[5]],[a[6],a[7],a[8]]];}(s,[[0,0],[r,0],[r,l],[0,l]]);for(let t=0;t<l;t++)for(let l=0;l<r;l++){let[n,a]=function(e,t,r){let[[l,n,a],[i,o,s],[d,c,u]]=e,h=l*(o*u-s*c)-n*(i*u-s*d)+a*(i*c-o*d);if(1e-10>Math.abs(h))return[0,0];let f=[[(o*u-s*c)/h,(a*c-n*u)/h,(n*s-a*o)/h],[(s*d-i*u)/h,(l*u-a*d)/h,(a*i-l*s)/h],[(i*c-o*d)/h,(n*d-l*c)/h,(l*o-n*i)/h]],g=f[0][0]*t+f[0][1]*r+f[0][2],x=f[1][0]*t+f[1][1]*r+f[1][2],m=f[2][0]*t+f[2][1]*r+f[2][2];return[g/m,x/m];}(d,l,t);if(n>=0&&n<e.width&&a>=0&&a<e.height){let s=Math.floor(n),d=(Math.floor(a)*e.width+s)*4,c=(t*r+l)*4;o.data[c]=i.data[d],o.data[c+1]=i.data[d+1],o.data[c+2]=i.data[d+2],o.data[c+3]=i.data[d+3];}}return a.putImageData(o,0,0),n;}(e.current,s,e.current.width,e.current.height);e.current.width=d.width,e.current.height=d.height,t.current.width=d.width,t.current.height=d.height;let c=e.current.getContext("2d");c.clearRect(0,0,d.width,d.height),c.drawImage(d,0,0),l.push(e.current.toDataURL(),"Perspective corrected"),r.current=null,n(!1),a(),S.default.success("Perspective correction applied.");}catch(e){console.error("Perspective transform failed",e),S.default.error("Failed to apply perspective correction.");}},ew=async(e,t,r,l)=>{if(!e||t<=1)return e;let n=e,a=1;for(;a<t;){let e=Math.min(2,t/a),l=Math.max(1,Math.round(n.width*e)),i=Math.max(1,Math.round(n.height*e)),o=D(l,i),s=o.getContext("2d");s.imageSmoothingEnabled=!0,s.imageSmoothingQuality=r,s.clearRect(0,0,l,i),s.drawImage(n,0,0,n.width,n.height,0,0,l,i),n=o,a*=e,await new Promise(e=>setTimeout(e,0));}if(l&&(l.sharpen||l.edgeEnhancement||l.denoise)){let e=n.getContext("2d"),t=e.getImageData(0,0,n.width,n.height);if(l.denoise&&l.denoise>0){let e=l.denoise/100,r=L.gaussian5,n=Math.ceil(2*e);for(let e=0;e<n;e++)z(t,r,5);}if(l.edgeEnhancement&&l.edgeEnhancement>0){let e=l.edgeEnhancement/100;z(t,[0,-1*e,0,-1*e,1+4*e,-1*e,0,-1*e,0],3);}if(l.sharpen&&l.sharpen>0){let e=Math.ceil(3*(l.sharpen/100));for(let r=0;r<e;r++)z(t,L.sharpen,3);}e.putImageData(t,0,0);}return n;},ej=async(e,t,r,l,n,a,i,o,s)=>{if(e.current)try{let d=await ew(e.current,i,o,s);if(!d)return;let c=d.toDataURL(),u=new Image,h=t.current?t.current.style.display:"";t.current&&(t.current.style.display="none"),u.onload=()=>{try{let o=document.createElement("canvas");o.width=u.naturalWidth,o.height=u.naturalHeight,o.getContext("2d").drawImage(u,0,0);try{l(o);}catch(e){}e.current.width=o.width,e.current.height=o.height,t.current&&(t.current.width=o.width,t.current.height=o.height);let s=e.current.getContext("2d");s.clearRect(0,0,o.width,o.height),s.drawImage(u,0,0),r.push(e.current.toDataURL(),`Upscaled ${i}x`),n(e=>{if(!e[0])return e;let t=e.slice(),r={...t[0]};return r.img&&(r.img.src=c),r.rect={x:0,y:0,w:o.width,h:o.height},t[0]=r,t;}),t.current&&(t.current.style.display=h||""),a(),S.default.success(`Upscaled ${i}x`);}catch(e){console.error("Failed to finalize upscale draw",e),t.current&&(t.current.style.display=h||""),S.default.error("Upscale failed to render");}},u.onerror=e=>{t.current&&(t.current.style.display=h||""),console.error("Upscaled image failed to load",e),S.default.error("Upscaled image failed to load");},u.src=c;}catch(e){console.error("Upscale failed",e),S.default.error("Upscale failed");}},eb={blur:0,gaussian:0,sharpen:0,texture:0,clarity:0,bgThreshold:0,bgThresholdBlack:0,brightness:0,contrast:0,highlights:0,shadows:0,whites:0,blacks:0,vibrance:0,saturation:0,dehaze:0,hslAdjustments:{}},eC=null,ek=(e,t,{blur:r=0,gaussian:l=0,sharpen:n=0,bgThreshold:a=0,bgThresholdBlack:i=0,brightness:o=0,contrast:s=0,texture:d=0,clarity:c=0,highlights:u=0,shadows:h=0,whites:f=0,blacks:g=0,vibrance:x=0,saturation:m=0,dehaze:p=0,hslAdjustments:y={}},v,w)=>{if(!e.current||!t)return;let j=e.current.getContext("2d"),b=t.getContext("2d").getImageData(0,0,t.width,t.height);if(eC||(eC=b),!eC)return;let C=function(e){let t=new ImageData(e.width,e.height);return t.data.set(new Uint8ClampedArray(e.data)),t;}(b);if(0===r&&0===l&&0===n&&0===d&&0===c&&0===a&&0===i&&0===o&&0===s&&0===u&&0===h&&0===f&&0===g&&0===x&&0===m&&0===p&&0===Object.keys(y).length){j.putImageData(C,0,0),e.current&&w(eS(e.current));return;}if(r>0){let e=r%2==0?r+1:r;z(C,L.generateBoxBlurKernel(e),e);}if(l>0&&z(C,L.generateGaussianKernel(l),2*l+1),n>0&&z(C,L.sharpen.map(e=>5===e?1+4*n:-1===e?-n:e),3),0!==d){let e=d/100,t=-(2*e);z(C,[0,t,0,t,1+8*e,t,0,t,0],3);}if(0!==c){let e=c/100,t=-(2.5*e);z(C,[0,t,0,t,1+10*e,t,0,t,0],3);}if(a>0&&function(e,t=0){t=255-t;let r=e.data;for(let e=0;e<r.length;e+=4)r[e]>t&&r[e+1]>t&&r[e+2]>t&&(r[e+3]=0);}(C,a),i>0&&function(e,t=0){let r=e.data;for(let e=0;e<r.length;e+=4)r[e]<t&&r[e+1]<t&&r[e+2]<t&&(r[e+3]=0);}(C,i),(0!==o||0!==s)&&function(e,t=0,r=0){let l=e.data,n=r/100+1,a=128*(1-n);for(let e=0;e<l.length;e+=4)l[e]=Math.min(255,Math.max(0,l[e]*n+a+t)),l[e+1]=Math.min(255,Math.max(0,l[e+1]*n+a+t)),l[e+2]=Math.min(255,Math.max(0,l[e+2]*n+a+t));}(C,o,s),0!==u||0!==h||0!==f||0!==g||0!==x||0!==m||0!==p){let e=C.data;for(let t=0;t<e.length;t+=4)p&&B(e,t,p),(x||m)&&A(e,t,{vibrance:x,saturation:m});T(C,{highlights:u,shadows:h,whites:f,blacks:g,vibrance:x,saturation:m,clarity:c,dehaze:p});}Object.keys(y).length>0&&H(C,y),j.putImageData(C,0,0);let k=Object.entries({blur:r,gaussian:l,sharpen:n,texture:d,clarity:c,bgThreshold:a,bgThresholdBlack:i,brightness:o,contrast:s,highlights:u,shadows:h,whites:f,blacks:g,vibrance:x,saturation:m,dehaze:p,hslAdjustments:y}).filter(([e,t])=>eb[e]!==t);if(k.length>0){let t=k.map(([e,t])=>`${e}=${JSON.stringify(t)}`).join(", ");v.push(e.current.toDataURL(),`${t}`,!1),eb={blur:r,gaussian:l,sharpen:n,texture:d,clarity:c,bgThreshold:a,bgThresholdBlack:i,brightness:o,contrast:s,highlights:u,shadows:h,whites:f,blacks:g,vibrance:x,saturation:m,dehaze:p,hslAdjustments:y};}e.current&&w(eS(e.current));},eS=e=>{if(!e)return{red:Array(256).fill(0),green:Array(256).fill(0),blue:Array(256).fill(0)};let t=e.getContext("2d");if(!t)return{red:Array(256).fill(0),green:Array(256).fill(0),blue:Array(256).fill(0)};let{width:r,height:l}=e,{data:n}=t.getImageData(0,0,r,l),a=Array(256).fill(0),i=Array(256).fill(0),o=Array(256).fill(0);for(let e=0;e<n.length;e+=4)a[n[e]]++,i[n[e+1]]++,o[n[e+2]]++;return{red:a,green:i,blue:o};},eM=(e,t)=>{if(!e.current)return;let r=e.current,l=r.getContext("2d"),n=l.getImageData(0,0,r.width,r.height),a=n.data;for(let e=0;e<a.length;e+=4)a[e]=255-a[e],a[e+1]=255-a[e+1],a[e+2]=255-a[e+2];l.putImageData(n,0,0),t.push(r.toDataURL(),"Invert colors",!1);},eR=(e,t,r,l=!1,n=0)=>{let a=t.replace("#",""),i=parseInt(a.substring(0,2),16),o=parseInt(a.substring(2,4),16),s=parseInt(a.substring(4,6),16),d=new Uint8Array(e.length/4),c=Math.sqrt(195075),u=r/100,h=n/100;for(let t=0;t<e.length;t+=4){let r;let a=Math.sqrt(Math.pow(e[t]-i,2)+Math.pow(e[t+1]-o,2)+Math.pow(e[t+2]-s,2))/c;if(0===n)r=a<=u?0:1;else{let e=a-u;r=e<-h?0:e>h?1:(e+h)/(2*h);}l&&(r=1-r),d[t/4]=Math.round(255*r);}return d;},eI=(e,t,r,l="Apply Mask")=>{if(!e.current)return;let n=e.current,a=n.getContext("2d"),i=a.getImageData(0,0,n.width,n.height),o=i.data,s=t.getContext("2d").getImageData(0,0,t.width,t.height);for(let e=0;e<o.length;e+=4){let t=s.data[e];o[e+3]=t;}a.putImageData(i,0,0),r.push(n.toDataURL(),l,!1);},eE=({canvasRef:e,overlayRef:t,containerRef:r,offset:l,zoom:n,tool:i,currentCursor:o,hoverColor:s,resolution:d,onMouseDown:c,onMouseMove:u,onMouseUp:h})=>(0,a.jsxs)("div",{ref:r,onMouseDown:c,onMouseMove:u,onMouseUp:h,style:{width:"100%",height:"100vh",overflow:"hidden",border:"1px solid #eee",position:"relative",background:"#fafafa",cursor:o},children:[d&&(0,a.jsx)("div",{style:{position:"absolute",right:12,top:12,background:"rgba(0,0,0,0.6)",color:"#fff",padding:"4px 8px",borderRadius:4,fontSize:12,zIndex:99999,pointerEvents:"none"},children:d}),(0,a.jsxs)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden"},children:[(0,a.jsx)("canvas",{ref:e,style:{transform:`translate(${l.x}px, ${l.y}px) scale(${n})`,transformOrigin:"top left",display:"block"}}),(0,a.jsx)("canvas",{ref:t,style:{position:"absolute",left:0,top:0,pointerEvents:"none",transform:`translate(${l.x}px, ${l.y}px) scale(${n})`,transformOrigin:"top left"}})]}),s&&"color"===i&&(0,a.jsxs)("div",{style:{position:"fixed",left:s.x+12,top:s.y+12,background:"#fff",padding:"4px 8px",borderRadius:4,boxShadow:"0 0 6px rgba(0,0,0,0.2)",fontSize:12,zIndex:999999,pointerEvents:"none",display:"flex",alignItems:"center",gap:6},children:[(0,a.jsx)("span",{style:{display:"inline-block",width:12,height:12,background:s.color,border:"1px solid #ccc"}}),s.color]})]});var eD=r("649689e8"),ez=l._(eD),eL=r("c4e93e50"),eT=l._(eL),eB=r("4f331305"),eA=l._(eB),eP=r("a9a67fa4"),eW=l._(eP),eN=r("cb204712"),e_=l._(eN),eU=r("d62d811b"),eH=l._(eU),e$=r("d90c6c6d"),eO=l._(e$),eF=r("13afdc7a"),eK=l._(eF);let{Option:eG}=eA.default,eV=({open:e,onCancel:t,onApply:r,selectedColor:l,canvasRef:n})=>{var i;let[s,c]=(0,o.useState)(30),[u,h]=(0,o.useState)("normal"),[g,x]=(0,o.useState)(!1),[m,p]=(0,o.useState)(0),[y,v]=(0,o.useState)(l||"#000000");(0,o.useEffect)(()=>{l&&v(l);},[l]);let[w,j]=(0,o.useState)("remove"),[b,k]=(0,o.useState)(20),[S,M]=(0,o.useState)(1),[I,D]=(0,o.useState)("hard"),[z,L]=(0,o.useState)(!1),[T,B]=(0,o.useState)(null),A=(0,o.useRef)(null),P=(0,o.useRef)(null),W=(0,o.useRef)(null),N=(0,o.useRef)([]),_=(0,o.useRef)(!1),U=(0,o.useRef)(null),H=(0,o.useRef)(b),[$,O]=(0,o.useState)([]),[F,K]=(0,o.useState)(-1),[G,V]=(0,o.useState)(!1),X=(0,o.useRef)(null),Y=(0,o.useRef)(null),q=(0,o.useRef)(null),Z=(0,o.useRef)(null),J=[{title:"Color Removal Settings",description:"Adjust Tolerance and Feather to automatically remove the selected color.",target:()=>X.current},{title:"History",description:"Undo or Redo your changes.",target:()=>q.current},{title:"Manual Adjustments",description:"Use the brush to manually remove or keep areas. Note: Changing auto-settings resets manual edits.",target:()=>Y.current},{title:"Canvas",description:"Draw on the canvas to refine the mask. Use Alt + Drag to resize brush.",target:()=>Z.current}];(0,o.useEffect)(()=>{let e=A.current;if(!e)return;let t=e=>e.preventDefault();return e.addEventListener("contextmenu",t),()=>e.removeEventListener("contextmenu",t);},[]),(0,o.useEffect)(()=>{if(!e||!n.current||!y||!P.current)return;let t=n.current,r=P.current;(r.width!==t.width||r.height!==t.height)&&(r.width=t.width,r.height=t.height);let l=eR(t.getContext("2d").getImageData(0,0,t.width,t.height).data,y,s,g,m),a=r.getContext("2d"),i=a.createImageData(r.width,r.height);for(let e=0;e<l.length;e++){let t=l[e];i.data[4*e]=t,i.data[4*e+1]=t,i.data[4*e+2]=t,i.data[4*e+3]=255;}a.putImageData(i,0,0),O([a.getImageData(0,0,r.width,r.height)]),K(0),Q();},[e,s,g,m,y,n]);let Q=()=>{if(!n.current||!A.current||!P.current)return;let e=n.current,t=A.current,r=P.current;(t.width!==e.width||t.height!==e.height)&&(t.width=e.width,t.height=e.height);let l=t.getContext("2d");if("mask"===u)l.drawImage(r,0,0);else{let t=e.getContext("2d"),n=r.getContext("2d"),a=t.getImageData(0,0,e.width,e.height),i=n.getImageData(0,0,r.width,r.height),o=l.createImageData(e.width,e.height);for(let e=0;e<a.data.length;e+=4)o.data[e]=a.data[e],o.data[e+1]=a.data[e+1],o.data[e+2]=a.data[e+2],o.data[e+3]=i.data[e];l.putImageData(o,0,0);}ee();},ee=()=>{if(!W.current||!n.current)return;let e=W.current;(e.width!==n.current.width||e.height!==n.current.height)&&(e.width=n.current.width,e.height=n.current.height);let t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),T&&eg(t,T.x,T.y,b,"remove"===w?"#000000":"#ffffff",1);};(0,o.useEffect)(()=>{if(!e)return;let t=e=>{if((e.ctrlKey||e.metaKey)&&("z"===e.key||"Z"===e.key)){e.preventDefault(),e.shiftKey?el():er();return;}if((e.ctrlKey||e.metaKey)&&("y"===e.key||"Y"===e.key)){e.preventDefault(),el();return;}if("["===e.key){k(e=>Math.max(1,e-5));return;}if("]"===e.key){k(e=>Math.min(500,e+5));return;}("x"===e.key||"X"===e.key)&&j(e=>"remove"===e?"keep":"remove");};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t);},[e,F,$]);let et=()=>{if(!P.current)return;let e=P.current.getContext("2d").getImageData(0,0,P.current.width,P.current.height);O(t=>{let r=t.slice(0,F+1);return r.length>=20&&r.shift(),[...r,e];}),K(e=>Math.min(e+1,19));},er=()=>{if(F<=0||!P.current)return;let e=F-1,t=$[e];P.current.getContext("2d").putImageData(t,0,0),K(e),Q();},el=()=>{if(F>=$.length-1||!P.current)return;let e=F+1,t=$[e];P.current.getContext("2d").putImageData(t,0,0),K(e),Q();};return(0,a.jsx)(C.default,{title:(0,a.jsxs)(f.default,{children:["Remove Color",(0,a.jsx)(d.default,{type:"text",icon:(0,a.jsx)(E.default,{}),size:"small",onClick:()=>V(!0)})]}),open:e,onCancel:t,onOk:()=>{P.current&&r(P.current);},width:Math.min((null===(i=n.current)||void 0===i?void 0:i.width)?n.current.width+100:900,.95*window.innerWidth),okText:"Apply",cancelText:"Cancel",style:{top:20},maskClosable:!1,children:(0,a.jsxs)(f.default,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,a.jsxs)("div",{style:{display:"flex",gap:24,flexWrap:"wrap"},children:[(0,a.jsxs)("div",{style:{flex:1,minWidth:300},ref:X,children:[(0,a.jsx)("div",{style:{marginBottom:16},children:(0,a.jsxs)("div",{style:{marginBottom:8},children:[(0,a.jsx)("strong",{children:"Selected Color:"})," ",(0,a.jsx)(eH.default,{value:y,onChange:e=>v(e.toHexString()),showText:!0})]})}),(0,a.jsxs)("div",{style:{marginBottom:16},children:[(0,a.jsxs)("div",{style:{marginBottom:8},children:[(0,a.jsx)("strong",{children:"Tolerance:"})," ",s,"%"]}),(0,a.jsx)(ez.default,{min:0,max:100,value:s,onChange:c,tooltip:{formatter:e=>`${e}%`}})]}),(0,a.jsxs)("div",{style:{marginBottom:16},children:[(0,a.jsxs)("div",{style:{marginBottom:8},children:[(0,a.jsx)("strong",{children:"Feather:"})," ",m,"%"]}),(0,a.jsx)(ez.default,{min:0,max:50,value:m,onChange:p,tooltip:{formatter:e=>`${e}%`}})]}),(0,a.jsxs)(f.default,{size:"large",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsx)("strong",{children:"Invert:"})}),(0,a.jsxs)(eT.default.Group,{value:g,onChange:e=>x(e.target.value),children:[(0,a.jsx)(eT.default.Button,{value:!1,children:"Normal"}),(0,a.jsx)(eT.default.Button,{value:!0,children:"Inverted"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsx)("strong",{children:"Preview:"})}),(0,a.jsxs)(eT.default.Group,{value:u,onChange:e=>{h(e.target.value),setTimeout(Q,0);},children:[(0,a.jsx)(eT.default.Button,{value:"normal",children:"Normal"}),(0,a.jsx)(eT.default.Button,{value:"mask",children:"Mask"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsx)("strong",{children:"History:"})}),(0,a.jsxs)(f.default,{ref:q,children:[(0,a.jsx)(e_.default,{title:"Undo",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(eO.default,{}),onClick:er,disabled:F<=0})}),(0,a.jsx)(e_.default,{title:"Redo",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(eK.default,{}),onClick:el,disabled:F>=$.length-1})})]})]})]})]}),(0,a.jsxs)("div",{style:{flex:1,minWidth:300,borderLeft:"1px solid #eee",paddingLeft:24},ref:Y,children:[(0,a.jsx)("div",{style:{marginBottom:16,fontWeight:"bold"},children:"Manual Adjustments (Brush)"}),(0,a.jsxs)(f.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)(f.default,{wrap:!0,children:[(0,a.jsxs)(eT.default.Group,{value:w,onChange:e=>j(e.target.value),buttonStyle:"solid",children:[(0,a.jsx)(eT.default.Button,{value:"remove",children:"Remove (Black)"}),(0,a.jsx)(eT.default.Button,{value:"keep",children:"Keep (White)"})]}),(0,a.jsx)("span",{style:{fontSize:12,color:"#666"},children:"Press 'X' to toggle"})]}),(0,a.jsxs)(f.default,{wrap:!0,align:"center",children:[(0,a.jsx)("span",{children:"Type:"}),(0,a.jsxs)(eA.default,{value:I,onChange:e=>D(e),style:{width:80},children:[(0,a.jsx)(eG,{value:"hard",children:"Hard"}),(0,a.jsx)(eG,{value:"soft",children:"Soft"})]}),(0,a.jsx)("span",{children:"Size:"}),(0,a.jsx)(eW.default,{min:1,max:500,value:b,onChange:e=>k(e||1),style:{width:70}}),(0,a.jsx)("span",{children:"Opacity:"}),(0,a.jsx)(ez.default,{min:0,max:1,step:.01,value:S,onChange:M,style:{width:80}})]}),(0,a.jsx)("div",{style:{fontSize:12,color:"#666"},children:"Note: Changing Tolerance/Feather will reset manual brush edits."})]})]})]}),(0,a.jsx)("div",{ref:Z,style:{maxHeight:"60vh",overflow:"auto",border:"1px solid #d9d9d9",borderRadius:4,padding:8,position:"relative",backgroundImage:"normal"===u?`linear-gradient(45deg, #ccc 25%, transparent 25%),
                   linear-gradient(-45deg, #ccc 25%, transparent 25%),
                   linear-gradient(45deg, transparent 75%, #ccc 75%),
                   linear-gradient(-45deg, transparent 75%, #ccc 75%)`:"none",backgroundSize:"normal"===u?"20px 20px":"auto",backgroundPosition:"normal"===u?"0 0, 0 10px, 10px -10px, -10px 0px":"auto",backgroundColor:"mask"===u?"#808080":"#fff"},children:(0,a.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,a.jsx)("canvas",{ref:P,style:{display:"none"}}),(0,a.jsx)("canvas",{ref:A,style:{maxWidth:"100%",height:"auto",display:"block",imageRendering:"pixelated",cursor:"none"},onMouseDown:e=>{if(!P.current)return;let t=ex(e,A,1);if(t){if(e.altKey){e.preventDefault(),e.stopPropagation(),_.current=!0,U.current=e.clientX,H.current=b;let t=e=>{if(!_.current||null===U.current)return;let t=e.clientX-U.current;k(Math.round(Math.max(1,Math.min(500,H.current+.5*t))));},r=()=>{_.current=!1,U.current=null,window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",r);};window.addEventListener("mousemove",t),window.addEventListener("mouseup",r);return;}L(!0),N.current=[t],ef(P.current.getContext("2d"),[t,t],{color:"remove"===w?"#000000":"#ffffff",lineWidth:b,opacity:S,flow:1,type:I}),Q();}},onMouseMove:e=>{if(!P.current)return;let t=ex(e,A,1);if(!t)return;if(B(t),!z){ee();return;}N.current.push(t);let r=P.current.getContext("2d"),l=N.current;l.length>=2&&(ef(r,l.slice(-2),{color:"remove"===w?"#000000":"#ffffff",lineWidth:b,opacity:S,flow:1,type:I}),Q());},onMouseUp:()=>{z&&et(),L(!1),N.current=[];},onMouseLeave:()=>{_.current||(B(null),L(!1),ee());}}),(0,a.jsx)("canvas",{ref:W,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",imageRendering:"pixelated"}})]})}),(0,a.jsx)(R.default,{open:G,onClose:()=>V(!1),steps:J})]})});};var eX=r("c9122736"),eY=l._(eX);let{Option:eq}=eA.default,eZ=({open:e,onCancel:t,onApply:r,sourceCanvas:l,existingMask:n})=>{let i=(0,o.useRef)(null),s=(0,o.useRef)(null),c=(0,o.useRef)(null),[u,h]=(0,o.useState)([]),[g,x]=(0,o.useState)(-1),[m,p]=(0,o.useState)("remove"),[y,v]=(0,o.useState)(20),[w,j]=(0,o.useState)(1),[b,k]=(0,o.useState)("hard"),[S,M]=(0,o.useState)("normal"),[I,D]=(0,o.useState)(!1),z=(0,o.useRef)([]),[L,T]=(0,o.useState)(null),[B,A]=(0,o.useState)(!1),[P,W]=(0,o.useState)(null);(0,o.useRef)(null);let N=(0,o.useRef)(!1),_=(0,o.useRef)(null),U=(0,o.useRef)(y),[H,$]=(0,o.useState)(!1),[O,F]=(0,o.useState)(!1),K=(0,o.useRef)(null),G=(0,o.useRef)(null),V=(0,o.useRef)(null),X=(0,o.useRef)(null);(0,o.useRef)(null);let Y=(0,o.useRef)(null),q=[{title:"Tool Selection",description:"Choose between the Brush Tool for manual masking or Color Removal for auto-masking.",target:()=>K.current},{title:"Preview Mode",description:"Switch between Normal view (result) and Mask view (black & white mask).",target:()=>G.current},{title:"History",description:"Undo or Redo your changes.",target:()=>V.current},{title:"Tool Controls",description:"Adjust settings for the Brush (Size, Opacity, Type).",target:()=>X.current},{title:"Canvas",description:"Draw on the canvas to mask areas. Use Alt + Drag to resize brush.",target:()=>Y.current}];(0,o.useEffect)(()=>{let e=s.current;if(!e)return;let t=e=>e.preventDefault();return e.addEventListener("contextmenu",t),()=>e.removeEventListener("contextmenu",t);},[]);let Z=()=>{if(!i.current)return;let e=i.current.getContext("2d").getImageData(0,0,i.current.width,i.current.height);h(t=>{let r=t.slice(0,g+1);return r.length>=20&&r.shift(),[...r,e];}),x(e=>Math.min(e+1,19));},J=()=>{if(g<=0||!i.current)return;let e=g-1,t=u[e];i.current.getContext("2d").putImageData(t,0,0),x(e),ee();},Q=()=>{if(g>=u.length-1||!i.current)return;let e=g+1,t=u[e];i.current.getContext("2d").putImageData(t,0,0),x(e),ee();};(0,o.useEffect)(()=>{if(!e||!l||!i.current)return;let t=i.current;t.width=l.width,t.height=l.height;let r=t.getContext("2d");n?r.drawImage(n,0,0):(r.fillStyle="#ffffff",r.fillRect(0,0,t.width,t.height)),h([r.getImageData(0,0,t.width,t.height)]),x(0),ee();},[e,l,n]);let ee=()=>{if(!i.current||!s.current||!l)return;let e=i.current,t=s.current;t.width=l.width,t.height=l.height;let r=t.getContext("2d");if("mask"===S)r.drawImage(e,0,0);else{let t=l.getContext("2d"),n=e.getContext("2d"),a=t.getImageData(0,0,l.width,l.height),i=n.getImageData(0,0,e.width,e.height),o=r.createImageData(l.width,l.height);for(let e=0;e<a.data.length;e+=4)o.data[e]=a.data[e],o.data[e+1]=a.data[e+1],o.data[e+2]=a.data[e+2],o.data[e+3]=i.data[e];r.putImageData(o,0,0);}et();},et=()=>{if(!c.current||!i.current)return;let e=c.current,t=e.getContext("2d");if(t.clearRect(0,0,e.width,e.height),L){if(H)t.save(),t.strokeStyle="#00aaff",t.lineWidth=2,t.beginPath(),t.arc(L.x,L.y,8,0,2*Math.PI),t.stroke(),t.restore();else{let e="remove"===m?"#000000":"#ffffff";eg(t,L.x,L.y,y,e,1);}}};return(0,o.useEffect)(()=>{if(!e)return;let t=e=>{if((e.ctrlKey||e.metaKey)&&("z"===e.key||"Z"===e.key)){e.preventDefault(),e.shiftKey?Q():J();return;}if((e.ctrlKey||e.metaKey)&&("y"===e.key||"Y"===e.key)){e.preventDefault(),Q();return;}if("["===e.key){v(e=>Math.max(1,e-5));return;}if("]"===e.key){v(e=>Math.min(500,e+5));return;}("x"===e.key||"X"===e.key)&&p(e=>"remove"===e?"keep":"remove"),(e.ctrlKey||e.metaKey)&&$(!0);},r=e=>{e.ctrlKey||e.metaKey||$(!1);};return window.addEventListener("keydown",t),window.addEventListener("keyup",r),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",r);};},[e,g,u]),(0,o.useEffect)(()=>{et();},[L,y,m,H]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.default,{title:(0,a.jsxs)(f.default,{children:["Layer Mask Editor",(0,a.jsx)(d.default,{type:"text",icon:(0,a.jsx)(E.default,{}),size:"small",onClick:()=>F(!0)})]}),open:e,onCancel:t,onOk:()=>{i.current&&r(i.current);},width:Math.min((null==l?void 0:l.width)?l.width+400:900,.95*window.innerWidth),style:{top:20},okText:"Apply Mask",cancelText:"Cancel",maskClosable:!1,children:(0,a.jsxs)(f.default,{direction:"vertical",style:{width:"100%"},size:"middle",children:[(0,a.jsxs)(f.default,{wrap:!0,ref:K,children:[(0,a.jsx)(d.default,{icon:(0,a.jsx)(eY.default,{}),onClick:()=>A(!0),children:"Color Removal"}),(0,a.jsxs)(eT.default.Group,{value:S,onChange:e=>{M(e.target.value),ee();},children:[(0,a.jsx)(eT.default.Button,{value:"normal",children:"Normal"}),(0,a.jsx)(eT.default.Button,{value:"mask",children:"Mask View"})]}),(0,a.jsx)(d.default,{onClick:()=>{if(!i.current)return;let e=i.current.getContext("2d");e.fillStyle="#ffffff",e.fillRect(0,0,i.current.width,i.current.height),ee(),Z();},children:"Clear Mask"}),(0,a.jsx)(d.default,{onClick:()=>{if(!i.current)return;let e=i.current.getContext("2d"),t=e.getImageData(0,0,i.current.width,i.current.height),r=t.data;for(let e=0;e<r.length;e+=4)r[e]=255-r[e],r[e+1]=255-r[e+1],r[e+2]=255-r[e+2];e.putImageData(t,0,0),ee(),Z();},children:"Invert Mask"}),(0,a.jsx)(e_.default,{title:"Undo",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(eO.default,{}),onClick:J,disabled:g<=0})}),(0,a.jsx)(e_.default,{title:"Redo",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(eK.default,{}),onClick:Q,disabled:g>=u.length-1})})]}),(0,a.jsxs)(f.default,{direction:"vertical",style:{width:"100%"},ref:X,children:[(0,a.jsxs)(f.default,{wrap:!0,children:[(0,a.jsxs)(eT.default.Group,{value:m,onChange:e=>p(e.target.value),buttonStyle:"solid",children:[(0,a.jsx)(eT.default.Button,{value:"remove",children:"Remove (Black)"}),(0,a.jsx)(eT.default.Button,{value:"keep",children:"Keep (White)"})]}),(0,a.jsx)("span",{style:{fontSize:12,color:"#666"},children:"Press 'X' to toggle"})]}),(0,a.jsxs)(f.default,{wrap:!0,align:"center",children:[(0,a.jsx)("span",{children:"Brush Type:"}),(0,a.jsxs)(eA.default,{value:b,onChange:e=>k(e),style:{width:100},children:[(0,a.jsx)(eq,{value:"hard",children:"Hard"}),(0,a.jsx)(eq,{value:"soft",children:"Soft"})]}),(0,a.jsx)("span",{children:"Size:"}),(0,a.jsx)(eW.default,{min:1,max:500,value:y,onChange:e=>v(e||1),style:{width:80}}),(0,a.jsx)(e_.default,{title:"Alt + Drag to resize",children:(0,a.jsx)("span",{style:{fontSize:12,color:"#666"},children:"Alt+Drag"})}),(0,a.jsx)("span",{children:"Opacity:"}),(0,a.jsx)(ez.default,{min:0,max:1,step:.01,value:w,onChange:j,style:{width:100}}),(0,a.jsxs)("span",{children:[Math.round(100*w),"%"]})]})]}),(0,a.jsx)("div",{ref:Y,style:{maxHeight:"60vh",overflow:"auto",border:"1px solid #d9d9d9",borderRadius:4,padding:8,position:"relative",backgroundImage:"normal"===S?`linear-gradient(45deg, #ccc 25%, transparent 25%),
                   linear-gradient(-45deg, #ccc 25%, transparent 25%),
                   linear-gradient(45deg, transparent 75%, #ccc 75%),
                   linear-gradient(-45deg, transparent 75%, #ccc 75%)`:"none",backgroundSize:"normal"===S?"20px 20px":"auto",backgroundPosition:"normal"===S?"0 0, 0 10px, 10px -10px, -10px 0px":"auto",backgroundColor:"mask"===S?"#808080":"#fff"},children:(0,a.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,a.jsx)("canvas",{ref:i,style:{display:"none"}}),(0,a.jsx)("canvas",{ref:s,style:{maxWidth:"100%",height:"auto",display:"block",imageRendering:"pixelated"},onMouseDown:e=>{if(!i.current)return;let t=ex(e,s,1);if(t){if(e.altKey){e.preventDefault(),N.current=!0,_.current=e.clientX,U.current=y;let t=e=>{if(!N.current||null===_.current)return;let t=e.clientX-_.current;v(Math.round(Math.max(1,Math.min(500,U.current+.5*t))));},r=()=>{N.current=!1,_.current=null,window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",r);};window.addEventListener("mousemove",t),window.addEventListener("mouseup",r);return;}if(e.ctrlKey||e.metaKey){let e=em(l,t.x,t.y);e&&(W(e),A(!0));return;}D(!0),z.current=[t],ef(i.current.getContext("2d"),[t,t],{color:"remove"===m?"#000000":"#ffffff",lineWidth:y,opacity:w,flow:1,type:b}),ee();}},onMouseMove:e=>{if(!i.current)return;let t=ex(e,s,1);if(!t)return;if(T(t),!I){et();return;}z.current.push(t);let r=i.current.getContext("2d"),l="remove"===m?"#000000":"#ffffff",n=z.current;n.length>=2&&(ef(r,n.slice(-2),{color:l,lineWidth:y,opacity:w,flow:1,type:b}),ee());},onMouseUp:()=>{I&&Z(),D(!1),z.current=[];},onMouseLeave:()=>{N.current||(T(null),D(!1),et());}}),(0,a.jsx)("canvas",{ref:c,width:(null==l?void 0:l.width)||0,height:(null==l?void 0:l.height)||0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",imageRendering:"pixelated"}})]})}),(0,a.jsxs)("div",{style:{fontSize:12,color:"#666",marginTop:8},children:[(0,a.jsx)("strong",{children:"Instructions:"}),(0,a.jsxs)("ul",{style:{margin:"4px 0",paddingLeft:20},children:[(0,a.jsx)("li",{children:"Paint to remove or keep areas (toggle with 'X' key)"}),(0,a.jsx)("li",{children:"Black areas = removed, White areas = kept"}),(0,a.jsx)("li",{children:"Alt + Drag to resize brush"}),(0,a.jsx)("li",{children:"Ctrl/Cmd + Click to pick color and open Color Removal tool"}),(0,a.jsx)("li",{children:"Use Color Removal button to open advanced color removal options"})]})]}),(0,a.jsx)(R.default,{open:O,onClose:()=>F(!1),steps:q})]})}),l&&(0,a.jsx)(eV,{open:B,onCancel:()=>{A(!1),W(null);},onApply:e=>{if(!i.current)return;let t=i.current,r=t.getContext("2d"),l=r.getImageData(0,0,t.width,t.height),n=e.getContext("2d").getImageData(0,0,e.width,e.height);for(let e=0;e<l.data.length;e+=4){let t=Math.round(l.data[e]/255*(n.data[e]/255)*255);l.data[e]=t,l.data[e+1]=t,l.data[e+2]=t,l.data[e+3]=255;}r.putImageData(l,0,0),ee(),A(!1),Z();},selectedColor:P,canvasRef:{current:l}})]});};var eJ=r("00798b85"),eQ=l._(eJ);let e0=({label:e,value:t,min:r,max:l,gradient:n,onChange:i,onChangeComplete:o})=>(0,a.jsxs)("div",{className:"custom-slider-container",children:[(0,a.jsxs)("div",{style:{width:"100%"},children:[(0,a.jsx)("span",{className:"custom-label",children:e}),(0,a.jsx)(eW.default,{min:r,max:l,value:t,onChange:e=>i(Number(e)),onBlur:()=>null==o?void 0:o(),className:"custom-number",size:"small"})]}),(0,a.jsx)(ez.default,{min:r,max:l,value:t,onChange:i,onChangeComplete:o,className:"custom-slider",style:{"--custom-slider-gradient":n},handleStyle:{opacity:1}})]}),{Panel:e1}=eQ.default,e2=({open:e,onCancel:t,onApply:r,layer:l})=>{let n=(0,o.useRef)(null),i=(0,o.useRef)(null),[s,c]=(0,o.useState)(0),[u,h]=(0,o.useState)(0),[g,x]=(0,o.useState)(0),[m,p]=(0,o.useState)(0),[y,v]=(0,o.useState)(0),[w,j]=(0,o.useState)(0),[b,k]=(0,o.useState)(0),[S,M]=(0,o.useState)(0),[I,D]=(0,o.useState)(0),[z,L]=(0,o.useState)(0),[T,B]=(0,o.useState)(0),[A,P]=(0,o.useState)(0),[W,N]=(0,o.useState)(0),[_,U]=(0,o.useState)(0),[H,$]=(0,o.useState)(0),[O,F]=(0,o.useState)(0),[K,G]=(0,o.useState)(!1),V=(0,o.useRef)(null),X=(0,o.useRef)(null),Y=[{title:"Effect Controls",description:"Adjust various image properties like Brightness, Contrast, Blur, etc.",target:()=>V.current},{title:"Preview",description:"See the changes in real-time.",target:()=>X.current}];(0,o.useEffect)(()=>{if(!e||!(null==l?void 0:l.img)||!n.current||!i.current)return;let t=n.current,r=i.current,a=l.img;t.width=a.width,t.height=a.height,r.width=a.width,r.height=a.height;let o=t.getContext("2d"),s=r.getContext("2d");o.drawImage(a,0,0),s.drawImage(a,0,0),c(0),h(0),x(0),p(0),v(0),j(0),k(0),M(0),D(0),L(0),B(0),P(0),N(0),U(0),$(0),F(0);},[e,l]),(0,o.useEffect)(()=>{e&&n.current&&i.current&&ek(n,i.current,{blur:g,gaussian:m,sharpen:y,texture:w,clarity:b,bgThreshold:H,bgThresholdBlack:O,brightness:s,contrast:u,highlights:S,shadows:I,whites:z,blacks:T,vibrance:A,saturation:W,dehaze:_,hslAdjustments:{}},{push:()=>{}},()=>{});},[e,g,m,y,w,b,H,O,s,u,S,I,z,T,A,W,_]);let q=({label:e,value:t,onChange:r,min:l=-100,max:n=100})=>(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsx)(e0,{label:e,value:t,min:l,max:n,onChange:r})});return(0,a.jsxs)(C.default,{title:(0,a.jsxs)(f.default,{children:["Layer Effects",(0,a.jsx)(d.default,{type:"text",icon:(0,a.jsx)(E.default,{}),size:"small",onClick:()=>G(!0)})]}),open:e,onCancel:t,onOk:()=>{if(!n.current)return;let e=new Image;e.src=n.current.toDataURL(),e.onload=()=>{r(e);};},width:900,okText:"Apply Effects",style:{top:20},maskClosable:!1,children:[(0,a.jsxs)("div",{style:{display:"flex",gap:24,height:"60vh"},children:[(0,a.jsx)("div",{ref:V,style:{width:300,overflowY:"auto",paddingRight:8},children:(0,a.jsxs)(eQ.default,{defaultActiveKey:["1","2"],ghost:!0,size:"small",children:[(0,a.jsxs)(e1,{header:"Light & Color",children:[(0,a.jsx)(q,{label:"Brightness",value:s,onChange:c}),(0,a.jsx)(q,{label:"Contrast",value:u,onChange:h}),(0,a.jsx)(q,{label:"Highlights",value:S,onChange:M}),(0,a.jsx)(q,{label:"Shadows",value:I,onChange:D}),(0,a.jsx)(q,{label:"Whites",value:z,onChange:L}),(0,a.jsx)(q,{label:"Blacks",value:T,onChange:B}),(0,a.jsx)(q,{label:"Vibrance",value:A,onChange:P}),(0,a.jsx)(q,{label:"Saturation",value:W,onChange:N})]},"1"),(0,a.jsxs)(e1,{header:"Detail & Effects",children:[(0,a.jsx)(q,{label:"Texture",value:w,onChange:j}),(0,a.jsx)(q,{label:"Clarity",value:b,onChange:k}),(0,a.jsx)(q,{label:"Dehaze",value:_,onChange:U}),(0,a.jsx)(q,{label:"Sharpen",value:y,onChange:v,min:0,max:5}),(0,a.jsx)(q,{label:"Blur",value:g,onChange:x,min:0,max:25}),(0,a.jsx)(q,{label:"Gaussian",value:m,onChange:p,min:0,max:20})]},"2"),(0,a.jsxs)(e1,{header:"Remove Background",children:[(0,a.jsx)(q,{label:"Remove White",value:H,onChange:$,min:0,max:255}),(0,a.jsx)(q,{label:"Remove Black",value:O,onChange:F,min:0,max:255})]},"3")]})}),(0,a.jsxs)("div",{ref:X,style:{flex:1,background:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #ddd",borderRadius:4,overflow:"hidden",backgroundImage:`linear-gradient(45deg, #ccc 25%, transparent 25%),
            linear-gradient(-45deg, #ccc 25%, transparent 25%),
            linear-gradient(45deg, transparent 75%, #ccc 75%),
            linear-gradient(-45deg, transparent 75%, #ccc 75%)`,backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px"},children:[(0,a.jsx)("canvas",{ref:n,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}}),(0,a.jsx)("canvas",{ref:i,style:{display:"none"}})]})]}),(0,a.jsx)(R.default,{open:K,onClose:()=>G(!1),steps:Y})]});};var e5=r("2ac36d38"),e8=l._(e5),e4=r("a41070f7"),e6=l._(e4),e3=r("8fb0e3f9"),e9=l._(e3),e7=o.forwardRef(function(e,t){return o.createElement(e9.default,(0,e8.default)((0,e8.default)({},e),{},{ref:t,icon:e6.default}));}),te=r("a12e4141"),tt=l._(te),tr=r("65094f81"),tl=l._(tr),tn=r("46433e8f"),ta=l._(tn),ti=r("2b5b5e7f"),to=l._(ti),ts=r("4f4539af"),td=l._(ts),tc=r("674a8f9a"),tu=l._(tc),th=r("16137db5"),tf=l._(th),tg={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 476H548V144h-72v332H152c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h324v332h72V548h324c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-166h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 498h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-664h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 498h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM650 216h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm56 592h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-332 0h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-56-592h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-166 0h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm56 592h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-56-426h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm56 260h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"border-inner",theme:"outlined"},tx=o.forwardRef(function(e,t){return o.createElement(e9.default,(0,e8.default)((0,e8.default)({},e),{},{ref:t,icon:tg}));}),tm={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M145.71 752c2 0 4-.2 5.98-.5L319.9 722c1.99-.4 3.88-1.3 5.28-2.8l423.91-423.87a9.93 9.93 0 000-14.06L582.88 114.9C581 113 578.5 112 575.82 112s-5.18 1-7.08 2.9L144.82 538.76c-1.5 1.5-2.4 3.29-2.8 5.28l-29.5 168.17a33.59 33.59 0 009.37 29.81c6.58 6.48 14.95 9.97 23.82 9.97m51.75-85.43l15.65-88.92 362.7-362.67 73.28 73.27-362.7 362.67zm401.37-98.64c27.69-14.81 57.29-20.85 85.54-15.52 32.37 6.1 59.72 26.53 78.96 59.4 29.97 51.22 21.64 102.34-18.48 144.26-17.58 18.36-41.07 35.01-70 50.3l-.3.15.86.26a147.88 147.88 0 0041.54 6.2l1.17.01c61.07 0 100.98-22.1 125.28-67.87a36 36 0 0163.6 33.76C869.7 849.1 804.9 885 718.12 885c-47.69 0-91.94-15.03-128.19-41.36l-1.05-.78-1.36.47c-46.18 16-98.74 29.95-155.37 41.94l-2.24.47a1931.1 1931.1 0 01-139.16 23.96 36 36 0 11-9.5-71.38 1860.1 1860.1 0 00133.84-23.04c42.8-9 83-19.13 119.35-30.34l.24-.08-.44-.69c-16.46-26.45-25.86-55.43-26.14-83.24v-1.3c0-49.9 39.55-104.32 90.73-131.7M671 623.17c-10.74-2.03-24.1.7-38.22 8.26-29.55 15.8-52.7 47.64-52.7 68.2 0 18.2 8.9 40.14 24.71 59.73l.24.3 1.22-.52c39.17-16.58 68.49-34.27 85.93-52.18l.64-.67c18.74-19.57 21.39-35.84 8.36-58.1-9.06-15.47-19.03-22.92-30.18-25.02"}}]},name:"signature",theme:"outlined"},tp=o.forwardRef(function(e,t){return o.createElement(e9.default,(0,e8.default)((0,e8.default)({},e),{},{ref:t,icon:tm}));}),ty=r("2bd79d86"),tv=l._(ty),tw=r("0605432d"),tj=l._(tw),tb=r("f9cbb0db"),tC=l._(tb),tk=r("376ce0b3"),tS=l._(tk),tM=r("235f33b8"),tR=l._(tM);let tI=({canvasRef:e,redData:t,greenData:r,blueData:l})=>{let n=(0,o.useMemo)(()=>({chart:{backgroundColor:"#2b2b2b",height:120,spacing:[5,5,5,5]},title:{text:""},xAxis:{title:{text:"",style:{color:"#fff"}},labels:{style:{color:"#fff",fontSize:"5px"}},gridLineColor:"rgba(255,255,255,0.1)"},yAxis:{title:{text:"",style:{color:"#fff"}},labels:{style:{color:"#fff",fontSize:"5px"}},gridLineColor:"rgba(255,255,255,0.1)"},legend:{enabled:!1},plotOptions:{histogram:{binWidth:4},series:{animation:!1,marker:{enabled:!1}}},series:[{name:"Red",data:t,color:"#ff4444",zIndex:3,lineWidth:1,marker:{radius:1}},{name:"Green",data:r,color:"#44ff44",zIndex:2,lineWidth:1,marker:{radius:1}},{name:"Blue",data:l,color:"#4444ff",zIndex:1,lineWidth:1,marker:{radius:1}}],credits:{enabled:!1},tooltip:{enabled:!1}}),[t,r,l]);return(0,a.jsx)(tR.default,{highcharts:tS.default,options:n});},tE=({open:e,onCancel:t,onOk:r,upscaleFactor:l,setUpscaleFactor:n,presetLocal:i,setPresetLocal:o,sharpenAmount:s,setSharpenAmount:d,edgeEnhancement:c,setEdgeEnhancement:u,denoiseAmount:h,setDenoiseAmount:f})=>(0,a.jsx)(C.default,{title:"Custom Upscale",open:e,onCancel:t,onOk:r,okText:"Upscale",width:500,maskClosable:!1,children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[(0,a.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[(0,a.jsxs)("div",{style:{minWidth:120},children:[(0,a.jsx)("div",{children:"Multiplier"}),(0,a.jsx)(eW.default,{min:1,max:8,step:.1,value:l,onChange:e=>n(Number(e||1))})]}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)("div",{children:"Smoothing Quality"}),(0,a.jsx)("div",{style:{marginTop:8},children:(0,a.jsx)(eT.default.Group,{value:i,onChange:e=>o(e.target.value),options:[{label:"Low",value:"low"},{label:"Medium",value:"medium"},{label:"High",value:"high"}],optionType:"button",buttonStyle:"solid"})})]})]}),(0,a.jsxs)("div",{style:{borderTop:"1px solid #f0f0f0",paddingTop:12},children:[(0,a.jsx)("div",{style:{marginBottom:8,fontWeight:500},children:"Quality Enhancements"}),(0,a.jsxs)("div",{style:{marginBottom:12},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[(0,a.jsx)("span",{children:"Sharpen"}),(0,a.jsxs)("span",{children:[s,"%"]})]}),(0,a.jsx)(ez.default,{min:0,max:100,value:s,onChange:d,tooltip:{formatter:e=>`${e}%`}})]}),(0,a.jsxs)("div",{style:{marginBottom:12},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[(0,a.jsx)("span",{children:"Edge Enhancement"}),(0,a.jsxs)("span",{children:[c,"%"]})]}),(0,a.jsx)(ez.default,{min:0,max:100,value:c,onChange:u,tooltip:{formatter:e=>`${e}%`}})]}),(0,a.jsxs)("div",{style:{marginBottom:12},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[(0,a.jsx)("span",{children:"Denoise"}),(0,a.jsxs)("span",{children:[h,"%"]})]}),(0,a.jsx)(ez.default,{min:0,max:100,value:h,onChange:f,tooltip:{formatter:e=>`${e}%`}})]})]})]})});var tD=r("25896c82"),tz=l._(tD),tL=r("05c9ca64"),tT=l._(tL),tB=r("339facb1"),tA=l._(tB),tP=r("94e78bcf"),tW=l._(tP),tN=r("e700fe15"),t_=l._(tN),tU=r("1d2482ba"),tH=l._(tU),t$=r("d4f20bc1"),tO=l._(t$),tF=o.forwardRef(function(e,t){return o.createElement(e9.default,(0,e8.default)((0,e8.default)({},e),{},{ref:t,icon:tO.default}));}),tK=r("434db6d0");let tG=({open:e,onCancel:t,onExportImage:r,onExportSvg:l,canvasRef:n,processing:i,svgContent:s,scale:c,setScale:u,ltres:h,setLtres:g,qtres:x,setQtres:m,pathomit:p,setPathomit:y,colorsampling:v,setColorsampling:w,strokewidth:j,setStrokewidth:b,onDownload:k,getSvgModalWidth:S,getSvgModalHeight:M})=>{let[R,I]=(0,o.useState)("image"),[E,D]=(0,o.useState)("png"),[z,L]=(0,o.useState)(!0),T=s?btoa(unescape(encodeURIComponent(s))):"",B=s?`data:image/svg+xml;base64,${T}`:"";return(0,a.jsx)(C.default,{title:"Export Options",open:e,onCancel:t,onOk:()=>{"image"===R?(r(E,z),t()):l();},okText:"image"===R?"Export":"Convert to SVG",okButtonProps:{loading:i&&"svg"===R},width:"svg"===R&&s?S():500,style:"svg"===R&&s?{height:M()}:void 0,children:(0,a.jsxs)(f.default,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:12,fontWeight:500},children:"Export Format"}),(0,a.jsxs)(eT.default.Group,{value:R,onChange:e=>I(e.target.value),buttonStyle:"solid",children:[(0,a.jsx)(eT.default.Button,{value:"image",children:"Image (PNG/JPG)"}),(0,a.jsx)(eT.default.Button,{value:"svg",children:"SVG"})]})]}),(0,a.jsx)(tW.default,{style:{margin:"8px 0"}}),"image"===R&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:12,fontWeight:500},children:"Image Options"}),(0,a.jsxs)(f.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)(eT.default.Group,{value:E,onChange:e=>D(e.target.value),buttonStyle:"solid",children:[(0,a.jsx)(eT.default.Button,{value:"png",children:"PNG"}),(0,a.jsx)(eT.default.Button,{value:"jpg",children:"JPG"})]}),(0,a.jsx)(tz.default,{checked:z,onChange:e=>L(e.target.checked),children:"Include overlay layers"}),(0,a.jsx)("div",{style:{fontSize:12,color:"#666",marginLeft:24,marginTop:-8},children:z?"Export will include all visible layers and text overlays":"Export will only include the base image without layers"})]})]}),"svg"===R&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:12,fontWeight:500},children:"SVG Tracing Options"}),(0,a.jsxs)(f.default,{wrap:!0,size:"small",children:[(0,a.jsx)(e_.default,{title:"Scale factor for the SVG output. Higher = larger SVG.",children:(0,a.jsxs)(f.default,{size:4,children:[(0,a.jsx)("label",{children:"Scale"}),(0,a.jsx)(t_.default,{style:{fontSize:12,color:"#999"}}),(0,a.jsx)(eW.default,{size:"small",min:.1,step:.1,value:c,onChange:e=>u(e||1),style:{width:70}})]})}),(0,a.jsx)(e_.default,{title:"Error threshold for line detection. Lower = more precise lines.",children:(0,a.jsxs)(f.default,{size:4,children:[(0,a.jsx)("label",{children:"ltres"}),(0,a.jsx)(t_.default,{style:{fontSize:12,color:"#999"}}),(0,a.jsx)(eW.default,{size:"small",min:0,value:h,onChange:e=>g(e||1),style:{width:70}})]})}),(0,a.jsx)(e_.default,{title:"Error threshold for curve detection. Lower = more precise curves.",children:(0,a.jsxs)(f.default,{size:4,children:[(0,a.jsx)("label",{children:"qtres"}),(0,a.jsx)(t_.default,{style:{fontSize:12,color:"#999"}}),(0,a.jsx)(eW.default,{size:"small",min:0,value:x,onChange:e=>m(e||1),style:{width:70}})]})}),(0,a.jsx)(e_.default,{title:"Minimum path length to keep. Higher = simpler SVG with fewer tiny paths.",children:(0,a.jsxs)(f.default,{size:4,children:[(0,a.jsx)("label",{children:"Pathomit"}),(0,a.jsx)(t_.default,{style:{fontSize:12,color:"#999"}}),(0,a.jsx)(eW.default,{size:"small",min:0,value:p,onChange:e=>y(e||0),style:{width:70}})]})}),(0,a.jsx)(e_.default,{title:"Pixel sampling interval for colors. 1 = every pixel, higher = faster but less accurate colors.",children:(0,a.jsxs)(f.default,{size:4,children:[(0,a.jsx)("label",{children:"ColorSampling"}),(0,a.jsx)(t_.default,{style:{fontSize:12,color:"#999"}}),(0,a.jsx)(eW.default,{size:"small",min:1,value:v,onChange:e=>w(e||1),style:{width:70}})]})}),(0,a.jsx)(e_.default,{title:"Stroke width in the output SVG.",children:(0,a.jsxs)(f.default,{size:4,children:[(0,a.jsx)("label",{children:"StrokeWidth"}),(0,a.jsx)(t_.default,{style:{fontSize:12,color:"#999"}}),(0,a.jsx)(eW.default,{size:"small",min:0,value:j,onChange:e=>b(e||1),style:{width:70}})]})})]}),s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tW.default,{style:{margin:"16px 0"}}),(0,a.jsx)("div",{style:{marginBottom:12,fontWeight:500},children:"SVG Results"}),(0,a.jsxs)(tT.default,{defaultActiveKey:"svg",type:"card",size:"small",children:[(0,a.jsxs)(tT.default.TabPane,{tab:"Preview",children:[(0,a.jsxs)(f.default,{style:{marginBottom:8},children:[(0,a.jsx)(d.default,{size:"small",onClick:()=>k(s,"image.svg"),icon:(0,a.jsx)(tH.default,{}),children:"Download"}),(0,a.jsx)(d.default,{size:"small",onClick:()=>(0,tK.handleCopy)(s,"SVG copied!"),icon:(0,a.jsx)(td.default,{}),children:"Copy"})]}),(0,a.jsx)("div",{style:{border:"1px solid #eee",borderRadius:6,padding:12,overflow:"auto",maxHeight:n.current?n.current.height:400},children:(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:s}})})]},"svg"),(0,a.jsxs)(tT.default.TabPane,{tab:"Base64",children:[(0,a.jsxs)(f.default,{style:{marginBottom:8},children:[(0,a.jsx)(d.default,{size:"small",onClick:()=>(0,tK.handleCopy)(T,"Base64 copied!"),icon:(0,a.jsx)(td.default,{}),children:"Copy"}),(0,a.jsx)(d.default,{size:"small",onClick:()=>k(T,"image-base64.txt"),icon:(0,a.jsx)(tH.default,{}),children:"Download"})]}),(0,a.jsx)("pre",{style:{background:"#f7f7f7",padding:12,borderRadius:6,whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:300,overflow:"auto",fontSize:12},children:T})]},"base64"),(0,a.jsxs)(tT.default.TabPane,{tab:"Data URI",children:[(0,a.jsxs)(f.default,{style:{marginBottom:8},children:[(0,a.jsx)(d.default,{size:"small",onClick:()=>(0,tK.handleCopy)(B,"Data URI copied!"),icon:(0,a.jsx)(td.default,{}),children:"Copy"}),(0,a.jsx)(d.default,{size:"small",onClick:()=>k(B,"image-datauri.txt"),icon:(0,a.jsx)(tH.default,{}),children:"Download"})]}),(0,a.jsx)("pre",{style:{background:"#f7f7f7",padding:12,borderRadius:6,whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:300,overflow:"auto",fontSize:12},children:B})]},"datauri")]})]}),i&&(0,a.jsx)("div",{style:{textAlign:"center",padding:24},children:(0,a.jsx)(tA.default,{indicator:(0,a.jsx)(tF,{style:{fontSize:32},spin:!0}),tip:"Converting to SVG..."})})]})]})});},{Panel:tV}=eQ.default,tX=({canvasRef:e,baseCanvas:t,history:r,setTool:l,brightness:n,setBrightness:i,contrast:s,setContrast:c,blur:u,setBlur:h,gaussian:g,setGaussian:x,sharpen:m,setSharpen:p,bgThreshold:y,setBgThreshold:v,bgThresholdBlack:w,setBgThresholdBlack:j,setShowPerspectiveModal:b,dpiMeasured:C,setDpiMeasured:k,exportImage:M,onExport:R,overlayRef:I,texture:E,setTexture:D,clarity:z,setClarity:L,highlights:T,setHighlights:B,shadows:A,setShadows:P,whites:W,setWhites:N,blacks:_,setBlacks:U,vibrance:H,setVibrance:K,saturation:V,setSaturation:X,dehaze:Y,setDehaze:q,hslAdjustments:Z,setHslAdjustments:J,upscaleImage:Q,onColorRemovalToolClick:ee,showExportModal:et,setShowExportModal:er,onSave:el})=>{let[en,ea]=(0,o.useState)("red"),[ei,eo]=(0,o.useState)(!1),[es,ed]=(0,o.useState)(2),[ec,eu]=(0,o.useState)("medium"),[eh,ef]=(0,o.useState)(0),[eg,ex]=(0,o.useState)(0),[em,ep]=(0,o.useState)(0),[ey,ev]=(0,o.useState)(null),[ew,ej]=(0,o.useState)(!1),[eb,eC]=(0,o.useState)(1),[eR,eI]=(0,o.useState)(1),[eE,eD]=(0,o.useState)(1),[ez,eL]=(0,o.useState)(8),[eT,eB]=(0,o.useState)(2),[eA,eP]=(0,o.useState)(1),[eW,eN]=(0,o.useState)({red:[],green:[],blue:[]});(0,o.useEffect)(()=>{e.current&&eN(eS(e.current));},[e.current]);let eU=[{name:"red",color:"#ff4d4d"},{name:"orange",color:"#ffa500"},{name:"yellow",color:"#ffd700"},{name:"green",color:"#00c853"},{name:"aqua",color:"#00e5ff"},{name:"blue",color:"#2979ff"},{name:"purple",color:"#9c27b0"},{name:"magenta",color:"#ff00aa"}],eH=(e,t)=>{var r,l,n;let a=(null===(r=eU.find(t=>t.name===e))||void 0===r?void 0:r.color)||"#ffffff",i=eU.findIndex(t=>t.name===e);if(-1===i)return"#555";let o=eU[i].color,s=(null===(l=eU[i-1])||void 0===l?void 0:l.color)||o,d=(null===(n=eU[i+1])||void 0===n?void 0:n.color)||o;switch(t){case"h":return`linear-gradient(90deg, ${s}, ${o}, ${d})`;case"s":return`linear-gradient(90deg, gray, ${a})`;case"l":return`linear-gradient(90deg, black, ${a}, white)`;default:return"#555";}},e$=[{key:"texture",label:"Texture",value:E,setter:D},{key:"clarity",label:"Clarity",value:z,setter:L},{key:"highlights",label:"Highlights",value:T,setter:B},{key:"shadows",label:"Shadows",value:A,setter:P},{key:"whites",label:"Whites",value:W,setter:N},{key:"blacks",label:"Blacks",value:_,setter:U}],eF=[{key:"blur",label:"Box Blur",min:0,max:25,value:u,setter:h},{key:"gaussian",label:"Gaussian",min:0,max:20,value:g,setter:x},{key:"sharpen",label:"Sharpen",min:0,max:5,value:m,setter:p},{key:"bgThreshold",label:"Remove White",min:0,max:255,value:y,setter:v},{key:"bgThresholdBlack",label:"Remove Black",min:0,max:255,value:w,setter:j}],eG=()=>ek(e,t,{blur:u,gaussian:g,sharpen:m,texture:E,clarity:z,bgThreshold:y,bgThresholdBlack:w,brightness:n,contrast:s,highlights:T,shadows:A,whites:W,blacks:_,vibrance:H,saturation:V,dehaze:Y,hslAdjustments:Z},r,eN);return(0,a.jsxs)("div",{style:{width:260},children:[(0,a.jsxs)(eQ.default,{defaultActiveKey:["histogram","basic","lights","effects"],ghost:!0,expandIconPosition:"end",children:[(0,a.jsx)(tV,{header:"Histogram",children:(0,a.jsx)(tI,{canvasRef:e,redData:eW.red,greenData:eW.green,blueData:eW.blue})},"histogram"),(0,a.jsx)(tV,{header:"\u{1F6E0} Basic",children:(0,a.jsxs)(f.default,{wrap:!0,children:[(0,a.jsx)(e_.default,{title:"Undo (Ctrl+Z)",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(eO.default,{}),onClick:r.undo})}),(0,a.jsx)(e_.default,{title:"Redo (Ctrl+Shift+Z)",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(eK.default,{}),onClick:r.redo})}),(0,a.jsx)(e_.default,{title:"Rotate left",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(e7,{}),onClick:()=>$(-90,e,I,r)})}),(0,a.jsx)(e_.default,{title:"Rotate right (R)",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(tt.default,{}),onClick:()=>$(90,e,I,r)})}),(0,a.jsx)(e_.default,{title:"Flip horizontal",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(tl.default,{}),onClick:()=>O(e,r)})}),(0,a.jsx)(e_.default,{title:"Flip vertical",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(tl.default,{rotate:90}),onClick:()=>F(e,r)})}),(0,a.jsx)(e_.default,{title:"Crop (C)",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(ta.default,{}),onClick:()=>l("crop")})}),(0,a.jsx)(e_.default,{title:"Perspective",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(tx,{}),onClick:()=>{b(!0),l("perspective");}})}),(0,a.jsx)(e_.default,{title:"Brush (B)",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(tp,{}),onClick:()=>l("draw")})}),(0,a.jsx)(e_.default,{title:"Text (T)",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(tf.default,{}),onClick:()=>l("text")})}),(0,a.jsx)(e_.default,{title:"Layer (V)",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(tu.default,{}),onClick:()=>l("layer")})}),(0,a.jsx)(e_.default,{title:"Invert Colors (Ctrl+I)",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(tv.default,{}),onClick:()=>eM(e,r)})}),(0,a.jsx)(e_.default,{title:"Remove color",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(eY.default,{}),onClick:ee})})]})},"basic"),(0,a.jsxs)(tV,{header:"\u{1F506} Light",children:[(0,a.jsx)(e0,{label:"Brightness",value:n,min:-150,max:150,onChange:i,onChangeComplete:eG},"brightness"),(0,a.jsx)(e0,{label:"Contrast",value:s,min:-100,max:100,onChange:c,onChangeComplete:eG},"contrast")]},"lights"),(0,a.jsxs)(tV,{header:"\u{1F3A8} Color",children:[(0,a.jsx)(e0,{label:"Vibrance",value:H,min:-100,max:100,onChange:K,onChangeComplete:eG},"vibrance"),(0,a.jsx)(e0,{label:"Saturation",value:V,min:-100,max:100,onChange:X,onChangeComplete:eG},"saturation"),(0,a.jsx)(e0,{label:"Dehaze",value:Y,min:-100,max:100,onChange:q,onChangeComplete:eG},"dehaze"),(0,a.jsx)("div",{style:{marginTop:10},children:"HSL Mixer"}),(0,a.jsx)("div",{style:{display:"flex",gap:8,marginBottom:10},children:eU.map(({name:e,color:t})=>(0,a.jsx)(e_.default,{title:e.toUpperCase(),children:(0,a.jsx)("div",{onClick:()=>ea(e),style:{width:20,height:20,borderRadius:"50%",background:t,border:en===e?"2px solid white":"1px solid #555",boxShadow:en===e?"0 0 6px rgba(255,255,255,0.8)":"",cursor:"pointer"}},e)}))}),["Hue","Saturation","Luminance"].map(e=>{var t;let r=e[0].toLowerCase();return(0,a.jsx)(e0,{label:e,value:(null===(t=Z[en])||void 0===t?void 0:t[r])??0,min:"Hue"===e?-180:-100,max:"Hue"===e?180:100,onChange:e=>J(en,{[r]:e}),onChangeComplete:eG,gradient:eH(en,r)},e);}),(0,a.jsx)(d.default,{size:"small",onClick:()=>J(en,{h:0,s:0,l:0}),children:"Reset"})]},"color"),(0,a.jsx)(tV,{header:"\u2728 Effects",children:e$.map(({key:e,label:t,value:r,setter:l})=>(0,a.jsx)(e0,{label:t,value:r,min:-100,max:100,onChange:l,onChangeComplete:eG},e))},"effects"),(0,a.jsx)(tV,{header:"\u{1F3AD} Filters",children:eF.map(({key:e,label:t,min:r,max:l,value:n,setter:i})=>(0,a.jsx)(e0,{label:t,value:n,min:r,max:l,onChange:i,onChangeComplete:eG},e))},"filters"),(0,a.jsxs)(tV,{header:"\u{1F4D0} Crop & Ruler",children:[(0,a.jsxs)(f.default,{children:[(0,a.jsx)(d.default,{icon:(0,a.jsx)(ta.default,{}),onClick:()=>l("crop"),children:"Crop"}),(0,a.jsx)(d.default,{onClick:()=>{b(!0),l("perspective");},children:"Perspective"})]}),(0,a.jsx)("div",{style:{marginTop:10},children:"Ruler"}),(0,a.jsxs)(f.default,{children:[(0,a.jsx)(d.default,{onClick:()=>l("ruler"),children:"\u{1F4CF} Ruler"}),(0,a.jsx)(d.default,{onClick:()=>{null==k||k(null),S.default.info("Ruler cleared");},children:"Clear"})]}),C&&(0,a.jsxs)("div",{children:["Estimated DPI: ",C]})]},"crop"),(0,a.jsx)(tV,{header:"\u{1F53C} Upscale Options",children:(0,a.jsx)(d.default,{onClick:()=>{eo(!0);},children:"Custom Upscale..."})},"upscaleOptions"),(0,a.jsx)(tV,{header:"\u{1F4E4} Export",children:(0,a.jsxs)(f.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsx)(d.default,{type:"primary",icon:(0,a.jsx)(tj.default,{}),onClick:el,block:!0,style:{marginBottom:8},children:"Save Project (Ctrl+S)"}),(0,a.jsx)(d.default,{icon:(0,a.jsx)(to.default,{}),onClick:()=>{er(!0);},type:"primary",block:!0,children:"Export Image / SVG"}),(0,a.jsx)(d.default,{icon:(0,a.jsx)(td.default,{}),onClick:()=>G(e),block:!0,children:"Copy to Clipboard"})]})},"export")]}),(0,a.jsx)(tE,{open:ei,onCancel:()=>eo(!1),onOk:()=>{l("upscale"),null==Q||Q(es,ec,{sharpen:eh,edgeEnhancement:eg,denoise:em}),eo(!1);},upscaleFactor:es,setUpscaleFactor:ed,presetLocal:ec,setPresetLocal:eu,sharpenAmount:eh,setSharpenAmount:ef,edgeEnhancement:eg,setEdgeEnhancement:ex,denoiseAmount:em,setDenoiseAmount:ep}),(0,a.jsx)(tG,{open:et,onCancel:()=>{er(!1),ev(null);},onExportImage:(t,r)=>{M("jpg"===t,e,R,r);},onExportSvg:()=>{if(!e.current){S.default.error("No image to convert");return;}ej(!0);let t=e.current.toDataURL();try{tC.default.imageToSVG(t,e=>{ev(e),ej(!1),S.default.success("Image converted to SVG successfully!");},{scale:eb,ltres:eR,qtres:eE,pathomit:ez,colorsampling:eT,strokewidth:eA});}catch(e){console.error(e),ej(!1),S.default.error("Error converting image to SVG.");}},canvasRef:e,processing:ew,svgContent:ey,scale:eb,setScale:eC,ltres:eR,setLtres:eI,qtres:eE,setQtres:eD,pathomit:ez,setPathomit:eL,colorsampling:eT,setColorsampling:eB,strokewidth:eA,setStrokewidth:eP,onDownload:(e,t)=>{let r=new Blob([e],{type:"image/svg+xml"}),l=document.createElement("a");l.href=URL.createObjectURL(r),l.download=t,l.click();},getSvgModalWidth:()=>e.current?Math.min(Math.max(e.current.width+100,500),.9*window.innerWidth):700,getSvgModalHeight:()=>{if(e.current)return Math.min(e.current.height+300,.85*window.innerHeight);}})]});};var tY=r("5e015b19"),tq=l._(tY),tZ=r("51f675c3"),tJ=l._(tZ),tQ=o.forwardRef(function(e,t){return o.createElement(e9.default,(0,e8.default)((0,e8.default)({},e),{},{ref:t,icon:tJ.default}));}),t0={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M482.2 508.4L331.3 389c-3-2.4-7.3-.2-7.3 3.6V478H184V184h204v128c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V144c0-15.5-12.5-28-28-28H144c-15.5 0-28 12.5-28 28v736c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v128H184V546h140v85.4c0 3.8 4.4 6 7.3 3.6l150.9-119.4a4.5 4.5 0 000-7.2zM880 116H596c-15.5 0-28 12.5-28 28v168c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V184h204v294H700v-85.4c0-3.8-4.3-6-7.3-3.6l-151 119.4a4.52 4.52 0 000 7.1l151 119.5c2.9 2.3 7.3.2 7.3-3.6V546h140v294H636V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v168c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V144c0-15.5-12.5-28-28-28z"}}]},name:"merge-cells",theme:"outlined"},t1=o.forwardRef(function(e,t){return o.createElement(e9.default,(0,e8.default)((0,e8.default)({},e),{},{ref:t,icon:t0}));}),t2=r("1f06600b"),t5=l._(t2),t8=o.forwardRef(function(e,t){return o.createElement(e9.default,(0,e8.default)((0,e8.default)({},e),{},{ref:t,icon:t5.default}));}),t4=r("69757292"),t6=l._(t4),t3=o.forwardRef(function(e,t){return o.createElement(e9.default,(0,e8.default)((0,e8.default)({},e),{},{ref:t,icon:t6.default}));}),t9=r("30963339"),t7=l._(t9),re=r("96102293"),rt=l._(re),rr=r("21b4a197"),rl=l._(rr),rn=r("1ffcd493"),ra=l._(rn),ri=r("37a7e6a1"),ro=l._(ri),rs=r("27aee2a8"),rd=l._(rs);let{Option:rc}=eA.default,ru=({history:e,setZoom:t,tool:r,setTool:l,brushType:n,setBrushType:i,drawColor:s,setDrawColor:c,drawLineWidth:u,setDrawLineWidth:h,brushOpacity:g,setBrushOpacity:x,brushFlow:m,setBrushFlow:p,layers:y,activeLayerId:v,setLayerOpacity:w,setLayerBlend:j,moveLayerUp:b,moveLayerDown:C,deleteLayer:k,selectLayer:S,mergeLayer:M,textContent:R,setTextContent:I,textFont:E,setTextFont:D,textFontSize:z,setTextFontSize:L,textColor:T,setTextColor:B,textWeight:A,setTextWeight:P,textItalic:W,setTextItalic:N,textDecoration:_,setTextDecoration:U,textAlign:H,setTextAlign:$,onAddTextLayer:O,isAddingText:F,setIsAddingText:K,onOpenMaskTool:G,onOpenLayerEffects:V})=>{let X=(0,o.useRef)(!1),Y=(0,o.useRef)(null),q=(0,o.useRef)(g),Z=(0,o.useRef)(!1),J=(0,o.useRef)(null),Q=(0,o.useRef)(m),ee=e=>{if(0!==e.button)return;e.preventDefault(),X.current=!0,Y.current=e.clientX;let t=document.body.style.userSelect;document.body.style.userSelect="none";let l=e=>{let t=Number(e.toFixed(2));if("draw"===r){x(t);return;}if("layer"===r&&y){let e=y.find(e=>e.id===v);e&&w&&w(e.id,t);}};q.current=(()=>{if("draw"===r)return g;if("layer"===r&&y){let e=y.find(e=>e.id===v);return(null==e?void 0:e.opacity)??g;}return g;})();let n=e=>{if(!X.current||null===Y.current)return;let t=e.clientX-Y.current;l(Math.min(1,Math.max(0,q.current+.005*t)));},a=()=>{X.current=!1,Y.current=null,document.body.style.userSelect=t,window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",a);};window.addEventListener("mousemove",n),window.addEventListener("mouseup",a);};return(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsxs)(f.default,{children:[(0,a.jsx)(eA.default,{style:{width:150},placeholder:"History",value:e.index,onChange:t=>e.applyHistory(t),optionLabelProp:"label",children:e.history.map((e,t)=>(0,a.jsx)(eA.default.Option,{value:t,label:e.label||`Step ${t+1}`,children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("img",{src:e.url,alt:"",style:{width:40,height:30,objectFit:"contain",border:"1px solid #ddd"}}),(0,a.jsx)("span",{children:e.label||`Step ${t+1}`})]})},t))}),(0,a.jsx)(e_.default,{title:"Zoom In",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(tq.default,{}),onClick:()=>t(e=>Math.min(1.2*e,8))})}),(0,a.jsx)(e_.default,{title:"Zoom Out",children:(0,a.jsx)(d.default,{icon:(0,a.jsx)(tQ,{}),onClick:()=>t(e=>Math.max(e/1.2,.1))})}),(0,a.jsxs)(eA.default,{value:r,onChange:e=>l(e),style:{width:140},children:[(0,a.jsx)(rc,{value:"pan",children:"Pan"}),(0,a.jsx)(rc,{value:"move",children:"Move"}),(0,a.jsx)(rc,{value:"color",children:"Color Picker"}),(0,a.jsx)(rc,{value:"crop",children:"Crop"}),(0,a.jsx)(rc,{value:"ruler",children:"Ruler"}),(0,a.jsx)(rc,{value:"perspective",children:"Perspective"}),(0,a.jsx)(rc,{value:"draw",children:"Brush"}),(0,a.jsx)(rc,{value:"text",children:"Text"})]}),(0,a.jsxs)(f.default,{style:{width:"100%"},wrap:!0,children:["color"===r?(0,a.jsx)(eH.default,{value:s,onChange:e=>c(e.toHexString())}):null,"draw"===r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(eA.default,{value:n,onChange:e=>i(e),style:{width:80},children:[(0,a.jsx)(rc,{value:"hard",children:"Hard"}),(0,a.jsx)(rc,{value:"soft",children:"Soft"})]}),(0,a.jsx)(eH.default,{value:s,onChange:e=>c(e.toHexString())}),(0,a.jsx)(eW.default,{style:{width:100},min:1,max:500,value:u,onChange:e=>h(e||1),addonAfter:"px"}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("span",{onMouseDown:ee,style:{cursor:"ew-resize",userSelect:"none"},title:"Drag left/right to change opacity",children:"Opacity:"}),(0,a.jsx)(eW.default,{min:0,max:1,step:.01,style:{width:60},value:g,onChange:e=>x(e||0)})]}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("span",{onMouseDown:e=>{if(0!==e.button)return;e.preventDefault(),Z.current=!0,J.current=e.clientX,Q.current=m;let t=document.body.style.userSelect;document.body.style.userSelect="none";let r=e=>{if(!Z.current||null===J.current)return;let t=e.clientX-J.current,r=Q.current+.005*t;p(Number((r=Math.max(0,Math.min(1,r))).toFixed(2)));},l=()=>{Z.current=!1,J.current=null,Q.current=m,document.body.style.userSelect=t,window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",l);};window.addEventListener("mousemove",r),window.addEventListener("mouseup",l);},style:{cursor:"ew-resize",userSelect:"none"},title:"Drag left/right to change flow",children:"Flow:"}),(0,a.jsx)(eW.default,{min:0,max:1,step:.01,style:{width:60},value:m,onChange:e=>p(e||0)})]})]}):null,"text"===r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(eA.default,{value:E||"Arial",onChange:e=>D&&D(e),style:{width:100},children:[(0,a.jsx)(rc,{value:"Arial",children:"Arial"}),(0,a.jsx)(rc,{value:"Helvetica",children:"Helvetica"}),(0,a.jsx)(rc,{value:"Times New Roman",children:"Times New Roman"}),(0,a.jsx)(rc,{value:"Courier New",children:"Courier New"}),(0,a.jsx)(rc,{value:"Georgia",children:"Georgia"}),(0,a.jsx)(rc,{value:"Verdana",children:"Verdana"})]}),(0,a.jsx)(eW.default,{min:8,max:200,value:z||32,onChange:e=>L&&L(e||32),addonAfter:"px",style:{width:90}}),(0,a.jsx)(eH.default,{value:T||"#000000",onChange:e=>B&&B(e.toHexString())}),(0,a.jsxs)(eA.default,{value:A||"normal",onChange:e=>P&&P(e),style:{width:80},children:[(0,a.jsx)(rc,{value:"lighter",children:"Lighter"}),(0,a.jsx)(rc,{value:"normal",children:"Normal"}),(0,a.jsx)(rc,{value:"bold",children:"Bold"}),(0,a.jsx)(rc,{value:"900",children:"900"})]}),(0,a.jsx)(e_.default,{title:"Italic",children:(0,a.jsx)(d.default,{size:"small",icon:(0,a.jsx)(rt.default,{}),type:W?"primary":"default",onClick:()=>N&&N(!W)})}),(0,a.jsxs)(eA.default,{value:_||"none",onChange:e=>U&&U(e),style:{width:100},children:[(0,a.jsx)(rc,{value:"none",children:"No decoration"}),(0,a.jsx)(rc,{value:"underline",children:"Underline"}),(0,a.jsx)(rc,{value:"line-through",children:"Strike"})]}),(0,a.jsx)(e_.default,{title:"Align",children:(0,a.jsxs)(f.default,{size:"small",children:[(0,a.jsx)(d.default,{size:"small",icon:(0,a.jsx)(rl.default,{}),type:"left"===H?"primary":"default",onClick:()=>$&&$("left")}),(0,a.jsx)(d.default,{size:"small",icon:(0,a.jsx)(ra.default,{}),type:"center"===H?"primary":"default",onClick:()=>$&&$("center")}),(0,a.jsx)(d.default,{size:"small",icon:(0,a.jsx)(ro.default,{}),type:"right"===H?"primary":"default",onClick:()=>$&&$("right")})]})})]}):null,"layer"===r?(0,a.jsx)(a.Fragment,{children:y&&y.length>0&&(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("span",{style:{fontSize:12,fontWeight:600},children:"Layers"}),(0,a.jsx)(eA.default,{value:v||void 0,placeholder:"Select layer",onChange:e=>S&&S(e),style:{width:180},showSearch:!0,children:y.slice().reverse().map(e=>{var t;return(0,a.jsx)(rc,{value:e.id,label:`Layer ${e.id}`,children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.img&&(0,a.jsx)("img",{src:null===(t=e.img)||void 0===t?void 0:t.src,alt:"",style:{width:40,height:28,objectFit:"cover"}}),e.text&&(0,a.jsx)(tf.default,{}),(0,a.jsx)("span",{style:{fontSize:12},children:e.id})]})},e.id);})})]}),(0,a.jsx)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:(0,a.jsx)(d.default,{size:"small",icon:(0,a.jsx)(t1,{}),onClick:()=>M&&M(),children:"Merge All"})}),v&&(()=>{let e=y.find(e=>e.id===v);return e?(0,a.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,a.jsx)(d.default,{size:"small",icon:(0,a.jsx)(t1,{}),onClick:()=>M&&M(e.id),children:"Merge"}),(0,a.jsx)(d.default,{size:"small",icon:(0,a.jsx)(rd.default,{}),onClick:()=>G&&G(e.id),children:"Mask"}),(0,a.jsx)(d.default,{size:"small",icon:(0,a.jsx)(tf.default,{}),onClick:()=>V&&V(e.id),children:"Effects"}),(0,a.jsx)(d.default,{size:"small",icon:(0,a.jsx)(t8,{}),onClick:()=>b&&b(e.id)}),(0,a.jsx)(d.default,{size:"small",icon:(0,a.jsx)(t3,{}),onClick:()=>C&&C(e.id)}),(0,a.jsx)(d.default,{size:"small",danger:!0,icon:(0,a.jsx)(t7.default,{}),onClick:()=>k&&k(e.id)}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginLeft:8},children:[(0,a.jsx)("span",{onMouseDown:ee,style:{cursor:"ew-resize",userSelect:"none"},title:"Drag left/right to change opacity",children:"Opacity:"}),(0,a.jsx)(eW.default,{min:0,max:1,step:.01,style:{width:80},value:Number(e.opacity.toFixed(2)),onChange:t=>w&&w(e.id,Number(t||0))})]}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("span",{style:{userSelect:"none"},children:"Blend:"}),(0,a.jsxs)(eA.default,{value:e.blend||"source-over",onChange:t=>j&&j(e.id,t),style:{width:140},children:[(0,a.jsx)(rc,{value:"source-over",children:"Normal"}),(0,a.jsx)(rc,{value:"multiply",children:"Multiply"}),(0,a.jsx)(rc,{value:"screen",children:"Screen"}),(0,a.jsx)(rc,{value:"overlay",children:"Overlay"}),(0,a.jsx)(rc,{value:"lighter",children:"Lighten"}),(0,a.jsx)(rc,{value:"darken",children:"Darken"})]})]})]}):null;})()]})}):null]})]})});},rh=(e,t,r)=>{let[l,n]=(0,o.useState)(1),[a,i]=(0,o.useState)({x:0,y:0}),[s,d]=(0,o.useState)(!1),c=(0,o.useRef)(null);return(0,o.useEffect)(()=>{let l=e.current,a=t.current;if(!l||!a)return;let o=e=>{if(!e.ctrlKey&&"pan"!==r)return;e.preventDefault();let t=a.getBoundingClientRect(),l=e.clientX-t.left,o=e.clientY-t.top;n(t=>{let r=Math.min(Math.max(t*(e.deltaY<0?1.1:.9),.1),12),n=r/t;return i(e=>({x:l-(l-e.x)*n,y:o-(o-e.y)*n})),r;});};return l.addEventListener("wheel",o,{passive:!1}),()=>l.removeEventListener("wheel",o);},[e,t,r]),{zoom:l,setZoom:n,offset:a,setOffset:i,isPanning:s,setIsPanning:d,panStart:c};},rf=()=>{let[e,t]=(0,o.useState)("pan"),[r,l]=(0,o.useState)(null),[n,a]=(0,o.useState)(!1),[i,s]=(0,o.useState)(!1),[d,c]=(0,o.useState)(!1);return{tool:e,setTool:t,toolBefore:r,setToolBefore:l,isSpaceDown:n,setIsSpaceDown:a,isAltDown:i,setIsAltDown:s,isShiftDown:d,setIsShiftDown:c};},rg=()=>{let[e,t]=(0,o.useState)(0),[r,l]=(0,o.useState)(0),[n,a]=(0,o.useState)(0),[i,s]=(0,o.useState)(0),[d,c]=(0,o.useState)(0),[u,h]=(0,o.useState)(0),[f,g]=(0,o.useState)(0),[x,m]=(0,o.useState)(0),[p,y]=(0,o.useState)(0),[v,w]=(0,o.useState)(0),[j,b]=(0,o.useState)(0),[C,k]=(0,o.useState)(0),[S,M]=(0,o.useState)(0),[R,I]=(0,o.useState)(0),[E,D]=(0,o.useState)(0),[z,L]=(0,o.useState)(0),[T,B]=(0,o.useState)({});return{brightness:e,setBrightness:t,contrast:r,setContrast:l,highlights:n,setHighlights:a,shadows:i,setShadows:s,whites:d,setWhites:c,blacks:u,setBlacks:h,vibrance:f,setVibrance:g,saturation:x,setSaturation:m,dehaze:p,setDehaze:y,blur:v,setBlur:w,gaussian:j,setGaussian:b,sharpen:C,setSharpen:k,texture:S,setTexture:M,clarity:R,setClarity:I,bgThreshold:E,setBgThreshold:D,bgThresholdBlack:z,setBgThresholdBlack:L,hslAdjustments:T,setHslAdjustmentsState:B,setHslAdjustments:(e,t)=>{B(r=>({...r,[e]:{...r[e]||{},...t}}));}};},rx=()=>{let[e,t]=(0,o.useState)([]),[r,l]=(0,o.useState)(null),[n,a]=(0,o.useState)(!1);return{layers:e,setLayers:t,activeLayerId:r,setActiveLayerId:l,overlaySelected:n,setOverlaySelected:a,overlayDrag:(0,o.useRef)(null),overlayResize:(0,o.useRef)(null),overlayRotate:(0,o.useRef)(null)};},rm=()=>{let[e,t]=(0,o.useState)(null),r=(0,o.useRef)(null),[l,n]=(0,o.useState)(!1);return{cropRect:e,setCropRect:t,cropStart:r,showCropModal:l,setShowCropModal:n};},rp=()=>{let[e,t]=(0,o.useState)(!1),r=(0,o.useRef)(null);return{showPerspectiveModal:e,setShowPerspectiveModal:t,perspectivePoints:r,ensurePerspectiveInit:()=>{r.current||(r.current=[NaN,NaN,NaN,NaN,NaN,NaN,NaN,NaN]);},findNearPointIndex:(e,t,l=12)=>{if(!r.current)return -1;let n=r.current;for(let r=0;r<8;r+=2){let a=n[r],i=n[r+1];if(!isNaN(a)&&!isNaN(i)){let n=a-e,o=i-t;if(Math.sqrt(n*n+o*o)<=l)return r;}}return -1;}};},ry=()=>{let[e,t]=(0,o.useState)("#ff0000"),[r,l]=(0,o.useState)(2),[n,a]=(0,o.useState)("hard"),[i,s]=(0,o.useState)(1),[d,c]=(0,o.useState)(1),[u,h]=(0,o.useState)(!1),f=(0,o.useRef)([]),g=(0,o.useRef)(!1),x=(0,o.useRef)(null),m=(0,o.useRef)(r);return{drawColor:e,setDrawColor:t,drawLineWidth:r,setDrawLineWidth:l,brushType:n,setBrushType:a,brushOpacity:i,setBrushOpacity:s,brushFlow:d,setBrushFlow:c,isDrawing:u,setIsDrawing:h,drawPoints:f,resizingBrush:g,resizeStartX:x,initialLineWidth:m};},rv=()=>{let[e,t]=(0,o.useState)(""),[r,l]=(0,o.useState)("Arial"),[n,a]=(0,o.useState)(32),[i,s]=(0,o.useState)("#000000"),[d,c]=(0,o.useState)("normal"),[u,h]=(0,o.useState)(!1),[f,g]=(0,o.useState)("none"),[x,m]=(0,o.useState)("left"),[p,y]=(0,o.useState)(!1);return{textContent:e,setTextContent:t,textFont:r,setTextFont:l,textFontSize:n,setTextFontSize:a,textColor:i,setTextColor:s,textWeight:d,setTextWeight:c,textItalic:u,setTextItalic:h,textDecoration:f,setTextDecoration:g,textAlign:x,setTextAlign:m,isAddingText:p,setIsAddingText:y,inlineEditorRef:(0,o.useRef)(null)};},rw=()=>{let[e,t]=(0,o.useState)(null),[r,l]=(0,o.useState)(null),[n,a]=(0,o.useState)(!1),[i,s]=(0,o.useState)(null),[d,c]=(0,o.useState)(!1),[u,h]=(0,o.useState)(null),[f,g]=(0,o.useState)(!1),[x,m]=(0,o.useState)(null),p=(0,o.useRef)(null),[y,v]=(0,o.useState)(null),[w,j]=(0,o.useState)(!1),[b,C]=(0,o.useState)(!1);return{hoverColor:e,setHoverColor:t,pickedColor:r,setPickedColor:l,showColorRemovalModal:n,setShowColorRemovalModal:a,selectedColorForRemoval:i,setSelectedColorForRemoval:s,showLayerMaskModal:d,setShowLayerMaskModal:c,maskEditingLayerId:u,setMaskEditingLayerId:h,showLayerEffectModal:f,setShowLayerEffectModal:g,effectEditingLayerId:x,setEffectEditingLayerId:m,rulerPoints:p,dpiMeasured:y,setDpiMeasured:v,showExportModal:w,setShowExportModal:j,openTour:b,setOpenTour:C,toolbarRef:(0,o.useRef)(null),sidebarRef:(0,o.useRef)(null),canvasContainerRef:(0,o.useRef)(null)};},rj=(e,t,r)=>[{title:"\u{1F3A8} Welcome to Pics Editor",description:"This is a powerful image editing tool with many features. Let me show you around!",target:null},{title:"\u{1F6E0}\uFE0F Side Panel",description:"Access all editing tools here: adjustments, effects, color grading, and export options. Apply changes to see them on the canvas.",target:()=>e.current},{title:"\u{1F5BC}\uFE0F Canvas Area",description:"Your main workspace. Use Space + drag to pan, scroll to zoom, or Alt + scroll for fine zoom control. The resolution is shown in the top right.",target:()=>t.current},{title:"\u2328\uFE0F Top Toolbar",description:"Quick access to undo/redo, zoom controls, and tool-specific options. Draw settings, layer management, and text formatting appear when those tools are active.",target:()=>r.current},{title:'\u{1F3AD} Hand Tool (Hold "Space" or press "H")',description:"Navigate around your canvas. Hold Space key anywhere to temporarily activate pan mode, making it easy to move around large images."},{title:"\u2702\uFE0F Crop Tool (C)",description:"Click and drag to select a crop area. Press Enter to apply the crop or Escape to cancel. Perfect for trimming images to the exact size you need."},{title:"\u{1F3A8} Color Picker (I)",description:"Click on any pixel to pick its color. Hold Shift while clicking to pick from the original unedited image instead of the current edited version."},{title:"\u{1F5D1}\uFE0F Color Removal (K)",description:"Remove specific colors from your image. First use the Color Picker (I) to select a color, then activate this tool to remove it with adjustable tolerance and feathering for smooth edges."},{title:"\u{1F4CF} Ruler Tool (R)",description:"Measure distances on your image. Click two points to measure in pixels, then optionally enter a real-world measurement to calculate and display the image DPI."},{title:"\u{1F532} Perspective Tool (P)",description:"Correct perspective distortion in photos. Click to place 4 corner points clockwise, adjust them to match the object's corners, then apply to straighten the perspective."},{title:"\u270F\uFE0F Brush Tool (B)",description:"Freehand drawing with customizable options: brush size, color, opacity, flow rate, and choose between hard-edge and soft-edge brushes for different effects."},{title:"\u{1F5BC}\uFE0F Layer Tool (V)",description:"Add and manage image layers. Drag and drop images onto the canvas, adjust opacity and blend modes, resize, rotate (Hold Shift), and position layers with full control."},{title:"\u{1F524} Text Tool (T)",description:"Add text overlays with complete formatting control: font family, size, weight (bold/normal), color, alignment (left/center/right), italic, and text decorations (underline/strikethrough)."},{title:"\u{1F50D} Upscale",description:"Enlarge your image intelligently. Choose from quality presets (low/medium/high) and apply enhancement options like sharpen, edge enhancement, and noise reduction for best results."},{title:"\u{1F4BE} Export (Ctrl + Shift + S)",description:"Export your edited image as PNG or JPG with optional overlay layers, or convert to scalable SVG format with customizable tracing parameters for vector graphics."},{title:"\u2328\uFE0F Keyboard Shortcuts",description:(0,a.jsxs)("div",{style:{lineHeight:1.8},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Space"}),": Pan tool (hold anywhere)"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"C"}),": Crop tool"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"I"}),": Color picker"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"K"}),": Color removal"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"R"}),": Ruler tool"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"P"}),": Perspective tool"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"D"}),": Draw tool"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"L"}),": Layer tool"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"T"}),": Text tool"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Ctrl+Z"}),": Undo"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Ctrl+Y / Ctrl+Shift+Z"}),": Redo"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Scroll"}),": Zoom in/out"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Alt+Scroll"}),": Fine zoom control"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Shift+Click"}),": Pick from original image"]})]})}],rb=({imageUrl:e,addOnFile:t,setAddOnFile:r,onExport:l,onSave:n,initialState:i,settings:s})=>{var c;let u=(0,o.useRef)(null),{canvasRef:h,overlayRef:f,baseCanvas:g,setBaseCanvas:x,syncCanvasSize:m}=function(e,t){let r=(0,o.useRef)(null),l=(0,o.useRef)(null),[n,a]=(0,o.useState)(null);(0,o.useEffect)(()=>{(async()=>{try{let l=await new Promise((t,r)=>{let l=new Image;l.crossOrigin="anonymous",l.onload=()=>{let e=D(l.naturalWidth,l.naturalHeight);e.getContext("2d").drawImage(l,0,0),t(e);},l.onerror=r,l.src=e;});a(l);let n=D(l.width,l.height);if(n.getContext("2d").drawImage(l,0,0),r.current){r.current.width=n.width,r.current.height=n.height;let e=r.current.getContext("2d");e.clearRect(0,0,n.width,n.height),e.drawImage(n,0,0);}t&&t(i(n));}catch(e){console.error("Failed to load image",e),S.default.error("Failed to load image");}})();},[e]),(0,o.useEffect)(()=>{s();},[n]);let i=e=>e.toDataURL("image/png"),s=()=>{if(!r.current||!n)return;r.current.width=n.width,r.current.height=n.height,l.current.width=n.width,l.current.height=n.height;let e=r.current.getContext("2d");e.clearRect(0,0,r.current.width,r.current.height),e.drawImage(n,0,0);};return{canvasRef:r,overlayRef:l,baseCanvas:n,setBaseCanvas:a,syncCanvasSize:s};}(e,e=>p.push(e,"Initial load")),p=function(e,t,r=20){let[l,n]=(0,o.useState)([]),[a,i]=(0,o.useState)(-1),s=l[a],d=r=>{let n=l[r];if(!n)return;let a=new Image;a.onload=()=>{let l=e.current.getContext("2d");e.current.width=a.naturalWidth,e.current.height=a.naturalHeight,t.current.width=a.naturalWidth,t.current.height=a.naturalHeight,l.clearRect(0,0,e.current.width,e.current.height),l.drawImage(a,0,0),i(r);},a.src=n.url;};return{history:l,index:a,current:s,push:(e,t="",o=!0)=>{let s=l.slice(0,a+1);s.push({url:e,label:t,isSetBase:o}),s.length>r&&(s=[s[0],...s.slice(s.length-(r-1))]),n(s),i(s.length-1);},undo:()=>{a<=0||d(a-1);},redo:()=>{a>=l.length-1||d(a+1);},applyHistory:d};}(h,f,s.maxHistory),y=(0,o.useRef)(!1),v=rf(),w=rh(u,h,v.tool),j=rg(),b=rx(),k=rm(),M=rp(),I=ry(),z=rv(),L=rw(),{zoom:T,setZoom:B,offset:A,setOffset:P,isPanning:W,setIsPanning:N,panStart:_}=w,{tool:U,setTool:H,setToolBefore:O,setIsSpaceDown:F,setIsAltDown:G,setIsShiftDown:Y}=v,{brightness:eg,setBrightness:ex,contrast:em,setContrast:ew,highlights:eb,setHighlights:eC,shadows:ek,setShadows:eS,whites:eR,setWhites:eD,blacks:ez,setBlacks:eL,vibrance:eT,setVibrance:eB,saturation:eA,setSaturation:eP,dehaze:eW,setDehaze:eN,blur:e_,setBlur:eU,gaussian:eH,setGaussian:e$,sharpen:eO,setSharpen:eF,texture:eK,setTexture:eG,clarity:eX,setClarity:eY,bgThreshold:eq,setBgThreshold:eJ,bgThresholdBlack:eQ,setBgThresholdBlack:e0,hslAdjustments:e1,setHslAdjustmentsState:e5,setHslAdjustments:e8}=j,{layers:e4,setLayers:e6,activeLayerId:e3,setActiveLayerId:e9,overlaySelected:e7,setOverlaySelected:te,overlayDrag:tt,overlayResize:tr,overlayRotate:tl}=b,{cropRect:tn,setCropRect:ta,cropStart:ti,showCropModal:to,setShowCropModal:ts}=k,{showPerspectiveModal:td,setShowPerspectiveModal:tc,perspectivePoints:tu,ensurePerspectiveInit:th,findNearPointIndex:tf}=M,{drawColor:tg,setDrawColor:tx,drawLineWidth:tm,setDrawLineWidth:tp,brushType:ty,setBrushType:tv,brushOpacity:tw,setBrushOpacity:tj,brushFlow:tb,setBrushFlow:tC,isDrawing:tk,setIsDrawing:tS,drawPoints:tM,resizingBrush:tR,resizeStartX:tI,initialLineWidth:tE}=I,{textContent:tD,setTextContent:tz,textFont:tL,setTextFont:tT,textFontSize:tB,setTextFontSize:tA,textColor:tP,setTextColor:tW,textWeight:tN,setTextWeight:t_,textItalic:tU,setTextItalic:tH,textDecoration:t$,setTextDecoration:tO,textAlign:tF,setTextAlign:tK,isAddingText:tG,setIsAddingText:tV,inlineEditorRef:tY}=z,{hoverColor:tq,setHoverColor:tZ,pickedColor:tJ,setPickedColor:tQ,showColorRemovalModal:t0,setShowColorRemovalModal:t1,selectedColorForRemoval:t2,setSelectedColorForRemoval:t5,showLayerMaskModal:t8,setShowLayerMaskModal:t4,maskEditingLayerId:t6,setMaskEditingLayerId:t3,showLayerEffectModal:t9,setShowLayerEffectModal:t7,effectEditingLayerId:re,setEffectEditingLayerId:rt,rulerPoints:rr,dpiMeasured:rl,setDpiMeasured:rn,showExportModal:ra,setShowExportModal:ri,openTour:ro,setOpenTour:rs,toolbarRef:rd,sidebarRef:rc,canvasContainerRef:rb}=L;(0,o.useEffect)(()=>{t&&(rC(t),r(null));},[t]),(0,o.useEffect)(()=>{g&&(e6(e=>{if(e[0]&&e[0].locked)return e;let t=new Image;return t.src=g.toDataURL(),[{id:`base_overlay_${Date.now()}`,type:"image",img:t,rect:{x:0,y:0,w:g.width,h:g.height},opacity:0,blend:"source-over",locked:!0},...e];}),setTimeout(()=>{try{m(),rW();}catch(e){}},50));},[g]);let rC=e=>X(e,h,e6,e9,te,rW,H),rk=async(e,t,r,l=!0)=>q(e,t,l?e4:[],r),rS=e=>Z(h,e4,e6,p,e),rM=e=>er(e6,e,e9),rR=(e,t)=>ea(e6,e,t),rI=(e,t)=>ei(e6,e,t),rE=(e,t)=>eo(e6,e,t),rD=(e,t)=>es(e6,e,t),rz=(e,t)=>ed(e6,e,t),rL=(e,t)=>ec(e6,e,t),rT=(e,t)=>eu(e6,e,t),rB=(e,t)=>eh(e6,e,t),rA=()=>e4.find(e=>e.id===t6);(0,o.useEffect)(()=>{var e;if(!h.current||!(null===(e=p.history[p.index])||void 0===e?void 0:e.isSetBase))return;let t=h.current,r=document.createElement("canvas");r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0),x(r),e6(e=>{if(!e[0])return e;let t={...e[0]};return t.img&&(t.img.src=r.toDataURL()),t.rect={x:0,y:0,w:r.width,h:r.height},[t,...e.slice(1)];}),f.current&&(f.current.width=r.width,f.current.height=r.height),rW();},[p.index]),(0,o.useEffect)(()=>{i&&(ex(i.brightness),ew(i.contrast),eC(i.highlights),eS(i.shadows),eD(i.whites),eL(i.blacks),eB(i.vibrance),eP(i.saturation),eN(i.dehaze),eU(i.blur),e$(i.gaussian),eF(i.sharpen),eG(i.texture),eY(i.clarity),eJ(i.bgThreshold),e0(i.bgThresholdBlack),e5(i.hslAdjustments),e6(i.layers.map(e=>{let t={...e};if("image"===e.type&&e.imgSrc){let r=new Image;r.src=e.imgSrc,t.img=r;}if(e.maskSrc){let r=document.createElement("canvas"),l=new Image;l.onload=()=>{r.width=l.width,r.height=l.height;let e=r.getContext("2d");null==e||e.drawImage(l,0,0);},l.src=e.maskSrc,t.mask=r;}return t;})),setTimeout(()=>{y.current=!1;},0));},[i]),(0,o.useEffect)(()=>{y.current=!0;},[e4,eg,em,eb,ek,eR,ez,eT,eA,eW,e_,eH,eO,eK,eX,eq,eQ,e1]);let rP=()=>{n&&(n({layers:e4.map(e=>{let t={...e};return e.img&&(t.imgSrc=e.img.src,delete t.img),e.mask&&(t.maskSrc=e.mask.toDataURL(),delete t.mask),t;}),brightness:eg,contrast:em,highlights:eb,shadows:ek,whites:eR,blacks:ez,vibrance:eT,saturation:eA,dehaze:eW,blur:e_,gaussian:eH,sharpen:eO,texture:eK,clarity:eX,bgThreshold:eq,bgThresholdBlack:eQ,hslAdjustments:e1}),y.current=!1);};(0,o.useEffect)(()=>{if(s.autoSaveInterval>0&&n){let e=setInterval(()=>{y.current&&(rP(),S.default.success("Auto-saved project"));},6e4*s.autoSaveInterval);return()=>clearInterval(e);}},[s.autoSaveInterval,n,e4,eg,em,eb,ek,eR,ez,eT,eA,eW,e_,eH,eO,eK,eX,eq,eQ,e1]),(0,o.useEffect)(()=>{let e=e=>{(e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),rP());};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e);},[e4,eg,em,eb,ek,eR,ez,eT,eA,eW,e_,eH,eO,eK,eX,eq,eQ,e1]),(0,o.useEffect)(()=>{let e=u.current;if(!e)return;let t=e=>e.preventDefault();return e.addEventListener("contextmenu",t),()=>e.removeEventListener("contextmenu",t);},[]);let rW=()=>{ep(f,h,{zoom:T,cropRect:tn,rulerPoints:rr.current,perspectivePoints:tu.current,hoverColor:tq,tool:tR.current?"draw":U,drawColor:tg,drawLineWidth:tm,layers:e4,overlaySelected:e7,activeLayerId:e3});};(0,o.useEffect)(()=>{rW();},[tn]),(0,o.useEffect)(()=>{let e=h.current;if(!e)return;let t=e=>{if("color"===U||"removeColor"===U){let t=V(e,h,T);tZ(t?{x:e.clientX,y:e.clientY,color:t}:null),rW();}else"draw"===U&&(tZ(tg?{x:e.clientX,y:e.clientY,color:tg}:null),rW());},r=e=>{if("color"===U){let t=V(e,h,T);t&&(tQ(t),tx(t),navigator.clipboard.writeText(t).catch(()=>{}),S.default.success(`Picked color ${t}`));}else if("removeColor"===U){let t=V(e,h,T);t&&(t5(t),t1(!0),H("pan"));}},l=()=>{("color"===U||"removeColor"===U)&&tZ(null);};return e.addEventListener("mousemove",t),e.addEventListener("click",r),e.addEventListener("mouseleave",l),()=>{e.removeEventListener("mousemove",t),e.removeEventListener("click",r),e.removeEventListener("mouseleave",l);};},[U,T,A]),(0,o.useEffect)(()=>{let e=e=>{(!tY.current||document.activeElement!==tY.current)&&("Escape"===e.key&&"crop"===U&&rH(),e.ctrlKey&&("z"===e.key||"Z"===e.key)&&p.undo(),e.ctrlKey&&e.shiftKey&&"Z"===e.key&&p.redo(),("c"===e.key||"C"===e.key)&&H("crop"),("h"===e.key||"H"===e.key)&&H("pan"),("v"===e.key||"V"===e.key)&&H("layer"),("t"===e.key||"T"===e.key)&&H("text"),("r"===e.key||"R"===e.key)&&$(90,h,f,p.history),("i"===e.key||"I"===e.key)&&H("color"),("p"===e.key||"P"===e.key)&&H("perspective"),("b"===e.key||"B"===e.key)&&H("draw"),"Delete"===e.key&&("layer"===U||"text"===U)&&e3&&rM(e3),e.ctrlKey&&"s"===e.key&&("layer"===U||"text"===U)&&(e.preventDefault(),rS(e3)),e.ctrlKey&&"i"===e.key&&(e.preventDefault(),eM(h,p)),e.ctrlKey&&e.shiftKey&&"S"===e.key&&(e.preventDefault(),ri(!0)));};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e);},[p.index,p.history,U,e3,e4]),(0,o.useEffect)(()=>{let e=e=>{let t=(t,r,l=!0)=>e.code===t&&!!l&&(e.preventDefault(),O(e=>e??U),H(r),!0);"Shift"===e.key?Y(!0):t("Space","pan")?F(!0):t("AltLeft","color","draw"===U)&&G(!0);},t=e=>{let t=(t,r)=>{e.code===t&&(r(!1),O(e=>(e&&H(e),null)));};"Shift"===e.key&&Y(!1),t("Space",F),t("AltLeft",G);};return window.addEventListener("keydown",e,{passive:!1}),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t);};},[U]);let rN=async()=>await ev(h,f,tu,p,tc,rW),r_=(0,o.useMemo)(()=>{if(("pan"===U||"select"===U)&&W)return"grabbing";switch(U){case"pan":return"grab";case"crop":case"ruler":case"perspective":case"removeColor":return"crosshair";case"color":return"copy";case"draw":return"pointer";case"text":return"text";default:return"default";}},[U,W]),rU=(0,o.useMemo)(()=>{let e=h.current;return e?`${e.width} \xd7 ${e.height}`:g?`${g.width} \xd7 ${g.height}`:null;},[h.current,g]),rH=()=>{ta(null),ts(!1);},r$=rj(rc,rb,rd);return(0,a.jsxs)("div",{style:{display:"flex",gap:12,position:"relative"},children:[(0,a.jsx)(R.default,{open:ro,onClose:()=>rs(!1),steps:r$}),(0,a.jsxs)("div",{ref:rc,children:[(0,a.jsx)(tX,{canvasRef:h,overlayRef:f,baseCanvas:g,upscaleImage:(e,t,r)=>ej(h,f,p,x,e6,rW,e,t,r),history:p,setTool:H,brightness:eg,setBrightness:ex,contrast:em,setContrast:ew,highlights:eb,setHighlights:eC,shadows:ek,setShadows:eS,whites:eR,setWhites:eD,blacks:ez,setBlacks:eL,vibrance:eT,setVibrance:eB,saturation:eA,setSaturation:eP,dehaze:eW,setDehaze:eN,blur:e_,setBlur:eU,gaussian:eH,setGaussian:e$,sharpen:eO,setSharpen:eF,texture:eK,setTexture:eG,clarity:eX,setClarity:eY,bgThreshold:eq,setBgThreshold:eJ,bgThresholdBlack:eQ,setBgThresholdBlack:e0,hslAdjustments:e1,setHslAdjustments:e8,setShowPerspectiveModal:tc,dpiMeasured:rl,setDpiMeasured:rn,exportImage:rk,onExport:l,showExportModal:ra,setShowExportModal:ri,onColorRemovalToolClick:()=>H("removeColor")}),(0,a.jsx)(d.default,{type:"text",icon:(0,a.jsx)(E.default,{}),onClick:()=>rs(!0),style:{width:"100%"},children:"Help"})]}),(0,a.jsxs)("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[(0,a.jsx)("div",{ref:rd,children:(0,a.jsx)(ru,{history:p,setZoom:B,tool:U,setTool:H,brushType:ty,setBrushType:tv,drawColor:tg,setDrawColor:tx,drawLineWidth:tm,setDrawLineWidth:tp,brushOpacity:tw,setBrushOpacity:tj,brushFlow:tb,setBrushFlow:tC,layers:e4,activeLayerId:e3,setLayerOpacity:(e,t)=>J(e6,e,t),setLayerBlend:(e,t)=>Q(e6,e,t),moveLayerUp:e=>ee(e6,e),moveLayerDown:e=>et(e6,e),deleteLayer:rM,selectLayer:e=>{el(e9,e),te(!0);let t=e4.find(t=>t.id===e);t&&"text"===t.type&&(tz(t.text||""),tT(t.font||"Arial"),tA(t.fontSize||32),tW(t.textColor||"#000000"),t_(t.fontWeight||"normal"),tH(!!t.fontItalic),tO(t.textDecoration||"none"),tK(t.textAlign||"left"));},mergeLayer:rS,textContent:tD,setTextContent:e=>{let t=e4.find(e=>e.id===e3);t&&"text"===t.type?rR(t.id,e):tz(e);},textFont:tL,setTextFont:e=>{let t=e4.find(e=>e.id===e3);t&&"text"===t.type?rI(t.id,e):tT(e);},textFontSize:tB,setTextFontSize:e=>{let t=e4.find(e=>e.id===e3);t&&"text"===t.type?rE(t.id,e):tA(e);},textColor:tP,setTextColor:e=>{let t=e4.find(e=>e.id===e3);t&&"text"===t.type?rT(t.id,e):tW(e);},textWeight:tN,setTextWeight:e=>{let t=e4.find(e=>e.id===e3);t&&"text"===t.type?rD(t.id,e):t_(e);},textItalic:tU,setTextItalic:e=>{let t=e4.find(e=>e.id===e3);t&&"text"===t.type?rz(t.id,e):tH(e);},textDecoration:t$,setTextDecoration:e=>{let t=e4.find(e=>e.id===e3);t&&"text"===t.type?rL(t.id,e):tO(e);},textAlign:tF,setTextAlign:e=>{let t=e4.find(e=>e.id===e3);t&&"text"===t.type?rB(t.id,e):tK(e);},onAddTextLayer:()=>{tV(!0),S.default.info("Click on the image to place the text");},isAddingText:tG,setIsAddingText:tV,onOpenMaskTool:e=>{t3(e),t4(!0);},onOpenLayerEffects:()=>{if(!e3){S.default.warning("Please select a layer first");return;}let e=e4.find(e=>e.id===e3);if(!e||"image"!==e.type){S.default.warning("Effects can only be applied to image layers");return;}rt(e3),t7(!0);}})}),(0,a.jsx)("div",{ref:rb,style:{flex:1},children:(0,a.jsx)(eE,{canvasRef:h,overlayRef:f,containerRef:u,offset:A,zoom:T,tool:U,currentCursor:r_,resolution:rU,hoverColor:tq,onMouseDown:e=>{let t=h.current.getBoundingClientRect(),r=(e.clientX-t.left)/T,l=(e.clientY-t.top)/T,n=(e,r,l="",n)=>{ey({canvasX:e,canvasY:r,canvasRect:t,containerRef:u,inlineEditorRef:tY,zoom:T,initial:l,layerId:null==n?void 0:n.layerId,layer:null==n?void 0:n.layer,textColor:tP,textFont:tL,textFontSize:tB,textWeight:tN,textItalic:tU,onCommit:t=>{n&&n.layerId?(ea(e6,n.layerId,t),rW()):en(h,e6,e9,te,rW,{text:t,font:tL,fontSize:tB,fontWeight:tN,fontItalic:tU,textDecoration:t$,textColor:tP,textAlign:tF},{x:e,y:r}),tV(!1);},onCancel:()=>{tV(!1);}});},a=(e,t,r,l,n)=>{let a=n*Math.PI/180,i=Math.cos(a),o=Math.sin(a),s=e-r,d=t-l;return{x:r+s*i-d*o,y:l+s*o+d*i};};if(e4.length>0){for(let t=e4.length-1;t>=0;t--){let i=e4[t],o=i.rect,s=i.rotation||0,d=o.x+o.w/2,c=o.y+o.h/2,u=a(r,l,d,c,-s),h=6/Math.max(1,T);if(!(u.x>=o.x-h&&u.y>=o.y-h&&u.x<=o.x+o.w+h&&u.y<=o.y+o.h+h))continue;let f=8/Math.max(1,T),g={tl:a(o.x,o.y,d,c,s),tr:a(o.x+o.w,o.y,d,c,s),bl:a(o.x,o.y+o.h,d,c,s),br:a(o.x+o.w,o.y+o.h,d,c,s)},x={t:a(o.x+o.w/2,o.y,d,c,s),b:a(o.x+o.w/2,o.y+o.h,d,c,s),l:a(o.x,o.y+o.h/2,d,c,s),r:a(o.x+o.w,o.y+o.h/2,d,c,s)},m=(e,t)=>Math.abs(r-e)<=f&&Math.abs(l-t)<=f,p=m(g.tl.x,g.tl.y),y=m(g.tr.x,g.tr.y),v=m(g.bl.x,g.bl.y),w=m(g.br.x,g.br.y);if("text"===U&&"text"===i.type&&2===e.detail){e9(i.id),te(!0),n(r,l,i.text||"",{layerId:i.id,layer:i});return;}if("layer"===U||"text"===U&&"text"===i.type){e9(i.id),te(!0);let t=m(x.t.x,x.t.y),n=m(x.b.x,x.b.y),a=m(x.l.x,x.l.y),s=m(x.r.x,x.r.y);if(t||n||a||s){let e=t?"t":n?"b":a?"l":"r";tr.current={layerId:i.id,handle:e,startX:r,startY:l,orig:{...o}};return;}if(p||y||v||w){if(e.shiftKey){let e=Math.atan2(l-c,r-d);tl.current={layerId:i.id,startX:r,startY:l,centerX:d,centerY:c,startAngle:e,originalRotation:i.rotation||0};return;}let t=p?"tl":y?"tr":v?"bl":"br";tr.current={layerId:i.id,handle:t,startX:r,startY:l,orig:{...o}};return;}tt.current={layerId:i.id,startX:r,startY:l,origX:o.x,origY:o.y};return;}break;}te(!1);}if("color"===U&&e.altKey&&2===e.button&&H("draw"),("draw"===U||"color"===U)&&e.altKey&&2===e.button){e.preventDefault(),tR.current=!0,tI.current=e.clientX,tE.current=tm;return;}if("pan"===U||"select"===U)N(!0),_.current={x:e.clientX-A.x,y:e.clientY-A.y};else if("crop"===U)ti.current={x:r,y:l},ta({x:r,y:l,w:1,h:1});else if("ruler"===U){if(rr.current){rr.current.x2=r,rr.current.y2=l;let e=r-rr.current.x1,t=l-rr.current.y1,n=Math.sqrt(e*e+t*t),a=Math.round(n/(h.current.width/(window.devicePixelRatio||1))*96);rn(a),S.default.info(`Distance: ${Math.round(n)} px, estimated DPI: ${a}`),rr.current=null;}else rr.current={x1:r,y1:l,x2:r,y2:l};}else if("perspective"===U){th();let e=tf(r,l);if(e>=0){tu.current[e]=r,tu.current[e+1]=l,rW();return;}let t=tu.current,n=!1;for(let e=0;e<8;e+=2)if(isNaN(t[e])||isNaN(t[e+1])){t[e]=r,t[e+1]=l,n=!0;break;}if(!n){let e=tf(r,l,200);e>=0?(tu.current[e]=r,tu.current[e+1]=l):(tu.current[0]=r,tu.current[1]=l);}rW();}else if("draw"===U)tS(!0),tM.current=[{x:r,y:l}],h.current&&(ef(h.current.getContext("2d"),[{x:r,y:l},{x:r,y:l}],{color:tg,lineWidth:tm,opacity:tw,flow:tb,type:ty}),rW());else if("text"===U){n(r,l,tD||"");return;}},onMouseMove:e=>{if(tR.current&&null!==tI.current){let t=e.clientX-tI.current;tp(Math.max(1,Math.round(10*Math.min(500,tE.current+t/2))/10)),rW();return;}if(("pan"===U||"select"===U)&&W&&_.current){P({x:e.clientX-_.current.x,y:e.clientY-_.current.y});return;}try{let t=h.current.getBoundingClientRect(),r=(e.clientX-t.left)/T,l=(e.clientY-t.top)/T,n=null,a=(e,t,r,l,n)=>{let a=n*Math.PI/180,i=Math.cos(a),o=Math.sin(a),s=e-r,d=t-l;return{x:r+s*i-d*o,y:l+s*o+d*i};};for(let e=e4.length-1;e>=0;e--){let t=e4[e],i=t.rect,o=t.rotation||0,s=i.x+i.w/2,d=i.y+i.h/2;if(t.locked||"layer"!==U&&"text"!==U){n=null;break;}let c=a(r,l,s,d,-o),u=c.x>=i.x&&c.y>=i.y&&c.x<=i.x+i.w&&c.y<=i.y+i.h,h=8/Math.max(1,T),f={tl:a(i.x,i.y,s,d,o),tr:a(i.x+i.w,i.y,s,d,o),bl:a(i.x,i.y+i.h,s,d,o),br:a(i.x+i.w,i.y+i.h,s,d,o)},g={t:a(i.x+i.w/2,i.y,s,d,o),b:a(i.x+i.w/2,i.y+i.h,s,d,o),l:a(i.x,i.y+i.h/2,s,d,o),r:a(i.x+i.w,i.y+i.h/2,s,d,o)},x=(e,t)=>Math.abs(r-e)<=h&&Math.abs(l-t)<=h;if(x(f.tl.x,f.tl.y)){n="tl";break;}if(x(f.tr.x,f.tr.y)){n="tr";break;}if(x(f.bl.x,f.bl.y)){n="bl";break;}if(x(f.br.x,f.br.y)){n="br";break;}if(x(g.t.x,g.t.y)){n="t";break;}if(x(g.b.x,g.b.y)){n="b";break;}if(x(g.l.x,g.l.y)){n="l";break;}if(x(g.r.x,g.r.y)){n="r";break;}if(u){n="move";break;}}u.current&&(n?"move"===n?u.current.style.cursor="move":"t"===n||"b"===n?u.current.style.cursor="ns-resize":"l"===n||"r"===n?u.current.style.cursor="ew-resize":e.shiftKey&&("tl"===n||"tr"===n||"bl"===n||"br"===n)?u.current.style.cursor="crosshair":"tl"===n||"br"===n?u.current.style.cursor="nwse-resize":u.current.style.cursor="nesw-resize":u.current.style.cursor=r_);}catch(e){}let t=tt.current;if(t){let r=h.current.getBoundingClientRect(),l=(e.clientX-r.left)/T,n=(e.clientY-r.top)/T,a=l-t.startX,i=n-t.startY;e6(e=>e.map(e=>e.id!==t.layerId||e.locked?e:{...e,rect:{x:t.origX+a,y:t.origY+i,w:e.rect.w,h:e.rect.h}})),rW();return;}if("crop"===U&&ti.current){let t=h.current.getBoundingClientRect(),r={x:(e.clientX-t.left)/T,y:(e.clientY-t.top)/T};ta({x:Math.min(ti.current.x,r.x),y:Math.min(ti.current.y,r.y),w:Math.abs(r.x-ti.current.x),h:Math.abs(r.y-ti.current.y)}),rW();}else if("draw"===U&&tk&&h.current){let t=h.current.getBoundingClientRect(),r=(e.clientX-t.left)/T,l=(e.clientY-t.top)/T;tM.current.push({x:r,y:l}),ef(h.current.getContext("2d"),tM.current.slice(-2),{color:tg,lineWidth:tm,opacity:tw,flow:tb,type:ty}),rW();}else{let t=tl.current;if(t){let r=h.current.getBoundingClientRect(),l=(e.clientX-r.left)/T,n=(e.clientY-r.top)/T,{layerId:a,centerX:i,centerY:o,startAngle:s,originalRotation:d}=t,c=180/Math.PI*(Math.atan2(n-o,l-i)-s);e6(e=>e.map(e=>e.id!==a||e.locked?e:{...e,rotation:d+c})),rW();return;}let r=tr.current;if(r){let t=h.current.getBoundingClientRect(),l=(e.clientX-t.left)/T,n=(e.clientY-t.top)/T,{layerId:a,handle:i,startX:o,startY:s,orig:d}=r,c=d.x,u=d.y,f=d.w,g=d.h;if("t"===i?(u=n,g=d.h+(d.y-u)):"b"===i?g=n-d.y:"l"===i?(c=l,f=d.w+(d.x-c)):"r"===i?f=l-d.x:"tl"===i?(c=l,u=n,f=d.w+(d.x-c),g=d.h+(d.y-u)):"tr"===i?(u=n,f=l-d.x,g=d.h+(d.y-u)):"bl"===i?(c=l,f=d.w+(d.x-c),g=n-d.y):"br"===i&&(f=l-d.x,g=n-d.y),e.shiftKey&&("tl"===i||"tr"===i||"bl"===i||"br"===i)){let e=d.w/Math.max(1,d.h),t=f<0?-1:1,r=g<0?-1:1,l=Math.abs(f),n=Math.abs(g);l/Math.max(1,n)>e?g=l/e*r:f=n*e*t,"tl"===i?(c=d.x+(d.w-f),u=d.y+(d.h-g)):"tr"===i?u=d.y+(d.h-g):"bl"===i&&(c=d.x+(d.w-f));}f=Math.max(4/T,f),g=Math.max(4/T,g),e6(e=>e.map(e=>{if(e.id!==a||e.locked)return e;if("text"===e.type){let t=Math.max(8,Math.round(Math.max(1,g)-10));return{...e,rect:{x:c,y:u,w:f,h:g},fontSize:t};}return{...e,rect:{x:c,y:u,w:f,h:g}};})),rW();return;}rW();}},onMouseUp:()=>{if(tR.current){tR.current=!1,tI.current=null,tE.current=tm;return;}if(tt.current||tr.current||tl.current){tt.current=null,tr.current=null,tl.current=null,rW();return;}N(!1),_.current=null,"crop"===U&&tn&&(tn.w>5&&tn.h>5?ts(!0):ta(null)),"draw"===U&&tk&&(tS(!1),p.push(h.current.toDataURL(),"Draw"));}})})]}),(0,a.jsx)(C.default,{title:"Confirm Crop",open:to,onOk:()=>{tn&&(ti.current=null,K(h,f,tn,ta,p),ts(!1));},onCancel:rH,okText:"Crop",cancelText:"Cancel",children:(0,a.jsx)("p",{children:"Are you sure you want to crop the image?"})}),(0,a.jsxs)(C.default,{title:"Perspective correction",open:td,onOk:()=>rN(),onCancel:()=>tc(!1),okText:"Apply",children:[(0,a.jsx)("p",{children:"Click four points on the image (clockwise) to define the corners, then Apply."}),(0,a.jsx)("p",{style:{marginTop:8},children:"Tip: click a corner again to move it (or click near a point to reposition)."})]}),(0,a.jsx)(eV,{open:t0,onCancel:()=>{t1(!1),t5(null);},onApply:e=>{eI(h,e,p,"Color Removal"),t1(!1),t5(null);},selectedColor:t2,canvasRef:h}),(0,a.jsx)(eZ,{open:t8,onCancel:()=>{t4(!1),t3(null);},onApply:e=>{if(!t6)return;let t=e4.find(e=>e.id===t6);if(!t||"image"!==t.type||!t.img){S.default.error("Can only apply mask to image layers");return;}let r=document.createElement("canvas");r.width=e.width,r.height=e.height;let l=r.getContext("2d");l.drawImage(e,0,0);let n=l.getImageData(0,0,r.width,r.height),a=n.data;for(let e=0;e<a.length;e+=4){let t=a[e];a[e+3]=t;}l.putImageData(n,0,0),e6(e=>{let t=e.map(e=>e.id===t6?{...e,mask:r}:e);return ep(f,h,{zoom:T,cropRect:tn,rulerPoints:rr.current,perspectivePoints:tu.current,hoverColor:tq,tool:U,drawColor:tg,drawLineWidth:tm,layers:t,overlaySelected:e7,activeLayerId:e3}),t;}),t4(!1),t3(null),S.default.success("Mask applied to layer");},sourceCanvas:(()=>{let e=rA();if(!e)return null;let t=document.createElement("canvas");if("image"===e.type&&e.img)t.width=e.img.width,t.height=e.img.height,t.getContext("2d").drawImage(e.img,0,0);else if("text"===e.type){t.width=e.rect.w,t.height=e.rect.h;let r=t.getContext("2d");r.fillStyle="#ffffff",r.fillRect(0,0,t.width,t.height);let l=e.fontItalic?"italic":"normal",n=e.fontWeight||"normal",a=e.fontSize||16;r.font=`${l} ${n} ${a}px ${e.font||"Arial"}`,r.fillStyle=e.textColor||"#000000",r.textAlign=e.textAlign||"left",r.textBaseline="top";let i=(e.text||"").split("\n"),o=1.2*a,s=0;for(let e of i)r.fillText(e,0,s),s+=o;}return t;})(),existingMask:null===(c=rA())||void 0===c?void 0:c.mask}),(0,a.jsx)(e2,{open:t9,onCancel:()=>{t7(!1),rt(null);},onApply:e=>{re&&(e6(t=>t.map(t=>t.id===re?{...t,img:e}:t)),setTimeout(()=>{rW();},0),t7(!1),rt(null));},layer:e4.find(e=>e.id===re)})]});};var rC=r("f80e7e46"),rk=l._(rC);let rS=({open:e,onCancel:t,onSave:r,initialSettings:l})=>{let[n]=rk.default.useForm();return(0,o.useEffect)(()=>{e&&n.setFieldsValue(l);},[e,l,n]),(0,a.jsx)(C.default,{title:"Editor Settings",open:e,onOk:()=>{n.validateFields().then(e=>{r(e),t();});},onCancel:t,children:(0,a.jsxs)(rk.default,{form:n,layout:"vertical",children:[(0,a.jsx)(rk.default.Item,{name:"autoSaveInterval",label:"Auto Save Interval (minutes)",help:"Set to 0 to disable auto-save",rules:[{required:!0,message:"Please enter auto save interval"}],children:(0,a.jsx)(eW.default,{min:0,max:60,style:{width:"100%"}})}),(0,a.jsx)(rk.default.Item,{name:"maxHistory",label:"Max History Steps",help:"Maximum number of undo steps to keep. The initial image is always preserved.",rules:[{required:!0,message:"Please enter max history steps"}],children:(0,a.jsx)(eW.default,{min:5,max:100,style:{width:"100%"}})})]})});};var rM=r("e015c964"),rR=l._(rM),rI=r("c213ceab"),rE=l._(rI),rD=r("9cfcaa09"),rz=l._(rD),rL=r("522a0302"),rT=l._(rL);let{Title:rB,Text:rA}=rT.default,rP=({projects:e,onLoad:t,onDelete:r})=>0===e.length?null:(0,a.jsxs)("div",{style:{marginTop:24},children:[(0,a.jsx)(rB,{level:4,children:"Recent Projects"}),(0,a.jsx)(rR.default,{gutter:[16,16],children:e.map(e=>(0,a.jsx)(rE.default,{xs:12,sm:8,md:6,lg:4,children:(0,a.jsx)(u.default,{hoverable:!0,cover:(0,a.jsx)("div",{style:{height:120,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f0f0f0"},children:(0,a.jsx)("img",{alt:e.name,src:e.thumbnail,style:{maxWidth:"100%",maxHeight:"100%"}})}),onClick:()=>t(e),actions:[(0,a.jsx)(rz.default,{title:"Delete project?",onConfirm:t=>{null==t||t.stopPropagation(),r(e.id);},onCancel:e=>null==e?void 0:e.stopPropagation(),okText:"Yes",cancelText:"No",children:(0,a.jsx)(t7.default,{onClick:e=>e.stopPropagation(),style:{color:"red"}},"delete")})],children:(0,a.jsx)(u.default.Meta,{title:(0,a.jsx)(rA,{ellipsis:!0,style:{width:"100%"},children:e.name}),description:new Date(e.updatedAt).toLocaleDateString()})})},e.id))})]});var rW=r("e0fc3175"),rN=l._(rW),r_=r("dcbd67b9"),rU=l._(r_);let rH=({onUpload:e})=>(0,a.jsxs)(rN.default.Dragger,{beforeUpload:e,showUploadList:!1,accept:".png,.jpg,.jpeg",height:200,children:[(0,a.jsx)("p",{className:"ant-upload-drag-icon",children:(0,a.jsx)(rU.default,{})}),(0,a.jsx)("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),(0,a.jsx)("p",{className:"ant-upload-hint",children:"Support for a single upload. You can also paste an image from clipboard."})]}),{Title:r$}=rT.default,rO=({projectName:e,onClose:t})=>(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,a.jsx)(r$,{level:5,style:{margin:0},children:e?`Editing: ${e}`:"New Project"}),(0,a.jsx)(d.default,{onClick:t,danger:!0,children:"Close Editor"})]}),rF="projects",rK=()=>new Promise((e,t)=>{let r=indexedDB.open("PicsEditorDB",1);r.onerror=()=>{t("Error opening database");},r.onsuccess=t=>{e(t.target.result);},r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(rF)||t.createObjectStore(rF,{keyPath:"id"});};}),rG=async e=>{let t=await rK();return new Promise((r,l)=>{let n=t.transaction([rF],"readwrite").objectStore(rF).put(e);n.onsuccess=()=>r(),n.onerror=()=>l("Error saving project");});},rV=async()=>{let e=await rK();return new Promise((t,r)=>{let l=e.transaction([rF],"readonly").objectStore(rF).getAll();l.onsuccess=()=>{let e=l.result;e.sort((e,t)=>t.updatedAt-e.updatedAt),t(e);},l.onerror=()=>r("Error fetching projects");});},rX=async e=>{let t=await rK();return new Promise((r,l)=>{let n=t.transaction([rF],"readwrite").objectStore(rF).delete(e);n.onsuccess=()=>r(),n.onerror=()=>l("Error deleting project");});},rY=()=>{let[e,t]=(0,o.useState)([]),[r,l]=(0,o.useState)(null),[n,a]=(0,o.useState)(null),i=(0,o.useCallback)(()=>{rV().then(t).catch(e=>console.error("Failed to load projects from DB",e));},[]);(0,o.useEffect)(()=>{i();},[i]);let s=(0,o.useCallback)(async(e,n)=>{if(!e)return;let a={id:(null==r?void 0:r.id)||Date.now().toString(),name:(null==r?void 0:r.name)||`Project ${new Date().toLocaleString()}`,thumbnail:e,baseImage:e,state:n,createdAt:(null==r?void 0:r.createdAt)||Date.now(),updatedAt:Date.now()};try{await rG(a),t(e=>(e.some(e=>e.id===a.id)?e.map(e=>e.id===a.id?a:e):[a,...e]).sort((e,t)=>t.updatedAt-e.updatedAt)),l(a),S.default.success("Project saved successfully!");}catch(e){console.error(e),S.default.error("Failed to save project");}},[r]);return{savedProjects:e,currentProject:r,initialState:n,loadProjects:i,saveProject:s,deleteProject:(0,o.useCallback)(async e=>{try{await rX(e),t(t=>t.filter(t=>t.id!==e)),S.default.success("Project deleted");}catch(e){console.error(e),S.default.error("Failed to delete project");}},[]),loadProjectIntoEditor:(0,o.useCallback)(e=>{a(e.state),l(e);},[]),clearCurrentProject:(0,o.useCallback)(()=>{l(null),a(null);},[]),setInitialState:a,setCurrentProject:l};},rq={autoSaveInterval:5,maxHistory:20},rZ="pics_editor_settings",rJ=()=>{let[e,t]=(0,o.useState)(rq),[r,l]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{let e=localStorage.getItem(rZ);if(e)try{t({...rq,...JSON.parse(e)});}catch(e){console.error("Failed to load settings",e);}},[]),{settings:e,showSettings:r,updateSettings:(0,o.useCallback)(e=>{t(e),localStorage.setItem(rZ,JSON.stringify(e)),S.default.success("Settings saved");},[]),toggleSettings:(0,o.useCallback)(e=>{l(e);},[])};},rQ=()=>{let[e,t]=(0,o.useState)(null),[r,l]=(0,o.useState)(null),[n,a]=(0,o.useState)(!1),i=(0,o.useRef)(0),s=(0,o.useCallback)(r=>{let n=new FileReader;return n.onload=n=>{if(e)l(r);else{var a;t(null===(a=n.target)||void 0===a?void 0:a.result);}},n.readAsDataURL(r),a(!1),i.current=0,!1;},[e]),d=(0,o.useCallback)(()=>{t(null),l(null),S.default.info("Image cleared.");},[]);return(0,o.useEffect)(()=>{let e=e=>{var t;let r=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!r)return;let l=Array.from(r).find(e=>e.type.includes("image"));if(l){let t=l.getAsFile();t&&(s(t),S.default.success("Image pasted from clipboard!"),e.preventDefault());}};return window.addEventListener("paste",e),()=>window.removeEventListener("paste",e);},[s]),{preview:e,setPreview:t,addOnFile:r,setAddOnFile:l,dragging:n,setDragging:a,dragCounter:i,handleUpload:s,handleClear:d};},r0=()=>{let{savedProjects:e,currentProject:t,initialState:r,saveProject:l,deleteProject:n,loadProjectIntoEditor:i,clearCurrentProject:o}=rY(),{settings:s,showSettings:c,updateSettings:h,toggleSettings:g}=rJ(),{preview:m,setPreview:y,addOnFile:w,setAddOnFile:b,dragging:C,setDragging:k,dragCounter:S,handleUpload:M,handleClear:R}=rQ();return(0,a.jsxs)(v.default,{setDragging:k,dragCounter:S,handleUpload:M,children:[(0,a.jsx)(u.default,{title:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("span",{children:["\u{1F5BC}\uFE0F Pics Editor ",(0,a.jsx)(x.default,{color:"cyan",children:"Beta"})]}),(0,a.jsx)(d.default,{icon:(0,a.jsx)(p.default,{}),onClick:()=>g(!0),children:"Settings"})]}),variant:"borderless",children:(0,a.jsxs)(f.default,{direction:"vertical",style:{width:"100%"},size:"large",children:[!C&&!m&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(rH,{onUpload:M}),(0,a.jsx)(rP,{projects:e,onLoad:e=>{y(e.baseImage),i(e);},onDelete:n})]}),C&&(0,a.jsx)(j.default,{}),m&&(0,a.jsxs)("div",{children:[(0,a.jsx)(rO,{projectName:null==t?void 0:t.name,onClose:()=>{R(),o();}}),(0,a.jsx)(rb,{addOnFile:w,setAddOnFile:b,imageUrl:m,initialState:r,onSave:e=>{m&&l(m,e);},settings:s,onExport:e=>{console.log("exported blob",e);}})]})]})}),(0,a.jsx)(rS,{open:c,onCancel:()=>g(!1),onSave:h,initialSettings:s})]});};}}]);
//# sourceMappingURL=cf77e31b-async.71d7c0c1.js.map