(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]||[]).push([["ad692153"],{"183d4b64":function(e,t,l){l.d(t,"__esModule",{value:!0}),l.e(t,{default:function(){return t$;}});var r=l("777fffbe"),n=l("852bbaa9"),a=l("1a7c85b4"),i=l("d322be42"),s=n._(i),d=l("28c7d19c"),o=l("e9bcd22d"),c=r._(o),u=l("b091b25f"),f=r._(u),h=l("e23084de"),x=r._(h),g=l("1353d6cc"),m=r._(g),v=l("13dfe186"),p=r._(v),j=l("85d53cee"),y=r._(j),w=l("743075ef"),b=l("b2a1469e"),C=r._(b),S=l("d4a32650"),k=r._(S),A=l("ea21718c"),E=r._(A),R=l("d70e0f0a"),D=r._(R),M=l("1c8d1214"),O=r._(M),I=l("f2806aec"),B=r._(I),P=l("81108cbb"),T=r._(P),L=l("d2d0b3b6"),_=r._(L),N={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},F=l("85c4e0d9"),z=r._(F),V=s.forwardRef(function(e,t){return s.createElement(z.default,(0,_.default)((0,_.default)({},e),{},{ref:t,icon:N}));}),K=l("0a08762b"),X=r._(K),Y=l("36ede29e"),U=r._(Y),H=l("34f8e1c9"),W=r._(H),q=l("076b2e3c"),J=r._(q),G=l("918eb6e0"),$=r._(G),Q=l("702fd995"),Z=r._(Q),ee=l("c63de1ad"),et=r._(ee),el=l("1ee4d6ad"),er=r._(el),en=l("e2b6eb70"),ea=r._(en),ei=l("62318dd7"),es=r._(ei),ed=l("d7a2efa2"),eo=r._(ed),ec=s.forwardRef(function(e,t){return s.createElement(z.default,(0,_.default)((0,_.default)({},e),{},{ref:t,icon:eo.default}));}),eu={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},ef=s.forwardRef(function(e,t){return s.createElement(z.default,(0,_.default)((0,_.default)({},e),{},{ref:t,icon:eu}));}),eh=l("70bd2056"),ex=r._(eh),eg=l("4e1dc2f8"),em=l("dfa4ac87"),ev=r._(em),ep=l("d5daf11a"),ej=r._(ep),ey=l("3eb6f542"),ew=r._(ey),eb=l("2aa4d12e"),eC=r._(eb),eS=l("c9d8dc0b"),ek=r._(eS),eA=l("9f0970b1"),eE=r._(eA);let eR=({visible:e,onCancel:t,canvas:l})=>{let[r,n]=(0,s.useState)("png"),[i,d]=(0,s.useState)(1),[o,c]=(0,s.useState)(1),[u,f]=(0,s.useState)(!0),h=(e,t)=>{let l=document.createElement("a");l.href=URL.createObjectURL(e),l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l);};return(0,a.jsx)(ev.default,{title:"Export Image",open:e,onCancel:t,footer:[(0,a.jsx)(C.default,{onClick:t,children:"Cancel"},"cancel"),(0,a.jsx)(C.default,{type:"primary",onClick:()=>{if(l){if("json"===r)h(new Blob([JSON.stringify(l.toJSON())],{type:"application/json"}),"project.json");else if("svg"===r)h(new Blob([l.toSVG()],{type:"image/svg+xml"}),"image.svg");else{let e={format:r,quality:i,multiplier:o},t=null,n=null;if(u){let r=l.getObjects();if(r.length>0){let a=1/0,i=1/0,s=-1/0,d=-1/0;r.forEach(e=>{let t=e.getBoundingRect();t.left<a&&(a=t.left),t.top<i&&(i=t.top),t.left+t.width>s&&(s=t.left+t.width),t.top+t.height>d&&(d=t.top+t.height);}),e={...e,left:a,top:i,width:s-a,height:d-i},t=l.backgroundColor,n=l.backgroundImage,l.backgroundColor=null,l.backgroundImage=null;}}let a=l.toDataURL(e);u&&(l.backgroundColor=t,l.backgroundImage=n);let s=document.createElement("a");s.download=`image.${r}`,s.href=a,document.body.appendChild(s),s.click(),document.body.removeChild(s);}ek.default.success("Export successful"),t();}},children:"Export"},"export")],children:(0,a.jsxs)(ej.default,{layout:"vertical",children:[(0,a.jsx)(ej.default.Item,{label:"Format",children:(0,a.jsxs)(ew.default,{value:r,onChange:e=>n(e),children:[(0,a.jsx)(ew.default.Option,{value:"png",children:"PNG"}),(0,a.jsx)(ew.default.Option,{value:"jpeg",children:"JPEG"}),(0,a.jsx)(ew.default.Option,{value:"svg",children:"SVG"}),(0,a.jsx)(ew.default.Option,{value:"json",children:"JSON (Project)"})]})}),"json"!==r&&"svg"!==r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ej.default.Item,{label:"Quality (0.1 - 1)",children:(0,a.jsx)(eC.default,{min:.1,max:1,step:.1,value:i,onChange:e=>d(e||1),style:{width:"100%"}})}),(0,a.jsx)(ej.default.Item,{label:"Multiplier (Scale)",children:(0,a.jsx)(eC.default,{min:.1,max:5,step:.1,value:o,onChange:e=>c(e||1),style:{width:"100%"}})}),(0,a.jsx)(ej.default.Item,{children:(0,a.jsx)(eE.default,{checked:u,onChange:e=>f(e.target.checked),children:"Trim Whitespace (Export content only)"})})]})]})});};var eD=l("8e6ac0a6"),eM=r._(eD),eO=l("7b738819"),eI=r._(eO),eB=l("97125d22"),eP=r._(eB);let eT=(e,t,l)=>{if(0!==t.length){if(e.save(),e.globalAlpha=l.opacity*l.flow,"soft"===l.type?(e.shadowColor=l.color,e.shadowBlur=.5*l.lineWidth,e.lineWidth=.5*l.lineWidth):(e.shadowBlur=0,e.lineWidth=l.lineWidth),e.strokeStyle=l.color,e.fillStyle=l.color,e.lineCap="round",e.lineJoin="round",e.beginPath(),1===t.length)e.arc(t[0].x,t[0].y,e.lineWidth/2,0,2*Math.PI),e.fill();else{e.moveTo(t[0].x,t[0].y);for(let l=1;l<t.length;l++)e.lineTo(t[l].x,t[l].y);e.stroke();}e.restore();}},eL=(e,t,l,r,n,a=1)=>{e.save(),e.strokeStyle=n,e.lineWidth=2/a,e.beginPath(),e.arc(t,l,r/2,0,2*Math.PI),e.stroke(),e.restore();},e_=(e,t,l=1,r={x:0,y:0})=>{if(!t.current)return null;let n=t.current.getBoundingClientRect();return{x:(e.clientX-n.left-r.x)/l,y:(e.clientY-n.top-r.y)/l};},eN=(e,t,l,r=!1,n=0)=>{let a=t.replace("#",""),i=parseInt(a.substring(0,2),16),s=parseInt(a.substring(2,4),16),d=parseInt(a.substring(4,6),16),o=new Uint8Array(e.length/4),c=Math.sqrt(195075),u=l/100,f=n/100;for(let t=0;t<e.length;t+=4){let l;let a=Math.sqrt(Math.pow(e[t]-i,2)+Math.pow(e[t+1]-s,2)+Math.pow(e[t+2]-d,2))/c;if(0===n)l=a<=u?0:1;else{let e=a-u;l=e<-f?0:e>f?1:(e+f)/(2*f);}r&&(l=1-l),o[t/4]=Math.round(255*l);}return o;},eF=(e,t,l)=>{if(!(t instanceof eg.FabricImage))return;let r=t.getElement(),n=r.width,a=r.height,i=document.createElement("canvas");i.width=n,i.height=a;let s=i.getContext("2d");s.drawImage(r,0,0,n,a);let d=s.getImageData(0,0,n,a),o=d.data;l.getContext("2d");let c=document.createElement("canvas");c.width=n,c.height=a;let u=c.getContext("2d");u.drawImage(l,0,0,n,a);let f=u.getImageData(0,0,n,a).data;for(let e=0;e<o.length;e+=4){let t=f[e];o[e+3]=t;}s.putImageData(d,0,0);let h=new eg.FabricImage(i);h.set({left:t.left,top:t.top,scaleX:t.scaleX,scaleY:t.scaleY,angle:t.angle,skewX:t.skewX,skewY:t.skewY,flipX:t.flipX,flipY:t.flipY,originX:t.originX,originY:t.originY,opacity:t.opacity});let x=e.getObjects().indexOf(t);e.remove(t),e.add(h),e.moveObjectTo(h,x),e.setActiveObject(h),e.requestRenderAll();},ez=({open:e,onCancel:t,onApply:l,selectedColor:r,sourceCanvas:n})=>{let[i,d]=(0,s.useState)(30),[o,c]=(0,s.useState)("normal"),[u,f]=(0,s.useState)(!1),[h,x]=(0,s.useState)(0),[g,m]=(0,s.useState)(r||"#000000"),[v,p]=(0,s.useState)(!1);(0,s.useEffect)(()=>{r&&m(r);},[r]),(0,s.useEffect)(()=>{let e=e=>{"Alt"===e.key&&p(!0);},t=e=>{"Alt"===e.key&&p(!1);};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t);};},[]);let[j,y]=(0,s.useState)("remove"),[w,b]=(0,s.useState)(20),[S,k]=(0,s.useState)(1),[A,R]=(0,s.useState)("hard"),[D,M]=(0,s.useState)(!1),[O,I]=(0,s.useState)(null),[B,P]=(0,s.useState)(null),[T,L]=(0,s.useState)({scale:1,x:0,y:0}),_=(0,s.useRef)(null),N=(0,s.useRef)(null),F=(0,s.useRef)(null),z=(0,s.useRef)(null),V=(0,s.useRef)([]),K=(0,s.useRef)(null),[X,Y]=(0,s.useState)([]),[U,H]=(0,s.useState)(-1);(0,s.useEffect)(()=>{if(e&&n&&N.current&&F.current&&z.current&&_.current){let e=n.width,t=n.height,{clientWidth:l,clientHeight:r}=_.current,a=Math.min(l/e,r/t),i=e*a,s=t*a;L({scale:a,x:(l-i)/2,y:(r-s)/2}),N.current.width=e,N.current.height=t,F.current.width=e,F.current.height=t,z.current.width=l,z.current.height=r,N.current.getContext("2d").drawImage(n,0,0);let d=F.current.getContext("2d");d.fillStyle="white",d.fillRect(0,0,e,t),q();}},[e,n]);let q=()=>{if(!F.current)return;let e=F.current.getContext("2d").getImageData(0,0,F.current.width,F.current.height),t=X.slice(0,U+1);t.push(e),Y(t),H(t.length-1);},G=()=>{if(!n||!N.current||!F.current)return;let e=n.width,t=n.height,l=N.current.getContext("2d"),r=F.current.getContext("2d");l.clearRect(0,0,e,t),l.drawImage(n,0,0);let a=l.getImageData(0,0,e,t),s=eN(a.data,g,i,u,h),d=r.getImageData(0,0,e,t),c=l.createImageData(e,t);for(let l=0;l<e*t;l++){let e=a.data[4*l],t=a.data[4*l+1],r=a.data[4*l+2],n=a.data[4*l+3],i=s[l]/255*n*(d.data[4*l]/255);c.data[4*l]=e,c.data[4*l+1]=t,c.data[4*l+2]=r,c.data[4*l+3]=i;}if("mask"===o)for(let l=0;l<e*t;l++){let e=c.data[4*l+3];c.data[4*l]=e,c.data[4*l+1]=e,c.data[4*l+2]=e,c.data[4*l+3]=255;}l.putImageData(c,0,0);};(0,s.useEffect)(()=>{G();},[i,u,h,g,o,U]);let $=e=>{if(!n||!z.current)return;let t=e_(e,z,T.scale,{x:T.x,y:T.y});if(t){let e=n.getContext("2d");if(!e)return;let l=Math.max(0,Math.min(t.x,n.width-1)),r=Math.max(0,Math.min(t.y,n.height-1)),a=e.getImageData(l,r,1,1).data;m("#"+[a[0],a[1],a[2]].map(e=>e.toString(16).padStart(2,"0")).join(""));}},Q=()=>{D&&(M(!1),V.current=[],K.current=null,q(),G());},Z=e=>{F.current&&(eT(F.current.getContext("2d"),e,{color:"remove"===j?"#000000":"#ffffff",lineWidth:w,opacity:S,flow:1,type:A}),G());};return(0,s.useEffect)(()=>{if(!z.current||!O)return;let e=z.current.getContext("2d");e.clearRect(0,0,z.current.width,z.current.height);let t=O.x*T.scale+T.x,l=O.y*T.scale+T.y,r=w*T.scale;if(eL(e,t,l,r,"#fff"),eL(e,t,l,r,"#000"),v&&B){let r=Math.min(z.current.width-9-4,Math.max(13,t+12)),n=Math.min(z.current.height-9-4,Math.max(13,l+12));e.beginPath(),e.arc(r,n,11,0,2*Math.PI),e.fillStyle="#00000088",e.fill(),e.beginPath(),e.arc(r,n,9,0,2*Math.PI),e.fillStyle=B,e.fill(),e.font="12px sans-serif",e.fillStyle="#fff",e.textAlign="center",e.fillText(B.toUpperCase(),r,n+9+14);}},[O,w,T,v,B]),(0,a.jsx)(ev.default,{title:"Mask",open:e,onCancel:t,onOk:()=>{N.current&&l(N.current);},width:1e3,style:{top:20},maskClosable:!1,children:(0,a.jsxs)("div",{style:{display:"flex",gap:16},children:[(0,a.jsx)("div",{style:{width:300},children:(0,a.jsxs)(E.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"Target Color:"}),(0,a.jsx)(eP.default,{value:g,onChange:e=>m(e.toHexString()),showText:!0}),(0,a.jsx)("div",{style:{fontSize:12,color:"#999",marginTop:4},children:"Hold Alt + Click on image to pick color"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{children:["Tolerance: ",i,"%"]}),(0,a.jsx)(eM.default,{value:i,onChange:d})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{children:["Feather: ",h,"%"]}),(0,a.jsx)(eM.default,{value:h,onChange:x})]}),(0,a.jsx)("div",{children:(0,a.jsxs)(E.default,{children:[(0,a.jsx)("span",{children:"Invert:"}),(0,a.jsx)(C.default,{onClick:()=>f(!u),type:u?"primary":"default",children:u?"Yes":"No"})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"Preview Mode:"}),(0,a.jsxs)(eI.default.Group,{value:o,onChange:e=>c(e.target.value),children:[(0,a.jsx)(eI.default.Button,{value:"normal",children:"Normal"}),(0,a.jsx)(eI.default.Button,{value:"mask",children:"Mask"})]})]}),(0,a.jsxs)("div",{style:{borderTop:"1px solid #eee",paddingTop:16,marginTop:16},children:[(0,a.jsx)("h4",{children:"Manual Adjustments"}),(0,a.jsxs)(E.default,{children:[(0,a.jsx)(C.default,{type:"remove"===j?"primary":"default",onClick:()=>y("remove"),children:"Remove"}),(0,a.jsx)(C.default,{type:"keep"===j?"primary":"default",onClick:()=>y("keep"),children:"Keep"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{children:["Size: ",w]}),(0,a.jsx)(eM.default,{min:1,max:100,value:w,onChange:b})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{children:["Opacity: ",S]}),(0,a.jsx)(eM.default,{min:0,max:1,step:.1,value:S,onChange:k})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"Hardness:"}),(0,a.jsxs)(eI.default.Group,{value:A,onChange:e=>R(e.target.value),children:[(0,a.jsx)(eI.default.Button,{value:"hard",children:"Hard"}),(0,a.jsx)(eI.default.Button,{value:"soft",children:"Soft"})]})]})]}),(0,a.jsxs)(E.default,{children:[(0,a.jsx)(C.default,{icon:(0,a.jsx)(W.default,{}),onClick:()=>{if(U>0){let e=U-1,t=X[e];F.current.getContext("2d").putImageData(t,0,0),H(e),G();}},disabled:U<=0}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(J.default,{}),onClick:()=>{if(U<X.length-1){let e=U+1,t=X[e];F.current.getContext("2d").putImageData(t,0,0),H(e),G();}},disabled:U>=X.length-1})]})]})}),(0,a.jsxs)("div",{ref:_,style:{flex:1,position:"relative",border:"1px solid #ccc",height:500,overflow:"hidden",background:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==)"},children:[(0,a.jsx)("canvas",{ref:N,style:{position:"absolute",top:T.y,left:T.x,width:T.scale*((null==n?void 0:n.width)||0),height:T.scale*((null==n?void 0:n.height)||0)}}),(0,a.jsx)("canvas",{ref:z,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",cursor:v?"crosshair":"none"},onMouseDown:e=>{if(v){$(e);return;}M(!0);let t=e_(e,z,T.scale,{x:T.x,y:T.y});t&&(V.current=[t],K.current=t,Z([t]));},onMouseMove:e=>{let t=e_(e,z,T.scale,{x:T.x,y:T.y});if(I(t),v&&t&&n)try{let e=n.getContext("2d");if(e){let l=Math.max(0,Math.min(t.x,n.width-1)),r=Math.max(0,Math.min(t.y,n.height-1)),a=e.getImageData(l,r,1,1).data,i="#"+[a[0],a[1],a[2]].map(e=>e.toString(16).padStart(2,"0")).join("");P(i);}}catch(e){P(null);}else P(null);!v&&D&&t&&K.current&&(V.current.push(t),Z([K.current,t]),K.current=t);},onMouseUp:Q,onMouseLeave:Q}),(0,a.jsx)("canvas",{ref:F,style:{display:"none"}})]})]})});};var eV=l("95eb3634"),eK=r._(eV),eX=l("bb755443"),eY=r._(eX),eU=l("1ffd224b"),eH=r._(eU),eW=l("6effc0fd"),eq=r._(eW),eJ=l("84cd549f"),eG=r._(eJ);let e$=({projects:e,onLoad:t,onDelete:l})=>0===e.length?(0,a.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,a.jsx)(eq.default.Text,{type:"secondary",children:"No saved projects found."})}):(0,a.jsx)(eK.default,{grid:{gutter:16,column:3},dataSource:e,renderItem:e=>(0,a.jsx)(eK.default.Item,{children:(0,a.jsx)(c.default,{hoverable:!0,cover:(0,a.jsx)("div",{style:{height:150,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f0f0f0"},children:(0,a.jsx)(eH.default,{src:e.thumbnail,preview:!1,style:{maxHeight:"100%",maxWidth:"100%",objectFit:"contain"}})}),actions:[(0,a.jsx)(C.default,{type:"text",icon:(0,a.jsx)(ec,{}),onClick:()=>t(e),children:"Load"}),(0,a.jsx)(eY.default,{title:"Delete project?",onConfirm:()=>l(e.id),okText:"Yes",cancelText:"No",children:(0,a.jsx)(C.default,{type:"text",danger:!0,icon:(0,a.jsx)(eG.default,{}),children:"Delete"})})],children:(0,a.jsx)(c.default.Meta,{title:e.name,description:new Date(e.updatedAt).toLocaleString()})})})}),eQ=({visible:e,onCancel:t,projects:l,onLoad:r,onDelete:n})=>(0,a.jsx)(ev.default,{title:"Saved Projects",open:e,onCancel:t,footer:null,width:800,children:(0,a.jsx)(e$,{projects:l,onLoad:r,onDelete:n})}),eZ="projects",e0=()=>new Promise((e,t)=>{let l=indexedDB.open("PhotoEditorDB",1);l.onerror=()=>{t("Error opening database");},l.onsuccess=t=>{e(t.target.result);},l.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(eZ)||t.createObjectStore(eZ,{keyPath:"id"});};}),e1=async e=>{let t=await e0();return new Promise((l,r)=>{let n=t.transaction([eZ],"readwrite").objectStore(eZ).put(e);n.onsuccess=()=>l(),n.onerror=()=>r("Error saving project");});},e2=async()=>{let e=await e0();return new Promise((t,l)=>{let r=e.transaction([eZ],"readonly").objectStore(eZ).getAll();r.onsuccess=()=>{let e=r.result;e.sort((e,t)=>t.updatedAt-e.updatedAt),t(e);},r.onerror=()=>l("Error fetching projects");});},e4=async e=>{let t=await e0();return new Promise((l,r)=>{let n=t.transaction([eZ],"readwrite").objectStore(eZ).delete(e);n.onsuccess=()=>l(),n.onerror=()=>r("Error deleting project");});},e6=()=>{let[e,t]=(0,s.useState)([]),[l,r]=(0,s.useState)(null),n=(0,s.useCallback)(()=>{e2().then(t).catch(e=>console.error("Failed to load projects from DB",e));},[]);(0,s.useEffect)(()=>{n();},[n]);let a=(0,s.useCallback)(async(e,n)=>{if(!e)return;let a={id:(null==l?void 0:l.id)||Date.now().toString(),name:(null==l?void 0:l.name)||`Project ${new Date().toLocaleString()}`,thumbnail:e,json:n,createdAt:(null==l?void 0:l.createdAt)||Date.now(),updatedAt:Date.now()};try{await e1(a),t(e=>(e.some(e=>e.id===a.id)?e.map(e=>e.id===a.id?a:e):[a,...e]).sort((e,t)=>t.updatedAt-e.updatedAt)),r(a),ek.default.success("Project saved successfully!");}catch(e){console.error(e),ek.default.error("Failed to save project");}},[l]);return{savedProjects:e,currentProject:l,loadProjects:n,saveProject:a,deleteProject:(0,s.useCallback)(async e=>{try{await e4(e),t(t=>t.filter(t=>t.id!==e)),ek.default.success("Project deleted");}catch(e){console.error(e),ek.default.error("Failed to delete project");}},[]),loadProjectIntoEditor:(0,s.useCallback)(e=>{r(e);},[]),clearCurrentProject:(0,s.useCallback)(()=>{r(null);},[]),setCurrentProject:r};},e8=()=>{let{canvas:e,setActiveTool:t,activeTool:l,history:r,selectedObject:n,clipboard:i,setClipboard:d}=(0,w.usePhotoEditor)(),[o,c]=(0,s.useState)(!1),[u,f]=(0,s.useState)(!1),[h,x]=(0,s.useState)(!1),{savedProjects:g,saveProject:v,deleteProject:p,loadProjects:j}=e6(),y=()=>{if(!e)return;let t=e.toJSON();v(e.toDataURL({format:"png",multiplier:.5}),t);},b=async()=>{if(!e)return;let t=e.getActiveObject();t&&d(await t.clone());},S=async()=>{if(!e||!i)return;let t=await i.clone();e.discardActiveObject(),t.set({left:(t.left||0)+10,top:(t.top||0)+10,evented:!0}),t instanceof eg.ActiveSelection?(t.canvas=e,t.forEachObject(t=>{e.add(t);}),t.setCoords()):e.add(t),e.setActiveObject(t),e.requestRenderAll(),r.saveState();};(0,s.useEffect)(()=>{let l=l=>{"INPUT"!==l.target.tagName&&"TEXTAREA"!==l.target.tagName&&((null==e?void 0:e.getActiveObject())instanceof eg.IText&&e.getActiveObject().isEditing||(("v"===l.key||"V"===l.key)&&t("select"),("b"===l.key||"B"===l.key)&&t("brush"),("m"===l.key||"M"===l.key)&&n instanceof eg.FabricImage&&f(!0),("r"===l.key||"R"===l.key)&&A(),("t"===l.key||"T"===l.key)&&t("text"),("Delete"===l.key||"Backspace"===l.key)&&R(),(l.ctrlKey||l.metaKey)&&"z"===l.key&&(l.preventDefault(),l.shiftKey?r.redo():r.undo()),(l.ctrlKey||l.metaKey)&&"y"===l.key&&(l.preventDefault(),r.redo()),(l.ctrlKey||l.metaKey)&&"c"===l.key&&(l.preventDefault(),b()),(l.ctrlKey||l.metaKey)&&"v"===l.key&&(l.preventDefault(),S()),(l.ctrlKey||l.metaKey)&&"s"===l.key&&(l.preventDefault(),y()),(l.ctrlKey||l.metaKey)&&l.shiftKey&&"S"===l.key&&(l.preventDefault(),c(!0))));};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l);},[e,n,r,l,i]);let A=()=>{if(!e)return;let t=new eg.Rect({left:100,top:100,fill:"#ff0000",width:100,height:100});e.add(t),e.setActiveObject(t),r.saveState();},R=()=>{if(!e)return;let t=e.getActiveObjects();t.length&&(e.discardActiveObject(),t.forEach(t=>{e.remove(t);}),r.saveState());},M=n instanceof eg.FabricImage;return(0,a.jsxs)(E.default,{direction:"vertical",style:{padding:"8px"},children:[(0,a.jsx)(k.default,{title:"Select (V)",children:(0,a.jsx)(C.default,{type:"select"===l?"primary":"default",icon:(0,a.jsx)(B.default,{}),onClick:()=>t("select")})}),(0,a.jsx)(k.default,{title:"Brush (B)",children:(0,a.jsx)(C.default,{type:"brush"===l?"primary":"default",icon:(0,a.jsx)($.default,{}),onClick:()=>t("brush")})}),(0,a.jsx)(k.default,{title:"Rectangle (R)",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(T.default,{}),onClick:A})}),(0,a.jsx)(k.default,{title:"Circle (C)",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(V,{}),onClick:()=>{if(!e)return;let t=new eg.Circle({left:100,top:100,fill:"#00ff00",radius:50});e.add(t),e.setActiveObject(t),r.saveState();}})}),(0,a.jsx)(k.default,{title:"Text (T)",children:(0,a.jsx)(C.default,{type:"text"===l?"primary":"default",icon:(0,a.jsx)(X.default,{}),onClick:()=>t("text")})}),(0,a.jsx)("input",{type:"file",id:"image-upload",hidden:!0,accept:"image/*",onChange:t=>{if(!e||!t.target.files||!t.target.files[0])return;let l=t.target.files[0],n=new FileReader;n.onload=t=>{var l;let n=null===(l=t.target)||void 0===l?void 0:l.result;eg.FabricImage.fromURL(n).then(t=>{t.scaleToWidth(200),e.add(t),e.centerObject(t),e.setActiveObject(t),r.saveState();});},n.readAsDataURL(l);}}),(0,a.jsx)("input",{type:"file",id:"project-import",hidden:!0,accept:"application/json, .json",onChange:t=>{if(!e)return;let l=t.target.files&&t.target.files[0];if(!l)return;let n=new FileReader;n.onload=t=>{try{var l;let n=null===(l=t.target)||void 0===l?void 0:l.result,a=JSON.parse(n);e.loadFromJSON(a,()=>{e.renderAll(),r.saveState();});}catch(e){console.error("Failed to import project JSON",e),alert("Failed to import project file. Make sure it is a valid project JSON.");}},n.readAsText(l),t.currentTarget.value="";}}),(0,a.jsx)(m.default,{style:{margin:"8px 0"}}),(0,a.jsx)(k.default,{title:"Mask (M)",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(et.default,{}),onClick:()=>f(!0),disabled:!M})}),(0,a.jsx)(m.default,{style:{margin:"8px 0"}}),(0,a.jsx)(k.default,{title:"Undo (Ctrl+Z)",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(W.default,{}),onClick:r.undo,disabled:!r.canUndo})}),(0,a.jsx)(k.default,{title:"Redo (Ctrl+Y)",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(J.default,{}),onClick:r.redo,disabled:!r.canRedo})}),(0,a.jsx)(m.default,{style:{margin:"8px 0"}}),(0,a.jsx)(D.default,{overlay:(0,a.jsxs)(O.default,{children:[(0,a.jsx)(O.default.Item,{icon:(0,a.jsx)(U.default,{}),onClick:()=>{var e;return null===(e=document.getElementById("image-upload"))||void 0===e?void 0:e.click();},children:"Upload Image"},"upload"),(0,a.jsx)(O.default.Item,{icon:(0,a.jsx)(er.default,{}),onClick:b,disabled:!n,children:"Copy (Ctrl + C)"},"copy"),(0,a.jsx)(O.default.Item,{icon:(0,a.jsx)(ea.default,{}),onClick:S,disabled:!i,children:"Paste (Ctrl + V)"},"paste"),(0,a.jsx)(O.default.Divider,{}),(0,a.jsx)(O.default.Item,{icon:(0,a.jsx)(es.default,{}),onClick:y,children:"Save Project (Ctrl + S)"},"save"),(0,a.jsx)(O.default.Item,{icon:(0,a.jsx)(ec,{}),onClick:()=>x(!0),children:"Open Projects"},"open"),(0,a.jsx)(O.default.Item,{icon:(0,a.jsx)(ex.default,{}),onClick:()=>{var e;return null===(e=document.getElementById("project-import"))||void 0===e?void 0:e.click();},children:"Import Project (JSON)"},"import"),(0,a.jsx)(O.default.Item,{icon:(0,a.jsx)(Z.default,{}),onClick:()=>c(!0),children:"Export (Ctrl + Shift + S)"},"export")]}),trigger:["click"],children:(0,a.jsx)(k.default,{title:"More",children:(0,a.jsx)(C.default,{icon:(0,a.jsx)(ef,{})})})}),(0,a.jsx)(eR,{visible:o,onCancel:()=>c(!1),canvas:e}),u&&M&&(0,a.jsx)(ez,{open:u,onCancel:()=>f(!1),onApply:t=>{e&&n&&(eF(e,n,t),r.saveState(),f(!1));},sourceCanvas:(()=>{if(!n||!(n instanceof eg.FabricImage))return null;let e=n.getElement(),t=document.createElement("canvas");t.width=e.width,t.height=e.height;let l=t.getContext("2d");return l&&l.drawImage(e,0,0),t;})(),selectedColor:null}),(0,a.jsx)(eQ,{visible:h,onCancel:()=>x(!1),projects:g,onLoad:t=>{e&&e.loadFromJSON(t.json).then(()=>{e.renderAll(),x(!1),r.saveState();});},onDelete:p})]});},e5=e=>{let t=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!e)return;let l=async l=>{if((l.ctrlKey||l.metaKey)&&"c"===l.key){let l=e.getActiveObject();if(l){let e=await l.clone();t.current=e;}}if((l.ctrlKey||l.metaKey)&&"v"===l.key&&t.current){let l=await t.current.clone();e.discardActiveObject(),l.set({left:(l.left||0)+10,top:(l.top||0)+10,evented:!0}),"activeSelection"===l.type?(l.canvas=e,l.forEachObject(t=>{e.add(t);}),l.setCoords()):e.add(l),t.current=l,e.setActiveObject(l),e.requestRenderAll();}e.isDrawingMode&&e.freeDrawingBrush&&("["===l.key?e.freeDrawingBrush.width=Math.max(1,e.freeDrawingBrush.width-5):"]"===l.key&&(e.freeDrawingBrush.width+=5));};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l);};},[e]);},e3=()=>{let e=(0,s.useRef)(null),t=(0,s.useRef)(null),{canvas:l,setCanvas:r,selectedObject:n,setSelectedObject:i,history:d,imageUrl:o,initialProject:c,activeTool:u,addOnFile:f,setAddOnFile:h,setActiveTool:x,brushSize:g,setBrushSize:m,brushColor:v,setBrushColor:p}=(0,w.usePhotoEditor)(),j=(0,s.useRef)(!1);e5(l);let y=(0,s.useRef)(!1),b=(0,s.useRef)(null),C=(0,s.useRef)(null),S=(0,s.useRef)(!1),k=(0,s.useRef)(0),A=(0,s.useRef)(0),E=(0,s.useRef)(g);return(0,s.useEffect)(()=>{E.current=g;},[g]),(0,s.useEffect)(()=>{if(!l||!f)return;let e=new FileReader;e.onload=e=>{var t;let r=null===(t=e.target)||void 0===t?void 0:t.result;eg.Image.fromURL(r).then(e=>{e.scaleToWidth(200),l.add(e),l.centerObject(e),l.setActiveObject(e),d.saveState(),h&&h(null);});},e.readAsDataURL(f);},[f,l]),(0,s.useEffect)(()=>{l&&l.freeDrawingBrush&&"brush"===u&&(l.freeDrawingBrush.width=g,l.freeDrawingBrush.color=v);},[l,u,g,v]),(0,s.useEffect)(()=>{if(!l||!t.current)return;let e=t.current,r=l.lowerCanvasEl||null,n=document.createElement("div");n.style.position="absolute",n.style.pointerEvents="none",n.style.width="28px",n.style.height="28px",n.style.borderRadius="50%",n.style.boxShadow="0 0 4px rgba(0,0,0,0.5)",n.style.border="2px solid #fff",n.style.transform="translate(-50%, -50%)",n.style.display="none",n.style.zIndex="1000",e.appendChild(n),b.current=n;let a=document.createElement("div");a.style.position="absolute",a.style.pointerEvents="none",a.style.border="1px solid rgba(0,0,0,0.5)",a.style.borderRadius="50%",a.style.transform="translate(-50%, -50%)",a.style.display="none",a.style.zIndex="999",e.appendChild(a),C.current=a;let i=(e,t,r)=>{C.current&&("brush"===u&&(r>10||S.current)?(C.current.style.width=`${r}px`,C.current.style.height=`${r}px`,C.current.style.left=`${e}px`,C.current.style.top=`${t}px`,C.current.style.display="block","none"!==l.defaultCursor&&(l.defaultCursor="none",l.hoverCursor="none",l.requestRenderAll())):(C.current.style.display="none","none"===l.defaultCursor&&(l.defaultCursor="default",l.hoverCursor="move",l.requestRenderAll())));},s=e=>{"Alt"===e.key&&(y.current=!0,"brush"===u&&(l.isDrawingMode=!1));},d=e=>{"Alt"===e.key&&(y.current=!1,"brush"!==u||S.current||(l.isDrawingMode=!0),b.current&&(b.current.style.display="none"));},o=e=>{e.altKey&&e.preventDefault();},c=t=>{if("brush"===u){if(t.altKey&&2===t.button){t.preventDefault(),S.current=!0,k.current=t.clientX,A.current=E.current,l.isDrawingMode=!1;return;}if(t.altKey&&0===t.button)try{let l=e.getBoundingClientRect(),n=t.clientX-l.left,a=t.clientY-l.top;if(!r)return;let i=r.getContext("2d");if(!i)return;let s=i.getImageData(n,a,1,1).data,d="#"+[s[0],s[1],s[2]].map(e=>e.toString(16).padStart(2,"0")).join("");p(d);}catch(e){}}},f=t=>{if("brush"!==u){C.current&&(C.current.style.display="none");return;}let l=e.getBoundingClientRect(),n=t.clientX-l.left,a=t.clientY-l.top;if(S.current){let e=t.clientX-k.current,l=Math.max(1,A.current+e);m(l),i(n,a,l);return;}if(i(n,a,E.current),y.current)try{if(!r)return;let e=r.getContext("2d");if(!e)return;if(n<0||a<0||n>=r.width||a>=r.height){b.current&&(b.current.style.display="none");return;}let t=e.getImageData(n,a,1,1).data,l="#"+[t[0],t[1],t[2]].map(e=>e.toString(16).padStart(2,"0")).join("");b.current&&(b.current.style.background=l,b.current.style.display="block",b.current.style.left=n+24+"px",b.current.style.top=a+24+"px");}catch(e){b.current&&(b.current.style.display="none");}else b.current&&(b.current.style.display="none");},h=e=>{S.current&&(S.current=!1,"brush"!==u||y.current||(l.isDrawingMode=!0));};return window.addEventListener("keydown",s),window.addEventListener("keyup",d),e.addEventListener("contextmenu",o),e.addEventListener("mousedown",c),window.addEventListener("mousemove",f),window.addEventListener("mouseup",h),()=>{if(window.removeEventListener("keydown",s),window.removeEventListener("keyup",d),e.removeEventListener("contextmenu",o),e.removeEventListener("mousedown",c),window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",h),b.current){try{e.removeChild(b.current);}catch(e){}b.current=null;}if(C.current){try{e.removeChild(C.current);}catch(e){}C.current=null;}l&&(l.defaultCursor="default",l.hoverCursor="move");};},[l,u,m,p]),(0,s.useEffect)(()=>{if(!e.current||!t.current)return;let l=new eg.Canvas(e.current,{width:t.current.clientWidth,height:t.current.clientHeight,backgroundColor:"#ffffff",preserveObjectStacking:!0,selection:!0});r(l),c?l.loadFromJSON(c.json).then(()=>{l.renderAll(),d.saveState();}):o&&eg.Image.fromURL(o).then(e=>{let r=t.current.clientWidth,n=t.current.clientHeight;(e.width>r||e.height>n)&&e.scaleToWidth(.8*r),l.add(e),l.centerObject(e),l.setActiveObject(e),d.saveState();});let n=()=>{let e=l.getActiveObjects();1===e.length?i(e[0]):i(null);};l.on("selection:created",n),l.on("selection:updated",n),l.on("selection:cleared",()=>i(null)),l.on("text:editing:entered",()=>{j.current=!0,x&&x("text");}),l.on("text:editing:exited",()=>x&&x("select"));let a=()=>{d.saveState();};l.on("object:modified",a),l.on("object:added",a),l.on("object:removed",a);let s=()=>{t.current&&l.setDimensions({width:t.current.clientWidth,height:t.current.clientHeight});};return window.addEventListener("resize",s),()=>{l.dispose(),window.removeEventListener("resize",s);};},[]),(0,s.useEffect)(()=>{if(n)try{let e=!!n.isEditing;j.current=e,e&&x&&x("text");}catch(e){}},[n,x]),(0,s.useEffect)(()=>{l&&("brush"===u?(l.isDrawingMode=!0,l.freeDrawingBrush||(l.freeDrawingBrush=new eg.PencilBrush(l)),l.freeDrawingBrush.width=g,l.freeDrawingBrush.color=v):l.isDrawingMode=!1);},[u,l]),(0,s.useEffect)(()=>{if(!l||"text"!==u)return;let e=e=>{try{if(j.current)return;let t=l.getViewportPoint(e.e),r=new eg.IText("Text",{left:t.x,top:t.y,fontSize:24});l.add(r),l.setActiveObject(r),i&&i(r),r.enterEditing&&r.enterEditing(),r.selectAll&&r.selectAll(),l.requestRenderAll(),d.saveState(),x&&x("select");}catch(e){}};return l.on("mouse:down",e),()=>{l.off("mouse:down",e);};},[l,u,d,i,x]),(0,a.jsx)("div",{ref:t,style:{width:"100%",height:"100%"},children:(0,a.jsx)("canvas",{ref:e})});};var e7=l("f6c9c5f6"),e9=r._(e7),te=l("54c23ac9"),tt=r._(te),tl=l("7502124f"),tr=r._(tl),tn=l("5a5a4642"),ta=r._(tn),ti=l("6e3683a5"),ts=r._(ti),td=l("acdcfa21"),to=r._(td),tc=l("e36949ef"),tu=r._(tc),tf=l("0d6a818e"),th=l("4989c16f"),tx=l("039e4dd6");let{Title:tg}=eq.default,{Option:tm}=ew.default,tv=({id:e,children:t,isSelected:l,onClick:r})=>{let{attributes:n,listeners:i,setNodeRef:s,setActivatorNodeRef:d,transform:o,transition:c}=(0,th.useSortable)({id:e}),u={transform:tx.CSS.Transform.toString(o),transition:c,backgroundColor:l?"#e6f7ff":"transparent",marginBottom:4,border:"1px solid #f0f0f0",borderRadius:4,padding:"4px 8px",display:"flex",alignItems:"center"};return(0,a.jsxs)("div",{ref:s,style:u,children:[(0,a.jsx)("div",{ref:d,...n,...i,style:{cursor:"grab",marginRight:8,display:"flex",alignItems:"center",color:"#999"},onMouseDown:e=>e.stopPropagation(),children:(0,a.jsx)(ts.default,{})}),(0,a.jsx)("div",{onClick:e=>r(e),style:{flex:1,cursor:"pointer"},children:t})]});},tp=()=>{let{canvas:e,selectedObject:t,setSelectedObject:l,history:r}=(0,w.usePhotoEditor)(),[n,i]=(0,s.useState)([]),[d,o]=(0,s.useState)([]),c=(0,s.useRef)(!1),u=(0,s.useRef)(null),f=(0,s.useRef)(100),h=(0,s.useRef)(null),x=(0,tf.useSensors)((0,tf.useSensor)(tf.PointerSensor),(0,tf.useSensor)(tf.KeyboardSensor,{coordinateGetter:th.sortableKeyboardCoordinates})),g=()=>{if(!e)return;let t=e.getObjects();t.forEach(e=>{e.uid||(e.uid=Math.random().toString(36).substr(2,9));}),i([...t].reverse());};(0,s.useEffect)(()=>{let t;if(!e)return;let l=()=>{clearTimeout(t),t=setTimeout(g,100);};e.on("object:added",l),e.on("object:removed",l),e.on("object:modified",l);let r=()=>{o((e.getActiveObjects()||[]).map(e=>e.uid).filter(Boolean));};return e.on("selection:created",r),e.on("selection:updated",r),e.on("selection:cleared",()=>o([])),g(),()=>{e.off("object:added",l),e.off("object:removed",l),e.off("object:modified",l),e.off("selection:created",r),e.off("selection:updated",r),e.off("selection:cleared",()=>o([])),clearTimeout(t);};},[e]);let m=(t,l)=>{l.stopPropagation(),t.visible=!t.visible,t.visible||null==e||e.discardActiveObject(),null==e||e.requestRenderAll(),r.saveState(),i([...(null==e?void 0:e.getObjects())||[]].reverse());},v=(t,l)=>{l.stopPropagation(),t.lockMovementX=!t.lockMovementX,t.lockMovementY=!t.lockMovementY,t.lockRotation=!t.lockRotation,t.lockScalingX=!t.lockScalingX,t.lockScalingY=!t.lockScalingY,t.selectable=!t.lockMovementX,t.selectable||null==e||e.discardActiveObject(),null==e||e.requestRenderAll(),r.saveState(),i([...(null==e?void 0:e.getObjects())||[]].reverse());},p=(t,r)=>{if(!e||!t.visible||!t.selectable)return;let a=n.findIndex(e=>e===t),i=r&&(r.ctrlKey||r.metaKey),s=r&&r.shiftKey;if(i){let r=e.getActiveObjects()||[],n=r.includes(t),i=[];if(0===(i=n?r.filter(e=>e!==t):[...r,t]).length)e.discardActiveObject(),l(null);else if(1===i.length)e.setActiveObject(i[0]),l(i[0]);else{let t=new eg.ActiveSelection(i,{canvas:e});e.setActiveObject(t),l(i[i.length-1]);}e.requestRenderAll(),h.current=a;return;}if(s&&null!==h.current){let t=Math.min(h.current,a),r=Math.max(h.current,a),i=n.slice(t,r+1).map(e=>e);if(1===i.length)e.setActiveObject(i[0]),l(i[0]);else{let t=new eg.ActiveSelection(i,{canvas:e});e.setActiveObject(t),l(i[i.length-1]);}e.requestRenderAll();return;}e.setActiveObject(t),l(t),e.requestRenderAll(),h.current=a;},j=(t,l)=>{l.stopPropagation(),null==e||e.remove(t),null==e||e.requestRenderAll(),r.saveState();},y=l=>{if(!e||!t)return;let r=Number(l||0);t.set("opacity",Math.max(0,Math.min(100,r))/100),e.requestRenderAll();},b=()=>{r.saveState();};return(0,a.jsxs)("div",{style:{padding:10},children:[(0,a.jsx)(tg,{level:5,children:"Layers"}),(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsxs)(E.default,{children:[(0,a.jsx)(C.default,{icon:(0,a.jsx)(to.default,{}),onClick:()=>{if(!e)return;let t=e.getActiveObject();t&&"activeSelection"===t.type&&(t.toGroup(),e.requestRenderAll(),g(),l(e.getActiveObject()||null));},disabled:!t,title:"Group Layers"}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(tu.default,{}),onClick:()=>{if(!e)return;let t=e.getActiveObject();t&&"group"===t.type&&(t.toActiveSelection(),e.requestRenderAll(),g(),l(e.getActiveObject()||null));},disabled:!t||"group"!==t.type,title:"Ungroup Layers"})]})}),t&&(0,a.jsxs)("div",{style:{marginBottom:16,padding:8,background:"#fafafa",borderRadius:4},children:[(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,cursor:"ew-resize",userSelect:"none"},onMouseDown:l=>{if(0!==l.button)return;l.preventDefault(),c.current=!0,u.current=l.clientX,f.current=Math.round(((null==t?void 0:t.opacity)??1)*100);let n=document.body.style.userSelect;document.body.style.userSelect="none";let a=t=>{if(!c.current||null===u.current)return;let l=t.clientX-u.current,r=Math.max(0,Math.min(100,f.current+.2*l)),n=null==e?void 0:e.getActiveObject();n&&e&&(n.set("opacity",r/100),e.requestRenderAll());},i=()=>{c.current=!1,u.current=null,document.body.style.userSelect=n,window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",i),r.saveState();};window.addEventListener("mousemove",a),window.addEventListener("mouseup",i);},children:[(0,a.jsx)("div",{style:{marginRight:8},children:"Opacity:"}),(0,a.jsx)(eC.default,{size:"small",min:0,max:100,step:1,value:Math.round((t.opacity??1)*100),onChange:e=>y(e),onBlur:()=>b(),style:{flex:1}})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,width:"100%"},children:[(0,a.jsx)("div",{style:{marginRight:8},children:"Blend Mode:"}),(0,a.jsxs)(ew.default,{size:"small",style:{flex:1},value:t.globalCompositeOperation||"source-over",onChange:l=>{e&&t&&(t.set("globalCompositeOperation",l),e.requestRenderAll(),r.saveState());},children:[(0,a.jsx)(tm,{value:"source-over",children:"Normal"}),(0,a.jsx)(tm,{value:"multiply",children:"Multiply"}),(0,a.jsx)(tm,{value:"screen",children:"Screen"}),(0,a.jsx)(tm,{value:"overlay",children:"Overlay"}),(0,a.jsx)(tm,{value:"darken",children:"Darken"}),(0,a.jsx)(tm,{value:"lighten",children:"Lighten"}),(0,a.jsx)(tm,{value:"color-dodge",children:"Color Dodge"}),(0,a.jsx)(tm,{value:"color-burn",children:"Color Burn"}),(0,a.jsx)(tm,{value:"hard-light",children:"Hard Light"}),(0,a.jsx)(tm,{value:"soft-light",children:"Soft Light"}),(0,a.jsx)(tm,{value:"difference",children:"Difference"}),(0,a.jsx)(tm,{value:"exclusion",children:"Exclusion"}),(0,a.jsx)(tm,{value:"hue",children:"Hue"}),(0,a.jsx)(tm,{value:"saturation",children:"Saturation"}),(0,a.jsx)(tm,{value:"color",children:"Color"}),(0,a.jsx)(tm,{value:"luminosity",children:"Luminosity"})]})]})})]}),(0,a.jsx)(tf.DndContext,{sensors:x,collisionDetection:tf.closestCenter,onDragEnd:t=>{let{active:l,over:a}=t;if(a&&l.id!==a.id){let t=n.findIndex(e=>e.uid===l.id),i=n.findIndex(e=>e.uid===a.id);if(-1!==t&&-1!==i){let l=n.length-1-i,a=n[t];null==e||e.moveObjectTo(a,l),null==e||e.requestRenderAll(),r.saveState(),g();}}},children:(0,a.jsx)(th.SortableContext,{items:n.map(e=>e.uid),strategy:th.verticalListSortingStrategy,children:(0,a.jsx)("div",{style:{overflowY:"auto",border:"1px solid #d9d9d9",borderRadius:4,padding:4},children:n.map((e,t)=>{let l=d.includes(e.uid),r=e.type||"Object",i=e.name||`${r} ${n.length-t}`;return(0,a.jsx)(tv,{id:e.uid,isSelected:l,onClick:t=>p(e,t),children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},children:[(0,a.jsx)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:120},children:i}),(0,a.jsxs)(E.default,{size:4,children:[(0,a.jsx)(C.default,{type:"text",size:"small",icon:e.visible?(0,a.jsx)(e9.default,{}):(0,a.jsx)(tt.default,{}),onClick:t=>m(e,t),onMouseDown:e=>e.stopPropagation()}),(0,a.jsx)(C.default,{type:"text",size:"small",icon:e.lockMovementX?(0,a.jsx)(tr.default,{}):(0,a.jsx)(ta.default,{}),onClick:t=>v(e,t),onMouseDown:e=>e.stopPropagation()}),(0,a.jsx)(C.default,{type:"text",size:"small",danger:!0,icon:(0,a.jsx)(eG.default,{}),onClick:t=>j(e,t),onMouseDown:e=>e.stopPropagation()})]})]})},e.uid);})})})})]});};var tj=l("764a8673"),ty=r._(tj);let{Panel:tw}=ty.default,tb=[{name:"Grayscale",filter:eg.filters.Grayscale,index:9},{name:"Invert",filter:eg.filters.Invert,index:10},{name:"Sepia",filter:eg.filters.Sepia,index:11},{name:"Black&White",filter:eg.filters.BlackWhite,index:12},{name:"Brownie",filter:eg.filters.Brownie,index:13},{name:"Vintage",filter:eg.filters.Vintage,index:14},{name:"Kodachrome",filter:eg.filters.Kodachrome,index:15},{name:"Technicolor",filter:eg.filters.Technicolor,index:16},{name:"Polaroid",filter:eg.filters.Polaroid,index:17}],tC=({name:e,filterClass:t,originalImage:l,isActive:r,onClick:n})=>{let i=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!l||!i.current)return;let e=i.current,r=e.getContext("2d");if(!r)return;e.width=60,e.height=60;let n=new eg.FabricImage(l),a=60/Math.max(n.width||1,n.height||1);n.scale(a);let s=new t;n.filters=[s],n.applyFilters();let d=n.getElement();r.clearRect(0,0,60,60);let o=(n.width||0)*(n.scaleX||1),c=(n.height||0)*(n.scaleY||1);r.drawImage(d,(60-o)/2,(60-c)/2,o,c);},[l,t]),(0,a.jsxs)("div",{onClick:n,style:{cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[(0,a.jsx)("div",{style:{width:64,height:64,border:r?"2px solid #1890ff":"1px solid #f0f0f0",borderRadius:4,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f5f5f5"},children:(0,a.jsx)("canvas",{ref:i})}),(0,a.jsx)(eq.default.Text,{style:{fontSize:10,textAlign:"center",lineHeight:1.2},children:e})]});},tS=()=>{let{canvas:e,selectedObject:t,history:l}=(0,w.usePhotoEditor)(),[r,n]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(t&&t.isType("image")){let e=t.getSrc(),l=new Image;l.crossOrigin="anonymous",l.src=e,l.onload=()=>{n(l);};}else n(null);},[t]);let i=(l,r)=>{t&&t.isType("image")&&(t.filters[l]=r,t.applyFilters(),null==e||e.requestRenderAll());},d=(e,t,r)=>{i(e,!!r&&new t),l.saveState();};return t&&t.isType("image")?(0,a.jsxs)("div",{style:{padding:10,height:"100%",overflowY:"auto"},children:[(0,a.jsx)(eq.default.Title,{level:5,children:"Adjustments"}),(0,a.jsxs)(ty.default,{defaultActiveKey:["1","2","3"],ghost:!0,children:[(0,a.jsx)(tw,{header:"Basic",children:(0,a.jsxs)(E.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(eq.default.Text,{children:"Brightness"}),(0,a.jsx)(eM.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:e=>{i(0,new eg.filters.Brightness({brightness:e}));},onAfterChange:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eq.default.Text,{children:"Contrast"}),(0,a.jsx)(eM.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:e=>{i(1,new eg.filters.Contrast({contrast:e}));},onAfterChange:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eq.default.Text,{children:"Saturation"}),(0,a.jsx)(eM.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:e=>{i(2,new eg.filters.Saturation({saturation:e}));},onAfterChange:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eq.default.Text,{children:"Vibrance"}),(0,a.jsx)(eM.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:e=>{i(7,new eg.filters.Vibrance({vibrance:e}));},onAfterChange:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eq.default.Text,{children:"Gamma"}),(0,a.jsx)(eM.default,{min:.1,max:2.2,step:.1,defaultValue:1,onChange:e=>{i(6,new eg.filters.Gamma({gamma:[e,e,e]}));},onAfterChange:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eq.default.Text,{children:"Hue Rotation"}),(0,a.jsx)(eM.default,{min:-1,max:1,step:.01,defaultValue:0,onChange:e=>{i(8,new eg.filters.HueRotation({rotation:e}));},onAfterChange:()=>l.saveState()})]})]})},"1"),(0,a.jsx)(tw,{header:"Effects",children:(0,a.jsxs)(E.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(eq.default.Text,{children:"Blur"}),(0,a.jsx)(eM.default,{min:0,max:1,step:.01,defaultValue:0,onChange:e=>{i(5,new eg.filters.Blur({blur:e}));},onAfterChange:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eq.default.Text,{children:"Noise"}),(0,a.jsx)(eM.default,{min:0,max:1e3,defaultValue:0,onChange:e=>{i(3,new eg.filters.Noise({noise:e}));},onAfterChange:()=>l.saveState()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eq.default.Text,{children:"Pixelate"}),(0,a.jsx)(eM.default,{min:1,max:20,defaultValue:1,onChange:e=>{i(4,e>1&&new eg.filters.Pixelate({blocksize:e}));},onAfterChange:()=>l.saveState()})]})]})},"2"),(0,a.jsx)(tw,{header:"Filters",children:(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12},children:tb.map(e=>{var l;let n=!!(null==t?void 0:null===(l=t.filters)||void 0===l?void 0:l[e.index]);return(0,a.jsx)(tC,{name:e.name,filterClass:e.filter,originalImage:r,isActive:n,onClick:()=>d(e.index,e.filter,!n)},e.name);})})},"3")]})]}):(0,a.jsx)("div",{style:{padding:10},children:"Select an image to adjust"});},tk=()=>{let{canvas:e,brushSize:t,setBrushSize:l,brushColor:r,setBrushColor:n,brushOpacity:i,setBrushOpacity:d}=(0,w.usePhotoEditor)(),[o,c]=(0,s.useState)(0),[u,f]=(0,s.useState)("Pencil"),h=(0,s.useRef)(!1),x=(0,s.useRef)(null),g=(0,s.useRef)(t),m=(0,s.useRef)(!1),v=(0,s.useRef)(null),p=(0,s.useRef)(o),j=(0,s.useRef)(!1),y=(0,s.useRef)(null),b=(0,s.useRef)(i);return(0,s.useEffect)(()=>{if(!e)return;e.freeDrawingBrush||(e.freeDrawingBrush=new eg.PencilBrush(e));let l=e.freeDrawingBrush,n=r.replace("#",""),a=parseInt(n.substring(0,2),16),s=parseInt(n.substring(2,4),16),d=parseInt(n.substring(4,6),16);l.color=`rgba(${a},${s},${d},${i})`,l.width=t,o>0?l.shadow=new eg.Shadow({blur:o,color:l.color}):l.shadow=null;},[e,r,t,o,i]),(0,a.jsxs)("div",{style:{padding:10},children:[(0,a.jsx)(eq.default.Title,{level:5,children:"Brush Settings"}),(0,a.jsxs)(E.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(eq.default.Text,{children:"Type"}),(0,a.jsxs)(ew.default,{value:u,style:{width:"100%"},onChange:l=>{let n;if(!e)return;switch(f(l),l){case"Circle":n=new eg.CircleBrush(e);break;case"Spray":n=new eg.SprayBrush(e);break;default:n=new eg.PencilBrush(e);}let a=r.replace("#",""),s=parseInt(a.substring(0,2),16),d=parseInt(a.substring(2,4),16),c=parseInt(a.substring(4,6),16);n.color=`rgba(${s},${d},${c},${i})`,n.width=t,o>0&&(n.shadow=new eg.Shadow({blur:o,color:n.color})),e.freeDrawingBrush=n;},children:[(0,a.jsx)(ew.default.Option,{value:"Pencil",children:"Pencil"}),(0,a.jsx)(ew.default.Option,{value:"Circle",children:"Circle"}),(0,a.jsx)(ew.default.Option,{value:"Spray",children:"Spray"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eq.default.Text,{children:"Color"}),(0,a.jsx)("br",{}),(0,a.jsx)(eP.default,{value:r,onChange:e=>n(e.toHexString()),showText:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eq.default.Text,{onMouseDown:e=>{if(0!==e.button)return;e.preventDefault(),h.current=!0,x.current=e.clientX,g.current=t;let r=document.body.style.userSelect;document.body.style.userSelect="none";let n=e=>{if(!h.current||null===x.current)return;let t=e.clientX-x.current;l(Number(Math.max(1,Math.min(2e3,g.current+.2*t)).toFixed(0)));},a=()=>{h.current=!1,x.current=null,document.body.style.userSelect=r,window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",a);};window.addEventListener("mousemove",n),window.addEventListener("mouseup",a);},style:{cursor:"ew-resize",userSelect:"none"},children:"Width"}),(0,a.jsx)("br",{}),(0,a.jsx)(eC.default,{min:1,max:2e3,value:t,onChange:e=>l(Number(e||1)),style:{width:"100%"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eq.default.Text,{onMouseDown:e=>{if(0!==e.button)return;e.preventDefault(),j.current=!0,y.current=e.clientX,b.current=i;let t=document.body.style.userSelect;document.body.style.userSelect="none";let l=e=>{if(!j.current||null===y.current)return;let t=e.clientX-y.current;d(Number(Math.max(0,Math.min(1,b.current+.002*t)).toFixed(2)));},r=()=>{j.current=!1,y.current=null,document.body.style.userSelect=t,window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",r);};window.addEventListener("mousemove",l),window.addEventListener("mouseup",r);},style:{cursor:"ew-resize",userSelect:"none"},children:"Opacity"}),(0,a.jsx)("br",{}),(0,a.jsx)(eC.default,{min:0,max:1,step:.01,value:i,onChange:e=>d(Number(e||1)),style:{width:"100%"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eq.default.Text,{onMouseDown:e=>{if(0!==e.button)return;e.preventDefault(),m.current=!0,v.current=e.clientX,p.current=o;let t=document.body.style.userSelect;document.body.style.userSelect="none";let l=e=>{if(!m.current||null===v.current)return;let t=e.clientX-v.current;c(Number(Math.max(0,Math.min(200,p.current+.2*t)).toFixed(0)));},r=()=>{m.current=!1,v.current=null,document.body.style.userSelect=t,window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",r);};window.addEventListener("mousemove",l),window.addEventListener("mouseup",r);},style:{cursor:"ew-resize",userSelect:"none"},children:"Shadow Blur"}),(0,a.jsx)("br",{}),(0,a.jsx)(eC.default,{min:0,max:500,value:o,onChange:e=>c(Number(e||0)),style:{width:"100%"}})]})]})]});};var tA={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M697.8 481.4c33.6-35 54.2-82.3 54.2-134.3v-10.2C752 229.3 663.9 142 555.3 142H259.4c-15.1 0-27.4 12.3-27.4 27.4v679.1c0 16.3 13.2 29.5 29.5 29.5h318.7c117 0 211.8-94.2 211.8-210.5v-11c0-73-37.4-137.3-94.2-175.1zM328 238h224.7c57.1 0 103.3 44.4 103.3 99.3v9.5c0 54.8-46.3 99.3-103.3 99.3H328V238zm366.6 429.4c0 62.9-51.7 113.9-115.5 113.9H328V542.7h251.1c63.8 0 115.5 51 115.5 113.9v10.8z"}}]},name:"bold",theme:"outlined"},tE=s.forwardRef(function(e,t){return s.createElement(z.default,(0,_.default)((0,_.default)({},e),{},{ref:t,icon:tA}));}),tR=l("83ea51ed"),tD=r._(tR),tM={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M824 804H200c-4.4 0-8 3.4-8 7.6v60.8c0 4.2 3.6 7.6 8 7.6h624c4.4 0 8-3.4 8-7.6v-60.8c0-4.2-3.6-7.6-8-7.6zm-312-76c69.4 0 134.6-27.1 183.8-76.2C745 602.7 772 537.4 772 468V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 97-79 176-176 176s-176-79-176-176V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 69.4 27.1 134.6 76.2 183.8C377.3 701 442.6 728 512 728z"}}]},name:"underline",theme:"outlined"},tO=s.forwardRef(function(e,t){return s.createElement(z.default,(0,_.default)((0,_.default)({},e),{},{ref:t,icon:tM}));}),tI=l("711e1aa9"),tB=r._(tI),tP=l("16d526ba"),tT=r._(tP),tL=l("1872ef2e"),t_=r._(tL);let tN=["Arial","Helvetica","Times New Roman","Georgia","Courier New","Verdana"],tF=()=>{let{canvas:e,selectedObject:t,history:l,setActiveTool:r}=(0,w.usePhotoEditor)(),[n,i]=(0,s.useState)("Arial"),[d,o]=(0,s.useState)(24),[c,u]=(0,s.useState)(!1),[f,h]=(0,s.useState)(!1),[x,g]=(0,s.useState)(!1),[v,p]=(0,s.useState)("left"),[j,y]=(0,s.useState)("#000000");(0,s.useEffect)(()=>{t&&"i-text"===t.isType&&(i(t.fontFamily||"Arial"),o(t.fontSize||24),u("bold"===t.fontWeight||700===t.fontWeight),h("italic"===t.fontStyle),g(t.underline||!1),p(t.textAlign||"left"),y(t.fill||"#000000"));},[t]);let b=(r,n=!0)=>{t&&(t.set(r),t.setCoords&&t.setCoords(),e&&e.requestRenderAll(),n&&l&&l.saveState());};return(0,a.jsxs)("div",{style:{padding:12},children:[(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsx)("strong",{children:"Font"})}),(0,a.jsxs)(E.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsx)(ew.default,{value:n,onChange:e=>{i(e),b({fontFamily:e});},children:tN.map(e=>(0,a.jsx)(ew.default.Option,{value:e,children:e},e))}),(0,a.jsx)(eC.default,{min:8,max:200,value:d,onChange:e=>{o(e||24),b({fontSize:e||24});},style:{width:"100%"}}),(0,a.jsx)("div",{children:(0,a.jsxs)(E.default,{children:[(0,a.jsx)(C.default,{icon:(0,a.jsx)(tE,{}),type:c?"primary":"default",onClick:()=>{let e=!c;u(e),b({fontWeight:e?"bold":"normal"});}}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(tD.default,{}),type:f?"primary":"default",onClick:()=>{let e=!f;h(e),b({fontStyle:e?"italic":"normal"});}}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(tO,{}),type:x?"primary":"default",onClick:()=>{let e=!x;g(e),b({underline:e});}})]})}),(0,a.jsx)(m.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Horizontal Align (textAlign)"}),(0,a.jsx)("div",{style:{marginTop:8},children:(0,a.jsxs)(E.default,{children:[(0,a.jsx)(C.default,{icon:(0,a.jsx)(tB.default,{}),type:"left"===v?"primary":"default",onClick:()=>{p("left"),b({textAlign:"left"});}}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(tT.default,{}),type:"center"===v?"primary":"default",onClick:()=>{p("center"),b({textAlign:"center"});}}),(0,a.jsx)(C.default,{icon:(0,a.jsx)(t_.default,{}),type:"right"===v?"primary":"default",onClick:()=>{p("right"),b({textAlign:"right"});}})]})})]}),(0,a.jsx)(m.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Color"}),(0,a.jsx)("div",{style:{marginTop:8},children:(0,a.jsx)(eP.default,{value:j,onChange:e=>{let l=e.toHexString();y(l),b({fill:l});try{(null==t?void 0:t.isEditing)&&r&&r("text");}catch(e){}},showText:!0})})]})]})]});},tz=()=>{let{canvas:e,selectedObject:t,history:l}=(0,w.usePhotoEditor)(),r=()=>{if(!e)return null;let t=e.getObjects();if(!t||0===t.length)return null;let l=t[0];try{return l.getBoundingRect();}catch(e){return null;}},n=r=>{t&&(t.set(r),t.setCoords&&t.setCoords(),e&&e.requestRenderAll(),l&&l.saveState());},i=l=>{if(!e||!t)return;let a=r();if(!a)return;let i=t.getBoundingRect(),s=t.left||0;"left"===l?s=a.left:"center"===l?s=a.left+(a.width-i.width)/2:"right"===l&&(s=a.left+a.width-i.width),n({left:s});},s=l=>{if(!e||!t)return;let a=r();if(!a)return;let i=t.getBoundingRect(),s=t.top||0;"top"===l?s=a.top:"middle"===l?s=a.top+(a.height-i.height)/2:"bottom"===l&&(s=a.top+a.height-i.height),n({top:s});};return(0,a.jsxs)("div",{style:{padding:12},children:[(0,a.jsx)("div",{style:{marginBottom:6},children:(0,a.jsx)("strong",{children:"Align to First Layer"})}),(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsxs)(E.default,{children:[(0,a.jsx)(C.default,{onClick:()=>i("left"),children:"H: Left"}),(0,a.jsx)(C.default,{onClick:()=>i("center"),children:"H: Center"}),(0,a.jsx)(C.default,{onClick:()=>i("right"),children:"H: Right"})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)(E.default,{children:[(0,a.jsx)(C.default,{onClick:()=>s("top"),children:"V: Top"}),(0,a.jsx)(C.default,{onClick:()=>s("middle"),children:"V: Middle"}),(0,a.jsx)(C.default,{onClick:()=>s("bottom"),children:"V: Bottom"})]})})]});},tV=()=>{let{activeTool:e,selectedObject:t}=(0,w.usePhotoEditor)();return"brush"===e?(0,a.jsx)(tk,{}):"text"===e?(0,a.jsx)(tF,{}):t&&"i-text"===t.isType?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tF,{}),(0,a.jsx)(tz,{})]}):t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tS,{}),(0,a.jsx)(tz,{})]}):(0,a.jsx)(tS,{});};var tK=l("34f06567"),tX=r._(tK),tY=l("e21451ef"),tU=r._(tY);let tH=({onUpload:e})=>(0,a.jsxs)(tX.default.Dragger,{beforeUpload:e,showUploadList:!1,accept:".png,.jpg,.jpeg",height:200,children:[(0,a.jsx)("p",{className:"ant-upload-drag-icon",children:(0,a.jsx)(tU.default,{})}),(0,a.jsx)("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),(0,a.jsx)("p",{className:"ant-upload-hint",children:"Support for a single upload. You can also paste an image from clipboard."})]}),tW=()=>{let[e,t]=(0,s.useState)(null),[l,r]=(0,s.useState)(null),[n,a]=(0,s.useState)(null),[i,d]=(0,s.useState)(!1),o=(0,s.useRef)(0),c=(0,s.useCallback)(l=>{let n=new FileReader;return n.onload=n=>{if(e)a(l);else{var i;t(null===(i=n.target)||void 0===i?void 0:i.result),r(null);}},n.readAsDataURL(l),d(!1),o.current=0,!1;},[e]),u=(0,s.useCallback)(e=>{r(e),t(e.thumbnail);},[]),f=(0,s.useCallback)(()=>{t(null),a(null),r(null),ek.default.info("Image cleared.");},[]);return(0,s.useEffect)(()=>{let e=e=>{var t;let l=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!l)return;let r=Array.from(l).find(e=>e.type.includes("image"));if(r){let t=r.getAsFile();t&&(c(t),ek.default.success("Image pasted from clipboard!"),e.preventDefault());}};return window.addEventListener("paste",e),()=>window.removeEventListener("paste",e);},[c]),{preview:e,setPreview:t,addOnFile:n,setAddOnFile:a,dragging:i,setDragging:d,dragCounter:o,handleUpload:c,handleClear:f,loadProject:u,initialProject:l};};var tq={propertiesSider:"propertiesSider-YRVduwgD",toolbarSider:"toolbarSider-ECMIrGgY",editorContainer:"editorContainer-SPg3koCD",canvasContent:"canvasContent-Lj9buPhs"};let{Sider:tJ,Content:tG}=f.default,t$=()=>{let{preview:e,dragging:t,setDragging:l,dragCounter:r,handleUpload:n,addOnFile:i,setAddOnFile:s,loadProject:o,initialProject:u}=tW(),{savedProjects:h,deleteProject:g}=e6();return(0,a.jsx)(d.PageContainer,{title:(0,a.jsxs)("span",{children:["Photo Editor ",(0,a.jsx)(x.default,{color:"cyan",children:"Beta"})]}),children:(0,a.jsx)(p.default,{setDragging:l,dragCounter:r,handleUpload:n,children:(0,a.jsxs)(c.default,{className:tq.editorContainer,bodyStyle:{padding:0,height:"100%"},children:[t&&(0,a.jsx)(y.default,{}),e?(0,a.jsx)(w.PhotoEditorProvider,{imageUrl:e,initialProject:u,addOnFile:i,setAddOnFile:s,children:(0,a.jsxs)(f.default,{style:{height:"100%"},children:[(0,a.jsx)(tJ,{theme:"light",width:60,className:tq.toolbarSider,children:(0,a.jsx)(e8,{})}),(0,a.jsx)(tG,{className:tq.canvasContent,children:(0,a.jsx)(e3,{})}),(0,a.jsxs)(tJ,{theme:"light",width:300,className:tq.propertiesSider,children:[(0,a.jsx)(tV,{}),(0,a.jsx)(tp,{})]})]})}):(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%",padding:"20px",overflowY:"auto"},children:[(0,a.jsx)(tH,{onUpload:n}),h.length>0&&(0,a.jsxs)("div",{style:{width:"100%",maxWidth:"800px",marginTop:"40px"},children:[(0,a.jsx)(m.default,{children:"Or Open Saved Project"}),(0,a.jsx)(e$,{projects:h,onLoad:o,onDelete:g})]})]})]})})});};},"743075ef":function(e,t,l){l.d(t,"__esModule",{value:!0}),l.e(t,{PhotoEditorProvider:function(){return o;},usePhotoEditor:function(){return c;}});var r=l("852bbaa9"),n=l("1a7c85b4"),a=l("d322be42"),i=r._(a);let s=e=>{let[t,l]=(0,i.useState)([]),[r,n]=(0,i.useState)(-1),[a,s]=(0,i.useState)(!1),d=(0,i.useCallback)(()=>{if(!e||a)return;let i=JSON.stringify(e.toJSON());if(t.length>0&&r>=0&&t[r]===i)return;let s=t.slice(0,r+1);s.push(i),s.length>50&&s.shift(),l(s),n(s.length-1);},[e,t,r,a]);return(0,i.useEffect)(()=>{if(!e)return;let t=()=>{d();};return e.on("object:modified",t),e.on("object:added",t),e.on("object:removed",t),e.on("path:created",t),()=>{e.off("object:modified",t),e.off("object:added",t),e.off("object:removed",t),e.off("path:created",t);};},[e,d]),{saveState:d,undo:(0,i.useCallback)(()=>{if(!e||r<=0||a)return;s(!0);let l=r-1,i=t[l];e.loadFromJSON(JSON.parse(i)).then(()=>{e.renderAll(),n(l),s(!1);});},[e,t,r,a]),redo:(0,i.useCallback)(()=>{if(!e||r>=t.length-1||a)return;s(!0);let l=r+1,i=t[l];e.loadFromJSON(JSON.parse(i)).then(()=>{e.renderAll(),n(l),s(!1);});},[e,t,r,a]),canUndo:r>0,canRedo:r<t.length-1};},d=(0,i.createContext)(void 0),o=({children:e,imageUrl:t,initialProject:l,addOnFile:r,setAddOnFile:a})=>{let[o,c]=(0,i.useState)(null),[u,f]=(0,i.useState)("select"),[h,x]=(0,i.useState)(null),[g,m]=(0,i.useState)(null),[v,p]=(0,i.useState)(5),[j,y]=(0,i.useState)("#000000"),[w,b]=(0,i.useState)(1),C=s(o);return(0,n.jsx)(d.Provider,{value:{canvas:o,setCanvas:c,activeTool:u,setActiveTool:f,selectedObject:h,setSelectedObject:x,history:C,clipboard:g,setClipboard:m,imageUrl:t,initialProject:l,addOnFile:r,setAddOnFile:a,brushSize:v,setBrushSize:p,brushColor:j,setBrushColor:y,brushOpacity:w,setBrushOpacity:b},children:e});},c=()=>{let e=(0,i.useContext)(d);if(!e)throw Error("usePhotoEditor must be used within a PhotoEditorProvider");return e;};}}]);
//# sourceMappingURL=ad692153-async.497d7909.js.map