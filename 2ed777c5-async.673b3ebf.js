(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]||[]).push([["2ed777c5"],{f0e8d3d2:function(e,t,r){r.d(t,"__esModule",{value:!0}),r.e(t,{default:function(){return t8;}});var l=r("777fffbe"),a=r("852bbaa9"),n=r("1a7c85b4"),i=r("13dfe186"),o=l._(i),s=r("85d53cee"),c=l._(s),d=r("70bd2056"),u=l._(d),h=r("b2a1469e"),f=l._(h),x=r("e9bcd22d"),g=l._(x),m=r("ea21718c"),p=l._(m),y=r("92be0fc5"),v=l._(y),w=r("e23084de"),j=l._(w),b=r("6effc0fd"),C=l._(b),S=r("34f06567"),k=l._(S),M=r("c9d8dc0b"),z=l._(M),R=r("d322be42"),I=a._(R),E=r("dfa4ac87"),D=l._(E);function L(e,t){let r=document.createElement("canvas");return r.width=e,r.height=t,r;}function B(e,t,r){let l=e.width,a=e.height,n=e.data,i=new Uint8ClampedArray(n.length),o=Math.floor(r/2);for(let e=0;e<a;e++)for(let s=0;s<l;s++){let c=0,d=0,u=0,h=0;for(let i=0;i<r;i++)for(let f=0;f<r;f++){let x=s+f-o,g=e+i-o;if(x<0||x>=l||g<0||g>=a)continue;let m=(g*l+x)*4,p=t[i*r+f];c+=n[m]*p,d+=n[m+1]*p,u+=n[m+2]*p,h+=n[m+3]*p;}let f=(e*l+s)*4;i[f]=Math.min(255,Math.max(0,c)),i[f+1]=Math.min(255,Math.max(0,d)),i[f+2]=Math.min(255,Math.max(0,u)),i[f+3]=Math.min(255,Math.max(0,h||n[f+3]));}return e.data.set(i),e;}let T={sharpen:[0,-1,0,-1,5,-1,0,-1,0],blur3:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],gaussian5:[1/273,4/273,7/273,4/273,1/273,4/273,16/273,26/273,16/273,4/273,7/273,26/273,41/273,26/273,7/273,4/273,16/273,26/273,16/273,4/273,1/273,4/273,7/273,4/273,1/273],generateBoxBlurKernel(e){let t=0|e,r=t*t;return Array(r).fill(1/r);},generateGaussianKernel(e){let t=0|e,r=t/2,l=2*r*r,a=[],n=0;for(let e=-t;e<=t;e++)for(let r=-t;r<=t;r++){let t=Math.exp(-(r*r+e*e)/l);a.push(t),n+=t;}return a.map(e=>e/n);}},A=(e,t=0,r=255)=>Math.min(r,Math.max(t,e)),P=e=>Math.min(1,Math.max(0,e)),H=(e,t,r)=>{let l=Math.max(e/=255,t/=255,r/=255),a=Math.min(e,t,r),n=0,i=0,o=(l+a)/2;if(l!==a){let s=l-a;switch(i=o>.5?s/(2-l-a):s/(l+a),l){case e:n=(t-r)/s+(t<r?6:0);break;case t:n=(r-e)/s+2;break;case r:n=(e-t)/s+4;}n/=6;}return[n,i,o];},N=(e,t,r)=>{let l,a,n;if(0===t)l=a=n=r;else{let i=(e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6)?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e,o=r<.5?r*(1+t):r+t-r*t,s=2*r-o;l=i(s,o,e+1/3),a=i(s,o,e),n=i(s,o,e-1/3);}return[Math.round(255*l),Math.round(255*a),Math.round(255*n)];},U=(e,{highlights:t=0,shadows:r=0,whites:l=0,blacks:a=0,vibrance:n=0,saturation:i=0,clarity:o=0,dehaze:s=0})=>{let c=e.data,d=0!==o?new Uint8ClampedArray(c):null;for(let e=0;e<c.length;e+=4){let u=c[e],h=c[e+1],f=c[e+2],x=.299*u+.587*h+.114*f;if(x>192&&0!==t){let e=(x-192)/63;u=A(u+t*e),h=A(h+t*e),f=A(f+t*e);}if(x<64&&0!==r){let e=1-x/64;u=A(u+r*e),h=A(h+r*e),f=A(f+r*e);}if(u=A(u+l-a),h=A(h+l-a),f=A(f+l-a),0!==s&&(u=A(u*(1+s/100)),h=A(h*(1-s/200)),f=A(f*(1-s/200))),0!==n||0!==i){let e=[u,h,f];$(e,0,{vibrance:n,saturation:i}),[u,h,f]=e;}if(0!==o&&d){let t=o/100*(x-(.299*d[e]+.587*d[e+1]+.114*d[e+2]));u=A(u+t),h=A(h+t),f=A(f+t);}c[e]=u,c[e+1]=h,c[e+2]=f;}return e;},_=(e,t,r)=>{let l=e[t],a=e[t+1],n=e[t+2],[i,o,s]=H(l,a,n),c=1+r/100*1.5;l=A(128+(l-128)*c),a=A(128+(a-128)*c),n=A(128+(n-128)*c),[i,o,s]=H(l,a,n),o=P(o*(1+r/100*.6)),s=P(s*(1+r/100*.15)),[l,a,n]=N(i,o,s),e[t]=l,e[t+1]=a,e[t+2]=n;},$=(e,t,{vibrance:r=0,saturation:l=0})=>{let[a,n,i]=H(e[t],e[t+1],e[t+2]);0!==l&&(n=P(n*(1+l/100))),0!==r&&(n=P(n+r/100*(1-n)*(1-n)));let[o,s,c]=N(a,n,i);e[t]=o,e[t+1]=s,e[t+2]=c;},W=[{name:"red",range:[345,15]},{name:"orange",range:[15,45]},{name:"yellow",range:[45,75]},{name:"green",range:[75,165]},{name:"aqua",range:[165,195]},{name:"blue",range:[195,255]},{name:"purple",range:[255,285]},{name:"magenta",range:[285,345]}],F=(e,t)=>{let r=e.data;for(let e=0;e<r.length;e+=4){let[l,a,n]=[r[e],r[e+1],r[e+2]],[i,o,s]=H(l,a,n),c=(360*i+360)%360,d=W.find(({range:e})=>{let[t,r]=e;return t<=r?c>=t&&c<=r:c>=t||c<=r;});if(!d){[r[e],r[e+1],r[e+2]]=N(i,o,s);continue;}let u=t[d.name];if(!u){[r[e],r[e+1],r[e+2]]=N(i,o,s);continue;}let[h,f]=d.range,x=f;h>x&&(x+=360);let g=c;if(g<h&&(g+=360),"number"==typeof u.h&&0!==u.h){let e=g+u.h;e<h&&(e=h),e>x&&(e=x),i=(c=(e%360+360)%360)/360;}"number"==typeof u.s&&0!==u.s&&(o=P(o*(1+(1>=Math.abs(u.s)?100*u.s:u.s)/100))),"number"==typeof u.l&&0!==u.l&&(s=P(s*(1+(1>=Math.abs(u.l)?100*u.l:u.l)/100))),[r[e],r[e+1],r[e+2]]=N(i,o,s);}return e;},O=(e,t,r,l)=>{if(!t.current)return;let a=t.current,n=L(a.width,a.height);n.getContext("2d").drawImage(a,0,0);let i=L(a.height,a.width),o=i.getContext("2d");o.translate(i.width/2,i.height/2),o.rotate(e*Math.PI/180),o.drawImage(n,-n.width/2,-n.height/2),t.current.width=i.width,t.current.height=i.height,r.current.width=i.width,r.current.height=i.height;let s=t.current.getContext("2d");s.clearRect(0,0,i.width,i.height),s.drawImage(i,0,0),l.push(t.current.toDataURL(),`Rotate ${e}`);},G=(e,t)=>{if(!e.current)return;let r=e.current.getContext("2d"),l=L(e.current.width,e.current.height);l.getContext("2d").drawImage(e.current,0,0),r.save(),r.clearRect(0,0,e.current.width,e.current.height),r.scale(-1,1),r.drawImage(l,-e.current.width,0),r.restore(),t.push(e.current.toDataURL(),"Flip horizontal");},V=(e,t)=>{if(!e.current)return;let r=e.current.getContext("2d"),l=L(e.current.width,e.current.height);l.getContext("2d").drawImage(e.current,0,0),r.save(),r.clearRect(0,0,e.current.width,e.current.height),r.scale(1,-1),r.drawImage(l,0,-e.current.height),r.restore(),t.push(e.current.toDataURL(),"Flip vertical");},X=(e,t,r,l,a)=>{if(!e.current||!r)return;let n=L(Math.max(1,Math.round(r.w)),Math.max(1,Math.round(r.h)));n.getContext("2d").drawImage(e.current,r.x,r.y,r.w,r.h,0,0,r.w,r.h),e.current.width=n.width,e.current.height=n.height,t.current.width=n.width,t.current.height=n.height;let i=e.current.getContext("2d");i.clearRect(0,0,n.width,n.height),i.drawImage(n,0,0),l(null),a.push(e.current.toDataURL(),"Cropped");},Y=async e=>{if(e.current)try{let t=await new Promise(t=>e.current.toBlob(e=>t(e),"image/png"));if(!t)return;await navigator.clipboard.write([new ClipboardItem({"image/png":t})]),z.default.success("Image copied to clipboard");}catch(e){console.warn("clipboard failed",e),z.default.error("Copy failed (browser may not support)");}},K=(e,t,r)=>{let l=t.current;if(!l)return null;let a=l.getBoundingClientRect(),n=Math.floor((e.clientX-a.left)/r),i=Math.floor((e.clientY-a.top)/r);if(n<0||i<0||n>=l.width||i>=l.height)return null;let o=l.getContext("2d",{willReadFrequently:!0});if(!o)return null;let s=o.getImageData(n,i,1,1).data;return`#${[s[0],s[1],s[2]].map(e=>e.toString(16).padStart(2,"0")).join("")}`;},q=(e,t,r,l,a,n,i)=>{let o=new Image;o.onload=()=>{var e,i;let s=(null===(e=t.current)||void 0===e?void 0:e.width)||o.naturalWidth,c=(null===(i=t.current)||void 0===i?void 0:i.height)||o.naturalHeight,d=o.naturalWidth,u=o.naturalHeight,h=Math.min(1,Math.min(s/(1.2*d),c/(1.2*u))),f=Math.round((s-(d=Math.round(d*h)))/2),x=Math.round((c-(u=Math.round(u*h)))/2),g=`${Date.now()}_${Math.round(1e4*Math.random())}`,m={id:g,type:"image",img:o,rect:{x:f,y:x,w:d,h:u},opacity:1,blend:"source-over"};r(e=>[...e,m]),l(g),a(!0),n(),z.default.success("Overlay image added");},o.onerror=()=>z.default.error("Failed to load overlay image"),o.src=URL.createObjectURL(e),i("layer");},J=async(e,t,r,l)=>{if(!t.current)return;let a=t.current,n=L(a.width,a.height),i=n.getContext("2d");for(let e of(i.clearRect(0,0,n.width,n.height),i.drawImage(a,0,0),r))try{if(i.globalAlpha=e.opacity,i.globalCompositeOperation=e.blend||"source-over",e.rotation&&0!==e.rotation){let t=e.rect.x+e.rect.w/2,r=e.rect.y+e.rect.h/2;i.translate(t,r),i.rotate(e.rotation*Math.PI/180),i.translate(-t,-r);}if("image"===e.type&&e.img)i.drawImage(e.img,e.rect.x,e.rect.y,e.rect.w,e.rect.h);else if("text"===e.type){let t=e.fontItalic?"italic":"normal",r=e.fontWeight||"normal",l=e.fontSize||16;i.font=`${t} ${r} ${l}px ${e.font||"Arial"}`,i.fillStyle=e.textColor||"#000000",i.textAlign=e.textAlign||"left",i.textBaseline="top";let a=(e.text||"").split("\n"),n=1.2*l,o=e.rect.y;for(let t of a){let r=e.rect.x;if("center"===e.textAlign?r+=e.rect.w/2:"right"===e.textAlign&&(r+=e.rect.w),i.fillText(t,r,o),"underline"===e.textDecoration){let a=i.measureText(t);i.strokeStyle=e.textColor||"#000000",i.lineWidth=1,i.beginPath(),i.moveTo(r,o+l),i.lineTo(r+a.width,o+l),i.stroke();}else if("line-through"===e.textDecoration){let a=i.measureText(t);i.strokeStyle=e.textColor||"#000000",i.lineWidth=1,i.beginPath(),i.moveTo(r,o+l/2),i.lineTo(r+a.width,o+l/2),i.stroke();}o+=n;}}e.rotation&&0!==e.rotation&&i.setTransform(1,0,0,1,0,0);}catch(e){}i.globalAlpha=1,i.globalCompositeOperation="source-over";let o=await new Promise(t=>n.toBlob(e=>t(e),e?"image/jpeg":"image/png",.92));if(o){l&&l(o);let t=URL.createObjectURL(o),r=document.createElement("a");r.href=t,r.download=e?"edited.jpg":"edited.png",r.click(),URL.revokeObjectURL(t),z.default.success("Exported image (with overlays)");}},Z=(e,t,r,l,a)=>{if(!e.current)return;let n=a?t.filter(e=>e.id===a&&!e.locked):t.slice();if(0===n.length)return;let i=e.current.getContext("2d");for(let e of n)try{if(i.save(),i.globalAlpha=e.opacity,i.globalCompositeOperation=e.blend||"source-over",e.rotation&&0!==e.rotation){let t=e.rect.x+e.rect.w/2,r=e.rect.y+e.rect.h/2;i.translate(t,r),i.rotate(e.rotation*Math.PI/180),i.translate(-t,-r);}if("image"===e.type&&e.img)i.drawImage(e.img,e.rect.x,e.rect.y,e.rect.w,e.rect.h);else if("text"===e.type){let t=e.fontItalic?"italic":"normal",r=e.fontWeight||"normal",l=e.fontSize||16;i.font=`${t} ${r} ${l}px ${e.font||"Arial"}`,i.fillStyle=e.textColor||"#000000",i.textAlign=e.textAlign||"left",i.textBaseline="top";let a=(e.text||"").split("\n"),n=1.2*l,o=e.rect.y;for(let t of a){let r=e.rect.x;if("center"===e.textAlign?r+=e.rect.w/2:"right"===e.textAlign&&(r+=e.rect.w),i.fillText(t,r,o),"underline"===e.textDecoration){let a=i.measureText(t);i.strokeStyle=e.textColor||"#000000",i.lineWidth=1,i.beginPath(),i.moveTo(r,o+l),i.lineTo(r+a.width,o+l),i.stroke();}else if("line-through"===e.textDecoration){let a=i.measureText(t);i.strokeStyle=e.textColor||"#000000",i.lineWidth=1,i.beginPath(),i.moveTo(r,o+l/2),i.lineTo(r+a.width,o+l/2),i.stroke();}o+=n;}}i.restore();}catch(e){}r(e=>e.filter(e=>!n.find(t=>t.id===e.id))),l.push(e.current.toDataURL(),a?"Merge layer":"Merge layers"),z.default.success("Layer(s) merged into base");},Q=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,opacity:r}:e)),ee=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,blend:r}:e)),et=(e,t)=>e(e=>{let r=e.findIndex(e=>e.id===t);if(-1===r||r===e.length-1)return e;let l=e.slice(),a=l[r+1];return l[r+1]=l[r],l[r]=a,l;}),er=(e,t)=>e(e=>{let r=e.findIndex(e=>e.id===t);if(r<=0)return e;let l=e.slice(),a=l[r-1];return l[r-1]=l[r],l[r]=a,l;}),el=(e,t,r)=>e(e=>{let l=e.filter(e=>e.id!==t||e.locked);return r&&r(l.length?l[l.length-1].id:null),l;}),ea=(e,t)=>{e(t);},en=(e,t,r,l,a,n,i)=>{var o,s;if(!n.text.trim()){z.default.warning("Please enter text first");return;}let c=(null===(o=e.current)||void 0===o?void 0:o.width)||400,d=(null===(s=e.current)||void 0===s?void 0:s.height)||300,u=i?Math.round(i.x):Math.round(c/4),h=i?Math.round(i.y):Math.round(d/4),f=`text_${Date.now()}_${Math.round(1e4*Math.random())}`,x={id:f,type:"text",rect:{x:u,y:h,w:Math.min(300,c/2),h:n.fontSize+20},opacity:1,blend:"source-over",text:n.text,font:n.font,fontSize:n.fontSize,fontWeight:n.fontWeight,fontItalic:n.fontItalic,textDecoration:n.textDecoration,textColor:n.textColor,textAlign:n.textAlign};t(e=>[...e,x]),r(f),l(!0),a(),z.default.success("Text layer added");},ei=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,text:r}:e)),eo=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,font:r}:e)),es=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,fontSize:r}:e)),ec=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,fontWeight:r}:e)),ed=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,fontItalic:r}:e)),eu=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,textDecoration:r}:e)),eh=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,textColor:r}:e)),ef=(e,t,r)=>e(e=>e.map(e=>e.id===t?{...e,textAlign:r}:e)),ex=(e,t,r)=>{if(!e.current||!t.current)return;let{zoom:l,cropRect:a,rulerPoints:n,perspectivePoints:i,hoverColor:o,tool:s,drawColor:c,drawLineWidth:d,layers:u,overlaySelected:h,activeLayerId:f}=r,x=e.current.getContext("2d");if(x.clearRect(0,0,e.current.width,e.current.height),a&&(x.save(),x.strokeStyle="#00aaff",x.lineWidth=2,x.setLineDash([6,4]),x.strokeRect(a.x,a.y,a.w,a.h),x.restore()),n&&(x.save(),x.strokeStyle="#ffcc00",x.lineWidth=2,x.beginPath(),x.moveTo(n.x1,n.y1),x.lineTo(n.x2,n.y2),x.stroke(),x.restore()),i){x.save();let e=[];for(let t=0;t<8;t+=2){let r=i[t],l=i[t+1];isNaN(r)||isNaN(l)||e.push({x:r,y:l});}if(e.length>=2){x.strokeStyle="rgba(0,255,0,0.9)",x.lineWidth=2,x.setLineDash([4,4]),x.beginPath(),x.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++)x.lineTo(e[t].x,e[t].y);4===e.length&&x.closePath(),x.stroke();}x.fillStyle="rgba(0,255,0,0.9)";for(let e=0;e<8;e+=2){let t=i[e],r=i[e+1];isNaN(t)||isNaN(r)||x.fillRect(t-5,r-5,10,10);}x.restore();}if(o&&"color"===s){let e=t.current.getBoundingClientRect(),r=(o.x-e.left)/l,a=(o.y-e.top)/l;x.save(),x.strokeStyle=o.color,x.lineWidth=2/l,x.beginPath(),x.arc(r,a,8/l,0,2*Math.PI),x.stroke(),x.restore();}for(let e of u)try{if(x.save(),x.globalAlpha=e.opacity,x.globalCompositeOperation=e.blend||"source-over",e.rotation&&0!==e.rotation){let t=e.rect.x+e.rect.w/2,r=e.rect.y+e.rect.h/2;x.translate(t,r),x.rotate(e.rotation*Math.PI/180),x.translate(-t,-r);}if("image"===e.type&&e.img)x.drawImage(e.img,e.rect.x,e.rect.y,e.rect.w,e.rect.h);else if("text"===e.type){let t=e.fontItalic?"italic":"normal",r=e.fontWeight||"normal",l=e.fontSize||16;x.font=`${t} ${r} ${l}px ${e.font||"Arial"}`,x.fillStyle=e.textColor||"#000000",x.textAlign=e.textAlign||"left",x.textBaseline="top";let a=(e.text||"").split("\n"),n=1.2*l,i=e.rect.y;for(let t of a){let r=e.rect.x;if("center"===e.textAlign?r+=e.rect.w/2:"right"===e.textAlign&&(r+=e.rect.w),x.fillText(t,r,i),"underline"===e.textDecoration){let a=x.measureText(t);x.strokeStyle=e.textColor||"#000000",x.lineWidth=1,x.beginPath(),x.moveTo(r,i+l),x.lineTo(r+a.width,i+l),x.stroke();}else if("line-through"===e.textDecoration){let a=x.measureText(t);x.strokeStyle=e.textColor||"#000000",x.lineWidth=1,x.beginPath(),x.moveTo(r,i+l/2),x.lineTo(r+a.width,i+l/2),x.stroke();}i+=n;}}x.restore();}catch(e){}if(h&&f){let e=u.find(e=>e.id===f);if(e){let t=e.rect;if(x.save(),x.globalAlpha=1,x.globalCompositeOperation="source-over",e.rotation&&0!==e.rotation){let r=t.x+t.w/2,l=t.y+t.h/2;x.translate(r,l),x.rotate(e.rotation*Math.PI/180),x.translate(-r,-l);}x.strokeStyle="rgba(255,165,0,0.95)",x.lineWidth=2,x.setLineDash([6,3]),x.strokeRect(t.x,t.y,t.w,t.h),x.setLineDash([]),x.fillStyle="rgba(255,165,0,0.95)";let r=Math.max(6/Math.max(1,l),6),a=r/2;[[t.x,t.y],[t.x+t.w,t.y],[t.x,t.y+t.h],[t.x+t.w,t.y+t.h]].forEach(([e,t])=>x.fillRect(e-a,t-a,r,r)),x.fillStyle="rgba(0,180,255,0.95)",[[t.x+t.w/2,t.y],[t.x+t.w/2,t.y+t.h],[t.x,t.y+t.h/2],[t.x+t.w,t.y+t.h/2]].forEach(([e,t])=>{x.fillRect(e-a,t-a,r,r);}),x.restore();}}if(o&&"draw"===s){let e=t.current.getBoundingClientRect(),r=(o.x-e.left)/l,a=(o.y-e.top)/l;x.save(),x.strokeStyle=c,x.lineWidth=2/l,x.beginPath(),x.arc(r,a,d/2,0,2*Math.PI),x.stroke(),x.restore();}},eg=e=>{let{canvasX:t,canvasY:r,canvasRect:l,containerRef:a,inlineEditorRef:n,zoom:i,initial:o="",layerId:s,layer:c,textColor:d="#000",textFont:u="Arial",textFontSize:h=16,textWeight:f="normal",textItalic:x=!1,onCommit:g,onCancel:m}=e;n.current&&(n.current.remove(),n.current=null);let p=a.current,y=p?p.getBoundingClientRect():{left:0,top:0},v=l.left+t*i,w=l.top+r*i,j=v-y.left,b=w-y.top,C=document.createElement("textarea");C.value=o,C.style.position="absolute",C.style.left=`${j}px`,C.style.top=`${b}px`,C.style.zIndex="10000",C.style.minWidth="60px",C.style.minHeight="24px",C.style.background="transparent",C.style.border="1px dashed rgba(0,0,0,0.4)",C.style.color=c&&c.textColor||d||"#000",C.style.fontFamily=c&&c.font||u||"Arial";let S=c&&c.fontSize||h||16;C.style.fontSize=`${S*i}px`,C.style.fontWeight=String(c&&c.fontWeight||f||"normal"),C.style.fontStyle=c&&c.fontItalic||x?"italic":"normal",C.style.resize="both",C.style.outline="none",C.style.padding="4px",C.placeholder="Type text and press Enter";let k=!1,M=()=>{k||(k=!!C.value&&!o,g(C.value||""),C.remove(),n.current=null);},z=()=>{C.remove(),n.current=null,m&&m();};C.addEventListener("keydown",e=>{e.shiftKey&&"Enter"===e.key||("Enter"!==e.key||e.shiftKey?"Escape"===e.key&&(e.preventDefault(),z()):(e.preventDefault(),M()));}),C.addEventListener("blur",()=>{M();});let R=()=>{C.style.position="fixed",C.style.left=`${v}px`,C.style.top=`${w}px`,C.style.zIndex="200000",document.body.appendChild(C),n.current=C,C.focus(),C.selectionStart=C.selectionEnd=C.value.length,console.log("[DEBUG] appended editor to document.body at",{fixedLeft:v,fixedTop:w});};p?(()=>{try{if(p)p.appendChild(C);else throw Error("no container");}catch(e){console.warn("[DEBUG] append to container failed, will fallback to body",e),R();return;}n.current=C,C.focus(),C.selectionStart=C.selectionEnd=C.value.length,requestAnimationFrame(()=>{try{let e=C.getBoundingClientRect();0===e.width&&0===e.height&&(console.warn("[DEBUG] appended editor has zero size; falling back to body"),C.remove(),R());}catch(e){}});})():R();},em=async(e,t,r,l,a,n)=>{if(!e.current||!r.current){z.default.warning("No perspective points defined.");return;}let i=r.current,o=[];for(let e=0;e<8;e+=2){let t=i[e],r=i[e+1];isNaN(t)||isNaN(r)||o.push([t,r]);}if(4!==o.length){z.default.error("Please select 4 corner points before applying perspective correction.");return;}try{let i=(e=>{let t=e.reduce((e,t)=>e+t[0],0)/e.length,r=e.reduce((e,t)=>e+t[1],0)/e.length,l=e.map(e=>({pt:e,angle:Math.atan2(e[1]-r,e[0]-t)})).sort((e,t)=>e.angle-t.angle).map(e=>e.pt),a=0;for(let e=0;e<l.length;e++){let[t,r]=l[e],[n,i]=l[(e+1)%l.length];a+=t*i-n*r;}a>0&&l.reverse();let n=0;for(let e=1;e<l.length;e++)(l[e][1]<l[n][1]||l[e][1]===l[n][1]&&l[e][0]<l[n][0])&&(n=e);return Array.from({length:l.length},(e,t)=>l[(n+t)%l.length]);})(o),s=[Math.round(i[0][0]),Math.round(i[0][1]),Math.round(i[1][0]),Math.round(i[1][1]),Math.round(i[2][0]),Math.round(i[2][1]),Math.round(i[3][0]),Math.round(i[3][1])],c=function(e,t,r,l){let a=L(r,l),n=a.getContext("2d"),i=e.getContext("2d").getImageData(0,0,e.width,e.height),o=n.createImageData(r,l),s=[[t[0],t[1]],[t[2],t[3]],[t[4],t[5]],[t[6],t[7]]],c=function(e,t){if(4!==e.length||4!==t.length)throw Error("computeHomography requires exactly 4 points for src and dst");let r=[];for(let l=0;l<4;l++){let[a,n]=e[l],[i,o]=t[l];r.push([-a,-n,-1,0,0,0,a*i,n*i,i]),r.push([0,0,0,-a,-n,-1,a*o,n*o,o]);}let l=[],a=[];for(let e=0;e<8;e++)l.push(r[e].slice(0,8)),a.push(-r[e][8]);let n=[...function(e,t){let r=t.length,l=e.map((e,r)=>[...e,t[r]]);for(let e=0;e<r;e++){let t=e;for(let a=e+1;a<r;a++)Math.abs(l[a][e])>Math.abs(l[t][e])&&(t=a);[l[e],l[t]]=[l[t],l[e]];for(let t=e+1;t<r;t++){let a=l[t][e]/l[e][e];for(let n=e;n<=r;n++)l[t][n]-=a*l[e][n];}}let a=Array(r).fill(0);for(let e=r-1;e>=0;e--){let t=l[e][r];for(let n=e+1;n<r;n++)t-=l[e][n]*a[n];a[e]=t/l[e][e];}return a;}(l,a),1];return[[n[0],n[1],n[2]],[n[3],n[4],n[5]],[n[6],n[7],n[8]]];}(s,[[0,0],[r,0],[r,l],[0,l]]);for(let t=0;t<l;t++)for(let l=0;l<r;l++){let[a,n]=function(e,t,r){let[[l,a,n],[i,o,s],[c,d,u]]=e,h=l*(o*u-s*d)-a*(i*u-s*c)+n*(i*d-o*c);if(1e-10>Math.abs(h))return[0,0];let f=[[(o*u-s*d)/h,(n*d-a*u)/h,(a*s-n*o)/h],[(s*c-i*u)/h,(l*u-n*c)/h,(n*i-l*s)/h],[(i*d-o*c)/h,(a*c-l*d)/h,(l*o-a*i)/h]],x=f[0][0]*t+f[0][1]*r+f[0][2],g=f[1][0]*t+f[1][1]*r+f[1][2],m=f[2][0]*t+f[2][1]*r+f[2][2];return[x/m,g/m];}(c,l,t);if(a>=0&&a<e.width&&n>=0&&n<e.height){let s=Math.floor(a),c=(Math.floor(n)*e.width+s)*4,d=(t*r+l)*4;o.data[d]=i.data[c],o.data[d+1]=i.data[c+1],o.data[d+2]=i.data[c+2],o.data[d+3]=i.data[c+3];}}return n.putImageData(o,0,0),a;}(e.current,s,e.current.width,e.current.height);e.current.width=c.width,e.current.height=c.height,t.current.width=c.width,t.current.height=c.height;let d=e.current.getContext("2d");d.clearRect(0,0,c.width,c.height),d.drawImage(c,0,0),l.push(e.current.toDataURL(),"Perspective corrected"),r.current=null,a(!1),n(),z.default.success("Perspective correction applied.");}catch(e){console.error("Perspective transform failed",e),z.default.error("Failed to apply perspective correction.");}},ep=async(e,t,r,l)=>{if(!e||t<=1)return e;let a=e,n=1;for(;n<t;){let e=Math.min(2,t/n),l=Math.max(1,Math.round(a.width*e)),i=Math.max(1,Math.round(a.height*e)),o=L(l,i),s=o.getContext("2d");s.imageSmoothingEnabled=!0,s.imageSmoothingQuality=r,s.clearRect(0,0,l,i),s.drawImage(a,0,0,a.width,a.height,0,0,l,i),a=o,n*=e,await new Promise(e=>setTimeout(e,0));}if(l&&(l.sharpen||l.edgeEnhancement||l.denoise)){let e=a.getContext("2d"),t=e.getImageData(0,0,a.width,a.height);if(l.denoise&&l.denoise>0){let e=l.denoise/100,r=T.gaussian5,a=Math.ceil(2*e);for(let e=0;e<a;e++)B(t,r,5);}if(l.edgeEnhancement&&l.edgeEnhancement>0){let e=l.edgeEnhancement/100;B(t,[0,-1*e,0,-1*e,1+4*e,-1*e,0,-1*e,0],3);}if(l.sharpen&&l.sharpen>0){let e=Math.ceil(3*(l.sharpen/100));for(let r=0;r<e;r++)B(t,T.sharpen,3);}e.putImageData(t,0,0);}return a;},ey=async(e,t,r,l,a,n,i,o,s)=>{if(e.current)try{let c=await ep(e.current,i,o,s);if(!c)return;let d=c.toDataURL(),u=new Image,h=t.current?t.current.style.display:"";t.current&&(t.current.style.display="none"),u.onload=()=>{try{let o=document.createElement("canvas");o.width=u.naturalWidth,o.height=u.naturalHeight,o.getContext("2d").drawImage(u,0,0);try{l(o);}catch(e){}e.current.width=o.width,e.current.height=o.height,t.current&&(t.current.width=o.width,t.current.height=o.height);let s=e.current.getContext("2d");s.clearRect(0,0,o.width,o.height),s.drawImage(u,0,0),r.push(e.current.toDataURL(),`Upscaled ${i}x`),a(e=>{if(!e[0])return e;let t=e.slice(),r={...t[0]};return r.img&&(r.img.src=d),r.rect={x:0,y:0,w:o.width,h:o.height},t[0]=r,t;}),t.current&&(t.current.style.display=h||""),n(),z.default.success(`Upscaled ${i}x`);}catch(e){console.error("Failed to finalize upscale draw",e),t.current&&(t.current.style.display=h||""),z.default.error("Upscale failed to render");}},u.onerror=e=>{t.current&&(t.current.style.display=h||""),console.error("Upscaled image failed to load",e),z.default.error("Upscaled image failed to load");},u.src=d;}catch(e){console.error("Upscale failed",e),z.default.error("Upscale failed");}},ev={blur:0,gaussian:0,sharpen:0,texture:0,clarity:0,bgThreshold:0,bgThresholdBlack:0,brightness:0,contrast:0,highlights:0,shadows:0,whites:0,blacks:0,vibrance:0,saturation:0,dehaze:0,hslAdjustments:{}},ew=null,ej=(e,t,{blur:r=0,gaussian:l=0,sharpen:a=0,bgThreshold:n=0,bgThresholdBlack:i=0,brightness:o=0,contrast:s=0,texture:c=0,clarity:d=0,highlights:u=0,shadows:h=0,whites:f=0,blacks:x=0,vibrance:g=0,saturation:m=0,dehaze:p=0,hslAdjustments:y={}},v,w)=>{if(!e.current||!t)return;let j=e.current.getContext("2d"),b=t.getContext("2d").getImageData(0,0,t.width,t.height);if(ew||(ew=b),!ew)return;let C=function(e){let t=new ImageData(e.width,e.height);return t.data.set(new Uint8ClampedArray(e.data)),t;}(b);if(0===r&&0===l&&0===a&&0===c&&0===d&&0===n&&0===i&&0===o&&0===s&&0===u&&0===h&&0===f&&0===x&&0===g&&0===m&&0===p&&0===Object.keys(y).length){j.putImageData(C,0,0),e.current&&w(eb(e.current));return;}if(r>0){let e=r%2==0?r+1:r;B(C,T.generateBoxBlurKernel(e),e);}if(l>0&&B(C,T.generateGaussianKernel(l),2*l+1),a>0&&B(C,T.sharpen.map(e=>5===e?1+4*a:-1===e?-a:e),3),0!==c){let e=c/100,t=-(2*e);B(C,[0,t,0,t,1+8*e,t,0,t,0],3);}if(0!==d){let e=d/100,t=-(2.5*e);B(C,[0,t,0,t,1+10*e,t,0,t,0],3);}if(n>0&&function(e,t=0){t=255-t;let r=e.data;for(let e=0;e<r.length;e+=4)r[e]>t&&r[e+1]>t&&r[e+2]>t&&(r[e+3]=0);}(C,n),i>0&&function(e,t=0){let r=e.data;for(let e=0;e<r.length;e+=4)r[e]<t&&r[e+1]<t&&r[e+2]<t&&(r[e+3]=0);}(C,i),(0!==o||0!==s)&&function(e,t=0,r=0){let l=e.data,a=r/100+1,n=128*(1-a);for(let e=0;e<l.length;e+=4)l[e]=Math.min(255,Math.max(0,l[e]*a+n+t)),l[e+1]=Math.min(255,Math.max(0,l[e+1]*a+n+t)),l[e+2]=Math.min(255,Math.max(0,l[e+2]*a+n+t));}(C,o,s),0!==u||0!==h||0!==f||0!==x||0!==g||0!==m||0!==p){let e=C.data;for(let t=0;t<e.length;t+=4)p&&_(e,t,p),(g||m)&&$(e,t,{vibrance:g,saturation:m});U(C,{highlights:u,shadows:h,whites:f,blacks:x,vibrance:g,saturation:m,clarity:d,dehaze:p});}Object.keys(y).length>0&&F(C,y),j.putImageData(C,0,0);let S=Object.entries({blur:r,gaussian:l,sharpen:a,texture:c,clarity:d,bgThreshold:n,bgThresholdBlack:i,brightness:o,contrast:s,highlights:u,shadows:h,whites:f,blacks:x,vibrance:g,saturation:m,dehaze:p,hslAdjustments:y}).filter(([e,t])=>ev[e]!==t);if(S.length>0){let t=S.map(([e,t])=>`${e}=${JSON.stringify(t)}`).join(", ");v.push(e.current.toDataURL(),`${t}`,!1),ev={blur:r,gaussian:l,sharpen:a,texture:c,clarity:d,bgThreshold:n,bgThresholdBlack:i,brightness:o,contrast:s,highlights:u,shadows:h,whites:f,blacks:x,vibrance:g,saturation:m,dehaze:p,hslAdjustments:y};}e.current&&w(eb(e.current));},eb=e=>{if(!e)return{red:Array(256).fill(0),green:Array(256).fill(0),blue:Array(256).fill(0)};let t=e.getContext("2d");if(!t)return{red:Array(256).fill(0),green:Array(256).fill(0),blue:Array(256).fill(0)};let{width:r,height:l}=e,{data:a}=t.getImageData(0,0,r,l),n=Array(256).fill(0),i=Array(256).fill(0),o=Array(256).fill(0);for(let e=0;e<a.length;e+=4)n[a[e]]++,i[a[e+1]]++,o[a[e+2]]++;return{red:n,green:i,blue:o};},eC=(e,t)=>{if(!e.current)return;let r=e.current,l=r.getContext("2d"),a=l.getImageData(0,0,r.width,r.height),n=a.data;for(let e=0;e<n.length;e+=4)n[e]=255-n[e],n[e+1]=255-n[e+1],n[e+2]=255-n[e+2];l.putImageData(a,0,0),t.push(r.toDataURL(),"Invert colors",!1);},eS=({canvasRef:e,overlayRef:t,containerRef:r,offset:l,zoom:a,tool:i,currentCursor:o,hoverColor:s,resolution:c,onMouseDown:d,onMouseMove:u,onMouseUp:h})=>(0,n.jsxs)("div",{ref:r,onMouseDown:d,onMouseMove:u,onMouseUp:h,style:{width:"100%",height:"100vh",overflow:"hidden",border:"1px solid #eee",position:"relative",background:"#fafafa",cursor:o},children:[c&&(0,n.jsx)("div",{style:{position:"absolute",right:12,top:12,background:"rgba(0,0,0,0.6)",color:"#fff",padding:"4px 8px",borderRadius:4,fontSize:12,zIndex:99999,pointerEvents:"none"},children:c}),(0,n.jsx)("canvas",{ref:e,style:{transform:`translate(${l.x}px, ${l.y}px) scale(${a})`,transformOrigin:"top left",display:"block"}}),(0,n.jsx)("canvas",{ref:t,style:{position:"absolute",left:0,top:0,pointerEvents:"none",transform:`translate(${l.x}px, ${l.y}px) scale(${a})`,transformOrigin:"top left"}}),s&&"color"===i&&(0,n.jsxs)("div",{style:{position:"fixed",left:s.x+12,top:s.y+12,background:"#fff",padding:"4px 8px",borderRadius:4,boxShadow:"0 0 6px rgba(0,0,0,0.2)",fontSize:12,zIndex:999999,pointerEvents:"none",display:"flex",alignItems:"center",gap:6},children:[(0,n.jsx)("span",{style:{display:"inline-block",width:12,height:12,background:s.color,border:"1px solid #ccc"}}),s.color]})]});var ek=r("d4a32650"),eM=l._(ek),ez=r("764a8673"),eR=l._(ez),eI=r("34f8e1c9"),eE=l._(eI),eD=r("076b2e3c"),eL=l._(eD),eB=r("d2d0b3b6"),eT=l._(eB),eA=r("047b2dca"),eP=l._(eA),eH=r("85c4e0d9"),eN=l._(eH),eU=I.forwardRef(function(e,t){return I.createElement(eN.default,(0,eT.default)((0,eT.default)({},e),{},{ref:t,icon:eP.default}));}),e_=r("3dfab21c"),e$=l._(e_),eW=r("376b0022"),eF=l._(eW),eO={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M567.1 512l318.5-319.3c5-5 1.5-13.7-5.6-13.7h-90.5c-2.1 0-4.2.8-5.6 2.3l-273.3 274-90.2-90.5c12.5-22.1 19.7-47.6 19.7-74.8 0-83.9-68.1-152-152-152s-152 68.1-152 152 68.1 152 152 152c27.7 0 53.6-7.4 75.9-20.3l90 90.3-90.1 90.3A151.04 151.04 0 00288 582c-83.9 0-152 68.1-152 152s68.1 152 152 152 152-68.1 152-152c0-27.2-7.2-52.7-19.7-74.8l90.2-90.5 273.3 274c1.5 1.5 3.5 2.3 5.6 2.3H880c7.1 0 10.7-8.6 5.6-13.7L567.1 512zM288 370c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80zm0 444c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}}]},name:"scissor",theme:"outlined"},eG=I.forwardRef(function(e,t){return I.createElement(eN.default,(0,eT.default)((0,eT.default)({},e),{},{ref:t,icon:eO}));}),eV={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},eX=I.forwardRef(function(e,t){return I.createElement(eN.default,(0,eT.default)((0,eT.default)({},e),{},{ref:t,icon:eV}));}),eY=r("1ee4d6ad"),eK=l._(eY),eq=r("5af7999d"),eJ=l._(eq),eZ=r("f2806aec"),eQ=l._(eZ),e0=r("f4444da2"),e1=l._(e0),e8={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 476H548V144h-72v332H152c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h324v332h72V548h324c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-166h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 498h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-664h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 498h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM650 216h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm56 592h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-332 0h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-56-592h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-166 0h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm56 592h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm-56-426h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm56 260h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"border-inner",theme:"outlined"},e4=I.forwardRef(function(e,t){return I.createElement(eN.default,(0,eT.default)((0,eT.default)({},e),{},{ref:t,icon:e8}));}),e2=r("a1e53af5"),e6=l._(e2),e5=r("2aa4d12e"),e3=l._(e5),e9=r("8e6ac0a6"),e7=l._(e9);let te=({label:e,value:t,min:r,max:l,gradient:a,onChange:i,onChangeComplete:o})=>(0,n.jsxs)("div",{className:"custom-slider-container",children:[(0,n.jsxs)("div",{style:{width:"100%"},children:[(0,n.jsx)("span",{className:"custom-label",children:e}),(0,n.jsx)(e3.default,{min:r,max:l,value:t,onChange:e=>i(Number(e)),onBlur:()=>null==o?void 0:o(),className:"custom-number",size:"small"})]}),(0,n.jsx)(e7.default,{min:r,max:l,value:t,onChange:i,onChangeComplete:o,className:"custom-slider",style:{"--custom-slider-gradient":a},handleStyle:{opacity:1}})]});var tt=r("10314b7a"),tr=l._(tt),tl=r("027e0896"),ta=l._(tl);let tn=({canvasRef:e,redData:t,greenData:r,blueData:l})=>{let a=(0,I.useMemo)(()=>({chart:{backgroundColor:"#2b2b2b",height:120,spacing:[5,5,5,5]},title:{text:""},xAxis:{title:{text:"",style:{color:"#fff"}},labels:{style:{color:"#fff",fontSize:"5px"}},gridLineColor:"rgba(255,255,255,0.1)"},yAxis:{title:{text:"",style:{color:"#fff"}},labels:{style:{color:"#fff",fontSize:"5px"}},gridLineColor:"rgba(255,255,255,0.1)"},legend:{enabled:!1},plotOptions:{histogram:{binWidth:4},series:{animation:!1,marker:{enabled:!1}}},series:[{name:"Red",data:t,color:"#ff4444",zIndex:3,lineWidth:1,marker:{radius:1}},{name:"Green",data:r,color:"#44ff44",zIndex:2,lineWidth:1,marker:{radius:1}},{name:"Blue",data:l,color:"#4444ff",zIndex:1,lineWidth:1,marker:{radius:1}}],credits:{enabled:!1},tooltip:{enabled:!1}}),[t,r,l]);return(0,n.jsx)(ta.default,{highcharts:tr.default,options:a});};var ti=r("7b738819"),to=l._(ti);let ts=({open:e,onCancel:t,onOk:r,upscaleFactor:l,setUpscaleFactor:a,presetLocal:i,setPresetLocal:o,sharpenAmount:s,setSharpenAmount:c,edgeEnhancement:d,setEdgeEnhancement:u,denoiseAmount:h,setDenoiseAmount:f})=>(0,n.jsx)(D.default,{title:"Custom Upscale",open:e,onCancel:t,onOk:r,okText:"Upscale",width:500,children:(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[(0,n.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[(0,n.jsxs)("div",{style:{minWidth:120},children:[(0,n.jsx)("div",{children:"Multiplier"}),(0,n.jsx)(e3.default,{min:1,max:8,step:.1,value:l,onChange:e=>a(Number(e||1))})]}),(0,n.jsxs)("div",{style:{flex:1},children:[(0,n.jsx)("div",{children:"Smoothing Quality"}),(0,n.jsx)("div",{style:{marginTop:8},children:(0,n.jsx)(to.default.Group,{value:i,onChange:e=>o(e.target.value),options:[{label:"Low",value:"low"},{label:"Medium",value:"medium"},{label:"High",value:"high"}],optionType:"button",buttonStyle:"solid"})})]})]}),(0,n.jsxs)("div",{style:{borderTop:"1px solid #f0f0f0",paddingTop:12},children:[(0,n.jsx)("div",{style:{marginBottom:8,fontWeight:500},children:"Quality Enhancements"}),(0,n.jsxs)("div",{style:{marginBottom:12},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[(0,n.jsx)("span",{children:"Sharpen"}),(0,n.jsxs)("span",{children:[s,"%"]})]}),(0,n.jsx)(e7.default,{min:0,max:100,value:s,onChange:c,tooltip:{formatter:e=>`${e}%`}})]}),(0,n.jsxs)("div",{style:{marginBottom:12},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[(0,n.jsx)("span",{children:"Edge Enhancement"}),(0,n.jsxs)("span",{children:[d,"%"]})]}),(0,n.jsx)(e7.default,{min:0,max:100,value:d,onChange:u,tooltip:{formatter:e=>`${e}%`}})]}),(0,n.jsxs)("div",{style:{marginBottom:12},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[(0,n.jsx)("span",{children:"Denoise"}),(0,n.jsxs)("span",{children:[h,"%"]})]}),(0,n.jsx)(e7.default,{min:0,max:100,value:h,onChange:f,tooltip:{formatter:e=>`${e}%`}})]})]})]})});var tc=r("9f0970b1"),td=l._(tc),tu=r("6caefff4"),th=l._(tu),tf=r("1353d6cc"),tx=l._(tf),tg={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"}}]},name:"info-circle",theme:"outlined"},tm=I.forwardRef(function(e,t){return I.createElement(eN.default,(0,eT.default)((0,eT.default)({},e),{},{ref:t,icon:tg}));}),tp=r("07d5c3d6"),ty=l._(tp),tv=r("f6ee8121"),tw=l._(tv),tj=I.forwardRef(function(e,t){return I.createElement(eN.default,(0,eT.default)((0,eT.default)({},e),{},{ref:t,icon:tw.default}));}),tb=r("47ffc2fb");let tC=({open:e,onCancel:t,onExportImage:r,onExportSvg:l,canvasRef:a,processing:i,svgContent:o,scale:s,setScale:c,ltres:d,setLtres:u,qtres:h,setQtres:x,pathomit:g,setPathomit:m,colorsampling:y,setColorsampling:w,strokewidth:j,setStrokewidth:b,onDownload:C,getSvgModalWidth:S,getSvgModalHeight:k})=>{let[M,z]=(0,I.useState)("image"),[R,E]=(0,I.useState)("png"),[L,B]=(0,I.useState)(!0),T=o?btoa(unescape(encodeURIComponent(o))):"",A=o?`data:image/svg+xml;base64,${T}`:"";return(0,n.jsx)(D.default,{title:"Export Options",open:e,onCancel:t,onOk:()=>{"image"===M?(r(R,L),t()):l();},okText:"image"===M?"Export":"Convert to SVG",okButtonProps:{loading:i&&"svg"===M},width:"svg"===M&&o?S():500,style:"svg"===M&&o?{height:k()}:void 0,children:(0,n.jsxs)(p.default,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{marginBottom:12,fontWeight:500},children:"Export Format"}),(0,n.jsxs)(to.default.Group,{value:M,onChange:e=>z(e.target.value),buttonStyle:"solid",children:[(0,n.jsx)(to.default.Button,{value:"image",children:"Image (PNG/JPG)"}),(0,n.jsx)(to.default.Button,{value:"svg",children:"SVG"})]})]}),(0,n.jsx)(tx.default,{style:{margin:"8px 0"}}),"image"===M&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{marginBottom:12,fontWeight:500},children:"Image Options"}),(0,n.jsxs)(p.default,{direction:"vertical",style:{width:"100%"},children:[(0,n.jsxs)(to.default.Group,{value:R,onChange:e=>E(e.target.value),buttonStyle:"solid",children:[(0,n.jsx)(to.default.Button,{value:"png",children:"PNG"}),(0,n.jsx)(to.default.Button,{value:"jpg",children:"JPG"})]}),(0,n.jsx)(td.default,{checked:L,onChange:e=>B(e.target.checked),children:"Include overlay layers"}),(0,n.jsx)("div",{style:{fontSize:12,color:"#666",marginLeft:24,marginTop:-8},children:L?"Export will include all visible layers and text overlays":"Export will only include the base image without layers"})]})]}),"svg"===M&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{marginBottom:12,fontWeight:500},children:"SVG Tracing Options"}),(0,n.jsxs)(p.default,{wrap:!0,size:"small",children:[(0,n.jsx)(eM.default,{title:"Scale factor for the SVG output. Higher = larger SVG.",children:(0,n.jsxs)(p.default,{size:4,children:[(0,n.jsx)("label",{children:"Scale"}),(0,n.jsx)(tm,{style:{fontSize:12,color:"#999"}}),(0,n.jsx)(e3.default,{size:"small",min:.1,step:.1,value:s,onChange:e=>c(e||1),style:{width:70}})]})}),(0,n.jsx)(eM.default,{title:"Error threshold for line detection. Lower = more precise lines.",children:(0,n.jsxs)(p.default,{size:4,children:[(0,n.jsx)("label",{children:"ltres"}),(0,n.jsx)(tm,{style:{fontSize:12,color:"#999"}}),(0,n.jsx)(e3.default,{size:"small",min:0,value:d,onChange:e=>u(e||1),style:{width:70}})]})}),(0,n.jsx)(eM.default,{title:"Error threshold for curve detection. Lower = more precise curves.",children:(0,n.jsxs)(p.default,{size:4,children:[(0,n.jsx)("label",{children:"qtres"}),(0,n.jsx)(tm,{style:{fontSize:12,color:"#999"}}),(0,n.jsx)(e3.default,{size:"small",min:0,value:h,onChange:e=>x(e||1),style:{width:70}})]})}),(0,n.jsx)(eM.default,{title:"Minimum path length to keep. Higher = simpler SVG with fewer tiny paths.",children:(0,n.jsxs)(p.default,{size:4,children:[(0,n.jsx)("label",{children:"Pathomit"}),(0,n.jsx)(tm,{style:{fontSize:12,color:"#999"}}),(0,n.jsx)(e3.default,{size:"small",min:0,value:g,onChange:e=>m(e||0),style:{width:70}})]})}),(0,n.jsx)(eM.default,{title:"Pixel sampling interval for colors. 1 = every pixel, higher = faster but less accurate colors.",children:(0,n.jsxs)(p.default,{size:4,children:[(0,n.jsx)("label",{children:"ColorSampling"}),(0,n.jsx)(tm,{style:{fontSize:12,color:"#999"}}),(0,n.jsx)(e3.default,{size:"small",min:1,value:y,onChange:e=>w(e||1),style:{width:70}})]})}),(0,n.jsx)(eM.default,{title:"Stroke width in the output SVG.",children:(0,n.jsxs)(p.default,{size:4,children:[(0,n.jsx)("label",{children:"StrokeWidth"}),(0,n.jsx)(tm,{style:{fontSize:12,color:"#999"}}),(0,n.jsx)(e3.default,{size:"small",min:0,value:j,onChange:e=>b(e||1),style:{width:70}})]})})]}),o&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(tx.default,{style:{margin:"16px 0"}}),(0,n.jsx)("div",{style:{marginBottom:12,fontWeight:500},children:"SVG Results"}),(0,n.jsxs)(v.default,{defaultActiveKey:"svg",type:"card",size:"small",children:[(0,n.jsxs)(v.default.TabPane,{tab:"Preview",children:[(0,n.jsxs)(p.default,{style:{marginBottom:8},children:[(0,n.jsx)(f.default,{size:"small",onClick:()=>C(o,"image.svg"),icon:(0,n.jsx)(ty.default,{}),children:"Download"}),(0,n.jsx)(f.default,{size:"small",onClick:()=>(0,tb.handleCopy)(o,"SVG copied!"),icon:(0,n.jsx)(eK.default,{}),children:"Copy"})]}),(0,n.jsx)("div",{style:{border:"1px solid #eee",borderRadius:6,padding:12,overflow:"auto",maxHeight:a.current?a.current.height:400},children:(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:o}})})]},"svg"),(0,n.jsxs)(v.default.TabPane,{tab:"Base64",children:[(0,n.jsxs)(p.default,{style:{marginBottom:8},children:[(0,n.jsx)(f.default,{size:"small",onClick:()=>(0,tb.handleCopy)(T,"Base64 copied!"),icon:(0,n.jsx)(eK.default,{}),children:"Copy"}),(0,n.jsx)(f.default,{size:"small",onClick:()=>C(T,"image-base64.txt"),icon:(0,n.jsx)(ty.default,{}),children:"Download"})]}),(0,n.jsx)("pre",{style:{background:"#f7f7f7",padding:12,borderRadius:6,whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:300,overflow:"auto",fontSize:12},children:T})]},"base64"),(0,n.jsxs)(v.default.TabPane,{tab:"Data URI",children:[(0,n.jsxs)(p.default,{style:{marginBottom:8},children:[(0,n.jsx)(f.default,{size:"small",onClick:()=>(0,tb.handleCopy)(A,"Data URI copied!"),icon:(0,n.jsx)(eK.default,{}),children:"Copy"}),(0,n.jsx)(f.default,{size:"small",onClick:()=>C(A,"image-datauri.txt"),icon:(0,n.jsx)(ty.default,{}),children:"Download"})]}),(0,n.jsx)("pre",{style:{background:"#f7f7f7",padding:12,borderRadius:6,whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:300,overflow:"auto",fontSize:12},children:A})]},"datauri")]})]}),i&&(0,n.jsx)("div",{style:{textAlign:"center",padding:24},children:(0,n.jsx)(th.default,{indicator:(0,n.jsx)(tj,{style:{fontSize:32},spin:!0}),tip:"Converting to SVG..."})})]})]})});},{Panel:tS}=eR.default,tk=({canvasRef:e,baseCanvas:t,history:r,setTool:l,brightness:a,setBrightness:i,contrast:o,setContrast:s,blur:c,setBlur:d,gaussian:u,setGaussian:h,sharpen:x,setSharpen:g,bgThreshold:m,setBgThreshold:y,bgThresholdBlack:v,setBgThresholdBlack:w,setShowPerspectiveModal:j,dpiMeasured:b,setDpiMeasured:C,exportImage:S,onExport:k,overlayRef:M,texture:R,setTexture:E,clarity:D,setClarity:L,highlights:B,setHighlights:T,shadows:A,setShadows:P,whites:H,setWhites:N,blacks:U,setBlacks:_,vibrance:$,setVibrance:W,saturation:F,setSaturation:X,dehaze:K,setDehaze:q,hslAdjustments:J,setHslAdjustments:Z,upscaleImage:Q})=>{let[ee,et]=(0,I.useState)("red"),[er,el]=(0,I.useState)(!1),[ea,en]=(0,I.useState)(!1),[ei,eo]=(0,I.useState)(2),[es,ec]=(0,I.useState)("medium"),[ed,eu]=(0,I.useState)(0),[eh,ef]=(0,I.useState)(0),[ex,eg]=(0,I.useState)(0),[em,ep]=(0,I.useState)(null),[ey,ev]=(0,I.useState)(!1),[ew,eS]=(0,I.useState)(1),[ek,ez]=(0,I.useState)(1),[eI,eD]=(0,I.useState)(1),[eB,eT]=(0,I.useState)(8),[eA,eP]=(0,I.useState)(2),[eH,eN]=(0,I.useState)(1),[e_,eW]=(0,I.useState)({red:[],green:[],blue:[]});(0,I.useEffect)(()=>{e.current&&eW(eb(e.current));},[e.current]);let eO=[{name:"red",color:"#ff4d4d"},{name:"orange",color:"#ffa500"},{name:"yellow",color:"#ffd700"},{name:"green",color:"#00c853"},{name:"aqua",color:"#00e5ff"},{name:"blue",color:"#2979ff"},{name:"purple",color:"#9c27b0"},{name:"magenta",color:"#ff00aa"}],eV=(e,t)=>{var r,l,a;let n=(null===(r=eO.find(t=>t.name===e))||void 0===r?void 0:r.color)||"#ffffff",i=eO.findIndex(t=>t.name===e);if(-1===i)return"#555";let o=eO[i].color,s=(null===(l=eO[i-1])||void 0===l?void 0:l.color)||o,c=(null===(a=eO[i+1])||void 0===a?void 0:a.color)||o;switch(t){case"h":return`linear-gradient(90deg, ${s}, ${o}, ${c})`;case"s":return`linear-gradient(90deg, gray, ${n})`;case"l":return`linear-gradient(90deg, black, ${n}, white)`;default:return"#555";}},eY=[{key:"texture",label:"Texture",value:R,setter:E},{key:"clarity",label:"Clarity",value:D,setter:L},{key:"highlights",label:"Highlights",value:B,setter:T},{key:"shadows",label:"Shadows",value:A,setter:P},{key:"whites",label:"Whites",value:H,setter:N},{key:"blacks",label:"Blacks",value:U,setter:_}],eq=[{key:"blur",label:"Box Blur",min:0,max:25,value:c,setter:d},{key:"gaussian",label:"Gaussian",min:0,max:20,value:u,setter:h},{key:"sharpen",label:"Sharpen",min:0,max:5,value:x,setter:g},{key:"bgThreshold",label:"Remove White",min:0,max:255,value:m,setter:y},{key:"bgThresholdBlack",label:"Remove Black",min:0,max:255,value:v,setter:w}],eZ=()=>ej(e,t,{blur:c,gaussian:u,sharpen:x,texture:R,clarity:D,bgThreshold:m,bgThresholdBlack:v,brightness:a,contrast:o,highlights:B,shadows:A,whites:H,blacks:U,vibrance:$,saturation:F,dehaze:K,hslAdjustments:J},r,eW);return(0,n.jsxs)("div",{style:{width:260},children:[(0,n.jsxs)(eR.default,{defaultActiveKey:["histogram","basic","lights","effects"],ghost:!0,expandIconPosition:"end",children:[(0,n.jsx)(tS,{header:"Histogram",children:(0,n.jsx)(tn,{canvasRef:e,redData:e_.red,greenData:e_.green,blueData:e_.blue})},"histogram"),(0,n.jsx)(tS,{header:"\u{1F6E0} Basic",children:(0,n.jsxs)(p.default,{wrap:!0,children:[(0,n.jsx)(eM.default,{title:"Undo (Ctrl+Z)",children:(0,n.jsx)(f.default,{icon:(0,n.jsx)(eE.default,{}),onClick:r.undo})}),(0,n.jsx)(eM.default,{title:"Redo (Ctrl+Shift+Z)",children:(0,n.jsx)(f.default,{icon:(0,n.jsx)(eL.default,{}),onClick:r.redo})}),(0,n.jsx)(eM.default,{title:"Rotate left",children:(0,n.jsx)(f.default,{icon:(0,n.jsx)(eU,{}),onClick:()=>O(-90,e,M,r)})}),(0,n.jsx)(eM.default,{title:"Rotate right (R)",children:(0,n.jsx)(f.default,{icon:(0,n.jsx)(e$.default,{}),onClick:()=>O(90,e,M,r)})}),(0,n.jsx)(eM.default,{title:"Flip horizontal",children:(0,n.jsx)(f.default,{icon:(0,n.jsx)(eF.default,{}),onClick:()=>G(e,r)})}),(0,n.jsx)(eM.default,{title:"Flip vertical",children:(0,n.jsx)(f.default,{icon:(0,n.jsx)(eF.default,{rotate:90}),onClick:()=>V(e,r)})}),(0,n.jsx)(eM.default,{title:"Crop (C)",children:(0,n.jsx)(f.default,{icon:(0,n.jsx)(eG,{}),onClick:()=>l("crop")})}),(0,n.jsx)(eM.default,{title:"Perspective",children:(0,n.jsx)(f.default,{icon:(0,n.jsx)(e4,{}),onClick:()=>{j(!0),l("perspective");}})}),(0,n.jsx)(eM.default,{title:"Brush (B)",children:(0,n.jsx)(f.default,{icon:(0,n.jsx)(eJ.default,{}),onClick:()=>l("draw")})}),(0,n.jsx)(eM.default,{title:"Text (T)",children:(0,n.jsx)(f.default,{icon:(0,n.jsx)(e1.default,{}),onClick:()=>l("text")})}),(0,n.jsx)(eM.default,{title:"Layer (V)",children:(0,n.jsx)(f.default,{icon:(0,n.jsx)(eQ.default,{}),onClick:()=>l("layer")})}),(0,n.jsx)(eM.default,{title:"Invert Colors (Ctrl+I)",children:(0,n.jsx)(f.default,{onClick:()=>eC(e,r),children:"Invert"})})]})},"basic"),(0,n.jsxs)(tS,{header:"\u{1F506} Light",children:[(0,n.jsx)(te,{label:"Brightness",value:a,min:-150,max:150,onChange:i,onChangeComplete:eZ},"brightness"),(0,n.jsx)(te,{label:"Contrast",value:o,min:-100,max:100,onChange:s,onChangeComplete:eZ},"contrast")]},"lights"),(0,n.jsxs)(tS,{header:"\u{1F3A8} Color",children:[(0,n.jsx)(te,{label:"Vibrance",value:$,min:-100,max:100,onChange:W,onChangeComplete:eZ},"vibrance"),(0,n.jsx)(te,{label:"Saturation",value:F,min:-100,max:100,onChange:X,onChangeComplete:eZ},"saturation"),(0,n.jsx)(te,{label:"Dehaze",value:K,min:-100,max:100,onChange:q,onChangeComplete:eZ},"dehaze"),(0,n.jsx)("div",{style:{marginTop:10},children:"HSL Mixer"}),(0,n.jsx)("div",{style:{display:"flex",gap:8,marginBottom:10},children:eO.map(({name:e,color:t})=>(0,n.jsx)(eM.default,{title:e.toUpperCase(),children:(0,n.jsx)("div",{onClick:()=>et(e),style:{width:20,height:20,borderRadius:"50%",background:t,border:ee===e?"2px solid white":"1px solid #555",boxShadow:ee===e?"0 0 6px rgba(255,255,255,0.8)":"",cursor:"pointer"}},e)}))}),["Hue","Saturation","Luminance"].map(e=>{var t;let r=e[0].toLowerCase();return(0,n.jsx)(te,{label:e,value:(null===(t=J[ee])||void 0===t?void 0:t[r])??0,min:"Hue"===e?-180:-100,max:"Hue"===e?180:100,onChange:e=>Z(ee,{[r]:e}),onChangeComplete:eZ,gradient:eV(ee,r)},e);}),(0,n.jsx)(f.default,{size:"small",onClick:()=>Z(ee,{h:0,s:0,l:0}),children:"Reset"})]},"color"),(0,n.jsx)(tS,{header:"\u2728 Effects",children:eY.map(({key:e,label:t,value:r,setter:l})=>(0,n.jsx)(te,{label:t,value:r,min:-100,max:100,onChange:l,onChangeComplete:eZ},e))},"effects"),(0,n.jsx)(tS,{header:"\u{1F3AD} Filters",children:eq.map(({key:e,label:t,min:r,max:l,value:a,setter:i})=>(0,n.jsx)(te,{label:t,value:a,min:r,max:l,onChange:i,onChangeComplete:eZ},e))},"filters"),(0,n.jsxs)(tS,{header:"\u{1F4D0} Crop & Ruler",children:[(0,n.jsxs)(p.default,{children:[(0,n.jsx)(f.default,{icon:(0,n.jsx)(eG,{}),onClick:()=>l("crop"),children:"Crop"}),(0,n.jsx)(f.default,{onClick:()=>{j(!0),l("perspective");},children:"Perspective"})]}),(0,n.jsx)("div",{style:{marginTop:10},children:"Ruler"}),(0,n.jsxs)(p.default,{children:[(0,n.jsx)(f.default,{onClick:()=>l("ruler"),children:"\u{1F4CF} Ruler"}),(0,n.jsx)(f.default,{onClick:()=>{null==C||C(null),z.default.info("Ruler cleared");},children:"Clear"})]}),b&&(0,n.jsxs)("div",{children:["Estimated DPI: ",b]})]},"crop"),(0,n.jsx)(tS,{header:"\u{1F53C} Upscale Options",children:(0,n.jsx)(f.default,{onClick:()=>{el(!0);},children:"Custom Upscale..."})},"upscaleOptions"),(0,n.jsx)(tS,{header:"\u{1F4E4} Export",children:(0,n.jsxs)(p.default,{direction:"vertical",style:{width:"100%"},children:[(0,n.jsx)(f.default,{icon:(0,n.jsx)(eX,{}),onClick:()=>{en(!0);},type:"primary",block:!0,children:"Export Image / SVG"}),(0,n.jsx)(f.default,{icon:(0,n.jsx)(eK.default,{}),onClick:()=>Y(e),block:!0,children:"Copy to Clipboard"})]})},"export")]}),(0,n.jsx)(ts,{open:er,onCancel:()=>el(!1),onOk:()=>{l("upscale"),null==Q||Q(ei,es,{sharpen:ed,edgeEnhancement:eh,denoise:ex}),el(!1);},upscaleFactor:ei,setUpscaleFactor:eo,presetLocal:es,setPresetLocal:ec,sharpenAmount:ed,setSharpenAmount:eu,edgeEnhancement:eh,setEdgeEnhancement:ef,denoiseAmount:ex,setDenoiseAmount:eg}),(0,n.jsx)(tC,{open:ea,onCancel:()=>{en(!1),ep(null);},onExportImage:(t,r)=>{S("jpg"===t,e,k,r);},onExportSvg:()=>{if(!e.current){z.default.error("No image to convert");return;}ev(!0);let t=e.current.toDataURL();try{e6.default.imageToSVG(t,e=>{ep(e),ev(!1),z.default.success("Image converted to SVG successfully!");},{scale:ew,ltres:ek,qtres:eI,pathomit:eB,colorsampling:eA,strokewidth:eH});}catch(e){console.error(e),ev(!1),z.default.error("Error converting image to SVG.");}},canvasRef:e,processing:ey,svgContent:em,scale:ew,setScale:eS,ltres:ek,setLtres:ez,qtres:eI,setQtres:eD,pathomit:eB,setPathomit:eT,colorsampling:eA,setColorsampling:eP,strokewidth:eH,setStrokewidth:eN,onDownload:(e,t)=>{let r=new Blob([e],{type:"image/svg+xml"}),l=document.createElement("a");l.href=URL.createObjectURL(r),l.download=t,l.click();},getSvgModalWidth:()=>e.current?Math.min(Math.max(e.current.width+100,500),.9*window.innerWidth):700,getSvgModalHeight:()=>{if(e.current)return Math.min(e.current.height+300,.85*window.innerHeight);}})]});};var tM=r("3eb6f542"),tz=l._(tM),tR=r("97125d22"),tI=l._(tR),tE=r("452a6b49"),tD=l._(tE),tL=r("54c1db7a"),tB=l._(tL),tT={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M482.2 508.4L331.3 389c-3-2.4-7.3-.2-7.3 3.6V478H184V184h204v128c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V144c0-15.5-12.5-28-28-28H144c-15.5 0-28 12.5-28 28v736c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v128H184V546h140v85.4c0 3.8 4.4 6 7.3 3.6l150.9-119.4a4.5 4.5 0 000-7.2zM880 116H596c-15.5 0-28 12.5-28 28v168c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V184h204v294H700v-85.4c0-3.8-4.3-6-7.3-3.6l-151 119.4a4.52 4.52 0 000 7.1l151 119.5c2.9 2.3 7.3.2 7.3-3.6V546h140v294H636V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v168c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V144c0-15.5-12.5-28-28-28z"}}]},name:"merge-cells",theme:"outlined"},tA=I.forwardRef(function(e,t){return I.createElement(eN.default,(0,eT.default)((0,eT.default)({},e),{},{ref:t,icon:tT}));}),tP=r("e9a76e87"),tH=l._(tP),tN=I.forwardRef(function(e,t){return I.createElement(eN.default,(0,eT.default)((0,eT.default)({},e),{},{ref:t,icon:tH.default}));}),tU=r("a0108fc4"),t_=l._(tU),t$=I.forwardRef(function(e,t){return I.createElement(eN.default,(0,eT.default)((0,eT.default)({},e),{},{ref:t,icon:t_.default}));}),tW=r("84cd549f"),tF=l._(tW),tO={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M798 160H366c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h181.2l-156 544H229c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h432c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8H474.4l156-544H798c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"italic",theme:"outlined"},tG=I.forwardRef(function(e,t){return I.createElement(eN.default,(0,eT.default)((0,eT.default)({},e),{},{ref:t,icon:tO}));}),tV={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M120 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm0 424h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm784 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"align-left",theme:"outlined"},tX=I.forwardRef(function(e,t){return I.createElement(eN.default,(0,eT.default)((0,eT.default)({},e),{},{ref:t,icon:tV}));}),tY={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M264 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H264c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm496 424c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H264c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496zm144 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"align-center",theme:"outlined"},tK=I.forwardRef(function(e,t){return I.createElement(eN.default,(0,eT.default)((0,eT.default)({},e),{},{ref:t,icon:tY}));}),tq={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 158H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 424H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 212H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"align-right",theme:"outlined"},tJ=I.forwardRef(function(e,t){return I.createElement(eN.default,(0,eT.default)((0,eT.default)({},e),{},{ref:t,icon:tq}));});let{Option:tZ}=tz.default,tQ=({history:e,setZoom:t,tool:r,setTool:l,brushType:a,setBrushType:i,drawColor:o,setDrawColor:s,drawLineWidth:c,setDrawLineWidth:d,brushOpacity:u,setBrushOpacity:h,brushFlow:x,setBrushFlow:g,layers:m,activeLayerId:y,setLayerOpacity:v,setLayerBlend:w,moveLayerUp:j,moveLayerDown:b,deleteLayer:C,selectLayer:S,mergeLayer:k,textContent:M,setTextContent:z,textFont:R,setTextFont:E,textFontSize:D,setTextFontSize:L,textColor:B,setTextColor:T,textWeight:A,setTextWeight:P,textItalic:H,setTextItalic:N,textDecoration:U,setTextDecoration:_,textAlign:$,setTextAlign:W,onAddTextLayer:F,isAddingText:O,setIsAddingText:G})=>{let V=(0,I.useRef)(!1),X=(0,I.useRef)(null),Y=(0,I.useRef)(u),K=(0,I.useRef)(!1),q=(0,I.useRef)(null),J=(0,I.useRef)(x),Z=e=>{if(0!==e.button)return;e.preventDefault(),V.current=!0,X.current=e.clientX;let t=document.body.style.userSelect;document.body.style.userSelect="none";let l=e=>{let t=Number(e.toFixed(2));if("draw"===r){h(t);return;}if("layer"===r&&m){let e=m.find(e=>e.id===y);e&&v&&v(e.id,t);}};Y.current=(()=>{if("draw"===r)return u;if("layer"===r&&m){let e=m.find(e=>e.id===y);return(null==e?void 0:e.opacity)??u;}return u;})();let a=e=>{if(!V.current||null===X.current)return;let t=e.clientX-X.current;l(Math.min(1,Math.max(0,Y.current+.005*t)));},n=()=>{V.current=!1,X.current=null,document.body.style.userSelect=t,window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",n);};window.addEventListener("mousemove",a),window.addEventListener("mouseup",n);};return(0,n.jsx)("div",{style:{marginBottom:8},children:(0,n.jsxs)(p.default,{children:[(0,n.jsx)(tz.default,{style:{width:150},placeholder:"History",value:e.index,onChange:t=>e.applyHistory(t),optionLabelProp:"label",children:e.history.map((e,t)=>(0,n.jsx)(tz.default.Option,{value:t,label:e.label||`Step ${t+1}`,children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)("img",{src:e.url,alt:"",style:{width:40,height:30,objectFit:"contain",border:"1px solid #ddd"}}),(0,n.jsx)("span",{children:e.label||`Step ${t+1}`})]})},t))}),(0,n.jsx)(eM.default,{title:"Zoom In",children:(0,n.jsx)(f.default,{icon:(0,n.jsx)(tD.default,{}),onClick:()=>t(e=>Math.min(1.2*e,8))})}),(0,n.jsx)(eM.default,{title:"Zoom Out",children:(0,n.jsx)(f.default,{icon:(0,n.jsx)(tB.default,{}),onClick:()=>t(e=>Math.max(e/1.2,.1))})}),(0,n.jsxs)(tz.default,{value:r,onChange:e=>l(e),style:{width:140},children:[(0,n.jsx)(tZ,{value:"pan",children:"Pan"}),(0,n.jsx)(tZ,{value:"move",children:"Move"}),(0,n.jsx)(tZ,{value:"color",children:"Color Picker"}),(0,n.jsx)(tZ,{value:"crop",children:"Crop"}),(0,n.jsx)(tZ,{value:"ruler",children:"Ruler"}),(0,n.jsx)(tZ,{value:"perspective",children:"Perspective"}),(0,n.jsx)(tZ,{value:"draw",children:"Brush"}),(0,n.jsx)(tZ,{value:"text",children:"Text"})]}),(0,n.jsxs)(p.default,{style:{width:"100%"},wrap:!0,children:["color"===r?(0,n.jsx)(tI.default,{value:o,onChange:e=>s(e.toHexString())}):null,"draw"===r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(tz.default,{value:a,onChange:e=>i(e),style:{width:80},children:[(0,n.jsx)(tZ,{value:"hard",children:"Hard"}),(0,n.jsx)(tZ,{value:"soft",children:"Soft"})]}),(0,n.jsx)(tI.default,{value:o,onChange:e=>s(e.toHexString())}),(0,n.jsx)(e3.default,{style:{width:100},min:1,max:500,value:c,onChange:e=>d(e||1),addonAfter:"px"}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)("span",{onMouseDown:Z,style:{cursor:"ew-resize",userSelect:"none"},title:"Drag left/right to change opacity",children:"Opacity:"}),(0,n.jsx)(e3.default,{min:0,max:1,step:.01,style:{width:60},value:u,onChange:e=>h(e||0)})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)("span",{onMouseDown:e=>{if(0!==e.button)return;e.preventDefault(),K.current=!0,q.current=e.clientX,J.current=x;let t=document.body.style.userSelect;document.body.style.userSelect="none";let r=e=>{if(!K.current||null===q.current)return;let t=e.clientX-q.current,r=J.current+.005*t;g(Number((r=Math.max(0,Math.min(1,r))).toFixed(2)));},l=()=>{K.current=!1,q.current=null,J.current=x,document.body.style.userSelect=t,window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",l);};window.addEventListener("mousemove",r),window.addEventListener("mouseup",l);},style:{cursor:"ew-resize",userSelect:"none"},title:"Drag left/right to change flow",children:"Flow:"}),(0,n.jsx)(e3.default,{min:0,max:1,step:.01,style:{width:60},value:x,onChange:e=>g(e||0)})]})]}):null,"text"===r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(tz.default,{value:R||"Arial",onChange:e=>E&&E(e),style:{width:100},children:[(0,n.jsx)(tZ,{value:"Arial",children:"Arial"}),(0,n.jsx)(tZ,{value:"Helvetica",children:"Helvetica"}),(0,n.jsx)(tZ,{value:"Times New Roman",children:"Times New Roman"}),(0,n.jsx)(tZ,{value:"Courier New",children:"Courier New"}),(0,n.jsx)(tZ,{value:"Georgia",children:"Georgia"}),(0,n.jsx)(tZ,{value:"Verdana",children:"Verdana"})]}),(0,n.jsx)(e3.default,{min:8,max:200,value:D||32,onChange:e=>L&&L(e||32),addonAfter:"px",style:{width:90}}),(0,n.jsx)(tI.default,{value:B||"#000000",onChange:e=>T&&T(e.toHexString())}),(0,n.jsxs)(tz.default,{value:A||"normal",onChange:e=>P&&P(e),style:{width:80},children:[(0,n.jsx)(tZ,{value:"lighter",children:"Lighter"}),(0,n.jsx)(tZ,{value:"normal",children:"Normal"}),(0,n.jsx)(tZ,{value:"bold",children:"Bold"}),(0,n.jsx)(tZ,{value:"900",children:"900"})]}),(0,n.jsx)(eM.default,{title:"Italic",children:(0,n.jsx)(f.default,{size:"small",icon:(0,n.jsx)(tG,{}),type:H?"primary":"default",onClick:()=>N&&N(!H)})}),(0,n.jsxs)(tz.default,{value:U||"none",onChange:e=>_&&_(e),style:{width:100},children:[(0,n.jsx)(tZ,{value:"none",children:"No decoration"}),(0,n.jsx)(tZ,{value:"underline",children:"Underline"}),(0,n.jsx)(tZ,{value:"line-through",children:"Strike"})]}),(0,n.jsx)(eM.default,{title:"Align",children:(0,n.jsxs)(p.default,{size:"small",children:[(0,n.jsx)(f.default,{size:"small",icon:(0,n.jsx)(tX,{}),type:"left"===$?"primary":"default",onClick:()=>W&&W("left")}),(0,n.jsx)(f.default,{size:"small",icon:(0,n.jsx)(tK,{}),type:"center"===$?"primary":"default",onClick:()=>W&&W("center")}),(0,n.jsx)(f.default,{size:"small",icon:(0,n.jsx)(tJ,{}),type:"right"===$?"primary":"default",onClick:()=>W&&W("right")})]})})]}):null,"layer"===r?(0,n.jsx)(n.Fragment,{children:m&&m.length>0&&(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)("span",{style:{fontSize:12,fontWeight:600},children:"Layers"}),(0,n.jsx)(tz.default,{value:y||void 0,placeholder:"Select layer",onChange:e=>S&&S(e),style:{width:180},showSearch:!0,children:m.slice().reverse().map(e=>{var t;return(0,n.jsx)(tZ,{value:e.id,label:`Layer ${e.id}`,children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.img&&(0,n.jsx)("img",{src:null===(t=e.img)||void 0===t?void 0:t.src,alt:"",style:{width:40,height:28,objectFit:"cover"}}),e.text&&(0,n.jsx)(e1.default,{}),(0,n.jsx)("span",{style:{fontSize:12},children:e.id})]})},e.id);})})]}),(0,n.jsx)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:(0,n.jsx)(f.default,{size:"small",icon:(0,n.jsx)(tA,{}),onClick:()=>k&&k(),children:"Merge All"})}),y&&(()=>{let e=m.find(e=>e.id===y);return e?(0,n.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,n.jsx)(f.default,{size:"small",icon:(0,n.jsx)(tA,{}),onClick:()=>k&&k(e.id),children:"Merge"}),(0,n.jsx)(f.default,{size:"small",icon:(0,n.jsx)(tN,{}),onClick:()=>j&&j(e.id)}),(0,n.jsx)(f.default,{size:"small",icon:(0,n.jsx)(t$,{}),onClick:()=>b&&b(e.id)}),(0,n.jsx)(f.default,{size:"small",danger:!0,icon:(0,n.jsx)(tF.default,{}),onClick:()=>C&&C(e.id)}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginLeft:8},children:[(0,n.jsx)("span",{onMouseDown:Z,style:{cursor:"ew-resize",userSelect:"none"},title:"Drag left/right to change opacity",children:"Opacity:"}),(0,n.jsx)(e3.default,{min:0,max:1,step:.01,style:{width:80},value:Number(e.opacity.toFixed(2)),onChange:t=>v&&v(e.id,Number(t||0))})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)("span",{style:{userSelect:"none"},children:"Blend:"}),(0,n.jsxs)(tz.default,{value:e.blend||"source-over",onChange:t=>w&&w(e.id,t),style:{width:140},children:[(0,n.jsx)(tZ,{value:"source-over",children:"Normal"}),(0,n.jsx)(tZ,{value:"multiply",children:"Multiply"}),(0,n.jsx)(tZ,{value:"screen",children:"Screen"}),(0,n.jsx)(tZ,{value:"overlay",children:"Overlay"}),(0,n.jsx)(tZ,{value:"lighter",children:"Lighten"}),(0,n.jsx)(tZ,{value:"darken",children:"Darken"})]})]})]}):null;})()]})}):null]})]})});},t0=({imageUrl:e,addOnFile:t,setAddOnFile:r,onExport:l})=>{let a=(0,I.useRef)(null),{canvasRef:i,overlayRef:o,baseCanvas:s,setBaseCanvas:c,syncCanvasSize:d}=function(e,t){let r=(0,I.useRef)(null),l=(0,I.useRef)(null),[a,n]=(0,I.useState)(null);(0,I.useEffect)(()=>{(async()=>{try{let l=await new Promise((t,r)=>{let l=new Image;l.crossOrigin="anonymous",l.onload=()=>{let e=L(l.naturalWidth,l.naturalHeight);e.getContext("2d").drawImage(l,0,0),t(e);},l.onerror=r,l.src=e;});n(l);let a=L(l.width,l.height);if(a.getContext("2d").drawImage(l,0,0),r.current){r.current.width=a.width,r.current.height=a.height;let e=r.current.getContext("2d");e.clearRect(0,0,a.width,a.height),e.drawImage(a,0,0);}t&&t(i(a));}catch(e){console.error("Failed to load image",e),z.default.error("Failed to load image");}})();},[e]),(0,I.useEffect)(()=>{o();},[a]);let i=e=>e.toDataURL("image/png"),o=()=>{if(!r.current||!a)return;r.current.width=a.width,r.current.height=a.height,l.current.width=a.width,l.current.height=a.height;let e=r.current.getContext("2d");e.clearRect(0,0,r.current.width,r.current.height),e.drawImage(a,0,0);};return{canvasRef:r,overlayRef:l,baseCanvas:a,setBaseCanvas:n,syncCanvasSize:o};}(e,e=>u.push(e,"Initial load")),u=function(e,t){let[r,l]=(0,I.useState)([]),[a,n]=(0,I.useState)(-1),i=r[a],o=l=>{let a=r[l];if(!a)return;let i=new Image;i.onload=()=>{let r=e.current.getContext("2d");e.current.width=i.naturalWidth,e.current.height=i.naturalHeight,t.current.width=i.naturalWidth,t.current.height=i.naturalHeight,r.clearRect(0,0,e.current.width,e.current.height),r.drawImage(i,0,0),n(l);},i.src=a.url;};return{history:r,index:a,current:i,push:(e,t="",i=!0)=>{let o=r.slice(0,a+1);o.push({url:e,label:t,isSetBase:i}),l(o),n(o.length-1);},undo:()=>{a<=0||o(a-1);},redo:()=>{a>=r.length-1||o(a+1);},applyHistory:o};}(i,o),[h,f]=(0,I.useState)(1),[x,g]=(0,I.useState)({x:0,y:0}),[m,p]=(0,I.useState)(!1),y=(0,I.useRef)(null),[v,w]=(0,I.useState)("pan"),[j,b]=(0,I.useState)(0),[C,S]=(0,I.useState)(0),[k,M]=(0,I.useState)(0),[R,E]=(0,I.useState)(0),[B,T]=(0,I.useState)(0),[A,P]=(0,I.useState)(0),[H,N]=(0,I.useState)(0),[U,_]=(0,I.useState)(0),[$,W]=(0,I.useState)(0),[F,G]=(0,I.useState)(null),V=(0,I.useRef)(null),[Y,ep]=(0,I.useState)(!1),ev=(0,I.useRef)(null),ew=()=>{ev.current||(ev.current=[NaN,NaN,NaN,NaN,NaN,NaN,NaN,NaN]);},ej=(e,t,r=12)=>{if(!ev.current)return -1;let l=ev.current;for(let a=0;a<8;a+=2){let n=l[a],i=l[a+1];if(!isNaN(n)&&!isNaN(i)){let l=n-e,o=i-t;if(Math.sqrt(l*l+o*o)<=r)return a;}}return -1;},[eb,ek]=(0,I.useState)(null),[eM,ez]=(0,I.useState)(!1),[eR,eI]=(0,I.useState)(!1),[eE,eD]=(0,I.useState)(!1),[eL,eB]=(0,I.useState)(null),[eT,eA]=(0,I.useState)(null),eP=(0,I.useRef)(null),[eH,eN]=(0,I.useState)(null),[eU,e_]=(0,I.useState)([]),[e$,eW]=(0,I.useState)(null),[eF,eO]=(0,I.useState)(!1),[eG,eV]=(0,I.useState)(""),[eX,eY]=(0,I.useState)("Arial"),[eK,eq]=(0,I.useState)(32),[eJ,eZ]=(0,I.useState)("#000000"),[eQ,e0]=(0,I.useState)("normal"),[e1,e8]=(0,I.useState)(!1),[e4,e2]=(0,I.useState)("none"),[e6,e5]=(0,I.useState)("left"),[e3,e9]=(0,I.useState)(!1),e7=(0,I.useRef)(null),te=(0,I.useRef)(null),tt=(0,I.useRef)(null),tr=(0,I.useRef)(null);(0,I.useEffect)(()=>{t&&(tl(t),r(null));},[t]),(0,I.useEffect)(()=>{s&&(e_(e=>{if(e[0]&&e[0].locked)return e;let t=new Image;return t.src=s.toDataURL(),[{id:`base_overlay_${Date.now()}`,type:"image",img:t,rect:{x:0,y:0,w:s.width,h:s.height},opacity:0,blend:"source-over",locked:!0},...e];}),setTimeout(()=>{try{d(),tY();}catch(e){}},50));},[s]);let tl=e=>q(e,i,e_,eW,eO,tY,w),ta=async(e,t,r,l=!0)=>J(e,t,l?eU:[],r),tn=e=>Z(i,eU,e_,u,e),ti=e=>el(e_,e,eW),to=(e,t)=>ei(e_,e,t),ts=(e,t)=>eo(e_,e,t),tc=(e,t)=>es(e_,e,t),td=(e,t)=>ec(e_,e,t),tu=(e,t)=>ed(e_,e,t),th=(e,t)=>eu(e_,e,t),tf=(e,t)=>eh(e_,e,t),tx=(e,t)=>ef(e_,e,t);(0,I.useEffect)(()=>{var e;if(!i.current||!(null===(e=u.history[u.index])||void 0===e?void 0:e.isSetBase))return;let t=i.current,r=document.createElement("canvas");r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0),c(r),e_(e=>{if(!e[0])return e;let t={...e[0]};return t.img&&(t.img.src=r.toDataURL()),t.rect={x:0,y:0,w:r.width,h:r.height},[t,...e.slice(1)];}),o.current&&(o.current.width=r.width,o.current.height=r.height),tY();},[u.index]);let[tg,tm]=(0,I.useState)("#ff0000"),[tp,ty]=(0,I.useState)(2),[tv,tw]=(0,I.useState)("hard"),[tj,tb]=(0,I.useState)(1),[tC,tS]=(0,I.useState)(1),[tM,tz]=(0,I.useState)(!1),tR=(0,I.useRef)([]),tI=(0,I.useRef)(!1),tE=(0,I.useRef)(null),tD=(0,I.useRef)(tp),[tL,tB]=(0,I.useState)(0),[tT,tA]=(0,I.useState)(0),[tP,tH]=(0,I.useState)(0),[tN,tU]=(0,I.useState)(0),[t_,t$]=(0,I.useState)(0),[tW,tF]=(0,I.useState)(0),[tO,tG]=(0,I.useState)(0),[tV,tX]=(0,I.useState)({});(0,I.useEffect)(()=>{let e=a.current;if(!e)return;let t=e=>e.preventDefault();return e.addEventListener("contextmenu",t),()=>e.removeEventListener("contextmenu",t);},[]),(0,I.useEffect)(()=>{let e=a.current,t=i.current;if(!e||!t)return;let r=e=>{if(!e.ctrlKey)return;e.preventDefault();let r=t.getBoundingClientRect(),l=e.clientX-r.left,a=e.clientY-r.top;f(t=>{let r=Math.min(Math.max(t*(e.deltaY<0?1.1:.9),.1),12),n=r/t;return g(e=>({x:l-(l-e.x)*n,y:a-(a-e.y)*n})),r;});};return e.addEventListener("wheel",r,{passive:!1}),()=>e.removeEventListener("wheel",r);},[]);let tY=()=>{ex(o,i,{zoom:h,cropRect:F,rulerPoints:eP.current,perspectivePoints:ev.current,hoverColor:eL,tool:v,drawColor:tg,drawLineWidth:tp,layers:eU,overlaySelected:eF,activeLayerId:e$});};(0,I.useEffect)(()=>{let e=i.current;if(!e)return;let t=e=>{if("color"===v){let t=K(e,i,h);eB(t?{x:e.clientX,y:e.clientY,color:t}:null),tY();}else"draw"===v&&(eB(tg?{x:e.clientX,y:e.clientY,color:tg}:null),tY());},r=e=>{if("color"===v){let t=K(e,i,h);t&&(eA(t),tm(t),navigator.clipboard.writeText(t).catch(()=>{}),z.default.success(`Picked color ${t}`));}},l=()=>{"color"===v&&eB(null);};return e.addEventListener("mousemove",t),e.addEventListener("click",r),e.addEventListener("mouseleave",l),()=>{e.removeEventListener("mousemove",t),e.removeEventListener("click",r),e.removeEventListener("mouseleave",l);};},[v,h,x]),(0,I.useEffect)(()=>{let e=e=>{(!te.current||document.activeElement!==te.current)&&(e.ctrlKey&&"z"===e.key&&u.undo(),e.ctrlKey&&e.shiftKey&&"Z"===e.key&&u.redo(),"c"===e.key&&w("crop"),"h"===e.key&&w("pan"),"v"===e.key&&w("layer"),"t"===e.key&&w("text"),"r"===e.key&&O(90,i,o,u.history),"p"===e.key&&w("color"),"b"===e.key&&w("draw"),"Delete"===e.key&&("layer"===v||"text"===v)&&e$&&ti(e$),e.ctrlKey&&"s"===e.key&&("layer"===v||"text"===v)&&(e.preventDefault(),tn(e$)),e.ctrlKey&&"i"===e.key&&(e.preventDefault(),eC(i,u)));};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e);},[u.index,u.history,v,e$,eU]),(0,I.useEffect)(()=>{let e=e=>{let t=(t,r,l=!0)=>e.code===t&&!!l&&(e.preventDefault(),ek(e=>e??v),w(r),!0);"Shift"===e.key?eD(!0):t("Space","pan")?ez(!0):t("AltLeft","color","draw"===v)&&eI(!0);},t=e=>{let t=(t,r)=>{e.code===t&&(r(!1),ek(e=>(e&&w(e),null)));};"Shift"===e.key&&eD(!1),t("Space",ez),t("AltLeft",eI);};return window.addEventListener("keydown",e,{passive:!1}),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t);};},[v]);let tK=async()=>await em(i,o,ev,u,ep,tY),tq=(0,I.useMemo)(()=>{if(("pan"===v||"select"===v)&&m)return"grabbing";switch(v){case"pan":return"grab";case"crop":case"ruler":case"perspective":return"crosshair";case"color":return"copy";case"draw":return"pointer";case"text":return"text";default:return"default";}},[v,m]),tJ=(0,I.useMemo)(()=>{let e=i.current;return e?`${e.width} \xd7 ${e.height}`:s?`${s.width} \xd7 ${s.height}`:null;},[i.current,s]);return(0,n.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,n.jsx)(tk,{canvasRef:i,overlayRef:o,baseCanvas:s,upscaleImage:(e,t,r)=>ey(i,o,u,c,e_,tY,e,t,r),history:u,setTool:w,brightness:j,setBrightness:b,contrast:C,setContrast:S,highlights:k,setHighlights:M,shadows:R,setShadows:E,whites:B,setWhites:T,blacks:A,setBlacks:P,vibrance:H,setVibrance:N,saturation:U,setSaturation:_,dehaze:$,setDehaze:W,blur:tL,setBlur:tB,gaussian:tT,setGaussian:tA,sharpen:tP,setSharpen:tH,texture:tN,setTexture:tU,clarity:t_,setClarity:t$,bgThreshold:tW,setBgThreshold:tF,bgThresholdBlack:tO,setBgThresholdBlack:tG,hslAdjustments:tV,setHslAdjustments:(e,t)=>{tX(r=>({...r,[e]:{...r[e]||{},...t}}));},setShowPerspectiveModal:ep,dpiMeasured:eH,setDpiMeasured:eN,exportImage:ta,onExport:l}),(0,n.jsxs)("div",{style:{flex:1},children:[(0,n.jsx)(tQ,{history:u,setZoom:f,tool:v,setTool:w,brushType:tv,setBrushType:tw,drawColor:tg,setDrawColor:tm,drawLineWidth:tp,setDrawLineWidth:ty,brushOpacity:tj,setBrushOpacity:tb,brushFlow:tC,setBrushFlow:tS,layers:eU,activeLayerId:e$,setLayerOpacity:(e,t)=>Q(e_,e,t),setLayerBlend:(e,t)=>ee(e_,e,t),moveLayerUp:e=>et(e_,e),moveLayerDown:e=>er(e_,e),deleteLayer:ti,selectLayer:e=>{ea(eW,e),eO(!0);let t=eU.find(t=>t.id===e);t&&"text"===t.type&&(eV(t.text||""),eY(t.font||"Arial"),eq(t.fontSize||32),eZ(t.textColor||"#000000"),e0(t.fontWeight||"normal"),e8(!!t.fontItalic),e2(t.textDecoration||"none"),e5(t.textAlign||"left"));},mergeLayer:tn,textContent:eG,setTextContent:e=>{let t=eU.find(e=>e.id===e$);t&&"text"===t.type?to(t.id,e):eV(e);},textFont:eX,setTextFont:e=>{let t=eU.find(e=>e.id===e$);t&&"text"===t.type?ts(t.id,e):eY(e);},textFontSize:eK,setTextFontSize:e=>{let t=eU.find(e=>e.id===e$);t&&"text"===t.type?tc(t.id,e):eq(e);},textColor:eJ,setTextColor:e=>{let t=eU.find(e=>e.id===e$);t&&"text"===t.type?tf(t.id,e):eZ(e);},textWeight:eQ,setTextWeight:e=>{let t=eU.find(e=>e.id===e$);t&&"text"===t.type?td(t.id,e):e0(e);},textItalic:e1,setTextItalic:e=>{let t=eU.find(e=>e.id===e$);t&&"text"===t.type?tu(t.id,e):e8(e);},textDecoration:e4,setTextDecoration:e=>{let t=eU.find(e=>e.id===e$);t&&"text"===t.type?th(t.id,e):e2(e);},textAlign:e6,setTextAlign:e=>{let t=eU.find(e=>e.id===e$);t&&"text"===t.type?tx(t.id,e):e5(e);},onAddTextLayer:()=>{e9(!0),z.default.info("Click on the image to place the text");},isAddingText:e3,setIsAddingText:e9}),(0,n.jsx)(eS,{canvasRef:i,overlayRef:o,containerRef:a,offset:x,zoom:h,tool:v,currentCursor:tq,resolution:tJ,hoverColor:eL,onMouseDown:e=>{let t=i.current.getBoundingClientRect(),r=(e.clientX-t.left)/h,l=(e.clientY-t.top)/h,n=(e,r,l="",n)=>{eg({canvasX:e,canvasY:r,canvasRect:t,containerRef:a,inlineEditorRef:te,zoom:h,initial:l,layerId:null==n?void 0:n.layerId,layer:null==n?void 0:n.layer,textColor:eJ,textFont:eX,textFontSize:eK,textWeight:eQ,textItalic:e1,onCommit:t=>{n&&n.layerId?(ei(e_,n.layerId,t),tY()):en(i,e_,eW,eO,tY,{text:t,font:eX,fontSize:eK,fontWeight:eQ,fontItalic:e1,textDecoration:e4,textColor:eJ,textAlign:e6},{x:e,y:r}),e9(!1);},onCancel:()=>{e9(!1);}});},o=(e,t,r,l,a)=>{let n=a*Math.PI/180,i=Math.cos(n),o=Math.sin(n),s=e-r,c=t-l;return{x:r+s*i-c*o,y:l+s*o+c*i};};if(eU.length>0){for(let t=eU.length-1;t>=0;t--){let a=eU[t],i=a.rect,s=a.rotation||0,c=i.x+i.w/2,d=i.y+i.h/2,u=o(r,l,c,d,-s),f=6/Math.max(1,h);if(!(u.x>=i.x-f&&u.y>=i.y-f&&u.x<=i.x+i.w+f&&u.y<=i.y+i.h+f))continue;let x=8/Math.max(1,h),g={tl:o(i.x,i.y,c,d,s),tr:o(i.x+i.w,i.y,c,d,s),bl:o(i.x,i.y+i.h,c,d,s),br:o(i.x+i.w,i.y+i.h,c,d,s)},m={t:o(i.x+i.w/2,i.y,c,d,s),b:o(i.x+i.w/2,i.y+i.h,c,d,s),l:o(i.x,i.y+i.h/2,c,d,s),r:o(i.x+i.w,i.y+i.h/2,c,d,s)},p=(e,t)=>Math.abs(r-e)<=x&&Math.abs(l-t)<=x,y=p(g.tl.x,g.tl.y),w=p(g.tr.x,g.tr.y),j=p(g.bl.x,g.bl.y),b=p(g.br.x,g.br.y);if("text"===v&&"text"===a.type&&2===e.detail){eW(a.id),eO(!0),n(r,l,a.text||"",{layerId:a.id,layer:a});return;}if("layer"===v||"text"===v&&"text"===a.type){eW(a.id),eO(!0);let t=p(m.t.x,m.t.y),n=p(m.b.x,m.b.y),o=p(m.l.x,m.l.y),s=p(m.r.x,m.r.y);if(t||n||o||s){let e=t?"t":n?"b":o?"l":"r";tt.current={layerId:a.id,handle:e,startX:r,startY:l,orig:{...i}};return;}if(y||w||j||b){if(e.shiftKey){let e=Math.atan2(l-d,r-c);tr.current={layerId:a.id,startX:r,startY:l,centerX:c,centerY:d,startAngle:e,originalRotation:a.rotation||0};return;}let t=y?"tl":w?"tr":j?"bl":"br";tt.current={layerId:a.id,handle:t,startX:r,startY:l,orig:{...i}};return;}e7.current={layerId:a.id,startX:r,startY:l,origX:i.x,origY:i.y};return;}break;}eO(!1);}if("color"===v&&e.altKey&&2===e.button&&w("draw"),("draw"===v||"color"===v)&&e.altKey&&2===e.button){e.preventDefault(),tI.current=!0,tE.current=e.clientX,tD.current=tp;return;}if("pan"===v||"select"===v)p(!0),y.current={x:e.clientX-x.x,y:e.clientY-x.y};else if("crop"===v)V.current={x:r,y:l},G({x:r,y:l,w:1,h:1});else if("ruler"===v){if(eP.current){eP.current.x2=r,eP.current.y2=l;let e=r-eP.current.x1,t=l-eP.current.y1,a=Math.sqrt(e*e+t*t),n=Math.round(a/(i.current.width/(window.devicePixelRatio||1))*96);eN(n),z.default.info(`Distance: ${Math.round(a)} px, estimated DPI: ${n}`),eP.current=null;}else eP.current={x1:r,y1:l,x2:r,y2:l};}else if("perspective"===v){ew();let e=ej(r,l);if(e>=0){ev.current[e]=r,ev.current[e+1]=l,tY();return;}let t=ev.current,a=!1;for(let e=0;e<8;e+=2)if(isNaN(t[e])||isNaN(t[e+1])){t[e]=r,t[e+1]=l,a=!0;break;}if(!a){let e=ej(r,l,200);e>=0?(ev.current[e]=r,ev.current[e+1]=l):(ev.current[0]=r,ev.current[1]=l);}tY();}else if("draw"===v)tz(!0),tR.current=[{x:r,y:l}];else if("text"===v){n(r,l,eG||"");return;}},onMouseMove:e=>{if(tI.current&&null!==tE.current){let t=e.clientX-tE.current;ty(Math.max(1,Math.round(10*Math.min(500,tD.current+t/2))/10)),tY();return;}if(("pan"===v||"select"===v)&&m&&y.current){g({x:e.clientX-y.current.x,y:e.clientY-y.current.y});return;}try{let t=i.current.getBoundingClientRect(),r=(e.clientX-t.left)/h,l=(e.clientY-t.top)/h,n=null,o=(e,t,r,l,a)=>{let n=a*Math.PI/180,i=Math.cos(n),o=Math.sin(n),s=e-r,c=t-l;return{x:r+s*i-c*o,y:l+s*o+c*i};};for(let e=eU.length-1;e>=0;e--){let t=eU[e],a=t.rect,i=t.rotation||0,s=a.x+a.w/2,c=a.y+a.h/2;if(t.locked||"layer"!==v&&"text"!==v){n=null;break;}let d=o(r,l,s,c,-i),u=d.x>=a.x&&d.y>=a.y&&d.x<=a.x+a.w&&d.y<=a.y+a.h,f=8/Math.max(1,h),x={tl:o(a.x,a.y,s,c,i),tr:o(a.x+a.w,a.y,s,c,i),bl:o(a.x,a.y+a.h,s,c,i),br:o(a.x+a.w,a.y+a.h,s,c,i)},g={t:o(a.x+a.w/2,a.y,s,c,i),b:o(a.x+a.w/2,a.y+a.h,s,c,i),l:o(a.x,a.y+a.h/2,s,c,i),r:o(a.x+a.w,a.y+a.h/2,s,c,i)},m=(e,t)=>Math.abs(r-e)<=f&&Math.abs(l-t)<=f;if(m(x.tl.x,x.tl.y)){n="tl";break;}if(m(x.tr.x,x.tr.y)){n="tr";break;}if(m(x.bl.x,x.bl.y)){n="bl";break;}if(m(x.br.x,x.br.y)){n="br";break;}if(m(g.t.x,g.t.y)){n="t";break;}if(m(g.b.x,g.b.y)){n="b";break;}if(m(g.l.x,g.l.y)){n="l";break;}if(m(g.r.x,g.r.y)){n="r";break;}if(u){n="move";break;}}a.current&&(n?"move"===n?a.current.style.cursor="move":"t"===n||"b"===n?a.current.style.cursor="ns-resize":"l"===n||"r"===n?a.current.style.cursor="ew-resize":e.shiftKey&&("tl"===n||"tr"===n||"bl"===n||"br"===n)?a.current.style.cursor="crosshair":"tl"===n||"br"===n?a.current.style.cursor="nwse-resize":a.current.style.cursor="nesw-resize":a.current.style.cursor=tq);}catch(e){}let t=e7.current;if(t){let r=i.current.getBoundingClientRect(),l=(e.clientX-r.left)/h,a=(e.clientY-r.top)/h,n=l-t.startX,o=a-t.startY;e_(e=>e.map(e=>e.id!==t.layerId||e.locked?e:{...e,rect:{x:t.origX+n,y:t.origY+o,w:e.rect.w,h:e.rect.h}})),tY();return;}if("crop"===v&&V.current){let t=i.current.getBoundingClientRect(),r={x:(e.clientX-t.left)/h,y:(e.clientY-t.top)/h};G({x:Math.min(V.current.x,r.x),y:Math.min(V.current.y,r.y),w:Math.abs(r.x-V.current.x),h:Math.abs(r.y-V.current.y)}),tY();}else if("draw"===v&&tM&&i.current){let t=i.current.getBoundingClientRect(),r=(e.clientX-t.left)/h,l=(e.clientY-t.top)/h;tR.current.push({x:r,y:l});let a=i.current.getContext("2d");a.save(),a.globalAlpha=tj*tC,"soft"===tv?(a.shadowColor=tg,a.shadowBlur=.5*tp,a.lineWidth=.5*tp):(a.shadowBlur=0,a.lineWidth=tp),a.strokeStyle=tg,a.lineCap="round",a.lineJoin="round",a.beginPath();let n=tR.current;a.moveTo(n[n.length-2].x,n[n.length-2].y),a.lineTo(n[n.length-1].x,n[n.length-1].y),a.stroke(),a.restore(),tY();}else{let t=tr.current;if(t){let r=i.current.getBoundingClientRect(),l=(e.clientX-r.left)/h,a=(e.clientY-r.top)/h,{layerId:n,centerX:o,centerY:s,startAngle:c,originalRotation:d}=t,u=180/Math.PI*(Math.atan2(a-s,l-o)-c);e_(e=>e.map(e=>e.id!==n||e.locked?e:{...e,rotation:d+u})),tY();return;}let r=tt.current;if(r){let t=i.current.getBoundingClientRect(),l=(e.clientX-t.left)/h,a=(e.clientY-t.top)/h,{layerId:n,handle:o,startX:s,startY:c,orig:d}=r,u=d.x,f=d.y,x=d.w,g=d.h;if("t"===o?(f=a,g=d.h+(d.y-f)):"b"===o?g=a-d.y:"l"===o?(u=l,x=d.w+(d.x-u)):"r"===o?x=l-d.x:"tl"===o?(u=l,f=a,x=d.w+(d.x-u),g=d.h+(d.y-f)):"tr"===o?(f=a,x=l-d.x,g=d.h+(d.y-f)):"bl"===o?(u=l,x=d.w+(d.x-u),g=a-d.y):"br"===o&&(x=l-d.x,g=a-d.y),e.shiftKey&&("tl"===o||"tr"===o||"bl"===o||"br"===o)){let e=d.w/Math.max(1,d.h),t=x<0?-1:1,r=g<0?-1:1,l=Math.abs(x),a=Math.abs(g);l/Math.max(1,a)>e?g=l/e*r:x=a*e*t,"tl"===o?(u=d.x+(d.w-x),f=d.y+(d.h-g)):"tr"===o?f=d.y+(d.h-g):"bl"===o&&(u=d.x+(d.w-x));}x=Math.max(4/h,x),g=Math.max(4/h,g),e_(e=>e.map(e=>{if(e.id!==n||e.locked)return e;if("text"===e.type){let t=Math.max(8,Math.round(Math.max(1,g)-10));return{...e,rect:{x:u,y:f,w:x,h:g},fontSize:t};}return{...e,rect:{x:u,y:f,w:x,h:g}};})),tY();return;}tY();}},onMouseUp:()=>{if(tI.current){tI.current=!1,tE.current=null,tD.current=tp;return;}if(e7.current||tt.current||tr.current){e7.current=null,tt.current=null,tr.current=null,tY();return;}p(!1),y.current=null,"crop"===v&&F&&X(i,o,F,G,u),"draw"===v&&tM&&(tz(!1),u.push(i.current.toDataURL(),"Draw"));}})]}),(0,n.jsxs)(D.default,{title:"Perspective correction",open:Y,onOk:()=>tK(),onCancel:()=>ep(!1),okText:"Apply",children:[(0,n.jsx)("p",{children:"Click four points on the image (clockwise) to define the corners, then Apply."}),(0,n.jsx)("p",{style:{marginTop:8},children:"Tip: click a corner again to move it (or click near a point to reposition)."})]})]});},{Title:t1}=C.default,t8=()=>{let[e,t]=(0,I.useState)(null),[r,l]=(0,I.useState)(null),[a,i]=(0,I.useState)(!1),[s,d]=(0,I.useState)(null),h=(0,I.useRef)(0);(0,I.useEffect)(()=>{let e=e=>{var t;let r=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!r)return;let l=Array.from(r).find(e=>e.type.includes("image"));if(l){let t=l.getAsFile();t&&(x(t),z.default.success("Image pasted from clipboard!"),e.preventDefault());}};return window.addEventListener("paste",e),()=>window.removeEventListener("paste",e);},[e]);let x=r=>{let l=new FileReader;return l.onload=l=>{var a;return e?d(r):t(null===(a=l.target)||void 0===a?void 0:a.result);},l.readAsDataURL(r),i(!1),h.current=0,!1;};return(0,n.jsx)(o.default,{setDragging:i,dragCounter:h,handleUpload:x,children:(0,n.jsx)(g.default,{title:(0,n.jsxs)(n.Fragment,{children:["\u{1F5BC}\uFE0F PNG / JPEG Viewer ",(0,n.jsx)(j.default,{color:"cyan",children:"Beta"})]}),variant:"borderless",children:(0,n.jsxs)(p.default,{direction:"vertical",style:{width:"100%"},size:"large",children:[!a&&(0,n.jsx)(k.default,{beforeUpload:x,showUploadList:!1,accept:".png,.jpg,.jpeg",children:(0,n.jsx)(f.default,{icon:(0,n.jsx)(u.default,{}),children:"Upload Image (PNG/JPG)"})}),a&&(0,n.jsx)(c.default,{}),e&&(0,n.jsxs)("div",{children:[(0,n.jsx)(t1,{level:5,children:"Preview & Editor:"}),(0,n.jsx)(t0,{addOnFile:s,setAddOnFile:d,imageUrl:e,onExport:e=>{console.log("exported blob",e);}})]}),(0,n.jsx)(f.default,{onClick:()=>{t(null),l(null),d(null),z.default.info("Image and SVG cleared.");},danger:!0,disabled:!e,children:"Clear Image"})]})})});};}}]);
//# sourceMappingURL=2ed777c5-async.673b3ebf.js.map