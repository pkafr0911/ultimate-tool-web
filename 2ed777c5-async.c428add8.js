(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]||[]).push([["2ed777c5"],{"0426e8b0":function(e,t,r){r.d(t,"__esModule",{value:!0}),r.e(t,{default:function(){return eU;}});var n=r("777fffbe"),l=r("852bbaa9"),a=r("95bd365d"),i=r("a4f51854"),c=n._(i),d=r("d6f53458"),s=n._(d),o=r("434db6d0"),u=r("4f4539af"),h=n._(u),f=r("1d2482ba"),g=n._(f),x=r("2ac36d38"),m=n._(x),p=r("314fd1a3"),j=l._(p),w={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"}}]},name:"info-circle",theme:"outlined"},v=r("8fb0e3f9"),y=n._(v),C=j.forwardRef(function(e,t){return j.createElement(y.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:w}));}),b=r("d4f20bc1"),k=n._(b),R=j.forwardRef(function(e,t){return j.createElement(y.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:k.default}));}),S=r("5f92d263"),I=n._(S),M=r("0ec3d373"),L=n._(M),E=r("bb4b9fac"),_=n._(E),D=r("a9a67fa4"),B=n._(D),U=r("5a83e636"),P=n._(U),z=r("339facb1"),G=n._(z),V=r("05c9ca64"),T=n._(V),$=r("2206dff1"),H=n._($),N=r("cb204712"),A=n._(N),F=r("522a0302"),O=n._(F),Y=r("e0fc3175"),W=n._(Y),X=r("0ed998a9"),q=n._(X),K=r("f9cbb0db"),J=n._(K),Z=r("649689e8"),Q=n._(Z),ee=r("90c13dc1"),et=n._(ee),er=r("4f331305"),en=n._(er),el=r("94e78bcf"),ea=n._(el),ei=r("a41070f7"),ec=n._(ei),ed=j.forwardRef(function(e,t){return j.createElement(y.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:ec.default}));}),es=r("a12e4141"),eo=n._(es),eu=r("65094f81"),eh=n._(eu),ef={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M567.1 512l318.5-319.3c5-5 1.5-13.7-5.6-13.7h-90.5c-2.1 0-4.2.8-5.6 2.3l-273.3 274-90.2-90.5c12.5-22.1 19.7-47.6 19.7-74.8 0-83.9-68.1-152-152-152s-152 68.1-152 152 68.1 152 152 152c27.7 0 53.6-7.4 75.9-20.3l90 90.3-90.1 90.3A151.04 151.04 0 00288 582c-83.9 0-152 68.1-152 152s68.1 152 152 152 152-68.1 152-152c0-27.2-7.2-52.7-19.7-74.8l90.2-90.5 273.3 274c1.5 1.5 3.5 2.3 5.6 2.3H880c7.1 0 10.7-8.6 5.6-13.7L567.1 512zM288 370c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80zm0 444c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}}]},name:"scissor",theme:"outlined"},eg=j.forwardRef(function(e,t){return j.createElement(y.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:ef}));}),ex=r("c9122736"),em=n._(ex),ep=r("5e015b19"),ej=n._(ep),ew=r("a408d8c9"),ev=n._(ew),ey={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},eC=j.forwardRef(function(e,t){return j.createElement(y.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:ey}));}),eb=r("d90c6c6d"),ek=n._(eb),eR=r("13afdc7a"),eS=n._(eR);function eI(e,t){let r=document.createElement("canvas");return r.width=e,r.height=t,r;}let eM={sharpen:[0,-1,0,-1,5,-1,0,-1,0],blur3:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],gaussian5:[1/273,4/273,7/273,4/273,1/273,4/273,16/273,26/273,16/273,4/273,7/273,26/273,41/273,26/273,7/273,4/273,16/273,26/273,16/273,4/273,1/273,4/273,7/273,4/273,1/273]};function eL(e,t="image/png",r=.92){return new Promise(n=>e.toBlob(e=>n(e),t,r));}let{Option:eE}=en.default,e_=({imageUrl:e,onExport:t})=>{let r=(0,j.useRef)(null),n=(0,j.useRef)(null),l=(0,j.useRef)(null),[i,c]=(0,j.useState)(null),[d,s]=(0,j.useState)(1),[o,u]=(0,j.useState)({x:0,y:0}),[f,g]=(0,j.useState)(!1),x=(0,j.useRef)(null),[m,p]=(0,j.useState)("pan"),[w,v]=(0,j.useState)(0),[y,C]=(0,j.useState)(0),[b,k]=(0,j.useState)([]),[R,S]=(0,j.useState)(-1),[I,M]=(0,j.useState)(null),E=(0,j.useRef)(null),[_,D]=(0,j.useState)(!1),B=(0,j.useRef)(null),[U,z]=(0,j.useState)(null),[G,V]=(0,j.useState)(!1),[T,$]=(0,j.useState)(null),[H,N]=(0,j.useState)(null),[F,O]=(0,j.useState)(!1),Y=(0,j.useRef)(null),[W,X]=(0,j.useState)(null);(0,j.useEffect)(()=>{(async()=>{try{let t=await new Promise((t,r)=>{let n=new Image;n.crossOrigin="anonymous",n.onload=()=>{let e=eI(n.naturalWidth,n.naturalHeight);e.getContext("2d").drawImage(n,0,0),t(e);},n.onerror=r,n.src=e;});c(t);let r=eI(t.width,t.height);if(r.getContext("2d").drawImage(t,0,0),n.current){n.current.width=r.width,n.current.height=r.height;let e=n.current.getContext("2d");e.clearRect(0,0,r.width,r.height),e.drawImage(r,0,0);}J(K(r),"Initial load");}catch(e){console.error("Failed to load image",e),q.default.error("Failed to load image");}})();},[e]),(0,j.useEffect)(()=>{(function(){if(!n.current||!i)return;n.current.width=i.width,n.current.height=i.height,l.current.width=i.width,l.current.height=i.height;let e=n.current.getContext("2d");e.clearRect(0,0,n.current.width,n.current.height),e.drawImage(i,0,0);})();},[i]),(0,j.useEffect)(()=>{let e=r.current,t=n.current;if(!e||!t)return;let l=e=>{if(!e.ctrlKey)return;e.preventDefault();let r=t.getBoundingClientRect(),n=e.clientX-r.left,l=e.clientY-r.top;s(t=>{let r=Math.min(Math.max(t*(e.deltaY<0?1.1:.9),.1),12),a=r/t;return u(e=>({x:n-(n-e.x)*a,y:l-(l-e.y)*a})),r;});};return e.addEventListener("wheel",l,{passive:!1}),()=>e.removeEventListener("wheel",l);},[]);let K=e=>e.toDataURL("image/png");function J(e,t=""){let r=b.slice(0,R+1);r.push({canvasDataUrl:e,description:t}),k(r),S(r.length-1);}function Z(){R<=0||er(R-1);}function ee(){R>=b.length-1||er(R+1);}function er(e){let t=b[e];if(!t)return;let r=new Image;r.onload=()=>{let t=n.current.getContext("2d");n.current.width=r.naturalWidth,n.current.height=r.naturalHeight,l.current.width=r.naturalWidth,l.current.height=r.naturalHeight,t.clearRect(0,0,n.current.width,n.current.height),t.drawImage(r,0,0),S(e);},r.src=t.canvasDataUrl;}function el(){if(!l.current||!n.current)return;let e=l.current.getContext("2d");if(e.clearRect(0,0,l.current.width,l.current.height),I&&(e.save(),e.strokeStyle="#00aaff",e.lineWidth=2,e.setLineDash([6,4]),e.strokeRect(I.x,I.y,I.w,I.h),e.restore()),Y.current&&(e.save(),e.strokeStyle="#ffcc00",e.lineWidth=2,e.beginPath(),e.moveTo(Y.current.x1,Y.current.y1),e.lineTo(Y.current.x2,Y.current.y2),e.stroke(),e.restore()),B.current){e.save(),e.fillStyle="rgba(0,255,0,0.8)";for(let t=0;t<8;t+=2){let r=B.current[t],n=B.current[t+1];isNaN(r)||isNaN(n)||e.fillRect(r-4,n-4,8,8);}e.restore();}if(T&&"color"===m){let t=n.current.getBoundingClientRect(),r=(T.x-t.left-o.x)/d,l=(T.y-t.top-o.y)/d;e.save(),e.strokeStyle="#ff0000",e.lineWidth=2/d,e.beginPath(),e.arc(r,l,8/d,0,2*Math.PI),e.stroke(),e.restore();}}let ei=e=>{let t=n.current;if(!t)return null;let r=t.getBoundingClientRect(),l=Math.floor((e.clientX-r.left-o.x)/d),a=Math.floor((e.clientY-r.top-o.y)/d);if(l<0||a<0||l>=t.width||a>=t.height)return null;let i=t.getContext("2d",{willReadFrequently:!0});if(!i)return null;let c=i.getImageData(l,a,1,1).data;return`#${[c[0],c[1],c[2]].map(e=>e.toString(16).padStart(2,"0")).join("")}`;};function ec(){if(!n.current)return;let e=n.current.getContext("2d"),t=function(e){let t=new ImageData(e.width,e.height);return t.data.set(new Uint8ClampedArray(e.data)),t;}(e.getImageData(0,0,n.current.width,n.current.height));!function(e,t=0,r=0){let n=e.data,l=r/100+1,a=128*(1-l);for(let e=0;e<n.length;e+=4)n[e]=Math.min(255,Math.max(0,n[e]*l+a+t)),n[e+1]=Math.min(255,Math.max(0,n[e+1]*l+a+t)),n[e+2]=Math.min(255,Math.max(0,n[e+2]*l+a+t));}(t,w,y),e.putImageData(t,0,0),J(n.current.toDataURL(),"Brightness/Contrast");}async function es(e,t=Math.sqrt(e.length)){if(!n.current)return;let r=n.current.getContext("2d"),l=r.getImageData(0,0,n.current.width,n.current.height);!function(e,t,r){let n=e.width,l=e.height,a=e.data,i=new Uint8ClampedArray(a.length),c=Math.floor(r/2);for(let e=0;e<l;e++)for(let d=0;d<n;d++){let s=0,o=0,u=0,h=0;for(let i=0;i<r;i++)for(let f=0;f<r;f++){let g=d+f-c,x=e+i-c;if(g<0||g>=n||x<0||x>=l)continue;let m=(x*n+g)*4,p=t[i*r+f];s+=a[m]*p,o+=a[m+1]*p,u+=a[m+2]*p,h+=a[m+3]*p;}let f=(e*n+d)*4;i[f]=Math.min(255,Math.max(0,s)),i[f+1]=Math.min(255,Math.max(0,o)),i[f+2]=Math.min(255,Math.max(0,u)),i[f+3]=Math.min(255,Math.max(0,h||a[f+3]));}e.data.set(i);}(l,e,t),r.putImageData(l,0,0),J(n.current.toDataURL(),"Convolution");}function eu(e){if(!n.current)return;let t=n.current,r=eI(t.width,t.height);r.getContext("2d").drawImage(t,0,0);let a=eI(t.height,t.width),i=a.getContext("2d");i.translate(a.width/2,a.height/2),i.rotate(e*Math.PI/180),i.drawImage(r,-r.width/2,-r.height/2),n.current.width=a.width,n.current.height=a.height,l.current.width=a.width,l.current.height=a.height;let c=n.current.getContext("2d");c.clearRect(0,0,a.width,a.height),c.drawImage(a,0,0),J(n.current.toDataURL(),`Rotate ${e}`);}async function ef(){if(!n.current||!B.current)return;let e=n.current,t=e.width,r=e.height,a=function(e,t,r,n){let l=eI(r,n),a=l.getContext("2d");function i(t,l){let[i,c,d,s,o,u]=t,[h,f,g,x,m,p]=l;1e-6>Math.abs(h*(x-p)+g*(p-f)+m*(f-x))||(a.save(),a.beginPath(),a.moveTo(h,f),a.lineTo(g,x),a.lineTo(m,p),a.closePath(),a.clip(),a.drawImage(e,0,0,r,n),a.restore());}e.getContext("2d").getImageData(0,0,e.width,e.height);let[c,d,s,o,u,h,f,g]=t;return i([c,d,s,o,u,h],[0,0,r,0,0,n]),i([u,h,f,g,c,d],[r,n,0,n,r,0]),l;}(e,B.current,t,r);n.current.width=a.width,n.current.height=a.height,l.current.width=a.width,l.current.height=a.height,n.current.getContext("2d").clearRect(0,0,a.width,a.height),n.current.getContext("2d").drawImage(a,0,0),J(n.current.toDataURL(),"Perspective corrected"),D(!1);}async function ex(e=!1){if(!n.current)return;let r=await eL(n.current,e?"image/jpeg":"image/png",.92);t&&t(r);let l=URL.createObjectURL(r),a=document.createElement("a");a.href=l,a.download=e?"edited.jpg":"edited.png",a.click(),URL.revokeObjectURL(l),q.default.success("Exported image");}async function ep(){if(n.current)try{let e=await eL(n.current,"image/png");await navigator.clipboard.write([new ClipboardItem({"image/png":e})]),q.default.success("Image copied to clipboard");}catch(e){console.warn("clipboard failed",e),q.default.error("Copy failed (browser may not support)");}}return(0,j.useEffect)(()=>{let e=n.current;if(!e)return;let t=e=>{if("color"===m){let t=ei(e);$(t?{x:e.clientX,y:e.clientY,color:t}:null),el();}},r=e=>{if("color"===m){let t=ei(e);t&&(N(t),navigator.clipboard.writeText(t).catch(()=>{}),q.default.success(`Picked color ${t}`));}},l=()=>{"color"===m&&$(null);};return e.addEventListener("mousemove",t),e.addEventListener("click",r),e.addEventListener("mouseleave",l),()=>{e.removeEventListener("mousemove",t),e.removeEventListener("click",r),e.removeEventListener("mouseleave",l);};},[m,d,o]),(0,j.useEffect)(()=>{let e=e=>{e.ctrlKey&&"z"===e.key&&Z(),e.ctrlKey&&"y"===e.key&&ee(),"c"===e.key&&p("crop"),"v"===e.key&&p("pan"),"r"===e.key&&eu(90);};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e);},[R,b]),(0,j.useEffect)(()=>{let e=e=>{"Space"===e.code&&(e.preventDefault(),V(e=>(e||(z(e=>null===e?m:e),p("pan")),!0)));},t=e=>{"Space"===e.code&&(V(!1),z(e=>(e&&p(e),null)));};return window.addEventListener("keydown",e,{passive:!1}),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t);};},[m]),(0,a.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,a.jsx)("div",{style:{width:260},children:(0,a.jsxs)(P.default,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsxs)(P.default,{wrap:!0,children:[(0,a.jsx)(A.default,{title:"Undo (Ctrl+Z)",children:(0,a.jsx)(L.default,{icon:(0,a.jsx)(ek.default,{}),onClick:Z})}),(0,a.jsx)(A.default,{title:"Redo (Ctrl+Y)",children:(0,a.jsx)(L.default,{icon:(0,a.jsx)(eS.default,{}),onClick:ee})}),(0,a.jsx)(A.default,{title:"Rotate left",children:(0,a.jsx)(L.default,{icon:(0,a.jsx)(ed,{}),onClick:()=>eu(-90)})}),(0,a.jsx)(A.default,{title:"Rotate right",children:(0,a.jsx)(L.default,{icon:(0,a.jsx)(eo.default,{}),onClick:()=>eu(90)})}),(0,a.jsx)(A.default,{title:"Flip horizontal",children:(0,a.jsx)(L.default,{icon:(0,a.jsx)(eh.default,{}),onClick:function(){if(!n.current)return;let e=n.current.getContext("2d"),t=eI(n.current.width,n.current.height);t.getContext("2d").drawImage(n.current,0,0),e.save(),e.clearRect(0,0,n.current.width,n.current.height),e.scale(-1,1),e.drawImage(t,-n.current.width,0),e.restore(),J(n.current.toDataURL(),"Flip horizontal");}})}),(0,a.jsx)(A.default,{title:"Flip vertical",children:(0,a.jsx)(L.default,{icon:(0,a.jsx)(eh.default,{rotate:90}),onClick:function(){if(!n.current)return;let e=n.current.getContext("2d"),t=eI(n.current.width,n.current.height);t.getContext("2d").drawImage(n.current,0,0),e.save(),e.clearRect(0,0,n.current.width,n.current.height),e.scale(1,-1),e.drawImage(t,0,-n.current.height),e.restore(),J(n.current.toDataURL(),"Flip vertical");}})})]}),(0,a.jsx)(ea.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:"Brightness"}),(0,a.jsx)(Q.default,{min:-150,max:150,value:w,onChange:e=>v(e),onAfterChange:()=>ec()}),(0,a.jsx)("div",{style:{marginBottom:8},children:"Contrast"}),(0,a.jsx)(Q.default,{min:-100,max:100,value:y,onChange:e=>C(e),onAfterChange:()=>ec()})]}),(0,a.jsx)(ea.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:"Filters"}),(0,a.jsxs)(P.default,{children:[(0,a.jsx)(L.default,{onClick:()=>es(eM.sharpen,3),children:"Sharpen"}),(0,a.jsx)(L.default,{onClick:()=>es(eM.blur3,3),children:"Blur"}),(0,a.jsx)(L.default,{onClick:()=>es(eM.gaussian5,5),children:"Gaussian"})]})]}),(0,a.jsx)(ea.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:"Background"}),(0,a.jsx)(P.default,{children:(0,a.jsx)(L.default,{onClick:()=>(function(e=240){if(!n.current)return;let t=n.current.getContext("2d"),r=t.getImageData(0,0,n.current.width,n.current.height);(function(e,t=250){let r=e.data;for(let e=0;e<r.length;e+=4)r[e]>t&&r[e+1]>t&&r[e+2]>t&&(r[e+3]=0);})(r,e),t.putImageData(r,0,0),J(n.current.toDataURL(),"Background removed (threshold)");})(235),icon:(0,a.jsx)(em.default,{}),children:"Remove white"})})]}),(0,a.jsx)(ea.default,{}),(0,a.jsxs)(P.default,{children:[(0,a.jsx)(L.default,{icon:(0,a.jsx)(em.default,{}),onClick:()=>p("color"),children:"Color picker"}),H&&(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,a.jsx)("div",{style:{width:18,height:18,borderRadius:3,border:"1px solid #999",background:H}}),(0,a.jsx)("span",{children:H})]})]}),(0,a.jsx)(ea.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:"Crop & Perspective"}),(0,a.jsxs)(P.default,{children:[(0,a.jsx)(L.default,{icon:(0,a.jsx)(eg,{}),onClick:()=>p("crop"),children:"Crop (C)"}),(0,a.jsx)(L.default,{onClick:()=>{D(!0),p("perspective");},children:"Perspective"})]})]}),(0,a.jsx)(ea.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:"Ruler / DPI"}),(0,a.jsxs)(P.default,{children:[(0,a.jsx)(L.default,{icon:"\u{1F4CF}",onClick:()=>p("ruler"),children:"Ruler"}),(0,a.jsx)(L.default,{onClick:()=>{X(null),q.default.info("Ruler cleared");},children:"Clear"})]}),W&&(0,a.jsxs)("div",{children:["Estimated DPI: ",W]})]}),(0,a.jsx)(ea.default,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{marginBottom:8},children:"Export"}),(0,a.jsxs)(P.default,{children:[(0,a.jsx)(L.default,{icon:(0,a.jsx)(eC,{}),onClick:()=>ex(!1),children:"PNG"}),(0,a.jsx)(L.default,{onClick:()=>ex(!0),children:"JPG"}),(0,a.jsx)(L.default,{icon:(0,a.jsx)(h.default,{}),onClick:ep,children:"Copy"})]})]})]})}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsxs)(P.default,{children:[(0,a.jsx)(A.default,{title:"Zoom In",children:(0,a.jsx)(L.default,{icon:(0,a.jsx)(ej.default,{}),onClick:()=>s(e=>Math.min(1.2*e,8))})}),(0,a.jsx)(A.default,{title:"Zoom Out",children:(0,a.jsx)(L.default,{icon:(0,a.jsx)(ev.default,{}),onClick:()=>s(e=>Math.max(e/1.2,.1))})}),(0,a.jsxs)(en.default,{value:m,onChange:e=>p(e),style:{width:140},children:[(0,a.jsx)(eE,{value:"pan",children:"Pan"}),(0,a.jsx)(eE,{value:"crop",children:"Crop"}),(0,a.jsx)(eE,{value:"ruler",children:"Ruler"}),(0,a.jsx)(eE,{value:"perspective",children:"Perspective"})]})]})}),(0,a.jsxs)("div",{ref:r,onMouseDown:e=>{let t=n.current.getBoundingClientRect(),r=(e.clientX-t.left)/d,l=(e.clientY-t.top)/d;if("pan"===m||"select"===m)g(!0),x.current={x:e.clientX-o.x,y:e.clientY-o.y};else if("crop"===m)E.current={x:r,y:l},M({x:r,y:l,w:1,h:1});else if("ruler"===m){if(Y.current){Y.current.x2=r,Y.current.y2=l;let e=r-Y.current.x1,t=l-Y.current.y1,a=Math.sqrt(e*e+t*t),i=Math.round(a/(n.current.width/(window.devicePixelRatio||1))*96);X(i),q.default.info(`Distance: ${Math.round(a)} px, estimated DPI: ${i}`),Y.current=null;}else Y.current={x1:r,y1:l,x2:r,y2:l};}else if("perspective"===m){B.current||(B.current=[r,l,r,l,r,l,r,l]);let e=B.current;for(let t=0;t<8;t+=2)if(isNaN(e[t])||isNaN(e[t+1])||0===e[t]&&0===e[t+1]){e[t]=r,e[t+1]=l;break;}}},onMouseMove:e=>{if(("pan"===m||"select"===m)&&f&&x.current)u({x:e.clientX-x.current.x,y:e.clientY-x.current.y});else if("crop"===m&&E.current){let t=n.current.getBoundingClientRect(),r={x:(e.clientX-t.left)/d,y:(e.clientY-t.top)/d};M({x:Math.min(E.current.x,r.x),y:Math.min(E.current.y,r.y),w:Math.abs(r.x-E.current.x),h:Math.abs(r.y-E.current.y)}),el();}else el();},onMouseUp:()=>{g(!1),x.current=null,"crop"===m&&I&&function(){if(!n.current||!I)return;let e=eI(Math.max(1,Math.round(I.w)),Math.max(1,Math.round(I.h)));e.getContext("2d").drawImage(n.current,I.x,I.y,I.w,I.h,0,0,I.w,I.h),n.current.width=e.width,n.current.height=e.height,l.current.width=e.width,l.current.height=e.height;let t=n.current.getContext("2d");t.clearRect(0,0,e.width,e.height),t.drawImage(e,0,0),M(null),J(n.current.toDataURL(),"Cropped");}();},style:{width:"100%",height:"100vh",overflow:"hidden",border:"1px solid #eee",position:"relative",background:"#fafafa",cursor:("pan"===m||"select"===m)&&f?"grabbing":(e=>{switch(e){case"pan":return"grab";case"crop":case"ruler":case"perspective":return"crosshair";case"select":default:return"default";case"color":return"copy";}})(m)},children:[(0,a.jsx)("canvas",{ref:e=>{n.current=e;},style:{transform:`translate(${o.x}px, ${o.y}px) scale(${d})`,transformOrigin:"top left",display:"block"}}),(0,a.jsx)("canvas",{ref:e=>{l.current=e;},style:{position:"absolute",left:0,top:0,pointerEvents:"none",transform:`translate(${o.x}px, ${o.y}px) scale(${d})`,transformOrigin:"top left"}}),T&&(0,a.jsxs)("div",{style:{position:"fixed",left:T.x+12,top:T.y+12,background:"#fff",padding:"4px 8px",borderRadius:4,boxShadow:"0 0 6px rgba(0,0,0,0.2)",fontSize:12,zIndex:999999,pointerEvents:"none",display:"flex",alignItems:"center",gap:6},children:[(0,a.jsx)("span",{style:{display:"inline-block",width:12,height:12,background:T.color,border:"1px solid #ccc"}}),T.color]})]})]}),(0,a.jsx)(et.default,{title:"Perspective correction",open:_,onOk:()=>ef(),onCancel:()=>D(!1),okText:"Apply",children:(0,a.jsx)("p",{children:"Click four points on the image (clockwise) to define the corners, then Apply."})})]});},{Title:eD}=O.default,{TabPane:eB}=T.default,eU=()=>{let[e,t]=(0,j.useState)(null),[r,n]=(0,j.useState)(null),[l,i]=(0,j.useState)(null),[d,u]=(0,j.useState)(!1),[f,x]=(0,j.useState)(!1),m=(0,j.useRef)(0),[p,w]=(0,j.useState)(1),[v,y]=(0,j.useState)(1),[b,k]=(0,j.useState)(1),[S,M]=(0,j.useState)(8),[E,D]=(0,j.useState)(2),[U,z]=(0,j.useState)(1);(0,j.useEffect)(()=>{(0,o.handlePasteImage)(V);},[]);let V=e=>{t(e);let r=new FileReader;return r.onload=e=>{var t;return n(null===(t=e.target)||void 0===t?void 0:t.result);},r.readAsDataURL(e),u(!1),m.current=0,!1;},$=(e,t)=>{let r=new Blob([e],{type:"image/svg+xml"}),n=document.createElement("a");n.href=URL.createObjectURL(r),n.download=t,n.click();},N=l?btoa(unescape(encodeURIComponent(l))):"",F=l?`data:image/svg+xml;base64,${N}`:"";return(0,a.jsx)(c.default,{setDragging:u,dragCounter:m,handleUpload:V,children:(0,a.jsx)(_.default,{title:(0,a.jsxs)(a.Fragment,{children:["\u{1F5BC}\uFE0F PNG / JPEG Viewer ",(0,a.jsx)(H.default,{color:"cyan",children:"Beta"})]}),variant:"borderless",children:(0,a.jsxs)(P.default,{direction:"vertical",style:{width:"100%"},size:"large",children:[!d&&(0,a.jsx)(W.default,{beforeUpload:V,showUploadList:!1,accept:".png,.jpg,.jpeg",children:(0,a.jsx)(L.default,{icon:(0,a.jsx)(I.default,{}),children:"Upload Image (PNG/JPG)"})}),d&&(0,a.jsx)(s.default,{}),r&&(0,a.jsxs)("div",{children:[(0,a.jsx)(eD,{level:5,children:"Preview & Editor:"}),(0,a.jsx)(e_,{imageUrl:r,onExport:e=>{console.log("exported blob",e);}})]}),f&&(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(255, 255, 255, 0.7)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:(0,a.jsx)(G.default,{indicator:(0,a.jsx)(R,{style:{fontSize:48,color:"#1890ff"},spin:!0}),tip:"Converting image to SVG...",size:"large"})}),(0,a.jsx)(_.default,{size:"small",title:"Tracing Options (Adjust before converting)",children:(0,a.jsxs)(P.default,{wrap:!0,size:"large",children:[(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(A.default,{title:"Scale factor for the SVG output. Higher = larger SVG.",children:(0,a.jsxs)("label",{children:["Scale ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(B.default,{min:.1,step:.1,value:p,onChange:e=>w(e||1)})]}),(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(A.default,{title:"Error threshold for line detection. Lower = more precise lines.",children:(0,a.jsxs)("label",{children:["ltres ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(B.default,{min:0,value:v,onChange:e=>y(e||1)})]}),(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(A.default,{title:"Error threshold for curve detection. Lower = more precise curves.",children:(0,a.jsxs)("label",{children:["qtres ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(B.default,{min:0,value:b,onChange:e=>k(e||1)})]}),(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(A.default,{title:"Minimum path length to keep. Higher = simpler SVG with fewer tiny paths.",children:(0,a.jsxs)("label",{children:["Pathomit ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(B.default,{min:0,value:S,onChange:e=>M(e||0)})]}),(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(A.default,{title:"Pixel sampling interval for colors. 1 = every pixel, higher = faster but less accurate colors.",children:(0,a.jsxs)("label",{children:["ColorSampling ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(B.default,{min:1,value:E,onChange:e=>D(e||1)})]}),(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(A.default,{title:"Stroke width in the output SVG.",children:(0,a.jsxs)("label",{children:["StrokeWidth ",(0,a.jsx)(C,{style:{marginLeft:4}})]})}),(0,a.jsx)(B.default,{min:0,value:U,onChange:e=>z(e||1)})]})]})}),(0,a.jsxs)(P.default,{children:[(0,a.jsx)(L.default,{type:"primary",onClick:()=>{if(!r){q.default.error("Please upload an image first.");return;}x(!0);try{J.default.imageToSVG(r,e=>{i(e),x(!1),q.default.success("Image converted to SVG successfully!");},{scale:p,ltres:v,qtres:b,pathomit:S,colorsampling:E,strokewidth:U});}catch(e){console.error(e),x(!1),q.default.error("Error converting image to SVG.");}},disabled:!e,children:"Convert to SVG"}),(0,a.jsx)(L.default,{onClick:()=>{t(null),n(null),i(null),q.default.info("Image and SVG cleared.");},danger:!0,disabled:!e&&!l,children:"Clear Image"})]}),l&&(0,a.jsxs)(T.default,{defaultActiveKey:"svg",type:"card",style:{marginTop:16},children:[(0,a.jsxs)(eB,{tab:"SVG",children:[(0,a.jsxs)(P.default,{style:{marginBottom:8},children:[(0,a.jsx)(L.default,{onClick:()=>$(l,"image.svg"),icon:(0,a.jsx)(g.default,{}),children:"Download"}),(0,a.jsx)(L.default,{onClick:()=>(0,o.handleCopy)(l,"SVG copied!"),icon:(0,a.jsx)(h.default,{}),children:"Copy"})]}),(0,a.jsx)("div",{style:{border:"1px solid #eee",borderRadius:6,padding:12,overflow:"auto"},children:(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:l}})})]},"svg"),(0,a.jsxs)(eB,{tab:"Base64",children:[(0,a.jsxs)(P.default,{style:{marginBottom:8},children:[(0,a.jsx)(L.default,{onClick:()=>(0,o.handleCopy)(N,"Base64 copied!"),icon:(0,a.jsx)(h.default,{}),children:"Copy Base64"}),(0,a.jsx)(L.default,{onClick:()=>$(N,"image-base64.txt"),icon:(0,a.jsx)(g.default,{}),children:"Download Base64"})]}),(0,a.jsx)("pre",{style:{background:"#f7f7f7",padding:12,borderRadius:6,whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:300,overflow:"auto"},children:N})]},"base64"),(0,a.jsxs)(eB,{tab:"Data URI",children:[(0,a.jsxs)(P.default,{style:{marginBottom:8},children:[(0,a.jsx)(L.default,{onClick:()=>(0,o.handleCopy)(F,"Data URI copied!"),icon:(0,a.jsx)(h.default,{}),children:"Copy Data URI"}),(0,a.jsx)(L.default,{onClick:()=>$(F,"image-datauri.txt"),icon:(0,a.jsx)(g.default,{}),children:"Download Data URI"})]}),(0,a.jsx)("pre",{style:{background:"#f7f7f7",padding:12,borderRadius:6,whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:300,overflow:"auto"},children:F})]},"datauri")]})]})})});};}}]);
//# sourceMappingURL=2ed777c5-async.c428add8.js.map