(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ultimate-tool-web"]||[]).push([["2ed777c5"],{"0426e8b0":function(e,t,r){r.d(t,"__esModule",{value:!0}),r.e(t,{default:function(){return tl;}});var l=r("777fffbe"),n=r("852bbaa9"),a=r("95bd365d"),i=r("a4f51854"),s=l._(i),o=r("d6f53458"),u=l._(o),d=r("434db6d0"),c=r("4f4539af"),h=l._(c),f=r("1d2482ba"),g=l._(f),x=r("2ac36d38"),m=l._(x),p=r("314fd1a3"),w=n._(p),v={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"}}]},name:"info-circle",theme:"outlined"},y=r("8fb0e3f9"),b=l._(y),j=w.forwardRef(function(e,t){return w.createElement(b.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:v}));}),C=r("d4f20bc1"),S=l._(C),k=w.forwardRef(function(e,t){return w.createElement(b.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:S.default}));}),R=r("5f92d263"),M=l._(R),L=r("0ec3d373"),I=l._(L),E=r("bb4b9fac"),D=l._(E),B=r("a9a67fa4"),_=l._(B),z=r("5a83e636"),P=l._(z),T=r("339facb1"),U=l._(T),A=r("05c9ca64"),G=l._(A),H=r("2206dff1"),$=l._(H),N=r("cb204712"),O=l._(N),V=r("522a0302"),W=l._(V),F=r("e0fc3175"),X=l._(F),K=r("0ed998a9"),Y=l._(K),Z=r("f9cbb0db"),q=l._(Z),J=r("90c13dc1"),Q=l._(J);function ee(e,t){let r=document.createElement("canvas");return r.width=e,r.height=t,r;}function et(e,t,r){let l=e.width,n=e.height,a=e.data,i=new Uint8ClampedArray(a.length),s=Math.floor(r/2);for(let e=0;e<n;e++)for(let o=0;o<l;o++){let u=0,d=0,c=0,h=0;for(let i=0;i<r;i++)for(let f=0;f<r;f++){let g=o+f-s,x=e+i-s;if(g<0||g>=l||x<0||x>=n)continue;let m=(x*l+g)*4,p=t[i*r+f];u+=a[m]*p,d+=a[m+1]*p,c+=a[m+2]*p,h+=a[m+3]*p;}let f=(e*l+o)*4;i[f]=Math.min(255,Math.max(0,u)),i[f+1]=Math.min(255,Math.max(0,d)),i[f+2]=Math.min(255,Math.max(0,c)),i[f+3]=Math.min(255,Math.max(0,h||a[f+3]));}return e.data.set(i),e;}let er={sharpen:[0,-1,0,-1,5,-1,0,-1,0],blur3:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],gaussian5:[1/273,4/273,7/273,4/273,1/273,4/273,16/273,26/273,16/273,4/273,7/273,26/273,41/273,26/273,7/273,4/273,16/273,26/273,16/273,4/273,1/273,4/273,7/273,4/273,1/273],generateBoxBlurKernel(e){let t=0|e,r=t*t;return Array(r).fill(1/r);},generateGaussianKernel(e){let t=0|e,r=t/2,l=2*r*r,n=[],a=0;for(let e=-t;e<=t;e++)for(let r=-t;r<=t;r++){let t=Math.exp(-(r*r+e*e)/l);n.push(t),a+=t;}return n.map(e=>e/a);}};function el(e,t="image/png",r=.92){return new Promise(l=>e.toBlob(e=>l(e),t,r));}let en=(e,t=0,r=255)=>Math.min(r,Math.max(t,e)),ea=e=>Math.min(1,Math.max(0,e)),ei=(e,t,r)=>{let l=Math.max(e/=255,t/=255,r/=255),n=Math.min(e,t,r),a=0,i=0,s=(l+n)/2;if(l!==n){let o=l-n;switch(i=s>.5?o/(2-l-n):o/(l+n),l){case e:a=(t-r)/o+(t<r?6:0);break;case t:a=(r-e)/o+2;break;case r:a=(e-t)/o+4;}a/=6;}return[a,i,s];},es=(e,t,r)=>{let l,n,a;if(0===t)l=n=a=r;else{let i=(e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6)?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e,s=r<.5?r*(1+t):r+t-r*t,o=2*r-s;l=i(o,s,e+1/3),n=i(o,s,e),a=i(o,s,e-1/3);}return[Math.round(255*l),Math.round(255*n),Math.round(255*a)];},eo=(e,{highlights:t=0,shadows:r=0,whites:l=0,blacks:n=0,vibrance:a=0,saturation:i=0,clarity:s=0,dehaze:o=0})=>{let u=e.data,d=0!==s?new Uint8ClampedArray(u):null;for(let e=0;e<u.length;e+=4){let c=u[e],h=u[e+1],f=u[e+2],g=.299*c+.587*h+.114*f;if(g>192&&0!==t){let e=(g-192)/63;c=en(c+t*e),h=en(h+t*e),f=en(f+t*e);}if(g<64&&0!==r){let e=1-g/64;c=en(c+r*e),h=en(h+r*e),f=en(f+r*e);}if(c=en(c+l-n),h=en(h+l-n),f=en(f+l-n),0!==o&&(c=en(c*(1+o/100)),h=en(h*(1-o/200)),f=en(f*(1-o/200))),0!==a||0!==i){let e=[c,h,f];ed(e,0,{vibrance:a,saturation:i}),[c,h,f]=e;}if(0!==s&&d){let t=s/100*(g-(.299*d[e]+.587*d[e+1]+.114*d[e+2]));c=en(c+t),h=en(h+t),f=en(f+t);}u[e]=c,u[e+1]=h,u[e+2]=f;}return e;},eu=(e,t,r)=>{let[l,n,a]=ei(e[t],e[t+1],e[t+2]);a=ea(a*(1+r/100));let[i,s,o]=es(l,n=ea(n*(1-Math.abs(r)/300)),a);e[t]=i,e[t+1]=s,e[t+2]=o;},ed=(e,t,{vibrance:r=0,saturation:l=0})=>{let[n,a,i]=ei(e[t],e[t+1],e[t+2]);0!==l&&(a=ea(a*(1+l/100))),0!==r&&(a=ea(a+r/100*(1-a)*(1-a)));let[s,o,u]=es(n,a,i);e[t]=s,e[t+1]=o,e[t+2]=u;},ec=[{name:"red",range:[345,15]},{name:"orange",range:[15,45]},{name:"yellow",range:[45,75]},{name:"green",range:[75,165]},{name:"aqua",range:[165,195]},{name:"blue",range:[195,255]},{name:"purple",range:[255,285]},{name:"magenta",range:[285,345]}],eh=(e,t)=>{let r=e.data;for(let e=0;e<r.length;e+=4){let[l,n,a]=[r[e],r[e+1],r[e+2]],[i,s,o]=ei(l,n,a),u=(360*i+360)%360,d=ec.find(({range:e})=>{let[t,r]=e;return t<=r?u>=t&&u<=r:u>=t||u<=r;});if(!d){[r[e],r[e+1],r[e+2]]=es(i,s,o);continue;}let c=t[d.name];if(!c){[r[e],r[e+1],r[e+2]]=es(i,s,o);continue;}let[h,f]=d.range,g=f;h>g&&(g+=360);let x=u;if(x<h&&(x+=360),"number"==typeof c.h&&0!==c.h){let e=x+c.h;e<h&&(e=h),e>g&&(e=g),i=(u=(e%360+360)%360)/360;}"number"==typeof c.s&&0!==c.s&&(s=ea(s*(1+(1>=Math.abs(c.s)?100*c.s:c.s)/100))),"number"==typeof c.l&&0!==c.l&&(o=ea(o*(1+(1>=Math.abs(c.l)?100*c.l:c.l)/100))),[r[e],r[e+1],r[e+2]]=es(i,s,o);}return e;},ef=(e,t,r,l)=>{if(!t.current)return;let n=t.current,a=ee(n.width,n.height);a.getContext("2d").drawImage(n,0,0);let i=ee(n.height,n.width),s=i.getContext("2d");s.translate(i.width/2,i.height/2),s.rotate(e*Math.PI/180),s.drawImage(a,-a.width/2,-a.height/2),t.current.width=i.width,t.current.height=i.height,r.current.width=i.width,r.current.height=i.height;let o=t.current.getContext("2d");o.clearRect(0,0,i.width,i.height),o.drawImage(i,0,0),l.push(t.current.toDataURL(),`Rotate ${e}`);},eg=async(e=!1,t,r)=>{if(!t.current)return;let l=await el(t.current,e?"image/jpeg":"image/png",.92);r&&r(l);let n=URL.createObjectURL(l),a=document.createElement("a");a.href=n,a.download=e?"edited.jpg":"edited.png",a.click(),URL.revokeObjectURL(n),Y.default.success("Exported image");},ex=async e=>{if(e.current)try{let t=await el(e.current,"image/png");await navigator.clipboard.write([new ClipboardItem({"image/png":t})]),Y.default.success("Image copied to clipboard");}catch(e){console.warn("clipboard failed",e),Y.default.error("Copy failed (browser may not support)");}},em=(e,t)=>{if(!e.current)return;let r=e.current.getContext("2d"),l=ee(e.current.width,e.current.height);l.getContext("2d").drawImage(e.current,0,0),r.save(),r.clearRect(0,0,e.current.width,e.current.height),r.scale(-1,1),r.drawImage(l,-e.current.width,0),r.restore(),t.push(e.current.toDataURL(),"Flip horizontal");},ep=(e,t)=>{if(!e.current)return;let r=e.current.getContext("2d"),l=ee(e.current.width,e.current.height);l.getContext("2d").drawImage(e.current,0,0),r.save(),r.clearRect(0,0,e.current.width,e.current.height),r.scale(1,-1),r.drawImage(l,0,-e.current.height),r.restore(),t.push(e.current.toDataURL(),"Flip vertical");},ew=(e,t,r,l,n)=>{if(!e.current||!r)return;let a=ee(Math.max(1,Math.round(r.w)),Math.max(1,Math.round(r.h)));a.getContext("2d").drawImage(e.current,r.x,r.y,r.w,r.h,0,0,r.w,r.h),e.current.width=a.width,e.current.height=a.height,t.current.width=a.width,t.current.height=a.height;let i=e.current.getContext("2d");i.clearRect(0,0,a.width,a.height),i.drawImage(a,0,0),l(null),n.push(e.current.toDataURL(),"Cropped");},ev=(e,t,r)=>{let l=t.current;if(!l)return null;let n=l.getBoundingClientRect(),a=Math.floor((e.clientX-n.left)/r),i=Math.floor((e.clientY-n.top)/r);if(a<0||i<0||a>=l.width||i>=l.height)return null;let s=l.getContext("2d",{willReadFrequently:!0});if(!s)return null;let o=s.getImageData(a,i,1,1).data;return`#${[o[0],o[1],o[2]].map(e=>e.toString(16).padStart(2,"0")).join("")}`;},ey={blur:0,gaussian:0,sharpen:0,texture:0,clarity:0,bgThreshold:0,bgThresholdBlack:0,brightness:0,contrast:0,highlights:0,shadows:0,whites:0,blacks:0,vibrance:0,saturation:0,dehaze:0,hslAdjustments:{}},eb=null,ej=(e,t,{blur:r=0,gaussian:l=0,sharpen:n=0,bgThreshold:a=0,bgThresholdBlack:i=0,brightness:s=0,contrast:o=0,texture:u=0,clarity:d=0,highlights:c=0,shadows:h=0,whites:f=0,blacks:g=0,vibrance:x=0,saturation:m=0,dehaze:p=0,hslAdjustments:w={}},v,y)=>{if(!e.current||!t)return;let b=e.current.getContext("2d"),j=t.getContext("2d");if(eb||(eb=j.getImageData(0,0,t.width,t.height)),!eb)return;let C=function(e){let t=new ImageData(e.width,e.height);return t.data.set(new Uint8ClampedArray(e.data)),t;}(eb);if(0===r&&0===l&&0===n&&0===u&&0===d&&0===a&&0===i&&0===s&&0===o&&0===c&&0===h&&0===f&&0===g&&0===x&&0===m&&0===p&&0===Object.keys(w).length){b.putImageData(C,0,0),e.current&&y(eC(e.current));return;}if(r>0){let e=r%2==0?r+1:r;et(C,er.generateBoxBlurKernel(e),e);}if(l>0&&et(C,er.generateGaussianKernel(l),2*l+1),n>0&&et(C,er.sharpen.map(e=>5===e?1+4*n:-1===e?-n:e),3),0!==u&&et(C,[0,-1,0,-1,5+.05*u,-1,0,-1,0],3),0!==d&&et(C,[0,-1,0,-1,5+.08*d,-1,0,-1,0],3),a>0&&function(e,t=0){t=255-t;let r=e.data;for(let e=0;e<r.length;e+=4)r[e]>t&&r[e+1]>t&&r[e+2]>t&&(r[e+3]=0);}(C,a),i>0&&function(e,t=0){let r=e.data;for(let e=0;e<r.length;e+=4)r[e]<t&&r[e+1]<t&&r[e+2]<t&&(r[e+3]=0);}(C,i),(0!==s||0!==o)&&function(e,t=0,r=0){let l=e.data,n=r/100+1,a=128*(1-n);for(let e=0;e<l.length;e+=4)l[e]=Math.min(255,Math.max(0,l[e]*n+a+t)),l[e+1]=Math.min(255,Math.max(0,l[e+1]*n+a+t)),l[e+2]=Math.min(255,Math.max(0,l[e+2]*n+a+t));}(C,s,o),0!==c||0!==h||0!==f||0!==g||0!==x||0!==m||0!==p){let e=C.data;for(let t=0;t<e.length;t+=4)p&&eu(e,t,p),(x||m)&&ed(e,t,{vibrance:x,saturation:m});eo(C,{highlights:c,shadows:h,whites:f,blacks:g,vibrance:x,saturation:m,clarity:d,dehaze:p});}Object.keys(w).length>0&&eh(C,w),b.putImageData(C,0,0);let S=Object.entries({blur:r,gaussian:l,sharpen:n,texture:u,clarity:d,bgThreshold:a,bgThresholdBlack:i,brightness:s,contrast:o,highlights:c,shadows:h,whites:f,blacks:g,vibrance:x,saturation:m,dehaze:p,hslAdjustments:w}).filter(([e,t])=>ey[e]!==t);if(S.length>0){let t=S.map(([e,t])=>`${e}=${JSON.stringify(t)}`).join(", ");v.push(e.current.toDataURL(),`${t}`),ey={blur:r,gaussian:l,sharpen:n,texture:u,clarity:d,bgThreshold:a,bgThresholdBlack:i,brightness:s,contrast:o,highlights:c,shadows:h,whites:f,blacks:g,vibrance:x,saturation:m,dehaze:p,hslAdjustments:w};}e.current&&y(eC(e.current));},eC=e=>{if(!e)return{red:Array(256).fill(0),green:Array(256).fill(0),blue:Array(256).fill(0)};let t=e.getContext("2d");if(!t)return{red:Array(256).fill(0),green:Array(256).fill(0),blue:Array(256).fill(0)};let{width:r,height:l}=e,{data:n}=t.getImageData(0,0,r,l),a=Array(256).fill(0),i=Array(256).fill(0),s=Array(256).fill(0);for(let e=0;e<n.length;e+=4)a[n[e]]++,i[n[e+1]]++,s[n[e+2]]++;return{red:a,green:i,blue:s};},eS=({canvasRef:e,overlayRef:t,containerRef:r,offset:l,zoom:n,tool:i,currentCursor:s,hoverColor:o,onMouseDown:u,onMouseMove:d,onMouseUp:c})=>(0,a.jsxs)("div",{ref:r,onMouseDown:u,onMouseMove:d,onMouseUp:c,style:{width:"100%",height:"100vh",overflow:"hidden",border:"1px solid #eee",position:"relative",background:"#fafafa",cursor:s},children:[(0,a.jsx)("canvas",{ref:e,style:{transform:`translate(${l.x}px, ${l.y}px) scale(${n})`,transformOrigin:"top left",display:"block"}}),(0,a.jsx)("canvas",{ref:t,style:{position:"absolute",left:0,top:0,pointerEvents:"none",transform:`translate(${l.x}px, ${l.y}px) scale(${n})`,transformOrigin:"top left"}}),o&&"color"===i&&(0,a.jsxs)("div",{style:{position:"fixed",left:o.x+12,top:o.y+12,background:"#fff",padding:"4px 8px",borderRadius:4,boxShadow:"0 0 6px rgba(0,0,0,0.2)",fontSize:12,zIndex:999999,pointerEvents:"none",display:"flex",alignItems:"center",gap:6},children:[(0,a.jsx)("span",{style:{display:"inline-block",width:12,height:12,background:o.color,border:"1px solid #ccc"}}),o.color]})]});var ek=r("00798b85"),eR=l._(ek),eM=r("d90c6c6d"),eL=l._(eM),eI=r("13afdc7a"),eE=l._(eI),eD=r("a41070f7"),eB=l._(eD),e_=w.forwardRef(function(e,t){return w.createElement(b.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:eB.default}));}),ez=r("a12e4141"),eP=l._(ez),eT=r("65094f81"),eU=l._(eT),eA={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M567.1 512l318.5-319.3c5-5 1.5-13.7-5.6-13.7h-90.5c-2.1 0-4.2.8-5.6 2.3l-273.3 274-90.2-90.5c12.5-22.1 19.7-47.6 19.7-74.8 0-83.9-68.1-152-152-152s-152 68.1-152 152 68.1 152 152 152c27.7 0 53.6-7.4 75.9-20.3l90 90.3-90.1 90.3A151.04 151.04 0 00288 582c-83.9 0-152 68.1-152 152s68.1 152 152 152 152-68.1 152-152c0-27.2-7.2-52.7-19.7-74.8l90.2-90.5 273.3 274c1.5 1.5 3.5 2.3 5.6 2.3H880c7.1 0 10.7-8.6 5.6-13.7L567.1 512zM288 370c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80zm0 444c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}}]},name:"scissor",theme:"outlined"},eG=w.forwardRef(function(e,t){return w.createElement(b.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:eA}));}),eH={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},e$=w.forwardRef(function(e,t){return w.createElement(b.default,(0,m.default)((0,m.default)({},e),{},{ref:t,icon:eH}));}),eN=r("5b30eb7f"),eO=l._(eN),eV=r("649689e8"),eW=l._(eV);let eF=({label:e,value:t,min:r,max:l,gradient:n,onChange:i,onChangeComplete:s})=>(0,a.jsxs)("div",{className:"custom-slider-container",children:[(0,a.jsxs)("div",{style:{width:"100%"},children:[(0,a.jsx)("span",{className:"custom-label",children:e}),(0,a.jsx)(_.default,{min:r,max:l,value:t,onChange:e=>i(Number(e)),onBlur:()=>null==s?void 0:s(),className:"custom-number",size:"small"})]}),(0,a.jsx)(eW.default,{min:r,max:l,value:t,onChange:i,onChangeComplete:s,className:"custom-slider",style:{"--custom-slider-gradient":n},handleStyle:{opacity:1}})]});var eX=r("376ce0b3"),eK=l._(eX),eY=r("235f33b8"),eZ=l._(eY);let eq=({redData:e,greenData:t,blueData:r})=>{let l=(0,w.useMemo)(()=>({chart:{backgroundColor:"#2b2b2b",height:120,spacing:[5,5,5,5]},title:{text:""},xAxis:{title:{text:"",style:{color:"#fff"}},labels:{style:{color:"#fff",fontSize:"5px"}},gridLineColor:"rgba(255,255,255,0.1)"},yAxis:{title:{text:"",style:{color:"#fff"}},labels:{style:{color:"#fff",fontSize:"5px"}},gridLineColor:"rgba(255,255,255,0.1)"},legend:{enabled:!1},plotOptions:{series:{animation:!1,marker:{enabled:!1}}},series:[{name:"Red",data:e,color:"#ff4444",zIndex:3,lineWidth:1},{name:"Green",data:t,color:"#44ff44",zIndex:2,lineWidth:1},{name:"Blue",data:r,color:"#4444ff",zIndex:1,lineWidth:1}],credits:{enabled:!1},tooltip:{enabled:!1}}),[e,t,r]);return(0,a.jsx)(eZ.default,{highcharts:eK.default,options:l});},{Panel:eJ}=eR.default,eQ=({canvasRef:e,baseCanvas:t,history:r,setTool:l,brightness:n,setBrightness:i,contrast:s,setContrast:o,blur:u,setBlur:d,gaussian:c,setGaussian:f,sharpen:g,setSharpen:x,bgThreshold:m,setBgThreshold:p,bgThresholdBlack:v,setBgThresholdBlack:y,setShowPerspectiveModal:b,dpiMeasured:j,setDpiMeasured:C,exportImage:S,onExport:k,overlayRef:R,texture:M,setTexture:L,clarity:E,setClarity:D,highlights:B,setHighlights:_,shadows:z,setShadows:T,whites:U,setWhites:A,blacks:G,setBlacks:H,vibrance:$,setVibrance:N,saturation:V,setSaturation:W,dehaze:F,setDehaze:X,hslAdjustments:K,setHslAdjustments:Z})=>{let[q,J]=(0,w.useState)("red"),[Q,ee]=(0,w.useState)({red:[],green:[],blue:[]});(0,w.useEffect)(()=>{e.current&&ee(eC(e.current));},[e.current]);let et=[{name:"red",color:"#ff4d4d"},{name:"orange",color:"#ffa500"},{name:"yellow",color:"#ffd700"},{name:"green",color:"#00c853"},{name:"aqua",color:"#00e5ff"},{name:"blue",color:"#2979ff"},{name:"purple",color:"#9c27b0"},{name:"magenta",color:"#ff00aa"}],er=(e,t)=>{var r,l,n;let a=(null===(r=et.find(t=>t.name===e))||void 0===r?void 0:r.color)||"#ffffff",i=et.findIndex(t=>t.name===e);if(-1===i)return"#555";let s=et[i].color,o=(null===(l=et[i-1])||void 0===l?void 0:l.color)||s,u=(null===(n=et[i+1])||void 0===n?void 0:n.color)||s;switch(t){case"h":return`linear-gradient(90deg, ${o}, ${s}, ${u})`;case"s":return`linear-gradient(90deg, gray, ${a})`;case"l":return`linear-gradient(90deg, black, ${a}, white)`;default:return"#555";}},el=[{key:"texture",label:"Texture",value:M,setter:L},{key:"clarity",label:"Clarity",value:E,setter:D},{key:"highlights",label:"Highlights",value:B,setter:_},{key:"shadows",label:"Shadows",value:z,setter:T},{key:"whites",label:"Whites",value:U,setter:A},{key:"blacks",label:"Blacks",value:G,setter:H}],en=[{key:"blur",label:"Box Blur",min:0,max:25,value:u,setter:d},{key:"gaussian",label:"Gaussian",min:0,max:20,value:c,setter:f},{key:"sharpen",label:"Sharpen",min:0,max:5,value:g,setter:x},{key:"bgThreshold",label:"Remove White",min:0,max:255,value:m,setter:p},{key:"bgThresholdBlack",label:"Remove Black",min:0,max:255,value:v,setter:y}],ea=()=>ej(e,t,{blur:u,gaussian:c,sharpen:g,texture:M,clarity:E,bgThreshold:m,bgThresholdBlack:v,brightness:n,contrast:s,highlights:B,shadows:z,whites:U,blacks:G,vibrance:$,saturation:V,dehaze:F,hslAdjustments:K},r,ee);return(0,a.jsx)("div",{style:{width:260},children:(0,a.jsxs)(eR.default,{defaultActiveKey:["histogram","basic","lights","effects"],ghost:!0,expandIconPosition:"end",children:[(0,a.jsx)(eJ,{header:"Histogram",children:(0,a.jsx)(eq,{redData:Q.red,greenData:Q.green,blueData:Q.blue})},"histogram"),(0,a.jsx)(eJ,{header:"\u{1F6E0} Basic",children:(0,a.jsxs)(P.default,{wrap:!0,children:[(0,a.jsx)(O.default,{title:"Undo (Ctrl+Z)",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(eL.default,{}),onClick:r.undo})}),(0,a.jsx)(O.default,{title:"Redo (Ctrl+Shift+Z)",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(eE.default,{}),onClick:r.redo})}),(0,a.jsx)(O.default,{title:"Rotate left",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(e_,{}),onClick:()=>ef(-90,e,R,r)})}),(0,a.jsx)(O.default,{title:"Rotate right",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(eP.default,{}),onClick:()=>ef(90,e,R,r)})}),(0,a.jsx)(O.default,{title:"Flip horizontal",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(eU.default,{}),onClick:()=>em(e,r)})}),(0,a.jsx)(O.default,{title:"Flip vertical",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(eU.default,{rotate:90}),onClick:()=>ep(e,r)})}),(0,a.jsx)(O.default,{title:"Brush",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(eO.default,{}),onClick:()=>l("draw")})})]})},"basic"),(0,a.jsxs)(eJ,{header:"\u{1F506} Light",children:[(0,a.jsx)(eF,{label:"Brightness",value:n,min:-150,max:150,onChange:i,onChangeComplete:ea},"brightness"),(0,a.jsx)(eF,{label:"Contrast",value:s,min:-100,max:100,onChange:o,onChangeComplete:ea},"contrast")]},"lights"),(0,a.jsxs)(eJ,{header:"\u{1F3A8} Color",children:[(0,a.jsx)(eF,{label:"Vibrance",value:$,min:-100,max:100,onChange:N,onChangeComplete:ea},"vibrance"),(0,a.jsx)(eF,{label:"Saturation",value:V,min:-100,max:100,onChange:W,onChangeComplete:ea},"saturation"),(0,a.jsx)(eF,{label:"Dehaze",value:F,min:-100,max:100,onChange:X,onChangeComplete:ea},"dehaze"),(0,a.jsx)("div",{style:{marginTop:10},children:"HSL Mixer"}),(0,a.jsx)("div",{style:{display:"flex",gap:8,marginBottom:10},children:et.map(({name:e,color:t})=>(0,a.jsx)(O.default,{title:e.toUpperCase(),children:(0,a.jsx)("div",{onClick:()=>J(e),style:{width:20,height:20,borderRadius:"50%",background:t,border:q===e?"2px solid white":"1px solid #555",boxShadow:q===e?"0 0 6px rgba(255,255,255,0.8)":"",cursor:"pointer"}},e)}))}),["Hue","Saturation","Luminance"].map(e=>{var t;let r=e[0].toLowerCase();return(0,a.jsx)(eF,{label:e,value:(null===(t=K[q])||void 0===t?void 0:t[r])??0,min:"Hue"===e?-180:-100,max:"Hue"===e?180:100,onChange:e=>Z(q,{[r]:e}),onChangeComplete:ea,gradient:er(q,r)},e);}),(0,a.jsx)(I.default,{size:"small",onClick:()=>Z(q,{h:0,s:0,l:0}),children:"Reset"})]},"color"),(0,a.jsx)(eJ,{header:"\u2728 Effects",children:el.map(({key:e,label:t,value:r,setter:l})=>(0,a.jsx)(eF,{label:t,value:r,min:-100,max:100,onChange:l,onChangeComplete:ea},e))},"effects"),(0,a.jsx)(eJ,{header:"\u{1F3AD} Filters",children:en.map(({key:e,label:t,min:r,max:l,value:n,setter:i})=>(0,a.jsx)(eF,{label:t,value:n,min:r,max:l,onChange:i,onChangeComplete:ea},e))},"filters"),(0,a.jsxs)(eJ,{header:"\u{1F4D0} Crop & Ruler",children:[(0,a.jsxs)(P.default,{children:[(0,a.jsx)(I.default,{icon:(0,a.jsx)(eG,{}),onClick:()=>l("crop"),children:"Crop"}),(0,a.jsx)(I.default,{onClick:()=>{b(!0),l("perspective");},children:"Perspective"})]}),(0,a.jsx)("div",{style:{marginTop:10},children:"Ruler"}),(0,a.jsxs)(P.default,{children:[(0,a.jsx)(I.default,{onClick:()=>l("ruler"),children:"\u{1F4CF} Ruler"}),(0,a.jsx)(I.default,{onClick:()=>{null==C||C(null),Y.default.info("Ruler cleared");},children:"Clear"})]}),j&&(0,a.jsxs)("div",{children:["Estimated DPI: ",j]})]},"crop"),(0,a.jsx)(eJ,{header:"\u{1F4E4} Export",children:(0,a.jsxs)(P.default,{children:[(0,a.jsx)(I.default,{icon:(0,a.jsx)(e$,{}),onClick:()=>S(!1,e,k),children:"PNG"}),(0,a.jsx)(I.default,{onClick:()=>S(!0,e,k),children:"JPG"}),(0,a.jsx)(I.default,{icon:(0,a.jsx)(h.default,{}),onClick:()=>ex(e),children:"Copy"})]})},"export")]})});};var e0=r("4f331305"),e1=l._(e0),e2=r("d62d811b"),e5=l._(e2),e4=r("5e015b19"),e3=l._(e4),e6=r("a408d8c9"),e8=l._(e6);let{Option:e7}=e1.default,e9=({history:e,setZoom:t,tool:r,setTool:l,brushType:n,setBrushType:i,drawColor:s,setDrawColor:o,drawLineWidth:u,setDrawLineWidth:d,brushOpacity:c,setBrushOpacity:h,brushFlow:f,setBrushFlow:g})=>{let x=(0,w.useRef)(!1),m=(0,w.useRef)(null),p=(0,w.useRef)(c),v=(0,w.useRef)(!1),y=(0,w.useRef)(null),b=(0,w.useRef)(f);return(0,a.jsx)("div",{style:{marginBottom:8},children:(0,a.jsxs)(P.default,{children:[(0,a.jsx)(e1.default,{style:{width:150},placeholder:"History",value:e.index,onChange:t=>e.applyHistory(t),optionLabelProp:"label",children:e.history.map((e,t)=>(0,a.jsx)(e1.default.Option,{value:t,label:e.label||`Step ${t+1}`,children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("img",{src:e.url,alt:"",style:{width:40,height:30,objectFit:"contain",border:"1px solid #ddd"}}),(0,a.jsx)("span",{children:e.label||`Step ${t+1}`})]})},t))}),(0,a.jsx)(O.default,{title:"Zoom In",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(e3.default,{}),onClick:()=>t(e=>Math.min(1.2*e,8))})}),(0,a.jsx)(O.default,{title:"Zoom Out",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(e8.default,{}),onClick:()=>t(e=>Math.max(e/1.2,.1))})}),(0,a.jsxs)(e1.default,{value:r,onChange:e=>l(e),style:{width:140},children:[(0,a.jsx)(e7,{value:"pan",children:"Pan"}),(0,a.jsx)(e7,{value:"color",children:"Color Picker"}),(0,a.jsx)(e7,{value:"crop",children:"Crop"}),(0,a.jsx)(e7,{value:"ruler",children:"Ruler"}),(0,a.jsx)(e7,{value:"perspective",children:"Perspective"}),(0,a.jsx)(e7,{value:"draw",children:"Brush"})]}),(0,a.jsxs)(P.default,{style:{width:"100%"},wrap:!0,children:[(0,a.jsxs)(e1.default,{value:n,onChange:e=>i(e),style:{width:80},children:[(0,a.jsx)(e7,{value:"hard",children:"Hard"}),(0,a.jsx)(e7,{value:"soft",children:"Soft"})]}),(0,a.jsx)(e5.default,{value:s,onChange:e=>o(e.toHexString())}),(0,a.jsx)(_.default,{style:{width:100},min:1,max:500,value:u,onChange:e=>d(e||1),addonAfter:"px"}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("span",{onMouseDown:e=>{if(0!==e.button)return;e.preventDefault(),x.current=!0,m.current=e.clientX,p.current=c;let t=document.body.style.userSelect;document.body.style.userSelect="none";let r=e=>{if(!x.current||null===m.current)return;let t=e.clientX-m.current,r=p.current+.005*t;h(Number((r=Math.max(0,Math.min(1,r))).toFixed(2)));},l=()=>{x.current=!1,m.current=null,p.current=c,document.body.style.userSelect=t,window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",l);};window.addEventListener("mousemove",r),window.addEventListener("mouseup",l);},style:{cursor:"ew-resize",userSelect:"none"},title:"Drag left/right to change opacity",children:"Opacity:"}),(0,a.jsx)(_.default,{min:0,max:1,step:.01,style:{width:60},value:c,onChange:e=>h(e||0)})]}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("span",{onMouseDown:e=>{if(0!==e.button)return;e.preventDefault(),v.current=!0,y.current=e.clientX,b.current=f;let t=document.body.style.userSelect;document.body.style.userSelect="none";let r=e=>{if(!v.current||null===y.current)return;let t=e.clientX-y.current,r=b.current+.005*t;g(Number((r=Math.max(0,Math.min(1,r))).toFixed(2)));},l=()=>{v.current=!1,y.current=null,b.current=f,document.body.style.userSelect=t,window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",l);};window.addEventListener("mousemove",r),window.addEventListener("mouseup",l);},style:{cursor:"ew-resize",userSelect:"none"},title:"Drag left/right to change flow",children:"Flow:"}),(0,a.jsx)(_.default,{min:0,max:1,step:.01,style:{width:60},value:f,onChange:e=>g(e||0)})]})]})]})});},te=({imageUrl:e,onExport:t})=>{let r=(0,w.useRef)(null),{canvasRef:l,overlayRef:n,baseCanvas:i}=function(e,t){let r=(0,w.useRef)(null),l=(0,w.useRef)(null),[n,a]=(0,w.useState)(null);(0,w.useEffect)(()=>{(async()=>{try{let l=await new Promise((t,r)=>{let l=new Image;l.crossOrigin="anonymous",l.onload=()=>{let e=ee(l.naturalWidth,l.naturalHeight);e.getContext("2d").drawImage(l,0,0),t(e);},l.onerror=r,l.src=e;});a(l);let n=ee(l.width,l.height);if(n.getContext("2d").drawImage(l,0,0),r.current){r.current.width=n.width,r.current.height=n.height;let e=r.current.getContext("2d");e.clearRect(0,0,n.width,n.height),e.drawImage(n,0,0);}t&&t(i(n));}catch(e){console.error("Failed to load image",e),Y.default.error("Failed to load image");}})();},[e]),(0,w.useEffect)(()=>{s();},[n]);let i=e=>e.toDataURL("image/png"),s=()=>{if(!r.current||!n)return;r.current.width=n.width,r.current.height=n.height,l.current.width=n.width,l.current.height=n.height;let e=r.current.getContext("2d");e.clearRect(0,0,r.current.width,r.current.height),e.drawImage(n,0,0);};return{canvasRef:r,overlayRef:l,baseCanvas:n,syncCanvasSize:s};}(e,e=>s.push(e,"Initial load")),s=function(e,t){let[r,l]=(0,w.useState)([]),[n,a]=(0,w.useState)(-1),i=r[n],s=l=>{let n=r[l];if(!n)return;let i=new Image;i.onload=()=>{let r=e.current.getContext("2d");e.current.width=i.naturalWidth,e.current.height=i.naturalHeight,t.current.width=i.naturalWidth,t.current.height=i.naturalHeight,r.clearRect(0,0,e.current.width,e.current.height),r.drawImage(i,0,0),a(l);},i.src=n.url;};return{history:r,index:n,current:i,push:(e,t="")=>{let i=r.slice(0,n+1);i.push({url:e,label:t}),l(i),a(i.length-1);},undo:()=>{n<=0||s(n-1);},redo:()=>{n>=r.length-1||s(n+1);},applyHistory:s};}(l,n),[o,u]=(0,w.useState)(1),[d,c]=(0,w.useState)({x:0,y:0}),[h,f]=(0,w.useState)(!1),g=(0,w.useRef)(null),[x,m]=(0,w.useState)("pan"),[p,v]=(0,w.useState)(0),[y,b]=(0,w.useState)(0),[j,C]=(0,w.useState)(0),[S,k]=(0,w.useState)(0),[R,M]=(0,w.useState)(0),[L,I]=(0,w.useState)(0),[E,D]=(0,w.useState)(0),[B,_]=(0,w.useState)(0),[z,P]=(0,w.useState)(0),[T,U]=(0,w.useState)(null),A=(0,w.useRef)(null),[G,H]=(0,w.useState)(!1),$=(0,w.useRef)(null),[N,O]=(0,w.useState)(null),[V,W]=(0,w.useState)(!1),[F,X]=(0,w.useState)(!1),[K,Z]=(0,w.useState)(null),[q,J]=(0,w.useState)(null),[et]=(0,w.useState)(!1),er=(0,w.useRef)(null),[el,en]=(0,w.useState)(null),[ea,ei]=(0,w.useState)("#ff0000"),[es,eo]=(0,w.useState)(2),[eu,ed]=(0,w.useState)("hard"),[ec,eh]=(0,w.useState)(1),[ex,em]=(0,w.useState)(1),[ep,ey]=(0,w.useState)(!1),eb=(0,w.useRef)([]),ej=(0,w.useRef)(!1),eC=(0,w.useRef)(null),ek=(0,w.useRef)(es),[eR,eM]=(0,w.useState)(0),[eL,eI]=(0,w.useState)(0),[eE,eD]=(0,w.useState)(0),[eB,e_]=(0,w.useState)(0),[ez,eP]=(0,w.useState)(0),[eT,eU]=(0,w.useState)(0),[eA,eG]=(0,w.useState)(0),[eH,e$]=(0,w.useState)({});(0,w.useEffect)(()=>{let e=r.current;if(!e)return;let t=e=>e.preventDefault();return e.addEventListener("contextmenu",t),()=>e.removeEventListener("contextmenu",t);},[]),(0,w.useEffect)(()=>{let e=r.current,t=l.current;if(!e||!t)return;let n=e=>{if(!e.ctrlKey)return;e.preventDefault();let r=t.getBoundingClientRect(),l=e.clientX-r.left,n=e.clientY-r.top;u(t=>{let r=Math.min(Math.max(t*(e.deltaY<0?1.1:.9),.1),12),a=r/t;return c(e=>({x:l-(l-e.x)*a,y:n-(n-e.y)*a})),r;});};return e.addEventListener("wheel",n,{passive:!1}),()=>e.removeEventListener("wheel",n);},[]);let eN=()=>{if(!n.current||!l.current)return;let e=n.current.getContext("2d");if(e.clearRect(0,0,n.current.width,n.current.height),T&&(e.save(),e.strokeStyle="#00aaff",e.lineWidth=2,e.setLineDash([6,4]),e.strokeRect(T.x,T.y,T.w,T.h),e.restore()),er.current&&(e.save(),e.strokeStyle="#ffcc00",e.lineWidth=2,e.beginPath(),e.moveTo(er.current.x1,er.current.y1),e.lineTo(er.current.x2,er.current.y2),e.stroke(),e.restore()),$.current){e.save(),e.fillStyle="rgba(0,255,0,0.8)";for(let t=0;t<8;t+=2){let r=$.current[t],l=$.current[t+1];isNaN(r)||isNaN(l)||e.fillRect(r-4,l-4,8,8);}e.restore();}if(K&&"color"===x){let t=l.current.getBoundingClientRect(),r=(K.x-t.left)/o,n=(K.y-t.top)/o;e.save(),e.strokeStyle=K.color,e.lineWidth=2/o,e.beginPath(),e.arc(r,n,8/o,0,2*Math.PI),e.stroke(),e.restore();}if(K&&"draw"===x){let t=l.current.getBoundingClientRect(),r=(K.x-t.left)/o,n=(K.y-t.top)/o;e.save(),e.strokeStyle=ea,e.lineWidth=2/o,e.beginPath(),e.arc(r,n,es/2,0,2*Math.PI),e.stroke(),e.restore();}};(0,w.useEffect)(()=>{let e=l.current;if(!e)return;let t=e=>{if("color"===x){let t=ev(e,l,o);Z(t?{x:e.clientX,y:e.clientY,color:t}:null),eN();}else"draw"===x&&(Z(ea?{x:e.clientX,y:e.clientY,color:ea}:null),eN());},r=e=>{if("color"===x){let t=ev(e,l,o);t&&(J(t),ei(t),navigator.clipboard.writeText(t).catch(()=>{}),Y.default.success(`Picked color ${t}`));}},n=()=>{"color"===x&&Z(null);};return e.addEventListener("mousemove",t),e.addEventListener("click",r),e.addEventListener("mouseleave",n),()=>{e.removeEventListener("mousemove",t),e.removeEventListener("click",r),e.removeEventListener("mouseleave",n);};},[x,o,d]),(0,w.useEffect)(()=>{let e=e=>{e.ctrlKey&&"z"===e.key&&s.undo(),e.ctrlKey&&e.shiftKey&&"Z"===e.key&&s.redo(),"c"===e.key&&m("crop"),"h"===e.key&&m("pan"),"r"===e.key&&ef(90,l,n,s.history),"p"===e.key&&m("color"),"b"===e.key&&m("draw");};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e);},[s.index,s.history]),(0,w.useEffect)(()=>{let e=e=>{"Space"===e.code?(e.preventDefault(),W(e=>(e||(O(e=>null===e?x:e),m("pan")),!0))):"AltLeft"===e.code&&"draw"===x&&(e.preventDefault(),X(e=>(e||(O(e=>null===e?x:e),m("color")),!0)));},t=e=>{"Space"===e.code?(W(!1),O(e=>(e&&m(e),null))):"AltLeft"===e.code&&"draw"===N&&(X(!1),O(e=>(e&&m(e),null)));};return window.addEventListener("keydown",e,{passive:!1}),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t);};},[x]);let eO=async()=>{if(!l.current||!$.current)return;let e=l.current,t=e.width,r=e.height,a=function(e,t,r,l){let n=ee(r,l),a=n.getContext("2d");function i(t,n){let[i,s,o,u,d,c]=t,[h,f,g,x,m,p]=n;1e-6>Math.abs(h*(x-p)+g*(p-f)+m*(f-x))||(a.save(),a.beginPath(),a.moveTo(h,f),a.lineTo(g,x),a.lineTo(m,p),a.closePath(),a.clip(),a.drawImage(e,0,0,r,l),a.restore());}e.getContext("2d").getImageData(0,0,e.width,e.height);let[s,o,u,d,c,h,f,g]=t;return i([s,o,u,d,c,h],[0,0,r,0,0,l]),i([c,h,f,g,s,o],[r,l,0,l,r,0]),n;}(e,$.current,t,r);l.current.width=a.width,l.current.height=a.height,n.current.width=a.width,n.current.height=a.height,l.current.getContext("2d").clearRect(0,0,a.width,a.height),l.current.getContext("2d").drawImage(a,0,0),s.push(l.current.toDataURL(),"Perspective corrected"),H(!1);},eV=(0,w.useMemo)(()=>{if(("pan"===x||"select"===x)&&h)return"grabbing";switch(x){case"pan":return"grab";case"crop":case"ruler":case"perspective":return"crosshair";case"color":return"copy";case"draw":return"pointer";default:return"default";}},[x,h]);return(0,a.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,a.jsx)(eQ,{canvasRef:l,overlayRef:n,baseCanvas:i,history:s,setTool:m,brightness:p,setBrightness:v,contrast:y,setContrast:b,highlights:j,setHighlights:C,shadows:S,setShadows:k,whites:R,setWhites:M,blacks:L,setBlacks:I,vibrance:E,setVibrance:D,saturation:B,setSaturation:_,dehaze:z,setDehaze:P,blur:eR,setBlur:eM,gaussian:eL,setGaussian:eI,sharpen:eE,setSharpen:eD,texture:eB,setTexture:e_,clarity:ez,setClarity:eP,bgThreshold:eT,setBgThreshold:eU,bgThresholdBlack:eA,setBgThresholdBlack:eG,hslAdjustments:eH,setHslAdjustments:(e,t)=>{e$(r=>({...r,[e]:{...r[e]||{},...t}}));},setShowPerspectiveModal:H,dpiMeasured:el,setDpiMeasured:en,exportImage:eg,onExport:t}),(0,a.jsxs)("div",{style:{flex:1},children:[(0,a.jsx)(e9,{history:s,setZoom:u,tool:x,setTool:m,brushType:eu,setBrushType:ed,drawColor:ea,setDrawColor:ei,drawLineWidth:es,setDrawLineWidth:eo,brushOpacity:ec,setBrushOpacity:eh,brushFlow:ex,setBrushFlow:em}),(0,a.jsx)(eS,{canvasRef:l,overlayRef:n,containerRef:r,offset:d,zoom:o,tool:x,currentCursor:eV,hoverColor:K,onMouseDown:e=>{let t=l.current.getBoundingClientRect(),r=(e.clientX-t.left)/o,n=(e.clientY-t.top)/o;if("color"===x&&e.altKey&&2===e.button&&m("draw"),("draw"===x||"color"===x)&&e.altKey&&2===e.button){e.preventDefault(),ej.current=!0,eC.current=e.clientX,ek.current=es;return;}if("pan"===x||"select"===x)f(!0),g.current={x:e.clientX-d.x,y:e.clientY-d.y};else if("crop"===x)A.current={x:r,y:n},U({x:r,y:n,w:1,h:1});else if("ruler"===x){if(er.current){er.current.x2=r,er.current.y2=n;let e=r-er.current.x1,t=n-er.current.y1,a=Math.sqrt(e*e+t*t),i=Math.round(a/(l.current.width/(window.devicePixelRatio||1))*96);en(i),Y.default.info(`Distance: ${Math.round(a)} px, estimated DPI: ${i}`),er.current=null;}else er.current={x1:r,y1:n,x2:r,y2:n};}else if("perspective"===x){$.current||($.current=[r,n,r,n,r,n,r,n]);let e=$.current;for(let t=0;t<8;t+=2)if(isNaN(e[t])||isNaN(e[t+1])||0===e[t]&&0===e[t+1]){e[t]=r,e[t+1]=n;break;}}else"draw"===x&&(ey(!0),eb.current=[{x:r,y:n}]);},onMouseMove:e=>{if(ej.current&&null!==eC.current){let t=e.clientX-eC.current;eo(Math.max(1,Math.round(10*Math.min(500,ek.current+t/2))/10)),eN();return;}if(("pan"===x||"select"===x)&&h&&g.current)c({x:e.clientX-g.current.x,y:e.clientY-g.current.y});else if("crop"===x&&A.current){let t=l.current.getBoundingClientRect(),r={x:(e.clientX-t.left)/o,y:(e.clientY-t.top)/o};U({x:Math.min(A.current.x,r.x),y:Math.min(A.current.y,r.y),w:Math.abs(r.x-A.current.x),h:Math.abs(r.y-A.current.y)}),eN();}else if("draw"===x&&ep&&l.current){let t=l.current.getBoundingClientRect(),r=(e.clientX-t.left)/o,n=(e.clientY-t.top)/o;eb.current.push({x:r,y:n});let a=l.current.getContext("2d");a.save(),a.globalAlpha=ec*ex,"soft"===eu?(a.shadowColor=ea,a.shadowBlur=.5*es,a.lineWidth=.5*es):(a.shadowBlur=0,a.lineWidth=es),a.strokeStyle=ea,a.lineCap="round",a.lineJoin="round",a.beginPath();let i=eb.current;a.moveTo(i[i.length-2].x,i[i.length-2].y),a.lineTo(i[i.length-1].x,i[i.length-1].y),a.stroke(),a.restore(),eN();}else eN();},onMouseUp:()=>{if(ej.current){ej.current=!1,eC.current=null,ek.current=es;return;}f(!1),g.current=null,"crop"===x&&T&&ew(l,n,T,U,s),"draw"===x&&ep&&(ey(!1),s.push(l.current.toDataURL(),"Draw"));}})]}),(0,a.jsx)(Q.default,{title:"Perspective correction",open:G,onOk:()=>eO(),onCancel:()=>H(!1),okText:"Apply",children:(0,a.jsx)("p",{children:"Click four points on the image (clockwise) to define the corners, then Apply."})})]});},{Title:tt}=W.default,{TabPane:tr}=G.default,tl=()=>{let[e,t]=(0,w.useState)(null),[r,l]=(0,w.useState)(null),[n,i]=(0,w.useState)(null),[o,c]=(0,w.useState)(!1),[f,x]=(0,w.useState)(!1),m=(0,w.useRef)(0),[p,v]=(0,w.useState)(1),[y,b]=(0,w.useState)(1),[C,S]=(0,w.useState)(1),[R,L]=(0,w.useState)(8),[E,B]=(0,w.useState)(2),[z,T]=(0,w.useState)(1);(0,w.useEffect)(()=>{let e=e=>{var t;let r=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!r)return;let l=Array.from(r).find(e=>e.type.includes("image"));if(l){let t=l.getAsFile();t&&(A(t),Y.default.success("Image pasted from clipboard!"),e.preventDefault());}};return window.addEventListener("paste",e),()=>window.removeEventListener("paste",e);},[]);let A=e=>{t(e);let r=new FileReader;return r.onload=e=>{var t;return l(null===(t=e.target)||void 0===t?void 0:t.result);},r.readAsDataURL(e),c(!1),m.current=0,!1;},H=(e,t)=>{let r=new Blob([e],{type:"image/svg+xml"}),l=document.createElement("a");l.href=URL.createObjectURL(r),l.download=t,l.click();},N=n?btoa(unescape(encodeURIComponent(n))):"",V=n?`data:image/svg+xml;base64,${N}`:"";return(0,a.jsx)(s.default,{setDragging:c,dragCounter:m,handleUpload:A,children:(0,a.jsx)(D.default,{title:(0,a.jsxs)(a.Fragment,{children:["\u{1F5BC}\uFE0F PNG / JPEG Viewer ",(0,a.jsx)($.default,{color:"cyan",children:"Beta"})]}),variant:"borderless",children:(0,a.jsxs)(P.default,{direction:"vertical",style:{width:"100%"},size:"large",children:[!o&&(0,a.jsx)(X.default,{beforeUpload:A,showUploadList:!1,accept:".png,.jpg,.jpeg",children:(0,a.jsx)(I.default,{icon:(0,a.jsx)(M.default,{}),children:"Upload Image (PNG/JPG)"})}),o&&(0,a.jsx)(u.default,{}),r&&(0,a.jsxs)("div",{children:[(0,a.jsx)(tt,{level:5,children:"Preview & Editor:"}),(0,a.jsx)(te,{imageUrl:r,onExport:e=>{console.log("exported blob",e);}})]}),f&&(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(255, 255, 255, 0.7)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:(0,a.jsx)(U.default,{indicator:(0,a.jsx)(k,{style:{fontSize:48,color:"#1890ff"},spin:!0}),tip:"Converting image to SVG...",size:"large"})}),(0,a.jsx)(D.default,{size:"small",title:"Tracing Options (Adjust before converting)",children:(0,a.jsxs)(P.default,{wrap:!0,size:"large",children:[(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(O.default,{title:"Scale factor for the SVG output. Higher = larger SVG.",children:(0,a.jsxs)("label",{children:["Scale ",(0,a.jsx)(j,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:.1,step:.1,value:p,onChange:e=>v(e||1)})]}),(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(O.default,{title:"Error threshold for line detection. Lower = more precise lines.",children:(0,a.jsxs)("label",{children:["ltres ",(0,a.jsx)(j,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:0,value:y,onChange:e=>b(e||1)})]}),(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(O.default,{title:"Error threshold for curve detection. Lower = more precise curves.",children:(0,a.jsxs)("label",{children:["qtres ",(0,a.jsx)(j,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:0,value:C,onChange:e=>S(e||1)})]}),(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(O.default,{title:"Minimum path length to keep. Higher = simpler SVG with fewer tiny paths.",children:(0,a.jsxs)("label",{children:["Pathomit ",(0,a.jsx)(j,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:0,value:R,onChange:e=>L(e||0)})]}),(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(O.default,{title:"Pixel sampling interval for colors. 1 = every pixel, higher = faster but less accurate colors.",children:(0,a.jsxs)("label",{children:["ColorSampling ",(0,a.jsx)(j,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:1,value:E,onChange:e=>B(e||1)})]}),(0,a.jsxs)(P.default,{size:"small",children:[(0,a.jsx)(O.default,{title:"Stroke width in the output SVG.",children:(0,a.jsxs)("label",{children:["StrokeWidth ",(0,a.jsx)(j,{style:{marginLeft:4}})]})}),(0,a.jsx)(_.default,{min:0,value:z,onChange:e=>T(e||1)})]})]})}),(0,a.jsxs)(P.default,{children:[(0,a.jsx)(I.default,{type:"primary",onClick:()=>{if(!r){Y.default.error("Please upload an image first.");return;}x(!0);try{q.default.imageToSVG(r,e=>{i(e),x(!1),Y.default.success("Image converted to SVG successfully!");},{scale:p,ltres:y,qtres:C,pathomit:R,colorsampling:E,strokewidth:z});}catch(e){console.error(e),x(!1),Y.default.error("Error converting image to SVG.");}},disabled:!e,children:"Convert to SVG"}),(0,a.jsx)(I.default,{onClick:()=>{t(null),l(null),i(null),Y.default.info("Image and SVG cleared.");},danger:!0,disabled:!e&&!n,children:"Clear Image"})]}),n&&(0,a.jsxs)(G.default,{defaultActiveKey:"svg",type:"card",style:{marginTop:16},children:[(0,a.jsxs)(tr,{tab:"SVG",children:[(0,a.jsxs)(P.default,{style:{marginBottom:8},children:[(0,a.jsx)(I.default,{onClick:()=>H(n,"image.svg"),icon:(0,a.jsx)(g.default,{}),children:"Download"}),(0,a.jsx)(I.default,{onClick:()=>(0,d.handleCopy)(n,"SVG copied!"),icon:(0,a.jsx)(h.default,{}),children:"Copy"})]}),(0,a.jsx)("div",{style:{border:"1px solid #eee",borderRadius:6,padding:12,overflow:"auto"},children:(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:n}})})]},"svg"),(0,a.jsxs)(tr,{tab:"Base64",children:[(0,a.jsxs)(P.default,{style:{marginBottom:8},children:[(0,a.jsx)(I.default,{onClick:()=>(0,d.handleCopy)(N,"Base64 copied!"),icon:(0,a.jsx)(h.default,{}),children:"Copy Base64"}),(0,a.jsx)(I.default,{onClick:()=>H(N,"image-base64.txt"),icon:(0,a.jsx)(g.default,{}),children:"Download Base64"})]}),(0,a.jsx)("pre",{style:{background:"#f7f7f7",padding:12,borderRadius:6,whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:300,overflow:"auto"},children:N})]},"base64"),(0,a.jsxs)(tr,{tab:"Data URI",children:[(0,a.jsxs)(P.default,{style:{marginBottom:8},children:[(0,a.jsx)(I.default,{onClick:()=>(0,d.handleCopy)(V,"Data URI copied!"),icon:(0,a.jsx)(h.default,{}),children:"Copy Data URI"}),(0,a.jsx)(I.default,{onClick:()=>H(V,"image-datauri.txt"),icon:(0,a.jsx)(g.default,{}),children:"Download Data URI"})]}),(0,a.jsx)("pre",{style:{background:"#f7f7f7",padding:12,borderRadius:6,whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:300,overflow:"auto"},children:V})]},"datauri")]})]})})});};}}]);
//# sourceMappingURL=2ed777c5-async.1c6c8f58.js.map